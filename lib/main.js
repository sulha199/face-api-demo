(self.webpackChunkface_match_demo=self.webpackChunkface_match_demo||[]).push([[179],{255:Zn=>{function oo(ve){return Promise.resolve().then(()=>{var Yi=new Error("Cannot find module '"+ve+"'");throw Yi.code="MODULE_NOT_FOUND",Yi})}oo.keys=()=>[],oo.resolve=oo,oo.id=255,Zn.exports=oo},394:function(){(function(){"use strict";var Zn;function oo(C){var O=0;return function(){return O<C.length?{done:!1,value:C[O++]}:{done:!0}}}var ve="function"==typeof Object.defineProperties?Object.defineProperty:function(C,O,F){return C==Array.prototype||C==Object.prototype||(C[O]=F.value),C},Xi=function(C){C=["object"==typeof globalThis&&globalThis,C,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var O=0;O<C.length;++O){var F=C[O];if(F&&F.Math==Math)return F}throw Error("Cannot find global object")}(this);function lr(C,O){if(O)e:{var F=Xi;C=C.split(".");for(var V=0;V<C.length-1;V++){var K=C[V];if(!(K in F))break e;F=F[K]}(O=O(V=F[C=C[C.length-1]]))!=V&&null!=O&&ve(F,C,{configurable:!0,writable:!0,value:O})}}function Ns(C){return(C={next:C})[Symbol.iterator]=function(){return this},C}function Ir(C){var O="undefined"!=typeof Symbol&&Symbol.iterator&&C[Symbol.iterator];return O?O.call(C):{next:oo(C)}}function xr(C){if(!(C instanceof Array)){C=Ir(C);for(var O,F=[];!(O=C.next()).done;)F.push(O.value);C=F}return C}lr("Symbol",function(C){function F(se,te){this.g=se,ve(this,"description",{configurable:!0,writable:!0,value:te})}if(C)return C;F.prototype.toString=function(){return this.g};var V="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",K=0;return function O(se){if(this instanceof O)throw new TypeError("Symbol is not a constructor");return new F(V+(se||"")+"_"+K++,se)}}),lr("Symbol.iterator",function(C){if(C)return C;C=Symbol("Symbol.iterator");for(var O="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),F=0;F<O.length;F++){var V=Xi[O[F]];"function"==typeof V&&"function"!=typeof V.prototype[C]&&ve(V.prototype,C,{configurable:!0,writable:!0,value:function(){return Ns(oo(this))}})}return C});var Ye,oi="function"==typeof Object.create?Object.create:function(C){function O(){}return O.prototype=C,new O};if("function"==typeof Object.setPrototypeOf)Ye=Object.setPrototypeOf;else{var Si;e:{var Ga={};try{Ga.__proto__={a:!0},Si=Ga.a;break e}catch(C){}Si=!1}Ye=Si?function(C,O){if(C.__proto__=O,C.__proto__!==O)throw new TypeError(C+" is not extensible");return C}:null}var en=Ye;function Rs(C,O){if(C.prototype=oi(O.prototype),C.prototype.constructor=C,en)en(C,O);else for(var F in O)if("prototype"!=F)if(Object.defineProperties){var V=Object.getOwnPropertyDescriptor(O,F);V&&Object.defineProperty(C,F,V)}else C[F]=O[F];C.ea=O.prototype}function wr(){this.l=!1,this.i=null,this.h=void 0,this.g=1,this.s=this.m=0,this.j=null}function Vn(C){if(C.l)throw new TypeError("Generator is already running");C.l=!0}function Ct(C,O){C.j={U:O,V:!0},C.g=C.m||C.s}function gt(C,O,F){return C.g=F,{value:O}}function So(C){this.g=new wr,this.h=C}function Re(C,O,F,V){try{var K=O.call(C.g.i,F);if(!(K instanceof Object))throw new TypeError("Iterator result "+K+" is not an object");if(!K.done)return C.g.l=!1,K;var se=K.value}catch(te){return C.g.i=null,Ct(C.g,te),Bt(C)}return C.g.i=null,V.call(C.g,se),Bt(C)}function Bt(C){for(;C.g.g;)try{var O=C.h(C.g);if(O)return C.g.l=!1,{value:O.value,done:!1}}catch(F){C.g.h=void 0,Ct(C.g,F)}if(C.g.l=!1,C.g.j){if(O=C.g.j,C.g.j=null,O.V)throw O.U;return{value:O.return,done:!0}}return{value:void 0,done:!0}}function Ee(C){this.next=function(O){return Vn(C.g),C.g.i?O=Re(C,C.g.i.next,O,C.g.o):(C.g.o(O),O=Bt(C)),O},this.throw=function(O){return Vn(C.g),C.g.i?O=Re(C,C.g.i.throw,O,C.g.o):(Ct(C.g,O),O=Bt(C)),O},this.return=function(O){return function(C,O){Vn(C.g);var F=C.g.i;return F?Re(C,"return"in F?F.return:function(V){return{value:V,done:!0}},O,C.g.return):(C.g.return(O),Bt(C))}(C,O)},this[Symbol.iterator]=function(){return this}}function vn(C){return function(C){function O(V){return C.next(V)}function F(V){return C.throw(V)}return new Promise(function(V,K){!function se(te){te.done?V(te.value):Promise.resolve(te.value).then(O,F).then(se,K)}(C.next())})}(new Ee(new So(C)))}wr.prototype.o=function(C){this.h=C},wr.prototype.return=function(C){this.j={return:C},this.g=this.s},lr("Promise",function(C){function O(te){this.h=0,this.i=void 0,this.g=[],this.o=!1;var ye=this.j();try{te(ye.resolve,ye.reject)}catch(ge){ye.reject(ge)}}function F(){this.g=null}function V(te){return te instanceof O?te:new O(function(ye){ye(te)})}if(C)return C;F.prototype.h=function(te){if(null==this.g){this.g=[];var ye=this;this.i(function(){ye.l()})}this.g.push(te)};var K=Xi.setTimeout;F.prototype.i=function(te){K(te,0)},F.prototype.l=function(){for(;this.g&&this.g.length;){var te=this.g;this.g=[];for(var ye=0;ye<te.length;++ye){var ge=te[ye];te[ye]=null;try{ge()}catch(Ne){this.j(Ne)}}}this.g=null},F.prototype.j=function(te){this.i(function(){throw te})},O.prototype.j=function(){function te(Ne){return function(st){ge||(ge=!0,Ne.call(ye,st))}}var ye=this,ge=!1;return{resolve:te(this.C),reject:te(this.l)}},O.prototype.C=function(te){if(te===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(te instanceof O)this.F(te);else{e:switch(typeof te){case"object":var ye=null!=te;break e;case"function":ye=!0;break e;default:ye=!1}ye?this.v(te):this.m(te)}},O.prototype.v=function(te){var ye=void 0;try{ye=te.then}catch(ge){return void this.l(ge)}"function"==typeof ye?this.G(ye,te):this.m(te)},O.prototype.l=function(te){this.s(2,te)},O.prototype.m=function(te){this.s(1,te)},O.prototype.s=function(te,ye){if(0!=this.h)throw Error("Cannot settle("+te+", "+ye+"): Promise already settled in state"+this.h);this.h=te,this.i=ye,2===this.h&&this.D(),this.A()},O.prototype.D=function(){var te=this;K(function(){if(te.B()){var ye=Xi.console;void 0!==ye&&ye.error(te.i)}},1)},O.prototype.B=function(){if(this.o)return!1;var te=Xi.CustomEvent,ye=Xi.Event,ge=Xi.dispatchEvent;return void 0===ge||("function"==typeof te?te=new te("unhandledrejection",{cancelable:!0}):"function"==typeof ye?te=new ye("unhandledrejection",{cancelable:!0}):(te=Xi.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,te),te.promise=this,te.reason=this.i,ge(te))},O.prototype.A=function(){if(null!=this.g){for(var te=0;te<this.g.length;++te)se.h(this.g[te]);this.g=null}};var se=new F;return O.prototype.F=function(te){var ye=this.j();te.J(ye.resolve,ye.reject)},O.prototype.G=function(te,ye){var ge=this.j();try{te.call(ye,ge.resolve,ge.reject)}catch(Ne){ge.reject(Ne)}},O.prototype.then=function(te,ye){function ge(ct,ze){return"function"==typeof ct?function(yt){try{Ne(ct(yt))}catch(Je){st(Je)}}:ze}var Ne,st,vt=new O(function(ct,ze){Ne=ct,st=ze});return this.J(ge(te,Ne),ge(ye,st)),vt},O.prototype.catch=function(te){return this.then(void 0,te)},O.prototype.J=function(te,ye){function ge(){switch(Ne.h){case 1:te(Ne.i);break;case 2:ye(Ne.i);break;default:throw Error("Unexpected state: "+Ne.h)}}var Ne=this;null==this.g?se.h(ge):this.g.push(ge),this.o=!0},O.resolve=V,O.reject=function(te){return new O(function(ye,ge){ge(te)})},O.race=function(te){return new O(function(ye,ge){for(var Ne=Ir(te),st=Ne.next();!st.done;st=Ne.next())V(st.value).J(ye,ge)})},O.all=function(te){var ye=Ir(te),ge=ye.next();return ge.done?V([]):new O(function(Ne,st){function vt(yt){return function(Je){ct[yt]=Je,0==--ze&&Ne(ct)}}var ct=[],ze=0;do{ct.push(void 0),ze++,V(ge.value).J(vt(ct.length-1),st),ge=ye.next()}while(!ge.done)})},O});var rn="function"==typeof Object.assign?Object.assign:function(C,O){for(var F=1;F<arguments.length;F++){var V=arguments[F];if(V)for(var K in V)Object.prototype.hasOwnProperty.call(V,K)&&(C[K]=V[K])}return C};lr("Object.assign",function(C){return C||rn}),lr("Object.is",function(C){return C||function(O,F){return O===F?0!==O||1/O==1/F:O!=O&&F!=F}}),lr("Array.prototype.includes",function(C){return C||function(O,F){var V=this;V instanceof String&&(V=String(V));var K=V.length;for(0>(F=F||0)&&(F=Math.max(F+K,0));F<K;F++){var se=V[F];if(se===O||Object.is(se,O))return!0}return!1}}),lr("String.prototype.includes",function(C){return C||function(O,F){if(null==this)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(O instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return-1!==this.indexOf(O,F||0)}}),lr("Array.prototype.keys",function(C){return C||function(){return function(C,O){C instanceof String&&(C+="");var F=0,V=!1,K={next:function(){if(!V&&F<C.length){var se=F++;return{value:se,done:!1}}return V=!0,{done:!0,value:void 0}}};return K[Symbol.iterator]=function(){return K},K}(this)}});var Gn=this||self;function ce(C,O){C=C.split(".");var V,F=Gn;C[0]in F||void 0===F.execScript||F.execScript("var "+C[0]);for(;C.length&&(V=C.shift());)C.length||void 0===O?F=F[V]&&F[V]!==Object.prototype[V]?F[V]:F[V]={}:F[V]=O}function ht(C){!function(C){Gn.setTimeout(function(){throw C},0)}(C)}function No(C,O){ht(Error("Invalid wire type: "+C+" (at position "+O+")"))}function qi(){ht(Error("Failed to read varint, encoding is invalid."))}function so(C,O){return O=String.fromCharCode.apply(null,O),null==C?O:C+O}var Ya,Ro,Pr="undefined"!=typeof TextDecoder,fr="undefined"!=typeof TextEncoder;function Xa(C){if(fr)C=(Ro||(Ro=new TextEncoder)).encode(C);else{var O=void 0;O=void 0!==O&&O;for(var F=0,V=new Uint8Array(3*C.length),K=0;K<C.length;K++){var se=C.charCodeAt(K);if(128>se)V[F++]=se;else{if(2048>se)V[F++]=se>>6|192;else{if(55296<=se&&57343>=se){if(56319>=se&&K<C.length){var te=C.charCodeAt(++K);if(56320<=te&&57343>=te){V[F++]=(se=1024*(se-55296)+te-56320+65536)>>18|240,V[F++]=se>>12&63|128,V[F++]=se>>6&63|128,V[F++]=63&se|128;continue}K--}if(O)throw Error("Found an unpaired surrogate");se=65533}V[F++]=se>>12|224,V[F++]=se>>6&63|128}V[F++]=63&se|128}}C=V.subarray(0,F)}return C}var it={},Mo=null;function Yn(C){var O;void 0===O&&(O=0),kr(),O=it[O];for(var F=Array(Math.floor(C.length/3)),V=O[64]||"",K=0,se=0;K<C.length-2;K+=3){var te=C[K],ye=C[K+1],ge=C[K+2],Ne=O[te>>2];F[se++]=Ne+(te=O[(3&te)<<4|ye>>4])+(ye=O[(15&ye)<<2|ge>>6])+(ge=O[63&ge])}switch(Ne=0,ge=V,C.length-K){case 2:ge=O[(15&(Ne=C[K+1]))<<2]||V;case 1:F[se]=O[(C=C[K])>>2]+O[(3&C)<<4|Ne>>4]+ge+V}return F.join("")}function Xo(C){var O=C.length,F=3*O/4;F%3?F=Math.floor(F):-1!="=.".indexOf(C[O-1])&&(F=-1!="=.".indexOf(C[O-2])?F-2:F-1);var V=new Uint8Array(F),K=0;return function(C,O){function F(ge){for(;V<C.length;){var Ne=C.charAt(V++),st=Mo[Ne];if(null!=st)return st;if(!/^[\s\xa0]*$/.test(Ne))throw Error("Unknown base64 encoding at char: "+Ne)}return ge}kr();for(var V=0;;){var K=F(-1),se=F(0),te=F(64),ye=F(64);if(64===ye&&-1===K)break;O(K<<2|se>>4),64!=te&&(O(se<<4&240|te>>2),64!=ye&&O(te<<6&192|ye))}}(C,function(se){V[K++]=se}),V.subarray(0,K)}function kr(){if(!Mo){Mo={};for(var C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),O=["+/=","+/","-_=","-_.","-_"],F=0;5>F;F++){var V=C.concat(O[F].split(""));it[F]=V;for(var K=0;K<V.length;K++){var se=V[K];void 0===Mo[se]&&(Mo[se]=K)}}}}var Pt,va="function"==typeof Uint8Array;function Fs(C){if(this.g=C,null!==C&&0===C.length)throw Error("ByteString should be constructed with non-empty values")}Fs.prototype.toJSON=function(){if(null==this.g)var C="";else C=this.g=null==(C=this.g)||"string"==typeof C?C:va&&C instanceof Uint8Array?Yn(C):null;return C};var ao="function"==typeof Uint8Array.prototype.slice;function Ps(C,O,F){return O===F?Pt||(Pt=new Uint8Array(0)):ao?C.slice(O,F):new Uint8Array(C.subarray(O,F))}var wn=0;function qa(C,O){O=void 0!==(O=void 0===O?{}:O).u&&O.u,this.h=null,this.g=this.i=this.l=0,this.j=!1,this.u=O,C&&Ue(this,C)}function Ue(C,O){C.h=function(C){if(C.constructor===Uint8Array)return C;if(C.constructor===ArrayBuffer)return new Uint8Array(C);if(C.constructor===Array)return new Uint8Array(C);if(C.constructor===String)return Xo(C);if(C.constructor===Fs){if(null==C.g)var O=Pt||(Pt=new Uint8Array(0));else{O=Uint8Array;var F=C.g;F=null==F||va&&null!=F&&F instanceof Uint8Array?F:"string"==typeof F?Xo(F):null,O=new O(C=C.g=F)}return O}if(C instanceof Uint8Array)return new Uint8Array(C.buffer,C.byteOffset,C.byteLength);throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, or Array of numbers")}(O),C.l=0,C.i=C.h.length,C.g=C.l}function qr(C){C.g>C.i&&(C.j=!0,ht(Error("Tried to read past the end of the data "+C.g+" > "+C.i)))}function Oo(C){var O=C.h,F=O[C.g],V=127&F;return 128>F?(C.g+=1,qr(C),V):(V|=(127&(F=O[C.g+1]))<<7,128>F?(C.g+=2,qr(C),V):(V|=(127&(F=O[C.g+2]))<<14,128>F?(C.g+=3,qr(C),V):(V|=(127&(F=O[C.g+3]))<<21,128>F?(C.g+=4,qr(C),V):(V|=(15&(F=O[C.g+4]))<<28,128>F?(C.g+=5,qr(C),V>>>0):(C.g+=5,128<=O[C.g++]&&128<=O[C.g++]&&128<=O[C.g++]&&128<=O[C.g++]&&128<=O[C.g++]?(C.j=!0,qi(),V):(qr(C),V))))))}qa.prototype.reset=function(){this.g=this.l};var ks=[];function ya(){this.g=new Uint8Array(64),this.h=0}function Xn(C,O){if(!(C.h+1<C.g.length)){var F=C.g;C.g=new Uint8Array(Math.ceil(1+2*C.g.length)),C.g.set(F)}C.g[C.h++]=O}function Ls(C,O){for(;127<O;)Xn(C,127&O|128),O>>>=7;Xn(C,O)}function uo(C){var O={},F=void 0!==O.N&&O.N;this.m={u:void 0!==O.u&&O.u},this.N=F,O=this.m,ks.length?(F=ks.pop(),O&&(F.u=O.u),C&&Ue(F,C),C=F):C=new qa(C,O),this.g=C,this.l=this.g.g,this.h=this.i=-1,this.j=!1}function br(C){var O=C.g;if((O=O.g==O.i)||(O=C.j)||(O=(O=C.g).j||0>O.g||O.g>O.i),O)return!1;C.l=C.g.g;var F=Oo(C.g);return O=F>>>3,0<=(F&=7)&&5>=F?(C.i=O,C.h=F,!0):(C.j=!0,No(F,C.l),!1)}function qo(C){switch(C.h){case 0:if(0!=C.h)qo(C);else e:{for(var O=(C=C.g).g,F=0;10>F;F++){if(0==(128&C.h[O])){C.g=O+1,qr(C);break e}O++}C.j=!0,qi()}break;case 1:(C=C.g).g+=8,qr(C);break;case 2:2!=C.h?qo(C):(O=Oo(C.g),(C=C.g).g+=O,qr(C));break;case 5:(C=C.g).g+=4,qr(C);break;case 3:for(O=C.i;;){if(!br(C)){C.j=!0,ht(Error("Unmatched start-group tag: stream EOF"));break}if(4==C.h){C.i!=O&&(C.j=!0,ht(Error("Unmatched end-group tag")));break}qo(C)}break;default:C.j=!0,No(C.h,C.l)}}function Bs(C,O,F){C.N||(C=Ps(C.g.h,F,C.g.g),(F=O.m)?F.push(C):O.m=[C])}ya.prototype.length=function(){return this.h},ya.prototype.end=function(){var C=this.g,O=this.h;return this.h=0,Ps(C,0,O)},uo.prototype.reset=function(){this.g.reset(),this.h=this.i=-1};var Ka=[];function qn(){this.h=[],this.i=0,this.g=new ya}function Te(C,O){0!==O.length&&(C.h.push(O),C.i+=O.length)}function Qa(C,O,F){Ls(C.g,8*O+2),Ls(C.g,F.length),Te(C,C.g.end()),Te(C,F)}var ut,on="function"==typeof Symbol&&"symbol"==typeof Symbol()?Symbol(void 0):void 0;function Pn(C,O){Object.isFrozen(C)||(on?C[on]|=O:void 0!==C.g?C.g|=O:Object.defineProperties(C,{g:{value:O,configurable:!0,writable:!0,enumerable:!1}}))}function Ko(C){return C?null==(O=on?C[on]:C.g)?0:O:0;var O}function Qo(C){return Array.isArray(C)&&Pn(C,1),C}function Mu(C){if(!Array.isArray(C))throw Error("cannot mark non-array as immutable");Pn(C,2)}function Yt(C){return null!==C&&"object"==typeof C&&C.constructor===Object}function $a(C){switch(typeof C){case"number":return isFinite(C)?C:String(C);case"object":return va&&null!=C&&C instanceof Uint8Array?Yn(C):C;default:return C}}function Xt(C,O){if(null!=C)return Array.isArray(C)||Yt(C)?Za(C,O):O(C)}function Za(C,O){if(Array.isArray(C)){for(var F=Array(C.length),V=0;V<C.length;V++)F[V]=Xt(C[V],O);return 1&Ko(C)&&Qo(F),F}for(V in F={},C)F[V]=Xt(C[V],O);return F}function Ar(C,O,F){var V=ut;if(ut=null,C||(C=V),V=this.constructor.ca,C||(C=V?[V]:[]),this.j=(V?0:-1)-(this.constructor.aa||0),this.i=null,this.g=C,C=(V=this.g.length)-1,V&&Yt(V=this.g[C])?(this.l=C-this.j,this.h=V):void 0!==O&&-1<O?(this.l=Math.max(O,C+1-this.j),this.h=null):this.l=Number.MAX_VALUE,F)for(O=0;O<F.length;O++)(C=F[O])<this.l?(V=this.g[C+=this.j])?Qo(V):this.g[C]=Ki:(co(this),(V=this.h[C])?Qo(V):this.h[C]=Ki)}var yc,$r,Ki=Object.freeze(Qo([]));function co(C){var O=C.l+C.j;C.g[O]||(C.h=C.g[O]={})}function Le(C,O,F){return-1===O?null:void 0!==F&&F||O>=C.l?C.h?C.h[O]:void 0:C.g[O+C.j]}function di(C,O,F){F=void 0===F||F;var V=void 0!==V&&V,K=Le(C,O,V);return null==K&&(K=Ki),K===Ki?Zt(C,O,K=Qo([]),V):F&&Array.isArray(K)&&2&Ko(K)&&Zt(C,O,K=K.slice(),V),K}function lo(C,O,F){return null==(C=null==(C=Le(C,O))?C:+C)?void 0===F?0:F:C}function Zt(C,O,F,V){void 0!==V&&V||O>=C.l?(co(C),C.h[O]=F):C.g[O+C.j]=F}function Ja(C,O,F){C.i||(C.i={});var V=C.i[F];if(!V){var K=di(C,F,!1);V=[];for(var se=!!Array.isArray(K)&&!!(2&Ko(K)),te=0;te<K.length;te++)V[te]=new O(K[te]),se&&Mu(V[te].g);se&&(Mu(V),Object.freeze(V)),C.i[F]=V}return V}function Kr(C,O,F,V,K){var se=Ja(C,V,O);F=F||new V,C=di(C,O),null!=K?(se.splice(K,0,F),C.splice(K,0,nt(F))):(se.push(F),C.push(nt(F)))}function nt(C){if(C.i)for(var O in C.i){var F=C.i[O];if(Array.isArray(F))for(var V=0;V<F.length;V++)F[V]&&nt(F[V]);else F&&nt(F)}return C.g}function Un(C,O){return null==(C=Le(C,O))?0:C}function Be(C,O){return null==(C=Le(C,O))?"":C}function $o(C,O){if(C=C.m){Te(O,O.g.end());for(var F=0;F<C.length;F++)Te(O,C[F])}}function Ql(C){var O=C[0];switch(C.length){case 2:var F=C[1];return function(ge,Ne,st){return O(ge,Ne,st,F)};case 3:var V=C[1],K=C[2];return function(ge,Ne,st){return O(ge,Ne,st,V,K)};case 4:var se=C[1],te=C[2],ye=C[3];return function(ge,Ne,st){return O(ge,Ne,st,se,te,ye)};default:throw Error("unsupported number of parameters, expected [2-4], got "+C.length)}}function dr(C,O,F){for(;br(O)&&4!=O.h;){var V=O.i,K=F[V];if(K){if(Array.isArray(K)&&(K=F[V]=Ql(K)),!K(O,C,V)){K=C;var se=(V=O).l;qo(V),Bs(V,K,se)}}else K=C,se=(V=O).l,qo(V),Bs(V,K,se)}return C}function Lr(C,O){var F=new qn;if(O(C,F),0===(C=F.i+F.g.length()))F=new Uint8Array(0);else{C=new Uint8Array(C);for(var V=F.h,K=V.length,se=O=0;se<K;se++){var te=V[se];0!==te.length&&(C.set(te,O),O+=te.length)}0!==(K=(V=F.g).h)&&(C.set(V.g.subarray(0,K),O),V.h=0),F.h=[C],F=C}return F}function vc(C,O,F){if(Ka.length){var V=Ka.pop();C&&(Ue(V.g,C),V.i=-1,V.h=-1),C=V}else C=new uo(C);try{return F(new O,C)}finally{(O=C.g).h=null,O.l=0,O.i=0,O.g=0,O.j=!1,O.u=!1,C.i=-1,C.h=-1,C.j=!1,100>Ka.length&&Ka.push(C)}}function Qr(C,O,F){if(null!=(O=Le(O,F))){Ls(C.g,8*F+5),C=C.g;var V=O;0===(V=(F=0>V?1:0)?-V:V)?wn=0<1/V?0:2147483648:isNaN(V)?wn=2147483647:34028234663852886e22<V?wn=(F<<31|2139095040)>>>0:11754943508222875e-54>V?(V=Math.round(V/Math.pow(2,-149)),wn=(F<<31|V)>>>0):(O=Math.floor(Math.log(V)/Math.LN2),V*=Math.pow(2,-O),16777216<=(V=Math.round(8388608*V))&&++O,wn=(F<<31|O+127<<23|8388607&V)>>>0),Xn(C,(F=wn)>>>0&255),Xn(C,F>>>8&255),Xn(C,F>>>16&255),Xn(C,F>>>24&255)}}function Ri(C,O,F){if(5!==C.h)return!1;var V=(C=C.g).h[C.g],K=C.h[C.g+1],se=C.h[C.g+2],te=C.h[C.g+3];return C.g+=4,qr(C),C=2*((K=(V<<0|K<<8|se<<16|te<<24)>>>0)>>31)+1,V=K>>>23&255,K&=8388607,Zt(O,F,255==V?K?NaN:1/0*C:0==V?C*Math.pow(2,-149)*K:C*Math.pow(2,V-150)*(K+Math.pow(2,23))),!0}function fo(C,O,F){if(0!==C.h)return!1;for(var V=C.g,K=128,se=0,te=C=0;4>te&&128<=K;te++)se|=(127&(K=V.h[V.g++]))<<7*te;if(128<=K&&(se|=(127&(K=V.h[V.g++]))<<28,C|=(127&K)>>4),128<=K)for(te=0;5>te&&128<=K;te++)C|=(127&(K=V.h[V.g++]))<<7*te+3;return 128>K?(V=se>>>0,(C=2147483648&(K=C>>>0))&&(K=~K>>>0,0==(V=1+~V>>>0)&&(K=K+1>>>0)),V=4294967296*K+(V>>>0),C=C?-V:V):(V.j=!0,qi(),C=void 0),Zt(O,F,C),!0}function Wd(C,O,F){return 0===C.h&&(Zt(O,F,Oo(C.g)),!0)}function $l(C,O,F){if(2!==C.h)return!1;var se,V=Oo(C.g),K=(C=C.g).g;if(C.g+=V,qr(C),C=C.h,Pr)(se=Ya)||(se=Ya=new TextDecoder("utf-8",{fatal:!1})),se=se.decode(C.subarray(K,K+V));else{V=K+V;for(var ge,Ne,st,te=[],ye=null;K<V;)128>(ge=C[K++])?te.push(ge):224>ge?K>=V?te.push(65533):(Ne=C[K++],194>ge||128!=(192&Ne)?(K--,te.push(65533)):te.push((31&ge)<<6|63&Ne)):240>ge?K>=V-1?te.push(65533):128!=(192&(Ne=C[K++]))||224===ge&&160>Ne||237===ge&&160<=Ne||128!=(192&(se=C[K++]))?(K--,te.push(65533)):te.push((15&ge)<<12|(63&Ne)<<6|63&se):244>=ge?K>=V-2?te.push(65533):128!=(192&(Ne=C[K++]))||Ne-144+(ge<<28)>>30!=0||128!=(192&(se=C[K++]))||128!=(192&(st=C[K++]))?(K--,te.push(65533)):(ge=(7&ge)<<18|(63&Ne)<<12|(63&se)<<6|63&st,te.push(55296+((ge-=65536)>>10&1023),56320+(1023&ge))):te.push(65533),8192<=te.length&&(ye=so(ye,te),te.length=0);se=so(ye,te)}return Zt(O,F,se),!0}function Zl(C,O,F,V,K){if(2!==C.h)return!1;var se=new V,te=C.g.i,ye=Oo(C.g),ge=C.g.g+ye;if(C.g.i=ge,K(se,C),0!=(K=ge-C.g.g))throw Error("Message parsing ended unexpectedly. Expected to read "+ye+" bytes, instead read "+(ye-K)+" bytes, either the data ended unexpectedly or the message misreported its own length");return C.g.g=ge,C.g.i=te,Kr(O,F,se,V,void 0),!0}function Mi(C){Ar.call(this,C)}function Zo(C,O){var F=Le(C,1);if(null!=F&&null!=F){Ls(O.g,8);var V=O.g;if(0<=F)Ls(V,F);else{for(var K=0;9>K;K++)Xn(V,127&F|128),F>>=7;Xn(V,1)}}Qr(O,C,2),null!=(V=Le(C,3))&&Qa(O,3,Xa(V)),null!=(V=Le(C,4))&&Qa(O,4,Xa(V)),$o(C,O)}function Ou(C,O){return dr(C,O,yc||(yc={1:Wd,2:Ri,3:$l,4:$l}))}function be(C){Ar.call(this,C,-1,xa)}function dt(C,O){return dr(C,O,$r||($r={1:[Zl,Mi,Ou]}))}Ar.prototype.toJSON=function(){return Za(nt(this),$a)},Ar.prototype.toString=function(){return nt(this).toString()},Rs(Mi,Ar),Rs(be,Ar),be.prototype.addClassification=function(C,O){return Kr(this,1,C,Mi,O),this};var sn,hi,xa=[1];function Fu(C){Ar.call(this,C)}function Xe(C,O){Qr(O,C,1),Qr(O,C,2),Qr(O,C,3),Qr(O,C,4),Qr(O,C,5),$o(C,O)}function Wt(C,O){return dr(C,O,sn||(sn={1:Ri,2:Ri,3:Ri,4:Ri,5:Ri}))}function Qi(C){Ar.call(this,C,-1,Kn)}function eu(C,O){return dr(C,O,hi||(hi={1:[Zl,Fu,Wt]}))}Rs(Fu,Ar),Rs(Qi,Ar);var Pu,Kn=[1];function $i(C){Ar.call(this,C)}function Tn(C,O){Qr(O,C,1),Qr(O,C,2),Qr(O,C,3),Qr(O,C,4),Qr(O,C,5);var F=Le(C,6);if(null!=F&&null!=F){Ls(O.g,48);var V=O.g,K=F;F=0>K;var se=(K=Math.abs(K))>>>0;for(K=Math.floor((K-se)/4294967296),K>>>=0,F&&(K=~K>>>0,4294967295<(se=1+(~se>>>0))&&(se=0,4294967295<++K&&(K=0))),F=wn=se,se=K;0<se||127<F;)Xn(V,127&F|128),F=(F>>>7|se<<25)>>>0,se>>>=7;Xn(V,F)}$o(C,O)}function Vs(C,O){return dr(C,O,Pu||(Pu={1:Ri,2:Ri,3:Ri,4:Ri,5:Ri,6:fo}))}function ku(C,O,F){if(F=C.createShader(0===F?C.VERTEX_SHADER:C.FRAGMENT_SHADER),C.shaderSource(F,O),C.compileShader(F),!C.getShaderParameter(F,C.COMPILE_STATUS))throw Error("Could not compile WebGL shader.\n\n"+C.getShaderInfoLog(F));return F}function Jo(C){return Ja(C,Mi,1).map(function(O){return{index:Un(O,1),X:lo(O,2),label:null!=Le(O,3)?Be(O,3):void 0,displayName:null!=Le(O,4)?Be(O,4):void 0}})}function Oe(C){return{x:lo(C,1),y:lo(C,2),z:lo(C,3),visibility:null!=Le(C,4)?lo(C,4):void 0}}function Qn(C){return Ja(vc(C,Qi,eu),Fu,1).map(Oe)}function re(C,O){this.h=C,this.g=O,this.l=0}function j(C,O,F){return function(C,O){var F=C.g;if(void 0===C.m){var V=ku(F,"\n  attribute vec2 aVertex;\n  attribute vec2 aTex;\n  varying vec2 vTex;\n  void main(void) {\n    gl_Position = vec4(aVertex, 0.0, 1.0);\n    vTex = aTex;\n  }",0),K=ku(F,"\n  precision mediump float;\n  varying vec2 vTex;\n  uniform sampler2D sampler0;\n  void main(){\n    gl_FragColor = texture2D(sampler0, vTex);\n  }",1),se=F.createProgram();if(F.attachShader(se,V),F.attachShader(se,K),F.linkProgram(se),!F.getProgramParameter(se,F.LINK_STATUS))throw Error("Could not compile WebGL program.\n\n"+F.getProgramInfoLog(se));V=C.m=se,F.useProgram(V),K=F.getUniformLocation(V,"sampler0"),C.j={I:F.getAttribLocation(V,"aVertex"),H:F.getAttribLocation(V,"aTex"),da:K},C.s=F.createBuffer(),F.bindBuffer(F.ARRAY_BUFFER,C.s),F.enableVertexAttribArray(C.j.I),F.vertexAttribPointer(C.j.I,2,F.FLOAT,!1,0,0),F.bufferData(F.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),F.STATIC_DRAW),F.bindBuffer(F.ARRAY_BUFFER,null),C.o=F.createBuffer(),F.bindBuffer(F.ARRAY_BUFFER,C.o),F.enableVertexAttribArray(C.j.H),F.vertexAttribPointer(C.j.H,2,F.FLOAT,!1,0,0),F.bufferData(F.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),F.STATIC_DRAW),F.bindBuffer(F.ARRAY_BUFFER,null),F.uniform1i(K,0)}V=C.j,F.useProgram(C.m),F.canvas.width=O.width,F.canvas.height=O.height,F.viewport(0,0,O.width,O.height),F.activeTexture(F.TEXTURE0),C.h.bindTexture2d(O.glName),F.enableVertexAttribArray(V.I),F.bindBuffer(F.ARRAY_BUFFER,C.s),F.vertexAttribPointer(V.I,2,F.FLOAT,!1,0,0),F.enableVertexAttribArray(V.H),F.bindBuffer(F.ARRAY_BUFFER,C.o),F.vertexAttribPointer(V.H,2,F.FLOAT,!1,0,0),F.bindFramebuffer(F.DRAW_FRAMEBUFFER?F.DRAW_FRAMEBUFFER:F.FRAMEBUFFER,null),F.clearColor(0,0,0,0),F.clear(F.COLOR_BUFFER_BIT),F.colorMask(!0,!0,!0,!0),F.drawArrays(F.TRIANGLE_FAN,0,4),F.disableVertexAttribArray(V.I),F.disableVertexAttribArray(V.H),F.bindBuffer(F.ARRAY_BUFFER,null),C.h.bindTexture2d(0)}(C,O),"function"==typeof C.g.canvas.transferToImageBitmap?Promise.resolve(C.g.canvas.transferToImageBitmap()):F?Promise.resolve(C.g.canvas):"function"==typeof createImageBitmap?createImageBitmap(C.g.canvas):(void 0===C.i&&(C.i=document.createElement("canvas")),new Promise(function(V){C.i.height=C.g.canvas.height,C.i.width=C.g.canvas.width,C.i.getContext("2d",{}).drawImage(C.g.canvas,0,0,C.g.canvas.width,C.g.canvas.height),V(C.i)}))}function hr(C){this.g=C}Rs($i,Ar);var er=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function pi(C,O){return O+C}function Lu(C,O){window[C]=O}function tu(C){if(this.g=C,this.listeners={},this.j={},this.F={},this.m={},this.s={},this.G=this.o=this.R=!0,this.C=Promise.resolve(),this.P="",this.B={},this.locateFile=C&&C.locateFile||pi,"object"==typeof window)var O=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else{if("undefined"==typeof location)throw Error("solutions can only be loaded on a web page or in a web worker");O=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/"}if(this.S=O,C.options)for(var F=(O=Ir(Object.keys(C.options))).next();!F.done;F=O.next()){var V=C.options[F=F.value].default;void 0!==V&&(this.j[F]="function"==typeof V?V():V)}}function kt(C,O){var F,V;return vn(function(K){return O in C.F?K.return(C.F[O]):(F=C.locateFile(O,""),V=fetch(F).then(function(se){return se.arrayBuffer()}),C.F[O]=V,K.return(V))})}function Us(C,O){for(var F=O.name||"$",V=[].concat(xr(O.wants)),K=new C.h.StringList,se=Ir(O.wants),te=se.next();!te.done;te=se.next())K.push_back(te.value);se=C.h.PacketListener.implement({onResults:function(ye){for(var ge={},Ne=0;Ne<O.wants.length;++Ne)ge[V[Ne]]=ye.get(Ne);var st=C.listeners[F];st&&(C.C=function(C,O,F){var V,K,se,te,ge,Ne,st,vt,ct,ze,Je,St;return vn(function(Et){switch(Et.g){case 1:if(!F)return Et.return(O);for(V={},K=0,se=Ir(Object.keys(F)),te=se.next();!te.done;te=se.next())"string"!=typeof(ge=F[te.value])&&"texture"===ge.type&&void 0!==O[ge.stream]&&++K;1<K&&(C.G=!1),Ne=Ir(Object.keys(F)),te=Ne.next();case 2:if(te.done){Et.g=4;break}if("string"==typeof(vt=F[st=te.value]))return Je=V,St=st,gt(Et,function(C,O,F){var V;return vn(function(K){return"number"==typeof F||F instanceof Uint8Array||F instanceof C.h.Uint8BlobList?K.return(F):F instanceof C.h.Texture2dDataOut?((V=C.s[O])||(V=new re(C.h,C.D),C.s[O]=V),K.return(j(V,F,C.G))):K.return(void 0)})}(C,st,O[vt]),14);if(ct=O[vt.stream],"detection_list"===vt.type){if(ct){for(var Sn=ct.getRectList(),pr=ct.getLandmarksList(),_n=ct.getClassificationsList(),Jt=[],Qe=0;Qe<Sn.size();++Qe){var Se=vc(Sn.get(Qe),$i,Vs);Se={T:{Y:lo(Se,1),Z:lo(Se,2),height:lo(Se,3),width:lo(Se,4),rotation:lo(Se,5,0),W:Un(Se,6)},O:Qn(pr.get(Qe)),M:Jo(vc(_n.get(Qe),be,dt))},Jt.push(Se)}Sn=Jt}else Sn=[];V[st]=Sn,Et.g=7;break}if("proto_list"===vt.type){if(ct){for(Sn=Array(ct.size()),pr=0;pr<ct.size();pr++)Sn[pr]=ct.get(pr);ct.delete()}else Sn=[];V[st]=Sn,Et.g=7;break}if(void 0===ct){Et.g=3;break}if("float_list"===vt.type){V[st]=ct,Et.g=7;break}if("proto"===vt.type){V[st]=ct,Et.g=7;break}if("texture"!==vt.type)throw Error("Unknown output config type: '"+vt.type+"'");return(ze=C.s[st])||(ze=new re(C.h,C.D),C.s[st]=ze),gt(Et,j(ze,ct,C.G),13);case 13:V[st]=Et.h;case 7:vt.transform&&V[st]&&(V[st]=vt.transform(V[st])),Et.g=3;break;case 14:Je[St]=Et.h;case 3:te=Ne.next(),Et.g=2;break;case 4:return Et.return(V)}})}(C,ge,O.outs).then(function(vt){vt=st(vt);for(var ct=0;ct<O.wants.length;++ct){var ze=ge[V[ct]];"object"==typeof ze&&ze.hasOwnProperty&&ze.hasOwnProperty("delete")&&ze.delete()}vt&&(C.C=vt)}))}}),C.i.attachMultiListener(K,se),K.delete()}function qt(C){switch(void 0===C&&(C=0),C){case 1:return"pose_landmark_full.tflite";case 2:return"pose_landmark_heavy.tflite";default:return"pose_landmark_lite.tflite"}}function mi(C){var O=this;this.g=new tu({locateFile:(C=C||{}).locateFile,files:function(F){return[{url:"pose_solution_packed_assets_loader.js"},{simd:!1,url:"pose_solution_wasm_bin.js"},{simd:!0,url:"pose_solution_simd_wasm_bin.js"},{data:!0,url:qt(F.modelComplexity)}]},graph:{url:"pose_web.binarypb"},listeners:[{wants:["pose_landmarks","world_landmarks","segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},poseLandmarks:{type:"proto",stream:"pose_landmarks",transform:Qn},poseWorldLandmarks:{type:"proto",stream:"world_landmarks",transform:Qn},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelComplexity:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelComplexity",fieldName:"int_value"},onChange:function(F){var V,K;return vn(function(te){return 1==te.g?(V=qt(F),K="third_party/mediapipe/modules/pose_landmark/"+V,gt(te,kt(O.g,V),2)):(O.g.overrideFile(K,te.h),te.return(!0))})}},smoothLandmarks:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothLandmarks",fieldName:"bool_value"}},enableSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorEnableSegmentation",fieldName:"bool_value"}},smoothSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothSegmentation",fieldName:"bool_value"}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"poselandmarkgpu__posedetectiongpu__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"poselandmarkgpu__poselandmarkbyroigpu__tensorstoposelandmarksandsegmentation__ThresholdingCalculator",fieldName:"threshold"}}}})}(Zn=tu.prototype).close=function(){return this.i&&this.i.delete(),Promise.resolve()},Zn.reset=function(){var C=this;return vn(function(O){C.i&&(C.i.reset(),C.m={},C.s={}),O.g=0})},Zn.setOptions=function(C,O){var F=this;if(O=O||this.g.options){for(var V=[],K=[],se={},te=Ir(Object.keys(C)),ye=te.next();!ye.done;se={K:se.K,L:se.L},ye=te.next()){var ge=ye.value;ge in this.j&&this.j[ge]===C[ge]||(this.j[ge]=C[ge],void 0!==(ye=O[ge])&&(ye.onChange&&(se.K=ye.onChange,se.L=C[ge],V.push(function(Ne){return function(){return vn(function(vt){if(1==vt.g)return gt(vt,Ne.K(Ne.L),2);!0===vt.h&&(F.o=!0),vt.g=0})}}(se))),ye.graphOptionXref&&(ge={valueNumber:1===ye.type?C[ge]:0,valueBoolean:0===ye.type&&C[ge],valueString:2===ye.type?C[ge]:""},ye=Object.assign(Object.assign(Object.assign({},{calculatorName:"",calculatorIndex:0}),ye.graphOptionXref),ge),K.push(ye))))}(0!==V.length||0!==K.length)&&(this.o=!0,this.A=(void 0===this.A?[]:this.A).concat(K),this.v=(void 0===this.v?[]:this.v).concat(V))}},Zn.initialize=function(){var C=this;return vn(function(O){return 1==O.g?gt(O,function(C){var O,F,V,K,se,te,ye,ge,Ne,st,vt;return vn(function(ct){switch(ct.g){case 1:return C.R?(O=void 0===C.g.files?[]:"function"==typeof C.g.files?C.g.files(C.j):C.g.files,gt(ct,vn(function(C){switch(C.g){case 1:return C.m=2,gt(C,WebAssembly.instantiate(er),4);case 4:C.g=3,C.m=0;break;case 2:return C.m=0,C.j=null,C.return(!1);case 3:return C.return(!0)}}),2)):ct.return();case 2:if(F=ct.h,"object"==typeof window)return Lu("createMediapipeSolutionsWasm",{locateFile:C.locateFile}),Lu("createMediapipeSolutionsPackedAssets",{locateFile:C.locateFile}),te=O.filter(function(ze){return void 0!==ze.data}),ye=O.filter(function(ze){return void 0===ze.data}),ge=Promise.all(te.map(function(ze){var yt=kt(C,ze.url);if(void 0!==ze.path){var Je=ze.path;yt=yt.then(function(St){return C.overrideFile(Je,St),Promise.resolve(St)})}return yt})),Ne=Promise.all(ye.map(function(ze){return void 0===ze.simd||ze.simd&&F||!ze.simd&&!F?function(C){var O=document.createElement("script");return O.setAttribute("src",C),O.setAttribute("crossorigin","anonymous"),new Promise(function(F){O.addEventListener("load",function(){F()},!1),O.addEventListener("error",function(){F()},!1),document.body.appendChild(O)})}(C.locateFile(ze.url,C.S)):Promise.resolve()})).then(function(){var ze,yt,Je;return vn(function(St){if(1==St.g)return ze=window.createMediapipeSolutionsWasm,yt=window.createMediapipeSolutionsPackedAssets,Je=C,gt(St,ze(yt),2);Je.h=St.h,St.g=0})}),st=vn(function(ze){return C.g.graph&&C.g.graph.url?ze=gt(ze,kt(C,C.g.graph.url),0):(ze.g=0,ze=void 0),ze}),gt(ct,Promise.all([Ne,ge,st]),7);if("function"!=typeof importScripts)throw Error("solutions can only be loaded on a web page or in a web worker");return V=O.filter(function(ze){return void 0===ze.simd||ze.simd&&F||!ze.simd&&!F}).map(function(ze){return C.locateFile(ze.url,C.S)}),importScripts.apply(null,xr(V)),K=C,gt(ct,createMediapipeSolutionsWasm(Module),6);case 6:K.h=ct.h,C.l=new OffscreenCanvas(1,1),C.h.canvas=C.l,se=C.h.GL.createContext(C.l,{antialias:!1,alpha:!1,ba:"undefined"!=typeof WebGL2RenderingContext?2:1}),C.h.GL.makeContextCurrent(se),ct.g=4;break;case 7:if(C.l=document.createElement("canvas"),!(vt=C.l.getContext("webgl2",{}))&&!(vt=C.l.getContext("webgl",{})))return alert("Failed to create WebGL canvas context when passing video frame."),ct.return();C.D=vt,C.h.canvas=C.l,C.h.createContext(C.l,!0,!0,{});case 4:C.i=new C.h.SolutionWasm,C.R=!1,ct.g=0}})}(C),2):3!=O.g?gt(O,function(C){var F,V,K,se,te,ge;return vn(function(Ne){if(1==Ne.g)return C.g.graph&&C.g.graph.url&&C.P===C.g.graph.url?Ne.return():(C.o=!0,C.g.graph&&C.g.graph.url?(C.P=C.g.graph.url,gt(Ne,kt(C,C.g.graph.url),3)):void(Ne.g=2));for(2!=Ne.g&&C.i.loadGraph(Ne.h),F=Ir(Object.keys(C.B)),V=F.next();!V.done;V=F.next())C.i.overrideFile(K=V.value,C.B[K]);if(C.B={},C.g.listeners)for(se=Ir(C.g.listeners),te=se.next();!te.done;te=se.next())Us(C,te.value);ge=C.j,C.j={},C.setOptions(ge),Ne.g=0})}(C),3):gt(O,function(C){var O,F,K,se,te;return vn(function(ge){switch(ge.g){case 1:if(!C.o)return ge.return();if(!C.v){ge.g=2;break}O=Ir(C.v),F=O.next();case 3:if(F.done){ge.g=5;break}return gt(ge,(0,F.value)(),4);case 4:F=O.next(),ge.g=3;break;case 5:C.v=void 0;case 2:if(C.A){for(K=new C.h.GraphOptionChangeRequestList,se=Ir(C.A),te=se.next();!te.done;te=se.next())K.push_back(te.value);C.i.changeOptions(K),K.delete(),C.A=void 0}C.o=!1,ge.g=0}})}(C),0)})},Zn.overrideFile=function(C,O){this.i?this.i.overrideFile(C,O):this.B[C]=O},Zn.clearOverriddenFiles=function(){this.B={},this.i&&this.i.clearOverriddenFiles()},Zn.send=function(C,O){var V,K,se,te,ye,ge,Ne,st,vt,F=this;return vn(function(ct){switch(ct.g){case 1:return F.g.inputs?(V=1e3*(null==O?performance.now():O),gt(ct,F.C,2)):ct.return();case 2:return gt(ct,F.initialize(),3);case 3:for(K=new F.h.PacketDataList,se=Ir(Object.keys(C)),te=se.next();!te.done;te=se.next())if(ge=F.g.inputs[ye=te.value]){e:{var ze=C[ye];switch(ge.type){case"video":var yt=F.m[ge.stream];if(yt||(yt=new re(F.h,F.D),F.m[ge.stream]=yt),0===yt.l&&(yt.l=yt.h.createTexture()),"undefined"!=typeof HTMLVideoElement&&ze instanceof HTMLVideoElement)var Je=ze.videoWidth,St=ze.videoHeight;else"undefined"!=typeof HTMLImageElement&&ze instanceof HTMLImageElement?(Je=ze.naturalWidth,St=ze.naturalHeight):(Je=ze.width,St=ze.height);St={glName:yt.l,width:Je,height:St},(Je=yt.g).canvas.width=St.width,Je.canvas.height=St.height,Je.activeTexture(Je.TEXTURE0),yt.h.bindTexture2d(yt.l),Je.texImage2D(Je.TEXTURE_2D,0,Je.RGBA,Je.RGBA,Je.UNSIGNED_BYTE,ze),yt.h.bindTexture2d(0),yt=St;break e;case"detections":for((yt=F.m[ge.stream])||(yt=new hr(F.h),F.m[ge.stream]=yt),yt.data||(yt.data=new yt.g.DetectionListData),yt.data.reset(ze.length),St=0;St<ze.length;++St){var Et=yt.data,Sn=Et.setBoundingBox,pr=St,_n=(Je=ze[St]).T,Jt=new $i;if(Zt(Jt,1,_n.Y),Zt(Jt,2,_n.Z),Zt(Jt,3,_n.height),Zt(Jt,4,_n.width),Zt(Jt,5,_n.rotation),Zt(Jt,6,_n.W),_n=Lr(Jt,Tn),Sn.call(Et,pr,_n),Je.O)for(Et=0;Et<Je.O.length;++Et){var Qe=!!(Jt=Je.O[Et]).visibility;pr=(Sn=yt.data).addNormalizedLandmark,_n=St,Jt=Object.assign(Object.assign({},Jt),{visibility:Qe?Jt.visibility:0}),Zt(Qe=new Fu,1,Jt.x),Zt(Qe,2,Jt.y),Zt(Qe,3,Jt.z),Jt.visibility&&Zt(Qe,4,Jt.visibility),Jt=Lr(Qe,Xe),pr.call(Sn,_n,Jt)}if(Je.M)for(Et=0;Et<Je.M.length;++Et)pr=(Sn=yt.data).addClassification,_n=St,Jt=Je.M[Et],Zt(Qe=new Mi,2,Jt.X),Jt.index&&Zt(Qe,1,Jt.index),Jt.label&&Zt(Qe,3,Jt.label),Jt.displayName&&Zt(Qe,4,Jt.displayName),Jt=Lr(Qe,Zo),pr.call(Sn,_n,Jt)}yt=yt.data;break e;default:yt={}}}switch(Ne=yt,st=ge.stream,ge.type){case"video":K.pushTexture2d(Object.assign(Object.assign({},Ne),{stream:st,timestamp:V}));break;case"detections":(vt=Ne).stream=st,vt.timestamp=V,K.pushDetectionList(vt);break;default:throw Error("Unknown input config type: '"+ge.type+"'")}}return F.i.send(K),gt(ct,F.C,4);case 4:K.delete(),ct.g=0}})},Zn.onResults=function(C,O){this.listeners[O||"$"]=C},ce("Solution",tu),ce("OptionType",{BOOL:0,NUMBER:1,$:2,0:"BOOL",1:"NUMBER",2:"STRING"}),(Zn=mi.prototype).reset=function(){this.g.reset()},Zn.close=function(){return this.g.close(),Promise.resolve()},Zn.onResults=function(C){this.g.onResults(C)},Zn.initialize=function(){var C=this;return vn(function(O){return gt(O,C.g.initialize(),0)})},Zn.send=function(C,O){var F=this;return vn(function(V){return gt(V,F.g.send(C,O),0)})},Zn.setOptions=function(C){this.g.setOptions(C)},ce("Pose",mi),ce("POSE_CONNECTIONS",[[0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]]),ce("POSE_LANDMARKS",{NOSE:0,LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,LEFT_EAR:7,RIGHT_EAR:8,LEFT_RIGHT:9,RIGHT_LEFT:10,LEFT_SHOULDER:11,RIGHT_SHOULDER:12,LEFT_ELBOW:13,RIGHT_ELBOW:14,LEFT_WRIST:15,RIGHT_WRIST:16,LEFT_PINKY:17,RIGHT_PINKY:18,LEFT_INDEX:19,RIGHT_INDEX:20,LEFT_THUMB:21,RIGHT_THUMB:22,LEFT_HIP:23,RIGHT_HIP:24,LEFT_KNEE:25,RIGHT_KNEE:26,LEFT_ANKLE:27,RIGHT_ANKLE:28,LEFT_HEEL:29,RIGHT_HEEL:30,LEFT_FOOT_INDEX:31,RIGHT_FOOT_INDEX:32}),ce("POSE_LANDMARKS_LEFT",{LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,LEFT_EAR:7,LEFT_RIGHT:9,LEFT_SHOULDER:11,LEFT_ELBOW:13,LEFT_WRIST:15,LEFT_PINKY:17,LEFT_INDEX:19,LEFT_THUMB:21,LEFT_HIP:23,LEFT_KNEE:25,LEFT_ANKLE:27,LEFT_HEEL:29,LEFT_FOOT_INDEX:31}),ce("POSE_LANDMARKS_RIGHT",{RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,RIGHT_EAR:8,RIGHT_LEFT:10,RIGHT_SHOULDER:12,RIGHT_ELBOW:14,RIGHT_WRIST:16,RIGHT_PINKY:18,RIGHT_INDEX:20,RIGHT_THUMB:22,RIGHT_HIP:24,RIGHT_KNEE:26,RIGHT_ANKLE:28,RIGHT_HEEL:30,RIGHT_FOOT_INDEX:32}),ce("POSE_LANDMARKS_NEUTRAL",{NOSE:0}),ce("VERSION","0.5.1635988162")}).call(this)},65:function(Zn,oo){!function(ve){"use strict";var Yi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,u){D.__proto__=u}||function(D,u){for(var l in u)u.hasOwnProperty(l)&&(D[l]=u[l])};var Ir=function(D){function u(l){var d=this.constructor,h=D.call(this,l)||this;return Object.defineProperty(h,"name",{value:d.name,enumerable:!1}),function(D,u){var l=Object.setPrototypeOf;l?l(D,u):D.__proto__=u}(h,d.prototype),function(D,u){void 0===u&&(u=D.constructor);var l=Error.captureStackTrace;l&&l(D,u)}(h),h}return function(D,u){function l(){this.constructor=D}Yi(D,u),D.prototype=null===u?Object.create(u):(l.prototype=u.prototype,new l)}(u,D),u}(Error);let xr=(()=>{class D extends Ir{constructor(l){super(l),this.message=l}getKind(){return this.constructor.kind}}return D.kind="Exception",D})(),oi=(()=>{class D extends xr{}return D.kind="ArgumentException",D})(),Ye=(()=>{class D extends xr{}return D.kind="IllegalArgumentException",D})();class Si{constructor(u){if(this.binarizer=u,null===u)throw new Ye("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(u,l){return this.binarizer.getBlackRow(u,l)}getBlackMatrix(){return null==this.matrix&&(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(u,l,d,h){const g=this.binarizer.getLuminanceSource().crop(u,l,d,h);return new Si(this.binarizer.createBinarizer(g))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const u=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new Si(this.binarizer.createBinarizer(u))}rotateCounterClockwise45(){const u=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new Si(this.binarizer.createBinarizer(u))}toString(){try{return this.getBlackMatrix().toString()}catch(u){return""}}}let Dt=(()=>{class D extends xr{static getChecksumInstance(){return new D}}return D.kind="ChecksumException",D})();class Ga{constructor(u){this.source=u}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class en{static arraycopy(u,l,d,h,g){for(;g--;)d[h++]=u[l++]}static currentTimeMillis(){return Date.now()}}let Rs=(()=>{class D extends xr{}return D.kind="IndexOutOfBoundsException",D})(),wr=(()=>{class D extends Rs{constructor(l,d){super(d),this.index=l,this.message=d}}return D.kind="ArrayIndexOutOfBoundsException",D})();class Vn{static fill(u,l){for(let d=0,h=u.length;d<h;d++)u[d]=l}static fillWithin(u,l,d,h){Vn.rangeCheck(u.length,l,d);for(let g=l;g<d;g++)u[g]=h}static rangeCheck(u,l,d){if(l>d)throw new Ye("fromIndex("+l+") > toIndex("+d+")");if(l<0)throw new wr(l);if(d>u)throw new wr(d)}static asList(...u){return u}static create(u,l,d){return Array.from({length:u}).map(g=>Array.from({length:l}).fill(d))}static createInt32Array(u,l,d){return Array.from({length:u}).map(g=>Int32Array.from({length:l}).fill(d))}static equals(u,l){if(!(u&&l&&u.length&&l.length&&u.length===l.length))return!1;for(let d=0,h=u.length;d<h;d++)if(u[d]!==l[d])return!1;return!0}static hashCode(u){if(null===u)return 0;let l=1;for(const d of u)l=31*l+d;return l}static fillUint8Array(u,l){for(let d=0;d!==u.length;d++)u[d]=l}static copyOf(u,l){return u.slice(0,l)}static copyOfUint8Array(u,l){if(u.length<=l){const d=new Uint8Array(l);return d.set(u),d}return u.slice(0,l)}static copyOfRange(u,l,d){const h=d-l,g=new Int32Array(h);return en.arraycopy(u,l,g,0,h),g}static binarySearch(u,l,d){void 0===d&&(d=Vn.numberComparator);let h=0,g=u.length-1;for(;h<=g;){const v=g+h>>1,x=d(l,u[v]);if(x>0)h=v+1;else{if(!(x<0))return v;g=v-1}}return-h-1}static numberComparator(u,l){return u-l}}class Ct{static numberOfTrailingZeros(u){let l;if(0===u)return 32;let d=31;return l=u<<16,0!==l&&(d-=16,u=l),l=u<<8,0!==l&&(d-=8,u=l),l=u<<4,0!==l&&(d-=4,u=l),l=u<<2,0!==l&&(d-=2,u=l),d-(u<<1>>>31)}static numberOfLeadingZeros(u){if(0===u)return 32;let l=1;return u>>>16==0&&(l+=16,u<<=16),u>>>24==0&&(l+=8,u<<=8),u>>>28==0&&(l+=4,u<<=4),u>>>30==0&&(l+=2,u<<=2),l-=u>>>31,l}static toHexString(u){return u.toString(16)}static toBinaryString(u){return String(parseInt(String(u),2))}static bitCount(u){return u=(u=(858993459&(u-=u>>>1&1431655765))+(u>>>2&858993459))+(u>>>4)&252645135,63&(u+=u>>>8)+(u>>>16)}static truncDivision(u,l){return Math.trunc(u/l)}static parseInt(u,l){return parseInt(u,l)}}Ct.MIN_VALUE_32_BITS=-2147483648,Ct.MAX_VALUE=Number.MAX_SAFE_INTEGER;class gt{constructor(u,l){void 0===u?(this.size=0,this.bits=new Int32Array(1)):(this.size=u,this.bits=null==l?gt.makeArray(u):l)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(u){if(u>32*this.bits.length){const l=gt.makeArray(u);en.arraycopy(this.bits,0,l,0,this.bits.length),this.bits=l}}get(u){return 0!=(this.bits[Math.floor(u/32)]&1<<(31&u))}set(u){this.bits[Math.floor(u/32)]|=1<<(31&u)}flip(u){this.bits[Math.floor(u/32)]^=1<<(31&u)}getNextSet(u){const l=this.size;if(u>=l)return l;const d=this.bits;let h=Math.floor(u/32),g=d[h];g&=~((1<<(31&u))-1);const v=d.length;for(;0===g;){if(++h===v)return l;g=d[h]}const x=32*h+Ct.numberOfTrailingZeros(g);return x>l?l:x}getNextUnset(u){const l=this.size;if(u>=l)return l;const d=this.bits;let h=Math.floor(u/32),g=~d[h];g&=~((1<<(31&u))-1);const v=d.length;for(;0===g;){if(++h===v)return l;g=~d[h]}const x=32*h+Ct.numberOfTrailingZeros(g);return x>l?l:x}setBulk(u,l){this.bits[Math.floor(u/32)]=l}setRange(u,l){if(l<u||u<0||l>this.size)throw new Ye;if(l===u)return;l--;const d=Math.floor(u/32),h=Math.floor(l/32),g=this.bits;for(let v=d;v<=h;v++)g[v]|=(2<<(v<h?31:31&l))-(1<<(v>d?0:31&u))}clear(){const u=this.bits.length,l=this.bits;for(let d=0;d<u;d++)l[d]=0}isRange(u,l,d){if(l<u||u<0||l>this.size)throw new Ye;if(l===u)return!0;l--;const h=Math.floor(u/32),g=Math.floor(l/32),v=this.bits;for(let x=h;x<=g;x++){const S=(2<<(x<g?31:31&l))-(1<<(x>h?0:31&u))&4294967295;if((v[x]&S)!==(d?S:0))return!1}return!0}appendBit(u){this.ensureCapacity(this.size+1),u&&(this.bits[Math.floor(this.size/32)]|=1<<(31&this.size)),this.size++}appendBits(u,l){if(l<0||l>32)throw new Ye("Num bits must be between 0 and 32");this.ensureCapacity(this.size+l);for(let d=l;d>0;d--)this.appendBit(1==(u>>d-1&1))}appendBitArray(u){const l=u.size;this.ensureCapacity(this.size+l);for(let d=0;d<l;d++)this.appendBit(u.get(d))}xor(u){if(this.size!==u.size)throw new Ye("Sizes don't match");const l=this.bits;for(let d=0,h=l.length;d<h;d++)l[d]^=u.bits[d]}toBytes(u,l,d,h){for(let g=0;g<h;g++){let v=0;for(let x=0;x<8;x++)this.get(u)&&(v|=1<<7-x),u++;l[d+g]=v}}getBitArray(){return this.bits}reverse(){const u=new Int32Array(this.bits.length),l=Math.floor((this.size-1)/32),d=l+1,h=this.bits;for(let g=0;g<d;g++){let v=h[g];v=v>>1&1431655765|(1431655765&v)<<1,v=v>>2&858993459|(858993459&v)<<2,v=v>>4&252645135|(252645135&v)<<4,v=v>>8&16711935|(16711935&v)<<8,v=v>>16&65535|(65535&v)<<16,u[l-g]=v}if(this.size!==32*d){const g=32*d-this.size;let v=u[0]>>>g;for(let x=1;x<d;x++){const b=u[x];v|=b<<32-g,u[x-1]=v,v=b>>>g}u[d-1]=v}this.bits=u}static makeArray(u){return new Int32Array(Math.floor((u+31)/32))}equals(u){return u instanceof gt&&this.size===u.size&&Vn.equals(this.bits,u.bits)}hashCode(){return 31*this.size+Vn.hashCode(this.bits)}toString(){let u="";for(let l=0,d=this.size;l<d;l++)0==(7&l)&&(u+=" "),u+=this.get(l)?"X":".";return u}clone(){return new gt(this.size,this.bits.slice())}}var So=(()=>{return(D=So||(So={}))[D.OTHER=0]="OTHER",D[D.PURE_BARCODE=1]="PURE_BARCODE",D[D.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",D[D.TRY_HARDER=3]="TRY_HARDER",D[D.CHARACTER_SET=4]="CHARACTER_SET",D[D.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",D[D.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",D[D.ASSUME_GS1=7]="ASSUME_GS1",D[D.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",D[D.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",D[D.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS",So;var D})(),En=So;let Re=(()=>{class D extends xr{static getFormatInstance(){return new D}}return D.kind="FormatException",D})();var Bt=(()=>{return(D=Bt||(Bt={}))[D.Cp437=0]="Cp437",D[D.ISO8859_1=1]="ISO8859_1",D[D.ISO8859_2=2]="ISO8859_2",D[D.ISO8859_3=3]="ISO8859_3",D[D.ISO8859_4=4]="ISO8859_4",D[D.ISO8859_5=5]="ISO8859_5",D[D.ISO8859_6=6]="ISO8859_6",D[D.ISO8859_7=7]="ISO8859_7",D[D.ISO8859_8=8]="ISO8859_8",D[D.ISO8859_9=9]="ISO8859_9",D[D.ISO8859_10=10]="ISO8859_10",D[D.ISO8859_11=11]="ISO8859_11",D[D.ISO8859_13=12]="ISO8859_13",D[D.ISO8859_14=13]="ISO8859_14",D[D.ISO8859_15=14]="ISO8859_15",D[D.ISO8859_16=15]="ISO8859_16",D[D.SJIS=16]="SJIS",D[D.Cp1250=17]="Cp1250",D[D.Cp1251=18]="Cp1251",D[D.Cp1252=19]="Cp1252",D[D.Cp1256=20]="Cp1256",D[D.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",D[D.UTF8=22]="UTF8",D[D.ASCII=23]="ASCII",D[D.Big5=24]="Big5",D[D.GB18030=25]="GB18030",D[D.EUC_KR=26]="EUC_KR",Bt;var D})();class Ee{constructor(u,l,d,...h){this.valueIdentifier=u,this.name=d,this.values="number"==typeof l?Int32Array.from([l]):l,this.otherEncodingNames=h,Ee.VALUE_IDENTIFIER_TO_ECI.set(u,this),Ee.NAME_TO_ECI.set(d,this);const g=this.values;for(let v=0,x=g.length;v!==x;v++)Ee.VALUES_TO_ECI.set(g[v],this);for(const v of h)Ee.NAME_TO_ECI.set(v,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(u){if(u<0||u>=900)throw new Re("incorect value");const l=Ee.VALUES_TO_ECI.get(u);if(void 0===l)throw new Re("incorect value");return l}static getCharacterSetECIByName(u){const l=Ee.NAME_TO_ECI.get(u);if(void 0===l)throw new Re("incorect value");return l}equals(u){if(!(u instanceof Ee))return!1;const l=u;return this.getName()===l.getName()}}Ee.VALUE_IDENTIFIER_TO_ECI=new Map,Ee.VALUES_TO_ECI=new Map,Ee.NAME_TO_ECI=new Map,Ee.Cp437=new Ee(Bt.Cp437,Int32Array.from([0,2]),"Cp437"),Ee.ISO8859_1=new Ee(Bt.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),Ee.ISO8859_2=new Ee(Bt.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),Ee.ISO8859_3=new Ee(Bt.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),Ee.ISO8859_4=new Ee(Bt.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),Ee.ISO8859_5=new Ee(Bt.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),Ee.ISO8859_6=new Ee(Bt.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),Ee.ISO8859_7=new Ee(Bt.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),Ee.ISO8859_8=new Ee(Bt.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),Ee.ISO8859_9=new Ee(Bt.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),Ee.ISO8859_10=new Ee(Bt.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),Ee.ISO8859_11=new Ee(Bt.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),Ee.ISO8859_13=new Ee(Bt.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),Ee.ISO8859_14=new Ee(Bt.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),Ee.ISO8859_15=new Ee(Bt.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),Ee.ISO8859_16=new Ee(Bt.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),Ee.SJIS=new Ee(Bt.SJIS,20,"SJIS","Shift_JIS"),Ee.Cp1250=new Ee(Bt.Cp1250,21,"Cp1250","windows-1250"),Ee.Cp1251=new Ee(Bt.Cp1251,22,"Cp1251","windows-1251"),Ee.Cp1252=new Ee(Bt.Cp1252,23,"Cp1252","windows-1252"),Ee.Cp1256=new Ee(Bt.Cp1256,24,"Cp1256","windows-1256"),Ee.UnicodeBigUnmarked=new Ee(Bt.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),Ee.UTF8=new Ee(Bt.UTF8,26,"UTF8","UTF-8"),Ee.ASCII=new Ee(Bt.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),Ee.Big5=new Ee(Bt.Big5,28,"Big5"),Ee.GB18030=new Ee(Bt.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),Ee.EUC_KR=new Ee(Bt.EUC_KR,30,"EUC_KR","EUC-KR");let Ms=(()=>{class D extends xr{}return D.kind="UnsupportedOperationException",D})();class vn{static decode(u,l){const d=this.encodingName(l);return this.customDecoder?this.customDecoder(u,d):"undefined"==typeof TextDecoder||this.shouldDecodeOnFallback(d)?this.decodeFallback(u,d):new TextDecoder(d).decode(u)}static shouldDecodeOnFallback(u){return!vn.isBrowser()&&"ISO-8859-1"===u}static encode(u,l){const d=this.encodingName(l);return this.customEncoder?this.customEncoder(u,d):"undefined"==typeof TextEncoder?this.encodeFallback(u):(new TextEncoder).encode(u)}static isBrowser(){return"undefined"!=typeof window&&"[object Window]"==={}.toString.call(window)}static encodingName(u){return"string"==typeof u?u:u.getName()}static encodingCharacterSet(u){return u instanceof Ee?u:Ee.getCharacterSetECIByName(u)}static decodeFallback(u,l){const d=this.encodingCharacterSet(l);if(vn.isDecodeFallbackSupported(d)){let h="";for(let g=0,v=u.length;g<v;g++){let x=u[g].toString(16);x.length<2&&(x="0"+x),h+="%"+x}return decodeURIComponent(h)}if(d.equals(Ee.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(u.buffer));throw new Ms(`Encoding ${this.encodingName(l)} not supported by fallback.`)}static isDecodeFallbackSupported(u){return u.equals(Ee.UTF8)||u.equals(Ee.ISO8859_1)||u.equals(Ee.ASCII)}static encodeFallback(u){const d=btoa(unescape(encodeURIComponent(u))).split(""),h=[];for(let g=0;g<d.length;g++)h.push(d[g].charCodeAt(0));return new Uint8Array(h)}}class at{static castAsNonUtf8Char(u,l=null){const d=l?l.getName():this.ISO88591;return vn.decode(new Uint8Array([u]),d)}static guessEncoding(u,l){if(null!=l&&void 0!==l.get(En.CHARACTER_SET))return l.get(En.CHARACTER_SET).toString();const d=u.length;let h=!0,g=!0,v=!0,x=0,b=0,I=0,S=0,k=0,L=0,W=0,q=0,Z=0,ne=0,ie=0;const Ae=u.length>3&&239===u[0]&&187===u[1]&&191===u[2];for(let Me=0;Me<d&&(h||g||v);Me++){const de=255&u[Me];v&&(x>0?0==(128&de)?v=!1:x--:0!=(128&de)&&(0==(64&de)?v=!1:(x++,0==(32&de)?b++:(x++,0==(16&de)?I++:(x++,0==(8&de)?S++:v=!1))))),h&&(de>127&&de<160?h=!1:de>159&&(de<192||215===de||247===de)&&ie++),g&&(k>0?de<64||127===de||de>252?g=!1:k--:128===de||160===de||de>239?g=!1:de>160&&de<224?(L++,q=0,W++,W>Z&&(Z=W)):de>127?(k++,W=0,q++,q>ne&&(ne=q)):(W=0,q=0))}return v&&x>0&&(v=!1),g&&k>0&&(g=!1),v&&(Ae||b+I+S>0)?at.UTF8:g&&(at.ASSUME_SHIFT_JIS||Z>=3||ne>=3)?at.SHIFT_JIS:h&&g?2===Z&&2===L||10*ie>=d?at.SHIFT_JIS:at.ISO88591:h?at.ISO88591:g?at.SHIFT_JIS:v?at.UTF8:at.PLATFORM_DEFAULT_ENCODING}static format(u,...l){let d=-1;return u.replace(/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g,function(v,x,b,I,S,k){if("%%"===v)return"%";if(void 0===l[++d])return;v=I?parseInt(I.substr(1)):void 0;let W,L=S?parseInt(S.substr(1)):void 0;switch(k){case"s":W=l[d];break;case"c":W=l[d][0];break;case"f":W=parseFloat(l[d]).toFixed(v);break;case"p":W=parseFloat(l[d]).toPrecision(v);break;case"e":W=parseFloat(l[d]).toExponential(v);break;case"x":W=parseInt(l[d]).toString(L||16);break;case"d":W=parseFloat(parseInt(l[d],L||10).toPrecision(v)).toFixed(0)}W="object"==typeof W?JSON.stringify(W):(+W).toString(L);let q=parseInt(b),Z=b&&b[0]+""=="0"?"0":" ";for(;W.length<q;)W=void 0!==x?W+Z:Z+W;return W})}static getBytes(u,l){return vn.encode(u,l)}static getCharCode(u,l=0){return u.charCodeAt(l)}static getCharAt(u){return String.fromCharCode(u)}}at.SHIFT_JIS=Ee.SJIS.getName(),at.GB2312="GB2312",at.ISO88591=Ee.ISO8859_1.getName(),at.EUC_JP="EUC_JP",at.UTF8=Ee.UTF8.getName(),at.PLATFORM_DEFAULT_ENCODING=at.UTF8,at.ASSUME_SHIFT_JIS=!1;class rn{constructor(u=""){this.value=u}enableDecoding(u){return this.encoding=u,this}append(u){return this.value+="string"==typeof u?u.toString():this.encoding?at.castAsNonUtf8Char(u,this.encoding):String.fromCharCode(u),this}appendChars(u,l,d){for(let h=l;l<l+d;h++)this.append(u[h]);return this}length(){return this.value.length}charAt(u){return this.value.charAt(u)}deleteCharAt(u){this.value=this.value.substr(0,u)+this.value.substring(u+1)}setCharAt(u,l){this.value=this.value.substr(0,u)+l+this.value.substr(u+1)}substring(u,l){return this.value.substring(u,l)}setLengthToZero(){this.value=""}toString(){return this.value}insert(u,l){this.value=this.value.substr(0,u)+l+this.value.substr(u+l.length)}}class Gn{constructor(u,l,d,h){if(this.width=u,this.height=l,this.rowSize=d,this.bits=h,null==l&&(l=u),this.height=l,u<1||l<1)throw new Ye("Both dimensions must be greater than 0");null==d&&(d=Math.floor((u+31)/32)),this.rowSize=d,null==h&&(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(u){const l=u.length,d=u[0].length,h=new Gn(d,l);for(let g=0;g<l;g++){const v=u[g];for(let x=0;x<d;x++)v[x]&&h.set(x,g)}return h}static parseFromString(u,l,d){if(null===u)throw new Ye("stringRepresentation cannot be null");const h=new Array(u.length);let g=0,v=0,x=-1,b=0,I=0;for(;I<u.length;)if("\n"===u.charAt(I)||"\r"===u.charAt(I)){if(g>v){if(-1===x)x=g-v;else if(g-v!==x)throw new Ye("row lengths do not match");v=g,b++}I++}else if(u.substring(I,I+l.length)===l)I+=l.length,h[g]=!0,g++;else{if(u.substring(I,I+d.length)!==d)throw new Ye("illegal character encountered: "+u.substring(I));I+=d.length,h[g]=!1,g++}if(g>v){if(-1===x)x=g-v;else if(g-v!==x)throw new Ye("row lengths do not match");b++}const S=new Gn(x,b);for(let k=0;k<g;k++)h[k]&&S.set(Math.floor(k%x),Math.floor(k/x));return S}get(u,l){const d=l*this.rowSize+Math.floor(u/32);return 0!=(this.bits[d]>>>(31&u)&1)}set(u,l){const d=l*this.rowSize+Math.floor(u/32);this.bits[d]|=1<<(31&u)&4294967295}unset(u,l){const d=l*this.rowSize+Math.floor(u/32);this.bits[d]&=~(1<<(31&u)&4294967295)}flip(u,l){const d=l*this.rowSize+Math.floor(u/32);this.bits[d]^=1<<(31&u)&4294967295}xor(u){if(this.width!==u.getWidth()||this.height!==u.getHeight()||this.rowSize!==u.getRowSize())throw new Ye("input matrix dimensions do not match");const l=new gt(Math.floor(this.width/32)+1),d=this.rowSize,h=this.bits;for(let g=0,v=this.height;g<v;g++){const x=g*d,b=u.getRow(g,l).getBitArray();for(let I=0;I<d;I++)h[x+I]^=b[I]}}clear(){const u=this.bits,l=u.length;for(let d=0;d<l;d++)u[d]=0}setRegion(u,l,d,h){if(l<0||u<0)throw new Ye("Left and top must be nonnegative");if(h<1||d<1)throw new Ye("Height and width must be at least 1");const g=u+d,v=l+h;if(v>this.height||g>this.width)throw new Ye("The region must fit inside the matrix");const x=this.rowSize,b=this.bits;for(let I=l;I<v;I++){const S=I*x;for(let k=u;k<g;k++)b[S+Math.floor(k/32)]|=1<<(31&k)&4294967295}}getRow(u,l){null==l||l.getSize()<this.width?l=new gt(this.width):l.clear();const d=this.rowSize,h=this.bits,g=u*d;for(let v=0;v<d;v++)l.setBulk(32*v,h[g+v]);return l}setRow(u,l){en.arraycopy(l.getBitArray(),0,this.bits,u*this.rowSize,this.rowSize)}rotate180(){const u=this.getWidth(),l=this.getHeight();let d=new gt(u),h=new gt(u);for(let g=0,v=Math.floor((l+1)/2);g<v;g++)d=this.getRow(g,d),h=this.getRow(l-1-g,h),d.reverse(),h.reverse(),this.setRow(g,h),this.setRow(l-1-g,d)}getEnclosingRectangle(){const l=this.height,d=this.rowSize,h=this.bits;let g=this.width,v=l,x=-1,b=-1;for(let I=0;I<l;I++)for(let S=0;S<d;S++){const k=h[I*d+S];if(0!==k){if(I<v&&(v=I),I>b&&(b=I),32*S<g){let L=0;for(;0==(k<<31-L&4294967295);)L++;32*S+L<g&&(g=32*S+L)}if(32*S+31>x){let L=31;for(;k>>>L==0;)L--;32*S+L>x&&(x=32*S+L)}}}return x<g||b<v?null:Int32Array.from([g,v,x-g+1,b-v+1])}getTopLeftOnBit(){const u=this.rowSize,l=this.bits;let d=0;for(;d<l.length&&0===l[d];)d++;if(d===l.length)return null;const h=d/u;let g=d%u*32;const v=l[d];let x=0;for(;0==(v<<31-x&4294967295);)x++;return g+=x,Int32Array.from([g,h])}getBottomRightOnBit(){const u=this.rowSize,l=this.bits;let d=l.length-1;for(;d>=0&&0===l[d];)d--;if(d<0)return null;const h=Math.floor(d/u);let g=32*Math.floor(d%u);const v=l[d];let x=31;for(;v>>>x==0;)x--;return g+=x,Int32Array.from([g,h])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(u){return u instanceof Gn&&this.width===u.width&&this.height===u.height&&this.rowSize===u.rowSize&&Vn.equals(this.bits,u.bits)}hashCode(){let u=this.width;return u=31*u+this.width,u=31*u+this.height,u=31*u+this.rowSize,u=31*u+Vn.hashCode(this.bits),u}toString(u="X ",l="  ",d="\n"){return this.buildToString(u,l,d)}buildToString(u,l,d){let h=new rn;for(let g=0,v=this.height;g<v;g++){for(let x=0,b=this.width;x<b;x++)h.append(this.get(x,g)?u:l);h.append(d)}return h.toString()}clone(){return new Gn(this.width,this.height,this.rowSize,this.bits.slice())}}let ce=(()=>{class D extends xr{static getNotFoundInstance(){return new D}}return D.kind="NotFoundException",D})();class Jn extends Ga{constructor(u){super(u),this.luminances=Jn.EMPTY,this.buckets=new Int32Array(Jn.LUMINANCE_BUCKETS)}getBlackRow(u,l){const d=this.getLuminanceSource(),h=d.getWidth();null==l||l.getSize()<h?l=new gt(h):l.clear(),this.initArrays(h);const g=d.getRow(u,this.luminances),v=this.buckets;for(let b=0;b<h;b++)v[(255&g[b])>>Jn.LUMINANCE_SHIFT]++;const x=Jn.estimateBlackPoint(v);if(h<3)for(let b=0;b<h;b++)(255&g[b])<x&&l.set(b);else{let b=255&g[0],I=255&g[1];for(let S=1;S<h-1;S++){const k=255&g[S+1];(4*I-b-k)/2<x&&l.set(S),b=I,I=k}}return l}getBlackMatrix(){const u=this.getLuminanceSource(),l=u.getWidth(),d=u.getHeight(),h=new Gn(l,d);this.initArrays(l);const g=this.buckets;for(let b=1;b<5;b++){const I=Math.floor(d*b/5),S=u.getRow(I,this.luminances),k=Math.floor(4*l/5);for(let L=Math.floor(l/5);L<k;L++)g[(255&S[L])>>Jn.LUMINANCE_SHIFT]++}const v=Jn.estimateBlackPoint(g),x=u.getMatrix();for(let b=0;b<d;b++){const I=b*l;for(let S=0;S<l;S++)(255&x[I+S])<v&&h.set(S,b)}return h}createBinarizer(u){return new Jn(u)}initArrays(u){this.luminances.length<u&&(this.luminances=new Uint8ClampedArray(u));const l=this.buckets;for(let d=0;d<Jn.LUMINANCE_BUCKETS;d++)l[d]=0}static estimateBlackPoint(u){const l=u.length;let d=0,h=0,g=0;for(let S=0;S<l;S++)u[S]>g&&(h=S,g=u[S]),u[S]>d&&(d=u[S]);let v=0,x=0;for(let S=0;S<l;S++){const k=S-h,L=u[S]*k*k;L>x&&(v=S,x=L)}if(h>v){const S=h;h=v,v=S}if(v-h<=l/16)throw new ce;let b=v-1,I=-1;for(let S=v-1;S>h;S--){const k=S-h,L=k*k*(v-S)*(d-u[S]);L>I&&(b=S,I=L)}return b<<Jn.LUMINANCE_SHIFT}}Jn.LUMINANCE_BITS=5,Jn.LUMINANCE_SHIFT=8-Jn.LUMINANCE_BITS,Jn.LUMINANCE_BUCKETS=1<<Jn.LUMINANCE_BITS,Jn.EMPTY=Uint8ClampedArray.from([0]);class ht extends Jn{constructor(u){super(u),this.matrix=null}getBlackMatrix(){if(null!==this.matrix)return this.matrix;const u=this.getLuminanceSource(),l=u.getWidth(),d=u.getHeight();if(l>=ht.MINIMUM_DIMENSION&&d>=ht.MINIMUM_DIMENSION){const h=u.getMatrix();let g=l>>ht.BLOCK_SIZE_POWER;0!=(l&ht.BLOCK_SIZE_MASK)&&g++;let v=d>>ht.BLOCK_SIZE_POWER;0!=(d&ht.BLOCK_SIZE_MASK)&&v++;const x=ht.calculateBlackPoints(h,g,v,l,d),b=new Gn(l,d);ht.calculateThresholdForBlock(h,g,v,l,d,x,b),this.matrix=b}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(u){return new ht(u)}static calculateThresholdForBlock(u,l,d,h,g,v,x){const b=g-ht.BLOCK_SIZE,I=h-ht.BLOCK_SIZE;for(let S=0;S<d;S++){let k=S<<ht.BLOCK_SIZE_POWER;k>b&&(k=b);const L=ht.cap(S,2,d-3);for(let W=0;W<l;W++){let q=W<<ht.BLOCK_SIZE_POWER;q>I&&(q=I);const Z=ht.cap(W,2,l-3);let ne=0;for(let Ae=-2;Ae<=2;Ae++){const Me=v[L+Ae];ne+=Me[Z-2]+Me[Z-1]+Me[Z]+Me[Z+1]+Me[Z+2]}ht.thresholdBlock(u,q,k,ne/25,h,x)}}}static cap(u,l,d){return u<l?l:u>d?d:u}static thresholdBlock(u,l,d,h,g,v){for(let x=0,b=d*g+l;x<ht.BLOCK_SIZE;x++,b+=g)for(let I=0;I<ht.BLOCK_SIZE;I++)(255&u[b+I])<=h&&v.set(l+I,d+x)}static calculateBlackPoints(u,l,d,h,g){const v=g-ht.BLOCK_SIZE,x=h-ht.BLOCK_SIZE,b=new Array(d);for(let I=0;I<d;I++){b[I]=new Int32Array(l);let S=I<<ht.BLOCK_SIZE_POWER;S>v&&(S=v);for(let k=0;k<l;k++){let L=k<<ht.BLOCK_SIZE_POWER;L>x&&(L=x);let W=0,q=255,Z=0;for(let ie=0,Ae=S*h+L;ie<ht.BLOCK_SIZE;ie++,Ae+=h){for(let Me=0;Me<ht.BLOCK_SIZE;Me++){const de=255&u[Ae+Me];W+=de,de<q&&(q=de),de>Z&&(Z=de)}if(Z-q>ht.MIN_DYNAMIC_RANGE)for(ie++,Ae+=h;ie<ht.BLOCK_SIZE;ie++,Ae+=h)for(let Me=0;Me<ht.BLOCK_SIZE;Me++)W+=255&u[Ae+Me]}let ne=W>>2*ht.BLOCK_SIZE_POWER;if(Z-q<=ht.MIN_DYNAMIC_RANGE&&(ne=q/2,I>0&&k>0)){const ie=(b[I-1][k]+2*b[I][k-1]+b[I-1][k-1])/4;q<ie&&(ne=ie)}b[I][k]=ne}}return b}}ht.BLOCK_SIZE_POWER=3,ht.BLOCK_SIZE=1<<ht.BLOCK_SIZE_POWER,ht.BLOCK_SIZE_MASK=ht.BLOCK_SIZE-1,ht.MINIMUM_DIMENSION=5*ht.BLOCK_SIZE,ht.MIN_DYNAMIC_RANGE=24;class No{constructor(u,l){this.width=u,this.height=l}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(u,l,d,h){throw new Ms("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new Ms("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new Ms("This luminance source does not support rotation by 45 degrees.")}toString(){const u=new Uint8ClampedArray(this.width);let l=new rn;for(let d=0;d<this.height;d++){const h=this.getRow(d,u);for(let g=0;g<this.width;g++){const v=255&h[g];let x;x=v<64?"#":v<128?"+":v<192?".":" ",l.append(x)}l.append("\n")}return l.toString()}}class qi extends No{constructor(u){super(u.getWidth(),u.getHeight()),this.delegate=u}getRow(u,l){const d=this.delegate.getRow(u,l),h=this.getWidth();for(let g=0;g<h;g++)d[g]=255-(255&d[g]);return d}getMatrix(){const u=this.delegate.getMatrix(),l=this.getWidth()*this.getHeight(),d=new Uint8ClampedArray(l);for(let h=0;h<l;h++)d[h]=255-(255&u[h]);return d}isCropSupported(){return this.delegate.isCropSupported()}crop(u,l,d,h){return new qi(this.delegate.crop(u,l,d,h))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new qi(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new qi(this.delegate.rotateCounterClockwise45())}}class so extends No{constructor(u){super(u.width,u.height),this.canvas=u,this.tempCanvasElement=null,this.buffer=so.makeBufferFromCanvasImageData(u)}static makeBufferFromCanvasImageData(u){const l=u.getContext("2d").getImageData(0,0,u.width,u.height);return so.toGrayscaleBuffer(l.data,u.width,u.height)}static toGrayscaleBuffer(u,l,d){const h=new Uint8ClampedArray(l*d);for(let g=0,v=0,x=u.length;g<x;g+=4,v++){let b;b=0===u[g+3]?255:306*u[g]+601*u[g+1]+117*u[g+2]+512>>10,h[v]=b}return h}getRow(u,l){if(u<0||u>=this.getHeight())throw new Ye("Requested row is outside the image: "+u);const d=this.getWidth(),h=u*d;return null===l?l=this.buffer.slice(h,h+d):(l.length<d&&(l=new Uint8ClampedArray(d)),l.set(this.buffer.slice(h,h+d))),l}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(u,l,d,h){return super.crop(u,l,d,h),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(null===this.tempCanvasElement){const u=this.canvas.ownerDocument.createElement("canvas");u.width=this.canvas.width,u.height=this.canvas.height,this.tempCanvasElement=u}return this.tempCanvasElement}rotate(u){const l=this.getTempCanvasElement(),d=l.getContext("2d"),h=u*so.DEGREE_TO_RADIANS,g=this.canvas.width,v=this.canvas.height,x=Math.ceil(Math.abs(Math.cos(h))*g+Math.abs(Math.sin(h))*v),b=Math.ceil(Math.abs(Math.sin(h))*g+Math.abs(Math.cos(h))*v);return l.width=x,l.height=b,d.translate(x/2,b/2),d.rotate(h),d.drawImage(this.canvas,g/-2,v/-2),this.buffer=so.makeBufferFromCanvasImageData(l),this}invert(){return new qi(this)}}so.DEGREE_TO_RADIANS=Math.PI/180;class Ya{constructor(u,l,d){this.deviceId=u,this.label=l,this.kind="videoinput",this.groupId=d||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var Pr=(globalThis||global||self||window?(globalThis||global||self||window||void 0).__awaiter:void 0)||function(D,u,l,d){return new(l||(l=Promise))(function(g,v){function x(S){try{I(d.next(S))}catch(k){v(k)}}function b(S){try{I(d.throw(S))}catch(k){v(k)}}function I(S){S.done?g(S.value):function(g){return g instanceof l?g:new l(function(v){v(g)})}(S.value).then(x,b)}I((d=d.apply(D,u||[])).next())})};class Ro{constructor(u,l=500,d){this.reader=u,this.timeBetweenScansMillis=l,this._hints=d,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return"undefined"!=typeof navigator}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!(!this.isMediaDevicesSuported||!navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(u){this._timeBetweenDecodingAttempts=u<0?0:u}set hints(u){this._hints=u||null}get hints(){return this._hints}listVideoInputDevices(){return Pr(this,void 0,void 0,function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const u=yield navigator.mediaDevices.enumerateDevices(),l=[];for(const d of u){const h="video"===d.kind?"videoinput":d.kind;"videoinput"===h&&l.push({deviceId:d.deviceId||d.id,label:d.label||`Video device ${l.length+1}`,kind:h,groupId:d.groupId})}return l})}getVideoInputDevices(){return Pr(this,void 0,void 0,function*(){return(yield this.listVideoInputDevices()).map(l=>new Ya(l.deviceId,l.label))})}findDeviceById(u){return Pr(this,void 0,void 0,function*(){const l=yield this.listVideoInputDevices();return l?l.find(d=>d.deviceId===u):null})}decodeFromInputVideoDevice(u,l){return Pr(this,void 0,void 0,function*(){return yield this.decodeOnceFromVideoDevice(u,l)})}decodeOnceFromVideoDevice(u,l){return Pr(this,void 0,void 0,function*(){let d;this.reset(),d=u?{deviceId:{exact:u}}:{facingMode:"environment"};const h={video:d};return yield this.decodeOnceFromConstraints(h,l)})}decodeOnceFromConstraints(u,l){return Pr(this,void 0,void 0,function*(){const d=yield navigator.mediaDevices.getUserMedia(u);return yield this.decodeOnceFromStream(d,l)})}decodeOnceFromStream(u,l){return Pr(this,void 0,void 0,function*(){this.reset();const d=yield this.attachStreamToVideo(u,l);return yield this.decodeOnce(d)})}decodeFromInputVideoDeviceContinuously(u,l,d){return Pr(this,void 0,void 0,function*(){return yield this.decodeFromVideoDevice(u,l,d)})}decodeFromVideoDevice(u,l,d){return Pr(this,void 0,void 0,function*(){let h;h=u?{deviceId:{exact:u}}:{facingMode:"environment"};const g={video:h};return yield this.decodeFromConstraints(g,l,d)})}decodeFromConstraints(u,l,d){return Pr(this,void 0,void 0,function*(){const h=yield navigator.mediaDevices.getUserMedia(u);return yield this.decodeFromStream(h,l,d)})}decodeFromStream(u,l,d){return Pr(this,void 0,void 0,function*(){this.reset();const h=yield this.attachStreamToVideo(u,l);return yield this.decodeContinuously(h,d)})}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(u,l){return Pr(this,void 0,void 0,function*(){const d=this.prepareVideoElement(l);return this.addVideoSource(d,u),this.videoElement=d,this.stream=u,yield this.playVideoOnLoadAsync(d),d})}playVideoOnLoadAsync(u){return new Promise((l,d)=>this.playVideoOnLoad(u,()=>l()))}playVideoOnLoad(u,l){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(u),u.addEventListener("ended",this.videoEndedListener),u.addEventListener("canplay",this.videoCanPlayListener),u.addEventListener("playing",l),this.tryPlayVideo(u)}isVideoPlaying(u){return u.currentTime>0&&!u.paused&&!u.ended&&u.readyState>2}tryPlayVideo(u){return Pr(this,void 0,void 0,function*(){if(this.isVideoPlaying(u))console.warn("Trying to play video that is already playing.");else try{yield u.play()}catch(l){console.warn("It was not possible to play the video.")}})}getMediaElement(u,l){const d=document.getElementById(u);if(!d)throw new oi(`element with id '${u}' not found`);if(d.nodeName.toLowerCase()!==l.toLowerCase())throw new oi(`element with id '${u}' must be an ${l} element`);return d}decodeFromImage(u,l){if(!u&&!l)throw new oi("either imageElement with a src set or an url must be provided");return l&&!u?this.decodeFromImageUrl(l):this.decodeFromImageElement(u)}decodeFromVideo(u,l){if(!u&&!l)throw new oi("Either an element with a src set or an URL must be provided");return l&&!u?this.decodeFromVideoUrl(l):this.decodeFromVideoElement(u)}decodeFromVideoContinuously(u,l,d){if(void 0===u&&void 0===l)throw new oi("Either an element with a src set or an URL must be provided");return l&&!u?this.decodeFromVideoUrlContinuously(l,d):this.decodeFromVideoElementContinuously(u,d)}decodeFromImageElement(u){if(!u)throw new oi("An image element must be provided.");this.reset();const l=this.prepareImageElement(u);let d;return this.imageElement=l,d=this.isImageLoaded(l)?this.decodeOnce(l,!1,!0):this._decodeOnLoadImage(l),d}decodeFromVideoElement(u){const l=this._decodeFromVideoElementSetup(u);return this._decodeOnLoadVideo(l)}decodeFromVideoElementContinuously(u,l){const d=this._decodeFromVideoElementSetup(u);return this._decodeOnLoadVideoContinuously(d,l)}_decodeFromVideoElementSetup(u){if(!u)throw new oi("A video element must be provided.");this.reset();const l=this.prepareVideoElement(u);return this.videoElement=l,l}decodeFromImageUrl(u){if(!u)throw new oi("An URL must be provided.");this.reset();const l=this.prepareImageElement();this.imageElement=l;const d=this._decodeOnLoadImage(l);return l.src=u,d}decodeFromVideoUrl(u){if(!u)throw new oi("An URL must be provided.");this.reset();const l=this.prepareVideoElement(),d=this.decodeFromVideoElement(l);return l.src=u,d}decodeFromVideoUrlContinuously(u,l){if(!u)throw new oi("An URL must be provided.");this.reset();const d=this.prepareVideoElement(),h=this.decodeFromVideoElementContinuously(d,l);return d.src=u,h}_decodeOnLoadImage(u){return new Promise((l,d)=>{this.imageLoadedListener=()=>this.decodeOnce(u,!1,!0).then(l,d),u.addEventListener("load",this.imageLoadedListener)})}_decodeOnLoadVideo(u){return Pr(this,void 0,void 0,function*(){return yield this.playVideoOnLoadAsync(u),yield this.decodeOnce(u)})}_decodeOnLoadVideoContinuously(u,l){return Pr(this,void 0,void 0,function*(){yield this.playVideoOnLoadAsync(u),this.decodeContinuously(u,l)})}isImageLoaded(u){return!(!u.complete||0===u.naturalWidth)}prepareImageElement(u){let l;return void 0===u&&(l=document.createElement("img"),l.width=200,l.height=200),"string"==typeof u&&(l=this.getMediaElement(u,"img")),u instanceof HTMLImageElement&&(l=u),l}prepareVideoElement(u){let l;return!u&&"undefined"!=typeof document&&(l=document.createElement("video"),l.width=200,l.height=200),"string"==typeof u&&(l=this.getMediaElement(u,"video")),u instanceof HTMLVideoElement&&(l=u),l.setAttribute("autoplay","true"),l.setAttribute("muted","true"),l.setAttribute("playsinline","true"),l}decodeOnce(u,l=!0,d=!0){this._stopAsyncDecode=!1;const h=(g,v)=>{if(this._stopAsyncDecode)return v(new ce("Video stream has ended before any code could be detected.")),void(this._stopAsyncDecode=void 0);try{g(this.decode(u))}catch(x){const S=(x instanceof Dt||x instanceof Re)&&d;if(l&&x instanceof ce||S)return setTimeout(h,this._timeBetweenDecodingAttempts,g,v);v(x)}};return new Promise((g,v)=>h(g,v))}decodeContinuously(u,l){this._stopContinuousDecode=!1;const d=()=>{if(this._stopContinuousDecode)this._stopContinuousDecode=void 0;else try{const h=this.decode(u);l(h,null),setTimeout(d,this.timeBetweenScansMillis)}catch(h){l(null,h);const v=h instanceof ce;(h instanceof Dt||h instanceof Re||v)&&setTimeout(d,this._timeBetweenDecodingAttempts)}};d()}decode(u){const l=this.createBinaryBitmap(u);return this.decodeBitmap(l)}createBinaryBitmap(u){const l=this.getCaptureCanvasContext(u);this.drawImageOnCanvas(l,u);const d=this.getCaptureCanvas(u),h=new so(d),g=new ht(h);return new Si(g)}getCaptureCanvasContext(u){if(!this.captureCanvasContext){const d=this.getCaptureCanvas(u).getContext("2d");this.captureCanvasContext=d}return this.captureCanvasContext}getCaptureCanvas(u){if(!this.captureCanvas){const l=this.createCaptureCanvas(u);this.captureCanvas=l}return this.captureCanvas}drawImageOnCanvas(u,l){u.drawImage(l,0,0)}decodeBitmap(u){return this.reader.decode(u,this._hints)}createCaptureCanvas(u){if("undefined"==typeof document)return this._destroyCaptureCanvas(),null;const l=document.createElement("canvas");let d,h;return void 0!==u&&(u instanceof HTMLVideoElement?(d=u.videoWidth,h=u.videoHeight):u instanceof HTMLImageElement&&(d=u.naturalWidth||u.width,h=u.naturalHeight||u.height)),l.style.width=d+"px",l.style.height=h+"px",l.width=d,l.height=h,l}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach(u=>u.stop()),this.stream=void 0),!1===this._stopAsyncDecode&&this.stopAsyncDecode(),!1===this._stopContinuousDecode&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){!this.videoElement||(void 0!==this.videoEndedListener&&this.videoElement.removeEventListener("ended",this.videoEndedListener),void 0!==this.videoPlayingEventListener&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),void 0!==this.videoCanPlayListener&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){!this.imageElement||(void 0!==this.imageLoadedListener&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(u,l){try{u.srcObject=l}catch(d){u.src=URL.createObjectURL(l)}}cleanVideoSource(u){try{u.srcObject=null}catch(l){u.src=""}this.videoElement.removeAttribute("src")}}class fr{constructor(u,l,d=(null==l?0:8*l.length),h,g,v=en.currentTimeMillis()){this.text=u,this.rawBytes=l,this.numBits=d,this.resultPoints=h,this.format=g,this.timestamp=v,this.text=u,this.rawBytes=l,this.numBits=null==d?null==l?0:8*l.length:d,this.resultPoints=h,this.format=g,this.resultMetadata=null,this.timestamp=null==v?en.currentTimeMillis():v}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(u,l){null===this.resultMetadata&&(this.resultMetadata=new Map),this.resultMetadata.set(u,l)}putAllMetadata(u){null!==u&&(this.resultMetadata=null===this.resultMetadata?u:new Map(u))}addResultPoints(u){const l=this.resultPoints;if(null===l)this.resultPoints=u;else if(null!==u&&u.length>0){const d=new Array(l.length+u.length);en.arraycopy(l,0,d,0,l.length),en.arraycopy(u,0,d,l.length,u.length),this.resultPoints=d}}getTimestamp(){return this.timestamp}toString(){return this.text}}var Xa=(()=>{return(D=Xa||(Xa={}))[D.AZTEC=0]="AZTEC",D[D.CODABAR=1]="CODABAR",D[D.CODE_39=2]="CODE_39",D[D.CODE_93=3]="CODE_93",D[D.CODE_128=4]="CODE_128",D[D.DATA_MATRIX=5]="DATA_MATRIX",D[D.EAN_8=6]="EAN_8",D[D.EAN_13=7]="EAN_13",D[D.ITF=8]="ITF",D[D.MAXICODE=9]="MAXICODE",D[D.PDF_417=10]="PDF_417",D[D.QR_CODE=11]="QR_CODE",D[D.RSS_14=12]="RSS_14",D[D.RSS_EXPANDED=13]="RSS_EXPANDED",D[D.UPC_A=14]="UPC_A",D[D.UPC_E=15]="UPC_E",D[D.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION",Xa;var D})(),it=Xa,Mo=(()=>{return(D=Mo||(Mo={}))[D.OTHER=0]="OTHER",D[D.ORIENTATION=1]="ORIENTATION",D[D.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",D[D.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",D[D.ISSUE_NUMBER=4]="ISSUE_NUMBER",D[D.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",D[D.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",D[D.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",D[D.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",D[D.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",D[D.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY",Mo;var D})(),Yn=Mo;class Xo{constructor(u,l,d,h,g=-1,v=-1){this.rawBytes=u,this.text=l,this.byteSegments=d,this.ecLevel=h,this.structuredAppendSequenceNumber=g,this.structuredAppendParity=v,this.numBits=null==u?0:8*u.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(u){this.numBits=u}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(u){this.errorsCorrected=u}getErasures(){return this.erasures}setErasures(u){this.erasures=u}getOther(){return this.other}setOther(u){this.other=u}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class Os{exp(u){return this.expTable[u]}log(u){if(0===u)throw new Ye;return this.logTable[u]}static addOrSubtract(u,l){return u^l}}class kr{constructor(u,l){if(0===l.length)throw new Ye;this.field=u;const d=l.length;if(d>1&&0===l[0]){let h=1;for(;h<d&&0===l[h];)h++;h===d?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(d-h),en.arraycopy(l,h,this.coefficients,0,this.coefficients.length))}else this.coefficients=l}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return 0===this.coefficients[0]}getCoefficient(u){return this.coefficients[this.coefficients.length-1-u]}evaluateAt(u){if(0===u)return this.getCoefficient(0);const l=this.coefficients;let d;if(1===u){d=0;for(let v=0,x=l.length;v!==x;v++)d=Os.addOrSubtract(d,l[v]);return d}d=l[0];const h=l.length,g=this.field;for(let v=1;v<h;v++)d=Os.addOrSubtract(g.multiply(u,d),l[v]);return d}addOrSubtract(u){if(!this.field.equals(u.field))throw new Ye("GenericGFPolys do not have same GenericGF field");if(this.isZero())return u;if(u.isZero())return this;let l=this.coefficients,d=u.coefficients;if(l.length>d.length){const v=l;l=d,d=v}let h=new Int32Array(d.length);const g=d.length-l.length;en.arraycopy(d,0,h,0,g);for(let v=g;v<d.length;v++)h[v]=Os.addOrSubtract(l[v-g],d[v]);return new kr(this.field,h)}multiply(u){if(!this.field.equals(u.field))throw new Ye("GenericGFPolys do not have same GenericGF field");if(this.isZero()||u.isZero())return this.field.getZero();const l=this.coefficients,d=l.length,h=u.coefficients,g=h.length,v=new Int32Array(d+g-1),x=this.field;for(let b=0;b<d;b++){const I=l[b];for(let S=0;S<g;S++)v[b+S]=Os.addOrSubtract(v[b+S],x.multiply(I,h[S]))}return new kr(x,v)}multiplyScalar(u){if(0===u)return this.field.getZero();if(1===u)return this;const l=this.coefficients.length,d=this.field,h=new Int32Array(l),g=this.coefficients;for(let v=0;v<l;v++)h[v]=d.multiply(g[v],u);return new kr(d,h)}multiplyByMonomial(u,l){if(u<0)throw new Ye;if(0===l)return this.field.getZero();const d=this.coefficients,h=d.length,g=new Int32Array(h+u),v=this.field;for(let x=0;x<h;x++)g[x]=v.multiply(d[x],l);return new kr(v,g)}divide(u){if(!this.field.equals(u.field))throw new Ye("GenericGFPolys do not have same GenericGF field");if(u.isZero())throw new Ye("Divide by 0");const l=this.field;let d=l.getZero(),h=this;const g=u.getCoefficient(u.getDegree()),v=l.inverse(g);for(;h.getDegree()>=u.getDegree()&&!h.isZero();){const x=h.getDegree()-u.getDegree(),b=l.multiply(h.getCoefficient(h.getDegree()),v),I=u.multiplyByMonomial(x,b),S=l.buildMonomial(x,b);d=d.addOrSubtract(S),h=h.addOrSubtract(I)}return[d,h]}toString(){let u="";for(let l=this.getDegree();l>=0;l--){let d=this.getCoefficient(l);if(0!==d){if(d<0?(u+=" - ",d=-d):u.length>0&&(u+=" + "),0===l||1!==d){const h=this.field.log(d);0===h?u+="1":1===h?u+="a":(u+="a^",u+=h)}0!==l&&(1===l?u+="x":(u+="x^",u+=l))}}return u}}let va=(()=>{class D extends xr{}return D.kind="ArithmeticException",D})();class Pt extends Os{constructor(u,l,d){super(),this.primitive=u,this.size=l,this.generatorBase=d;const h=new Int32Array(l);let g=1;for(let x=0;x<l;x++)h[x]=g,g*=2,g>=l&&(g^=u,g&=l-1);this.expTable=h;const v=new Int32Array(l);for(let x=0;x<l-1;x++)v[h[x]]=x;this.logTable=v,this.zero=new kr(this,Int32Array.from([0])),this.one=new kr(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(u,l){if(u<0)throw new Ye;if(0===l)return this.zero;const d=new Int32Array(u+1);return d[0]=l,new kr(this,d)}inverse(u){if(0===u)throw new va;return this.expTable[this.size-this.logTable[u]-1]}multiply(u,l){return 0===u||0===l?0:this.expTable[(this.logTable[u]+this.logTable[l])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+Ct.toHexString(this.primitive)+","+this.size+")"}equals(u){return u===this}}Pt.AZTEC_DATA_12=new Pt(4201,4096,1),Pt.AZTEC_DATA_10=new Pt(1033,1024,1),Pt.AZTEC_DATA_6=new Pt(67,64,1),Pt.AZTEC_PARAM=new Pt(19,16,1),Pt.QR_CODE_FIELD_256=new Pt(285,256,0),Pt.DATA_MATRIX_FIELD_256=new Pt(301,256,1),Pt.AZTEC_DATA_8=Pt.DATA_MATRIX_FIELD_256,Pt.MAXICODE_FIELD_64=Pt.AZTEC_DATA_6;let Fs=(()=>{class D extends xr{}return D.kind="ReedSolomonException",D})(),ao=(()=>{class D extends xr{}return D.kind="IllegalStateException",D})();class Ps{constructor(u){this.field=u}decode(u,l){const d=this.field,h=new kr(d,u),g=new Int32Array(l);let v=!0;for(let W=0;W<l;W++){const q=h.evaluateAt(d.exp(W+d.getGeneratorBase()));g[g.length-1-W]=q,0!==q&&(v=!1)}if(v)return;const x=new kr(d,g),b=this.runEuclideanAlgorithm(d.buildMonomial(l,1),x,l),S=b[1],k=this.findErrorLocations(b[0]),L=this.findErrorMagnitudes(S,k);for(let W=0;W<k.length;W++){const q=u.length-1-d.log(k[W]);if(q<0)throw new Fs("Bad error location");u[q]=Pt.addOrSubtract(u[q],L[W])}}runEuclideanAlgorithm(u,l,d){if(u.getDegree()<l.getDegree()){const W=u;u=l,l=W}const h=this.field;let g=u,v=l,x=h.getZero(),b=h.getOne();for(;v.getDegree()>=(d/2|0);){let W=g,q=x;if(g=v,x=b,g.isZero())throw new Fs("r_{i-1} was zero");v=W;let Z=h.getZero();const ne=g.getCoefficient(g.getDegree()),ie=h.inverse(ne);for(;v.getDegree()>=g.getDegree()&&!v.isZero();){const Ae=v.getDegree()-g.getDegree(),Me=h.multiply(v.getCoefficient(v.getDegree()),ie);Z=Z.addOrSubtract(h.buildMonomial(Ae,Me)),v=v.addOrSubtract(g.multiplyByMonomial(Ae,Me))}if(b=Z.multiply(x).addOrSubtract(q),v.getDegree()>=g.getDegree())throw new ao("Division algorithm failed to reduce polynomial?")}const I=b.getCoefficient(0);if(0===I)throw new Fs("sigmaTilde(0) was zero");const S=h.inverse(I);return[b.multiplyScalar(S),v.multiplyScalar(S)]}findErrorLocations(u){const l=u.getDegree();if(1===l)return Int32Array.from([u.getCoefficient(1)]);const d=new Int32Array(l);let h=0;const g=this.field;for(let v=1;v<g.getSize()&&h<l;v++)0===u.evaluateAt(v)&&(d[h]=g.inverse(v),h++);if(h!==l)throw new Fs("Error locator degree does not match number of roots");return d}findErrorMagnitudes(u,l){const d=l.length,h=new Int32Array(d),g=this.field;for(let v=0;v<d;v++){const x=g.inverse(l[v]);let b=1;for(let I=0;I<d;I++)if(v!==I){const S=g.multiply(l[I],x);b=g.multiply(b,0==(1&S)?1|S:-2&S)}h[v]=g.multiply(u.evaluateAt(x),g.inverse(b)),0!==g.getGeneratorBase()&&(h[v]=g.multiply(h[v],x))}return h}}var wn=(()=>{return(D=wn||(wn={}))[D.UPPER=0]="UPPER",D[D.LOWER=1]="LOWER",D[D.MIXED=2]="MIXED",D[D.DIGIT=3]="DIGIT",D[D.PUNCT=4]="PUNCT",D[D.BINARY=5]="BINARY",wn;var D})();let Ni=(()=>{class D{decode(l){this.ddata=l;let d=l.getBits(),h=this.extractBits(d),g=this.correctBits(h),v=D.convertBoolArrayToByteArray(g),x=D.getEncodedData(g),b=new Xo(v,x,null,null);return b.setNumBits(g.length),b}static highLevelDecode(l){return this.getEncodedData(l)}static getEncodedData(l){let d=l.length,h=wn.UPPER,g=wn.UPPER,v="",x=0;for(;x<d;)if(g===wn.BINARY){if(d-x<5)break;let b=D.readCode(l,x,5);if(x+=5,0===b){if(d-x<11)break;b=D.readCode(l,x,11)+31,x+=11}for(let I=0;I<b;I++){if(d-x<8){x=d;break}const S=D.readCode(l,x,8);v+=at.castAsNonUtf8Char(S),x+=8}g=h}else{let b=g===wn.DIGIT?4:5;if(d-x<b)break;let I=D.readCode(l,x,b);x+=b;let S=D.getCharacter(g,I);S.startsWith("CTRL_")?(h=g,g=D.getTable(S.charAt(5)),"L"===S.charAt(6)&&(h=g)):(v+=S,g=h)}return v}static getTable(l){switch(l){case"L":return wn.LOWER;case"P":return wn.PUNCT;case"M":return wn.MIXED;case"D":return wn.DIGIT;case"B":return wn.BINARY;case"U":default:return wn.UPPER}}static getCharacter(l,d){switch(l){case wn.UPPER:return D.UPPER_TABLE[d];case wn.LOWER:return D.LOWER_TABLE[d];case wn.MIXED:return D.MIXED_TABLE[d];case wn.PUNCT:return D.PUNCT_TABLE[d];case wn.DIGIT:return D.DIGIT_TABLE[d];default:throw new ao("Bad table")}}correctBits(l){let d,h;this.ddata.getNbLayers()<=2?(h=6,d=Pt.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(h=8,d=Pt.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(h=10,d=Pt.AZTEC_DATA_10):(h=12,d=Pt.AZTEC_DATA_12);let g=this.ddata.getNbDatablocks(),v=l.length/h;if(v<g)throw new Re;let x=l.length%h,b=new Int32Array(v);for(let W=0;W<v;W++,x+=h)b[W]=D.readCode(l,x,h);try{new Ps(d).decode(b,v-g)}catch(W){throw new Re(W)}let I=(1<<h)-1,S=0;for(let W=0;W<g;W++){let q=b[W];if(0===q||q===I)throw new Re;(1===q||q===I-1)&&S++}let k=new Array(g*h-S),L=0;for(let W=0;W<g;W++){let q=b[W];if(1===q||q===I-1)k.fill(q>1,L,L+h-1),L+=h-1;else for(let Z=h-1;Z>=0;--Z)k[L++]=0!=(q&1<<Z)}return k}extractBits(l){let d=this.ddata.isCompact(),h=this.ddata.getNbLayers(),g=(d?11:14)+4*h,v=new Int32Array(g),x=new Array(this.totalBitsInLayer(h,d));if(d)for(let b=0;b<v.length;b++)v[b]=b;else{let b=g+1+2*Ct.truncDivision(Ct.truncDivision(g,2)-1,15),I=g/2,S=Ct.truncDivision(b,2);for(let k=0;k<I;k++){let L=k+Ct.truncDivision(k,15);v[I-k-1]=S-L-1,v[I+k]=S+L+1}}for(let b=0,I=0;b<h;b++){let S=4*(h-b)+(d?9:12),k=2*b,L=g-1-k;for(let W=0;W<S;W++){let q=2*W;for(let Z=0;Z<2;Z++)x[I+q+Z]=l.get(v[k+Z],v[k+W]),x[I+2*S+q+Z]=l.get(v[k+W],v[L-Z]),x[I+4*S+q+Z]=l.get(v[L-Z],v[L-W]),x[I+6*S+q+Z]=l.get(v[L-W],v[k+Z])}I+=8*S}return x}static readCode(l,d,h){let g=0;for(let v=d;v<d+h;v++)g<<=1,l[v]&&(g|=1);return g}static readByte(l,d){let h=l.length-d;return h>=8?D.readCode(l,d,8):D.readCode(l,d,h)<<8-h}static convertBoolArrayToByteArray(l){let d=new Uint8Array((l.length+7)/8);for(let h=0;h<d.length;h++)d[h]=D.readByte(l,8*h);return d}totalBitsInLayer(l,d){return((d?88:112)+16*l)*l}}return D.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],D.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],D.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","\t","\n","\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],D.PUNCT_TABLE=["","\r","\r\n",". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],D.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"],D})();class Vt{constructor(){}static round(u){return NaN===u?0:u<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:u>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:u+(u<0?-.5:.5)|0}static distance(u,l,d,h){const g=u-d,v=l-h;return Math.sqrt(g*g+v*v)}static sum(u){let l=0;for(let d=0,h=u.length;d!==h;d++)l+=u[d];return l}}class qa{static floatToIntBits(u){return u}}qa.MAX_VALUE=Number.MAX_SAFE_INTEGER;class Ue{constructor(u,l){this.x=u,this.y=l}getX(){return this.x}getY(){return this.y}equals(u){if(u instanceof Ue){const l=u;return this.x===l.x&&this.y===l.y}return!1}hashCode(){return 31*qa.floatToIntBits(this.x)+qa.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(u){const l=this.distance(u[0],u[1]),d=this.distance(u[1],u[2]),h=this.distance(u[0],u[2]);let g,v,x;if(d>=l&&d>=h?(v=u[0],g=u[1],x=u[2]):h>=d&&h>=l?(v=u[1],g=u[0],x=u[2]):(v=u[2],g=u[0],x=u[1]),this.crossProductZ(g,v,x)<0){const b=g;g=x,x=b}u[0]=g,u[1]=v,u[2]=x}static distance(u,l){return Vt.distance(u.x,u.y,l.x,l.y)}static crossProductZ(u,l,d){const h=l.x,g=l.y;return(d.x-h)*(u.y-g)-(d.y-g)*(u.x-h)}}class qr{constructor(u,l){this.bits=u,this.points=l}getBits(){return this.bits}getPoints(){return this.points}}class Oo extends qr{constructor(u,l,d,h,g){super(u,l),this.compact=d,this.nbDatablocks=h,this.nbLayers=g}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}let ks=(()=>{class D{constructor(l,d,h,g){this.image=l,this.height=l.getHeight(),this.width=l.getWidth(),null==d&&(d=D.INIT_SIZE),null==h&&(h=l.getWidth()/2|0),null==g&&(g=l.getHeight()/2|0);const v=d/2|0;if(this.leftInit=h-v,this.rightInit=h+v,this.upInit=g-v,this.downInit=g+v,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new ce}detect(){let l=this.leftInit,d=this.rightInit,h=this.upInit,g=this.downInit,v=!1,x=!0,b=!1,I=!1,S=!1,k=!1,L=!1;const W=this.width,q=this.height;for(;x;){x=!1;let Z=!0;for(;(Z||!I)&&d<W;)Z=this.containsBlackPoint(h,g,d,!1),Z?(d++,x=!0,I=!0):I||d++;if(d>=W){v=!0;break}let ne=!0;for(;(ne||!S)&&g<q;)ne=this.containsBlackPoint(l,d,g,!0),ne?(g++,x=!0,S=!0):S||g++;if(g>=q){v=!0;break}let ie=!0;for(;(ie||!k)&&l>=0;)ie=this.containsBlackPoint(h,g,l,!1),ie?(l--,x=!0,k=!0):k||l--;if(l<0){v=!0;break}let Ae=!0;for(;(Ae||!L)&&h>=0;)Ae=this.containsBlackPoint(l,d,h,!0),Ae?(h--,x=!0,L=!0):L||h--;if(h<0){v=!0;break}x&&(b=!0)}if(!v&&b){const Z=d-l;let ne=null;for(let de=1;null===ne&&de<Z;de++)ne=this.getBlackPointOnSegment(l,g-de,l+de,g);if(null==ne)throw new ce;let ie=null;for(let de=1;null===ie&&de<Z;de++)ie=this.getBlackPointOnSegment(l,h+de,l+de,h);if(null==ie)throw new ce;let Ae=null;for(let de=1;null===Ae&&de<Z;de++)Ae=this.getBlackPointOnSegment(d,h+de,d-de,h);if(null==Ae)throw new ce;let Me=null;for(let de=1;null===Me&&de<Z;de++)Me=this.getBlackPointOnSegment(d,g-de,d-de,g);if(null==Me)throw new ce;return this.centerEdges(Me,ne,Ae,ie)}throw new ce}getBlackPointOnSegment(l,d,h,g){const v=Vt.round(Vt.distance(l,d,h,g)),x=(h-l)/v,b=(g-d)/v,I=this.image;for(let S=0;S<v;S++){const k=Vt.round(l+S*x),L=Vt.round(d+S*b);if(I.get(k,L))return new Ue(k,L)}return null}centerEdges(l,d,h,g){const v=l.getX(),x=l.getY(),b=d.getX(),I=d.getY(),S=h.getX(),k=h.getY(),L=g.getX(),W=g.getY(),q=D.CORR;return v<this.width/2?[new Ue(L-q,W+q),new Ue(b+q,I+q),new Ue(S-q,k-q),new Ue(v+q,x-q)]:[new Ue(L+q,W+q),new Ue(b+q,I-q),new Ue(S-q,k+q),new Ue(v-q,x-q)]}containsBlackPoint(l,d,h,g){const v=this.image;if(g){for(let x=l;x<=d;x++)if(v.get(x,h))return!0}else for(let x=l;x<=d;x++)if(v.get(h,x))return!0;return!1}}return D.INIT_SIZE=10,D.CORR=1,D})();class ya{static checkAndNudgePoints(u,l){const d=u.getWidth(),h=u.getHeight();let g=!0;for(let v=0;v<l.length&&g;v+=2){const x=Math.floor(l[v]),b=Math.floor(l[v+1]);if(x<-1||x>d||b<-1||b>h)throw new ce;g=!1,-1===x?(l[v]=0,g=!0):x===d&&(l[v]=d-1,g=!0),-1===b?(l[v+1]=0,g=!0):b===h&&(l[v+1]=h-1,g=!0)}g=!0;for(let v=l.length-2;v>=0&&g;v-=2){const x=Math.floor(l[v]),b=Math.floor(l[v+1]);if(x<-1||x>d||b<-1||b>h)throw new ce;g=!1,-1===x?(l[v]=0,g=!0):x===d&&(l[v]=d-1,g=!0),-1===b?(l[v+1]=0,g=!0):b===h&&(l[v+1]=h-1,g=!0)}}}class Xn{constructor(u,l,d,h,g,v,x,b,I){this.a11=u,this.a21=l,this.a31=d,this.a12=h,this.a22=g,this.a32=v,this.a13=x,this.a23=b,this.a33=I}static quadrilateralToQuadrilateral(u,l,d,h,g,v,x,b,I,S,k,L,W,q,Z,ne){const ie=Xn.quadrilateralToSquare(u,l,d,h,g,v,x,b);return Xn.squareToQuadrilateral(I,S,k,L,W,q,Z,ne).times(ie)}transformPoints(u){const l=u.length,d=this.a11,h=this.a12,g=this.a13,v=this.a21,x=this.a22,b=this.a23,I=this.a31,S=this.a32,k=this.a33;for(let L=0;L<l;L+=2){const W=u[L],q=u[L+1],Z=g*W+b*q+k;u[L]=(d*W+v*q+I)/Z,u[L+1]=(h*W+x*q+S)/Z}}transformPointsWithValues(u,l){const d=this.a11,h=this.a12,g=this.a13,v=this.a21,x=this.a22,b=this.a23,I=this.a31,S=this.a32,k=this.a33,L=u.length;for(let W=0;W<L;W++){const q=u[W],Z=l[W],ne=g*q+b*Z+k;u[W]=(d*q+v*Z+I)/ne,l[W]=(h*q+x*Z+S)/ne}}static squareToQuadrilateral(u,l,d,h,g,v,x,b){const I=u-d+g-x,S=l-h+v-b;if(0===I&&0===S)return new Xn(d-u,g-d,u,h-l,v-h,l,0,0,1);{const k=d-g,L=x-g,W=h-v,q=b-v,Z=k*q-L*W,ne=(I*q-L*S)/Z,ie=(k*S-I*W)/Z;return new Xn(d-u+ne*d,x-u+ie*x,u,h-l+ne*h,b-l+ie*b,l,ne,ie,1)}}static quadrilateralToSquare(u,l,d,h,g,v,x,b){return Xn.squareToQuadrilateral(u,l,d,h,g,v,x,b).buildAdjoint()}buildAdjoint(){return new Xn(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(u){return new Xn(this.a11*u.a11+this.a21*u.a12+this.a31*u.a13,this.a11*u.a21+this.a21*u.a22+this.a31*u.a23,this.a11*u.a31+this.a21*u.a32+this.a31*u.a33,this.a12*u.a11+this.a22*u.a12+this.a32*u.a13,this.a12*u.a21+this.a22*u.a22+this.a32*u.a23,this.a12*u.a31+this.a22*u.a32+this.a32*u.a33,this.a13*u.a11+this.a23*u.a12+this.a33*u.a13,this.a13*u.a21+this.a23*u.a22+this.a33*u.a23,this.a13*u.a31+this.a23*u.a32+this.a33*u.a33)}}class Ls extends ya{sampleGrid(u,l,d,h,g,v,x,b,I,S,k,L,W,q,Z,ne,ie,Ae,Me){const de=Xn.quadrilateralToQuadrilateral(h,g,v,x,b,I,S,k,L,W,q,Z,ne,ie,Ae,Me);return this.sampleGridWithTransform(u,l,d,de)}sampleGridWithTransform(u,l,d,h){if(l<=0||d<=0)throw new ce;const g=new Gn(l,d),v=new Float32Array(2*l);for(let x=0;x<d;x++){const b=v.length,I=x+.5;for(let S=0;S<b;S+=2)v[S]=S/2+.5,v[S+1]=I;h.transformPoints(v),ya.checkAndNudgePoints(u,v);try{for(let S=0;S<b;S+=2)u.get(Math.floor(v[S]),Math.floor(v[S+1]))&&g.set(S/2,x)}catch(S){throw new ce}}return g}}class uo{static setGridSampler(u){uo.gridSampler=u}static getInstance(){return uo.gridSampler}}uo.gridSampler=new Ls;class br{constructor(u,l){this.x=u,this.y=l}toResultPoint(){return new Ue(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class qo{constructor(u){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=u}detect(){return this.detectMirror(!1)}detectMirror(u){let l=this.getMatrixCenter(),d=this.getBullsEyeCorners(l);if(u){let v=d[0];d[0]=d[2],d[2]=v}this.extractParameters(d);let h=this.sampleGrid(this.image,d[this.shift%4],d[(this.shift+1)%4],d[(this.shift+2)%4],d[(this.shift+3)%4]),g=this.getMatrixCornerPoints(d);return new Oo(h,g,this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(u){if(!(this.isValidPoint(u[0])&&this.isValidPoint(u[1])&&this.isValidPoint(u[2])&&this.isValidPoint(u[3])))throw new ce;let l=2*this.nbCenterLayers,d=new Int32Array([this.sampleLine(u[0],u[1],l),this.sampleLine(u[1],u[2],l),this.sampleLine(u[2],u[3],l),this.sampleLine(u[3],u[0],l)]);this.shift=this.getRotation(d,l);let h=0;for(let v=0;v<4;v++){let x=d[(this.shift+v)%4];this.compact?(h<<=7,h+=x>>1&127):(h<<=10,h+=(x>>2&992)+(x>>1&31))}let g=this.getCorrectedParameterData(h,this.compact);this.compact?(this.nbLayers=1+(g>>6),this.nbDataBlocks=1+(63&g)):(this.nbLayers=1+(g>>11),this.nbDataBlocks=1+(2047&g))}getRotation(u,l){let d=0;u.forEach((h,g,v)=>{d=(h>>l-2<<1)+(1&h)+(d<<3)}),d=((1&d)<<11)+(d>>1);for(let h=0;h<4;h++)if(Ct.bitCount(d^this.EXPECTED_CORNER_BITS[h])<=2)return h;throw new ce}getCorrectedParameterData(u,l){let d,h;l?(d=7,h=2):(d=10,h=4);let g=d-h,v=new Int32Array(d);for(let b=d-1;b>=0;--b)v[b]=15&u,u>>=4;try{new Ps(Pt.AZTEC_PARAM).decode(v,g)}catch(b){throw new ce}let x=0;for(let b=0;b<h;b++)x=(x<<4)+v[b];return x}getBullsEyeCorners(u){let l=u,d=u,h=u,g=u,v=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let k=this.getFirstDifferent(l,v,1,-1),L=this.getFirstDifferent(d,v,1,1),W=this.getFirstDifferent(h,v,-1,1),q=this.getFirstDifferent(g,v,-1,-1);if(this.nbCenterLayers>2){let Z=this.distancePoint(q,k)*this.nbCenterLayers/(this.distancePoint(g,l)*(this.nbCenterLayers+2));if(Z<.75||Z>1.25||!this.isWhiteOrBlackRectangle(k,L,W,q))break}l=k,d=L,h=W,g=q,v=!v}if(5!==this.nbCenterLayers&&7!==this.nbCenterLayers)throw new ce;this.compact=5===this.nbCenterLayers;let x=new Ue(l.getX()+.5,l.getY()-.5),b=new Ue(d.getX()+.5,d.getY()+.5),I=new Ue(h.getX()-.5,h.getY()+.5),S=new Ue(g.getX()-.5,g.getY()-.5);return this.expandSquare([x,b,I,S],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let u,l,d,h;try{let x=new ks(this.image).detect();u=x[0],l=x[1],d=x[2],h=x[3]}catch(x){let b=this.image.getWidth()/2,I=this.image.getHeight()/2;u=this.getFirstDifferent(new br(b+7,I-7),!1,1,-1).toResultPoint(),l=this.getFirstDifferent(new br(b+7,I+7),!1,1,1).toResultPoint(),d=this.getFirstDifferent(new br(b-7,I+7),!1,-1,1).toResultPoint(),h=this.getFirstDifferent(new br(b-7,I-7),!1,-1,-1).toResultPoint()}let g=Vt.round((u.getX()+h.getX()+l.getX()+d.getX())/4),v=Vt.round((u.getY()+h.getY()+l.getY()+d.getY())/4);try{let x=new ks(this.image,15,g,v).detect();u=x[0],l=x[1],d=x[2],h=x[3]}catch(x){u=this.getFirstDifferent(new br(g+7,v-7),!1,1,-1).toResultPoint(),l=this.getFirstDifferent(new br(g+7,v+7),!1,1,1).toResultPoint(),d=this.getFirstDifferent(new br(g-7,v+7),!1,-1,1).toResultPoint(),h=this.getFirstDifferent(new br(g-7,v-7),!1,-1,-1).toResultPoint()}return g=Vt.round((u.getX()+h.getX()+l.getX()+d.getX())/4),v=Vt.round((u.getY()+h.getY()+l.getY()+d.getY())/4),new br(g,v)}getMatrixCornerPoints(u){return this.expandSquare(u,2*this.nbCenterLayers,this.getDimension())}sampleGrid(u,l,d,h,g){let v=uo.getInstance(),x=this.getDimension(),b=x/2-this.nbCenterLayers,I=x/2+this.nbCenterLayers;return v.sampleGrid(u,x,x,b,b,I,b,I,I,b,I,l.getX(),l.getY(),d.getX(),d.getY(),h.getX(),h.getY(),g.getX(),g.getY())}sampleLine(u,l,d){let h=0,g=this.distanceResultPoint(u,l),v=g/d,x=u.getX(),b=u.getY(),I=v*(l.getX()-u.getX())/g,S=v*(l.getY()-u.getY())/g;for(let k=0;k<d;k++)this.image.get(Vt.round(x+k*I),Vt.round(b+k*S))&&(h|=1<<d-k-1);return h}isWhiteOrBlackRectangle(u,l,d,h){u=new br(u.getX()-3,u.getY()+3),l=new br(l.getX()-3,l.getY()-3),d=new br(d.getX()+3,d.getY()-3),h=new br(h.getX()+3,h.getY()+3);let v=this.getColor(h,u);if(0===v)return!1;let x=this.getColor(u,l);return x===v&&(x=this.getColor(l,d),x===v)&&(x=this.getColor(d,h),x===v)}getColor(u,l){let d=this.distancePoint(u,l),h=(l.getX()-u.getX())/d,g=(l.getY()-u.getY())/d,v=0,x=u.getX(),b=u.getY(),I=this.image.get(u.getX(),u.getY()),S=Math.ceil(d);for(let L=0;L<S;L++)x+=h,b+=g,this.image.get(Vt.round(x),Vt.round(b))!==I&&v++;let k=v/d;return k>.1&&k<.9?0:k<=.1===I?1:-1}getFirstDifferent(u,l,d,h){let g=u.getX()+d,v=u.getY()+h;for(;this.isValid(g,v)&&this.image.get(g,v)===l;)g+=d,v+=h;for(g-=d,v-=h;this.isValid(g,v)&&this.image.get(g,v)===l;)g+=d;for(g-=d;this.isValid(g,v)&&this.image.get(g,v)===l;)v+=h;return v-=h,new br(g,v)}expandSquare(u,l,d){let h=d/(2*l),g=u[0].getX()-u[2].getX(),v=u[0].getY()-u[2].getY(),x=(u[0].getX()+u[2].getX())/2,b=(u[0].getY()+u[2].getY())/2,I=new Ue(x+h*g,b+h*v),S=new Ue(x-h*g,b-h*v);return g=u[1].getX()-u[3].getX(),v=u[1].getY()-u[3].getY(),x=(u[1].getX()+u[3].getX())/2,b=(u[1].getY()+u[3].getY())/2,[I,new Ue(x+h*g,b+h*v),S,new Ue(x-h*g,b-h*v)]}isValid(u,l){return u>=0&&u<this.image.getWidth()&&l>0&&l<this.image.getHeight()}isValidPoint(u){let l=Vt.round(u.getX()),d=Vt.round(u.getY());return this.isValid(l,d)}distancePoint(u,l){return Vt.distance(u.getX(),u.getY(),l.getX(),l.getY())}distanceResultPoint(u,l){return Vt.distance(u.getX(),u.getY(),l.getX(),l.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(Ct.truncDivision(this.nbLayers-4,8)+1)+15}}class Bs{decode(u,l=null){let d=null,h=new qo(u.getBlackMatrix()),g=null,v=null;try{let S=h.detectMirror(!1);g=S.getPoints(),this.reportFoundResultPoints(l,g),v=(new Ni).decode(S)}catch(S){d=S}if(null==v)try{let S=h.detectMirror(!0);g=S.getPoints(),this.reportFoundResultPoints(l,g),v=(new Ni).decode(S)}catch(S){throw null!=d?d:S}let x=new fr(v.getText(),v.getRawBytes(),v.getNumBits(),g,it.AZTEC,en.currentTimeMillis()),b=v.getByteSegments();null!=b&&x.putMetadata(Yn.BYTE_SEGMENTS,b);let I=v.getECLevel();return null!=I&&x.putMetadata(Yn.ERROR_CORRECTION_LEVEL,I),x}reportFoundResultPoints(u,l){if(null!=u){let d=u.get(En.NEED_RESULT_POINT_CALLBACK);null!=d&&l.forEach((h,g,v)=>{d.foundPossibleResultPoint(h)})}}reset(){}}class qn{decode(u,l){try{return this.doDecode(u,l)}catch(d){if(l&&!0===l.get(En.TRY_HARDER)&&u.isRotateSupported()){const g=u.rotateCounterClockwise(),v=this.doDecode(g,l),x=v.getResultMetadata();let b=270;null!==x&&!0===x.get(Yn.ORIENTATION)&&(b+=x.get(Yn.ORIENTATION)%360),v.putMetadata(Yn.ORIENTATION,b);const I=v.getResultPoints();if(null!==I){const S=g.getHeight();for(let k=0;k<I.length;k++)I[k]=new Ue(S-I[k].getY()-1,I[k].getX())}return v}throw new ce}}reset(){}doDecode(u,l){const d=u.getWidth(),h=u.getHeight();let g=new gt(d);const v=l&&!0===l.get(En.TRY_HARDER),x=Math.max(1,h>>(v?8:5));let b;b=v?h:15;const I=Math.trunc(h/2);for(let S=0;S<b;S++){const k=Math.trunc((S+1)/2),W=I+x*(0==(1&S)?k:-k);if(W<0||W>=h)break;try{g=u.getBlackRow(W,g)}catch(q){continue}for(let q=0;q<2;q++){if(1===q&&(g.reverse(),l&&!0===l.get(En.NEED_RESULT_POINT_CALLBACK))){const Z=new Map;l.forEach((ne,ie)=>Z.set(ie,ne)),Z.delete(En.NEED_RESULT_POINT_CALLBACK),l=Z}try{const Z=this.decodeRow(W,g,l);if(1===q){Z.putMetadata(Yn.ORIENTATION,180);const ne=Z.getResultPoints();null!==ne&&(ne[0]=new Ue(d-ne[0].getX()-1,ne[0].getY()),ne[1]=new Ue(d-ne[1].getX()-1,ne[1].getY()))}return Z}catch(Z){}}}throw new ce}static recordPattern(u,l,d){const h=d.length;for(let I=0;I<h;I++)d[I]=0;const g=u.getSize();if(l>=g)throw new ce;let v=!u.get(l),x=0,b=l;for(;b<g;){if(u.get(b)!==v)d[x]++;else{if(++x===h)break;d[x]=1,v=!v}b++}if(x!==h&&(x!==h-1||b!==g))throw new ce}static recordPatternInReverse(u,l,d){let h=d.length,g=u.get(l);for(;l>0&&h>=0;)u.get(--l)!==g&&(h--,g=!g);if(h>=0)throw new ce;qn.recordPattern(u,l+1,d)}static patternMatchVariance(u,l,d){const h=u.length;let g=0,v=0;for(let I=0;I<h;I++)g+=u[I],v+=l[I];if(g<v)return Number.POSITIVE_INFINITY;const x=g/v;d*=x;let b=0;for(let I=0;I<h;I++){const S=u[I],k=l[I]*x,L=S>k?S-k:k-S;if(L>d)return Number.POSITIVE_INFINITY;b+=L}return b/g}}class Te extends qn{static findStartPattern(u){const l=u.getSize(),d=u.getNextSet(0);let h=0,g=Int32Array.from([0,0,0,0,0,0]),v=d,x=!1;for(let I=d;I<l;I++)if(u.get(I)!==x)g[h]++;else{if(5===h){let S=Te.MAX_AVG_VARIANCE,k=-1;for(let L=Te.CODE_START_A;L<=Te.CODE_START_C;L++){const W=qn.patternMatchVariance(g,Te.CODE_PATTERNS[L],Te.MAX_INDIVIDUAL_VARIANCE);W<S&&(S=W,k=L)}if(k>=0&&u.isRange(Math.max(0,v-(I-v)/2),v,!1))return Int32Array.from([v,I,k]);v+=g[0]+g[1],g=g.slice(2,g.length-1),g[h-1]=0,g[h]=0,h--}else h++;g[h]=1,x=!x}throw new ce}static decodeCode(u,l,d){qn.recordPattern(u,d,l);let h=Te.MAX_AVG_VARIANCE,g=-1;for(let v=0;v<Te.CODE_PATTERNS.length;v++){const b=this.patternMatchVariance(l,Te.CODE_PATTERNS[v],Te.MAX_INDIVIDUAL_VARIANCE);b<h&&(h=b,g=v)}if(g>=0)return g;throw new ce}decodeRow(u,l,d){const h=d&&!0===d.get(En.ASSUME_GS1),g=Te.findStartPattern(l),v=g[2];let x=0;const b=new Uint8Array(20);let I;switch(b[x++]=v,v){case Te.CODE_START_A:I=Te.CODE_CODE_A;break;case Te.CODE_START_B:I=Te.CODE_CODE_B;break;case Te.CODE_START_C:I=Te.CODE_CODE_C;break;default:throw new Re}let S=!1,k=!1,L="",W=g[0],q=g[1];const Z=Int32Array.from([0,0,0,0,0,0]);let ne=0,ie=0,Ae=v,Me=0,de=!0,Lt=!1,xt=!1;for(;!S;){const Uu=k;switch(k=!1,ne=ie,ie=Te.decodeCode(l,Z,q),b[x++]=ie,ie!==Te.CODE_STOP&&(de=!0),ie!==Te.CODE_STOP&&(Me++,Ae+=Me*ie),W=q,q+=Z.reduce((Tc,Ji)=>Tc+Ji,0),ie){case Te.CODE_START_A:case Te.CODE_START_B:case Te.CODE_START_C:throw new Re}switch(I){case Te.CODE_CODE_A:if(ie<64)L+=String.fromCharCode(xt===Lt?" ".charCodeAt(0)+ie:" ".charCodeAt(0)+ie+128),xt=!1;else if(ie<96)L+=String.fromCharCode(xt===Lt?ie-64:ie+64),xt=!1;else switch(ie!==Te.CODE_STOP&&(de=!1),ie){case Te.CODE_FNC_1:h&&(L+=0===L.length?"]C1":String.fromCharCode(29));break;case Te.CODE_FNC_2:case Te.CODE_FNC_3:break;case Te.CODE_FNC_4_A:!Lt&&xt?(Lt=!0,xt=!1):Lt&&xt?(Lt=!1,xt=!1):xt=!0;break;case Te.CODE_SHIFT:k=!0,I=Te.CODE_CODE_B;break;case Te.CODE_CODE_B:I=Te.CODE_CODE_B;break;case Te.CODE_CODE_C:I=Te.CODE_CODE_C;break;case Te.CODE_STOP:S=!0}break;case Te.CODE_CODE_B:if(ie<96)L+=String.fromCharCode(xt===Lt?" ".charCodeAt(0)+ie:" ".charCodeAt(0)+ie+128),xt=!1;else switch(ie!==Te.CODE_STOP&&(de=!1),ie){case Te.CODE_FNC_1:h&&(L+=0===L.length?"]C1":String.fromCharCode(29));break;case Te.CODE_FNC_2:case Te.CODE_FNC_3:break;case Te.CODE_FNC_4_B:!Lt&&xt?(Lt=!0,xt=!1):Lt&&xt?(Lt=!1,xt=!1):xt=!0;break;case Te.CODE_SHIFT:k=!0,I=Te.CODE_CODE_A;break;case Te.CODE_CODE_A:I=Te.CODE_CODE_A;break;case Te.CODE_CODE_C:I=Te.CODE_CODE_C;break;case Te.CODE_STOP:S=!0}break;case Te.CODE_CODE_C:if(ie<100)ie<10&&(L+="0"),L+=ie;else switch(ie!==Te.CODE_STOP&&(de=!1),ie){case Te.CODE_FNC_1:h&&(L+=0===L.length?"]C1":String.fromCharCode(29));break;case Te.CODE_CODE_A:I=Te.CODE_CODE_A;break;case Te.CODE_CODE_B:I=Te.CODE_CODE_B;break;case Te.CODE_STOP:S=!0}}Uu&&(I=I===Te.CODE_CODE_A?Te.CODE_CODE_B:Te.CODE_CODE_A)}const Fi=q-W;if(q=l.getNextUnset(q),!l.isRange(q,Math.min(l.getSize(),q+(q-W)/2),!1))throw new ce;if(Ae-=Me*ne,Ae%103!==ne)throw new Dt;const un=L.length;if(0===un)throw new ce;un>0&&de&&(L=L.substring(0,I===Te.CODE_CODE_C?un-2:un-1));const Pi=(g[1]+g[0])/2,bn=W+Fi/2,Vr=b.length,cn=new Uint8Array(Vr);for(let Uu=0;Uu<Vr;Uu++)cn[Uu]=b[Uu];const ou=[new Ue(Pi,u),new Ue(bn,u)];return new fr(L,cn,0,ou,it.CODE_128,(new Date).getTime())}}Te.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],Te.MAX_AVG_VARIANCE=.25,Te.MAX_INDIVIDUAL_VARIANCE=.7,Te.CODE_SHIFT=98,Te.CODE_CODE_C=99,Te.CODE_CODE_B=100,Te.CODE_CODE_A=101,Te.CODE_FNC_1=102,Te.CODE_FNC_2=97,Te.CODE_FNC_3=96,Te.CODE_FNC_4_A=101,Te.CODE_FNC_4_B=100,Te.CODE_START_A=103,Te.CODE_START_B=104,Te.CODE_START_C=105,Te.CODE_STOP=106;let Qa=(()=>{class D extends qn{constructor(l=!1,d=!1){super(),this.usingCheckDigit=l,this.extendedMode=d,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(l,d,h){let g=this.counters;g.fill(0),this.decodeRowResult="";let I,S,v=D.findAsteriskPattern(d,g),x=d.getNextSet(v[1]),b=d.getSize();do{D.recordPattern(d,x,g);let ne=D.toNarrowWidePattern(g);if(ne<0)throw new ce;I=D.patternToChar(ne),this.decodeRowResult+=I,S=x;for(let ie of g)x+=ie;x=d.getNextSet(x)}while("*"!==I);this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let W,k=0;for(let ne of g)k+=ne;if(x!==b&&2*(x-S-k)<k)throw new ce;if(this.usingCheckDigit){let ne=this.decodeRowResult.length-1,ie=0;for(let Ae=0;Ae<ne;Ae++)ie+=D.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(Ae));if(this.decodeRowResult.charAt(ne)!==D.ALPHABET_STRING.charAt(ie%43))throw new Dt;this.decodeRowResult=this.decodeRowResult.substring(0,ne)}if(0===this.decodeRowResult.length)throw new ce;W=this.extendedMode?D.decodeExtended(this.decodeRowResult):this.decodeRowResult;let Z=S+k/2;return new fr(W,null,0,[new Ue((v[1]+v[0])/2,l),new Ue(Z,l)],it.CODE_39,(new Date).getTime())}static findAsteriskPattern(l,d){let h=l.getSize(),g=l.getNextSet(0),v=0,x=g,b=!1,I=d.length;for(let S=g;S<h;S++)if(l.get(S)!==b)d[v]++;else{if(v===I-1){if(this.toNarrowWidePattern(d)===D.ASTERISK_ENCODING&&l.isRange(Math.max(0,x-Math.floor((S-x)/2)),x,!1))return[x,S];x+=d[0]+d[1],d.copyWithin(0,2,2+v-1),d[v-1]=0,d[v]=0,v--}else v++;d[v]=1,b=!b}throw new ce}static toNarrowWidePattern(l){let g,d=l.length,h=0;do{let v=2147483647;for(let I of l)I<v&&I>h&&(v=I);h=v,g=0;let x=0,b=0;for(let I=0;I<d;I++){let S=l[I];S>h&&(b|=1<<d-1-I,g++,x+=S)}if(3===g){for(let I=0;I<d&&g>0;I++){let S=l[I];if(S>h&&(g--,2*S>=x))return-1}return b}}while(g>3);return-1}static patternToChar(l){for(let d=0;d<D.CHARACTER_ENCODINGS.length;d++)if(D.CHARACTER_ENCODINGS[d]===l)return D.ALPHABET_STRING.charAt(d);if(l===D.ASTERISK_ENCODING)return"*";throw new ce}static decodeExtended(l){let d=l.length,h="";for(let g=0;g<d;g++){let v=l.charAt(g);if("+"===v||"$"===v||"%"===v||"/"===v){let x=l.charAt(g+1),b="\0";switch(v){case"+":if(!(x>="A"&&x<="Z"))throw new Re;b=String.fromCharCode(x.charCodeAt(0)+32);break;case"$":if(!(x>="A"&&x<="Z"))throw new Re;b=String.fromCharCode(x.charCodeAt(0)-64);break;case"%":if(x>="A"&&x<="E")b=String.fromCharCode(x.charCodeAt(0)-38);else if(x>="F"&&x<="J")b=String.fromCharCode(x.charCodeAt(0)-11);else if(x>="K"&&x<="O")b=String.fromCharCode(x.charCodeAt(0)+16);else if(x>="P"&&x<="T")b=String.fromCharCode(x.charCodeAt(0)+43);else if("U"===x)b="\0";else if("V"===x)b="@";else if("W"===x)b="`";else{if("X"!==x&&"Y"!==x&&"Z"!==x)throw new Re;b="\x7f"}break;case"/":if(x>="A"&&x<="O")b=String.fromCharCode(x.charCodeAt(0)-32);else{if("Z"!==x)throw new Re;b=":"}}h+=b,g++}else h+=v}return h}}return D.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",D.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],D.ASTERISK_ENCODING=148,D})();class on extends qn{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(u,l,d){let h=this.decodeStart(l),g=this.decodeEnd(l),v=new rn;on.decodeMiddle(l,h[1],g[0],v);let x=v.toString(),b=null;null!=d&&(b=d.get(En.ALLOWED_LENGTHS)),null==b&&(b=on.DEFAULT_ALLOWED_LENGTHS);let I=x.length,S=!1,k=0;for(let q of b){if(I===q){S=!0;break}q>k&&(k=q)}if(!S&&I>k&&(S=!0),!S)throw new Re;const L=[new Ue(h[1],u),new Ue(g[0],u)];return new fr(x,null,0,L,it.ITF,(new Date).getTime())}static decodeMiddle(u,l,d,h){let g=new Int32Array(10),v=new Int32Array(5),x=new Int32Array(5);for(g.fill(0),v.fill(0),x.fill(0);l<d;){qn.recordPattern(u,l,g);for(let I=0;I<5;I++){let S=2*I;v[I]=g[S],x[I]=g[S+1]}let b=on.decodeDigit(v);h.append(b.toString()),b=this.decodeDigit(x),h.append(b.toString()),g.forEach(function(I){l+=I})}}decodeStart(u){let l=on.skipWhiteSpace(u),d=on.findGuardPattern(u,l,on.START_PATTERN);return this.narrowLineWidth=(d[1]-d[0])/4,this.validateQuietZone(u,d[0]),d}validateQuietZone(u,l){let d=10*this.narrowLineWidth;d=d<l?d:l;for(let h=l-1;d>0&&h>=0&&!u.get(h);h--)d--;if(0!==d)throw new ce}static skipWhiteSpace(u){const l=u.getSize(),d=u.getNextSet(0);if(d===l)throw new ce;return d}decodeEnd(u){u.reverse();try{let d,l=on.skipWhiteSpace(u);try{d=on.findGuardPattern(u,l,on.END_PATTERN_REVERSED[0])}catch(g){g instanceof ce&&(d=on.findGuardPattern(u,l,on.END_PATTERN_REVERSED[1]))}this.validateQuietZone(u,d[0]);let h=d[0];return d[0]=u.getSize()-d[1],d[1]=u.getSize()-h,d}finally{u.reverse()}}static findGuardPattern(u,l,d){let h=d.length,g=new Int32Array(h),v=u.getSize(),x=!1,b=0,I=l;g.fill(0);for(let S=l;S<v;S++)if(u.get(S)!==x)g[b]++;else{if(b===h-1){if(qn.patternMatchVariance(g,d,on.MAX_INDIVIDUAL_VARIANCE)<on.MAX_AVG_VARIANCE)return[I,S];I+=g[0]+g[1],en.arraycopy(g,2,g,0,b-1),g[b-1]=0,g[b]=0,b--}else b++;g[b]=1,x=!x}throw new ce}static decodeDigit(u){let l=on.MAX_AVG_VARIANCE,d=-1,h=on.PATTERNS.length;for(let g=0;g<h;g++){let x=qn.patternMatchVariance(u,on.PATTERNS[g],on.MAX_INDIVIDUAL_VARIANCE);x<l?(l=x,d=g):x===l&&(d=-1)}if(d>=0)return d%10;throw new ce}}on.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],on.MAX_AVG_VARIANCE=.38,on.MAX_INDIVIDUAL_VARIANCE=.5,on.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],on.START_PATTERN=Int32Array.from([1,1,1,1]),on.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class Pn extends qn{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(u){let d,l=!1,h=0,g=Int32Array.from([0,0,0]);for(;!l;){g=Int32Array.from([0,0,0]),d=Pn.findGuardPattern(u,h,!1,this.START_END_PATTERN,g);let v=d[0];h=d[1];let x=v-(h-v);x>=0&&(l=u.isRange(x,v,!1))}return d}static checkChecksum(u){return Pn.checkStandardUPCEANChecksum(u)}static checkStandardUPCEANChecksum(u){let l=u.length;if(0===l)return!1;let d=parseInt(u.charAt(l-1),10);return Pn.getStandardUPCEANChecksum(u.substring(0,l-1))===d}static getStandardUPCEANChecksum(u){let l=u.length,d=0;for(let h=l-1;h>=0;h-=2){let g=u.charAt(h).charCodeAt(0)-"0".charCodeAt(0);if(g<0||g>9)throw new Re;d+=g}d*=3;for(let h=l-2;h>=0;h-=2){let g=u.charAt(h).charCodeAt(0)-"0".charCodeAt(0);if(g<0||g>9)throw new Re;d+=g}return(1e3-d)%10}static decodeEnd(u,l){return Pn.findGuardPattern(u,l,!1,Pn.START_END_PATTERN,new Int32Array(Pn.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(u,l,d,h){return this.findGuardPattern(u,l,d,h,new Int32Array(h.length))}static findGuardPattern(u,l,d,h,g){let v=u.getSize(),x=0,b=l=d?u.getNextUnset(l):u.getNextSet(l),I=h.length,S=d;for(let k=l;k<v;k++)if(u.get(k)!==S)g[x]++;else{if(x===I-1){if(qn.patternMatchVariance(g,h,Pn.MAX_INDIVIDUAL_VARIANCE)<Pn.MAX_AVG_VARIANCE)return Int32Array.from([b,k]);b+=g[0]+g[1];let L=g.slice(2,g.length-1);for(let W=0;W<x-1;W++)g[W]=L[W];g[x-1]=0,g[x]=0,x--}else x++;g[x]=1,S=!S}throw new ce}static decodeDigit(u,l,d,h){this.recordPattern(u,d,l);let g=this.MAX_AVG_VARIANCE,v=-1,x=h.length;for(let b=0;b<x;b++){let S=qn.patternMatchVariance(l,h[b],Pn.MAX_INDIVIDUAL_VARIANCE);S<g&&(g=S,v=b)}if(v>=0)return v;throw new ce}}Pn.MAX_AVG_VARIANCE=.48,Pn.MAX_INDIVIDUAL_VARIANCE=.7,Pn.START_END_PATTERN=Int32Array.from([1,1,1]),Pn.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),Pn.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Pn.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class Ko{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(u,l,d){let h=this.decodeRowStringBuffer,g=this.decodeMiddle(l,d,h),v=h.toString(),x=Ko.parseExtensionString(v),b=[new Ue((d[0]+d[1])/2,u),new Ue(g,u)],I=new fr(v,null,0,b,it.UPC_EAN_EXTENSION,(new Date).getTime());return null!=x&&I.putAllMetadata(x),I}decodeMiddle(u,l,d){let h=this.decodeMiddleCounters;h[0]=0,h[1]=0,h[2]=0,h[3]=0;let g=u.getSize(),v=l[1],x=0;for(let I=0;I<5&&v<g;I++){let S=Pn.decodeDigit(u,h,v,Pn.L_AND_G_PATTERNS);d+=String.fromCharCode("0".charCodeAt(0)+S%10);for(let k of h)v+=k;S>=10&&(x|=1<<4-I),4!==I&&(v=u.getNextSet(v),v=u.getNextUnset(v))}if(5!==d.length)throw new ce;let b=this.determineCheckDigit(x);if(Ko.extensionChecksum(d.toString())!==b)throw new ce;return v}static extensionChecksum(u){let l=u.length,d=0;for(let h=l-2;h>=0;h-=2)d+=u.charAt(h).charCodeAt(0)-"0".charCodeAt(0);d*=3;for(let h=l-1;h>=0;h-=2)d+=u.charAt(h).charCodeAt(0)-"0".charCodeAt(0);return d*=3,d%10}determineCheckDigit(u){for(let l=0;l<10;l++)if(u===this.CHECK_DIGIT_ENCODINGS[l])return l;throw new ce}static parseExtensionString(u){if(5!==u.length)return null;let l=Ko.parseExtension5String(u);return null==l?null:new Map([[Yn.SUGGESTED_PRICE,l]])}static parseExtension5String(u){let l;switch(u.charAt(0)){case"0":l="\xa3";break;case"5":l="$";break;case"9":switch(u){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}l="";break;default:l=""}let d=parseInt(u.substring(1)),g=d%100;return l+(d/100).toString()+"."+(g<10?"0"+g:g.toString())}}class Qo{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(u,l,d){let h=this.decodeRowStringBuffer,g=this.decodeMiddle(l,d,h),v=h.toString(),x=Qo.parseExtensionString(v),b=[new Ue((d[0]+d[1])/2,u),new Ue(g,u)],I=new fr(v,null,0,b,it.UPC_EAN_EXTENSION,(new Date).getTime());return null!=x&&I.putAllMetadata(x),I}decodeMiddle(u,l,d){let h=this.decodeMiddleCounters;h[0]=0,h[1]=0,h[2]=0,h[3]=0;let g=u.getSize(),v=l[1],x=0;for(let b=0;b<2&&v<g;b++){let I=Pn.decodeDigit(u,h,v,Pn.L_AND_G_PATTERNS);d+=String.fromCharCode("0".charCodeAt(0)+I%10);for(let S of h)v+=S;I>=10&&(x|=1<<1-b),1!==b&&(v=u.getNextSet(v),v=u.getNextUnset(v))}if(2!==d.length)throw new ce;if(parseInt(d.toString())%4!==x)throw new ce;return v}static parseExtensionString(u){return 2!==u.length?null:new Map([[Yn.ISSUE_NUMBER,parseInt(u)]])}}class Mu{static decodeRow(u,l,d){let h=Pn.findGuardPattern(l,d,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return(new Ko).decodeRow(u,l,h)}catch(g){return(new Qo).decodeRow(u,l,h)}}}Mu.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class Yt extends Pn{constructor(){super(),this.decodeRowStringBuffer="",Yt.L_AND_G_PATTERNS=Yt.L_PATTERNS.map(u=>Int32Array.from(u));for(let u=10;u<20;u++){let l=Yt.L_PATTERNS[u-10],d=new Int32Array(l.length);for(let h=0;h<l.length;h++)d[h]=l[l.length-h-1];Yt.L_AND_G_PATTERNS[u]=d}}decodeRow(u,l,d){let h=Yt.findStartGuardPattern(l),g=null==d?null:d.get(En.NEED_RESULT_POINT_CALLBACK);if(null!=g){const de=new Ue((h[0]+h[1])/2,u);g.foundPossibleResultPoint(de)}let v=this.decodeMiddle(l,h,this.decodeRowStringBuffer),x=v.rowOffset,b=v.resultString;if(null!=g){const de=new Ue(x,u);g.foundPossibleResultPoint(de)}let I=Yt.decodeEnd(l,x);if(null!=g){const de=new Ue((I[0]+I[1])/2,u);g.foundPossibleResultPoint(de)}let S=I[1],k=S+(S-I[0]);if(k>=l.getSize()||!l.isRange(S,k,!1))throw new ce;let L=b.toString();if(L.length<8)throw new Re;if(!Yt.checkChecksum(L))throw new Dt;let W=(h[1]+h[0])/2,q=(I[1]+I[0])/2,Z=this.getBarcodeFormat(),ne=[new Ue(W,u),new Ue(q,u)],ie=new fr(L,null,0,ne,Z,(new Date).getTime()),Ae=0;try{let de=Mu.decodeRow(u,l,I[1]);ie.putMetadata(Yn.UPC_EAN_EXTENSION,de.getText()),ie.putAllMetadata(de.getResultMetadata()),ie.addResultPoints(de.getResultPoints()),Ae=de.getText().length}catch(de){}let Me=null==d?null:d.get(En.ALLOWED_EAN_EXTENSIONS);if(null!=Me){let de=!1;for(let Lt in Me)if(Ae.toString()===Lt){de=!0;break}if(!de)throw new ce}return ie}static checkChecksum(u){return Yt.checkStandardUPCEANChecksum(u)}static checkStandardUPCEANChecksum(u){let l=u.length;if(0===l)return!1;let d=parseInt(u.charAt(l-1),10);return Yt.getStandardUPCEANChecksum(u.substring(0,l-1))===d}static getStandardUPCEANChecksum(u){let l=u.length,d=0;for(let h=l-1;h>=0;h-=2){let g=u.charAt(h).charCodeAt(0)-"0".charCodeAt(0);if(g<0||g>9)throw new Re;d+=g}d*=3;for(let h=l-2;h>=0;h-=2){let g=u.charAt(h).charCodeAt(0)-"0".charCodeAt(0);if(g<0||g>9)throw new Re;d+=g}return(1e3-d)%10}static decodeEnd(u,l){return Yt.findGuardPattern(u,l,!1,Yt.START_END_PATTERN,new Int32Array(Yt.START_END_PATTERN.length).fill(0))}}let $a=(()=>{class D extends Yt{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(l,d,h){let g=this.decodeMiddleCounters;g[0]=0,g[1]=0,g[2]=0,g[3]=0;let v=l.getSize(),x=d[1],b=0;for(let S=0;S<6&&x<v;S++){let k=Yt.decodeDigit(l,g,x,Yt.L_AND_G_PATTERNS);h+=String.fromCharCode("0".charCodeAt(0)+k%10);for(let L of g)x+=L;k>=10&&(b|=1<<5-S)}h=D.determineFirstDigit(h,b),x=Yt.findGuardPattern(l,x,!0,Yt.MIDDLE_PATTERN,new Int32Array(Yt.MIDDLE_PATTERN.length).fill(0))[1];for(let S=0;S<6&&x<v;S++){let k=Yt.decodeDigit(l,g,x,Yt.L_PATTERNS);h+=String.fromCharCode("0".charCodeAt(0)+k);for(let L of g)x+=L}return{rowOffset:x,resultString:h}}getBarcodeFormat(){return it.EAN_13}static determineFirstDigit(l,d){for(let h=0;h<10;h++)if(d===this.FIRST_DIGIT_ENCODINGS[h])return String.fromCharCode("0".charCodeAt(0)+h)+l;throw new ce}}return D.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26],D})();class Xt extends Yt{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(u,l,d){const h=this.decodeMiddleCounters;h[0]=0,h[1]=0,h[2]=0,h[3]=0;let g=u.getSize(),v=l[1];for(let b=0;b<4&&v<g;b++){let I=Yt.decodeDigit(u,h,v,Yt.L_PATTERNS);d+=String.fromCharCode("0".charCodeAt(0)+I);for(let S of h)v+=S}v=Yt.findGuardPattern(u,v,!0,Yt.MIDDLE_PATTERN,new Int32Array(Yt.MIDDLE_PATTERN.length).fill(0))[1];for(let b=0;b<4&&v<g;b++){let I=Yt.decodeDigit(u,h,v,Yt.L_PATTERNS);d+=String.fromCharCode("0".charCodeAt(0)+I);for(let S of h)v+=S}return{rowOffset:v,resultString:d}}getBarcodeFormat(){return it.EAN_8}}class Za extends Yt{constructor(){super(...arguments),this.ean13Reader=new $a}getBarcodeFormat(){return it.UPC_A}decode(u,l){return this.maybeReturnResult(this.ean13Reader.decode(u))}decodeRow(u,l,d){return this.maybeReturnResult(this.ean13Reader.decodeRow(u,l,d))}decodeMiddle(u,l,d){return this.ean13Reader.decodeMiddle(u,l,d)}maybeReturnResult(u){let l=u.getText();if("0"===l.charAt(0)){let d=new fr(l.substring(1),null,null,u.getResultPoints(),it.UPC_A);return null!=u.getResultMetadata()&&d.putAllMetadata(u.getResultMetadata()),d}throw new ce}reset(){this.ean13Reader.reset()}}class ut extends Yt{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(u,l,d){const h=this.decodeMiddleCounters.map(b=>b);h[0]=0,h[1]=0,h[2]=0,h[3]=0;const g=u.getSize();let v=l[1],x=0;for(let b=0;b<6&&v<g;b++){const I=ut.decodeDigit(u,h,v,ut.L_AND_G_PATTERNS);d+=String.fromCharCode("0".charCodeAt(0)+I%10);for(let S of h)v+=S;I>=10&&(x|=1<<5-b)}return ut.determineNumSysAndCheckDigit(new rn(d),x),v}decodeEnd(u,l){return ut.findGuardPatternWithoutCounters(u,l,!0,ut.MIDDLE_END_PATTERN)}checkChecksum(u){return Yt.checkChecksum(ut.convertUPCEtoUPCA(u))}static determineNumSysAndCheckDigit(u,l){for(let d=0;d<=1;d++)for(let h=0;h<10;h++)if(l===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[d][h])return u.insert(0,"0"+d),void u.append("0"+h);throw ce.getNotFoundInstance()}getBarcodeFormat(){return it.UPC_E}static convertUPCEtoUPCA(u){const l=u.slice(1,7).split("").map(g=>g.charCodeAt(0)),d=new rn;d.append(u.charAt(0));let h=l[5];switch(h){case 0:case 1:case 2:d.appendChars(l,0,2),d.append(h),d.append("0000"),d.appendChars(l,2,3);break;case 3:d.appendChars(l,0,3),d.append("00000"),d.appendChars(l,3,2);break;case 4:d.appendChars(l,0,4),d.append("00000"),d.append(l[4]);break;default:d.appendChars(l,0,5),d.append("0000"),d.append(h)}return u.length>=8&&d.append(u.charAt(7)),d.toString()}}ut.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),ut.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,1])];class Ar extends qn{constructor(u){super();let l=null==u?null:u.get(En.POSSIBLE_FORMATS),d=[];null!=l&&(l.indexOf(it.EAN_13)>-1?d.push(new $a):l.indexOf(it.UPC_A)>-1&&d.push(new Za),l.indexOf(it.EAN_8)>-1&&d.push(new Xt),l.indexOf(it.UPC_E)>-1&&d.push(new ut)),0===d.length&&(d.push(new $a),d.push(new Xt),d.push(new ut)),this.readers=d}decodeRow(u,l,d){for(let h of this.readers)try{const g=h.decodeRow(u,l,d),v=g.getBarcodeFormat()===it.EAN_13&&"0"===g.getText().charAt(0),x=null==d?null:d.get(En.POSSIBLE_FORMATS),b=null==x||x.includes(it.UPC_A);if(v&&b){const I=g.getRawBytes(),S=new fr(g.getText().substring(1),I,I.length,g.getResultPoints(),it.UPC_A);return S.putAllMetadata(g.getResultMetadata()),S}return g}catch(g){}throw new ce}reset(){for(let u of this.readers)u.reset()}}let Ki=(()=>{class D extends qn{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=new Array(4),this.evenRoundingErrors=new Array(4),this.oddCounts=new Array(this.dataCharacterCounters.length/2),this.evenCounts=new Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(l,d){for(let h=0;h<d.length;h++)if(qn.patternMatchVariance(l,d[h],D.MAX_INDIVIDUAL_VARIANCE)<D.MAX_AVG_VARIANCE)return h;throw new ce}static count(l){return Vt.sum(new Int32Array(l))}static increment(l,d){let h=0,g=d[0];for(let v=1;v<l.length;v++)d[v]>g&&(g=d[v],h=v);l[h]++}static decrement(l,d){let h=0,g=d[0];for(let v=1;v<l.length;v++)d[v]<g&&(g=d[v],h=v);l[h]--}static isFinderPattern(l){let d=l[0]+l[1],g=d/(d+l[2]+l[3]);if(g>=D.MIN_FINDER_PATTERN_RATIO&&g<=D.MAX_FINDER_PATTERN_RATIO){let v=Number.MAX_SAFE_INTEGER,x=Number.MIN_SAFE_INTEGER;for(let b of l)b>x&&(x=b),b<v&&(v=b);return x<10*v}return!1}}return D.MAX_AVG_VARIANCE=.2,D.MAX_INDIVIDUAL_VARIANCE=.45,D.MIN_FINDER_PATTERN_RATIO=9.5/12,D.MAX_FINDER_PATTERN_RATIO=12.5/14,D})();class co{constructor(u,l){this.value=u,this.checksumPortion=l}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(u){return u instanceof co&&this.value===u.value&&this.checksumPortion===u.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class Le{constructor(u,l,d,h,g){this.value=u,this.startEnd=l,this.value=u,this.startEnd=l,this.resultPoints=new Array,this.resultPoints.push(new Ue(d,g)),this.resultPoints.push(new Ue(h,g))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(u){return u instanceof Le&&this.value===u.value}hashCode(){return this.value}}class di{constructor(){}static getRSSvalue(u,l,d){let h=0;for(let b of u)h+=b;let g=0,v=0,x=u.length;for(let b=0;b<x-1;b++){let I;for(I=1,v|=1<<b;I<u[b];I++,v&=~(1<<b)){let S=di.combins(h-I-1,x-b-2);if(d&&0===v&&h-I-(x-b-1)>=x-b-1&&(S-=di.combins(h-I-(x-b),x-b-2)),x-b-1>1){let k=0;for(let L=h-I-(x-b-2);L>l;L--)k+=di.combins(h-I-L-1,x-b-3);S-=k*(x-1-b)}else h-I>l&&S--;g+=S}h-=I}return g}static combins(u,l){let d,h;u-l>l?(h=l,d=u-l):(h=u-l,d=l);let g=1,v=1;for(let x=u;x>d;x--)g*=x,v<=h&&(g/=v,v++);for(;v<=h;)g/=v,v++;return g}}class Zt{constructor(u,l){l?this.decodedInformation=null:(this.finished=u,this.decodedInformation=l)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class Ja{constructor(u){this.newPosition=u}getNewPosition(){return this.newPosition}}let Kr=(()=>{class D extends Ja{constructor(l,d){super(l),this.value=d}getValue(){return this.value}isFNC1(){return this.value===D.FNC1}}return D.FNC1="$",D})();class nt extends Ja{constructor(u,l,d){super(u),d?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=l}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}let Un=(()=>{class D extends Ja{constructor(l,d,h){if(super(l),d<0||d>10||h<0||h>10)throw new Re;this.firstDigit=d,this.secondDigit=h}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return 10*this.firstDigit+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===D.FNC1}isSecondDigitFNC1(){return this.secondDigit===D.FNC1}isAnyFNC1(){return this.firstDigit===D.FNC1||this.secondDigit===D.FNC1}}return D.FNC1=10,D})();class Be{constructor(){}static parseFieldsInGeneralPurpose(u){if(!u)return null;if(u.length<2)throw new ce;let l=u.substring(0,2);for(let g of Be.TWO_DIGIT_DATA_LENGTH)if(g[0]===l)return g[1]===Be.VARIABLE_LENGTH?Be.processVariableAI(2,g[2],u):Be.processFixedAI(2,g[1],u);if(u.length<3)throw new ce;let d=u.substring(0,3);for(let g of Be.THREE_DIGIT_DATA_LENGTH)if(g[0]===d)return g[1]===Be.VARIABLE_LENGTH?Be.processVariableAI(3,g[2],u):Be.processFixedAI(3,g[1],u);for(let g of Be.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(g[0]===d)return g[1]===Be.VARIABLE_LENGTH?Be.processVariableAI(4,g[2],u):Be.processFixedAI(4,g[1],u);if(u.length<4)throw new ce;let h=u.substring(0,4);for(let g of Be.FOUR_DIGIT_DATA_LENGTH)if(g[0]===h)return g[1]===Be.VARIABLE_LENGTH?Be.processVariableAI(4,g[2],u):Be.processFixedAI(4,g[1],u);throw new ce}static processFixedAI(u,l,d){if(d.length<u)throw new ce;let h=d.substring(0,u);if(d.length<u+l)throw new ce;let g=d.substring(u,u+l),v=d.substring(u+l),x="("+h+")"+g,b=Be.parseFieldsInGeneralPurpose(v);return null==b?x:x+b}static processVariableAI(u,l,d){let g,h=d.substring(0,u);g=d.length<u+l?d.length:u+l;let v=d.substring(u,g),x=d.substring(g),b="("+h+")"+v,I=Be.parseFieldsInGeneralPurpose(x);return null==I?b:b+I}}Be.VARIABLE_LENGTH=[],Be.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",Be.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",Be.VARIABLE_LENGTH,20],["22",Be.VARIABLE_LENGTH,29],["30",Be.VARIABLE_LENGTH,8],["37",Be.VARIABLE_LENGTH,8],["90",Be.VARIABLE_LENGTH,30],["91",Be.VARIABLE_LENGTH,30],["92",Be.VARIABLE_LENGTH,30],["93",Be.VARIABLE_LENGTH,30],["94",Be.VARIABLE_LENGTH,30],["95",Be.VARIABLE_LENGTH,30],["96",Be.VARIABLE_LENGTH,30],["97",Be.VARIABLE_LENGTH,3],["98",Be.VARIABLE_LENGTH,30],["99",Be.VARIABLE_LENGTH,30]],Be.THREE_DIGIT_DATA_LENGTH=[["240",Be.VARIABLE_LENGTH,30],["241",Be.VARIABLE_LENGTH,30],["242",Be.VARIABLE_LENGTH,6],["250",Be.VARIABLE_LENGTH,30],["251",Be.VARIABLE_LENGTH,30],["253",Be.VARIABLE_LENGTH,17],["254",Be.VARIABLE_LENGTH,20],["400",Be.VARIABLE_LENGTH,30],["401",Be.VARIABLE_LENGTH,30],["402",17],["403",Be.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",Be.VARIABLE_LENGTH,20],["421",Be.VARIABLE_LENGTH,15],["422",3],["423",Be.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],Be.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",Be.VARIABLE_LENGTH,15],["391",Be.VARIABLE_LENGTH,18],["392",Be.VARIABLE_LENGTH,15],["393",Be.VARIABLE_LENGTH,18],["703",Be.VARIABLE_LENGTH,30]],Be.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",Be.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",Be.VARIABLE_LENGTH,20],["8003",Be.VARIABLE_LENGTH,30],["8004",Be.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",Be.VARIABLE_LENGTH,30],["8008",Be.VARIABLE_LENGTH,12],["8018",18],["8020",Be.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",Be.VARIABLE_LENGTH,70],["8200",Be.VARIABLE_LENGTH,70]];class $o{constructor(u){this.buffer=new rn,this.information=u}decodeAllCodes(u,l){let d=l,h=null;for(;;){let g=this.decodeGeneralPurposeField(d,h),v=Be.parseFieldsInGeneralPurpose(g.getNewString());if(null!=v&&u.append(v),h=g.isRemaining()?""+g.getRemainingValue():null,d===g.getNewPosition())break;d=g.getNewPosition()}return u.toString()}isStillNumeric(u){if(u+7>this.information.getSize())return u+4<=this.information.getSize();for(let l=u;l<u+3;++l)if(this.information.get(l))return!0;return this.information.get(u+3)}decodeNumeric(u){if(u+7>this.information.getSize()){let g=this.extractNumericValueFromBitArray(u,4);return new Un(this.information.getSize(),0===g?Un.FNC1:g-1,Un.FNC1)}let l=this.extractNumericValueFromBitArray(u,7);return new Un(u+7,(l-8)/11,(l-8)%11)}extractNumericValueFromBitArray(u,l){return $o.extractNumericValueFromBitArray(this.information,u,l)}static extractNumericValueFromBitArray(u,l,d){let h=0;for(let g=0;g<d;++g)u.get(l+g)&&(h|=1<<d-g-1);return h}decodeGeneralPurposeField(u,l){this.buffer.setLengthToZero(),null!=l&&this.buffer.append(l),this.current.setPosition(u);let d=this.parseBlocks();return null!=d&&d.isRemaining()?new nt(this.current.getPosition(),this.buffer.toString(),d.getRemainingValue()):new nt(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let u,l;do{let d=this.current.getPosition();if(this.current.isAlpha()?(l=this.parseAlphaBlock(),u=l.isFinished()):this.current.isIsoIec646()?(l=this.parseIsoIec646Block(),u=l.isFinished()):(l=this.parseNumericBlock(),u=l.isFinished()),d===this.current.getPosition()&&!u)break}while(!u);return l.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let u=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(u.getNewPosition()),u.isFirstDigitFNC1()){let l;return l=u.isSecondDigitFNC1()?new nt(this.current.getPosition(),this.buffer.toString()):new nt(this.current.getPosition(),this.buffer.toString(),u.getSecondDigit()),new Zt(!0,l)}if(this.buffer.append(u.getFirstDigit()),u.isSecondDigitFNC1()){let l=new nt(this.current.getPosition(),this.buffer.toString());return new Zt(!0,l)}this.buffer.append(u.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new Zt(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let u=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(u.getNewPosition()),u.isFNC1()){let l=new nt(this.current.getPosition(),this.buffer.toString());return new Zt(!0,l)}this.buffer.append(u.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new Zt(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let u=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(u.getNewPosition()),u.isFNC1()){let l=new nt(this.current.getPosition(),this.buffer.toString());return new Zt(!0,l)}this.buffer.append(u.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new Zt(!1)}isStillIsoIec646(u){if(u+5>this.information.getSize())return!1;let l=this.extractNumericValueFromBitArray(u,5);if(l>=5&&l<16)return!0;if(u+7>this.information.getSize())return!1;let d=this.extractNumericValueFromBitArray(u,7);if(d>=64&&d<116)return!0;if(u+8>this.information.getSize())return!1;let h=this.extractNumericValueFromBitArray(u,8);return h>=232&&h<253}decodeIsoIec646(u){let l=this.extractNumericValueFromBitArray(u,5);if(15===l)return new Kr(u+5,Kr.FNC1);if(l>=5&&l<15)return new Kr(u+5,"0"+(l-5));let g,d=this.extractNumericValueFromBitArray(u,7);if(d>=64&&d<90)return new Kr(u+7,""+(d+1));if(d>=90&&d<116)return new Kr(u+7,""+(d+7));switch(this.extractNumericValueFromBitArray(u,8)){case 232:g="!";break;case 233:g='"';break;case 234:g="%";break;case 235:g="&";break;case 236:g="'";break;case 237:g="(";break;case 238:g=")";break;case 239:g="*";break;case 240:g="+";break;case 241:g=",";break;case 242:g="-";break;case 243:g=".";break;case 244:g="/";break;case 245:g=":";break;case 246:g=";";break;case 247:g="<";break;case 248:g="=";break;case 249:g=">";break;case 250:g="?";break;case 251:g="_";break;case 252:g=" ";break;default:throw new Re}return new Kr(u+8,g)}isStillAlpha(u){if(u+5>this.information.getSize())return!1;let l=this.extractNumericValueFromBitArray(u,5);if(l>=5&&l<16)return!0;if(u+6>this.information.getSize())return!1;let d=this.extractNumericValueFromBitArray(u,6);return d>=16&&d<63}decodeAlphanumeric(u){let l=this.extractNumericValueFromBitArray(u,5);if(15===l)return new Kr(u+5,Kr.FNC1);if(l>=5&&l<15)return new Kr(u+5,"0"+(l-5));let h,d=this.extractNumericValueFromBitArray(u,6);if(d>=32&&d<58)return new Kr(u+6,""+(d+33));switch(d){case 58:h="*";break;case 59:h=",";break;case 60:h="-";break;case 61:h=".";break;case 62:h="/";break;default:throw new ao("Decoding invalid alphanumeric value: "+d)}return new Kr(u+6,h)}isAlphaTo646ToAlphaLatch(u){if(u+1>this.information.getSize())return!1;for(let l=0;l<5&&l+u<this.information.getSize();++l)if(2===l){if(!this.information.get(u+2))return!1}else if(this.information.get(u+l))return!1;return!0}isAlphaOr646ToNumericLatch(u){if(u+3>this.information.getSize())return!1;for(let l=u;l<u+3;++l)if(this.information.get(l))return!1;return!0}isNumericToAlphaNumericLatch(u){if(u+1>this.information.getSize())return!1;for(let l=0;l<4&&l+u<this.information.getSize();++l)if(this.information.get(u+l))return!1;return!0}}class Ql{constructor(u){this.information=u,this.generalDecoder=new $o(u)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}let dr=(()=>{class D extends Ql{constructor(l){super(l)}encodeCompressedGtin(l,d){l.append("(01)");let h=l.length();l.append("9"),this.encodeCompressedGtinWithoutAI(l,d,h)}encodeCompressedGtinWithoutAI(l,d,h){for(let g=0;g<4;++g){let v=this.getGeneralDecoder().extractNumericValueFromBitArray(d+10*g,10);v/100==0&&l.append("0"),v/10==0&&l.append("0"),l.append(v)}D.appendCheckDigit(l,h)}static appendCheckDigit(l,d){let h=0;for(let g=0;g<13;g++){let v=l.charAt(g+d).charCodeAt(0)-"0".charCodeAt(0);h+=0==(1&g)?3*v:v}h=10-h%10,10===h&&(h=0),l.append(h)}}return D.GTIN_SIZE=40,D})(),Lr=(()=>{class D extends dr{constructor(l){super(l)}parseInformation(){let l=new rn;l.append("(01)");let d=l.length(),h=this.getGeneralDecoder().extractNumericValueFromBitArray(D.HEADER_SIZE,4);return l.append(h),this.encodeCompressedGtinWithoutAI(l,D.HEADER_SIZE+4,d),this.getGeneralDecoder().decodeAllCodes(l,D.HEADER_SIZE+44)}}return D.HEADER_SIZE=4,D})(),vc=(()=>{class D extends Ql{constructor(l){super(l)}parseInformation(){let l=new rn;return this.getGeneralDecoder().decodeAllCodes(l,D.HEADER_SIZE)}}return D.HEADER_SIZE=5,D})();class Qr extends dr{constructor(u){super(u)}encodeCompressedWeight(u,l,d){let h=this.getGeneralDecoder().extractNumericValueFromBitArray(l,d);this.addWeightCode(u,h);let g=this.checkWeight(h),v=1e5;for(let x=0;x<5;++x)g/v==0&&u.append("0"),v/=10;u.append(g)}}let Ri=(()=>{class D extends Qr{constructor(l){super(l)}parseInformation(){if(this.getInformation().getSize()!=D.HEADER_SIZE+Qr.GTIN_SIZE+D.WEIGHT_SIZE)throw new ce;let l=new rn;return this.encodeCompressedGtin(l,D.HEADER_SIZE),this.encodeCompressedWeight(l,D.HEADER_SIZE+Qr.GTIN_SIZE,D.WEIGHT_SIZE),l.toString()}}return D.HEADER_SIZE=5,D.WEIGHT_SIZE=15,D})();class fo extends Ri{constructor(u){super(u)}addWeightCode(u,l){u.append("(3103)")}checkWeight(u){return u}}class Wd extends Ri{constructor(u){super(u)}addWeightCode(u,l){u.append(l<1e4?"(3202)":"(3203)")}checkWeight(u){return u<1e4?u:u-1e4}}let $l=(()=>{class D extends dr{constructor(l){super(l)}parseInformation(){if(this.getInformation().getSize()<D.HEADER_SIZE+dr.GTIN_SIZE)throw new ce;let l=new rn;this.encodeCompressedGtin(l,D.HEADER_SIZE);let d=this.getGeneralDecoder().extractNumericValueFromBitArray(D.HEADER_SIZE+dr.GTIN_SIZE,D.LAST_DIGIT_SIZE);l.append("(392"),l.append(d),l.append(")");let h=this.getGeneralDecoder().decodeGeneralPurposeField(D.HEADER_SIZE+dr.GTIN_SIZE+D.LAST_DIGIT_SIZE,null);return l.append(h.getNewString()),l.toString()}}return D.HEADER_SIZE=8,D.LAST_DIGIT_SIZE=2,D})(),Zl=(()=>{class D extends dr{constructor(l){super(l)}parseInformation(){if(this.getInformation().getSize()<D.HEADER_SIZE+dr.GTIN_SIZE)throw new ce;let l=new rn;this.encodeCompressedGtin(l,D.HEADER_SIZE);let d=this.getGeneralDecoder().extractNumericValueFromBitArray(D.HEADER_SIZE+dr.GTIN_SIZE,D.LAST_DIGIT_SIZE);l.append("(393"),l.append(d),l.append(")");let h=this.getGeneralDecoder().extractNumericValueFromBitArray(D.HEADER_SIZE+dr.GTIN_SIZE+D.LAST_DIGIT_SIZE,D.FIRST_THREE_DIGITS_SIZE);h/100==0&&l.append("0"),h/10==0&&l.append("0"),l.append(h);let g=this.getGeneralDecoder().decodeGeneralPurposeField(D.HEADER_SIZE+dr.GTIN_SIZE+D.LAST_DIGIT_SIZE+D.FIRST_THREE_DIGITS_SIZE,null);return l.append(g.getNewString()),l.toString()}}return D.HEADER_SIZE=8,D.LAST_DIGIT_SIZE=2,D.FIRST_THREE_DIGITS_SIZE=10,D})(),Mi=(()=>{class D extends Qr{constructor(l,d,h){super(l),this.dateCode=h,this.firstAIdigits=d}parseInformation(){if(this.getInformation().getSize()!=D.HEADER_SIZE+D.GTIN_SIZE+D.WEIGHT_SIZE+D.DATE_SIZE)throw new ce;let l=new rn;return this.encodeCompressedGtin(l,D.HEADER_SIZE),this.encodeCompressedWeight(l,D.HEADER_SIZE+D.GTIN_SIZE,D.WEIGHT_SIZE),this.encodeCompressedDate(l,D.HEADER_SIZE+D.GTIN_SIZE+D.WEIGHT_SIZE),l.toString()}encodeCompressedDate(l,d){let h=this.getGeneralDecoder().extractNumericValueFromBitArray(d,D.DATE_SIZE);if(38400==h)return;l.append("("),l.append(this.dateCode),l.append(")");let g=h%32;h/=32;let v=h%12+1;h/=12;let x=h;x/10==0&&l.append("0"),l.append(x),v/10==0&&l.append("0"),l.append(v),g/10==0&&l.append("0"),l.append(g)}addWeightCode(l,d){l.append("("),l.append(this.firstAIdigits),l.append(d/1e5),l.append(")")}checkWeight(l){return l%1e5}}return D.HEADER_SIZE=8,D.WEIGHT_SIZE=20,D.DATE_SIZE=16,D})();class Zo{constructor(u,l,d,h){this.leftchar=u,this.rightchar=l,this.finderpattern=d,this.maybeLast=h}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return null==this.rightchar}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(null==this.finderpattern?"null":this.finderpattern.getValue())+" ]"}static equals(u,l){return u instanceof Zo&&Zo.equalsOrNull(u.leftchar,l.leftchar)&&Zo.equalsOrNull(u.rightchar,l.rightchar)&&Zo.equalsOrNull(u.finderpattern,l.finderpattern)}static equalsOrNull(u,l){return null===u?null===l:Zo.equals(u,l)}hashCode(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()}}class Ou{constructor(u,l,d){this.pairs=u,this.rowNumber=l,this.wasReversed=d}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(u){return this.checkEqualitity(this,u)}toString(){return"{ "+this.pairs+" }"}equals(u,l){return u instanceof Ou&&this.checkEqualitity(u,l)&&u.wasReversed===l.wasReversed}checkEqualitity(u,l){if(!u||!l)return;let d;return u.forEach((h,g)=>{l.forEach(v=>{h.getLeftChar().getValue()===v.getLeftChar().getValue()&&h.getRightChar().getValue()===v.getRightChar().getValue()&&h.getFinderPatter().getValue()===v.getFinderPatter().getValue()&&(d=!0)})}),d}}class be extends Ki{constructor(u){super(...arguments),this.pairs=new Array(be.MAX_PAIRS),this.rows=new Array,this.startEnd=[2],this.verbose=!0===u}decodeRow(u,l,d){this.pairs.length=0,this.startFromEven=!1;try{return be.constructResult(this.decodeRow2pairs(u,l))}catch(h){this.verbose&&console.log(h)}return this.pairs.length=0,this.startFromEven=!0,be.constructResult(this.decodeRow2pairs(u,l))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(u,l){let h,d=!1;for(;!d;)try{this.pairs.push(this.retrieveNextPair(l,this.pairs,u))}catch(g){if(g instanceof ce){if(!this.pairs.length)throw new ce;d=!0}}if(this.checkChecksum())return this.pairs;if(h=!!this.rows.length,this.storeRow(u,!1),h){let g=this.checkRowsBoolean(!1);if(null!=g||(g=this.checkRowsBoolean(!0),null!=g))return g}throw new ce}checkRowsBoolean(u){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,u&&(this.rows=this.rows.reverse());let l=null;try{l=this.checkRows(new Array,0)}catch(d){this.verbose&&console.log(d)}return u&&(this.rows=this.rows.reverse()),l}checkRows(u,l){for(let d=l;d<this.rows.length;d++){let h=this.rows[d];this.pairs.length=0;for(let v of u)this.pairs.push(v.getPairs());if(this.pairs.push(h.getPairs()),!be.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let g=new Array(u);g.push(h);try{return this.checkRows(g,d+1)}catch(v){this.verbose&&console.log(v)}}throw new ce}static isValidSequence(u){for(let l of be.FINDER_PATTERN_SEQUENCES){if(u.length>l.length)continue;let d=!0;for(let h=0;h<u.length;h++)if(u[h].getFinderPattern().getValue()!=l[h]){d=!1;break}if(d)return!0}return!1}storeRow(u,l){let d=0,h=!1,g=!1;for(;d<this.rows.length;){let v=this.rows[d];if(v.getRowNumber()>u){g=v.isEquivalent(this.pairs);break}h=v.isEquivalent(this.pairs),d++}g||h||be.isPartialRow(this.pairs,this.rows)||(this.rows.push(d,new Ou(this.pairs,u,l)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(u,l){for(let d of l)if(d.getPairs().length!==u.length)for(let h of d.getPairs())for(let g of u)if(Zo.equals(h,g))break}static isPartialRow(u,l){for(let d of l){let h=!0;for(let g of u){let v=!1;for(let x of d.getPairs())if(g.equals(x)){v=!0;break}if(!v){h=!1;break}}if(h)return!0}return!1}getRows(){return this.rows}static constructResult(u){let h=function(D){try{if(D.get(1))return new Lr(D);if(!D.get(2))return new vc(D);switch($o.extractNumericValueFromBitArray(D,1,4)){case 4:return new fo(D);case 5:return new Wd(D)}switch($o.extractNumericValueFromBitArray(D,1,5)){case 12:return new $l(D);case 13:return new Zl(D)}switch($o.extractNumericValueFromBitArray(D,1,7)){case 56:return new Mi(D,"310","11");case 57:return new Mi(D,"320","11");case 58:return new Mi(D,"310","13");case 59:return new Mi(D,"320","13");case 60:return new Mi(D,"310","15");case 61:return new Mi(D,"320","15");case 62:return new Mi(D,"310","17");case 63:return new Mi(D,"320","17")}}catch(u){throw console.log(u),new ao("unknown decoder: "+D)}}(class{static buildBitArray(u){let l=2*u.length-1;null==u[u.length-1].getRightChar()&&(l-=1);let h=new gt(12*l),g=0,x=u[0].getRightChar().getValue();for(let b=11;b>=0;--b)0!=(x&1<<b)&&h.set(g),g++;for(let b=1;b<u.length;++b){let I=u[b],S=I.getLeftChar().getValue();for(let k=11;k>=0;--k)0!=(S&1<<k)&&h.set(g),g++;if(null!=I.getRightChar()){let k=I.getRightChar().getValue();for(let L=11;L>=0;--L)0!=(k&1<<L)&&h.set(g),g++}}return h}}.buildBitArray(u)).parseInformation(),g=u[0].getFinderPattern().getResultPoints(),v=u[u.length-1].getFinderPattern().getResultPoints();return new fr(h,null,null,[g[0],g[1],v[0],v[1]],it.RSS_EXPANDED,null)}checkChecksum(){let u=this.pairs.get(0),l=u.getLeftChar(),d=u.getRightChar();if(null==d)return!1;let h=d.getChecksumPortion(),g=2;for(let x=1;x<this.pairs.size();++x){let b=this.pairs.get(x);h+=b.getLeftChar().getChecksumPortion(),g++;let I=b.getRightChar();null!=I&&(h+=I.getChecksumPortion(),g++)}return h%=211,211*(g-4)+h==l.getValue()}static getNextSecondBar(u,l){let d;return u.get(l)?(d=u.getNextUnset(l),d=u.getNextSet(d)):(d=u.getNextSet(l),d=u.getNextUnset(d)),d}retrieveNextPair(u,l,d){let h=l.length%2==0;this.startFromEven&&(h=!h);let g,v=!0,x=-1;do{this.findNextPair(u,l,x),g=this.parseFoundFinderPattern(u,d,h),null==g?x=be.getNextSecondBar(u,this.startEnd[0]):v=!1}while(v);let I,b=this.decodeDataCharacter(u,g,h,!0);if(!this.isEmptyPair(l)&&l[l.length-1].mustBeLast())throw new ce;try{I=this.decodeDataCharacter(u,g,h,!1)}catch(S){I=null,this.verbose&&console.log(S)}return new Zo(b,I,g,!0)}isEmptyPair(u){return 0===u.length}findNextPair(u,l,d){let h=this.getDecodeFinderCounters();h[0]=0,h[1]=0,h[2]=0,h[3]=0;let v,g=u.getSize();v=d>=0?d:this.isEmptyPair(l)?0:l[l.length-1].getFinderPattern().getStartEnd()[1];let x=l.length%2!=0;this.startFromEven&&(x=!x);let b=!1;for(;v<g&&(b=!u.get(v),b);)v++;let I=0,S=v;for(let k=v;k<g;k++)if(u.get(k)!=b)h[I]++;else{if(3==I){if(x&&be.reverseCounters(h),be.isFinderPattern(h))return this.startEnd[0]=S,void(this.startEnd[1]=k);x&&be.reverseCounters(h),S+=h[0]+h[1],h[0]=h[2],h[1]=h[3],h[2]=0,h[3]=0,I--}else I++;h[I]=1,b=!b}throw new ce}static reverseCounters(u){let l=u.length;for(let d=0;d<l/2;++d){let h=u[d];u[d]=u[l-d-1],u[l-d-1]=h}}parseFoundFinderPattern(u,l,d){let h,g,v;if(d){let I=this.startEnd[0]-1;for(;I>=0&&!u.get(I);)I--;I++,h=this.startEnd[0]-I,g=I,v=this.startEnd[1]}else g=this.startEnd[0],v=u.getNextUnset(this.startEnd[1]+1),h=v-this.startEnd[1];let b,x=this.getDecodeFinderCounters();en.arraycopy(x,0,x,1,x.length-1),x[0]=h;try{b=this.parseFinderValue(x,be.FINDER_PATTERNS)}catch(I){return null}return new Le(b,[g,v],g,v,l)}decodeDataCharacter(u,l,d,h){let g=this.getDataCharacterCounters();for(let bn=0;bn<g.length;bn++)g[bn]=0;if(h)be.recordPatternInReverse(u,l.getStartEnd()[0],g);else{be.recordPattern(u,l.getStartEnd()[1],g);for(let bn=0,Vr=g.length-1;bn<Vr;bn++,Vr--){let cn=g[bn];g[bn]=g[Vr],g[Vr]=cn}}let x=Vt.sum(new Int32Array(g))/17,b=(l.getStartEnd()[1]-l.getStartEnd()[0])/15;if(Math.abs(x-b)/b>.3)throw new ce;let I=this.getOddCounts(),S=this.getEvenCounts(),k=this.getOddRoundingErrors(),L=this.getEvenRoundingErrors();for(let bn=0;bn<g.length;bn++){let Vr=1*g[bn]/x,cn=Vr+.5;if(cn<1){if(Vr<.3)throw new ce;cn=1}else if(cn>8){if(Vr>8.7)throw new ce;cn=8}let ou=bn/2;0==(1&bn)?(I[ou]=cn,k[ou]=Vr-cn):(S[ou]=cn,L[ou]=Vr-cn)}this.adjustOddEvenCounts(17);let W=4*l.getValue()+(d?0:2)+(h?0:1)-1,q=0,Z=0;for(let bn=I.length-1;bn>=0;bn--)be.isNotA1left(l,d,h)&&(Z+=I[bn]*be.WEIGHTS[W][2*bn]),q+=I[bn];let ne=0;for(let bn=S.length-1;bn>=0;bn--)be.isNotA1left(l,d,h)&&(ne+=S[bn]*be.WEIGHTS[W][2*bn+1]);let ie=Z+ne;if(0!=(1&q)||q>13||q<4)throw new ce;let Ae=(13-q)/2,Me=be.SYMBOL_WIDEST[Ae],de=9-Me,Lt=di.getRSSvalue(I,Me,!0),xt=di.getRSSvalue(S,de,!1);return new co(Lt*be.EVEN_TOTAL_SUBSET[Ae]+xt+be.GSUM[Ae],ie)}static isNotA1left(u,l,d){return!(0==u.getValue()&&l&&d)}adjustOddEvenCounts(u){let l=Vt.sum(new Int32Array(this.getOddCounts())),d=Vt.sum(new Int32Array(this.getEvenCounts())),h=!1,g=!1;l>13?g=!0:l<4&&(h=!0);let v=!1,x=!1;d>13?x=!0:d<4&&(v=!0);let b=l+d-u,I=1==(1&l),S=0==(1&d);if(1==b)if(I){if(S)throw new ce;g=!0}else{if(!S)throw new ce;x=!0}else if(-1==b)if(I){if(S)throw new ce;h=!0}else{if(!S)throw new ce;v=!0}else{if(0!=b)throw new ce;if(I){if(!S)throw new ce;l<d?(h=!0,x=!0):(g=!0,v=!0)}else if(S)throw new ce}if(h){if(g)throw new ce;be.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(g&&be.decrement(this.getOddCounts(),this.getOddRoundingErrors()),v){if(x)throw new ce;be.increment(this.getEvenCounts(),this.getOddRoundingErrors())}x&&be.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}be.SYMBOL_WIDEST=[7,5,4,3,1],be.EVEN_TOTAL_SUBSET=[4,20,52,104,204],be.GSUM=[0,348,1388,2948,3988],be.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],be.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],be.FINDER_PAT_A=0,be.FINDER_PAT_B=1,be.FINDER_PAT_C=2,be.FINDER_PAT_D=3,be.FINDER_PAT_E=4,be.FINDER_PAT_F=5,be.FINDER_PATTERN_SEQUENCES=[[be.FINDER_PAT_A,be.FINDER_PAT_A],[be.FINDER_PAT_A,be.FINDER_PAT_B,be.FINDER_PAT_B],[be.FINDER_PAT_A,be.FINDER_PAT_C,be.FINDER_PAT_B,be.FINDER_PAT_D],[be.FINDER_PAT_A,be.FINDER_PAT_E,be.FINDER_PAT_B,be.FINDER_PAT_D,be.FINDER_PAT_C],[be.FINDER_PAT_A,be.FINDER_PAT_E,be.FINDER_PAT_B,be.FINDER_PAT_D,be.FINDER_PAT_D,be.FINDER_PAT_F],[be.FINDER_PAT_A,be.FINDER_PAT_E,be.FINDER_PAT_B,be.FINDER_PAT_D,be.FINDER_PAT_E,be.FINDER_PAT_F,be.FINDER_PAT_F],[be.FINDER_PAT_A,be.FINDER_PAT_A,be.FINDER_PAT_B,be.FINDER_PAT_B,be.FINDER_PAT_C,be.FINDER_PAT_C,be.FINDER_PAT_D,be.FINDER_PAT_D],[be.FINDER_PAT_A,be.FINDER_PAT_A,be.FINDER_PAT_B,be.FINDER_PAT_B,be.FINDER_PAT_C,be.FINDER_PAT_C,be.FINDER_PAT_D,be.FINDER_PAT_E,be.FINDER_PAT_E],[be.FINDER_PAT_A,be.FINDER_PAT_A,be.FINDER_PAT_B,be.FINDER_PAT_B,be.FINDER_PAT_C,be.FINDER_PAT_C,be.FINDER_PAT_D,be.FINDER_PAT_E,be.FINDER_PAT_F,be.FINDER_PAT_F],[be.FINDER_PAT_A,be.FINDER_PAT_A,be.FINDER_PAT_B,be.FINDER_PAT_B,be.FINDER_PAT_C,be.FINDER_PAT_D,be.FINDER_PAT_D,be.FINDER_PAT_E,be.FINDER_PAT_E,be.FINDER_PAT_F,be.FINDER_PAT_F]],be.MAX_PAIRS=11;class $r extends co{constructor(u,l,d){super(u,l),this.count=0,this.finderPattern=d}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class dt extends Ki{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(u,l,d){const h=this.decodePair(l,!1,u,d);dt.addOrTally(this.possibleLeftPairs,h),l.reverse();let g=this.decodePair(l,!0,u,d);dt.addOrTally(this.possibleRightPairs,g),l.reverse();for(let v of this.possibleLeftPairs)if(v.getCount()>1)for(let x of this.possibleRightPairs)if(x.getCount()>1&&dt.checkChecksum(v,x))return dt.constructResult(v,x);throw new ce}static addOrTally(u,l){if(null==l)return;let d=!1;for(let h of u)if(h.getValue()===l.getValue()){h.incrementCount(),d=!0;break}d||u.push(l)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(u,l){let d=4537077*u.getValue()+l.getValue(),h=new String(d).toString(),g=new rn;for(let I=13-h.length;I>0;I--)g.append("0");g.append(h);let v=0;for(let I=0;I<13;I++){let S=g.charAt(I).charCodeAt(0)-"0".charCodeAt(0);v+=0==(1&I)?3*S:S}v=10-v%10,10===v&&(v=0),g.append(v.toString());let x=u.getFinderPattern().getResultPoints(),b=l.getFinderPattern().getResultPoints();return new fr(g.toString(),null,0,[x[0],x[1],b[0],b[1]],it.RSS_14,(new Date).getTime())}static checkChecksum(u,l){let d=(u.getChecksumPortion()+16*l.getChecksumPortion())%79,h=9*u.getFinderPattern().getValue()+l.getFinderPattern().getValue();return h>72&&h--,h>8&&h--,d===h}decodePair(u,l,d,h){try{let g=this.findFinderPattern(u,l),v=this.parseFoundFinderPattern(u,d,l,g),x=null==h?null:h.get(En.NEED_RESULT_POINT_CALLBACK);if(null!=x){let S=(g[0]+g[1])/2;l&&(S=u.getSize()-1-S),x.foundPossibleResultPoint(new Ue(S,d))}let b=this.decodeDataCharacter(u,v,!0),I=this.decodeDataCharacter(u,v,!1);return new $r(1597*b.getValue()+I.getValue(),b.getChecksumPortion()+4*I.getChecksumPortion(),v)}catch(g){return null}}decodeDataCharacter(u,l,d){let h=this.getDataCharacterCounters();for(let ne=0;ne<h.length;ne++)h[ne]=0;if(d)qn.recordPatternInReverse(u,l.getStartEnd()[0],h);else{qn.recordPattern(u,l.getStartEnd()[1]+1,h);for(let ne=0,ie=h.length-1;ne<ie;ne++,ie--){let Ae=h[ne];h[ne]=h[ie],h[ie]=Ae}}let g=d?16:15,v=Vt.sum(new Int32Array(h))/g,x=this.getOddCounts(),b=this.getEvenCounts(),I=this.getOddRoundingErrors(),S=this.getEvenRoundingErrors();for(let ne=0;ne<h.length;ne++){let ie=h[ne]/v,Ae=Math.floor(ie+.5);Ae<1?Ae=1:Ae>8&&(Ae=8);let Me=Math.floor(ne/2);0==(1&ne)?(x[Me]=Ae,I[Me]=ie-Ae):(b[Me]=Ae,S[Me]=ie-Ae)}this.adjustOddEvenCounts(d,g);let k=0,L=0;for(let ne=x.length-1;ne>=0;ne--)L*=9,L+=x[ne],k+=x[ne];let W=0,q=0;for(let ne=b.length-1;ne>=0;ne--)W*=9,W+=b[ne],q+=b[ne];let Z=L+3*W;if(d){if(0!=(1&k)||k>12||k<4)throw new ce;let ne=(12-k)/2,ie=dt.OUTSIDE_ODD_WIDEST[ne],Ae=9-ie,Me=di.getRSSvalue(x,ie,!1),de=di.getRSSvalue(b,Ae,!0);return new co(Me*dt.OUTSIDE_EVEN_TOTAL_SUBSET[ne]+de+dt.OUTSIDE_GSUM[ne],Z)}{if(0!=(1&q)||q>10||q<4)throw new ce;let ne=(10-q)/2,ie=dt.INSIDE_ODD_WIDEST[ne],Ae=9-ie,Me=di.getRSSvalue(x,ie,!0),de=di.getRSSvalue(b,Ae,!1);return new co(de*dt.INSIDE_ODD_TOTAL_SUBSET[ne]+Me+dt.INSIDE_GSUM[ne],Z)}}findFinderPattern(u,l){let d=this.getDecodeFinderCounters();d[0]=0,d[1]=0,d[2]=0,d[3]=0;let h=u.getSize(),g=!1,v=0;for(;v<h&&(g=!u.get(v),l!==g);)v++;let x=0,b=v;for(let I=v;I<h;I++)if(u.get(I)!==g)d[x]++;else{if(3===x){if(Ki.isFinderPattern(d))return[b,I];b+=d[0]+d[1],d[0]=d[2],d[1]=d[3],d[2]=0,d[3]=0,x--}else x++;d[x]=1,g=!g}throw new ce}parseFoundFinderPattern(u,l,d,h){let g=u.get(h[0]),v=h[0]-1;for(;v>=0&&g!==u.get(v);)v--;v++;const x=h[0]-v,b=this.getDecodeFinderCounters(),I=new Int32Array(b.length);en.arraycopy(b,0,I,1,b.length-1),I[0]=x;const S=this.parseFinderValue(I,dt.FINDER_PATTERNS);let k=v,L=h[1];return d&&(k=u.getSize()-1-k,L=u.getSize()-1-L),new Le(S,[v,h[1]],k,L,l)}adjustOddEvenCounts(u,l){let d=Vt.sum(new Int32Array(this.getOddCounts())),h=Vt.sum(new Int32Array(this.getEvenCounts())),g=!1,v=!1,x=!1,b=!1;u?(d>12?v=!0:d<4&&(g=!0),h>12?b=!0:h<4&&(x=!0)):(d>11?v=!0:d<5&&(g=!0),h>10?b=!0:h<4&&(x=!0));let I=d+h-l,S=(1&d)==(u?1:0),k=1==(1&h);if(1===I)if(S){if(k)throw new ce;v=!0}else{if(!k)throw new ce;b=!0}else if(-1===I)if(S){if(k)throw new ce;g=!0}else{if(!k)throw new ce;x=!0}else{if(0!==I)throw new ce;if(S){if(!k)throw new ce;d<h?(g=!0,b=!0):(v=!0,x=!0)}else if(k)throw new ce}if(g){if(v)throw new ce;Ki.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(v&&Ki.decrement(this.getOddCounts(),this.getOddRoundingErrors()),x){if(b)throw new ce;Ki.increment(this.getEvenCounts(),this.getOddRoundingErrors())}b&&Ki.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}dt.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],dt.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],dt.OUTSIDE_GSUM=[0,161,961,2015,2715],dt.INSIDE_GSUM=[0,336,1036,1516],dt.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],dt.INSIDE_ODD_WIDEST=[2,4,6,8],dt.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class xa extends qn{constructor(u,l){super(),this.readers=[],this.verbose=!0===l;const d=u?u.get(En.POSSIBLE_FORMATS):null,h=u&&void 0!==u.get(En.ASSUME_CODE_39_CHECK_DIGIT);d&&((d.includes(it.EAN_13)||d.includes(it.UPC_A)||d.includes(it.EAN_8)||d.includes(it.UPC_E))&&this.readers.push(new Ar(u)),d.includes(it.CODE_39)&&this.readers.push(new Qa(h)),d.includes(it.CODE_128)&&this.readers.push(new Te),d.includes(it.ITF)&&this.readers.push(new on),d.includes(it.RSS_14)&&this.readers.push(new dt),d.includes(it.RSS_EXPANDED)&&this.readers.push(new be(this.verbose))),0===this.readers.length&&(this.readers.push(new Ar(u)),this.readers.push(new Qa),this.readers.push(new Ar(u)),this.readers.push(new Te),this.readers.push(new on),this.readers.push(new dt),this.readers.push(new be(this.verbose)))}decodeRow(u,l,d){for(let h=0;h<this.readers.length;h++)try{return this.readers[h].decodeRow(u,l,d)}catch(g){}throw new ce}reset(){this.readers.forEach(u=>u.reset())}}class sn{constructor(u,l,d){this.ecCodewords=u,this.ecBlocks=[l],d&&this.ecBlocks.push(d)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class Xe{constructor(u,l){this.count=u,this.dataCodewords=l}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class Wt{constructor(u,l,d,h,g,v){this.versionNumber=u,this.symbolSizeRows=l,this.symbolSizeColumns=d,this.dataRegionSizeRows=h,this.dataRegionSizeColumns=g,this.ecBlocks=v;let x=0;const b=v.getECCodewords(),I=v.getECBlocks();for(let S of I)x+=S.getCount()*(S.getDataCodewords()+b);this.totalCodewords=x}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(u,l){if(0!=(1&u)||0!=(1&l))throw new Re;for(let d of Wt.VERSIONS)if(d.symbolSizeRows===u&&d.symbolSizeColumns===l)return d;throw new Re}toString(){return""+this.versionNumber}static buildVersions(){return[new Wt(1,10,10,8,8,new sn(5,new Xe(1,3))),new Wt(2,12,12,10,10,new sn(7,new Xe(1,5))),new Wt(3,14,14,12,12,new sn(10,new Xe(1,8))),new Wt(4,16,16,14,14,new sn(12,new Xe(1,12))),new Wt(5,18,18,16,16,new sn(14,new Xe(1,18))),new Wt(6,20,20,18,18,new sn(18,new Xe(1,22))),new Wt(7,22,22,20,20,new sn(20,new Xe(1,30))),new Wt(8,24,24,22,22,new sn(24,new Xe(1,36))),new Wt(9,26,26,24,24,new sn(28,new Xe(1,44))),new Wt(10,32,32,14,14,new sn(36,new Xe(1,62))),new Wt(11,36,36,16,16,new sn(42,new Xe(1,86))),new Wt(12,40,40,18,18,new sn(48,new Xe(1,114))),new Wt(13,44,44,20,20,new sn(56,new Xe(1,144))),new Wt(14,48,48,22,22,new sn(68,new Xe(1,174))),new Wt(15,52,52,24,24,new sn(42,new Xe(2,102))),new Wt(16,64,64,14,14,new sn(56,new Xe(2,140))),new Wt(17,72,72,16,16,new sn(36,new Xe(4,92))),new Wt(18,80,80,18,18,new sn(48,new Xe(4,114))),new Wt(19,88,88,20,20,new sn(56,new Xe(4,144))),new Wt(20,96,96,22,22,new sn(68,new Xe(4,174))),new Wt(21,104,104,24,24,new sn(56,new Xe(6,136))),new Wt(22,120,120,18,18,new sn(68,new Xe(6,175))),new Wt(23,132,132,20,20,new sn(62,new Xe(8,163))),new Wt(24,144,144,22,22,new sn(62,new Xe(8,156),new Xe(2,155))),new Wt(25,8,18,6,16,new sn(7,new Xe(1,5))),new Wt(26,8,32,6,14,new sn(11,new Xe(1,10))),new Wt(27,12,26,10,24,new sn(14,new Xe(1,16))),new Wt(28,12,36,10,16,new sn(18,new Xe(1,22))),new Wt(29,16,36,14,16,new sn(24,new Xe(1,32))),new Wt(30,16,48,14,22,new sn(28,new Xe(1,49)))]}}Wt.VERSIONS=Wt.buildVersions();class Qi{constructor(u){const l=u.getHeight();if(l<8||l>144||0!=(1&l))throw new Re;this.version=Qi.readVersion(u),this.mappingBitMatrix=this.extractDataRegion(u),this.readMappingMatrix=new Gn(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(u){const l=u.getHeight(),d=u.getWidth();return Wt.getVersionForDimensions(l,d)}readCodewords(){const u=new Int8Array(this.version.getTotalCodewords());let l=0,d=4,h=0;const g=this.mappingBitMatrix.getHeight(),v=this.mappingBitMatrix.getWidth();let x=!1,b=!1,I=!1,S=!1;do{if(d!==g||0!==h||x)if(d!==g-2||0!==h||0==(3&v)||b)if(d!==g+4||2!==h||0!=(7&v)||I)if(d!==g-2||0!==h||4!=(7&v)||S){do{d<g&&h>=0&&!this.readMappingMatrix.get(h,d)&&(u[l++]=255&this.readUtah(d,h,g,v)),d-=2,h+=2}while(d>=0&&h<v);d+=1,h+=3;do{d>=0&&h<v&&!this.readMappingMatrix.get(h,d)&&(u[l++]=255&this.readUtah(d,h,g,v)),d+=2,h-=2}while(d<g&&h>=0);d+=3,h+=1}else u[l++]=255&this.readCorner4(g,v),d-=2,h+=2,S=!0;else u[l++]=255&this.readCorner3(g,v),d-=2,h+=2,I=!0;else u[l++]=255&this.readCorner2(g,v),d-=2,h+=2,b=!0;else u[l++]=255&this.readCorner1(g,v),d-=2,h+=2,x=!0}while(d<g||h<v);if(l!==this.version.getTotalCodewords())throw new Re;return u}readModule(u,l,d,h){return u<0&&(u+=d,l+=4-(d+4&7)),l<0&&(l+=h,u+=4-(h+4&7)),this.readMappingMatrix.set(l,u),this.mappingBitMatrix.get(l,u)}readUtah(u,l,d,h){let g=0;return this.readModule(u-2,l-2,d,h)&&(g|=1),g<<=1,this.readModule(u-2,l-1,d,h)&&(g|=1),g<<=1,this.readModule(u-1,l-2,d,h)&&(g|=1),g<<=1,this.readModule(u-1,l-1,d,h)&&(g|=1),g<<=1,this.readModule(u-1,l,d,h)&&(g|=1),g<<=1,this.readModule(u,l-2,d,h)&&(g|=1),g<<=1,this.readModule(u,l-1,d,h)&&(g|=1),g<<=1,this.readModule(u,l,d,h)&&(g|=1),g}readCorner1(u,l){let d=0;return this.readModule(u-1,0,u,l)&&(d|=1),d<<=1,this.readModule(u-1,1,u,l)&&(d|=1),d<<=1,this.readModule(u-1,2,u,l)&&(d|=1),d<<=1,this.readModule(0,l-2,u,l)&&(d|=1),d<<=1,this.readModule(0,l-1,u,l)&&(d|=1),d<<=1,this.readModule(1,l-1,u,l)&&(d|=1),d<<=1,this.readModule(2,l-1,u,l)&&(d|=1),d<<=1,this.readModule(3,l-1,u,l)&&(d|=1),d}readCorner2(u,l){let d=0;return this.readModule(u-3,0,u,l)&&(d|=1),d<<=1,this.readModule(u-2,0,u,l)&&(d|=1),d<<=1,this.readModule(u-1,0,u,l)&&(d|=1),d<<=1,this.readModule(0,l-4,u,l)&&(d|=1),d<<=1,this.readModule(0,l-3,u,l)&&(d|=1),d<<=1,this.readModule(0,l-2,u,l)&&(d|=1),d<<=1,this.readModule(0,l-1,u,l)&&(d|=1),d<<=1,this.readModule(1,l-1,u,l)&&(d|=1),d}readCorner3(u,l){let d=0;return this.readModule(u-1,0,u,l)&&(d|=1),d<<=1,this.readModule(u-1,l-1,u,l)&&(d|=1),d<<=1,this.readModule(0,l-3,u,l)&&(d|=1),d<<=1,this.readModule(0,l-2,u,l)&&(d|=1),d<<=1,this.readModule(0,l-1,u,l)&&(d|=1),d<<=1,this.readModule(1,l-3,u,l)&&(d|=1),d<<=1,this.readModule(1,l-2,u,l)&&(d|=1),d<<=1,this.readModule(1,l-1,u,l)&&(d|=1),d}readCorner4(u,l){let d=0;return this.readModule(u-3,0,u,l)&&(d|=1),d<<=1,this.readModule(u-2,0,u,l)&&(d|=1),d<<=1,this.readModule(u-1,0,u,l)&&(d|=1),d<<=1,this.readModule(0,l-2,u,l)&&(d|=1),d<<=1,this.readModule(0,l-1,u,l)&&(d|=1),d<<=1,this.readModule(1,l-1,u,l)&&(d|=1),d<<=1,this.readModule(2,l-1,u,l)&&(d|=1),d<<=1,this.readModule(3,l-1,u,l)&&(d|=1),d}extractDataRegion(u){const l=this.version.getSymbolSizeRows(),d=this.version.getSymbolSizeColumns();if(u.getHeight()!==l)throw new Ye("Dimension of bitMatrix must match the version size");const h=this.version.getDataRegionSizeRows(),g=this.version.getDataRegionSizeColumns(),v=l/h|0,x=d/g|0,S=new Gn(x*g,v*h);for(let k=0;k<v;++k){const L=k*h;for(let W=0;W<x;++W){const q=W*g;for(let Z=0;Z<h;++Z){const ne=k*(h+2)+1+Z,ie=L+Z;for(let Ae=0;Ae<g;++Ae)u.get(W*(g+2)+1+Ae,ne)&&S.set(q+Ae,ie)}}}return S}}class hi{constructor(u,l){this.numDataCodewords=u,this.codewords=l}static getDataBlocks(u,l){const d=l.getECBlocks();let h=0;const g=d.getECBlocks();for(let Z of g)h+=Z.getCount();const v=new Array(h);let x=0;for(let Z of g)for(let ne=0;ne<Z.getCount();ne++){const ie=Z.getDataCodewords(),Ae=d.getECCodewords()+ie;v[x++]=new hi(ie,new Uint8Array(Ae))}const I=v[0].codewords.length-d.getECCodewords(),S=I-1;let k=0;for(let Z=0;Z<S;Z++)for(let ne=0;ne<x;ne++)v[ne].codewords[Z]=u[k++];const L=24===l.getVersionNumber(),W=L?8:x;for(let Z=0;Z<W;Z++)v[Z].codewords[I-1]=u[k++];const q=v[0].codewords.length;for(let Z=I;Z<q;Z++)for(let ne=0;ne<x;ne++){const ie=L?(ne+8)%x:ne;v[ie].codewords[L&&ie>7?Z-1:Z]=u[k++]}if(k!==u.length)throw new Ye;return v}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class eu{constructor(u){this.bytes=u,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(u){if(u<1||u>32||u>this.available())throw new Ye(""+u);let l=0,d=this.bitOffset,h=this.byteOffset;const g=this.bytes;if(d>0){const v=8-d,x=u<v?u:v,b=v-x;l=(g[h]&255>>8-x<<b)>>b,u-=x,d+=x,8===d&&(d=0,h++)}if(u>0){for(;u>=8;)l=l<<8|255&g[h],h++,u-=8;if(u>0){const v=8-u;l=l<<u|(g[h]&255>>v<<v)>>v,d+=u}}return this.bitOffset=d,this.byteOffset=h,l}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}var Kn=(()=>{return(D=Kn||(Kn={}))[D.PAD_ENCODE=0]="PAD_ENCODE",D[D.ASCII_ENCODE=1]="ASCII_ENCODE",D[D.C40_ENCODE=2]="C40_ENCODE",D[D.TEXT_ENCODE=3]="TEXT_ENCODE",D[D.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",D[D.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",D[D.BASE256_ENCODE=6]="BASE256_ENCODE",Kn;var D})();class $i{static decode(u){const l=new eu(u),d=new rn,h=new rn,g=new Array;let v=Kn.ASCII_ENCODE;do{if(v===Kn.ASCII_ENCODE)v=this.decodeAsciiSegment(l,d,h);else{switch(v){case Kn.C40_ENCODE:this.decodeC40Segment(l,d);break;case Kn.TEXT_ENCODE:this.decodeTextSegment(l,d);break;case Kn.ANSIX12_ENCODE:this.decodeAnsiX12Segment(l,d);break;case Kn.EDIFACT_ENCODE:this.decodeEdifactSegment(l,d);break;case Kn.BASE256_ENCODE:this.decodeBase256Segment(l,d,g);break;default:throw new Re}v=Kn.ASCII_ENCODE}}while(v!==Kn.PAD_ENCODE&&l.available()>0);return h.length()>0&&d.append(h.toString()),new Xo(u,d.toString(),0===g.length?null:g,null)}static decodeAsciiSegment(u,l,d){let h=!1;do{let g=u.readBits(8);if(0===g)throw new Re;if(g<=128)return h&&(g+=128),l.append(String.fromCharCode(g-1)),Kn.ASCII_ENCODE;if(129===g)return Kn.PAD_ENCODE;if(g<=229){const v=g-130;v<10&&l.append("0"),l.append(""+v)}else switch(g){case 230:return Kn.C40_ENCODE;case 231:return Kn.BASE256_ENCODE;case 232:l.append(String.fromCharCode(29));break;case 233:case 234:break;case 235:h=!0;break;case 236:l.append("[)>\x1e05\x1d"),d.insert(0,"\x1e\x04");break;case 237:l.append("[)>\x1e06\x1d"),d.insert(0,"\x1e\x04");break;case 238:return Kn.ANSIX12_ENCODE;case 239:return Kn.TEXT_ENCODE;case 240:return Kn.EDIFACT_ENCODE;case 241:break;default:if(254!==g||0!==u.available())throw new Re}}while(u.available()>0);return Kn.ASCII_ENCODE}static decodeC40Segment(u,l){let d=!1;const h=[];let g=0;do{if(8===u.available())return;const v=u.readBits(8);if(254===v)return;this.parseTwoBytes(v,u.readBits(8),h);for(let x=0;x<3;x++){const b=h[x];switch(g){case 0:if(b<3)g=b+1;else{if(!(b<this.C40_BASIC_SET_CHARS.length))throw new Re;{const I=this.C40_BASIC_SET_CHARS[b];d?(l.append(String.fromCharCode(I.charCodeAt(0)+128)),d=!1):l.append(I)}}break;case 1:d?(l.append(String.fromCharCode(b+128)),d=!1):l.append(String.fromCharCode(b)),g=0;break;case 2:if(b<this.C40_SHIFT2_SET_CHARS.length){const I=this.C40_SHIFT2_SET_CHARS[b];d?(l.append(String.fromCharCode(I.charCodeAt(0)+128)),d=!1):l.append(I)}else switch(b){case 27:l.append(String.fromCharCode(29));break;case 30:d=!0;break;default:throw new Re}g=0;break;case 3:d?(l.append(String.fromCharCode(b+224)),d=!1):l.append(String.fromCharCode(b+96)),g=0;break;default:throw new Re}}}while(u.available()>0)}static decodeTextSegment(u,l){let d=!1,h=[],g=0;do{if(8===u.available())return;const v=u.readBits(8);if(254===v)return;this.parseTwoBytes(v,u.readBits(8),h);for(let x=0;x<3;x++){const b=h[x];switch(g){case 0:if(b<3)g=b+1;else{if(!(b<this.TEXT_BASIC_SET_CHARS.length))throw new Re;{const I=this.TEXT_BASIC_SET_CHARS[b];d?(l.append(String.fromCharCode(I.charCodeAt(0)+128)),d=!1):l.append(I)}}break;case 1:d?(l.append(String.fromCharCode(b+128)),d=!1):l.append(String.fromCharCode(b)),g=0;break;case 2:if(b<this.TEXT_SHIFT2_SET_CHARS.length){const I=this.TEXT_SHIFT2_SET_CHARS[b];d?(l.append(String.fromCharCode(I.charCodeAt(0)+128)),d=!1):l.append(I)}else switch(b){case 27:l.append(String.fromCharCode(29));break;case 30:d=!0;break;default:throw new Re}g=0;break;case 3:if(!(b<this.TEXT_SHIFT3_SET_CHARS.length))throw new Re;{const I=this.TEXT_SHIFT3_SET_CHARS[b];d?(l.append(String.fromCharCode(I.charCodeAt(0)+128)),d=!1):l.append(I),g=0}break;default:throw new Re}}}while(u.available()>0)}static decodeAnsiX12Segment(u,l){const d=[];do{if(8===u.available())return;const h=u.readBits(8);if(254===h)return;this.parseTwoBytes(h,u.readBits(8),d);for(let g=0;g<3;g++){const v=d[g];switch(v){case 0:l.append("\r");break;case 1:l.append("*");break;case 2:l.append(">");break;case 3:l.append(" ");break;default:if(v<14)l.append(String.fromCharCode(v+44));else{if(!(v<40))throw new Re;l.append(String.fromCharCode(v+51))}}}}while(u.available()>0)}static parseTwoBytes(u,l,d){let h=(u<<8)+l-1,g=Math.floor(h/1600);d[0]=g,h-=1600*g,g=Math.floor(h/40),d[1]=g,d[2]=h-40*g}static decodeEdifactSegment(u,l){do{if(u.available()<=16)return;for(let d=0;d<4;d++){let h=u.readBits(6);if(31===h){const g=8-u.getBitOffset();return void(8!==g&&u.readBits(g))}0==(32&h)&&(h|=64),l.append(String.fromCharCode(h))}}while(u.available()>0)}static decodeBase256Segment(u,l,d){let h=1+u.getByteOffset();const g=this.unrandomize255State(u.readBits(8),h++);let v;if(v=0===g?u.available()/8|0:g<250?g:250*(g-249)+this.unrandomize255State(u.readBits(8),h++),v<0)throw new Re;const x=new Uint8Array(v);for(let b=0;b<v;b++){if(u.available()<8)throw new Re;x[b]=this.unrandomize255State(u.readBits(8),h++)}d.push(x);try{l.append(vn.decode(x,at.ISO88591))}catch(b){throw new ao("Platform does not support required encoding: "+b.message)}}static unrandomize255State(u,l){const h=u-(149*l%255+1);return h>=0?h:h+256}}$i.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],$i.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],$i.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],$i.TEXT_SHIFT2_SET_CHARS=$i.C40_SHIFT2_SET_CHARS,$i.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",String.fromCharCode(127)];class Pu{constructor(){this.rsDecoder=new Ps(Pt.DATA_MATRIX_FIELD_256)}decode(u){const l=new Qi(u),d=l.getVersion(),h=l.readCodewords(),g=hi.getDataBlocks(h,d);let v=0;for(let I of g)v+=I.getNumDataCodewords();const x=new Uint8Array(v),b=g.length;for(let I=0;I<b;I++){const S=g[I],k=S.getCodewords(),L=S.getNumDataCodewords();this.correctErrors(k,L);for(let W=0;W<L;W++)x[W*b+I]=k[W]}return $i.decode(x)}correctErrors(u,l){const d=new Int32Array(u);try{this.rsDecoder.decode(d,u.length-l)}catch(h){throw new Dt}for(let h=0;h<l;h++)u[h]=d[h]}}class Tn{constructor(u){this.image=u,this.rectangleDetector=new ks(this.image)}detect(){const u=this.rectangleDetector.detect();let l=this.detectSolid1(u);if(l=this.detectSolid2(l),l[3]=this.correctTopRight(l),!l[3])throw new ce;l=this.shiftToModuleCenter(l);const d=l[0],h=l[1],g=l[2],v=l[3];let x=this.transitionsBetween(d,v)+1,b=this.transitionsBetween(g,v)+1;1==(1&x)&&(x+=1),1==(1&b)&&(b+=1),4*x<7*b&&4*b<7*x&&(x=b=Math.max(x,b));let I=Tn.sampleGrid(this.image,d,h,g,v,x,b);return new qr(I,[d,h,g,v])}static shiftPoint(u,l,d){let h=(l.getX()-u.getX())/(d+1),g=(l.getY()-u.getY())/(d+1);return new Ue(u.getX()+h,u.getY()+g)}static moveAway(u,l,d){let h=u.getX(),g=u.getY();return h<l?h-=1:h+=1,g<d?g-=1:g+=1,new Ue(h,g)}detectSolid1(u){let l=u[0],d=u[1],h=u[3],g=u[2],v=this.transitionsBetween(l,d),x=this.transitionsBetween(d,h),b=this.transitionsBetween(h,g),I=this.transitionsBetween(g,l),S=v,k=[g,l,d,h];return S>x&&(S=x,k[0]=l,k[1]=d,k[2]=h,k[3]=g),S>b&&(S=b,k[0]=d,k[1]=h,k[2]=g,k[3]=l),S>I&&(k[0]=h,k[1]=g,k[2]=l,k[3]=d),k}detectSolid2(u){let l=u[0],d=u[1],h=u[2],g=u[3],v=this.transitionsBetween(l,g),x=Tn.shiftPoint(d,h,4*(v+1)),b=Tn.shiftPoint(h,d,4*(v+1));return this.transitionsBetween(x,l)<this.transitionsBetween(b,g)?(u[0]=l,u[1]=d,u[2]=h,u[3]=g):(u[0]=d,u[1]=h,u[2]=g,u[3]=l),u}correctTopRight(u){let l=u[0],d=u[1],h=u[2],g=u[3],v=this.transitionsBetween(l,g),x=this.transitionsBetween(d,g),b=Tn.shiftPoint(l,d,4*(x+1)),I=Tn.shiftPoint(h,d,4*(v+1));v=this.transitionsBetween(b,g),x=this.transitionsBetween(I,g);let S=new Ue(g.getX()+(h.getX()-d.getX())/(v+1),g.getY()+(h.getY()-d.getY())/(v+1)),k=new Ue(g.getX()+(l.getX()-d.getX())/(x+1),g.getY()+(l.getY()-d.getY())/(x+1));return this.isValid(S)?this.isValid(k)?this.transitionsBetween(b,S)+this.transitionsBetween(I,S)>this.transitionsBetween(b,k)+this.transitionsBetween(I,k)?S:k:S:this.isValid(k)?k:null}shiftToModuleCenter(u){let l=u[0],d=u[1],h=u[2],g=u[3],v=this.transitionsBetween(l,g)+1,x=this.transitionsBetween(h,g)+1,b=Tn.shiftPoint(l,d,4*x),I=Tn.shiftPoint(h,d,4*v);v=this.transitionsBetween(b,g)+1,x=this.transitionsBetween(I,g)+1,1==(1&v)&&(v+=1),1==(1&x)&&(x+=1);let L,W,S=(l.getX()+d.getX()+h.getX()+g.getX())/4,k=(l.getY()+d.getY()+h.getY()+g.getY())/4;return l=Tn.moveAway(l,S,k),d=Tn.moveAway(d,S,k),h=Tn.moveAway(h,S,k),g=Tn.moveAway(g,S,k),b=Tn.shiftPoint(l,d,4*x),b=Tn.shiftPoint(b,g,4*v),L=Tn.shiftPoint(d,l,4*x),L=Tn.shiftPoint(L,h,4*v),I=Tn.shiftPoint(h,g,4*x),I=Tn.shiftPoint(I,d,4*v),W=Tn.shiftPoint(g,h,4*x),W=Tn.shiftPoint(W,l,4*v),[b,L,I,W]}isValid(u){return u.getX()>=0&&u.getX()<this.image.getWidth()&&u.getY()>0&&u.getY()<this.image.getHeight()}static sampleGrid(u,l,d,h,g,v,x){return uo.getInstance().sampleGrid(u,v,x,.5,.5,v-.5,.5,v-.5,x-.5,.5,x-.5,l.getX(),l.getY(),g.getX(),g.getY(),h.getX(),h.getY(),d.getX(),d.getY())}transitionsBetween(u,l){let d=Math.trunc(u.getX()),h=Math.trunc(u.getY()),g=Math.trunc(l.getX()),v=Math.trunc(l.getY()),x=Math.abs(v-h)>Math.abs(g-d);if(x){let Z=d;d=h,h=Z,Z=g,g=v,v=Z}let b=Math.abs(g-d),I=Math.abs(v-h),S=-b/2,k=h<v?1:-1,L=d<g?1:-1,W=0,q=this.image.get(x?h:d,x?d:h);for(let Z=d,ne=h;Z!==g;Z+=L){let ie=this.image.get(x?ne:Z,x?Z:ne);if(ie!==q&&(W++,q=ie),S+=I,S>0){if(ne===v)break;ne+=k,S-=b}}return W}}let Vs=(()=>{class D{constructor(){this.decoder=new Pu}decode(l,d=null){let h,g;if(null!=d&&d.has(En.PURE_BARCODE)){const S=D.extractPureBits(l.getBlackMatrix());h=this.decoder.decode(S),g=D.NO_POINTS}else{const S=new Tn(l.getBlackMatrix()).detect();h=this.decoder.decode(S.getBits()),g=S.getPoints()}const v=h.getRawBytes(),x=new fr(h.getText(),v,8*v.length,g,it.DATA_MATRIX,en.currentTimeMillis()),b=h.getByteSegments();null!=b&&x.putMetadata(Yn.BYTE_SEGMENTS,b);const I=h.getECLevel();return null!=I&&x.putMetadata(Yn.ERROR_CORRECTION_LEVEL,I),x}reset(){}static extractPureBits(l){const d=l.getTopLeftOnBit(),h=l.getBottomRightOnBit();if(null==d||null==h)throw new ce;const g=this.moduleSize(d,l);let v=d[1],b=d[0];const S=(h[0]-b+1)/g,k=(h[1]-v+1)/g;if(S<=0||k<=0)throw new ce;const L=g/2;v+=L,b+=L;const W=new Gn(S,k);for(let q=0;q<k;q++){const Z=v+q*g;for(let ne=0;ne<S;ne++)l.get(b+ne*g,Z)&&W.set(ne,q)}return W}static moduleSize(l,d){const h=d.getWidth();let g=l[0];const v=l[1];for(;g<h&&d.get(g,v);)g++;if(g===h)throw new ce;const x=g-l[0];if(0===x)throw new ce;return x}}return D.NO_POINTS=[],D})();var Jo=(()=>{return(D=Jo||(Jo={}))[D.L=0]="L",D[D.M=1]="M",D[D.Q=2]="Q",D[D.H=3]="H",Jo;var D})();class Oe{constructor(u,l,d){this.value=u,this.stringValue=l,this.bits=d,Oe.FOR_BITS.set(d,this),Oe.FOR_VALUE.set(u,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(u){switch(u){case"L":return Oe.L;case"M":return Oe.M;case"Q":return Oe.Q;case"H":return Oe.H;default:throw new oi(u+"not available")}}toString(){return this.stringValue}equals(u){return u instanceof Oe&&this.value===u.value}static forBits(u){if(u<0||u>=Oe.FOR_BITS.size)throw new Ye;return Oe.FOR_BITS.get(u)}}Oe.FOR_BITS=new Map,Oe.FOR_VALUE=new Map,Oe.L=new Oe(Jo.L,"L",1),Oe.M=new Oe(Jo.M,"M",0),Oe.Q=new Oe(Jo.Q,"Q",3),Oe.H=new Oe(Jo.H,"H",2);class Qn{constructor(u){this.errorCorrectionLevel=Oe.forBits(u>>3&3),this.dataMask=7&u}static numBitsDiffering(u,l){return Ct.bitCount(u^l)}static decodeFormatInformation(u,l){const d=Qn.doDecodeFormatInformation(u,l);return null!==d?d:Qn.doDecodeFormatInformation(u^Qn.FORMAT_INFO_MASK_QR,l^Qn.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(u,l){let d=Number.MAX_SAFE_INTEGER,h=0;for(const g of Qn.FORMAT_INFO_DECODE_LOOKUP){const v=g[0];if(v===u||v===l)return new Qn(g[1]);let x=Qn.numBitsDiffering(u,v);x<d&&(h=g[1],d=x),u!==l&&(x=Qn.numBitsDiffering(l,v),x<d&&(h=g[1],d=x))}return d<=3?new Qn(h):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(u){return u instanceof Qn&&this.errorCorrectionLevel===u.errorCorrectionLevel&&this.dataMask===u.dataMask}}Qn.FORMAT_INFO_MASK_QR=21522,Qn.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class re{constructor(u,...l){this.ecCodewordsPerBlock=u,this.ecBlocks=l}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let u=0;const l=this.ecBlocks;for(const d of l)u+=d.getCount();return u}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class j{constructor(u,l){this.count=u,this.dataCodewords=l}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class Ze{constructor(u,l,...d){this.versionNumber=u,this.alignmentPatternCenters=l,this.ecBlocks=d;let h=0;const g=d[0].getECCodewordsPerBlock(),v=d[0].getECBlocks();for(const x of v)h+=x.getCount()*(x.getDataCodewords()+g);this.totalCodewords=h}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(u){return this.ecBlocks[u.getValue()]}static getProvisionalVersionForDimension(u){if(u%4!=1)throw new Re;try{return this.getVersionForNumber((u-17)/4)}catch(l){throw new Re}}static getVersionForNumber(u){if(u<1||u>40)throw new Ye;return Ze.VERSIONS[u-1]}static decodeVersionInformation(u){let l=Number.MAX_SAFE_INTEGER,d=0;for(let h=0;h<Ze.VERSION_DECODE_INFO.length;h++){const g=Ze.VERSION_DECODE_INFO[h];if(g===u)return Ze.getVersionForNumber(h+7);const v=Qn.numBitsDiffering(u,g);v<l&&(d=h+7,l=v)}return l<=3?Ze.getVersionForNumber(d):null}buildFunctionPattern(){const u=this.getDimensionForVersion(),l=new Gn(u);l.setRegion(0,0,9,9),l.setRegion(u-8,0,8,9),l.setRegion(0,u-8,9,8);const d=this.alignmentPatternCenters.length;for(let h=0;h<d;h++){const g=this.alignmentPatternCenters[h]-2;for(let v=0;v<d;v++)0===h&&(0===v||v===d-1)||h===d-1&&0===v||l.setRegion(this.alignmentPatternCenters[v]-2,g,5,5)}return l.setRegion(6,9,1,u-17),l.setRegion(9,6,u-17,1),this.versionNumber>6&&(l.setRegion(u-11,0,3,6),l.setRegion(0,u-11,6,3)),l}toString(){return""+this.versionNumber}}Ze.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),Ze.VERSIONS=[new Ze(1,new Int32Array(0),new re(7,new j(1,19)),new re(10,new j(1,16)),new re(13,new j(1,13)),new re(17,new j(1,9))),new Ze(2,Int32Array.from([6,18]),new re(10,new j(1,34)),new re(16,new j(1,28)),new re(22,new j(1,22)),new re(28,new j(1,16))),new Ze(3,Int32Array.from([6,22]),new re(15,new j(1,55)),new re(26,new j(1,44)),new re(18,new j(2,17)),new re(22,new j(2,13))),new Ze(4,Int32Array.from([6,26]),new re(20,new j(1,80)),new re(18,new j(2,32)),new re(26,new j(2,24)),new re(16,new j(4,9))),new Ze(5,Int32Array.from([6,30]),new re(26,new j(1,108)),new re(24,new j(2,43)),new re(18,new j(2,15),new j(2,16)),new re(22,new j(2,11),new j(2,12))),new Ze(6,Int32Array.from([6,34]),new re(18,new j(2,68)),new re(16,new j(4,27)),new re(24,new j(4,19)),new re(28,new j(4,15))),new Ze(7,Int32Array.from([6,22,38]),new re(20,new j(2,78)),new re(18,new j(4,31)),new re(18,new j(2,14),new j(4,15)),new re(26,new j(4,13),new j(1,14))),new Ze(8,Int32Array.from([6,24,42]),new re(24,new j(2,97)),new re(22,new j(2,38),new j(2,39)),new re(22,new j(4,18),new j(2,19)),new re(26,new j(4,14),new j(2,15))),new Ze(9,Int32Array.from([6,26,46]),new re(30,new j(2,116)),new re(22,new j(3,36),new j(2,37)),new re(20,new j(4,16),new j(4,17)),new re(24,new j(4,12),new j(4,13))),new Ze(10,Int32Array.from([6,28,50]),new re(18,new j(2,68),new j(2,69)),new re(26,new j(4,43),new j(1,44)),new re(24,new j(6,19),new j(2,20)),new re(28,new j(6,15),new j(2,16))),new Ze(11,Int32Array.from([6,30,54]),new re(20,new j(4,81)),new re(30,new j(1,50),new j(4,51)),new re(28,new j(4,22),new j(4,23)),new re(24,new j(3,12),new j(8,13))),new Ze(12,Int32Array.from([6,32,58]),new re(24,new j(2,92),new j(2,93)),new re(22,new j(6,36),new j(2,37)),new re(26,new j(4,20),new j(6,21)),new re(28,new j(7,14),new j(4,15))),new Ze(13,Int32Array.from([6,34,62]),new re(26,new j(4,107)),new re(22,new j(8,37),new j(1,38)),new re(24,new j(8,20),new j(4,21)),new re(22,new j(12,11),new j(4,12))),new Ze(14,Int32Array.from([6,26,46,66]),new re(30,new j(3,115),new j(1,116)),new re(24,new j(4,40),new j(5,41)),new re(20,new j(11,16),new j(5,17)),new re(24,new j(11,12),new j(5,13))),new Ze(15,Int32Array.from([6,26,48,70]),new re(22,new j(5,87),new j(1,88)),new re(24,new j(5,41),new j(5,42)),new re(30,new j(5,24),new j(7,25)),new re(24,new j(11,12),new j(7,13))),new Ze(16,Int32Array.from([6,26,50,74]),new re(24,new j(5,98),new j(1,99)),new re(28,new j(7,45),new j(3,46)),new re(24,new j(15,19),new j(2,20)),new re(30,new j(3,15),new j(13,16))),new Ze(17,Int32Array.from([6,30,54,78]),new re(28,new j(1,107),new j(5,108)),new re(28,new j(10,46),new j(1,47)),new re(28,new j(1,22),new j(15,23)),new re(28,new j(2,14),new j(17,15))),new Ze(18,Int32Array.from([6,30,56,82]),new re(30,new j(5,120),new j(1,121)),new re(26,new j(9,43),new j(4,44)),new re(28,new j(17,22),new j(1,23)),new re(28,new j(2,14),new j(19,15))),new Ze(19,Int32Array.from([6,30,58,86]),new re(28,new j(3,113),new j(4,114)),new re(26,new j(3,44),new j(11,45)),new re(26,new j(17,21),new j(4,22)),new re(26,new j(9,13),new j(16,14))),new Ze(20,Int32Array.from([6,34,62,90]),new re(28,new j(3,107),new j(5,108)),new re(26,new j(3,41),new j(13,42)),new re(30,new j(15,24),new j(5,25)),new re(28,new j(15,15),new j(10,16))),new Ze(21,Int32Array.from([6,28,50,72,94]),new re(28,new j(4,116),new j(4,117)),new re(26,new j(17,42)),new re(28,new j(17,22),new j(6,23)),new re(30,new j(19,16),new j(6,17))),new Ze(22,Int32Array.from([6,26,50,74,98]),new re(28,new j(2,111),new j(7,112)),new re(28,new j(17,46)),new re(30,new j(7,24),new j(16,25)),new re(24,new j(34,13))),new Ze(23,Int32Array.from([6,30,54,78,102]),new re(30,new j(4,121),new j(5,122)),new re(28,new j(4,47),new j(14,48)),new re(30,new j(11,24),new j(14,25)),new re(30,new j(16,15),new j(14,16))),new Ze(24,Int32Array.from([6,28,54,80,106]),new re(30,new j(6,117),new j(4,118)),new re(28,new j(6,45),new j(14,46)),new re(30,new j(11,24),new j(16,25)),new re(30,new j(30,16),new j(2,17))),new Ze(25,Int32Array.from([6,32,58,84,110]),new re(26,new j(8,106),new j(4,107)),new re(28,new j(8,47),new j(13,48)),new re(30,new j(7,24),new j(22,25)),new re(30,new j(22,15),new j(13,16))),new Ze(26,Int32Array.from([6,30,58,86,114]),new re(28,new j(10,114),new j(2,115)),new re(28,new j(19,46),new j(4,47)),new re(28,new j(28,22),new j(6,23)),new re(30,new j(33,16),new j(4,17))),new Ze(27,Int32Array.from([6,34,62,90,118]),new re(30,new j(8,122),new j(4,123)),new re(28,new j(22,45),new j(3,46)),new re(30,new j(8,23),new j(26,24)),new re(30,new j(12,15),new j(28,16))),new Ze(28,Int32Array.from([6,26,50,74,98,122]),new re(30,new j(3,117),new j(10,118)),new re(28,new j(3,45),new j(23,46)),new re(30,new j(4,24),new j(31,25)),new re(30,new j(11,15),new j(31,16))),new Ze(29,Int32Array.from([6,30,54,78,102,126]),new re(30,new j(7,116),new j(7,117)),new re(28,new j(21,45),new j(7,46)),new re(30,new j(1,23),new j(37,24)),new re(30,new j(19,15),new j(26,16))),new Ze(30,Int32Array.from([6,26,52,78,104,130]),new re(30,new j(5,115),new j(10,116)),new re(28,new j(19,47),new j(10,48)),new re(30,new j(15,24),new j(25,25)),new re(30,new j(23,15),new j(25,16))),new Ze(31,Int32Array.from([6,30,56,82,108,134]),new re(30,new j(13,115),new j(3,116)),new re(28,new j(2,46),new j(29,47)),new re(30,new j(42,24),new j(1,25)),new re(30,new j(23,15),new j(28,16))),new Ze(32,Int32Array.from([6,34,60,86,112,138]),new re(30,new j(17,115)),new re(28,new j(10,46),new j(23,47)),new re(30,new j(10,24),new j(35,25)),new re(30,new j(19,15),new j(35,16))),new Ze(33,Int32Array.from([6,30,58,86,114,142]),new re(30,new j(17,115),new j(1,116)),new re(28,new j(14,46),new j(21,47)),new re(30,new j(29,24),new j(19,25)),new re(30,new j(11,15),new j(46,16))),new Ze(34,Int32Array.from([6,34,62,90,118,146]),new re(30,new j(13,115),new j(6,116)),new re(28,new j(14,46),new j(23,47)),new re(30,new j(44,24),new j(7,25)),new re(30,new j(59,16),new j(1,17))),new Ze(35,Int32Array.from([6,30,54,78,102,126,150]),new re(30,new j(12,121),new j(7,122)),new re(28,new j(12,47),new j(26,48)),new re(30,new j(39,24),new j(14,25)),new re(30,new j(22,15),new j(41,16))),new Ze(36,Int32Array.from([6,24,50,76,102,128,154]),new re(30,new j(6,121),new j(14,122)),new re(28,new j(6,47),new j(34,48)),new re(30,new j(46,24),new j(10,25)),new re(30,new j(2,15),new j(64,16))),new Ze(37,Int32Array.from([6,28,54,80,106,132,158]),new re(30,new j(17,122),new j(4,123)),new re(28,new j(29,46),new j(14,47)),new re(30,new j(49,24),new j(10,25)),new re(30,new j(24,15),new j(46,16))),new Ze(38,Int32Array.from([6,32,58,84,110,136,162]),new re(30,new j(4,122),new j(18,123)),new re(28,new j(13,46),new j(32,47)),new re(30,new j(48,24),new j(14,25)),new re(30,new j(42,15),new j(32,16))),new Ze(39,Int32Array.from([6,26,54,82,110,138,166]),new re(30,new j(20,117),new j(4,118)),new re(28,new j(40,47),new j(7,48)),new re(30,new j(43,24),new j(22,25)),new re(30,new j(10,15),new j(67,16))),new Ze(40,Int32Array.from([6,30,58,86,114,142,170]),new re(30,new j(19,118),new j(6,119)),new re(28,new j(18,47),new j(31,48)),new re(30,new j(34,24),new j(34,25)),new re(30,new j(20,15),new j(61,16)))];var hr=(()=>{return(D=hr||(hr={}))[D.DATA_MASK_000=0]="DATA_MASK_000",D[D.DATA_MASK_001=1]="DATA_MASK_001",D[D.DATA_MASK_010=2]="DATA_MASK_010",D[D.DATA_MASK_011=3]="DATA_MASK_011",D[D.DATA_MASK_100=4]="DATA_MASK_100",D[D.DATA_MASK_101=5]="DATA_MASK_101",D[D.DATA_MASK_110=6]="DATA_MASK_110",D[D.DATA_MASK_111=7]="DATA_MASK_111",hr;var D})();class er{constructor(u,l){this.value=u,this.isMasked=l}unmaskBitMatrix(u,l){for(let d=0;d<l;d++)for(let h=0;h<l;h++)this.isMasked(d,h)&&u.flip(h,d)}}er.values=new Map([[hr.DATA_MASK_000,new er(hr.DATA_MASK_000,(D,u)=>0==(D+u&1))],[hr.DATA_MASK_001,new er(hr.DATA_MASK_001,(D,u)=>0==(1&D))],[hr.DATA_MASK_010,new er(hr.DATA_MASK_010,(D,u)=>u%3==0)],[hr.DATA_MASK_011,new er(hr.DATA_MASK_011,(D,u)=>(D+u)%3==0)],[hr.DATA_MASK_100,new er(hr.DATA_MASK_100,(D,u)=>0==(Math.floor(D/2)+Math.floor(u/3)&1))],[hr.DATA_MASK_101,new er(hr.DATA_MASK_101,(D,u)=>D*u%6==0)],[hr.DATA_MASK_110,new er(hr.DATA_MASK_110,(D,u)=>D*u%6<3)],[hr.DATA_MASK_111,new er(hr.DATA_MASK_111,(D,u)=>0==(D+u+D*u%3&1))]]);class pi{constructor(u){const l=u.getHeight();if(l<21||1!=(3&l))throw new Re;this.bitMatrix=u}readFormatInformation(){if(null!=this.parsedFormatInfo)return this.parsedFormatInfo;let u=0;for(let g=0;g<6;g++)u=this.copyBit(g,8,u);u=this.copyBit(7,8,u),u=this.copyBit(8,8,u),u=this.copyBit(8,7,u);for(let g=5;g>=0;g--)u=this.copyBit(8,g,u);const l=this.bitMatrix.getHeight();let d=0;const h=l-7;for(let g=l-1;g>=h;g--)d=this.copyBit(8,g,d);for(let g=l-8;g<l;g++)d=this.copyBit(g,8,d);if(this.parsedFormatInfo=Qn.decodeFormatInformation(u,d),null!==this.parsedFormatInfo)return this.parsedFormatInfo;throw new Re}readVersion(){if(null!=this.parsedVersion)return this.parsedVersion;const u=this.bitMatrix.getHeight(),l=Math.floor((u-17)/4);if(l<=6)return Ze.getVersionForNumber(l);let d=0;const h=u-11;for(let v=5;v>=0;v--)for(let x=u-9;x>=h;x--)d=this.copyBit(x,v,d);let g=Ze.decodeVersionInformation(d);if(null!==g&&g.getDimensionForVersion()===u)return this.parsedVersion=g,g;d=0;for(let v=5;v>=0;v--)for(let x=u-9;x>=h;x--)d=this.copyBit(v,x,d);if(g=Ze.decodeVersionInformation(d),null!==g&&g.getDimensionForVersion()===u)return this.parsedVersion=g,g;throw new Re}copyBit(u,l,d){return(this.isMirror?this.bitMatrix.get(l,u):this.bitMatrix.get(u,l))?d<<1|1:d<<1}readCodewords(){const u=this.readFormatInformation(),l=this.readVersion(),d=er.values.get(u.getDataMask()),h=this.bitMatrix.getHeight();d.unmaskBitMatrix(this.bitMatrix,h);const g=l.buildFunctionPattern();let v=!0;const x=new Uint8Array(l.getTotalCodewords());let b=0,I=0,S=0;for(let k=h-1;k>0;k-=2){6===k&&k--;for(let L=0;L<h;L++){const W=v?h-1-L:L;for(let q=0;q<2;q++)g.get(k-q,W)||(S++,I<<=1,this.bitMatrix.get(k-q,W)&&(I|=1),8===S&&(x[b++]=I,S=0,I=0))}v=!v}if(b!==l.getTotalCodewords())throw new Re;return x}remask(){if(null===this.parsedFormatInfo)return;const u=er.values[this.parsedFormatInfo.getDataMask()],l=this.bitMatrix.getHeight();u.unmaskBitMatrix(this.bitMatrix,l)}setMirror(u){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=u}mirror(){const u=this.bitMatrix;for(let l=0,d=u.getWidth();l<d;l++)for(let h=l+1,g=u.getHeight();h<g;h++)u.get(l,h)!==u.get(h,l)&&(u.flip(h,l),u.flip(l,h))}}class Lu{constructor(u,l){this.numDataCodewords=u,this.codewords=l}static getDataBlocks(u,l,d){if(u.length!==l.getTotalCodewords())throw new Ye;const h=l.getECBlocksForLevel(d);let g=0;const v=h.getECBlocks();for(const q of v)g+=q.getCount();const x=new Array(g);let b=0;for(const q of v)for(let Z=0;Z<q.getCount();Z++){const ne=q.getDataCodewords(),ie=h.getECCodewordsPerBlock()+ne;x[b++]=new Lu(ne,new Uint8Array(ie))}const I=x[0].codewords.length;let S=x.length-1;for(;S>=0&&x[S].codewords.length!==I;)S--;S++;const k=I-h.getECCodewordsPerBlock();let L=0;for(let q=0;q<k;q++)for(let Z=0;Z<b;Z++)x[Z].codewords[q]=u[L++];for(let q=S;q<b;q++)x[q].codewords[k]=u[L++];const W=x[0].codewords.length;for(let q=k;q<W;q++)for(let Z=0;Z<b;Z++)x[Z].codewords[Z<S?q:q+1]=u[L++];return x}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}var gi=(()=>{return(D=gi||(gi={}))[D.TERMINATOR=0]="TERMINATOR",D[D.NUMERIC=1]="NUMERIC",D[D.ALPHANUMERIC=2]="ALPHANUMERIC",D[D.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",D[D.BYTE=4]="BYTE",D[D.ECI=5]="ECI",D[D.KANJI=6]="KANJI",D[D.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",D[D.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",D[D.HANZI=9]="HANZI",gi;var D})();class ke{constructor(u,l,d,h){this.value=u,this.stringValue=l,this.characterCountBitsForVersions=d,this.bits=h,ke.FOR_BITS.set(h,this),ke.FOR_VALUE.set(u,this)}static forBits(u){const l=ke.FOR_BITS.get(u);if(void 0===l)throw new Ye;return l}getCharacterCountBits(u){const l=u.getVersionNumber();let d;return d=l<=9?0:l<=26?1:2,this.characterCountBitsForVersions[d]}getValue(){return this.value}getBits(){return this.bits}equals(u){return u instanceof ke&&this.value===u.value}toString(){return this.stringValue}}ke.FOR_BITS=new Map,ke.FOR_VALUE=new Map,ke.TERMINATOR=new ke(gi.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),ke.NUMERIC=new ke(gi.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),ke.ALPHANUMERIC=new ke(gi.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),ke.STRUCTURED_APPEND=new ke(gi.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),ke.BYTE=new ke(gi.BYTE,"BYTE",Int32Array.from([8,16,16]),4),ke.ECI=new ke(gi.ECI,"ECI",Int32Array.from([0,0,0]),7),ke.KANJI=new ke(gi.KANJI,"KANJI",Int32Array.from([8,10,12]),8),ke.FNC1_FIRST_POSITION=new ke(gi.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),ke.FNC1_SECOND_POSITION=new ke(gi.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),ke.HANZI=new ke(gi.HANZI,"HANZI",Int32Array.from([8,10,12]),13);let tu=(()=>{class D{static decode(l,d,h,g){const v=new eu(l);let x=new rn;const b=new Array;let I=-1,S=-1;try{let W,k=null,L=!1;do{if(v.available()<4)W=ke.TERMINATOR;else{const q=v.readBits(4);W=ke.forBits(q)}switch(W){case ke.TERMINATOR:break;case ke.FNC1_FIRST_POSITION:case ke.FNC1_SECOND_POSITION:L=!0;break;case ke.STRUCTURED_APPEND:if(v.available()<16)throw new Re;I=v.readBits(8),S=v.readBits(8);break;case ke.ECI:const q=D.parseECIValue(v);if(k=Ee.getCharacterSetECIByValue(q),null===k)throw new Re;break;case ke.HANZI:const Z=v.readBits(4),ne=v.readBits(W.getCharacterCountBits(d));Z===D.GB2312_SUBSET&&D.decodeHanziSegment(v,x,ne);break;default:const ie=v.readBits(W.getCharacterCountBits(d));switch(W){case ke.NUMERIC:D.decodeNumericSegment(v,x,ie);break;case ke.ALPHANUMERIC:D.decodeAlphanumericSegment(v,x,ie,L);break;case ke.BYTE:D.decodeByteSegment(v,x,ie,k,b,g);break;case ke.KANJI:D.decodeKanjiSegment(v,x,ie);break;default:throw new Re}}}while(W!==ke.TERMINATOR)}catch(k){throw new Re}return new Xo(l,x.toString(),0===b.length?null:b,null===h?null:h.toString(),I,S)}static decodeHanziSegment(l,d,h){if(13*h>l.available())throw new Re;const g=new Uint8Array(2*h);let v=0;for(;h>0;){const x=l.readBits(13);let b=x/96<<8&4294967295|x%96;b+=b<959?41377:42657,g[v]=b>>8&255,g[v+1]=255&b,v+=2,h--}try{d.append(vn.decode(g,at.GB2312))}catch(x){throw new Re(x)}}static decodeKanjiSegment(l,d,h){if(13*h>l.available())throw new Re;const g=new Uint8Array(2*h);let v=0;for(;h>0;){const x=l.readBits(13);let b=x/192<<8&4294967295|x%192;b+=b<7936?33088:49472,g[v]=b>>8,g[v+1]=b,v+=2,h--}try{d.append(vn.decode(g,at.SHIFT_JIS))}catch(x){throw new Re(x)}}static decodeByteSegment(l,d,h,g,v,x){if(8*h>l.available())throw new Re;const b=new Uint8Array(h);for(let S=0;S<h;S++)b[S]=l.readBits(8);let I;I=null===g?at.guessEncoding(b,x):g.getName();try{d.append(vn.decode(b,I))}catch(S){throw new Re(S)}v.push(b)}static toAlphaNumericChar(l){if(l>=D.ALPHANUMERIC_CHARS.length)throw new Re;return D.ALPHANUMERIC_CHARS[l]}static decodeAlphanumericSegment(l,d,h,g){const v=d.length();for(;h>1;){if(l.available()<11)throw new Re;const x=l.readBits(11);d.append(D.toAlphaNumericChar(Math.floor(x/45))),d.append(D.toAlphaNumericChar(x%45)),h-=2}if(1===h){if(l.available()<6)throw new Re;d.append(D.toAlphaNumericChar(l.readBits(6)))}if(g)for(let x=v;x<d.length();x++)"%"===d.charAt(x)&&(x<d.length()-1&&"%"===d.charAt(x+1)?d.deleteCharAt(x+1):d.setCharAt(x,String.fromCharCode(29)))}static decodeNumericSegment(l,d,h){for(;h>=3;){if(l.available()<10)throw new Re;const g=l.readBits(10);if(g>=1e3)throw new Re;d.append(D.toAlphaNumericChar(Math.floor(g/100))),d.append(D.toAlphaNumericChar(Math.floor(g/10)%10)),d.append(D.toAlphaNumericChar(g%10)),h-=3}if(2===h){if(l.available()<7)throw new Re;const g=l.readBits(7);if(g>=100)throw new Re;d.append(D.toAlphaNumericChar(Math.floor(g/10))),d.append(D.toAlphaNumericChar(g%10))}else if(1===h){if(l.available()<4)throw new Re;const g=l.readBits(4);if(g>=10)throw new Re;d.append(D.toAlphaNumericChar(g))}}static parseECIValue(l){const d=l.readBits(8);if(0==(128&d))return 127&d;if(128==(192&d))return(63&d)<<8&4294967295|l.readBits(8);if(192==(224&d))return(31&d)<<16&4294967295|l.readBits(16);throw new Re}}return D.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",D.GB2312_SUBSET=1,D})();class xc{constructor(u){this.mirrored=u}isMirrored(){return this.mirrored}applyMirroredCorrection(u){if(!this.mirrored||null===u||u.length<3)return;const l=u[0];u[0]=u[2],u[2]=l}}class Jl{constructor(){this.rsDecoder=new Ps(Pt.QR_CODE_FIELD_256)}decodeBooleanArray(u,l){return this.decodeBitMatrix(Gn.parseFromBooleanArray(u),l)}decodeBitMatrix(u,l){const d=new pi(u);let h=null;try{return this.decodeBitMatrixParser(d,l)}catch(g){h=g}try{d.remask(),d.setMirror(!0),d.readVersion(),d.readFormatInformation(),d.mirror();const g=this.decodeBitMatrixParser(d,l);return g.setOther(new xc(!0)),g}catch(g){throw null!==h?h:g}}decodeBitMatrixParser(u,l){const d=u.readVersion(),h=u.readFormatInformation().getErrorCorrectionLevel(),g=u.readCodewords(),v=Lu.getDataBlocks(g,d,h);let x=0;for(const S of v)x+=S.getNumDataCodewords();const b=new Uint8Array(x);let I=0;for(const S of v){const k=S.getCodewords(),L=S.getNumDataCodewords();this.correctErrors(k,L);for(let W=0;W<L;W++)b[I++]=k[W]}return tu.decode(b,d,h,l)}correctErrors(u,l){const d=new Int32Array(u);try{this.rsDecoder.decode(d,u.length-l)}catch(h){throw new Dt}for(let h=0;h<l;h++)u[h]=d[h]}}class wc extends Ue{constructor(u,l,d){super(u,l),this.estimatedModuleSize=d}aboutEquals(u,l,d){if(Math.abs(l-this.getY())<=u&&Math.abs(d-this.getX())<=u){const h=Math.abs(u-this.estimatedModuleSize);return h<=1||h<=this.estimatedModuleSize}return!1}combineEstimate(u,l,d){const h=(this.getX()+l)/2,g=(this.getY()+u)/2;return new wc(h,g,(this.estimatedModuleSize+d)/2)}}class kt{constructor(u,l,d,h,g,v,x){this.image=u,this.startX=l,this.startY=d,this.width=h,this.height=g,this.moduleSize=v,this.resultPointCallback=x,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const u=this.startX,l=this.height,h=u+this.width,g=this.startY+l/2,v=new Int32Array(3),x=this.image;for(let b=0;b<l;b++){const I=g+(0==(1&b)?Math.floor((b+1)/2):-Math.floor((b+1)/2));v[0]=0,v[1]=0,v[2]=0;let S=u;for(;S<h&&!x.get(S,I);)S++;let k=0;for(;S<h;){if(x.get(S,I))if(1===k)v[1]++;else if(2===k){if(this.foundPatternCross(v)){const L=this.handlePossibleCenter(v,I,S);if(null!==L)return L}v[0]=v[2],v[1]=1,v[2]=0,k=1}else v[++k]++;else 1===k&&k++,v[k]++;S++}if(this.foundPatternCross(v)){const L=this.handlePossibleCenter(v,I,h);if(null!==L)return L}}if(0!==this.possibleCenters.length)return this.possibleCenters[0];throw new ce}static centerFromEnd(u,l){return l-u[2]-u[1]/2}foundPatternCross(u){const l=this.moduleSize,d=l/2;for(let h=0;h<3;h++)if(Math.abs(l-u[h])>=d)return!1;return!0}crossCheckVertical(u,l,d,h){const g=this.image,v=g.getHeight(),x=this.crossCheckStateCount;x[0]=0,x[1]=0,x[2]=0;let b=u;for(;b>=0&&g.get(l,b)&&x[1]<=d;)x[1]++,b--;if(b<0||x[1]>d)return NaN;for(;b>=0&&!g.get(l,b)&&x[0]<=d;)x[0]++,b--;if(x[0]>d)return NaN;for(b=u+1;b<v&&g.get(l,b)&&x[1]<=d;)x[1]++,b++;if(b===v||x[1]>d)return NaN;for(;b<v&&!g.get(l,b)&&x[2]<=d;)x[2]++,b++;return x[2]>d||5*Math.abs(x[0]+x[1]+x[2]-h)>=2*h?NaN:this.foundPatternCross(x)?kt.centerFromEnd(x,b):NaN}handlePossibleCenter(u,l,d){const h=u[0]+u[1]+u[2],g=kt.centerFromEnd(u,d),v=this.crossCheckVertical(l,g,2*u[1],h);if(!isNaN(v)){const x=(u[0]+u[1]+u[2])/3;for(const I of this.possibleCenters)if(I.aboutEquals(x,v,g))return I.combineEstimate(v,g,x);const b=new wc(g,v,x);this.possibleCenters.push(b),null!=this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(b)}return null}}class bc extends Ue{constructor(u,l,d,h){super(u,l),this.estimatedModuleSize=d,this.count=h,void 0===h&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(u,l,d){if(Math.abs(l-this.getY())<=u&&Math.abs(d-this.getX())<=u){const h=Math.abs(u-this.estimatedModuleSize);return h<=1||h<=this.estimatedModuleSize}return!1}combineEstimate(u,l,d){const h=this.count+1,g=(this.count*this.getX()+l)/h,v=(this.count*this.getY()+u)/h;return new bc(g,v,(this.count*this.estimatedModuleSize+d)/h,h)}}class Hd{constructor(u){this.bottomLeft=u[0],this.topLeft=u[1],this.topRight=u[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}let Us=(()=>{class D{constructor(l,d){this.image=l,this.resultPointCallback=d,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=d}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(l){const d=null!=l&&void 0!==l.get(En.TRY_HARDER),h=null!=l&&void 0!==l.get(En.PURE_BARCODE),g=this.image,v=g.getHeight(),x=g.getWidth();let b=Math.floor(3*v/(4*D.MAX_MODULES));(b<D.MIN_SKIP||d)&&(b=D.MIN_SKIP);let I=!1;const S=new Int32Array(5);for(let L=b-1;L<v&&!I;L+=b){S[0]=0,S[1]=0,S[2]=0,S[3]=0,S[4]=0;let W=0;for(let q=0;q<x;q++)if(g.get(q,L))1==(1&W)&&W++,S[W]++;else if(0==(1&W))if(4===W)if(D.foundPatternCross(S)){if(!0!==this.handlePossibleCenter(S,L,q,h)){S[0]=S[2],S[1]=S[3],S[2]=S[4],S[3]=1,S[4]=0,W=3;continue}if(b=2,!0===this.hasSkipped)I=this.haveMultiplyConfirmedCenters();else{const ne=this.findRowSkip();ne>S[2]&&(L+=ne-S[2]-b,q=x-1)}W=0,S[0]=0,S[1]=0,S[2]=0,S[3]=0,S[4]=0}else S[0]=S[2],S[1]=S[3],S[2]=S[4],S[3]=1,S[4]=0,W=3;else S[++W]++;else S[W]++;D.foundPatternCross(S)&&!0===this.handlePossibleCenter(S,L,x,h)&&(b=S[0],this.hasSkipped&&(I=this.haveMultiplyConfirmedCenters()))}const k=this.selectBestPatterns();return Ue.orderBestPatterns(k),new Hd(k)}static centerFromEnd(l,d){return d-l[4]-l[3]-l[2]/2}static foundPatternCross(l){let d=0;for(let v=0;v<5;v++){const x=l[v];if(0===x)return!1;d+=x}if(d<7)return!1;const h=d/7,g=h/2;return Math.abs(h-l[0])<g&&Math.abs(h-l[1])<g&&Math.abs(3*h-l[2])<3*g&&Math.abs(h-l[3])<g&&Math.abs(h-l[4])<g}getCrossCheckStateCount(){const l=this.crossCheckStateCount;return l[0]=0,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l}crossCheckDiagonal(l,d,h,g){const v=this.getCrossCheckStateCount();let x=0;const b=this.image;for(;l>=x&&d>=x&&b.get(d-x,l-x);)v[2]++,x++;if(l<x||d<x)return!1;for(;l>=x&&d>=x&&!b.get(d-x,l-x)&&v[1]<=h;)v[1]++,x++;if(l<x||d<x||v[1]>h)return!1;for(;l>=x&&d>=x&&b.get(d-x,l-x)&&v[0]<=h;)v[0]++,x++;if(v[0]>h)return!1;const I=b.getHeight(),S=b.getWidth();for(x=1;l+x<I&&d+x<S&&b.get(d+x,l+x);)v[2]++,x++;if(l+x>=I||d+x>=S)return!1;for(;l+x<I&&d+x<S&&!b.get(d+x,l+x)&&v[3]<h;)v[3]++,x++;if(l+x>=I||d+x>=S||v[3]>=h)return!1;for(;l+x<I&&d+x<S&&b.get(d+x,l+x)&&v[4]<h;)v[4]++,x++;return!(v[4]>=h)&&Math.abs(v[0]+v[1]+v[2]+v[3]+v[4]-g)<2*g&&D.foundPatternCross(v)}crossCheckVertical(l,d,h,g){const v=this.image,x=v.getHeight(),b=this.getCrossCheckStateCount();let I=l;for(;I>=0&&v.get(d,I);)b[2]++,I--;if(I<0)return NaN;for(;I>=0&&!v.get(d,I)&&b[1]<=h;)b[1]++,I--;if(I<0||b[1]>h)return NaN;for(;I>=0&&v.get(d,I)&&b[0]<=h;)b[0]++,I--;if(b[0]>h)return NaN;for(I=l+1;I<x&&v.get(d,I);)b[2]++,I++;if(I===x)return NaN;for(;I<x&&!v.get(d,I)&&b[3]<h;)b[3]++,I++;if(I===x||b[3]>=h)return NaN;for(;I<x&&v.get(d,I)&&b[4]<h;)b[4]++,I++;return b[4]>=h||5*Math.abs(b[0]+b[1]+b[2]+b[3]+b[4]-g)>=2*g?NaN:D.foundPatternCross(b)?D.centerFromEnd(b,I):NaN}crossCheckHorizontal(l,d,h,g){const v=this.image,x=v.getWidth(),b=this.getCrossCheckStateCount();let I=l;for(;I>=0&&v.get(I,d);)b[2]++,I--;if(I<0)return NaN;for(;I>=0&&!v.get(I,d)&&b[1]<=h;)b[1]++,I--;if(I<0||b[1]>h)return NaN;for(;I>=0&&v.get(I,d)&&b[0]<=h;)b[0]++,I--;if(b[0]>h)return NaN;for(I=l+1;I<x&&v.get(I,d);)b[2]++,I++;if(I===x)return NaN;for(;I<x&&!v.get(I,d)&&b[3]<h;)b[3]++,I++;if(I===x||b[3]>=h)return NaN;for(;I<x&&v.get(I,d)&&b[4]<h;)b[4]++,I++;return b[4]>=h||5*Math.abs(b[0]+b[1]+b[2]+b[3]+b[4]-g)>=g?NaN:D.foundPatternCross(b)?D.centerFromEnd(b,I):NaN}handlePossibleCenter(l,d,h,g){const v=l[0]+l[1]+l[2]+l[3]+l[4];let x=D.centerFromEnd(l,h),b=this.crossCheckVertical(d,Math.floor(x),l[2],v);if(!isNaN(b)&&(x=this.crossCheckHorizontal(Math.floor(x),Math.floor(b),l[2],v),!isNaN(x)&&(!g||this.crossCheckDiagonal(Math.floor(b),Math.floor(x),l[2],v)))){const I=v/7;let S=!1;const k=this.possibleCenters;for(let L=0,W=k.length;L<W;L++){const q=k[L];if(q.aboutEquals(I,b,x)){k[L]=q.combineEstimate(b,x,I),S=!0;break}}if(!S){const L=new bc(x,b,I);k.push(L),null!=this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(L)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let d=null;for(const h of this.possibleCenters)if(h.getCount()>=D.CENTER_QUORUM){if(null!=d)return this.hasSkipped=!0,Math.floor((Math.abs(d.getX()-h.getX())-Math.abs(d.getY()-h.getY()))/2);d=h}return 0}haveMultiplyConfirmedCenters(){let l=0,d=0;const h=this.possibleCenters.length;for(const x of this.possibleCenters)x.getCount()>=D.CENTER_QUORUM&&(l++,d+=x.getEstimatedModuleSize());if(l<3)return!1;const g=d/h;let v=0;for(const x of this.possibleCenters)v+=Math.abs(x.getEstimatedModuleSize()-g);return v<=.05*d}selectBestPatterns(){const l=this.possibleCenters.length;if(l<3)throw new ce;const d=this.possibleCenters;let h;if(l>3){let g=0,v=0;for(const I of this.possibleCenters){const S=I.getEstimatedModuleSize();g+=S,v+=S*S}h=g/l;let x=Math.sqrt(v/l-h*h);d.sort((I,S)=>{const k=Math.abs(S.getEstimatedModuleSize()-h),L=Math.abs(I.getEstimatedModuleSize()-h);return k<L?-1:k>L?1:0});const b=Math.max(.2*h,x);for(let I=0;I<d.length&&d.length>3;I++)Math.abs(d[I].getEstimatedModuleSize()-h)>b&&(d.splice(I,1),I--)}if(d.length>3){let g=0;for(const v of d)g+=v.getEstimatedModuleSize();h=g/d.length,d.sort((v,x)=>{if(x.getCount()===v.getCount()){const b=Math.abs(x.getEstimatedModuleSize()-h),I=Math.abs(v.getEstimatedModuleSize()-h);return b<I?1:b>I?-1:0}return x.getCount()-v.getCount()}),d.splice(3)}return[d[0],d[1],d[2]]}}return D.CENTER_QUORUM=2,D.MIN_SKIP=3,D.MAX_MODULES=57,D})();class qt{constructor(u){this.image=u}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(u){this.resultPointCallback=null==u?null:u.get(En.NEED_RESULT_POINT_CALLBACK);const d=new Us(this.image,this.resultPointCallback).find(u);return this.processFinderPatternInfo(d)}processFinderPatternInfo(u){const l=u.getTopLeft(),d=u.getTopRight(),h=u.getBottomLeft(),g=this.calculateModuleSize(l,d,h);if(g<1)throw new ce("No pattern found in proccess finder.");const v=qt.computeDimension(l,d,h,g),x=Ze.getProvisionalVersionForDimension(v),b=x.getDimensionForVersion()-7;let I=null;if(x.getAlignmentPatternCenters().length>0){const W=d.getX()-l.getX()+h.getX(),q=d.getY()-l.getY()+h.getY(),Z=1-3/b,ne=Math.floor(l.getX()+Z*(W-l.getX())),ie=Math.floor(l.getY()+Z*(q-l.getY()));for(let Ae=4;Ae<=16;Ae<<=1)try{I=this.findAlignmentInRegion(g,ne,ie,Ae);break}catch(Me){if(!(Me instanceof ce))throw Me}}const S=qt.createTransform(l,d,h,I,v),k=qt.sampleGrid(this.image,S,v);let L;return L=null===I?[h,l,d]:[h,l,d,I],new qr(k,L)}static createTransform(u,l,d,h,g){const v=g-3.5;let x,b,I,S;return null!==h?(x=h.getX(),b=h.getY(),I=v-3,S=I):(x=l.getX()-u.getX()+d.getX(),b=l.getY()-u.getY()+d.getY(),I=v,S=v),Xn.quadrilateralToQuadrilateral(3.5,3.5,v,3.5,I,S,3.5,v,u.getX(),u.getY(),l.getX(),l.getY(),x,b,d.getX(),d.getY())}static sampleGrid(u,l,d){return uo.getInstance().sampleGridWithTransform(u,d,d,l)}static computeDimension(u,l,d,h){const g=Vt.round(Ue.distance(u,l)/h),v=Vt.round(Ue.distance(u,d)/h);let x=Math.floor((g+v)/2)+7;switch(3&x){case 0:x++;break;case 2:x--;break;case 3:throw new ce("Dimensions could be not found.")}return x}calculateModuleSize(u,l,d){return(this.calculateModuleSizeOneWay(u,l)+this.calculateModuleSizeOneWay(u,d))/2}calculateModuleSizeOneWay(u,l){const d=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(u.getX()),Math.floor(u.getY()),Math.floor(l.getX()),Math.floor(l.getY())),h=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(l.getX()),Math.floor(l.getY()),Math.floor(u.getX()),Math.floor(u.getY()));return isNaN(d)?h/7:isNaN(h)?d/7:(d+h)/14}sizeOfBlackWhiteBlackRunBothWays(u,l,d,h){let g=this.sizeOfBlackWhiteBlackRun(u,l,d,h),v=1,x=u-(d-u);x<0?(v=u/(u-x),x=0):x>=this.image.getWidth()&&(v=(this.image.getWidth()-1-u)/(x-u),x=this.image.getWidth()-1);let b=Math.floor(l-(h-l)*v);return v=1,b<0?(v=l/(l-b),b=0):b>=this.image.getHeight()&&(v=(this.image.getHeight()-1-l)/(b-l),b=this.image.getHeight()-1),x=Math.floor(u+(x-u)*v),g+=this.sizeOfBlackWhiteBlackRun(u,l,x,b),g-1}sizeOfBlackWhiteBlackRun(u,l,d,h){const g=Math.abs(h-l)>Math.abs(d-u);if(g){let W=u;u=l,l=W,W=d,d=h,h=W}const v=Math.abs(d-u),x=Math.abs(h-l);let b=-v/2;const I=u<d?1:-1,S=l<h?1:-1;let k=0;const L=d+I;for(let W=u,q=l;W!==L;W+=I){if(1===k===this.image.get(g?q:W,g?W:q)){if(2===k)return Vt.distance(W,q,u,l);k++}if(b+=x,b>0){if(q===h)break;q+=S,b-=v}}return 2===k?Vt.distance(d+I,h,u,l):NaN}findAlignmentInRegion(u,l,d,h){const g=Math.floor(h*u),v=Math.max(0,l-g),x=Math.min(this.image.getWidth()-1,l+g);if(x-v<3*u)throw new ce("Alignment top exceeds estimated module size.");const b=Math.max(0,d-g),I=Math.min(this.image.getHeight()-1,d+g);if(I-b<3*u)throw new ce("Alignment bottom exceeds estimated module size.");return new kt(this.image,v,b,x-v,I-b,u,this.resultPointCallback).find()}}class mi{constructor(){this.decoder=new Jl}getDecoder(){return this.decoder}decode(u,l){let d,h;if(null!=l&&void 0!==l.get(En.PURE_BARCODE)){const b=mi.extractPureBits(u.getBlackMatrix());d=this.decoder.decodeBitMatrix(b,l),h=mi.NO_POINTS}else{const b=new qt(u.getBlackMatrix()).detect(l);d=this.decoder.decodeBitMatrix(b.getBits(),l),h=b.getPoints()}d.getOther()instanceof xc&&d.getOther().applyMirroredCorrection(h);const g=new fr(d.getText(),d.getRawBytes(),void 0,h,it.QR_CODE,void 0),v=d.getByteSegments();null!==v&&g.putMetadata(Yn.BYTE_SEGMENTS,v);const x=d.getECLevel();return null!==x&&g.putMetadata(Yn.ERROR_CORRECTION_LEVEL,x),d.hasStructuredAppend()&&(g.putMetadata(Yn.STRUCTURED_APPEND_SEQUENCE,d.getStructuredAppendSequenceNumber()),g.putMetadata(Yn.STRUCTURED_APPEND_PARITY,d.getStructuredAppendParity())),g}reset(){}static extractPureBits(u){const l=u.getTopLeftOnBit(),d=u.getBottomRightOnBit();if(null===l||null===d)throw new ce;const h=this.moduleSize(l,u);let g=l[1],v=d[1],x=l[0],b=d[0];if(x>=b||g>=v)throw new ce;if(v-g!=b-x&&(b=x+(v-g),b>=u.getWidth()))throw new ce;const I=Math.round((b-x+1)/h),S=Math.round((v-g+1)/h);if(I<=0||S<=0)throw new ce;if(S!==I)throw new ce;const k=Math.floor(h/2);g+=k,x+=k;const L=x+Math.floor((I-1)*h)-b;if(L>0){if(L>k)throw new ce;x-=L}const W=g+Math.floor((S-1)*h)-v;if(W>0){if(W>k)throw new ce;g-=W}const q=new Gn(I,S);for(let Z=0;Z<S;Z++){const ne=g+Math.floor(Z*h);for(let ie=0;ie<I;ie++)u.get(x+Math.floor(ie*h),ne)&&q.set(ie,Z)}return q}static moduleSize(u,l){const d=l.getHeight(),h=l.getWidth();let g=u[0],v=u[1],x=!0,b=0;for(;g<h&&v<d;){if(x!==l.get(g,v)){if(5==++b)break;x=!x}g++,v++}if(g===h||v===d)throw new ce;return(g-u[0])/7}}mi.NO_POINTS=new Array;class C{PDF417Common(){}static getBitCountSum(u){return Vt.sum(u)}static toIntArray(u){if(null==u||!u.length)return C.EMPTY_INT_ARRAY;const l=new Int32Array(u.length);let d=0;for(const h of u)l[d++]=h;return l}static getCodeword(u){const l=Vn.binarySearch(C.SYMBOL_TABLE,262143&u);return l<0?-1:(C.CODEWORD_TABLE[l]-1)%C.NUMBER_OF_CODEWORDS}}C.NUMBER_OF_CODEWORDS=929,C.MAX_CODEWORDS_IN_BARCODE=C.NUMBER_OF_CODEWORDS-1,C.MIN_ROWS_IN_BARCODE=3,C.MAX_ROWS_IN_BARCODE=90,C.MODULES_IN_CODEWORD=17,C.MODULES_IN_STOP_PATTERN=18,C.BARS_IN_MODULE=8,C.EMPTY_INT_ARRAY=new Int32Array([]),C.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),C.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class O{constructor(u,l){this.bits=u,this.points=l}getBits(){return this.bits}getPoints(){return this.points}}class F{static detectMultiple(u,l,d){let h=u.getBlackMatrix(),g=F.detect(d,h);return g.length||(h=h.clone(),h.rotate180(),g=F.detect(d,h)),new O(h,g)}static detect(u,l){const d=new Array;let h=0,g=0,v=!1;for(;h<l.getHeight();){const x=F.findVertices(l,h,g);if(null!=x[0]||null!=x[3]){if(v=!0,d.push(x),!u)break;null!=x[2]?(g=Math.trunc(x[2].getX()),h=Math.trunc(x[2].getY())):(g=Math.trunc(x[4].getX()),h=Math.trunc(x[4].getY()))}else{if(!v)break;v=!1,g=0;for(const b of d)null!=b[1]&&(h=Math.trunc(Math.max(h,b[1].getY()))),null!=b[3]&&(h=Math.max(h,Math.trunc(b[3].getY())));h+=F.ROW_STEP}}return d}static findVertices(u,l,d){const h=u.getHeight(),g=u.getWidth(),v=new Array(8);return F.copyToResult(v,F.findRowsWithPattern(u,h,g,l,d,F.START_PATTERN),F.INDEXES_START_PATTERN),null!=v[4]&&(d=Math.trunc(v[4].getX()),l=Math.trunc(v[4].getY())),F.copyToResult(v,F.findRowsWithPattern(u,h,g,l,d,F.STOP_PATTERN),F.INDEXES_STOP_PATTERN),v}static copyToResult(u,l,d){for(let h=0;h<d.length;h++)u[d[h]]=l[h]}static findRowsWithPattern(u,l,d,h,g,v){const x=new Array(4);let b=!1;const I=new Int32Array(v.length);for(;h<l;h+=F.ROW_STEP){let k=F.findGuardPattern(u,g,h,d,!1,v,I);if(null!=k){for(;h>0;){const L=F.findGuardPattern(u,g,--h,d,!1,v,I);if(null==L){h++;break}k=L}x[0]=new Ue(k[0],h),x[1]=new Ue(k[1],h),b=!0;break}}let S=h+1;if(b){let k=0,L=Int32Array.from([Math.trunc(x[0].getX()),Math.trunc(x[1].getX())]);for(;S<l;S++){const W=F.findGuardPattern(u,L[0],S,d,!1,v,I);if(null!=W&&Math.abs(L[0]-W[0])<F.MAX_PATTERN_DRIFT&&Math.abs(L[1]-W[1])<F.MAX_PATTERN_DRIFT)L=W,k=0;else{if(k>F.SKIPPED_ROW_COUNT_MAX)break;k++}}S-=k+1,x[2]=new Ue(L[0],S),x[3]=new Ue(L[1],S)}return S-h<F.BARCODE_MIN_HEIGHT&&Vn.fill(x,null),x}static findGuardPattern(u,l,d,h,g,v,x){Vn.fillWithin(x,0,x.length,0);let b=l,I=0;for(;u.get(b,d)&&b>0&&I++<F.MAX_PIXEL_DRIFT;)b--;let S=b,k=0,L=v.length;for(let W=g;S<h;S++)if(u.get(S,d)!==W)x[k]++;else{if(k===L-1){if(F.patternMatchVariance(x,v,F.MAX_INDIVIDUAL_VARIANCE)<F.MAX_AVG_VARIANCE)return new Int32Array([b,S]);b+=x[0]+x[1],en.arraycopy(x,2,x,0,k-1),x[k-1]=0,x[k]=0,k--}else k++;x[k]=1,W=!W}return k===L-1&&F.patternMatchVariance(x,v,F.MAX_INDIVIDUAL_VARIANCE)<F.MAX_AVG_VARIANCE?new Int32Array([b,S-1]):null}static patternMatchVariance(u,l,d){let h=u.length,g=0,v=0;for(let I=0;I<h;I++)g+=u[I],v+=l[I];if(g<v)return 1/0;let x=g/v;d*=x;let b=0;for(let I=0;I<h;I++){let S=u[I],k=l[I]*x,L=S>k?S-k:k-S;if(L>d)return 1/0;b+=L}return b/g}}F.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),F.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),F.MAX_AVG_VARIANCE=.42,F.MAX_INDIVIDUAL_VARIANCE=.8,F.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),F.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),F.MAX_PIXEL_DRIFT=3,F.MAX_PATTERN_DRIFT=5,F.SKIPPED_ROW_COUNT_MAX=25,F.ROW_STEP=5,F.BARCODE_MIN_HEIGHT=10;class V{constructor(u,l){if(0===l.length)throw new Ye;this.field=u;let d=l.length;if(d>1&&0===l[0]){let h=1;for(;h<d&&0===l[h];)h++;h===d?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(d-h),en.arraycopy(l,h,this.coefficients,0,this.coefficients.length))}else this.coefficients=l}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return 0===this.coefficients[0]}getCoefficient(u){return this.coefficients[this.coefficients.length-1-u]}evaluateAt(u){if(0===u)return this.getCoefficient(0);if(1===u){let h=0;for(let g of this.coefficients)h=this.field.add(h,g);return h}let l=this.coefficients[0],d=this.coefficients.length;for(let h=1;h<d;h++)l=this.field.add(this.field.multiply(u,l),this.coefficients[h]);return l}add(u){if(!this.field.equals(u.field))throw new Ye("ModulusPolys do not have same ModulusGF field");if(this.isZero())return u;if(u.isZero())return this;let l=this.coefficients,d=u.coefficients;if(l.length>d.length){let v=l;l=d,d=v}let h=new Int32Array(d.length),g=d.length-l.length;en.arraycopy(d,0,h,0,g);for(let v=g;v<d.length;v++)h[v]=this.field.add(l[v-g],d[v]);return new V(this.field,h)}subtract(u){if(!this.field.equals(u.field))throw new Ye("ModulusPolys do not have same ModulusGF field");return u.isZero()?this:this.add(u.negative())}multiply(u){return u instanceof V?this.multiplyOther(u):this.multiplyScalar(u)}multiplyOther(u){if(!this.field.equals(u.field))throw new Ye("ModulusPolys do not have same ModulusGF field");if(this.isZero()||u.isZero())return new V(this.field,new Int32Array([0]));let l=this.coefficients,d=l.length,h=u.coefficients,g=h.length,v=new Int32Array(d+g-1);for(let x=0;x<d;x++){let b=l[x];for(let I=0;I<g;I++)v[x+I]=this.field.add(v[x+I],this.field.multiply(b,h[I]))}return new V(this.field,v)}negative(){let u=this.coefficients.length,l=new Int32Array(u);for(let d=0;d<u;d++)l[d]=this.field.subtract(0,this.coefficients[d]);return new V(this.field,l)}multiplyScalar(u){if(0===u)return new V(this.field,new Int32Array([0]));if(1===u)return this;let l=this.coefficients.length,d=new Int32Array(l);for(let h=0;h<l;h++)d[h]=this.field.multiply(this.coefficients[h],u);return new V(this.field,d)}multiplyByMonomial(u,l){if(u<0)throw new Ye;if(0===l)return new V(this.field,new Int32Array([0]));let d=this.coefficients.length,h=new Int32Array(d+u);for(let g=0;g<d;g++)h[g]=this.field.multiply(this.coefficients[g],l);return new V(this.field,h)}toString(){let u=new rn;for(let l=this.getDegree();l>=0;l--){let d=this.getCoefficient(l);0!==d&&(d<0?(u.append(" - "),d=-d):u.length()>0&&u.append(" + "),(0===l||1!==d)&&u.append(d),0!==l&&(1===l?u.append("x"):(u.append("x^"),u.append(l))))}return u.toString()}}class se extends class{add(u,l){return(u+l)%this.modulus}subtract(u,l){return(this.modulus+u-l)%this.modulus}exp(u){return this.expTable[u]}log(u){if(0===u)throw new Ye;return this.logTable[u]}inverse(u){if(0===u)throw new va;return this.expTable[this.modulus-this.logTable[u]-1]}multiply(u,l){return 0===u||0===l?0:this.expTable[(this.logTable[u]+this.logTable[l])%(this.modulus-1)]}getSize(){return this.modulus}equals(u){return u===this}}{constructor(u,l){super(),this.modulus=u,this.expTable=new Int32Array(u),this.logTable=new Int32Array(u);let d=1;for(let h=0;h<u;h++)this.expTable[h]=d,d=d*l%u;for(let h=0;h<u-1;h++)this.logTable[this.expTable[h]]=h;this.zero=new V(this,new Int32Array([0])),this.one=new V(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(u,l){if(u<0)throw new Ye;if(0===l)return this.zero;let d=new Int32Array(u+1);return d[0]=l,new V(this,d)}}se.PDF417_GF=new se(C.NUMBER_OF_CODEWORDS,3);class te{constructor(){this.field=se.PDF417_GF}decode(u,l,d){let h=new V(this.field,u),g=new Int32Array(l),v=!1;for(let q=l;q>0;q--){let Z=h.evaluateAt(this.field.exp(q));g[l-q]=Z,0!==Z&&(v=!0)}if(!v)return 0;let x=this.field.getOne();if(null!=d)for(const q of d){let Z=this.field.exp(u.length-1-q),ne=new V(this.field,new Int32Array([this.field.subtract(0,Z),1]));x=x.multiply(ne)}let b=new V(this.field,g),I=this.runEuclideanAlgorithm(this.field.buildMonomial(l,1),b,l),S=I[0],k=I[1],L=this.findErrorLocations(S),W=this.findErrorMagnitudes(k,S,L);for(let q=0;q<L.length;q++){let Z=u.length-1-this.field.log(L[q]);if(Z<0)throw Dt.getChecksumInstance();u[Z]=this.field.subtract(u[Z],W[q])}return L.length}runEuclideanAlgorithm(u,l,d){if(u.getDegree()<l.getDegree()){let L=u;u=l,l=L}let h=u,g=l,v=this.field.getZero(),x=this.field.getOne();for(;g.getDegree()>=Math.round(d/2);){let L=h,W=v;if(h=g,v=x,h.isZero())throw Dt.getChecksumInstance();g=L;let q=this.field.getZero(),Z=h.getCoefficient(h.getDegree()),ne=this.field.inverse(Z);for(;g.getDegree()>=h.getDegree()&&!g.isZero();){let ie=g.getDegree()-h.getDegree(),Ae=this.field.multiply(g.getCoefficient(g.getDegree()),ne);q=q.add(this.field.buildMonomial(ie,Ae)),g=g.subtract(h.multiplyByMonomial(ie,Ae))}x=q.multiply(v).subtract(W).negative()}let b=x.getCoefficient(0);if(0===b)throw Dt.getChecksumInstance();let I=this.field.inverse(b);return[x.multiply(I),g.multiply(I)]}findErrorLocations(u){let l=u.getDegree(),d=new Int32Array(l),h=0;for(let g=1;g<this.field.getSize()&&h<l;g++)0===u.evaluateAt(g)&&(d[h]=this.field.inverse(g),h++);if(h!==l)throw Dt.getChecksumInstance();return d}findErrorMagnitudes(u,l,d){let h=l.getDegree(),g=new Int32Array(h);for(let I=1;I<=h;I++)g[h-I]=this.field.multiply(I,l.getCoefficient(I));let v=new V(this.field,g),x=d.length,b=new Int32Array(x);for(let I=0;I<x;I++){let S=this.field.inverse(d[I]),k=this.field.subtract(0,u.evaluateAt(S)),L=this.field.inverse(v.evaluateAt(S));b[I]=this.field.multiply(k,L)}return b}}class ye{constructor(u,l,d,h,g){u instanceof ye?this.constructor_2(u):this.constructor_1(u,l,d,h,g)}constructor_1(u,l,d,h,g){const v=null==l||null==d,x=null==h||null==g;if(v&&x)throw new ce;v?(l=new Ue(0,h.getY()),d=new Ue(0,g.getY())):x&&(h=new Ue(u.getWidth()-1,l.getY()),g=new Ue(u.getWidth()-1,d.getY())),this.image=u,this.topLeft=l,this.bottomLeft=d,this.topRight=h,this.bottomRight=g,this.minX=Math.trunc(Math.min(l.getX(),d.getX())),this.maxX=Math.trunc(Math.max(h.getX(),g.getX())),this.minY=Math.trunc(Math.min(l.getY(),h.getY())),this.maxY=Math.trunc(Math.max(d.getY(),g.getY()))}constructor_2(u){this.image=u.image,this.topLeft=u.getTopLeft(),this.bottomLeft=u.getBottomLeft(),this.topRight=u.getTopRight(),this.bottomRight=u.getBottomRight(),this.minX=u.getMinX(),this.maxX=u.getMaxX(),this.minY=u.getMinY(),this.maxY=u.getMaxY()}static merge(u,l){return null==u?l:null==l?u:new ye(u.image,u.topLeft,u.bottomLeft,l.topRight,l.bottomRight)}addMissingRows(u,l,d){let h=this.topLeft,g=this.bottomLeft,v=this.topRight,x=this.bottomRight;if(u>0){let b=d?this.topLeft:this.topRight,I=Math.trunc(b.getY()-u);I<0&&(I=0);let S=new Ue(b.getX(),I);d?h=S:v=S}if(l>0){let b=d?this.bottomLeft:this.bottomRight,I=Math.trunc(b.getY()+l);I>=this.image.getHeight()&&(I=this.image.getHeight()-1);let S=new Ue(b.getX(),I);d?g=S:x=S}return new ye(this.image,h,g,v,x)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class ge{constructor(u,l,d,h){this.columnCount=u,this.errorCorrectionLevel=h,this.rowCountUpperPart=l,this.rowCountLowerPart=d,this.rowCount=l+d}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class Ne{constructor(){this.buffer=""}static form(u,l){let d=-1;return u.replace(/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g,function(v,x,b,I,S,k){if("%%"===v)return"%";if(void 0===l[++d])return;v=I?parseInt(I.substr(1)):void 0;let W,L=S?parseInt(S.substr(1)):void 0;switch(k){case"s":W=l[d];break;case"c":W=l[d][0];break;case"f":W=parseFloat(l[d]).toFixed(v);break;case"p":W=parseFloat(l[d]).toPrecision(v);break;case"e":W=parseFloat(l[d]).toExponential(v);break;case"x":W=parseInt(l[d]).toString(L||16);break;case"d":W=parseFloat(parseInt(l[d],L||10).toPrecision(v)).toFixed(0)}W="object"==typeof W?JSON.stringify(W):(+W).toString(L);let q=parseInt(b),Z=b&&b[0]+""=="0"?"0":" ";for(;W.length<q;)W=void 0!==x?W+Z:Z+W;return W})}format(u,...l){this.buffer+=Ne.form(u,l)}toString(){return this.buffer}}let st=(()=>{class D{constructor(l){this.boundingBox=new ye(l),this.codewords=new Array(l.getMaxY()-l.getMinY()+1)}getCodewordNearby(l){let d=this.getCodeword(l);if(null!=d)return d;for(let h=1;h<D.MAX_NEARBY_DISTANCE;h++){let g=this.imageRowToCodewordIndex(l)-h;if(g>=0&&(d=this.codewords[g],null!=d)||(g=this.imageRowToCodewordIndex(l)+h,g<this.codewords.length&&(d=this.codewords[g],null!=d)))return d}return null}imageRowToCodewordIndex(l){return l-this.boundingBox.getMinY()}setCodeword(l,d){this.codewords[this.imageRowToCodewordIndex(l)]=d}getCodeword(l){return this.codewords[this.imageRowToCodewordIndex(l)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){const l=new Ne;let d=0;for(const h of this.codewords)null!=h?l.format("%3d: %3d|%3d%n",d++,h.getRowNumber(),h.getValue()):l.format("%3d:    |   %n",d++);return l.toString()}}return D.MAX_NEARBY_DISTANCE=5,D})();class vt{constructor(){this.values=new Map}setValue(u){u=Math.trunc(u);let l=this.values.get(u);null==l&&(l=0),l++,this.values.set(u,l)}getValue(){let u=-1,l=new Array;for(const[d,h]of this.values.entries()){const g={getKey:()=>d,getValue:()=>h};g.getValue()>u?(u=g.getValue(),l=[],l.push(g.getKey())):g.getValue()===u&&l.push(g.getKey())}return C.toIntArray(l)}getConfidence(u){return this.values.get(u)}}class ct extends st{constructor(u,l){super(u),this._isLeft=l}setRowNumbers(){for(let u of this.getCodewords())null!=u&&u.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(u){let l=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(l,u);let d=this.getBoundingBox(),h=this._isLeft?d.getTopLeft():d.getTopRight(),g=this._isLeft?d.getBottomLeft():d.getBottomRight(),v=this.imageRowToCodewordIndex(Math.trunc(h.getY())),x=this.imageRowToCodewordIndex(Math.trunc(g.getY())),b=-1,I=1,S=0;for(let k=v;k<x;k++){if(null==l[k])continue;let L=l[k],W=L.getRowNumber()-b;if(0===W)S++;else if(1===W)I=Math.max(I,S),S=1,b=L.getRowNumber();else if(W<0||L.getRowNumber()>=u.getRowCount()||W>k)l[k]=null;else{let q;q=I>2?(I-2)*W:W;let Z=q>=k;for(let ne=1;ne<=q&&!Z;ne++)Z=null!=l[k-ne];Z?l[k]=null:(b=L.getRowNumber(),S=1)}}}getRowHeights(){let u=this.getBarcodeMetadata();if(null==u)return null;this.adjustIncompleteIndicatorColumnRowNumbers(u);let l=new Int32Array(u.getRowCount());for(let d of this.getCodewords())if(null!=d){let h=d.getRowNumber();if(h>=l.length)continue;l[h]++}return l}adjustIncompleteIndicatorColumnRowNumbers(u){let l=this.getBoundingBox(),d=this._isLeft?l.getTopLeft():l.getTopRight(),h=this._isLeft?l.getBottomLeft():l.getBottomRight(),g=this.imageRowToCodewordIndex(Math.trunc(d.getY())),v=this.imageRowToCodewordIndex(Math.trunc(h.getY())),x=this.getCodewords(),b=-1;for(let I=g;I<v;I++){if(null==x[I])continue;let S=x[I];S.setRowNumberAsRowIndicatorColumn();let k=S.getRowNumber()-b;0===k||(1===k?b=S.getRowNumber():S.getRowNumber()>=u.getRowCount()?x[I]=null:b=S.getRowNumber())}}getBarcodeMetadata(){let u=this.getCodewords(),l=new vt,d=new vt,h=new vt,g=new vt;for(let x of u){if(null==x)continue;x.setRowNumberAsRowIndicatorColumn();let b=x.getValue()%30,I=x.getRowNumber();switch(this._isLeft||(I+=2),I%3){case 0:d.setValue(3*b+1);break;case 1:g.setValue(b/3),h.setValue(b%3);break;case 2:l.setValue(b+1)}}if(0===l.getValue().length||0===d.getValue().length||0===h.getValue().length||0===g.getValue().length||l.getValue()[0]<1||d.getValue()[0]+h.getValue()[0]<C.MIN_ROWS_IN_BARCODE||d.getValue()[0]+h.getValue()[0]>C.MAX_ROWS_IN_BARCODE)return null;let v=new ge(l.getValue()[0],d.getValue()[0],h.getValue()[0],g.getValue()[0]);return this.removeIncorrectCodewords(u,v),v}removeIncorrectCodewords(u,l){for(let d=0;d<u.length;d++){let h=u[d];if(null==u[d])continue;let g=h.getValue()%30,v=h.getRowNumber();if(v>l.getRowCount())u[d]=null;else switch(this._isLeft||(v+=2),v%3){case 0:3*g+1!==l.getRowCountUpperPart()&&(u[d]=null);break;case 1:(Math.trunc(g/3)!==l.getErrorCorrectionLevel()||g%3!==l.getRowCountLowerPart())&&(u[d]=null);break;case 2:g+1!==l.getColumnCount()&&(u[d]=null)}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+"\n"+super.toString()}}class ze{constructor(u,l){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=u,this.barcodeColumnCount=u.getColumnCount(),this.boundingBox=l,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let l,u=C.MAX_CODEWORDS_IN_BARCODE;do{l=u,u=this.adjustRowNumbersAndGetCount()}while(u>0&&u<l);return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(u){null!=u&&u.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let u=this.adjustRowNumbersByRow();if(0===u)return 0;for(let l=1;l<this.barcodeColumnCount+1;l++){let d=this.detectionResultColumns[l].getCodewords();for(let h=0;h<d.length;h++)null!=d[h]&&(d[h].hasValidRowNumber()||this.adjustRowNumbers(l,h,d))}return u}adjustRowNumbersByRow(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(null==this.detectionResultColumns[0]||null==this.detectionResultColumns[this.barcodeColumnCount+1])return;let u=this.detectionResultColumns[0].getCodewords(),l=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let d=0;d<u.length;d++)if(null!=u[d]&&null!=l[d]&&u[d].getRowNumber()===l[d].getRowNumber())for(let h=1;h<=this.barcodeColumnCount;h++){let g=this.detectionResultColumns[h].getCodewords()[d];null!=g&&(g.setRowNumber(u[d].getRowNumber()),g.hasValidRowNumber()||(this.detectionResultColumns[h].getCodewords()[d]=null))}}adjustRowNumbersFromRRI(){if(null==this.detectionResultColumns[this.barcodeColumnCount+1])return 0;let u=0,l=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let d=0;d<l.length;d++){if(null==l[d])continue;let h=l[d].getRowNumber(),g=0;for(let v=this.barcodeColumnCount+1;v>0&&g<this.ADJUST_ROW_NUMBER_SKIP;v--){let x=this.detectionResultColumns[v].getCodewords()[d];null!=x&&(g=ze.adjustRowNumberIfValid(h,g,x),x.hasValidRowNumber()||u++)}}return u}adjustRowNumbersFromLRI(){if(null==this.detectionResultColumns[0])return 0;let u=0,l=this.detectionResultColumns[0].getCodewords();for(let d=0;d<l.length;d++){if(null==l[d])continue;let h=l[d].getRowNumber(),g=0;for(let v=1;v<this.barcodeColumnCount+1&&g<this.ADJUST_ROW_NUMBER_SKIP;v++){let x=this.detectionResultColumns[v].getCodewords()[d];null!=x&&(g=ze.adjustRowNumberIfValid(h,g,x),x.hasValidRowNumber()||u++)}}return u}static adjustRowNumberIfValid(u,l,d){return null==d||d.hasValidRowNumber()||(d.isValidRowNumber(u)?(d.setRowNumber(u),l=0):++l),l}adjustRowNumbers(u,l,d){let h=d[l],g=this.detectionResultColumns[u-1].getCodewords(),v=g;null!=this.detectionResultColumns[u+1]&&(v=this.detectionResultColumns[u+1].getCodewords());let x=new Array(14);x[2]=g[l],x[3]=v[l],l>0&&(x[0]=d[l-1],x[4]=g[l-1],x[5]=v[l-1]),l>1&&(x[8]=d[l-2],x[10]=g[l-2],x[11]=v[l-2]),l<d.length-1&&(x[1]=d[l+1],x[6]=g[l+1],x[7]=v[l+1]),l<d.length-2&&(x[9]=d[l+2],x[12]=g[l+2],x[13]=v[l+2]);for(let b of x)if(ze.adjustRowNumber(h,b))return}static adjustRowNumber(u,l){return!(null==l||!l.hasValidRowNumber()||l.getBucket()!==u.getBucket()||(u.setRowNumber(l.getRowNumber()),0))}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(u){this.boundingBox=u}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(u,l){this.detectionResultColumns[u]=l}getDetectionResultColumn(u){return this.detectionResultColumns[u]}toString(){let u=this.detectionResultColumns[0];null==u&&(u=this.detectionResultColumns[this.barcodeColumnCount+1]);let l=new Ne;for(let d=0;d<u.getCodewords().length;d++){l.format("CW %3d:",d);for(let h=0;h<this.barcodeColumnCount+2;h++){if(null==this.detectionResultColumns[h]){l.format("    |   ");continue}let g=this.detectionResultColumns[h].getCodewords()[d];null!=g?l.format(" %3d|%3d",g.getRowNumber(),g.getValue()):l.format("    |   ")}l.format("%n")}return l.toString()}}let yt=(()=>{class D{constructor(l,d,h,g){this.rowNumber=D.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(l),this.endX=Math.trunc(d),this.bucket=Math.trunc(h),this.value=Math.trunc(g)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(l){return l!==D.BARCODE_ROW_UNKNOWN&&this.bucket===l%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(3*Math.trunc(this.value/30)+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(l){this.rowNumber=l}toString(){return this.rowNumber+"|"+this.value}}return D.BARCODE_ROW_UNKNOWN=-1,D})();class Je{static initialize(){for(let u=0;u<C.SYMBOL_TABLE.length;u++){let l=C.SYMBOL_TABLE[u],d=1&l;for(let h=0;h<C.BARS_IN_MODULE;h++){let g=0;for(;(1&l)===d;)g+=1,l>>=1;d=1&l,Je.RATIOS_TABLE[u]||(Je.RATIOS_TABLE[u]=new Array(C.BARS_IN_MODULE)),Je.RATIOS_TABLE[u][C.BARS_IN_MODULE-h-1]=Math.fround(g/C.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(u){let l=Je.getDecodedCodewordValue(Je.sampleBitCounts(u));return-1!==l?l:Je.getClosestDecodedValue(u)}static sampleBitCounts(u){let l=Vt.sum(u),d=new Int32Array(C.BARS_IN_MODULE),h=0,g=0;for(let v=0;v<C.MODULES_IN_CODEWORD;v++)g+u[h]<=l/(2*C.MODULES_IN_CODEWORD)+v*l/C.MODULES_IN_CODEWORD&&(g+=u[h],h++),d[h]++;return d}static getDecodedCodewordValue(u){let l=Je.getBitValue(u);return-1===C.getCodeword(l)?-1:l}static getBitValue(u){let l=0;for(let d=0;d<u.length;d++)for(let h=0;h<u[d];h++)l=l<<1|(d%2==0?1:0);return Math.trunc(l)}static getClosestDecodedValue(u){let l=Vt.sum(u),d=new Array(C.BARS_IN_MODULE);if(l>1)for(let v=0;v<d.length;v++)d[v]=Math.fround(u[v]/l);let h=qa.MAX_VALUE,g=-1;this.bSymbolTableReady||Je.initialize();for(let v=0;v<Je.RATIOS_TABLE.length;v++){let x=0,b=Je.RATIOS_TABLE[v];for(let I=0;I<C.BARS_IN_MODULE;I++){let S=Math.fround(b[I]-d[I]);if(x+=Math.fround(S*S),x>=h)break}x<h&&(h=x,g=C.SYMBOL_TABLE[v])}return g}}Je.bSymbolTableReady=!1,Je.RATIOS_TABLE=new Array(C.SYMBOL_TABLE.length).map(D=>new Array(C.BARS_IN_MODULE));class St{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(u){this.segmentIndex=u}getFileId(){return this.fileId}setFileId(u){this.fileId=u}getOptionalData(){return this.optionalData}setOptionalData(u){this.optionalData=u}isLastSegment(){return this.lastSegment}setLastSegment(u){this.lastSegment=u}getSegmentCount(){return this.segmentCount}setSegmentCount(u){this.segmentCount=u}getSender(){return this.sender||null}setSender(u){this.sender=u}getAddressee(){return this.addressee||null}setAddressee(u){this.addressee=u}getFileName(){return this.fileName}setFileName(u){this.fileName=u}getFileSize(){return this.fileSize}setFileSize(u){this.fileSize=u}getChecksum(){return this.checksum}setChecksum(u){this.checksum=u}getTimestamp(){return this.timestamp}setTimestamp(u){this.timestamp=u}}class Et{static parseLong(u,l){return parseInt(u,l)}}let Sn=(()=>{class D extends xr{}return D.kind="NullPointerException",D})();class _n extends xr{}class Jt extends class{writeBytes(u){this.writeBytesOffset(u,0,u.length)}writeBytesOffset(u,l,d){if(null==u)throw new Sn;if(l<0||l>u.length||d<0||l+d>u.length||l+d<0)throw new Rs;if(0!==d)for(let h=0;h<d;h++)this.write(u[l+h])}flush(){}close(){}}{constructor(u=32){if(super(),this.count=0,u<0)throw new Ye("Negative initial size: "+u);this.buf=new Uint8Array(u)}ensureCapacity(u){u-this.buf.length>0&&this.grow(u)}grow(u){let d=this.buf.length<<1;if(d-u<0&&(d=u),d<0){if(u<0)throw new _n;d=Ct.MAX_VALUE}this.buf=Vn.copyOfUint8Array(this.buf,d)}write(u){this.ensureCapacity(this.count+1),this.buf[this.count]=u,this.count+=1}writeBytesOffset(u,l,d){if(l<0||l>u.length||d<0||l+d-u.length>0)throw new Rs;this.ensureCapacity(this.count+d),en.arraycopy(u,l,this.buf,this.count,d),this.count+=d}writeTo(u){u.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return Vn.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(u){return u?"string"==typeof u?this.toString_string(u):this.toString_number(u):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(u){return new String(this.buf).toString()}toString_number(u){return new String(this.buf).toString()}close(){}}var Qe=(()=>{return(D=Qe||(Qe={}))[D.ALPHA=0]="ALPHA",D[D.LOWER=1]="LOWER",D[D.MIXED=2]="MIXED",D[D.PUNCT=3]="PUNCT",D[D.ALPHA_SHIFT=4]="ALPHA_SHIFT",D[D.PUNCT_SHIFT=5]="PUNCT_SHIFT",Qe;var D})();function Se(){if("undefined"!=typeof window)return window.BigInt||null;if("undefined"!=typeof global)return global.BigInt||null;if("undefined"!=typeof self)return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}let Nt;function gn(D){if(void 0===Nt&&(Nt=Se()),null===Nt)throw new Error("BigInt is not supported!");return Nt(D)}class oe{static decode(u,l){let d=new rn(""),h=Ee.ISO8859_1;d.enableDecoding(h);let g=1,v=u[g++],x=new St;for(;g<u[0];){switch(v){case oe.TEXT_COMPACTION_MODE_LATCH:g=oe.textCompaction(u,g,d);break;case oe.BYTE_COMPACTION_MODE_LATCH:case oe.BYTE_COMPACTION_MODE_LATCH_6:g=oe.byteCompaction(v,u,h,g,d);break;case oe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:d.append(u[g++]);break;case oe.NUMERIC_COMPACTION_MODE_LATCH:g=oe.numericCompaction(u,g,d);break;case oe.ECI_CHARSET:Ee.getCharacterSetECIByValue(u[g++]);break;case oe.ECI_GENERAL_PURPOSE:g+=2;break;case oe.ECI_USER_DEFINED:g++;break;case oe.BEGIN_MACRO_PDF417_CONTROL_BLOCK:g=oe.decodeMacroBlock(u,g,x);break;case oe.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case oe.MACRO_PDF417_TERMINATOR:throw new Re;default:g--,g=oe.textCompaction(u,g,d)}if(!(g<u.length))throw Re.getFormatInstance();v=u[g++]}if(0===d.length())throw Re.getFormatInstance();let b=new Xo(null,d.toString(),null,l);return b.setOther(x),b}static decodeMacroBlock(u,l,d){if(l+oe.NUMBER_OF_SEQUENCE_CODEWORDS>u[0])throw Re.getFormatInstance();let h=new Int32Array(oe.NUMBER_OF_SEQUENCE_CODEWORDS);for(let x=0;x<oe.NUMBER_OF_SEQUENCE_CODEWORDS;x++,l++)h[x]=u[l];d.setSegmentIndex(Ct.parseInt(oe.decodeBase900toBase10(h,oe.NUMBER_OF_SEQUENCE_CODEWORDS)));let g=new rn;l=oe.textCompaction(u,l,g),d.setFileId(g.toString());let v=-1;for(u[l]===oe.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(v=l+1);l<u[0];)switch(u[l]){case oe.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(u[++l]){case oe.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let x=new rn;l=oe.textCompaction(u,l+1,x),d.setFileName(x.toString());break;case oe.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let b=new rn;l=oe.textCompaction(u,l+1,b),d.setSender(b.toString());break;case oe.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let I=new rn;l=oe.textCompaction(u,l+1,I),d.setAddressee(I.toString());break;case oe.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let S=new rn;l=oe.numericCompaction(u,l+1,S),d.setSegmentCount(Ct.parseInt(S.toString()));break;case oe.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let k=new rn;l=oe.numericCompaction(u,l+1,k),d.setTimestamp(Et.parseLong(k.toString()));break;case oe.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let L=new rn;l=oe.numericCompaction(u,l+1,L),d.setChecksum(Ct.parseInt(L.toString()));break;case oe.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let W=new rn;l=oe.numericCompaction(u,l+1,W),d.setFileSize(Et.parseLong(W.toString()));break;default:throw Re.getFormatInstance()}break;case oe.MACRO_PDF417_TERMINATOR:l++,d.setLastSegment(!0);break;default:throw Re.getFormatInstance()}if(-1!==v){let x=l-v;d.isLastSegment()&&x--,d.setOptionalData(Vn.copyOfRange(u,v,v+x))}return l}static textCompaction(u,l,d){let h=new Int32Array(2*(u[0]-l)),g=new Int32Array(2*(u[0]-l)),v=0,x=!1;for(;l<u[0]&&!x;){let b=u[l++];if(b<oe.TEXT_COMPACTION_MODE_LATCH)h[v]=b/30,h[v+1]=b%30,v+=2;else switch(b){case oe.TEXT_COMPACTION_MODE_LATCH:h[v++]=oe.TEXT_COMPACTION_MODE_LATCH;break;case oe.BYTE_COMPACTION_MODE_LATCH:case oe.BYTE_COMPACTION_MODE_LATCH_6:case oe.NUMERIC_COMPACTION_MODE_LATCH:case oe.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case oe.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case oe.MACRO_PDF417_TERMINATOR:l--,x=!0;break;case oe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h[v]=oe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,b=u[l++],g[v]=b,v++}}return oe.decodeTextCompaction(h,g,v,d),l}static decodeTextCompaction(u,l,d,h){let g=Qe.ALPHA,v=Qe.ALPHA,x=0;for(;x<d;){let b=u[x],I="";switch(g){case Qe.ALPHA:if(b<26)I=String.fromCharCode(65+b);else switch(b){case 26:I=" ";break;case oe.LL:g=Qe.LOWER;break;case oe.ML:g=Qe.MIXED;break;case oe.PS:v=g,g=Qe.PUNCT_SHIFT;break;case oe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h.append(l[x]);break;case oe.TEXT_COMPACTION_MODE_LATCH:g=Qe.ALPHA}break;case Qe.LOWER:if(b<26)I=String.fromCharCode(97+b);else switch(b){case 26:I=" ";break;case oe.AS:v=g,g=Qe.ALPHA_SHIFT;break;case oe.ML:g=Qe.MIXED;break;case oe.PS:v=g,g=Qe.PUNCT_SHIFT;break;case oe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h.append(l[x]);break;case oe.TEXT_COMPACTION_MODE_LATCH:g=Qe.ALPHA}break;case Qe.MIXED:if(b<oe.PL)I=oe.MIXED_CHARS[b];else switch(b){case oe.PL:g=Qe.PUNCT;break;case 26:I=" ";break;case oe.LL:g=Qe.LOWER;break;case oe.AL:g=Qe.ALPHA;break;case oe.PS:v=g,g=Qe.PUNCT_SHIFT;break;case oe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h.append(l[x]);break;case oe.TEXT_COMPACTION_MODE_LATCH:g=Qe.ALPHA}break;case Qe.PUNCT:if(b<oe.PAL)I=oe.PUNCT_CHARS[b];else switch(b){case oe.PAL:g=Qe.ALPHA;break;case oe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h.append(l[x]);break;case oe.TEXT_COMPACTION_MODE_LATCH:g=Qe.ALPHA}break;case Qe.ALPHA_SHIFT:if(g=v,b<26)I=String.fromCharCode(65+b);else switch(b){case 26:I=" ";break;case oe.TEXT_COMPACTION_MODE_LATCH:g=Qe.ALPHA}break;case Qe.PUNCT_SHIFT:if(g=v,b<oe.PAL)I=oe.PUNCT_CHARS[b];else switch(b){case oe.PAL:g=Qe.ALPHA;break;case oe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h.append(l[x]);break;case oe.TEXT_COMPACTION_MODE_LATCH:g=Qe.ALPHA}}""!==I&&h.append(I),x++}}static byteCompaction(u,l,d,h,g){let v=new Jt,x=0,b=0,I=!1;switch(u){case oe.BYTE_COMPACTION_MODE_LATCH:let S=new Int32Array(6),k=l[h++];for(;h<l[0]&&!I;)switch(S[x++]=k,b=900*b+k,k=l[h++],k){case oe.TEXT_COMPACTION_MODE_LATCH:case oe.BYTE_COMPACTION_MODE_LATCH:case oe.NUMERIC_COMPACTION_MODE_LATCH:case oe.BYTE_COMPACTION_MODE_LATCH_6:case oe.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case oe.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case oe.MACRO_PDF417_TERMINATOR:h--,I=!0;break;default:if(x%5==0&&x>0){for(let L=0;L<6;++L)v.write(Number(gn(b)>>gn(8*(5-L))));b=0,x=0}}h===l[0]&&k<oe.TEXT_COMPACTION_MODE_LATCH&&(S[x++]=k);for(let L=0;L<x;L++)v.write(S[L]);break;case oe.BYTE_COMPACTION_MODE_LATCH_6:for(;h<l[0]&&!I;){let L=l[h++];if(L<oe.TEXT_COMPACTION_MODE_LATCH)x++,b=900*b+L;else switch(L){case oe.TEXT_COMPACTION_MODE_LATCH:case oe.BYTE_COMPACTION_MODE_LATCH:case oe.NUMERIC_COMPACTION_MODE_LATCH:case oe.BYTE_COMPACTION_MODE_LATCH_6:case oe.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case oe.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case oe.MACRO_PDF417_TERMINATOR:h--,I=!0}if(x%5==0&&x>0){for(let W=0;W<6;++W)v.write(Number(gn(b)>>gn(8*(5-W))));b=0,x=0}}}return g.append(vn.decode(v.toByteArray(),d)),h}static numericCompaction(u,l,d){let h=0,g=!1,v=new Int32Array(oe.MAX_NUMERIC_CODEWORDS);for(;l<u[0]&&!g;){let x=u[l++];if(l===u[0]&&(g=!0),x<oe.TEXT_COMPACTION_MODE_LATCH)v[h]=x,h++;else switch(x){case oe.TEXT_COMPACTION_MODE_LATCH:case oe.BYTE_COMPACTION_MODE_LATCH:case oe.BYTE_COMPACTION_MODE_LATCH_6:case oe.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case oe.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case oe.MACRO_PDF417_TERMINATOR:l--,g=!0}(h%oe.MAX_NUMERIC_CODEWORDS==0||x===oe.NUMERIC_COMPACTION_MODE_LATCH||g)&&h>0&&(d.append(oe.decodeBase900toBase10(v,h)),h=0)}return l}static decodeBase900toBase10(u,l){let d=gn(0);for(let g=0;g<l;g++)d+=oe.EXP900[l-g-1]*gn(u[g]);let h=d.toString();if("1"!==h.charAt(0))throw new Re;return h.substring(1)}}oe.TEXT_COMPACTION_MODE_LATCH=900,oe.BYTE_COMPACTION_MODE_LATCH=901,oe.NUMERIC_COMPACTION_MODE_LATCH=902,oe.BYTE_COMPACTION_MODE_LATCH_6=924,oe.ECI_USER_DEFINED=925,oe.ECI_GENERAL_PURPOSE=926,oe.ECI_CHARSET=927,oe.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,oe.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,oe.MACRO_PDF417_TERMINATOR=922,oe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,oe.MAX_NUMERIC_CODEWORDS=15,oe.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,oe.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,oe.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,oe.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,oe.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,oe.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,oe.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,oe.PL=25,oe.LL=27,oe.AS=27,oe.ML=28,oe.AL=28,oe.PS=29,oe.PAL=29,oe.PUNCT_CHARS=";<>@[\\]_`~!\r\t,:\n-.$/\"|*()?{}'",oe.MIXED_CHARS="0123456789&\r\t,:#-.$/+%*=^",oe.EXP900=Se()?function(){let D=[];D[0]=gn(1);let u=gn(900);D[1]=u;for(let l=2;l<16;l++)D[l]=D[l-1]*u;return D}():[],oe.NUMBER_OF_SEQUENCE_CODEWORDS=2;class ot{constructor(){}static decode(u,l,d,h,g,v,x){let k,b=new ye(u,l,d,h,g),I=null,S=null;for(let q=!0;;q=!1){if(null!=l&&(I=ot.getRowIndicatorColumn(u,b,l,!0,v,x)),null!=h&&(S=ot.getRowIndicatorColumn(u,b,h,!1,v,x)),k=ot.merge(I,S),null==k)throw ce.getNotFoundInstance();let Z=k.getBoundingBox();if(!q||null==Z||!(Z.getMinY()<b.getMinY()||Z.getMaxY()>b.getMaxY()))break;b=Z}k.setBoundingBox(b);let L=k.getBarcodeColumnCount()+1;k.setDetectionResultColumn(0,I),k.setDetectionResultColumn(L,S);let W=null!=I;for(let q=1;q<=L;q++){let ne,Z=W?q:L-q;if(void 0!==k.getDetectionResultColumn(Z))continue;ne=0===Z||Z===L?new ct(b,0===Z):new st(b),k.setDetectionResultColumn(Z,ne);let ie=-1,Ae=ie;for(let Me=b.getMinY();Me<=b.getMaxY();Me++){if(ie=ot.getStartColumn(k,Z,Me,W),ie<0||ie>b.getMaxX()){if(-1===Ae)continue;ie=Ae}let de=ot.detectCodeword(u,b.getMinX(),b.getMaxX(),W,ie,Me,v,x);null!=de&&(ne.setCodeword(Me,de),Ae=ie,v=Math.min(v,de.getWidth()),x=Math.max(x,de.getWidth()))}}return ot.createDecoderResult(k)}static merge(u,l){if(null==u&&null==l)return null;let d=ot.getBarcodeMetadata(u,l);if(null==d)return null;let h=ye.merge(ot.adjustBoundingBox(u),ot.adjustBoundingBox(l));return new ze(d,h)}static adjustBoundingBox(u){if(null==u)return null;let l=u.getRowHeights();if(null==l)return null;let d=ot.getMax(l),h=0;for(let x of l)if(h+=d-x,x>0)break;let g=u.getCodewords();for(let x=0;h>0&&null==g[x];x++)h--;let v=0;for(let x=l.length-1;x>=0&&(v+=d-l[x],!(l[x]>0));x--);for(let x=g.length-1;v>0&&null==g[x];x--)v--;return u.getBoundingBox().addMissingRows(h,v,u.isLeft())}static getMax(u){let l=-1;for(let d of u)l=Math.max(l,d);return l}static getBarcodeMetadata(u,l){let d,h;return null==u||null==(d=u.getBarcodeMetadata())?null==l?null:l.getBarcodeMetadata():null==l||null==(h=l.getBarcodeMetadata())?d:d.getColumnCount()!==h.getColumnCount()&&d.getErrorCorrectionLevel()!==h.getErrorCorrectionLevel()&&d.getRowCount()!==h.getRowCount()?null:d}static getRowIndicatorColumn(u,l,d,h,g,v){let x=new ct(l,h);for(let b=0;b<2;b++){let I=0===b?1:-1,S=Math.trunc(Math.trunc(d.getX()));for(let k=Math.trunc(Math.trunc(d.getY()));k<=l.getMaxY()&&k>=l.getMinY();k+=I){let L=ot.detectCodeword(u,0,u.getWidth(),h,S,k,g,v);null!=L&&(x.setCodeword(k,L),S=h?L.getStartX():L.getEndX())}}return x}static adjustCodewordCount(u,l){let d=l[0][1],h=d.getValue(),g=u.getBarcodeColumnCount()*u.getBarcodeRowCount()-ot.getNumberOfECCodeWords(u.getBarcodeECLevel());if(0===h.length){if(g<1||g>C.MAX_CODEWORDS_IN_BARCODE)throw ce.getNotFoundInstance();d.setValue(g)}else h[0]!==g&&d.setValue(g)}static createDecoderResult(u){let l=ot.createBarcodeMatrix(u);ot.adjustCodewordCount(u,l);let d=new Array,h=new Int32Array(u.getBarcodeRowCount()*u.getBarcodeColumnCount()),g=[],v=new Array;for(let b=0;b<u.getBarcodeRowCount();b++)for(let I=0;I<u.getBarcodeColumnCount();I++){let S=l[b][I+1].getValue(),k=b*u.getBarcodeColumnCount()+I;0===S.length?d.push(k):1===S.length?h[k]=S[0]:(v.push(k),g.push(S))}let x=new Array(g.length);for(let b=0;b<x.length;b++)x[b]=g[b];return ot.createDecoderResultFromAmbiguousValues(u.getBarcodeECLevel(),h,C.toIntArray(d),C.toIntArray(v),x)}static createDecoderResultFromAmbiguousValues(u,l,d,h,g){let v=new Int32Array(h.length),x=100;for(;x-- >0;){for(let b=0;b<v.length;b++)l[h[b]]=g[b][v[b]];try{return ot.decodeCodewords(l,u,d)}catch(b){if(!(b instanceof Dt))throw b}if(0===v.length)throw Dt.getChecksumInstance();for(let b=0;b<v.length;b++){if(v[b]<g[b].length-1){v[b]++;break}if(v[b]=0,b===v.length-1)throw Dt.getChecksumInstance()}}throw Dt.getChecksumInstance()}static createBarcodeMatrix(u){let l=Array.from({length:u.getBarcodeRowCount()},()=>new Array(u.getBarcodeColumnCount()+2));for(let h=0;h<l.length;h++)for(let g=0;g<l[h].length;g++)l[h][g]=new vt;let d=0;for(let h of u.getDetectionResultColumns()){if(null!=h)for(let g of h.getCodewords())if(null!=g){let v=g.getRowNumber();if(v>=0){if(v>=l.length)continue;l[v][d].setValue(g.getValue())}}d++}return l}static isValidBarcodeColumn(u,l){return l>=0&&l<=u.getBarcodeColumnCount()+1}static getStartColumn(u,l,d,h){let g=h?1:-1,v=null;if(ot.isValidBarcodeColumn(u,l-g)&&(v=u.getDetectionResultColumn(l-g).getCodeword(d)),null!=v)return h?v.getEndX():v.getStartX();if(v=u.getDetectionResultColumn(l).getCodewordNearby(d),null!=v)return h?v.getStartX():v.getEndX();if(ot.isValidBarcodeColumn(u,l-g)&&(v=u.getDetectionResultColumn(l-g).getCodewordNearby(d)),null!=v)return h?v.getEndX():v.getStartX();let x=0;for(;ot.isValidBarcodeColumn(u,l-g);){l-=g;for(let b of u.getDetectionResultColumn(l).getCodewords())if(null!=b)return(h?b.getEndX():b.getStartX())+g*x*(b.getEndX()-b.getStartX());x++}return h?u.getBoundingBox().getMinX():u.getBoundingBox().getMaxX()}static detectCodeword(u,l,d,h,g,v,x,b){g=ot.adjustCodewordStartColumn(u,l,d,h,g,v);let I=ot.getModuleBitCount(u,l,d,h,g,v);if(null==I)return null;let S,k=Vt.sum(I);if(h)S=g+k;else{for(let q=0;q<I.length/2;q++){let Z=I[q];I[q]=I[I.length-1-q],I[I.length-1-q]=Z}S=g,g=S-k}if(!ot.checkCodewordSkew(k,x,b))return null;let L=Je.getDecodedValue(I),W=C.getCodeword(L);return-1===W?null:new yt(g,S,ot.getCodewordBucketNumber(L),W)}static getModuleBitCount(u,l,d,h,g,v){let x=g,b=new Int32Array(8),I=0,S=h?1:-1,k=h;for(;(h?x<d:x>=l)&&I<b.length;)u.get(x,v)===k?(b[I]++,x+=S):(I++,k=!k);return I===b.length||x===(h?d:l)&&I===b.length-1?b:null}static getNumberOfECCodeWords(u){return 2<<u}static adjustCodewordStartColumn(u,l,d,h,g,v){let x=g,b=h?-1:1;for(let I=0;I<2;I++){for(;(h?x>=l:x<d)&&h===u.get(x,v);){if(Math.abs(g-x)>ot.CODEWORD_SKEW_SIZE)return g;x+=b}b=-b,h=!h}return x}static checkCodewordSkew(u,l,d){return l-ot.CODEWORD_SKEW_SIZE<=u&&u<=d+ot.CODEWORD_SKEW_SIZE}static decodeCodewords(u,l,d){if(0===u.length)throw Re.getFormatInstance();let h=1<<l+1,g=ot.correctErrors(u,d,h);ot.verifyCodewordCount(u,h);let v=oe.decode(u,""+l);return v.setErrorsCorrected(g),v.setErasures(d.length),v}static correctErrors(u,l,d){if(null!=l&&l.length>d/2+ot.MAX_ERRORS||d<0||d>ot.MAX_EC_CODEWORDS)throw Dt.getChecksumInstance();return ot.errorCorrection.decode(u,d,l)}static verifyCodewordCount(u,l){if(u.length<4)throw Re.getFormatInstance();let d=u[0];if(d>u.length)throw Re.getFormatInstance();if(0===d){if(!(l<u.length))throw Re.getFormatInstance();u[0]=u.length-l}}static getBitCountForCodeword(u){let l=new Int32Array(8),d=0,h=l.length-1;for(;!((1&u)!==d&&(d=1&u,h--,h<0));)l[h]++,u>>=1;return l}static getCodewordBucketNumber(u){return u instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(u):this.getCodewordBucketNumber_number(u)}static getCodewordBucketNumber_number(u){return ot.getCodewordBucketNumber(ot.getBitCountForCodeword(u))}static getCodewordBucketNumber_Int32Array(u){return(u[0]-u[2]+u[4]-u[6]+9)%9}static toString(u){let l=new Ne;for(let d=0;d<u.length;d++){l.format("Row %2d: ",d);for(let h=0;h<u[d].length;h++){let g=u[d][h];0===g.getValue().length?l.format("        ",null):l.format("%4d(%2d)",g.getValue()[0],g.getConfidence(g.getValue()[0]))}l.format("%n")}return l.toString()}}ot.CODEWORD_SKEW_SIZE=2,ot.MAX_ERRORS=3,ot.MAX_EC_CODEWORDS=512,ot.errorCorrection=new te;class jn{decode(u,l=null){let d=jn.decode(u,l,!1);if(null==d||0===d.length||null==d[0])throw ce.getNotFoundInstance();return d[0]}decodeMultiple(u,l=null){try{return jn.decode(u,l,!0)}catch(d){throw d instanceof Re||d instanceof Dt?ce.getNotFoundInstance():d}}static decode(u,l,d){const h=new Array,g=F.detectMultiple(u,l,d);for(const v of g.getPoints()){const x=ot.decode(g.getBits(),v[4],v[5],v[6],v[7],jn.getMinCodewordWidth(v),jn.getMaxCodewordWidth(v)),b=new fr(x.getText(),x.getRawBytes(),void 0,v,it.PDF_417);b.putMetadata(Yn.ERROR_CORRECTION_LEVEL,x.getECLevel());const I=x.getOther();null!=I&&b.putMetadata(Yn.PDF417_EXTRA_METADATA,I),h.push(b)}return h.map(v=>v)}static getMaxWidth(u,l){return null==u||null==l?0:Math.trunc(Math.abs(u.getX()-l.getX()))}static getMinWidth(u,l){return null==u||null==l?Ct.MAX_VALUE:Math.trunc(Math.abs(u.getX()-l.getX()))}static getMaxCodewordWidth(u){return Math.floor(Math.max(Math.max(jn.getMaxWidth(u[0],u[4]),jn.getMaxWidth(u[6],u[2])*C.MODULES_IN_CODEWORD/C.MODULES_IN_STOP_PATTERN),Math.max(jn.getMaxWidth(u[1],u[5]),jn.getMaxWidth(u[7],u[3])*C.MODULES_IN_CODEWORD/C.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(u){return Math.floor(Math.min(Math.min(jn.getMinWidth(u[0],u[4]),jn.getMinWidth(u[6],u[2])*C.MODULES_IN_CODEWORD/C.MODULES_IN_STOP_PATTERN),Math.min(jn.getMinWidth(u[1],u[5]),jn.getMinWidth(u[7],u[3])*C.MODULES_IN_CODEWORD/C.MODULES_IN_STOP_PATTERN)))}reset(){}}let Wn=(()=>{class D extends xr{}return D.kind="ReaderException",D})();class nu{constructor(u,l){this.verbose=!0===u,l&&this.setHints(l)}decode(u,l){return l&&this.setHints(l),this.decodeInternal(u)}decodeWithState(u){return null==this.readers&&this.setHints(null),this.decodeInternal(u)}setHints(u){this.hints=u;const l=null!=u&&void 0!==u.get(En.TRY_HARDER),d=null==u?null:u.get(En.POSSIBLE_FORMATS),h=new Array;if(null!=d){const g=d.some(v=>v===it.UPC_A||v===it.UPC_E||v===it.EAN_13||v===it.EAN_8||v===it.CODABAR||v===it.CODE_39||v===it.CODE_93||v===it.CODE_128||v===it.ITF||v===it.RSS_14||v===it.RSS_EXPANDED);g&&!l&&h.push(new xa(u,this.verbose)),d.includes(it.QR_CODE)&&h.push(new mi),d.includes(it.DATA_MATRIX)&&h.push(new Vs),d.includes(it.AZTEC)&&h.push(new Bs),d.includes(it.PDF_417)&&h.push(new jn),g&&l&&h.push(new xa(u,this.verbose))}0===h.length&&(l||h.push(new xa(u,this.verbose)),h.push(new mi),h.push(new Vs),h.push(new Bs),h.push(new jn),l&&h.push(new xa(u,this.verbose))),this.readers=h}reset(){if(null!==this.readers)for(const u of this.readers)u.reset()}decodeInternal(u){if(null===this.readers)throw new Wn("No readers where selected, nothing can be read.");for(const l of this.readers)try{return l.decode(u,this.hints)}catch(d){if(d instanceof Wn)continue}throw new ce("No MultiFormat Readers were able to detect the code.")}}var es=(()=>{return(D=es||(es={}))[D.ERROR_CORRECTION=0]="ERROR_CORRECTION",D[D.CHARACTER_SET=1]="CHARACTER_SET",D[D.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",D[D.MIN_SIZE=3]="MIN_SIZE",D[D.MAX_SIZE=4]="MAX_SIZE",D[D.MARGIN=5]="MARGIN",D[D.PDF417_COMPACT=6]="PDF417_COMPACT",D[D.PDF417_COMPACTION=7]="PDF417_COMPACTION",D[D.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",D[D.AZTEC_LAYERS=9]="AZTEC_LAYERS",D[D.QR_VERSION=10]="QR_VERSION",es;var D})(),tr=es;class js{constructor(u){this.field=u,this.cachedGenerators=[],this.cachedGenerators.push(new kr(u,Int32Array.from([1])))}buildGenerator(u){const l=this.cachedGenerators;if(u>=l.length){let d=l[l.length-1];const h=this.field;for(let g=l.length;g<=u;g++){const v=d.multiply(new kr(h,Int32Array.from([1,h.exp(g-1+h.getGeneratorBase())])));l.push(v),d=v}}return l[u]}encode(u,l){if(0===l)throw new Ye("No error correction bytes");const d=u.length-l;if(d<=0)throw new Ye("No data bytes provided");const h=this.buildGenerator(l),g=new Int32Array(d);en.arraycopy(u,0,g,0,d);let v=new kr(this.field,g);v=v.multiplyByMonomial(l,1);const b=v.divide(h)[1].getCoefficients(),I=l-b.length;for(let S=0;S<I;S++)u[d+S]=0;en.arraycopy(b,0,u,d+I,b.length)}}let Cr=(()=>{class D{constructor(){}static applyMaskPenaltyRule1(l){return D.applyMaskPenaltyRule1Internal(l,!0)+D.applyMaskPenaltyRule1Internal(l,!1)}static applyMaskPenaltyRule2(l){let d=0;const h=l.getArray(),g=l.getWidth(),v=l.getHeight();for(let x=0;x<v-1;x++){const b=h[x];for(let I=0;I<g-1;I++){const S=b[I];S===b[I+1]&&S===h[x+1][I]&&S===h[x+1][I+1]&&d++}}return D.N2*d}static applyMaskPenaltyRule3(l){let d=0;const h=l.getArray(),g=l.getWidth(),v=l.getHeight();for(let x=0;x<v;x++)for(let b=0;b<g;b++){const I=h[x];b+6<g&&1===I[b]&&0===I[b+1]&&1===I[b+2]&&1===I[b+3]&&1===I[b+4]&&0===I[b+5]&&1===I[b+6]&&(D.isWhiteHorizontal(I,b-4,b)||D.isWhiteHorizontal(I,b+7,b+11))&&d++,x+6<v&&1===h[x][b]&&0===h[x+1][b]&&1===h[x+2][b]&&1===h[x+3][b]&&1===h[x+4][b]&&0===h[x+5][b]&&1===h[x+6][b]&&(D.isWhiteVertical(h,b,x-4,x)||D.isWhiteVertical(h,b,x+7,x+11))&&d++}return d*D.N3}static isWhiteHorizontal(l,d,h){d=Math.max(d,0),h=Math.min(h,l.length);for(let g=d;g<h;g++)if(1===l[g])return!1;return!0}static isWhiteVertical(l,d,h,g){h=Math.max(h,0),g=Math.min(g,l.length);for(let v=h;v<g;v++)if(1===l[v][d])return!1;return!0}static applyMaskPenaltyRule4(l){let d=0;const h=l.getArray(),g=l.getWidth(),v=l.getHeight();for(let I=0;I<v;I++){const S=h[I];for(let k=0;k<g;k++)1===S[k]&&d++}const x=l.getHeight()*l.getWidth();return Math.floor(10*Math.abs(2*d-x)/x)*D.N4}static getDataMaskBit(l,d,h){let g,v;switch(l){case 0:g=h+d&1;break;case 1:g=1&h;break;case 2:g=d%3;break;case 3:g=(h+d)%3;break;case 4:g=Math.floor(h/2)+Math.floor(d/3)&1;break;case 5:v=h*d,g=(1&v)+v%3;break;case 6:v=h*d,g=(1&v)+v%3&1;break;case 7:v=h*d,g=v%3+(h+d&1)&1;break;default:throw new Ye("Invalid mask pattern: "+l)}return 0===g}static applyMaskPenaltyRule1Internal(l,d){let h=0;const g=d?l.getHeight():l.getWidth(),v=d?l.getWidth():l.getHeight(),x=l.getArray();for(let b=0;b<g;b++){let I=0,S=-1;for(let k=0;k<v;k++){const L=d?x[b][k]:x[k][b];L===S?I++:(I>=5&&(h+=D.N1+(I-5)),I=1,S=L)}I>=5&&(h+=D.N1+(I-5))}return h}}return D.N1=3,D.N2=3,D.N3=40,D.N4=10,D})();class Ws{constructor(u,l){this.width=u,this.height=l;const d=new Array(l);for(let h=0;h!==l;h++)d[h]=new Uint8Array(u);this.bytes=d}getHeight(){return this.height}getWidth(){return this.width}get(u,l){return this.bytes[l][u]}getArray(){return this.bytes}setNumber(u,l,d){this.bytes[l][u]=d}setBoolean(u,l,d){this.bytes[l][u]=d?1:0}clear(u){for(const l of this.bytes)Vn.fill(l,u)}equals(u){if(!(u instanceof Ws))return!1;const l=u;if(this.width!==l.width||this.height!==l.height)return!1;for(let d=0,h=this.height;d<h;++d){const g=this.bytes[d],v=l.bytes[d];for(let x=0,b=this.width;x<b;++x)if(g[x]!==v[x])return!1}return!0}toString(){const u=new rn;for(let l=0,d=this.height;l<d;++l){const h=this.bytes[l];for(let g=0,v=this.width;g<v;++g)switch(h[g]){case 0:u.append(" 0");break;case 1:u.append(" 1");break;default:u.append("  ")}u.append("\n")}return u.toString()}}let ts=(()=>{class D{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const l=new rn;return l.append("<<\n"),l.append(" mode: "),l.append(this.mode?this.mode.toString():"null"),l.append("\n ecLevel: "),l.append(this.ecLevel?this.ecLevel.toString():"null"),l.append("\n version: "),l.append(this.version?this.version.toString():"null"),l.append("\n maskPattern: "),l.append(this.maskPattern.toString()),this.matrix?(l.append("\n matrix:\n"),l.append(this.matrix.toString())):l.append("\n matrix: null\n"),l.append(">>\n"),l.toString()}setMode(l){this.mode=l}setECLevel(l){this.ecLevel=l}setVersion(l){this.version=l}setMaskPattern(l){this.maskPattern=l}setMatrix(l){this.matrix=l}static isValidMaskPattern(l){return l>=0&&l<D.NUM_MASK_PATTERNS}}return D.NUM_MASK_PATTERNS=8,D})(),Ht=(()=>{class D extends xr{}return D.kind="WriterException",D})();class Fe{constructor(){}static clearMatrix(u){u.clear(255)}static buildMatrix(u,l,d,h,g){Fe.clearMatrix(g),Fe.embedBasicPatterns(d,g),Fe.embedTypeInfo(l,h,g),Fe.maybeEmbedVersionInfo(d,g),Fe.embedDataBits(u,h,g)}static embedBasicPatterns(u,l){Fe.embedPositionDetectionPatternsAndSeparators(l),Fe.embedDarkDotAtLeftBottomCorner(l),Fe.maybeEmbedPositionAdjustmentPatterns(u,l),Fe.embedTimingPatterns(l)}static embedTypeInfo(u,l,d){const h=new gt;Fe.makeTypeInfoBits(u,l,h);for(let g=0,v=h.getSize();g<v;++g){const x=h.get(h.getSize()-1-g),b=Fe.TYPE_INFO_COORDINATES[g];if(d.setBoolean(b[0],b[1],x),g<8){const k=d.getWidth()-g-1;d.setBoolean(k,8,x)}else{const k=8,L=d.getHeight()-7+(g-8);d.setBoolean(k,L,x)}}}static maybeEmbedVersionInfo(u,l){if(u.getVersionNumber()<7)return;const d=new gt;Fe.makeVersionInfoBits(u,d);let h=17;for(let g=0;g<6;++g)for(let v=0;v<3;++v){const x=d.get(h);h--,l.setBoolean(g,l.getHeight()-11+v,x),l.setBoolean(l.getHeight()-11+v,g,x)}}static embedDataBits(u,l,d){let h=0,g=-1,v=d.getWidth()-1,x=d.getHeight()-1;for(;v>0;){for(6===v&&(v-=1);x>=0&&x<d.getHeight();){for(let b=0;b<2;++b){const I=v-b;if(!Fe.isEmpty(d.get(I,x)))continue;let S;h<u.getSize()?(S=u.get(h),++h):S=!1,255!==l&&Cr.getDataMaskBit(l,I,x)&&(S=!S),d.setBoolean(I,x,S)}x+=g}g=-g,x+=g,v-=2}if(h!==u.getSize())throw new Ht("Not all bits consumed: "+h+"/"+u.getSize())}static findMSBSet(u){return 32-Ct.numberOfLeadingZeros(u)}static calculateBCHCode(u,l){if(0===l)throw new Ye("0 polynomial");const d=Fe.findMSBSet(l);for(u<<=d-1;Fe.findMSBSet(u)>=d;)u^=l<<Fe.findMSBSet(u)-d;return u}static makeTypeInfoBits(u,l,d){if(!ts.isValidMaskPattern(l))throw new Ht("Invalid mask pattern");const h=u.getBits()<<3|l;d.appendBits(h,5);const g=Fe.calculateBCHCode(h,Fe.TYPE_INFO_POLY);d.appendBits(g,10);const v=new gt;if(v.appendBits(Fe.TYPE_INFO_MASK_PATTERN,15),d.xor(v),15!==d.getSize())throw new Ht("should not happen but we got: "+d.getSize())}static makeVersionInfoBits(u,l){l.appendBits(u.getVersionNumber(),6);const d=Fe.calculateBCHCode(u.getVersionNumber(),Fe.VERSION_INFO_POLY);if(l.appendBits(d,12),18!==l.getSize())throw new Ht("should not happen but we got: "+l.getSize())}static isEmpty(u){return 255===u}static embedTimingPatterns(u){for(let l=8;l<u.getWidth()-8;++l){const d=(l+1)%2;Fe.isEmpty(u.get(l,6))&&u.setNumber(l,6,d),Fe.isEmpty(u.get(6,l))&&u.setNumber(6,l,d)}}static embedDarkDotAtLeftBottomCorner(u){if(0===u.get(8,u.getHeight()-8))throw new Ht;u.setNumber(8,u.getHeight()-8,1)}static embedHorizontalSeparationPattern(u,l,d){for(let h=0;h<8;++h){if(!Fe.isEmpty(d.get(u+h,l)))throw new Ht;d.setNumber(u+h,l,0)}}static embedVerticalSeparationPattern(u,l,d){for(let h=0;h<7;++h){if(!Fe.isEmpty(d.get(u,l+h)))throw new Ht;d.setNumber(u,l+h,0)}}static embedPositionAdjustmentPattern(u,l,d){for(let h=0;h<5;++h){const g=Fe.POSITION_ADJUSTMENT_PATTERN[h];for(let v=0;v<5;++v)d.setNumber(u+v,l+h,g[v])}}static embedPositionDetectionPattern(u,l,d){for(let h=0;h<7;++h){const g=Fe.POSITION_DETECTION_PATTERN[h];for(let v=0;v<7;++v)d.setNumber(u+v,l+h,g[v])}}static embedPositionDetectionPatternsAndSeparators(u){const l=Fe.POSITION_DETECTION_PATTERN[0].length;Fe.embedPositionDetectionPattern(0,0,u),Fe.embedPositionDetectionPattern(u.getWidth()-l,0,u),Fe.embedPositionDetectionPattern(0,u.getWidth()-l,u);Fe.embedHorizontalSeparationPattern(0,7,u),Fe.embedHorizontalSeparationPattern(u.getWidth()-8,7,u),Fe.embedHorizontalSeparationPattern(0,u.getWidth()-8,u);Fe.embedVerticalSeparationPattern(7,0,u),Fe.embedVerticalSeparationPattern(u.getHeight()-7-1,0,u),Fe.embedVerticalSeparationPattern(7,u.getHeight()-7,u)}static maybeEmbedPositionAdjustmentPatterns(u,l){if(u.getVersionNumber()<2)return;const d=u.getVersionNumber()-1,h=Fe.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[d];for(let g=0,v=h.length;g!==v;g++){const x=h[g];if(x>=0)for(let b=0;b!==v;b++){const I=h[b];I>=0&&Fe.isEmpty(l.get(I,x))&&Fe.embedPositionAdjustmentPattern(I-2,x-2,l)}}}}Fe.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),Fe.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),Fe.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),Fe.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),Fe.VERSION_INFO_POLY=7973,Fe.TYPE_INFO_POLY=1335,Fe.TYPE_INFO_MASK_PATTERN=21522;class D0{constructor(u,l){this.dataBytes=u,this.errorCorrectionBytes=l}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class Mn{constructor(){}static calculateMaskPenalty(u){return Cr.applyMaskPenaltyRule1(u)+Cr.applyMaskPenaltyRule2(u)+Cr.applyMaskPenaltyRule3(u)+Cr.applyMaskPenaltyRule4(u)}static encode(u,l,d=null){let h=Mn.DEFAULT_BYTE_MODE_ENCODING;const g=null!==d&&void 0!==d.get(tr.CHARACTER_SET);g&&(h=d.get(tr.CHARACTER_SET).toString());const v=this.chooseMode(u,h),x=new gt;if(v===ke.BYTE&&(g||Mn.DEFAULT_BYTE_MODE_ENCODING!==h)){const Me=Ee.getCharacterSetECIByName(h);void 0!==Me&&this.appendECI(Me,x)}this.appendModeInfo(v,x);const b=new gt;let I;if(this.appendBytes(u,v,b,h),null!==d&&void 0!==d.get(tr.QR_VERSION)){const Me=Number.parseInt(d.get(tr.QR_VERSION).toString(),10);I=Ze.getVersionForNumber(Me);const de=this.calculateBitsNeeded(v,x,b,I);if(!this.willFit(de,I,l))throw new Ht("Data too big for requested version")}else I=this.recommendVersion(l,v,x,b);const S=new gt;S.appendBitArray(x);const k=v===ke.BYTE?b.getSizeInBytes():u.length;this.appendLengthInfo(k,I,v,S),S.appendBitArray(b);const L=I.getECBlocksForLevel(l),W=I.getTotalCodewords()-L.getTotalECCodewords();this.terminateBits(W,S);const q=this.interleaveWithECBytes(S,I.getTotalCodewords(),W,L.getNumBlocks()),Z=new ts;Z.setECLevel(l),Z.setMode(v),Z.setVersion(I);const ne=I.getDimensionForVersion(),ie=new Ws(ne,ne),Ae=this.chooseMaskPattern(q,l,I,ie);return Z.setMaskPattern(Ae),Fe.buildMatrix(q,l,I,Ae,ie),Z.setMatrix(ie),Z}static recommendVersion(u,l,d,h){const g=this.calculateBitsNeeded(l,d,h,Ze.getVersionForNumber(1)),v=this.chooseVersion(g,u),x=this.calculateBitsNeeded(l,d,h,v);return this.chooseVersion(x,u)}static calculateBitsNeeded(u,l,d,h){return l.getSize()+u.getCharacterCountBits(h)+d.getSize()}static getAlphanumericCode(u){return u<Mn.ALPHANUMERIC_TABLE.length?Mn.ALPHANUMERIC_TABLE[u]:-1}static chooseMode(u,l=null){if(Ee.SJIS.getName()===l&&this.isOnlyDoubleByteKanji(u))return ke.KANJI;let d=!1,h=!1;for(let g=0,v=u.length;g<v;++g){const x=u.charAt(g);if(Mn.isDigit(x))d=!0;else{if(-1===this.getAlphanumericCode(x.charCodeAt(0)))return ke.BYTE;h=!0}}return h?ke.ALPHANUMERIC:d?ke.NUMERIC:ke.BYTE}static isOnlyDoubleByteKanji(u){let l;try{l=vn.encode(u,Ee.SJIS)}catch(h){return!1}const d=l.length;if(d%2!=0)return!1;for(let h=0;h<d;h+=2){const g=255&l[h];if((g<129||g>159)&&(g<224||g>235))return!1}return!0}static chooseMaskPattern(u,l,d,h){let g=Number.MAX_SAFE_INTEGER,v=-1;for(let x=0;x<ts.NUM_MASK_PATTERNS;x++){Fe.buildMatrix(u,l,d,x,h);let b=this.calculateMaskPenalty(h);b<g&&(g=b,v=x)}return v}static chooseVersion(u,l){for(let d=1;d<=40;d++){const h=Ze.getVersionForNumber(d);if(Mn.willFit(u,h,l))return h}throw new Ht("Data too big")}static willFit(u,l,d){return l.getTotalCodewords()-l.getECBlocksForLevel(d).getTotalECCodewords()>=(u+7)/8}static terminateBits(u,l){const d=8*u;if(l.getSize()>d)throw new Ht("data bits cannot fit in the QR Code"+l.getSize()+" > "+d);for(let v=0;v<4&&l.getSize()<d;++v)l.appendBit(!1);const h=7&l.getSize();if(h>0)for(let v=h;v<8;v++)l.appendBit(!1);const g=u-l.getSizeInBytes();for(let v=0;v<g;++v)l.appendBits(0==(1&v)?236:17,8);if(l.getSize()!==d)throw new Ht("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(u,l,d,h,g,v){if(h>=d)throw new Ht("Block ID too large");const x=u%d,b=d-x,I=Math.floor(u/d),S=I+1,k=Math.floor(l/d),L=k+1,W=I-k,q=S-L;if(W!==q)throw new Ht("EC bytes mismatch");if(d!==b+x)throw new Ht("RS blocks mismatch");if(u!==(k+W)*b+(L+q)*x)throw new Ht("Total bytes mismatch");h<b?(g[0]=k,v[0]=W):(g[0]=L,v[0]=q)}static interleaveWithECBytes(u,l,d,h){if(u.getSizeInBytes()!==d)throw new Ht("Number of bits and data bytes does not match");let g=0,v=0,x=0;const b=new Array;for(let S=0;S<h;++S){const k=new Int32Array(1),L=new Int32Array(1);Mn.getNumDataBytesAndNumECBytesForBlockID(l,d,h,S,k,L);const W=k[0],q=new Uint8Array(W);u.toBytes(8*g,q,0,W);const Z=Mn.generateECBytes(q,L[0]);b.push(new D0(q,Z)),v=Math.max(v,W),x=Math.max(x,Z.length),g+=k[0]}if(d!==g)throw new Ht("Data bytes does not match offset");const I=new gt;for(let S=0;S<v;++S)for(const k of b){const L=k.getDataBytes();S<L.length&&I.appendBits(L[S],8)}for(let S=0;S<x;++S)for(const k of b){const L=k.getErrorCorrectionBytes();S<L.length&&I.appendBits(L[S],8)}if(l!==I.getSizeInBytes())throw new Ht("Interleaving error: "+l+" and "+I.getSizeInBytes()+" differ.");return I}static generateECBytes(u,l){const d=u.length,h=new Int32Array(d+l);for(let v=0;v<d;v++)h[v]=255&u[v];new js(Pt.QR_CODE_FIELD_256).encode(h,l);const g=new Uint8Array(l);for(let v=0;v<l;v++)g[v]=h[d+v];return g}static appendModeInfo(u,l){l.appendBits(u.getBits(),4)}static appendLengthInfo(u,l,d,h){const g=d.getCharacterCountBits(l);if(u>=1<<g)throw new Ht(u+" is bigger than "+((1<<g)-1));h.appendBits(u,g)}static appendBytes(u,l,d,h){switch(l){case ke.NUMERIC:Mn.appendNumericBytes(u,d);break;case ke.ALPHANUMERIC:Mn.appendAlphanumericBytes(u,d);break;case ke.BYTE:Mn.append8BitBytes(u,d,h);break;case ke.KANJI:Mn.appendKanjiBytes(u,d);break;default:throw new Ht("Invalid mode: "+l)}}static getDigit(u){return u.charCodeAt(0)-48}static isDigit(u){const l=Mn.getDigit(u);return l>=0&&l<=9}static appendNumericBytes(u,l){const d=u.length;let h=0;for(;h<d;){const g=Mn.getDigit(u.charAt(h));if(h+2<d){const v=Mn.getDigit(u.charAt(h+1)),x=Mn.getDigit(u.charAt(h+2));l.appendBits(100*g+10*v+x,10),h+=3}else if(h+1<d){const v=Mn.getDigit(u.charAt(h+1));l.appendBits(10*g+v,7),h+=2}else l.appendBits(g,4),h++}}static appendAlphanumericBytes(u,l){const d=u.length;let h=0;for(;h<d;){const g=Mn.getAlphanumericCode(u.charCodeAt(h));if(-1===g)throw new Ht;if(h+1<d){const v=Mn.getAlphanumericCode(u.charCodeAt(h+1));if(-1===v)throw new Ht;l.appendBits(45*g+v,11),h+=2}else l.appendBits(g,6),h++}}static append8BitBytes(u,l,d){let h;try{h=vn.encode(u,d)}catch(g){throw new Ht(g)}for(let g=0,v=h.length;g!==v;g++)l.appendBits(h[g],8)}static appendKanjiBytes(u,l){let d;try{d=vn.encode(u,Ee.SJIS)}catch(g){throw new Ht(g)}const h=d.length;for(let g=0;g<h;g+=2){const b=(255&d[g])<<8&4294967295|255&d[g+1];let I=-1;if(b>=33088&&b<=40956?I=b-33088:b>=57408&&b<=60351&&(I=b-49472),-1===I)throw new Ht("Invalid byte sequence");l.appendBits(192*(I>>8)+(255&I),13)}}static appendECI(u,l){l.appendBits(ke.ECI.getBits(),4),l.appendBits(u.getValue(),8)}}Mn.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),Mn.DEFAULT_BYTE_MODE_ENCODING=Ee.UTF8.getName();let Ec=(()=>{class D{write(l,d,h,g=null){if(0===l.length)throw new Ye("Found empty contents");if(d<0||h<0)throw new Ye("Requested dimensions are too small: "+d+"x"+h);let v=Oe.L,x=D.QUIET_ZONE_SIZE;null!==g&&(void 0!==g.get(tr.ERROR_CORRECTION)&&(v=Oe.fromString(g.get(tr.ERROR_CORRECTION).toString())),void 0!==g.get(tr.MARGIN)&&(x=Number.parseInt(g.get(tr.MARGIN).toString(),10)));const b=Mn.encode(l,v,g);return this.renderResult(b,d,h,x)}writeToDom(l,d,h,g,v=null){"string"==typeof l&&(l=document.querySelector(l));const x=this.write(d,h,g,v);l&&l.appendChild(x)}renderResult(l,d,h,g){const v=l.getMatrix();if(null===v)throw new ao;const x=v.getWidth(),b=v.getHeight(),I=x+2*g,S=b+2*g,k=Math.max(d,I),L=Math.max(h,S),W=Math.min(Math.floor(k/I),Math.floor(L/S)),q=Math.floor((k-x*W)/2),Z=Math.floor((L-b*W)/2),ne=this.createSVGElement(k,L);for(let ie=0,Ae=Z;ie<b;ie++,Ae+=W)for(let Me=0,de=q;Me<x;Me++,de+=W)if(1===v.get(Me,ie)){const Lt=this.createSvgRectElement(de,Ae,W,W);ne.appendChild(Lt)}return ne}createSVGElement(l,d){const h=document.createElementNS(D.SVG_NS,"svg");return h.setAttributeNS(null,"height",l.toString()),h.setAttributeNS(null,"width",d.toString()),h}createSvgRectElement(l,d,h,g){const v=document.createElementNS(D.SVG_NS,"rect");return v.setAttributeNS(null,"x",l.toString()),v.setAttributeNS(null,"y",d.toString()),v.setAttributeNS(null,"height",h.toString()),v.setAttributeNS(null,"width",g.toString()),v.setAttributeNS(null,"fill","#000000"),v}}return D.QUIET_ZONE_SIZE=4,D.SVG_NS="http://www.w3.org/2000/svg",D})(),_c=(()=>{class D{encode(l,d,h,g,v){if(0===l.length)throw new Ye("Found empty contents");if(d!==it.QR_CODE)throw new Ye("Can only encode QR_CODE, but got "+d);if(h<0||g<0)throw new Ye(`Requested dimensions are too small: ${h}x${g}`);let x=Oe.L,b=D.QUIET_ZONE_SIZE;null!==v&&(void 0!==v.get(tr.ERROR_CORRECTION)&&(x=Oe.fromString(v.get(tr.ERROR_CORRECTION).toString())),void 0!==v.get(tr.MARGIN)&&(b=Number.parseInt(v.get(tr.MARGIN).toString(),10)));const I=Mn.encode(l,x,v);return D.renderResult(I,h,g,b)}static renderResult(l,d,h,g){const v=l.getMatrix();if(null===v)throw new ao;const x=v.getWidth(),b=v.getHeight(),I=x+2*g,S=b+2*g,k=Math.max(d,I),L=Math.max(h,S),W=Math.min(Math.floor(k/I),Math.floor(L/S)),q=Math.floor((k-x*W)/2),Z=Math.floor((L-b*W)/2),ne=new Gn(k,L);for(let ie=0,Ae=Z;ie<b;ie++,Ae+=W)for(let Me=0,de=q;Me<x;Me++,de+=W)1===v.get(Me,ie)&&ne.setRegion(de,Ae,W,W);return ne}}return D.QUIET_ZONE_SIZE=4,D})();let Ic=(()=>{class D extends No{constructor(l,d,h,g,v,x,b,I){if(super(x,b),this.yuvData=l,this.dataWidth=d,this.dataHeight=h,this.left=g,this.top=v,g+x>d||v+b>h)throw new Ye("Crop rectangle does not fit within image data.");I&&this.reverseHorizontal(x,b)}getRow(l,d){if(l<0||l>=this.getHeight())throw new Ye("Requested row is outside the image: "+l);const h=this.getWidth();return(null==d||d.length<h)&&(d=new Uint8ClampedArray(h)),en.arraycopy(this.yuvData,(l+this.top)*this.dataWidth+this.left,d,0,h),d}getMatrix(){const l=this.getWidth(),d=this.getHeight();if(l===this.dataWidth&&d===this.dataHeight)return this.yuvData;const h=l*d,g=new Uint8ClampedArray(h);let v=this.top*this.dataWidth+this.left;if(l===this.dataWidth)return en.arraycopy(this.yuvData,v,g,0,h),g;for(let x=0;x<d;x++)en.arraycopy(this.yuvData,v,g,x*l,l),v+=this.dataWidth;return g}isCropSupported(){return!0}crop(l,d,h,g){return new D(this.yuvData,this.dataWidth,this.dataHeight,this.left+l,this.top+d,h,g,!1)}renderThumbnail(){const l=this.getWidth()/D.THUMBNAIL_SCALE_FACTOR,d=this.getHeight()/D.THUMBNAIL_SCALE_FACTOR,h=new Int32Array(l*d),g=this.yuvData;let v=this.top*this.dataWidth+this.left;for(let x=0;x<d;x++){const b=x*l;for(let I=0;I<l;I++)h[b+I]=4278190080|65793*(255&g[v+I*D.THUMBNAIL_SCALE_FACTOR]);v+=this.dataWidth*D.THUMBNAIL_SCALE_FACTOR}return h}getThumbnailWidth(){return this.getWidth()/D.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/D.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(l,d){const h=this.yuvData;for(let g=0,v=this.top*this.dataWidth+this.left;g<d;g++,v+=this.dataWidth){const x=v+l/2;for(let b=v,I=v+l-1;b<x;b++,I--){const S=h[b];h[b]=h[I],h[I]=S}}}invert(){return new qi(this)}}return D.THUMBNAIL_SCALE_FACTOR=2,D})();class ns extends No{constructor(u,l,d,h,g,v,x){if(super(l,d),this.dataWidth=h,this.dataHeight=g,this.left=v,this.top=x,4===u.BYTES_PER_ELEMENT){const b=l*d,I=new Uint8ClampedArray(b);for(let S=0;S<b;S++){const k=u[S];I[S]=((k>>16&255)+(k>>7&510)+(255&k))/4&255}this.luminances=I}else this.luminances=u;if(void 0===h&&(this.dataWidth=l),void 0===g&&(this.dataHeight=d),void 0===v&&(this.left=0),void 0===x&&(this.top=0),this.left+l>this.dataWidth||this.top+d>this.dataHeight)throw new Ye("Crop rectangle does not fit within image data.")}getRow(u,l){if(u<0||u>=this.getHeight())throw new Ye("Requested row is outside the image: "+u);const d=this.getWidth();return(null==l||l.length<d)&&(l=new Uint8ClampedArray(d)),en.arraycopy(this.luminances,(u+this.top)*this.dataWidth+this.left,l,0,d),l}getMatrix(){const u=this.getWidth(),l=this.getHeight();if(u===this.dataWidth&&l===this.dataHeight)return this.luminances;const d=u*l,h=new Uint8ClampedArray(d);let g=this.top*this.dataWidth+this.left;if(u===this.dataWidth)return en.arraycopy(this.luminances,g,h,0,d),h;for(let v=0;v<l;v++)en.arraycopy(this.luminances,g,h,v*u,u),g+=this.dataWidth;return h}isCropSupported(){return!0}crop(u,l,d,h){return new ns(this.luminances,d,h,this.dataWidth,this.dataHeight,this.left+u,this.top+l)}invert(){return new qi(this)}}class Br extends Ee{static forName(u){return this.getCharacterSetECIByName(u)}}class ef{}ef.ISO_8859_1=Ee.ISO8859_1;class ho{isCompact(){return this.compact}setCompact(u){this.compact=u}getSize(){return this.size}setSize(u){this.size=u}getLayers(){return this.layers}setLayers(u){this.layers=u}getCodeWords(){return this.codeWords}setCodeWords(u){this.codeWords=u}getMatrix(){return this.matrix}setMatrix(u){this.matrix=u}}class Zi{static singletonList(u){return[u]}static min(u,l){return u.sort(l)[0]}}class rs extends class{constructor(u){this.previous=u}getPrevious(){return this.previous}}{constructor(u,l,d){super(u),this.value=l,this.bitCount=d}appendTo(u,l){u.appendBits(this.value,this.bitCount)}add(u,l){return new rs(this,u,l)}addBinaryShift(u,l){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new rs(this,u,l)}toString(){let u=this.value&(1<<this.bitCount)-1;return u|=1<<this.bitCount,"<"+Ct.toBinaryString(u|1<<this.bitCount).substring(1)+">"}}class iu extends rs{constructor(u,l,d){super(u,0,0),this.binaryShiftStart=l,this.binaryShiftByteCount=d}appendTo(u,l){for(let d=0;d<this.binaryShiftByteCount;d++)(0===d||31===d&&this.binaryShiftByteCount<=62)&&(u.appendBits(31,5),this.binaryShiftByteCount>62?u.appendBits(this.binaryShiftByteCount-31,16):u.appendBits(0===d?Math.min(this.binaryShiftByteCount,31):this.binaryShiftByteCount-31,5)),u.appendBits(l[this.binaryShiftStart+d],8)}addBinaryShift(u,l){return new iu(this,u,l)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function Vu(D,u,l){return new rs(D,u,l)}const ox=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],sx=new rs(null,0,0),zd=[Int32Array.from([0,327708,327710,327709,656318]),Int32Array.from([590318,0,327710,327709,656318]),Int32Array.from([262158,590300,0,590301,932798]),Int32Array.from([327709,327708,656318,0,327710]),Int32Array.from([327711,656380,656382,656381,0])];const S0=function(D){for(let u of D)Vn.fill(u,-1);return D[0][4]=0,D[1][4]=0,D[1][0]=28,D[3][4]=0,D[2][4]=0,D[2][0]=15,D}(Vn.createInt32Array(6,6));class os{constructor(u,l,d,h){this.token=u,this.mode=l,this.binaryShiftByteCount=d,this.bitCount=h}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(u,l){let d=this.bitCount,h=this.token;if(u!==this.mode){let v=zd[this.mode][u];h=Vu(h,65535&v,v>>16),d+=v>>16}let g=2===u?4:5;return h=Vu(h,l,g),new os(h,u,0,d+g)}shiftAndAppend(u,l){let d=this.token,h=2===this.mode?4:5;return d=Vu(d,S0[this.mode][u],h),d=Vu(d,l,5),new os(d,this.mode,0,this.bitCount+h+5)}addBinaryShiftChar(u){let l=this.token,d=this.mode,h=this.bitCount;if(4===this.mode||2===this.mode){let x=zd[d][0];l=Vu(l,65535&x,x>>16),h+=x>>16,d=0}let v=new os(l,d,this.binaryShiftByteCount+1,h+(0===this.binaryShiftByteCount||31===this.binaryShiftByteCount?18:62===this.binaryShiftByteCount?9:8));return 2078===v.binaryShiftByteCount&&(v=v.endBinaryShift(u+1)),v}endBinaryShift(u){if(0===this.binaryShiftByteCount)return this;let l=this.token;return l=function(D,u,l){return new iu(D,u,l)}(l,u-this.binaryShiftByteCount,this.binaryShiftByteCount),new os(l,this.mode,0,this.bitCount)}isBetterThanOrEqualTo(u){let l=this.bitCount+(zd[this.mode][u.mode]>>16);return this.binaryShiftByteCount<u.binaryShiftByteCount?l+=os.calculateBinaryShiftCost(u)-os.calculateBinaryShiftCost(this):this.binaryShiftByteCount>u.binaryShiftByteCount&&u.binaryShiftByteCount>0&&(l+=10),l<=u.bitCount}toBitArray(u){let l=[];for(let h=this.endBinaryShift(u.length).token;null!==h;h=h.getPrevious())l.unshift(h);let d=new gt;for(const h of l)h.appendTo(d,u);return d}toString(){return at.format("%s bits=%d bytes=%d",ox[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(u){return u.binaryShiftByteCount>62?21:u.binaryShiftByteCount>31?20:u.binaryShiftByteCount>0?10:0}}os.INITIAL_STATE=new os(sx,0,0,0);const Gd=function(D){const u=at.getCharCode(" "),l=at.getCharCode("."),d=at.getCharCode(",");D[0][u]=1;const h=at.getCharCode("Z"),g=at.getCharCode("A");for(let L=g;L<=h;L++)D[0][L]=L-g+2;D[1][u]=1;const v=at.getCharCode("z"),x=at.getCharCode("a");for(let L=x;L<=v;L++)D[1][L]=L-x+2;D[2][u]=1;const b=at.getCharCode("9"),I=at.getCharCode("0");for(let L=I;L<=b;L++)D[2][L]=L-I+2;D[2][d]=12,D[2][l]=13;const S=["\0"," ","\x01","\x02","\x03","\x04","\x05","\x06","\x07","\b","\t","\n","\v","\f","\r","\x1b","\x1c","\x1d","\x1e","\x1f","@","\\","^","_","`","|","~","\x7f"];for(let L=0;L<S.length;L++)D[3][at.getCharCode(S[L])]=L;const k=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let L=0;L<k.length;L++)at.getCharCode(k[L])>0&&(D[4][at.getCharCode(k[L])]=L);return D}(Vn.createInt32Array(5,256));class Dc{constructor(u){this.text=u}encode(){const u=at.getCharCode(" "),l=at.getCharCode("\n");let d=Zi.singletonList(os.INITIAL_STATE);for(let g=0;g<this.text.length;g++){let v,x=g+1<this.text.length?this.text[g+1]:0;switch(this.text[g]){case at.getCharCode("\r"):v=x===l?2:0;break;case at.getCharCode("."):v=x===u?3:0;break;case at.getCharCode(","):v=x===u?4:0;break;case at.getCharCode(":"):v=x===u?5:0;break;default:v=0}v>0?(d=Dc.updateStateListForPair(d,g,v),g++):d=this.updateStateListForChar(d,g)}return Zi.min(d,(g,v)=>g.getBitCount()-v.getBitCount()).toBitArray(this.text)}updateStateListForChar(u,l){const d=[];for(let h of u)this.updateStateForChar(h,l,d);return Dc.simplifyStates(d)}updateStateForChar(u,l,d){let h=255&this.text[l],g=Gd[u.getMode()][h]>0,v=null;for(let x=0;x<=4;x++){let b=Gd[x][h];if(b>0){if(null==v&&(v=u.endBinaryShift(l)),!g||x===u.getMode()||2===x){const I=v.latchAndAppend(x,b);d.push(I)}if(!g&&S0[u.getMode()][x]>=0){const I=v.shiftAndAppend(x,b);d.push(I)}}}if(u.getBinaryShiftByteCount()>0||0===Gd[u.getMode()][h]){let x=u.addBinaryShiftChar(l);d.push(x)}}static updateStateListForPair(u,l,d){const h=[];for(let g of u)this.updateStateForPair(g,l,d,h);return this.simplifyStates(h)}static updateStateForPair(u,l,d,h){let g=u.endBinaryShift(l);if(h.push(g.latchAndAppend(4,d)),4!==u.getMode()&&h.push(g.shiftAndAppend(4,d)),3===d||4===d){let v=g.latchAndAppend(2,16-d).latchAndAppend(2,1);h.push(v)}if(u.getBinaryShiftByteCount()>0){let v=u.addBinaryShiftChar(l).addBinaryShiftChar(l+1);h.push(v)}}static simplifyStates(u){let l=[];for(const d of u){let h=!0;for(const g of l){if(g.isBetterThanOrEqualTo(d)){h=!1;break}d.isBetterThanOrEqualTo(g)&&(l=l.filter(v=>v!==g))}h&&l.push(d)}return l}}class an{constructor(){}static encodeBytes(u){return an.encode(u,an.DEFAULT_EC_PERCENT,an.DEFAULT_AZTEC_LAYERS)}static encode(u,l,d){let x,b,I,S,k,h=new Dc(u).encode(),g=Ct.truncDivision(h.getSize()*l,100)+11,v=h.getSize()+g;if(d!==an.DEFAULT_AZTEC_LAYERS){if(x=d<0,b=Math.abs(d),b>(x?an.MAX_NB_BITS_COMPACT:an.MAX_NB_BITS))throw new Ye(at.format("Illegal value %s for layers",d));I=an.totalBitsInLayer(b,x),S=an.WORD_SIZE[b];let de=I-I%S;if(k=an.stuffBits(h,S),k.getSize()+g>de)throw new Ye("Data to large for user specified layer");if(x&&k.getSize()>64*S)throw new Ye("Data to large for user specified layer")}else{S=0,k=null;for(let de=0;;de++){if(de>an.MAX_NB_BITS)throw new Ye("Data too large for an Aztec code");if(x=de<=3,b=x?de+1:de,I=an.totalBitsInLayer(b,x),v>I)continue;(null==k||S!==an.WORD_SIZE[b])&&(S=an.WORD_SIZE[b],k=an.stuffBits(h,S));let Lt=I-I%S;if(!(x&&k.getSize()>64*S)&&k.getSize()+g<=Lt)break}}let ie,L=an.generateCheckWords(k,I,S),W=k.getSize()/S,q=an.generateModeMessage(x,b,W),Z=(x?11:14)+4*b,ne=new Int32Array(Z);if(x){ie=Z;for(let de=0;de<ne.length;de++)ne[de]=de}else{ie=Z+1+2*Ct.truncDivision(Ct.truncDivision(Z,2)-1,15);let de=Ct.truncDivision(Z,2),Lt=Ct.truncDivision(ie,2);for(let xt=0;xt<de;xt++){let Fi=xt+Ct.truncDivision(xt,15);ne[de-xt-1]=Lt-Fi-1,ne[de+xt]=Lt+Fi+1}}let Ae=new Gn(ie);for(let de=0,Lt=0;de<b;de++){let xt=4*(b-de)+(x?9:12);for(let Fi=0;Fi<xt;Fi++){let un=2*Fi;for(let Pi=0;Pi<2;Pi++)L.get(Lt+un+Pi)&&Ae.set(ne[2*de+Pi],ne[2*de+Fi]),L.get(Lt+2*xt+un+Pi)&&Ae.set(ne[2*de+Fi],ne[Z-1-2*de-Pi]),L.get(Lt+4*xt+un+Pi)&&Ae.set(ne[Z-1-2*de-Pi],ne[Z-1-2*de-Fi]),L.get(Lt+6*xt+un+Pi)&&Ae.set(ne[Z-1-2*de-Fi],ne[2*de+Pi])}Lt+=8*xt}if(an.drawModeMessage(Ae,x,ie,q),x)an.drawBullsEye(Ae,Ct.truncDivision(ie,2),5);else{an.drawBullsEye(Ae,Ct.truncDivision(ie,2),7);for(let de=0,Lt=0;de<Ct.truncDivision(Z,2)-1;de+=15,Lt+=16)for(let xt=1&Ct.truncDivision(ie,2);xt<ie;xt+=2)Ae.set(Ct.truncDivision(ie,2)-Lt,xt),Ae.set(Ct.truncDivision(ie,2)+Lt,xt),Ae.set(xt,Ct.truncDivision(ie,2)-Lt),Ae.set(xt,Ct.truncDivision(ie,2)+Lt)}let Me=new ho;return Me.setCompact(x),Me.setSize(ie),Me.setLayers(b),Me.setCodeWords(W),Me.setMatrix(Ae),Me}static drawBullsEye(u,l,d){for(let h=0;h<d;h+=2)for(let g=l-h;g<=l+h;g++)u.set(g,l-h),u.set(g,l+h),u.set(l-h,g),u.set(l+h,g);u.set(l-d,l-d),u.set(l-d+1,l-d),u.set(l-d,l-d+1),u.set(l+d,l-d),u.set(l+d,l-d+1),u.set(l+d,l+d-1)}static generateModeMessage(u,l,d){let h=new gt;return u?(h.appendBits(l-1,2),h.appendBits(d-1,6),h=an.generateCheckWords(h,28,4)):(h.appendBits(l-1,5),h.appendBits(d-1,11),h=an.generateCheckWords(h,40,4)),h}static drawModeMessage(u,l,d,h){let g=Ct.truncDivision(d,2);if(l)for(let v=0;v<7;v++){let x=g-3+v;h.get(v)&&u.set(x,g-5),h.get(v+7)&&u.set(g+5,x),h.get(20-v)&&u.set(x,g+5),h.get(27-v)&&u.set(g-5,x)}else for(let v=0;v<10;v++){let x=g-5+v+Ct.truncDivision(v,5);h.get(v)&&u.set(x,g-7),h.get(v+10)&&u.set(g+7,x),h.get(29-v)&&u.set(x,g+7),h.get(39-v)&&u.set(g-7,x)}}static generateCheckWords(u,l,d){let h=u.getSize()/d,g=new js(an.getGF(d)),v=Ct.truncDivision(l,d),x=an.bitsToWords(u,d,v);g.encode(x,v-h);let b=l%d,I=new gt;I.appendBits(0,b);for(const S of Array.from(x))I.appendBits(S,d);return I}static bitsToWords(u,l,d){let g,v,h=new Int32Array(d);for(g=0,v=u.getSize()/l;g<v;g++){let x=0;for(let b=0;b<l;b++)x|=u.get(g*l+b)?1<<l-b-1:0;h[g]=x}return h}static getGF(u){switch(u){case 4:return Pt.AZTEC_PARAM;case 6:return Pt.AZTEC_DATA_6;case 8:return Pt.AZTEC_DATA_8;case 10:return Pt.AZTEC_DATA_10;case 12:return Pt.AZTEC_DATA_12;default:throw new Ye("Unsupported word size "+u)}}static stuffBits(u,l){let d=new gt,h=u.getSize(),g=(1<<l)-2;for(let v=0;v<h;v+=l){let x=0;for(let b=0;b<l;b++)(v+b>=h||u.get(v+b))&&(x|=1<<l-1-b);(x&g)===g?(d.appendBits(x&g,l),v--):0==(x&g)?(d.appendBits(1|x,l),v--):d.appendBits(x,l)}return d}static totalBitsInLayer(u,l){return((l?88:112)+16*u)*u}}an.DEFAULT_EC_PERCENT=33,an.DEFAULT_AZTEC_LAYERS=0,an.MAX_NB_BITS=32,an.MAX_NB_BITS_COMPACT=4,an.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class nf{encode(u,l,d,h){return this.encodeWithHints(u,l,d,h,null)}encodeWithHints(u,l,d,h,g){let v=ef.ISO_8859_1,x=an.DEFAULT_EC_PERCENT,b=an.DEFAULT_AZTEC_LAYERS;return null!=g&&(g.has(tr.CHARACTER_SET)&&(v=Br.forName(g.get(tr.CHARACTER_SET).toString())),g.has(tr.ERROR_CORRECTION)&&(x=Ct.parseInt(g.get(tr.ERROR_CORRECTION).toString())),g.has(tr.AZTEC_LAYERS)&&(b=Ct.parseInt(g.get(tr.AZTEC_LAYERS).toString()))),nf.encodeLayers(u,l,d,h,v,x,b)}static encodeLayers(u,l,d,h,g,v,x){if(l!==it.AZTEC)throw new Ye("Can only encode AZTEC, but got "+l);let b=an.encode(at.getBytes(u,g),v,x);return nf.renderResult(b,d,h)}static renderResult(u,l,d){let h=u.getMatrix();if(null==h)throw new ao;let g=h.getWidth(),v=h.getHeight(),x=Math.max(l,g),b=Math.max(d,v),I=Math.min(x/g,b/v),S=(x-g*I)/2,k=(b-v*I)/2,L=new Gn(x,b);for(let W=0,q=k;W<v;W++,q+=I)for(let Z=0,ne=S;Z<g;Z++,ne+=I)h.get(Z,W)&&L.setRegion(ne,q,I,I);return L}}ve.ArgumentException=oi,ve.ArithmeticException=va,ve.AztecCode=ho,ve.AztecCodeReader=Bs,ve.AztecCodeWriter=nf,ve.AztecDecoder=Ni,ve.AztecDetector=qo,ve.AztecDetectorResult=Oo,ve.AztecEncoder=an,ve.AztecHighLevelEncoder=Dc,ve.AztecPoint=br,ve.BarcodeFormat=it,ve.Binarizer=Ga,ve.BinaryBitmap=Si,ve.BitArray=gt,ve.BitMatrix=Gn,ve.BitSource=eu,ve.BrowserAztecCodeReader=class extends Ro{constructor(u=500){super(new Bs,u)}},ve.BrowserBarcodeReader=class extends Ro{constructor(u=500,l){super(new xa(l),u,l)}},ve.BrowserCodeReader=Ro,ve.BrowserDatamatrixCodeReader=class extends Ro{constructor(u=500){super(new Vs,u)}},ve.BrowserMultiFormatReader=class extends Ro{constructor(u=null,l=500){const d=new nu;d.setHints(u),super(d,l)}decodeBitmap(u){return this.reader.decodeWithState(u)}},ve.BrowserPDF417Reader=class extends Ro{constructor(u=500){super(new jn,u)}},ve.BrowserQRCodeReader=class extends Ro{constructor(u=500){super(new mi,u)}},ve.BrowserQRCodeSvgWriter=Ec,ve.CharacterSetECI=Ee,ve.ChecksumException=Dt,ve.Code128Reader=Te,ve.Code39Reader=Qa,ve.DataMatrixDecodedBitStreamParser=$i,ve.DataMatrixReader=Vs,ve.DecodeHintType=En,ve.DecoderResult=Xo,ve.DefaultGridSampler=Ls,ve.DetectorResult=qr,ve.EAN13Reader=$a,ve.EncodeHintType=tr,ve.Exception=xr,ve.FormatException=Re,ve.GenericGF=Pt,ve.GenericGFPoly=kr,ve.GlobalHistogramBinarizer=Jn,ve.GridSampler=ya,ve.GridSamplerInstance=uo,ve.HTMLCanvasElementLuminanceSource=so,ve.HybridBinarizer=ht,ve.ITFReader=on,ve.IllegalArgumentException=Ye,ve.IllegalStateException=ao,ve.InvertedLuminanceSource=qi,ve.LuminanceSource=No,ve.MathUtils=Vt,ve.MultiFormatOneDReader=xa,ve.MultiFormatReader=nu,ve.MultiFormatWriter=class{encode(u,l,d,h,g){let v;switch(l){case it.QR_CODE:v=new _c;break;default:throw new Ye("No encoder available for format "+l)}return v.encode(u,l,d,h,g)}},ve.NotFoundException=ce,ve.OneDReader=qn,ve.PDF417DecodedBitStreamParser=oe,ve.PDF417DecoderErrorCorrection=te,ve.PDF417Reader=jn,ve.PDF417ResultMetadata=St,ve.PerspectiveTransform=Xn,ve.PlanarYUVLuminanceSource=Ic,ve.QRCodeByteMatrix=Ws,ve.QRCodeDataMask=er,ve.QRCodeDecodedBitStreamParser=tu,ve.QRCodeDecoderErrorCorrectionLevel=Oe,ve.QRCodeDecoderFormatInformation=Qn,ve.QRCodeEncoder=Mn,ve.QRCodeEncoderQRCode=ts,ve.QRCodeMaskUtil=Cr,ve.QRCodeMatrixUtil=Fe,ve.QRCodeMode=ke,ve.QRCodeReader=mi,ve.QRCodeVersion=Ze,ve.QRCodeWriter=_c,ve.RGBLuminanceSource=ns,ve.RSS14Reader=dt,ve.RSSExpandedReader=be,ve.ReaderException=Wn,ve.ReedSolomonDecoder=Ps,ve.ReedSolomonEncoder=js,ve.ReedSolomonException=Fs,ve.Result=fr,ve.ResultMetadataType=Yn,ve.ResultPoint=Ue,ve.StringUtils=at,ve.UnsupportedOperationException=Ms,ve.VideoInputDevice=Ya,ve.WhiteRectangleDetector=ks,ve.WriterException=Ht,ve.ZXingArrays=Vn,ve.ZXingCharset=Br,ve.ZXingInteger=Ct,ve.ZXingStandardCharsets=ef,ve.ZXingStringBuilder=rn,ve.ZXingStringEncoding=vn,ve.ZXingSystem=en,Object.defineProperty(ve,"__esModule",{value:!0})}(oo)},127:(Zn,oo,ve)=>{"use strict";function Yi(n){return"function"==typeof n}let Xi=!1;const lr={Promise:void 0,set useDeprecatedSynchronousErrorHandling(n){if(n){const e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else Xi&&console.log("RxJS: Back to a better error behavior. Thank you. <3");Xi=n},get useDeprecatedSynchronousErrorHandling(){return Xi}};function Ns(n){setTimeout(()=>{throw n},0)}const Ir={closed:!0,next(n){},error(n){if(lr.useDeprecatedSynchronousErrorHandling)throw n;Ns(n)},complete(){}},xr=Array.isArray||(n=>n&&"number"==typeof n.length);function oi(n){return null!==n&&"object"==typeof n}const Si=(()=>{function n(e){return Error.call(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((t,r)=>`${r+1}) ${t.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e,this}return n.prototype=Object.create(Error.prototype),n})();class Dt{constructor(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}unsubscribe(){let e;if(this.closed)return;let{_parentOrParents:t,_ctorUnsubscribe:r,_unsubscribe:i,_subscriptions:o}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,t instanceof Dt)t.remove(this);else if(null!==t)for(let s=0;s<t.length;++s)t[s].remove(this);if(Yi(i)){r&&(this._unsubscribe=void 0);try{i.call(this)}catch(s){e=s instanceof Si?Ga(s.errors):[s]}}if(xr(o)){let s=-1,a=o.length;for(;++s<a;){const c=o[s];if(oi(c))try{c.unsubscribe()}catch(f){e=e||[],f instanceof Si?e=e.concat(Ga(f.errors)):e.push(f)}}}if(e)throw new Si(e)}add(e){let t=e;if(!e)return Dt.EMPTY;switch(typeof e){case"function":t=new Dt(e);case"object":if(t===this||t.closed||"function"!=typeof t.unsubscribe)return t;if(this.closed)return t.unsubscribe(),t;if(!(t instanceof Dt)){const o=t;t=new Dt,t._subscriptions=[o]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}let{_parentOrParents:r}=t;if(null===r)t._parentOrParents=this;else if(r instanceof Dt){if(r===this)return t;t._parentOrParents=[r,this]}else{if(-1!==r.indexOf(this))return t;r.push(this)}const i=this._subscriptions;return null===i?this._subscriptions=[t]:i.push(t),t}remove(e){const t=this._subscriptions;if(t){const r=t.indexOf(e);-1!==r&&t.splice(r,1)}}}var n;function Ga(n){return n.reduce((e,t)=>e.concat(t instanceof Si?t.errors:t),[])}Dt.EMPTY=((n=new Dt).closed=!0,n);const en="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random();class wr extends Dt{constructor(e,t,r){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=Ir;break;case 1:if(!e){this.destination=Ir;break}if("object"==typeof e){e instanceof wr?(this.syncErrorThrowable=e.syncErrorThrowable,this.destination=e,e.add(this)):(this.syncErrorThrowable=!0,this.destination=new Vn(this,e));break}default:this.syncErrorThrowable=!0,this.destination=new Vn(this,e,t,r)}}[en](){return this}static create(e,t,r){const i=new wr(e,t,r);return i.syncErrorThrowable=!1,i}next(e){this.isStopped||this._next(e)}error(e){this.isStopped||(this.isStopped=!0,this._error(e))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(e){this.destination.next(e)}_error(e){this.destination.error(e),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:e}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this}}class Vn extends wr{constructor(e,t,r,i){super(),this._parentSubscriber=e;let o,s=this;Yi(t)?o=t:t&&(o=t.next,r=t.error,i=t.complete,t!==Ir&&(s=Object.create(t),Yi(s.unsubscribe)&&this.add(s.unsubscribe.bind(s)),s.unsubscribe=this.unsubscribe.bind(this))),this._context=s,this._next=o,this._error=r,this._complete=i}next(e){if(!this.isStopped&&this._next){const{_parentSubscriber:t}=this;lr.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}error(e){if(!this.isStopped){const{_parentSubscriber:t}=this,{useDeprecatedSynchronousErrorHandling:r}=lr;if(this._error)r&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)r?(t.syncErrorValue=e,t.syncErrorThrown=!0):Ns(e),this.unsubscribe();else{if(this.unsubscribe(),r)throw e;Ns(e)}}}complete(){if(!this.isStopped){const{_parentSubscriber:e}=this;if(this._complete){const t=()=>this._complete.call(this._context);lr.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,t),this.unsubscribe()):(this.__tryOrUnsub(t),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(e,t){try{e.call(this._context,t)}catch(r){if(this.unsubscribe(),lr.useDeprecatedSynchronousErrorHandling)throw r;Ns(r)}}__tryOrSetError(e,t,r){if(!lr.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,r)}catch(i){return lr.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=i,e.syncErrorThrown=!0,!0):(Ns(i),!0)}return!1}_unsubscribe(){const{_parentSubscriber:e}=this;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}const So="function"==typeof Symbol&&Symbol.observable||"@@observable";function En(n){return n}let Ee=(()=>{class n{constructor(t){this._isScalar=!1,t&&(this._subscribe=t)}lift(t){const r=new n;return r.source=this,r.operator=t,r}subscribe(t,r,i){const{operator:o}=this,s=function(n,e,t){if(n){if(n instanceof wr)return n;if(n[en])return n[en]()}return n||e||t?new wr(n,e,t):new wr(Ir)}(t,r,i);if(s.add(o?o.call(s,this.source):this.source||lr.useDeprecatedSynchronousErrorHandling&&!s.syncErrorThrowable?this._subscribe(s):this._trySubscribe(s)),lr.useDeprecatedSynchronousErrorHandling&&s.syncErrorThrowable&&(s.syncErrorThrowable=!1,s.syncErrorThrown))throw s.syncErrorValue;return s}_trySubscribe(t){try{return this._subscribe(t)}catch(r){lr.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=r),function(n){for(;n;){const{closed:e,destination:t,isStopped:r}=n;if(e||r)return!1;n=t&&t instanceof wr?t:null}return!0}(t)?t.error(r):console.warn(r)}}forEach(t,r){return new(r=Ms(r))((i,o)=>{let s;s=this.subscribe(a=>{try{t(a)}catch(c){o(c),s&&s.unsubscribe()}},o,i)})}_subscribe(t){const{source:r}=this;return r&&r.subscribe(t)}[So](){return this}pipe(...t){return 0===t.length?this:function(n){return 0===n.length?En:1===n.length?n[0]:function(t){return n.reduce((r,i)=>i(r),t)}}(t)(this)}toPromise(t){return new(t=Ms(t))((r,i)=>{let o;this.subscribe(s=>o=s,s=>i(s),()=>r(o))})}}return n.create=e=>new n(e),n})();function Ms(n){if(n||(n=lr.Promise||Promise),!n)throw new Error("no Promise impl found");return n}const at=(()=>{function n(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return n.prototype=Object.create(Error.prototype),n})();class rn extends Dt{constructor(e,t){super(),this.subject=e,this.subscriber=t,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const e=this.subject,t=e.observers;if(this.subject=null,!t||0===t.length||e.isStopped||e.closed)return;const r=t.indexOf(this.subscriber);-1!==r&&t.splice(r,1)}}class Gn extends wr{constructor(e){super(e),this.destination=e}}let ce=(()=>{class n extends Ee{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[en](){return new Gn(this)}lift(t){const r=new Jn(this,this);return r.operator=t,r}next(t){if(this.closed)throw new at;if(!this.isStopped){const{observers:r}=this,i=r.length,o=r.slice();for(let s=0;s<i;s++)o[s].next(t)}}error(t){if(this.closed)throw new at;this.hasError=!0,this.thrownError=t,this.isStopped=!0;const{observers:r}=this,i=r.length,o=r.slice();for(let s=0;s<i;s++)o[s].error(t);this.observers.length=0}complete(){if(this.closed)throw new at;this.isStopped=!0;const{observers:t}=this,r=t.length,i=t.slice();for(let o=0;o<r;o++)i[o].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(t){if(this.closed)throw new at;return super._trySubscribe(t)}_subscribe(t){if(this.closed)throw new at;return this.hasError?(t.error(this.thrownError),Dt.EMPTY):this.isStopped?(t.complete(),Dt.EMPTY):(this.observers.push(t),new rn(this,t))}asObservable(){const t=new Ee;return t.source=this,t}}return n.create=(e,t)=>new Jn(e,t),n})();class Jn extends ce{constructor(e,t){super(),this.destination=e,this.source=t}next(e){const{destination:t}=this;t&&t.next&&t.next(e)}error(e){const{destination:t}=this;t&&t.error&&this.destination.error(e)}complete(){const{destination:e}=this;e&&e.complete&&this.destination.complete()}_subscribe(e){const{source:t}=this;return t?this.source.subscribe(e):Dt.EMPTY}}function ht(n){return n&&"function"==typeof n.schedule}function No(n,e){return function(r){if("function"!=typeof n)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new qi(n,e))}}class qi{constructor(e,t){this.project=e,this.thisArg=t}call(e,t){return t.subscribe(new so(e,this.project,this.thisArg))}}class so extends wr{constructor(e,t,r){super(e),this.project=t,this.count=0,this.thisArg=r||this}_next(e){let t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(r){return void this.destination.error(r)}this.destination.next(t)}}const Ya=n=>e=>{for(let t=0,r=n.length;t<r&&!e.closed;t++)e.next(n[t]);e.complete()},fr="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",Yn=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function Xo(n){return!!n&&"function"!=typeof n.subscribe&&"function"==typeof n.then}const Os=n=>{if(n&&"function"==typeof n[So])return(n=>e=>{const t=n[So]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)})(n);if(Yn(n))return Ya(n);if(Xo(n))return(n=>e=>(n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,Ns),e))(n);if(n&&"function"==typeof n[fr])return(n=>e=>{const t=n[fr]();for(;;){let r;try{r=t.next()}catch(i){return e.error(i),e}if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof t.return&&e.add(()=>{t.return&&t.return()}),e})(n);{const t=`You provided ${oi(n)?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(t)}};function Pt(n,e){return new Ee(t=>{const r=new Dt;let i=0;return r.add(e.schedule(function(){i!==n.length?(t.next(n[i++]),t.closed||r.add(this.schedule())):t.complete()})),r})}function Ni(n,e){return e?function(n,e){if(null!=n){if(function(n){return n&&"function"==typeof n[So]}(n))return function(n,e){return new Ee(t=>{const r=new Dt;return r.add(e.schedule(()=>{const i=n[So]();r.add(i.subscribe({next(o){r.add(e.schedule(()=>t.next(o)))},error(o){r.add(e.schedule(()=>t.error(o)))},complete(){r.add(e.schedule(()=>t.complete()))}}))})),r})}(n,e);if(Xo(n))return function(n,e){return new Ee(t=>{const r=new Dt;return r.add(e.schedule(()=>n.then(i=>{r.add(e.schedule(()=>{t.next(i),r.add(e.schedule(()=>t.complete()))}))},i=>{r.add(e.schedule(()=>t.error(i)))}))),r})}(n,e);if(Yn(n))return Pt(n,e);if(function(n){return n&&"function"==typeof n[fr]}(n)||"string"==typeof n)return function(n,e){if(!n)throw new Error("Iterable cannot be null");return new Ee(t=>{const r=new Dt;let i;return r.add(()=>{i&&"function"==typeof i.return&&i.return()}),r.add(e.schedule(()=>{i=n[fr](),r.add(e.schedule(function(){if(t.closed)return;let o,s;try{const a=i.next();o=a.value,s=a.done}catch(a){return void t.error(a)}s?t.complete():(t.next(o),this.schedule())}))})),r})}(n,e)}throw new TypeError((null!==n&&typeof n||n)+" is not observable")}(n,e):n instanceof Ee?n:new Ee(Os(n))}class Vt extends wr{constructor(e){super(),this.parent=e}_next(e){this.parent.notifyNext(e)}_error(e){this.parent.notifyError(e),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class Ue extends wr{notifyNext(e){this.destination.next(e)}notifyError(e){this.destination.error(e)}notifyComplete(){this.destination.complete()}}function Oo(n,e){if(e.closed)return;if(n instanceof Ee)return n.subscribe(e);let t;try{t=Os(n)(e)}catch(r){e.error(r)}return t}function ks(n,e,t=Number.POSITIVE_INFINITY){return"function"==typeof e?r=>r.pipe(ks((i,o)=>Ni(n(i,o)).pipe(No((s,a)=>e(i,s,o,a))),t)):("number"==typeof e&&(t=e),r=>r.lift(new ya(n,t)))}class ya{constructor(e,t=Number.POSITIVE_INFINITY){this.project=e,this.concurrent=t}call(e,t){return t.subscribe(new Xn(e,this.project,this.concurrent))}}class Xn extends Ue{constructor(e,t,r=Number.POSITIVE_INFINITY){super(e),this.project=t,this.concurrent=r,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}_tryNext(e){let t;const r=this.index++;try{t=this.project(e,r)}catch(i){return void this.destination.error(i)}this.active++,this._innerSub(t)}_innerSub(e){const t=new Vt(this),r=this.destination;r.add(t);const i=Oo(e,t);i!==t&&r.add(i)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(e){this.destination.next(e)}notifyComplete(){const e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function uo(n=Number.POSITIVE_INFINITY){return ks(En,n)}function br(n,e){return e?Pt(n,e):new Ee(Ya(n))}function qo(...n){let e=Number.POSITIVE_INFINITY,t=null,r=n[n.length-1];return ht(r)?(t=n.pop(),n.length>1&&"number"==typeof n[n.length-1]&&(e=n.pop())):"number"==typeof r&&(e=n.pop()),null===t&&1===n.length&&n[0]instanceof Ee?n[0]:uo(e)(br(n,t))}function Bs(){return function(e){return e.lift(new Ka(e))}}class Ka{constructor(e){this.connectable=e}call(e,t){const{connectable:r}=this;r._refCount++;const i=new qn(e,r),o=t.subscribe(i);return i.closed||(i.connection=r.connect()),o}}class qn extends wr{constructor(e,t){super(e),this.connectable=t}_unsubscribe(){const{connectable:e}=this;if(!e)return void(this.connection=null);this.connectable=null;const t=e._refCount;if(t<=0)return void(this.connection=null);if(e._refCount=t-1,t>1)return void(this.connection=null);const{connection:r}=this,i=e._connection;this.connection=null,i&&(!r||i===r)&&i.unsubscribe()}}class Te extends Ee{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._refCount=0,this._isComplete=!1}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}connect(){let e=this._connection;return e||(this._isComplete=!1,e=this._connection=new Dt,e.add(this.source.subscribe(new on(this.getSubject(),this))),e.closed&&(this._connection=null,e=Dt.EMPTY)),e}refCount(){return Bs()(this)}}const Qa=(()=>{const n=Te.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:n._subscribe},_isComplete:{value:n._isComplete,writable:!0},getSubject:{value:n.getSubject},connect:{value:n.connect},refCount:{value:n.refCount}}})();class on extends Gn{constructor(e,t){super(e),this.connectable=t}_error(e){this._unsubscribe(),super._error(e)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const e=this.connectable;if(e){this.connectable=null;const t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}}}function Yt(){return new ce}function Xt(n){for(let e in n)if(n[e]===Xt)return e;throw Error("Could not find renamed property on target object.")}function Za(n,e){for(const t in e)e.hasOwnProperty(t)&&!n.hasOwnProperty(t)&&(n[t]=e[t])}function ut(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(ut).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const e=n.toString();if(null==e)return""+e;const t=e.indexOf("\n");return-1===t?e:e.substring(0,t)}function Ar(n,e){return null==n||""===n?null===e?"":e:null==e||""===e?n:n+" "+e}const Ki=Xt({__forward_ref__:Xt});function co(n){return n.__forward_ref__=co,n.toString=function(){return ut(this())},n}function Le(n){return di(n)?n():n}function di(n){return"function"==typeof n&&n.hasOwnProperty(Ki)&&n.__forward_ref__===co}class Zt extends Error{constructor(e,t){super(function(n,e){return`${n?`NG0${n}: `:""}${e}`}(e,t)),this.code=e}}function nt(n){return"string"==typeof n?n:null==n?"":String(n)}function Un(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():nt(n)}function dr(n,e){const t=e?` in ${e}`:"";throw new Zt("201",`No provider for ${Un(n)} found${t}`)}function $r(n,e){null==n&&function(n,e,t,r){throw new Error(`ASSERTION ERROR: ${n}`+(null==r?"":` [Expected=> ${t} ${r} ${e} <=Actual]`))}(e,n,null,"!=")}function Xe(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Qi(n){return{providers:n.providers||[],imports:n.imports||[]}}function hi(n){return eu(n,Tn)||eu(n,ku)}function eu(n,e){return n.hasOwnProperty(e)?n[e]:null}function Pu(n){return n&&(n.hasOwnProperty(Vs)||n.hasOwnProperty(Jo))?n[Vs]:null}const Tn=Xt({\u0275prov:Xt}),Vs=Xt({\u0275inj:Xt}),ku=Xt({ngInjectableDef:Xt}),Jo=Xt({ngInjectorDef:Xt});var Oe=(()=>((Oe=Oe||{})[Oe.Default=0]="Default",Oe[Oe.Host=1]="Host",Oe[Oe.Self=2]="Self",Oe[Oe.SkipSelf=4]="SkipSelf",Oe[Oe.Optional=8]="Optional",Oe))();let Qn;function j(n){const e=Qn;return Qn=n,e}function Ze(n,e,t){const r=hi(n);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:t&Oe.Optional?null:void 0!==e?e:void dr(ut(n),"Injector")}function er(n){return{toString:n}.toString()}var pi=(()=>((pi=pi||{})[pi.OnPush=0]="OnPush",pi[pi.Default=1]="Default",pi))(),ke=(()=>((ke=ke||{})[ke.Emulated=0]="Emulated",ke[ke.None=2]="None",ke[ke.ShadowDom=3]="ShadowDom",ke))();const tu="undefined"!=typeof globalThis&&globalThis,xc="undefined"!=typeof window&&window,Jl="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,kt=tu||"undefined"!=typeof global&&global||xc||Jl,Us={},qt=[],mi=Xt({\u0275cmp:Xt}),C=Xt({\u0275dir:Xt}),O=Xt({\u0275pipe:Xt}),F=Xt({\u0275mod:Xt}),V=Xt({\u0275loc:Xt}),K=Xt({\u0275fac:Xt}),se=Xt({__NG_ELEMENT_ID__:Xt});let te=0;function ye(n){return er(()=>{const t={},r={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:t,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===pi.OnPush,directiveDefs:null,pipeDefs:null,selectors:n.selectors||qt,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||ke.Emulated,id:"c",styles:n.styles||qt,_:null,setInput:null,schemas:n.schemas||null,tView:null},i=n.directives,o=n.features,s=n.pipes;return r.id+=te++,r.inputs=yt(n.inputs,t),r.outputs=yt(n.outputs),o&&o.forEach(a=>a(r)),r.directiveDefs=i?()=>("function"==typeof i?i():i).map(Ne):null,r.pipeDefs=s?()=>("function"==typeof s?s():s).map(st):null,r})}function Ne(n){return Et(n)||function(n){return n[C]||null}(n)}function st(n){return function(n){return n[O]||null}(n)}const vt={};function ct(n){return er(()=>{const e={type:n.type,bootstrap:n.bootstrap||qt,declarations:n.declarations||qt,imports:n.imports||qt,exports:n.exports||qt,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null};return null!=n.id&&(vt[n.id]=n.type),e})}function yt(n,e){if(null==n)return Us;const t={};for(const r in n)if(n.hasOwnProperty(r)){let i=n[r],o=i;Array.isArray(i)&&(o=i[1],i=i[0]),t[i]=r,e&&(e[i]=o)}return t}const Je=ye;function St(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,onDestroy:n.type.prototype.ngOnDestroy||null}}function Et(n){return n[mi]||null}function _n(n,e){const t=n[F]||null;if(!t&&!0===e)throw new Error(`Type ${ut(n)} does not have '\u0275mod' property.`);return t}function ho(n){return Array.isArray(n)&&"object"==typeof n[1]}function Zi(n){return Array.isArray(n)&&!0===n[1]}function tf(n){return 0!=(8&n.flags)}function rs(n){return 2==(2&n.flags)}function iu(n){return 1==(1&n.flags)}function po(n){return null!==n.template}function Vu(n){return 0!=(512&n[2])}function v(n,e){return n.hasOwnProperty(K)?n[K]:null}class x{constructor(e,t,r){this.previousValue=e,this.currentValue=t,this.firstChange=r}isFirstChange(){return this.firstChange}}function b(){return I}function I(n){return n.type.prototype.ngOnChanges&&(n.setInput=k),S}function S(){const n=W(this),e=null==n?void 0:n.current;if(e){const t=n.previous;if(t===Us)n.previous=e;else for(let r in e)t[r]=e[r];n.current=null,this.ngOnChanges(e)}}function k(n,e,t,r){const i=W(n)||function(n,e){return n[L]=e}(n,{previous:Us,current:null}),o=i.current||(i.current={}),s=i.previous,a=this.declaredInputs[t],c=s[a];o[a]=new x(c&&c.currentValue,e,s===Us),n[r]=e}b.ngInherit=!0;const L="__ngSimpleChanges__";function W(n){return n[L]||null}let de;function un(n){return!!n.listen}const bn={createRenderer:(n,e)=>void 0!==de?de:"undefined"!=typeof document?document:void 0};function cn(n){for(;Array.isArray(n);)n=n[0];return n}function Tc(n,e){return cn(e[n])}function Ji(n,e){return cn(e[n.index])}function N0(n,e){return n.data[e]}function Sc(n,e){return n[e]}function mo(n,e){const t=e[n];return ho(t)?t:t[0]}function cx(n){return 4==(4&n[2])}function R0(n){return 128==(128&n[2])}function su(n,e){return null==e?null:n[e]}function lx(n){n[18]=0}function M0(n,e){n[5]+=e;let t=n,r=n[3];for(;null!==r&&(1===e&&1===t[5]||-1===e&&0===t[5]);)r[5]+=e,t=r,r=r[3]}const wt={lFrame:yx(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function fx(){return wt.bindingsEnabled}function _e(){return wt.lFrame.lView}function ln(){return wt.lFrame.tView}function vi(n){return wt.lFrame.contextLView=n,n[8]}function Ur(){let n=dx();for(;null!==n&&64===n.type;)n=n.parent;return n}function dx(){return wt.lFrame.currentTNode}function zs(n,e){const t=wt.lFrame;t.currentTNode=n,t.isParent=e}function O0(){return wt.lFrame.isParent}function F0(){wt.lFrame.isParent=!1}function Yd(){return wt.isInCheckNoChangesMode}function Xd(n){wt.isInCheckNoChangesMode=n}function Nc(){return wt.lFrame.bindingIndex++}function XS(n,e){const t=wt.lFrame;t.bindingIndex=t.bindingRootIndex=n,P0(e)}function P0(n){wt.lFrame.currentDirectiveIndex=n}function gx(){return wt.lFrame.currentQueryIndex}function L0(n){wt.lFrame.currentQueryIndex=n}function KS(n){const e=n[1];return 2===e.type?e.declTNode:1===e.type?n[6]:null}function mx(n,e,t){if(t&Oe.SkipSelf){let i=e,o=n;for(;!(i=i.parent,null!==i||t&Oe.Host||(i=KS(o),null===i||(o=o[15],10&i.type))););if(null===i)return!1;e=i,n=o}const r=wt.lFrame=vx();return r.currentTNode=e,r.lView=n,!0}function qd(n){const e=vx(),t=n[1];wt.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function vx(){const n=wt.lFrame,e=null===n?null:n.child;return null===e?yx(n):e}function yx(n){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=e),e}function xx(){const n=wt.lFrame;return wt.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const wx=xx;function Kd(){const n=xx();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function Li(){return wt.lFrame.selectedIndex}function au(n){wt.lFrame.selectedIndex=n}function Qd(n,e){for(let t=e.directiveStart,r=e.directiveEnd;t<r;t++){const o=n.data[t].type.prototype,{ngAfterContentInit:s,ngAfterContentChecked:a,ngAfterViewInit:c,ngAfterViewChecked:f,ngOnDestroy:p}=o;s&&(n.contentHooks||(n.contentHooks=[])).push(-t,s),a&&((n.contentHooks||(n.contentHooks=[])).push(t,a),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(t,a)),c&&(n.viewHooks||(n.viewHooks=[])).push(-t,c),f&&((n.viewHooks||(n.viewHooks=[])).push(t,f),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(t,f)),null!=p&&(n.destroyHooks||(n.destroyHooks=[])).push(t,p)}}function $d(n,e,t){bx(n,e,3,t)}function Zd(n,e,t,r){(3&n[2])===t&&bx(n,e,t,r)}function B0(n,e){let t=n[2];(3&t)===e&&(t&=2047,t+=1,n[2]=t)}function bx(n,e,t,r){const o=null!=r?r:-1,s=e.length-1;let a=0;for(let c=void 0!==r?65535&n[18]:0;c<s;c++)if("number"==typeof e[c+1]){if(a=e[c],null!=r&&a>=r)break}else e[c]<0&&(n[18]+=65536),(a<o||-1==o)&&(i3(n,t,e,c),n[18]=(4294901760&n[18])+c+2),c++}function i3(n,e,t,r){const i=t[r]<0,o=t[r+1],a=n[i?-t[r]:t[r]];if(i){if(n[2]>>11<n[18]>>16&&(3&n[2])===e){n[2]+=2048;try{o.call(a)}finally{}}}else try{o.call(a)}finally{}}class of{constructor(e,t,r){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=r}}function Jd(n,e,t){const r=un(n);let i=0;for(;i<t.length;){const o=t[i];if("number"==typeof o){if(0!==o)break;i++;const s=t[i++],a=t[i++],c=t[i++];r?n.setAttribute(e,a,c,s):e.setAttributeNS(s,a,c)}else{const s=o,a=t[++i];U0(s)?r&&n.setProperty(e,s,a):r?n.setAttribute(e,s,a):e.setAttribute(s,a),i++}}return i}function Cx(n){return 3===n||4===n||6===n}function U0(n){return 64===n.charCodeAt(0)}function eh(n,e){if(null!==e&&0!==e.length)if(null===n||0===n.length)n=e.slice();else{let t=-1;for(let r=0;r<e.length;r++){const i=e[r];"number"==typeof i?t=i:0===t||Ex(n,t,i,null,-1===t||2===t?e[++r]:null)}}return n}function Ex(n,e,t,r,i){let o=0,s=n.length;if(-1===e)s=-1;else for(;o<n.length;){const a=n[o++];if("number"==typeof a){if(a===e){s=-1;break}if(a>e){s=o-1;break}}}for(;o<n.length;){const a=n[o];if("number"==typeof a)break;if(a===t){if(null===r)return void(null!==i&&(n[o+1]=i));if(r===n[o+1])return void(n[o+2]=i)}o++,null!==r&&o++,null!==i&&o++}-1!==s&&(n.splice(s,0,e),o=s+1),n.splice(o++,0,t),null!==r&&n.splice(o++,0,r),null!==i&&n.splice(o++,0,i)}function _x(n){return-1!==n}function Rc(n){return 32767&n}function Mc(n,e){let t=function(n){return n>>16}(n),r=e;for(;t>0;)r=r[15],t--;return r}let j0=!0;function th(n){const e=j0;return j0=n,e}let l3=0;function af(n,e){const t=H0(n,e);if(-1!==t)return t;const r=e[1];r.firstCreatePass&&(n.injectorIndex=e.length,W0(r.data,n),W0(e,null),W0(r.blueprint,null));const i=nh(n,e),o=n.injectorIndex;if(_x(i)){const s=Rc(i),a=Mc(i,e),c=a[1].data;for(let f=0;f<8;f++)e[o+f]=a[s+f]|c[s+f]}return e[o+8]=i,o}function W0(n,e){n.push(0,0,0,0,0,0,0,0,e)}function H0(n,e){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===e[n.injectorIndex+8]?-1:n.injectorIndex}function nh(n,e){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let t=0,r=null,i=e;for(;null!==i;){const o=i[1],s=o.type;if(r=2===s?o.declTNode:1===s?i[6]:null,null===r)return-1;if(t++,i=i[15],-1!==r.injectorIndex)return r.injectorIndex|t<<16}return-1}function rh(n,e,t){!function(n,e,t){let r;"string"==typeof t?r=t.charCodeAt(0)||0:t.hasOwnProperty(se)&&(r=t[se]),null==r&&(r=t[se]=l3++);const i=255&r;e.data[n+(i>>5)]|=1<<i}(n,e,t)}function Dx(n,e,t){if(t&Oe.Optional)return n;dr(e,"NodeInjector")}function Tx(n,e,t,r){if(t&Oe.Optional&&void 0===r&&(r=null),0==(t&(Oe.Self|Oe.Host))){const i=n[9],o=j(void 0);try{return i?i.get(e,r,t&Oe.Optional):Ze(e,r,t&Oe.Optional)}finally{j(o)}}return Dx(r,e,t)}function Sx(n,e,t,r=Oe.Default,i){if(null!==n){const o=function(n){if("string"==typeof n)return n.charCodeAt(0)||0;const e=n.hasOwnProperty(se)?n[se]:void 0;return"number"==typeof e?e>=0?255&e:h3:e}(t);if("function"==typeof o){if(!mx(e,n,r))return r&Oe.Host?Dx(i,t,r):Tx(e,t,r,i);try{const s=o(r);if(null!=s||r&Oe.Optional)return s;dr(t)}finally{wx()}}else if("number"==typeof o){let s=null,a=H0(n,e),c=-1,f=r&Oe.Host?e[16][6]:null;for((-1===a||r&Oe.SkipSelf)&&(c=-1===a?nh(n,e):e[a+8],-1!==c&&Mx(r,!1)?(s=e[1],a=Rc(c),e=Mc(c,e)):a=-1);-1!==a;){const p=e[1];if(Rx(o,a,p.data)){const m=p3(a,e,t,s,r,f);if(m!==Nx)return m}c=e[a+8],-1!==c&&Mx(r,e[1].data[a+8]===f)&&Rx(o,a,e)?(s=p,a=Rc(c),e=Mc(c,e)):a=-1}}}return Tx(e,t,r,i)}const Nx={};function h3(){return new Oc(Ur(),_e())}function p3(n,e,t,r,i,o){const s=e[1],a=s.data[n+8],p=ih(a,s,t,null==r?rs(a)&&j0:r!=s&&0!=(3&a.type),i&Oe.Host&&o===a);return null!==p?uf(e,s,p,a):Nx}function ih(n,e,t,r,i){const o=n.providerIndexes,s=e.data,a=1048575&o,c=n.directiveStart,p=o>>20,y=i?a+p:n.directiveEnd;for(let w=r?a:a+p;w<y;w++){const E=s[w];if(w<c&&t===E||w>=c&&E.type===t)return w}if(i){const w=s[c];if(w&&po(w)&&w.type===t)return c}return null}function uf(n,e,t,r){let i=n[t];const o=e.data;if(function(n){return n instanceof of}(i)){const s=i;s.resolving&&function(n,e){throw new Zt("200",`Circular dependency in DI detected for ${n}`)}(Un(o[t]));const a=th(s.canSeeViewProviders);s.resolving=!0;const c=s.injectImpl?j(s.injectImpl):null;mx(n,r,Oe.Default);try{i=n[t]=s.factory(void 0,o,n,r),e.firstCreatePass&&t>=r.directiveStart&&function(n,e,t){const{ngOnChanges:r,ngOnInit:i,ngDoCheck:o}=e.type.prototype;if(r){const s=I(e);(t.preOrderHooks||(t.preOrderHooks=[])).push(n,s),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,s)}i&&(t.preOrderHooks||(t.preOrderHooks=[])).push(0-n,i),o&&((t.preOrderHooks||(t.preOrderHooks=[])).push(n,o),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,o))}(t,o[t],e)}finally{null!==c&&j(c),th(a),s.resolving=!1,wx()}}return i}function Rx(n,e,t){return!!(t[e+(n>>5)]&1<<n)}function Mx(n,e){return!(n&Oe.Self||n&Oe.Host&&e)}class Oc{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,r){return Sx(this._tNode,this._lView,e,r,t)}}function z0(n){return er(()=>{const e=n.prototype.constructor,t=e[K]||G0(e),r=Object.prototype;let i=Object.getPrototypeOf(n.prototype).constructor;for(;i&&i!==r;){const o=i[K]||G0(i);if(o&&o!==t)return o;i=Object.getPrototypeOf(i)}return o=>new o})}function G0(n){return di(n)?()=>{const e=G0(Le(n));return e&&e()}:v(n)}const Pc="__parameters__";function ju(n,e,t){return er(()=>{const r=function(n){return function(...t){if(n){const r=n(...t);for(const i in r)this[i]=r[i]}}}(e);function i(...o){if(this instanceof i)return r.apply(this,o),this;const s=new i(...o);return a.annotation=s,a;function a(c,f,p){const m=c.hasOwnProperty(Pc)?c[Pc]:Object.defineProperty(c,Pc,{value:[]})[Pc];for(;m.length<=p;)m.push(null);return(m[p]=m[p]||[]).push(s),c}}return t&&(i.prototype=Object.create(t.prototype)),i.prototype.ngMetadataName=n,i.annotationCls=i,i})}class Nn{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Xe({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}toString(){return`InjectionToken ${this._desc}`}}function Fo(n,e){void 0===e&&(e=n);for(let t=0;t<n.length;t++){let r=n[t];Array.isArray(r)?(e===n&&(e=n.slice(0,t)),Fo(r,e)):e!==n&&e.push(r)}return e}function Ys(n,e){n.forEach(t=>Array.isArray(t)?Ys(t,e):e(t))}function sh(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function Wu(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}function vo(n,e,t){let r=Lc(n,e);return r>=0?n[1|r]=t:(r=~r,function(n,e,t,r){let i=n.length;if(i==e)n.push(t,r);else if(1===i)n.push(r,n[0]),n[0]=t;else{for(i--,n.push(n[i-1],n[i]);i>e;)n[i]=n[i-2],i--;n[e]=t,n[e+1]=r}}(n,r,e,t)),r}function K0(n,e){const t=Lc(n,e);if(t>=0)return n[1|t]}function Lc(n,e){return function(n,e,t){let r=0,i=n.length>>t;for(;i!==r;){const o=r+(i-r>>1),s=n[o<<t];if(e===s)return o<<t;s>e?i=o:r=o+1}return~(i<<t)}(n,e,1)}const df={},$0="__NG_DI_FLAG__",Bc="ngTempTokenPath",D3=/\n/gm,Z0="__source",J0=Xt({provide:String,useValue:Xt});let hf;function Vc(n){const e=hf;return hf=n,e}function S3(n,e=Oe.Default){if(void 0===hf)throw new Error("inject() must be called from an injection context");return null===hf?Ze(n,void 0,e):hf.get(n,e&Oe.Optional?null:void 0,e)}function Kt(n,e=Oe.Default){return(Qn||S3)(Le(n),e)}function Hu(n){const e=[];for(let t=0;t<n.length;t++){const r=Le(n[t]);if(Array.isArray(r)){if(0===r.length)throw new Error("Arguments array must have arguments.");let i,o=Oe.Default;for(let s=0;s<r.length;s++){const a=r[s],c=N3(a);"number"==typeof c?-1===c?i=a.token:o|=c:i=a}e.push(Kt(i,o))}else e.push(Kt(r))}return e}function pf(n,e){return n[$0]=e,n.prototype[$0]=e,n}function N3(n){return n[$0]}function Bx(n,e,t,r){const i=n[Bc];throw e[Z0]&&i.unshift(e[Z0]),n.message=function(n,e,t,r=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.substr(2):n;let i=ut(e);if(Array.isArray(e))i=e.map(ut).join(" -> ");else if("object"==typeof e){let o=[];for(let s in e)if(e.hasOwnProperty(s)){let a=e[s];o.push(s+":"+("string"==typeof a?JSON.stringify(a):ut(a)))}i=`{${o.join(", ")}}`}return`${t}${r?"("+r+")":""}[${i}]: ${n.replace(D3,"\n  ")}`}("\n"+n.message,i,t,r),n.ngTokenPath=i,n[Bc]=null,n}const gf=pf(ju("Inject",n=>({token:n})),-1),Xs=pf(ju("Optional"),8),zu=pf(ju("SkipSelf"),4);const i2="__ngContext__";function yi(n,e){n[i2]=e}function ug(n){const e=function(n){return n[i2]||null}(n);return e?Array.isArray(e)?e:e.lView:null}function hh(n){return n.ngOriginalError}function EN(n,...e){n.error(...e)}class Yu{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e),r=this._findContext(e),i=function(n){return n&&n.ngErrorLogger||EN}(e);i(this._console,"ERROR",e),t&&i(this._console,"ORIGINAL ERROR",t),r&&i(this._console,"ERROR CONTEXT",r)}_findContext(e){return e?function(n){return n.ngDebugContext}(e)||this._findContext(hh(e)):null}_findOriginalError(e){let t=e&&hh(e);for(;t&&hh(t);)t=hh(t);return t||null}}const h2=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(kt))();function Qs(n){return n instanceof Function?n():n}var xo=(()=>((xo=xo||{})[xo.Important=1]="Important",xo[xo.DashCase=2]="DashCase",xo))();function fg(n,e){return undefined(n,e)}function bf(n){const e=n[3];return Zi(e)?e[3]:e}function dg(n){return y2(n[13])}function hg(n){return y2(n[4])}function y2(n){for(;null!==n&&!Zi(n);)n=n[4];return n}function Hc(n,e,t,r,i){if(null!=r){let o,s=!1;Zi(r)?o=r:ho(r)&&(s=!0,r=r[0]);const a=cn(r);0===n&&null!==t?null==i?_2(e,t,a):Xu(e,t,a,i||null,!0):1===n&&null!==t?Xu(e,t,a,i||null,!0):2===n?function(n,e,t){const r=gh(n,e);r&&function(n,e,t,r){un(n)?n.removeChild(e,t,r):e.removeChild(t)}(n,r,e,t)}(e,a,s):3===n&&e.destroyNode(a),null!=o&&function(n,e,t,r,i){const o=t[7];o!==cn(t)&&Hc(e,n,r,o,i);for(let a=10;a<t.length;a++){const c=t[a];Cf(c[1],c,n,e,r,o)}}(e,n,o,t,i)}}function gg(n,e,t){return un(n)?n.createElement(e,t):null===t?n.createElement(e):n.createElementNS(t,e)}function w2(n,e){const t=n[9],r=t.indexOf(e),i=e[3];1024&e[2]&&(e[2]&=-1025,M0(i,-1)),t.splice(r,1)}function mg(n,e){if(n.length<=10)return;const t=10+e,r=n[t];if(r){const i=r[17];null!==i&&i!==n&&w2(i,r),e>0&&(n[t-1][4]=r[4]);const o=Wu(n,10+e);!function(n,e){Cf(n,e,e[11],2,null,null),e[0]=null,e[6]=null}(r[1],r);const s=o[19];null!==s&&s.detachView(o[1]),r[3]=null,r[4]=null,r[2]&=-129}return r}function b2(n,e){if(!(256&e[2])){const t=e[11];un(t)&&t.destroyNode&&Cf(n,e,t,3,null,null),function(n){let e=n[13];if(!e)return vg(n[1],n);for(;e;){let t=null;if(ho(e))t=e[13];else{const r=e[10];r&&(t=r)}if(!t){for(;e&&!e[4]&&e!==n;)ho(e)&&vg(e[1],e),e=e[3];null===e&&(e=n),ho(e)&&vg(e[1],e),t=e&&e[4]}e=t}}(e)}}function vg(n,e){if(!(256&e[2])){e[2]&=-129,e[2]|=256,function(n,e){let t;if(null!=n&&null!=(t=n.destroyHooks))for(let r=0;r<t.length;r+=2){const i=e[t[r]];if(!(i instanceof of)){const o=t[r+1];if(Array.isArray(o))for(let s=0;s<o.length;s+=2){const a=i[o[s]],c=o[s+1];try{c.call(a)}finally{}}else try{o.call(i)}finally{}}}}(n,e),function(n,e){const t=n.cleanup,r=e[7];let i=-1;if(null!==t)for(let o=0;o<t.length-1;o+=2)if("string"==typeof t[o]){const s=t[o+1],a="function"==typeof s?s(e):cn(e[s]),c=r[i=t[o+2]],f=t[o+3];"boolean"==typeof f?a.removeEventListener(t[o],c,f):f>=0?r[i=f]():r[i=-f].unsubscribe(),o+=2}else{const s=r[i=t[o+1]];t[o].call(s)}if(null!==r){for(let o=i+1;o<r.length;o++)r[o]();e[7]=null}}(n,e),1===e[1].type&&un(e[11])&&e[11].destroy();const t=e[17];if(null!==t&&Zi(e[3])){t!==e[3]&&w2(t,e);const r=e[19];null!==r&&r.detachView(n)}}}function C2(n,e,t){return function(n,e,t){let r=e;for(;null!==r&&40&r.type;)r=(e=r).parent;if(null===r)return t[0];if(2&r.flags){const i=n.data[r.directiveStart].encapsulation;if(i===ke.None||i===ke.Emulated)return null}return Ji(r,t)}(n,e.parent,t)}function Xu(n,e,t,r,i){un(n)?n.insertBefore(e,t,r,i):e.insertBefore(t,r,i)}function _2(n,e,t){un(n)?n.appendChild(e,t):e.appendChild(t)}function I2(n,e,t,r,i){null!==r?Xu(n,e,t,r,i):_2(n,e,t)}function gh(n,e){return un(n)?n.parentNode(e):e.parentNode}let T2=function(n,e,t){return 40&n.type?Ji(n,t):null};function mh(n,e,t,r){const i=C2(n,r,e),o=e[11],a=function(n,e,t){return T2(n,e,t)}(r.parent||e[6],r,e);if(null!=i)if(Array.isArray(t))for(let c=0;c<t.length;c++)I2(o,i,t[c],a,!1);else I2(o,i,t,a,!1)}function vh(n,e){if(null!==e){const t=e.type;if(3&t)return Ji(e,n);if(4&t)return xg(-1,n[e.index]);if(8&t){const r=e.child;if(null!==r)return vh(n,r);{const i=n[e.index];return Zi(i)?xg(-1,i):cn(i)}}if(32&t)return fg(e,n)()||cn(n[e.index]);{const r=N2(n,e);return null!==r?Array.isArray(r)?r[0]:vh(bf(n[16]),r):vh(n,e.next)}}return null}function N2(n,e){return null!==e?n[16][6].projection[e.projection]:null}function xg(n,e){const t=10+n+1;if(t<e.length){const r=e[t],i=r[1].firstChild;if(null!==i)return vh(r,i)}return e[7]}function wg(n,e,t,r,i,o,s){for(;null!=t;){const a=r[t.index],c=t.type;if(s&&0===e&&(a&&yi(cn(a),r),t.flags|=4),64!=(64&t.flags))if(8&c)wg(n,e,t.child,r,i,o,!1),Hc(e,n,i,a,o);else if(32&c){const f=fg(t,r);let p;for(;p=f();)Hc(e,n,i,p,o);Hc(e,n,i,a,o)}else 16&c?M2(n,e,r,t,i,o):Hc(e,n,i,a,o);t=s?t.projectionNext:t.next}}function Cf(n,e,t,r,i,o){wg(t,r,n.firstChild,e,i,o,!1)}function M2(n,e,t,r,i,o){const s=t[16],c=s[6].projection[r.projection];if(Array.isArray(c))for(let f=0;f<c.length;f++)Hc(e,n,i,c[f],o);else wg(n,e,c,s[3],i,o,!0)}function O2(n,e,t){un(n)?n.setAttribute(e,"style",t):e.style.cssText=t}function bg(n,e,t){un(n)?""===t?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t):e.className=t}function F2(n,e,t){let r=n.length;for(;;){const i=n.indexOf(e,t);if(-1===i)return i;if(0===i||n.charCodeAt(i-1)<=32){const o=e.length;if(i+o===r||n.charCodeAt(i+o)<=32)return i}t=i+1}}const P2="ng-template";function KN(n,e,t){let r=0;for(;r<n.length;){let i=n[r++];if(t&&"class"===i){if(i=n[r],-1!==F2(i.toLowerCase(),e,0))return!0}else if(1===i){for(;r<n.length&&"string"==typeof(i=n[r++]);)if(i.toLowerCase()===e)return!0;return!1}}return!1}function k2(n){return 4===n.type&&n.value!==P2}function QN(n,e,t){return e===(4!==n.type||t?n.value:P2)}function $N(n,e,t){let r=4;const i=n.attrs||[],o=function(n){for(let e=0;e<n.length;e++)if(Cx(n[e]))return e;return n.length}(i);let s=!1;for(let a=0;a<e.length;a++){const c=e[a];if("number"!=typeof c){if(!s)if(4&r){if(r=2|1&r,""!==c&&!QN(n,c,t)||""===c&&1===e.length){if(ss(r))return!1;s=!0}}else{const f=8&r?c:e[++a];if(8&r&&null!==n.attrs){if(!KN(n.attrs,f,t)){if(ss(r))return!1;s=!0}continue}const m=ZN(8&r?"class":c,i,k2(n),t);if(-1===m){if(ss(r))return!1;s=!0;continue}if(""!==f){let y;y=m>o?"":i[m+1].toLowerCase();const w=8&r?y:null;if(w&&-1!==F2(w,f,0)||2&r&&f!==y){if(ss(r))return!1;s=!0}}}}else{if(!s&&!ss(r)&&!ss(c))return!1;if(s&&ss(c))continue;s=!1,r=c|1&r}}return ss(r)||s}function ss(n){return 0==(1&n)}function ZN(n,e,t,r){if(null===e)return-1;let i=0;if(r||!t){let o=!1;for(;i<e.length;){const s=e[i];if(s===n)return i;if(3===s||6===s)o=!0;else{if(1===s||2===s){let a=e[++i];for(;"string"==typeof a;)a=e[++i];continue}if(4===s)break;if(0===s){i+=4;continue}}i+=o?1:2}return-1}return function(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){const r=n[t];if("number"==typeof r)return-1;if(r===e)return t;t++}return-1}(e,n)}function L2(n,e,t=!1){for(let r=0;r<e.length;r++)if($N(n,e[r],t))return!0;return!1}function B2(n,e){return n?":not("+e.trim()+")":e}function rR(n){let e=n[0],t=1,r=2,i="",o=!1;for(;t<n.length;){let s=n[t];if("string"==typeof s)if(2&r){const a=n[++t];i+="["+s+(a.length>0?'="'+a+'"':"")+"]"}else 8&r?i+="."+s:4&r&&(i+=" "+s);else""!==i&&!ss(s)&&(e+=B2(o,i),i=""),r=s,o=o||!ss(r);t++}return""!==i&&(e+=B2(o,i)),e}const _t={};function Hn(n){V2(ln(),_e(),Li()+n,Yd())}function V2(n,e,t,r){if(!r)if(3==(3&e[2])){const o=n.preOrderCheckHooks;null!==o&&$d(e,o,t)}else{const o=n.preOrderHooks;null!==o&&Zd(e,o,0,t)}au(t)}function yh(n,e){return n<<17|e<<2}function as(n){return n>>17&32767}function Cg(n){return 2|n}function ba(n){return(131068&n)>>2}function Eg(n,e){return-131069&n|e<<2}function _g(n){return 1|n}function K2(n,e){const t=n.contentQueries;if(null!==t)for(let r=0;r<t.length;r+=2){const i=t[r],o=t[r+1];if(-1!==o){const s=n.data[o];L0(i),s.contentQueries(2,e[o],o)}}}function Ef(n,e,t,r,i,o,s,a,c,f){const p=e.blueprint.slice();return p[0]=i,p[2]=140|r,lx(p),p[3]=p[15]=n,p[8]=t,p[10]=s||n&&n[10],p[11]=a||n&&n[11],p[12]=c||n&&n[12]||null,p[9]=f||n&&n[9]||null,p[6]=o,p[16]=2==e.type?n[16]:p,p}function zc(n,e,t,r,i){let o=n.data[e];if(null===o)o=function(n,e,t,r,i){const o=dx(),s=O0(),c=n.data[e]=function(n,e,t,r,i,o){return{type:t,index:r,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:i,attrs:o,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,s?o:o&&o.parent,t,e,r,i);return null===n.firstChild&&(n.firstChild=c),null!==o&&(s?null==o.child&&null!==c.parent&&(o.child=c):null===o.next&&(o.next=c)),c}(n,e,t,r,i),wt.lFrame.inI18n&&(o.flags|=64);else if(64&o.type){o.type=t,o.value=r,o.attrs=i;const s=function(){const n=wt.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}();o.injectorIndex=null===s?-1:s.injectorIndex}return zs(o,!0),o}function Gc(n,e,t,r){if(0===t)return-1;const i=e.length;for(let o=0;o<t;o++)e.push(r),n.blueprint.push(r),n.data.push(null);return i}function _f(n,e,t){qd(e);try{const r=n.viewQuery;null!==r&&Ug(1,r,t);const i=n.template;null!==i&&Q2(n,e,i,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&K2(n,e),n.staticViewQueries&&Ug(2,n.viewQuery,t);const o=n.components;null!==o&&function(n,e){for(let t=0;t<e.length;t++)kR(n,e[t])}(e,o)}catch(r){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),r}finally{e[2]&=-5,Kd()}}function Yc(n,e,t,r){const i=e[2];if(256==(256&i))return;qd(e);const o=Yd();try{lx(e),function(n){wt.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==t&&Q2(n,e,t,2,r);const s=3==(3&i);if(!o)if(s){const f=n.preOrderCheckHooks;null!==f&&$d(e,f,null)}else{const f=n.preOrderHooks;null!==f&&Zd(e,f,0,null),B0(e,0)}if(function(n){for(let e=dg(n);null!==e;e=hg(e)){if(!e[2])continue;const t=e[9];for(let r=0;r<t.length;r++){const i=t[r],o=i[3];0==(1024&i[2])&&M0(o,1),i[2]|=1024}}}(e),function(n){for(let e=dg(n);null!==e;e=hg(e))for(let t=10;t<e.length;t++){const r=e[t],i=r[1];R0(r)&&Yc(i,r,i.template,r[8])}}(e),null!==n.contentQueries&&K2(n,e),!o)if(s){const f=n.contentCheckHooks;null!==f&&$d(e,f)}else{const f=n.contentHooks;null!==f&&Zd(e,f,1),B0(e,1)}!function(n,e){const t=n.hostBindingOpCodes;if(null!==t)try{for(let r=0;r<t.length;r++){const i=t[r];if(i<0)au(~i);else{const o=i,s=t[++r],a=t[++r];XS(s,o),a(2,e[o])}}}finally{au(-1)}}(n,e);const a=n.components;null!==a&&function(n,e){for(let t=0;t<e.length;t++)PR(n,e[t])}(e,a);const c=n.viewQuery;if(null!==c&&Ug(2,c,r),!o)if(s){const f=n.viewCheckHooks;null!==f&&$d(e,f)}else{const f=n.viewHooks;null!==f&&Zd(e,f,2),B0(e,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),o||(e[2]&=-73),1024&e[2]&&(e[2]&=-1025,M0(e[3],-1))}finally{Kd()}}function mR(n,e,t,r){const i=e[10],o=!Yd(),s=cx(e);try{o&&!s&&i.begin&&i.begin(),s&&_f(n,e,r),Yc(n,e,t,r)}finally{o&&!s&&i.end&&i.end()}}function Q2(n,e,t,r,i){const o=Li(),s=2&r;try{au(-1),s&&e.length>20&&V2(n,e,20,Yd()),t(r,i)}finally{au(o)}}function $2(n,e,t){if(tf(e)){const i=e.directiveEnd;for(let o=e.directiveStart;o<i;o++){const s=n.data[o];s.contentQueries&&s.contentQueries(1,t[o],o)}}}function Mg(n,e,t){!fx()||(function(n,e,t,r){const i=t.directiveStart,o=t.directiveEnd;n.firstCreatePass||af(t,e),yi(r,e);const s=t.initialInputs;for(let a=i;a<o;a++){const c=n.data[a],f=po(c);f&&NR(e,t,c);const p=uf(e,n,a,t);yi(p,e),null!==s&&RR(0,a-i,p,c,0,s),f&&(mo(t.index,e)[8]=p)}}(n,e,t,Ji(t,e)),128==(128&t.flags)&&function(n,e,t){const r=t.directiveStart,i=t.directiveEnd,s=t.index,a=wt.lFrame.currentDirectiveIndex;try{au(s);for(let c=r;c<i;c++){const f=n.data[c],p=e[c];P0(c),(null!==f.hostBindings||0!==f.hostVars||null!==f.hostAttrs)&&ow(f,p)}}finally{au(-1),P0(a)}}(n,e,t))}function Og(n,e,t=Ji){const r=e.localNames;if(null!==r){let i=e.index+1;for(let o=0;o<r.length;o+=2){const s=r[o+1],a=-1===s?t(e,n):n[s];n[i++]=a}}}function Z2(n){const e=n.tView;return null===e||e.incompleteFirstPass?n.tView=bh(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):e}function bh(n,e,t,r,i,o,s,a,c,f){const p=20+r,m=p+i,y=function(n,e){const t=[];for(let r=0;r<e;r++)t.push(r<n?null:_t);return t}(p,m),w="function"==typeof f?f():f;return y[1]={type:n,blueprint:y,template:t,queries:null,viewQuery:a,declTNode:e,data:y.slice().fill(null,p),bindingStartIndex:p,expandoStartIndex:m,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof o?o():o,pipeRegistry:"function"==typeof s?s():s,firstChild:null,schemas:c,consts:w,incompleteFirstPass:!1}}function tw(n,e,t,r){const i=fw(e);null===t?i.push(r):(i.push(t),n.firstCreatePass&&dw(n).push(r,i.length-1))}function nw(n,e,t){for(let r in n)if(n.hasOwnProperty(r)){const i=n[r];(t=null===t?{}:t).hasOwnProperty(r)?t[r].push(e,i):t[r]=[e,i]}return t}function Fg(n,e,t,r){let i=!1;if(fx()){const o=function(n,e,t){const r=n.directiveRegistry;let i=null;if(r)for(let o=0;o<r.length;o++){const s=r[o];L2(t,s.selectors,!1)&&(i||(i=[]),rh(af(t,e),n,s.type),po(s)?(sw(n,t),i.unshift(s)):i.push(s))}return i}(n,e,t),s=null===r?null:{"":-1};if(null!==o){i=!0,aw(t,n.data.length,o.length);for(let p=0;p<o.length;p++){const m=o[p];m.providersResolver&&m.providersResolver(m)}let a=!1,c=!1,f=Gc(n,e,o.length,null);for(let p=0;p<o.length;p++){const m=o[p];t.mergedAttrs=eh(t.mergedAttrs,m.hostAttrs),uw(n,t,e,f,m),SR(f,m,s),null!==m.contentQueries&&(t.flags|=8),(null!==m.hostBindings||null!==m.hostAttrs||0!==m.hostVars)&&(t.flags|=128);const y=m.type.prototype;!a&&(y.ngOnChanges||y.ngOnInit||y.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(t.index),a=!0),!c&&(y.ngOnChanges||y.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t.index),c=!0),f++}!function(n,e){const r=e.directiveEnd,i=n.data,o=e.attrs,s=[];let a=null,c=null;for(let f=e.directiveStart;f<r;f++){const p=i[f],m=p.inputs,y=null===o||k2(e)?null:MR(m,o);s.push(y),a=nw(m,f,a),c=nw(p.outputs,f,c)}null!==a&&(a.hasOwnProperty("class")&&(e.flags|=16),a.hasOwnProperty("style")&&(e.flags|=32)),e.initialInputs=s,e.inputs=a,e.outputs=c}(n,t)}s&&function(n,e,t){if(e){const r=n.localNames=[];for(let i=0;i<e.length;i+=2){const o=t[e[i+1]];if(null==o)throw new Zt("301",`Export of name '${e[i+1]}' not found!`);r.push(e[i],o)}}}(t,r,s)}return t.mergedAttrs=eh(t.mergedAttrs,t.attrs),i}function iw(n,e,t,r,i,o){const s=o.hostBindings;if(s){let a=n.hostBindingOpCodes;null===a&&(a=n.hostBindingOpCodes=[]);const c=~e.index;(function(n){let e=n.length;for(;e>0;){const t=n[--e];if("number"==typeof t&&t<0)return t}return 0})(a)!=c&&a.push(c),a.push(r,i,s)}}function ow(n,e){null!==n.hostBindings&&n.hostBindings(1,e)}function sw(n,e){e.flags|=2,(n.components||(n.components=[])).push(e.index)}function SR(n,e,t){if(t){if(e.exportAs)for(let r=0;r<e.exportAs.length;r++)t[e.exportAs[r]]=n;po(e)&&(t[""]=n)}}function aw(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}function uw(n,e,t,r,i){n.data[r]=i;const o=i.factory||(i.factory=v(i.type)),s=new of(o,po(i),null);n.blueprint[r]=s,t[r]=s,iw(n,e,0,r,Gc(n,t,i.hostVars,_t),i)}function NR(n,e,t){const r=Ji(e,n),i=Z2(t),o=n[10],s=Ch(n,Ef(n,i,null,t.onPush?64:16,r,e,o,o.createRenderer(r,t),null,null));n[e.index]=s}function RR(n,e,t,r,i,o){const s=o[e];if(null!==s){const a=r.setInput;for(let c=0;c<s.length;){const f=s[c++],p=s[c++],m=s[c++];null!==a?r.setInput(t,m,f,p):t[p]=m}}}function MR(n,e){let t=null,r=0;for(;r<e.length;){const i=e[r];if(0!==i)if(5!==i){if("number"==typeof i)break;n.hasOwnProperty(i)&&(null===t&&(t=[]),t.push(i,n[i],e[r+1])),r+=2}else r+=2;else r+=4}return t}function cw(n,e,t,r){return new Array(n,!0,!1,e,null,0,r,t,null,null)}function PR(n,e){const t=mo(e,n);if(R0(t)){const r=t[1];80&t[2]?Yc(r,t,r.template,t[8]):t[5]>0&&kg(t)}}function kg(n){for(let r=dg(n);null!==r;r=hg(r))for(let i=10;i<r.length;i++){const o=r[i];if(1024&o[2]){const s=o[1];Yc(s,o,s.template,o[8])}else o[5]>0&&kg(o)}const t=n[1].components;if(null!==t)for(let r=0;r<t.length;r++){const i=mo(t[r],n);R0(i)&&i[5]>0&&kg(i)}}function kR(n,e){const t=mo(e,n),r=t[1];(function(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])})(r,t),_f(r,t,t[8])}function Ch(n,e){return n[13]?n[14][4]=e:n[13]=e,n[14]=e,e}function Lg(n){for(;n;){n[2]|=64;const e=bf(n);if(Vu(n)&&!e)return n;n=e}return null}function Vg(n,e,t){const r=e[10];r.begin&&r.begin();try{Yc(n,e,n.template,t)}catch(i){throw pw(e,i),i}finally{r.end&&r.end()}}function lw(n){!function(n){for(let e=0;e<n.components.length;e++){const t=n.components[e],r=ug(t),i=r[1];mR(i,r,i.template,t)}}(n[8])}function Ug(n,e,t){L0(0),e(n,t)}const jR=(()=>Promise.resolve(null))();function fw(n){return n[7]||(n[7]=[])}function dw(n){return n.cleanup||(n.cleanup=[])}function pw(n,e){const t=n[9],r=t?t.get(Yu,null):null;r&&r.handleError(e)}function gw(n,e,t,r,i){for(let o=0;o<t.length;){const s=t[o++],a=t[o++],c=e[s],f=n.data[s];null!==f.setInput?f.setInput(c,i,r,a):c[a]=i}}function Ea(n,e,t){const r=Tc(e,n);!function(n,e,t){un(n)?n.setValue(e,t):e.textContent=t}(n[11],r,t)}function Eh(n,e,t){let r=t?n.styles:null,i=t?n.classes:null,o=0;if(null!==e)for(let s=0;s<e.length;s++){const a=e[s];"number"==typeof a?o=a:1==o?i=Ar(i,a):2==o&&(r=Ar(r,a+": "+e[++s]+";"))}t?n.styles=r:n.stylesWithoutHost=r,t?n.classes=i:n.classesWithoutHost=i}const Xc=new Nn("INJECTOR",-1);class mw{get(e,t=df){if(t===df){const r=new Error(`NullInjectorError: No provider for ${ut(e)}!`);throw r.name="NullInjectorError",r}return t}}const If=new Nn("Set Injector scope."),Af={},zR={};let jg;function vw(){return void 0===jg&&(jg=new mw),jg}function yw(n,e=null,t=null,r){return new YR(n,t,e||vw(),r)}class YR{constructor(e,t,r,i=null){this.parent=r,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const o=[];t&&Ys(t,a=>this.processProvider(a,e,t)),Ys([e],a=>this.processInjectorType(a,[],o)),this.records.set(Xc,qc(void 0,this));const s=this.records.get(If);this.scope=null!=s?s.value:null,this.source=i||("object"==typeof e?null:ut(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,t=df,r=Oe.Default){this.assertNotDestroyed();const i=Vc(this),o=j(void 0);try{if(!(r&Oe.SkipSelf)){let a=this.records.get(e);if(void 0===a){const c=function(n){return"function"==typeof n||"object"==typeof n&&n instanceof Nn}(e)&&hi(e);a=c&&this.injectableDefInScope(c)?qc(Wg(e),Af):null,this.records.set(e,a)}if(null!=a)return this.hydrate(e,a)}return(r&Oe.Self?vw():this.parent).get(e,t=r&Oe.Optional&&t===df?null:t)}catch(s){if("NullInjectorError"===s.name){if((s[Bc]=s[Bc]||[]).unshift(ut(e)),i)throw s;return Bx(s,e,"R3InjectorError",this.source)}throw s}finally{j(o),Vc(i)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((r,i)=>e.push(ut(i))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(e,t,r){if(!(e=Le(e)))return!1;let i=Pu(e);const o=null==i&&e.ngModule||void 0,s=void 0===o?e:o,a=-1!==r.indexOf(s);if(void 0!==o&&(i=Pu(o)),null==i)return!1;if(null!=i.imports&&!a){let p;r.push(s);try{Ys(i.imports,m=>{this.processInjectorType(m,t,r)&&(void 0===p&&(p=[]),p.push(m))})}finally{}if(void 0!==p)for(let m=0;m<p.length;m++){const{ngModule:y,providers:w}=p[m];Ys(w,E=>this.processProvider(E,y,w||qt))}}this.injectorDefTypes.add(s);const c=v(s)||(()=>new s);this.records.set(s,qc(c,Af));const f=i.providers;if(null!=f&&!a){const p=e;Ys(f,m=>this.processProvider(m,p,f))}return void 0!==o&&void 0!==e.providers}processProvider(e,t,r){let i=Kc(e=Le(e))?e:Le(e&&e.provide);const o=function(n,e,t){return ww(n)?qc(void 0,n.useValue):qc(function(n,e,t){let r;if(Kc(n)){const i=Le(n);return v(i)||Wg(i)}if(ww(n))r=()=>Le(n.useValue);else if(function(n){return!(!n||!n.useFactory)}(n))r=()=>n.useFactory(...Hu(n.deps||[]));else if(function(n){return!(!n||!n.useExisting)}(n))r=()=>Kt(Le(n.useExisting));else{const i=Le(n&&(n.useClass||n.provide));if(!function(n){return!!n.deps}(n))return v(i)||Wg(i);r=()=>new i(...Hu(n.deps))}return r}(n),Af)}(e);if(Kc(e)||!0!==e.multi)this.records.get(i);else{let s=this.records.get(i);s||(s=qc(void 0,Af,!0),s.factory=()=>Hu(s.multi),this.records.set(i,s)),i=e,s.multi.push(e)}this.records.set(i,o)}hydrate(e,t){return t.value===Af&&(t.value=zR,t.value=t.factory()),"object"==typeof t.value&&t.value&&function(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(t.value)&&this.onDestroy.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=Le(e.providedIn);return"string"==typeof t?"any"===t||t===this.scope:this.injectorDefTypes.has(t)}}function Wg(n){const e=hi(n),t=null!==e?e.factory:v(n);if(null!==t)return t;if(n instanceof Nn)throw new Error(`Token ${ut(n)} is missing a \u0275prov definition.`);if(n instanceof Function)return function(n){const e=n.length;if(e>0){const r=function(n,e){const t=[];for(let r=0;r<n;r++)t.push(e);return t}(e,"?");throw new Error(`Can't resolve all parameters for ${ut(n)}: (${r.join(", ")}).`)}const t=function(n){const e=n&&(n[Tn]||n[ku]);if(e){const t=function(n){if(n.hasOwnProperty("name"))return n.name;const e=(""+n).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${t}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${t}" class.`),e}return null}(n);return null!==t?()=>t.factory(n):()=>new n}(n);throw new Error("unreachable")}function qc(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function ww(n){return null!==n&&"object"==typeof n&&J0 in n}function Kc(n){return"function"==typeof n}const bw=function(n,e,t){return function(n,e=null,t=null,r){const i=yw(n,e,t,r);return i._resolveInjectorDefTypes(),i}({name:t},e,n,t)};let kn=(()=>{class n{static create(t,r){return Array.isArray(t)?bw(t,r,""):bw(t.providers,t.parent,t.name||"")}}return n.THROW_IF_NOT_FOUND=df,n.NULL=new mw,n.\u0275prov=Xe({token:n,providedIn:"any",factory:()=>Kt(Xc)}),n.__NG_ELEMENT_ID__=-1,n})();function hM(n,e){Qd(ug(n)[1],Ur())}function Tf(n){let e=function(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),t=!0;const r=[n];for(;e;){let i;if(po(n))i=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new Error("Directives cannot inherit Components");i=e.\u0275dir}if(i){if(t){r.push(i);const s=n;s.inputs=qg(n.inputs),s.declaredInputs=qg(n.declaredInputs),s.outputs=qg(n.outputs);const a=i.hostBindings;a&&vM(n,a);const c=i.viewQuery,f=i.contentQueries;if(c&&gM(n,c),f&&mM(n,f),Za(n.inputs,i.inputs),Za(n.declaredInputs,i.declaredInputs),Za(n.outputs,i.outputs),po(i)&&i.data.animation){const p=n.data;p.animation=(p.animation||[]).concat(i.data.animation)}}const o=i.features;if(o)for(let s=0;s<o.length;s++){const a=o[s];a&&a.ngInherit&&a(n),a===Tf&&(t=!1)}}e=Object.getPrototypeOf(e)}!function(n){let e=0,t=null;for(let r=n.length-1;r>=0;r--){const i=n[r];i.hostVars=e+=i.hostVars,i.hostAttrs=eh(i.hostAttrs,t=eh(t,i.hostAttrs))}}(r)}function qg(n){return n===Us?{}:n===qt?[]:n}function gM(n,e){const t=n.viewQuery;n.viewQuery=t?(r,i)=>{e(r,i),t(r,i)}:e}function mM(n,e){const t=n.contentQueries;n.contentQueries=t?(r,i,o)=>{e(r,i,o),t(r,i,o)}:e}function vM(n,e){const t=n.hostBindings;n.hostBindings=t?(r,i)=>{e(r,i),t(r,i)}:e}let _h=null;function Qc(){if(!_h){const n=kt.Symbol;if(n&&n.iterator)_h=n.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const r=e[t];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(_h=r)}}}return _h}class cs{constructor(e){this.wrapped=e}static wrap(e){return new cs(e)}static unwrap(e){return cs.isWrapped(e)?e.wrapped:e}static isWrapped(e){return e instanceof cs}}function Sf(n){return!!Kg(n)&&(Array.isArray(n)||!(n instanceof Map)&&Qc()in n)}function Kg(n){return null!==n&&("function"==typeof n||"object"==typeof n)}function xi(n,e,t){return!Object.is(n[e],t)&&(n[e]=t,!0)}function Dr(n,e,t,r,i,o,s,a){const c=_e(),f=ln(),p=n+20,m=f.firstCreatePass?function(n,e,t,r,i,o,s,a,c){const f=e.consts,p=zc(e,n,4,s||null,su(f,a));Fg(e,t,p,su(f,c)),Qd(e,p);const m=p.tViews=bh(2,p,r,i,o,e.directiveRegistry,e.pipeRegistry,null,e.schemas,f);return null!==e.queries&&(e.queries.template(e,p),m.queries=e.queries.embeddedTView(p)),p}(p,f,c,e,t,r,i,o,s):f.data[p];zs(m,!1);const y=c[11].createComment("");mh(f,c,y,m),yi(y,c),Ch(c,c[p]=cw(y,c,y,m)),iu(m)&&Mg(f,c,m),null!=s&&Og(c,m,a)}function Ah(n){return Sc(wt.lFrame.contextLView,20+n)}function Mt(n,e=Oe.Default){const t=_e();return null===t?Kt(n,e):Sx(Ur(),t,Le(n),e)}function In(n,e,t){const r=_e();return xi(r,Nc(),e)&&function(n,e,t,r,i,o,s,a){const c=Ji(e,t);let p,f=e.inputs;!a&&null!=f&&(p=f[r])?(gw(n,t,p,r,i),rs(e)&&function(n,e){const t=mo(e,n);16&t[2]||(t[2]|=64)}(t,e.index)):3&e.type&&(r=function(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(r),i=null!=s?s(i,e.value||"",r):i,un(o)?o.setProperty(c,r,i):U0(r)||(c.setProperty?c.setProperty(r,i):c[r]=i))}(ln(),function(){const n=wt.lFrame;return N0(n.tView,n.selectedIndex)}(),r,n,e,r[11],t,!1),In}function e1(n,e,t,r,i){const s=i?"class":"style";gw(n,t,e.inputs[s],s,r)}function An(n,e,t,r){const i=_e(),o=ln(),s=20+n,a=i[11],c=i[s]=gg(a,e,wt.lFrame.currentNamespace),f=o.firstCreatePass?function(n,e,t,r,i,o,s){const a=e.consts,f=zc(e,n,2,i,su(a,o));return Fg(e,t,f,su(a,s)),null!==f.attrs&&Eh(f,f.attrs,!1),null!==f.mergedAttrs&&Eh(f,f.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,f),f}(s,o,i,0,e,t,r):o.data[s];zs(f,!0);const p=f.mergedAttrs;null!==p&&Jd(a,c,p);const m=f.classes;null!==m&&bg(a,c,m);const y=f.styles;null!==y&&O2(a,c,y),64!=(64&f.flags)&&mh(o,i,c,f),0===wt.lFrame.elementDepthCount&&yi(c,i),wt.lFrame.elementDepthCount++,iu(f)&&(Mg(o,i,f),$2(o,f,i)),null!==r&&Og(i,f)}function Dn(){let n=Ur();O0()?F0():(n=n.parent,zs(n,!1));const e=n;wt.lFrame.elementDepthCount--;const t=ln();t.firstCreatePass&&(Qd(t,n),tf(n)&&t.queries.elementEnd(n)),null!=e.classesWithoutHost&&function(n){return 0!=(16&n.flags)}(e)&&e1(t,e,_e(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function(n){return 0!=(32&n.flags)}(e)&&e1(t,e,_e(),e.stylesWithoutHost,!1)}function Th(n,e,t,r){An(n,e,t,r),Dn()}function wi(){return _e()}function r1(n){return!!n&&"function"==typeof n.then}function sb(n){return!!n&&"function"==typeof n.subscribe}const ab=sb;function Zr(n,e,t,r){const i=_e(),o=ln(),s=Ur();return function(n,e,t,r,i,o,s,a){const c=iu(r),p=n.firstCreatePass&&dw(n),m=e[8],y=fw(e);let w=!0;if(3&r.type||a){const _=Ji(r,e),T=a?a(_):_,N=y.length,M=a?R=>a(cn(R[r.index])):r.index;if(un(t)){let R=null;if(!a&&c&&(R=function(n,e,t,r){const i=n.cleanup;if(null!=i)for(let o=0;o<i.length-1;o+=2){const s=i[o];if(s===t&&i[o+1]===r){const a=e[7],c=i[o+2];return a.length>c?a[c]:null}"string"==typeof s&&(o+=2)}return null}(n,e,i,r.index)),null!==R)(R.__ngLastListenerFn__||R).__ngNextListenerFn__=o,R.__ngLastListenerFn__=o,w=!1;else{o=i1(r,e,m,o,!1);const P=t.listen(T,i,o);y.push(o,P),p&&p.push(i,M,N,N+1)}}else o=i1(r,e,m,o,!0),T.addEventListener(i,o,s),y.push(o),p&&p.push(i,M,N,s)}else o=i1(r,e,m,o,!1);const E=r.outputs;let A;if(w&&null!==E&&(A=E[i])){const _=A.length;if(_)for(let T=0;T<_;T+=2){const B=e[A[T]][A[T+1]].subscribe(o),Y=y.length;y.push(o,B),p&&p.push(i,r.index,Y,-(Y+1))}}}(o,i,i[11],s,n,e,!!t,r),Zr}function lb(n,e,t,r){try{return!1!==t(r)}catch(i){return pw(n,i),!1}}function i1(n,e,t,r,i){return function o(s){if(s===Function)return r;const a=2&n.flags?mo(n.index,e):e;0==(32&e[2])&&Lg(a);let c=lb(e,0,r,s),f=o.__ngNextListenerFn__;for(;f;)c=lb(e,0,f,s)&&c,f=f.__ngNextListenerFn__;return i&&!1===c&&(s.preventDefault(),s.returnValue=!1),c}}function si(n=1){return function(n){return(wt.lFrame.contextLView=function(n,e){for(;n>0;)e=e[15],n--;return e}(n,wt.lFrame.contextLView))[8]}(n)}function wb(n,e,t,r,i){const o=n[t+1],s=null===e;let a=r?as(o):ba(o),c=!1;for(;0!==a&&(!1===c||s);){const p=n[a+1];r4(n[a],e)&&(c=!0,n[a+1]=r?_g(p):Cg(p)),a=r?as(p):ba(p)}c&&(n[t+1]=r?Cg(o):_g(o))}function r4(n,e){return null===n||null==e||(Array.isArray(n)?n[1]:n)===e||!(!Array.isArray(n)||"string"!=typeof e)&&Lc(n,e)>=0}function Js(n,e){return function(n,e,t,r){const i=_e(),o=ln(),s=function(n){const e=wt.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+n,t}(2);o.firstUpdatePass&&function(n,e,t,r){const i=n.data;if(null===i[t+1]){const o=i[Li()],s=function(n,e){return e>=n.expandoStartIndex}(n,t);(function(n,e){return 0!=(n.flags&(e?16:32))})(o,r)&&null===e&&!s&&(e=!1),e=function(n,e,t,r){const i=function(n){const e=wt.lFrame.currentDirectiveIndex;return-1===e?null:n[e]}(n);let o=r?e.residualClasses:e.residualStyles;if(null===i)0===(r?e.classBindings:e.styleBindings)&&(t=Rf(t=s1(null,n,e,t,r),e.attrs,r),o=null);else{const s=e.directiveStylingLast;if(-1===s||n[s]!==i)if(t=s1(i,n,e,t,r),null===o){let c=function(n,e,t){const r=t?e.classBindings:e.styleBindings;if(0!==ba(r))return n[as(r)]}(n,e,r);void 0!==c&&Array.isArray(c)&&(c=s1(null,n,e,c[1],r),c=Rf(c,e.attrs,r),function(n,e,t,r){n[as(t?e.classBindings:e.styleBindings)]=r}(n,e,r,c))}else o=function(n,e,t){let r;const i=e.directiveEnd;for(let o=1+e.directiveStylingLast;o<i;o++)r=Rf(r,n[o].hostAttrs,t);return Rf(r,e.attrs,t)}(n,e,r)}return void 0!==o&&(r?e.residualClasses=o:e.residualStyles=o),t}(i,o,e,r),function(n,e,t,r,i,o){let s=o?e.classBindings:e.styleBindings,a=as(s),c=ba(s);n[r]=t;let p,f=!1;if(Array.isArray(t)){const m=t;p=m[1],(null===p||Lc(m,p)>0)&&(f=!0)}else p=t;if(i)if(0!==c){const y=as(n[a+1]);n[r+1]=yh(y,a),0!==y&&(n[y+1]=Eg(n[y+1],r)),n[a+1]=function(n,e){return 131071&n|e<<17}(n[a+1],r)}else n[r+1]=yh(a,0),0!==a&&(n[a+1]=Eg(n[a+1],r)),a=r;else n[r+1]=yh(c,0),0===a?a=r:n[c+1]=Eg(n[c+1],r),c=r;f&&(n[r+1]=Cg(n[r+1])),wb(n,p,r,!0),wb(n,p,r,!1),function(n,e,t,r,i){const o=i?n.residualClasses:n.residualStyles;null!=o&&"string"==typeof e&&Lc(o,e)>=0&&(t[r+1]=_g(t[r+1]))}(e,p,n,r,o),s=yh(a,c),o?e.classBindings=s:e.styleBindings=s}(i,o,e,t,s,r)}}(o,n,s,r),e!==_t&&xi(i,s,e)&&function(n,e,t,r,i,o,s,a){if(!(3&e.type))return;const c=n.data,f=c[a+1];Sh(function(n){return 1==(1&n)}(f)?Mb(c,e,t,i,ba(f),s):void 0)||(Sh(o)||function(n){return 2==(2&n)}(f)&&(o=Mb(c,null,t,i,a,s)),function(n,e,t,r,i){const o=un(n);if(e)i?o?n.addClass(t,r):t.classList.add(r):o?n.removeClass(t,r):t.classList.remove(r);else{let s=-1===r.indexOf("-")?void 0:xo.DashCase;if(null==i)o?n.removeStyle(t,r,s):t.style.removeProperty(r);else{const a="string"==typeof i&&i.endsWith("!important");a&&(i=i.slice(0,-10),s|=xo.Important),o?n.setStyle(t,r,i,s):t.style.setProperty(r,i,a?"important":"")}}}(r,s,Tc(Li(),t),i,o))}(o,o.data[Li()],i,i[11],n,i[s+1]=function(n,e){return null==n||("string"==typeof e?n+=e:"object"==typeof n&&(n=ut(function(n){return n instanceof class{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}?n.changingThisBreaksApplicationSecurity:n}(n)))),n}(e,t),r,s)}(n,e,null,!0),Js}function s1(n,e,t,r,i){let o=null;const s=t.directiveEnd;let a=t.directiveStylingLast;for(-1===a?a=t.directiveStart:a++;a<s&&(o=e[a],r=Rf(r,o.hostAttrs,i),o!==n);)a++;return null!==n&&(t.directiveStylingLast=a),r}function Rf(n,e,t){const r=t?1:2;let i=-1;if(null!==e)for(let o=0;o<e.length;o++){const s=e[o];"number"==typeof s?i=s:i===r&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),vo(n,s,!!t||e[++o]))}return void 0===n?null:n}function Mb(n,e,t,r,i,o){const s=null===e;let a;for(;i>0;){const c=n[i],f=Array.isArray(c),p=f?c[1]:c,m=null===p;let y=t[i+1];y===_t&&(y=m?qt:void 0);let w=m?K0(y,r):p===r?y:void 0;if(f&&!Sh(w)&&(w=K0(c,r)),Sh(w)&&(a=w,s))return a;const E=n[i+1];i=s?as(E):ba(E)}if(null!==e){let c=o?e.residualClasses:e.residualStyles;null!=c&&(a=K0(c,r))}return a}function Sh(n){return void 0!==n}function ai(n,e=""){const t=_e(),r=ln(),i=n+20,o=r.firstCreatePass?zc(r,i,1,e,null):r.data[i],s=t[i]=function(n,e){return un(n)?n.createText(e):n.createTextNode(e)}(t[11],e);mh(r,t,s,o),zs(o,!1)}function a1(n){return u1("",n,""),a1}function u1(n,e,t){const r=_e(),i=function(n,e,t,r){return xi(n,Nc(),t)?e+nt(t)+r:_t}(r,n,e,t);return i!==_t&&Ea(r,Li(),i),u1}const Ku=void 0;var B4=["en",[["a","p"],["AM","PM"],Ku],[["AM","PM"],Ku,Ku],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Ku,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Ku,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Ku,"{1} 'at' {0}",Ku],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(n){const e=Math.floor(Math.abs(n)),t=n.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===t?1:5}];let ul={};function eC(n){return n in ul||(ul[n]=kt.ng&&kt.ng.common&&kt.ng.common.locales&&kt.ng.common.locales[n]),ul[n]}var Ve=(()=>((Ve=Ve||{})[Ve.LocaleId=0]="LocaleId",Ve[Ve.DayPeriodsFormat=1]="DayPeriodsFormat",Ve[Ve.DayPeriodsStandalone=2]="DayPeriodsStandalone",Ve[Ve.DaysFormat=3]="DaysFormat",Ve[Ve.DaysStandalone=4]="DaysStandalone",Ve[Ve.MonthsFormat=5]="MonthsFormat",Ve[Ve.MonthsStandalone=6]="MonthsStandalone",Ve[Ve.Eras=7]="Eras",Ve[Ve.FirstDayOfWeek=8]="FirstDayOfWeek",Ve[Ve.WeekendRange=9]="WeekendRange",Ve[Ve.DateFormat=10]="DateFormat",Ve[Ve.TimeFormat=11]="TimeFormat",Ve[Ve.DateTimeFormat=12]="DateTimeFormat",Ve[Ve.NumberSymbols=13]="NumberSymbols",Ve[Ve.NumberFormats=14]="NumberFormats",Ve[Ve.CurrencyCode=15]="CurrencyCode",Ve[Ve.CurrencySymbol=16]="CurrencySymbol",Ve[Ve.CurrencyName=17]="CurrencyName",Ve[Ve.Currencies=18]="Currencies",Ve[Ve.Directionality=19]="Directionality",Ve[Ve.PluralCase=20]="PluralCase",Ve[Ve.ExtraData=21]="ExtraData",Ve))();const Nh="en-US";let tC=Nh;function c1(n){$r(n,"Expected localeId to be defined"),"string"==typeof n&&(tC=n.toLowerCase().replace(/_/g,"-"))}class AC{}const TC="ngComponent";class VO{resolveComponentFactory(e){throw function(n){const e=Error(`No component factory found for ${ut(n)}. Did you add it to @NgModule.entryComponents?`);return e[TC]=n,e}(e)}}let du=(()=>{class n{}return n.NULL=new VO,n})();function Ph(...n){}function ll(n,e){return new Ui(Ji(n,e))}const WO=function(){return ll(Ur(),_e())};let Ui=(()=>{class n{constructor(t){this.nativeElement=t}}return n.__NG_ELEMENT_ID__=WO,n})();function SC(n){return n instanceof Ui?n.nativeElement:n}class kh{}let v1=(()=>{class n{}return n.\u0275prov=Xe({token:n,providedIn:"root",factory:()=>null}),n})();class Lh{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const RC=new Lh("12.2.13");class MC{constructor(){}supports(e){return Sf(e)}create(e){return new qO(e)}}const XO=(n,e)=>e;class qO{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||XO}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,r=this._removalsHead,i=0,o=null;for(;t||r;){const s=!r||t&&t.currentIndex<FC(r,i,o)?t:r,a=FC(s,i,o),c=s.currentIndex;if(s===r)i--,r=r._nextRemoved;else if(t=t._next,null==s.previousIndex)i++;else{o||(o=[]);const f=a-i,p=c-i;if(f!=p){for(let y=0;y<f;y++){const w=y<o.length?o[y]:o[y]=0,E=w+y;p<=E&&E<f&&(o[y]=w+1)}o[s.previousIndex]=p-f}}a!==c&&e(s,a,c)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!Sf(e))throw new Error(`Error trying to diff '${ut(e)}'. Only arrays and iterables are allowed`);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let i,o,s,t=this._itHead,r=!1;if(Array.isArray(e)){this.length=e.length;for(let a=0;a<this.length;a++)o=e[a],s=this._trackByFn(a,o),null!==t&&Object.is(t.trackById,s)?(r&&(t=this._verifyReinsertion(t,o,s,a)),Object.is(t.item,o)||this._addIdentityChange(t,o)):(t=this._mismatch(t,o,s,a),r=!0),t=t._next}else i=0,function(n,e){if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else{const t=n[Qc()]();let r;for(;!(r=t.next()).done;)e(r.value)}}(e,a=>{s=this._trackByFn(i,a),null!==t&&Object.is(t.trackById,s)?(r&&(t=this._verifyReinsertion(t,a,s,i)),Object.is(t.item,a)||this._addIdentityChange(t,a)):(t=this._mismatch(t,a,s,i),r=!0),t=t._next,i++}),this.length=i;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,r,i){let o;return null===e?o=this._itTail:(o=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,o,i)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(r,i))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,o,i)):e=this._addAfter(new KO(t,r),o,i),e}_verifyReinsertion(e,t,r,i){let o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==o?e=this._reinsertAfter(o,e._prev,i):e.currentIndex!=i&&(e.currentIndex=i,this._addToMoves(e,i)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const i=e._prevRemoved,o=e._nextRemoved;return null===i?this._removalsHead=o:i._nextRemoved=o,null===o?this._removalsTail=i:o._prevRemoved=i,this._insertAfter(e,t,r),this._addToMoves(e,r),e}_moveAfter(e,t,r){return this._unlink(e),this._insertAfter(e,t,r),this._addToMoves(e,r),e}_addAfter(e,t,r){return this._insertAfter(e,t,r),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,r){const i=null===t?this._itHead:t._next;return e._next=i,e._prev=t,null===i?this._itTail=e:i._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new OC),this._linkedRecords.put(e),e.currentIndex=r,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,r=e._next;return null===t?this._itHead=r:t._next=r,null===r?this._itTail=t:r._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new OC),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class KO{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class QO{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===t||t<=r.currentIndex)&&Object.is(r.trackById,e))return r;return null}remove(e){const t=e._prevDup,r=e._nextDup;return null===t?this._head=r:t._nextDup=r,null===r?this._tail=t:r._prevDup=t,null===this._head}}class OC{constructor(){this.map=new Map}put(e){const t=e.trackById;let r=this.map.get(t);r||(r=new QO,this.map.set(t,r)),r.add(e)}get(e,t){const i=this.map.get(e);return i?i.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function FC(n,e,t){const r=n.previousIndex;if(null===r)return r;let i=0;return t&&r<t.length&&(i=t[r]),r+e+i}class PC{constructor(){}supports(e){return e instanceof Map||Kg(e)}create(){return new $O}}class $O{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let t;for(t=this._mapHead;null!==t;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}diff(e){if(e){if(!(e instanceof Map||Kg(e)))throw new Error(`Error trying to diff '${ut(e)}'. Only maps and objects are allowed`)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(r,i)=>{if(t&&t.key===i)this._maybeAddToChanges(t,r),this._appendAfter=t,t=t._next;else{const o=this._getOrCreateRecordForKey(i,r);t=this._insertBeforeOrAppend(t,o)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let r=t;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){const r=e._prev;return t._next=e,t._prev=r,e._prev=t,r&&(r._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){const i=this._records.get(e);this._maybeAddToChanges(i,t);const o=i._prev,s=i._next;return o&&(o._next=s),s&&(s._prev=o),i._next=null,i._prev=null,i}const r=new ZO(e);return this._records.set(e,r),r.currentValue=t,this._addToAdditions(r),r}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(r=>t(e[r],r))}}class ZO{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function kC(){return new kf([new MC])}let kf=(()=>{class n{constructor(t){this.factories=t}static create(t,r){if(null!=r){const i=r.factories.slice();t=t.concat(i)}return new n(t)}static extend(t){return{provide:n,useFactory:r=>n.create(t,r||kC()),deps:[[n,new zu,new Xs]]}}find(t){const r=this.factories.find(i=>i.supports(t));if(null!=r)return r;throw new Error(`Cannot find a differ supporting object '${t}' of type '${function(n){return n.name||typeof n}(t)}'`)}}return n.\u0275prov=Xe({token:n,providedIn:"root",factory:kC}),n})();function LC(){return new fl([new PC])}let fl=(()=>{class n{constructor(t){this.factories=t}static create(t,r){if(r){const i=r.factories.slice();t=t.concat(i)}return new n(t)}static extend(t){return{provide:n,useFactory:r=>n.create(t,r||LC()),deps:[[n,new zu,new Xs]]}}find(t){const r=this.factories.find(i=>i.supports(t));if(r)return r;throw new Error(`Cannot find a differ supporting object '${t}'`)}}return n.\u0275prov=Xe({token:n,providedIn:"root",factory:LC}),n})();function Bh(n,e,t,r,i=!1){for(;null!==t;){const o=e[t.index];if(null!==o&&r.push(cn(o)),Zi(o))for(let a=10;a<o.length;a++){const c=o[a],f=c[1].firstChild;null!==f&&Bh(c[1],c,f,r)}const s=t.type;if(8&s)Bh(n,e,t.child,r);else if(32&s){const a=fg(t,e);let c;for(;c=a();)r.push(c)}else if(16&s){const a=N2(e,t);if(Array.isArray(a))r.push(...a);else{const c=bf(e[16]);Bh(c[1],c,a,r,!0)}}t=i?t.projectionNext:t.next}return r}class Lf{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,t=e[1];return Bh(t,e,t.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(Zi(e)){const t=e[8],r=t?t.indexOf(this):-1;r>-1&&(mg(e,r),Wu(t,r))}this._attachedToViewContainer=!1}b2(this._lView[1],this._lView)}onDestroy(e){tw(this._lView[1],this._lView,null,e)}markForCheck(){Lg(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){Vg(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(n,e,t){Xd(!0);try{Vg(n,e,t)}finally{Xd(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function(n,e){Cf(n,e,e[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}}class eF extends Lf{constructor(e){super(e),this._view=e}detectChanges(){lw(this._view)}checkNoChanges(){!function(n){Xd(!0);try{lw(n)}finally{Xd(!1)}}(this._view)}get context(){return null}}const nF=function(n){return function(n,e,t){if(rs(n)&&!t){const r=mo(n.index,e);return new Lf(r,r)}return 47&n.type?new Lf(e[16],e):null}(Ur(),_e(),16==(16&n))};let y1=(()=>{class n{}return n.__NG_ELEMENT_ID__=nF,n})();const oF=[new PC],aF=new kf([new MC]),uF=new fl(oF),lF=function(){return Vh(Ur(),_e())};let Ia=(()=>{class n{}return n.__NG_ELEMENT_ID__=lF,n})();const fF=Ia,dF=class extends fF{constructor(e,t,r){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=r}createEmbeddedView(e){const t=this._declarationTContainer.tViews,r=Ef(this._declarationLView,t,e,16,null,t.declTNode,null,null,null,null);r[17]=this._declarationLView[this._declarationTContainer.index];const o=this._declarationLView[19];return null!==o&&(r[19]=o.createEmbeddedView(t)),_f(t,r,e),new Lf(r)}};function Vh(n,e){return 4&n.type?new dF(e,n,ll(n,e)):null}class Qu{}const mF=function(){return UC(Ur(),_e())};let na=(()=>{class n{}return n.__NG_ELEMENT_ID__=mF,n})();const yF=na,BC=class extends yF{constructor(e,t,r){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=r}get element(){return ll(this._hostTNode,this._hostLView)}get injector(){return new Oc(this._hostTNode,this._hostLView)}get parentInjector(){const e=nh(this._hostTNode,this._hostLView);if(_x(e)){const t=Mc(e,this._hostLView),r=Rc(e);return new Oc(t[1].data[r+8],t)}return new Oc(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=VC(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,t,r){const i=e.createEmbeddedView(t||{});return this.insert(i,r),i}createComponent(e,t,r,i,o){const s=r||this.parentInjector;if(!o&&null==e.ngModule&&s){const c=s.get(Qu,null);c&&(o=c)}const a=e.create(s,i,void 0,o);return this.insert(a.hostView,t),a}insert(e,t){const r=e._lView,i=r[1];if(function(n){return Zi(n[3])}(r)){const p=this.indexOf(e);if(-1!==p)this.detach(p);else{const m=r[3],y=new BC(m,m[6],m[3]);y.detach(y.indexOf(e))}}const o=this._adjustIndex(t),s=this._lContainer;!function(n,e,t,r){const i=10+r,o=t.length;r>0&&(t[i-1][4]=e),r<o-10?(e[4]=t[i],sh(t,10+r,e)):(t.push(e),e[4]=null),e[3]=t;const s=e[17];null!==s&&t!==s&&function(n,e){const t=n[9];e[16]!==e[3][3][16]&&(n[2]=!0),null===t?n[9]=[e]:t.push(e)}(s,e);const a=e[19];null!==a&&a.insertView(n),e[2]|=128}(i,r,s,o);const a=xg(o,s),c=r[11],f=gh(c,s[7]);return null!==f&&function(n,e,t,r,i,o){r[0]=i,r[6]=e,Cf(n,r,t,1,i,o)}(i,s[6],c,r,f,a),e.attachToViewContainerRef(),sh(x1(s),o,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=VC(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),r=mg(this._lContainer,t);r&&(Wu(x1(this._lContainer),t),b2(r[1],r))}detach(e){const t=this._adjustIndex(e,-1),r=mg(this._lContainer,t);return r&&null!=Wu(x1(this._lContainer),t)?new Lf(r):null}_adjustIndex(e,t=0){return null==e?this.length+t:e}};function VC(n){return n[8]}function x1(n){return n[8]||(n[8]=[])}function UC(n,e){let t;const r=e[n.index];if(Zi(r))t=r;else{let i;if(8&n.type)i=cn(r);else{const o=e[11];i=o.createComment("");const s=Ji(n,e);Xu(o,gh(o,s),i,function(n,e){return un(n)?n.nextSibling(e):e.nextSibling}(o,s),!1)}e[n.index]=t=cw(r,e,i,n),Ch(e,t)}return new BC(t,n,e)}const gl={};class sE extends du{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=Et(e);return new uE(t,this.ngModule)}}function aE(n){const e=[];for(let t in n)n.hasOwnProperty(t)&&e.push({propName:n[t],templateName:t});return e}const pP=new Nn("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>h2});class uE extends AC{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function(n){return n.map(rR).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return aE(this.componentDef.inputs)}get outputs(){return aE(this.componentDef.outputs)}create(e,t,r,i){const o=(i=i||this.ngModule)?function(n,e){return{get:(t,r,i)=>{const o=n.get(t,gl,i);return o!==gl||r===gl?o:e.get(t,r,i)}}}(e,i.injector):e,s=o.get(kh,bn),a=o.get(v1,null),c=s.createRenderer(null,this.componentDef),f=this.componentDef.selectors[0][0]||"div",p=r?function(n,e,t){if(un(n))return n.selectRootElement(e,t===ke.ShadowDom);let r="string"==typeof e?n.querySelector(e):e;return r.textContent="",r}(c,r,this.componentDef.encapsulation):gg(s.createRenderer(null,this.componentDef),f,function(n){const e=n.toLowerCase();return"svg"===e?"http://www.w3.org/2000/svg":"math"===e?"http://www.w3.org/1998/MathML/":null}(f)),m=this.componentDef.onPush?576:528,y=function(n,e){return{components:[],scheduler:n||h2,clean:jR,playerHandler:e||null,flags:0}}(),w=bh(0,null,null,1,0,null,null,null,null,null),E=Ef(null,w,y,m,null,null,s,c,a,o);let A,_;qd(E);try{const T=function(n,e,t,r,i,o){const s=t[1];t[20]=n;const c=zc(s,20,2,"#host",null),f=c.mergedAttrs=e.hostAttrs;null!==f&&(Eh(c,f,!0),null!==n&&(Jd(i,n,f),null!==c.classes&&bg(i,n,c.classes),null!==c.styles&&O2(i,n,c.styles)));const p=r.createRenderer(n,e),m=Ef(t,Z2(e),null,e.onPush?64:16,t[20],c,r,p,o||null,null);return s.firstCreatePass&&(rh(af(c,t),s,e.type),sw(s,c),aw(c,t.length,1)),Ch(t,m),t[20]=m}(p,this.componentDef,E,s,c);if(p)if(r)Jd(c,p,["ng-version",RC.full]);else{const{attrs:N,classes:M}=function(n){const e=[],t=[];let r=1,i=2;for(;r<n.length;){let o=n[r];if("string"==typeof o)2===i?""!==o&&e.push(o,n[++r]):8===i&&t.push(o);else{if(!ss(i))break;i=o}r++}return{attrs:e,classes:t}}(this.componentDef.selectors[0]);N&&Jd(c,p,N),M&&M.length>0&&bg(c,p,M.join(" "))}if(_=N0(w,20),void 0!==t){const N=_.projection=[];for(let M=0;M<this.ngContentSelectors.length;M++){const R=t[M];N.push(null!=R?Array.from(R):null)}}A=function(n,e,t,r,i){const o=t[1],s=function(n,e,t){const r=Ur();n.firstCreatePass&&(t.providersResolver&&t.providersResolver(t),uw(n,r,e,Gc(n,e,1,null),t));const i=uf(e,n,r.directiveStart,r);yi(i,e);const o=Ji(r,e);return o&&yi(o,e),i}(o,t,e);if(r.components.push(s),n[8]=s,i&&i.forEach(c=>c(s,e)),e.contentQueries){const c=Ur();e.contentQueries(1,s,c.directiveStart)}const a=Ur();return!o.firstCreatePass||null===e.hostBindings&&null===e.hostAttrs||(au(a.index),iw(t[1],a,0,a.directiveStart,a.directiveEnd,e),ow(e,s)),s}(T,this.componentDef,E,y,[hM]),_f(w,E,null)}finally{Kd()}return new vP(this.componentType,A,ll(_,E),E,_)}}class vP extends class{}{constructor(e,t,r,i,o){super(),this.location=r,this._rootLView=i,this._tNode=o,this.instance=t,this.hostView=this.changeDetectorRef=new eF(i),this.componentType=e}get injector(){return new Oc(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}const ml=new Map;class wP extends Qu{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new sE(this);const r=_n(e),i=function(n){return n[V]||null}(e);i&&c1(i),this._bootstrapComponents=Qs(r.bootstrap),this._r3Injector=yw(e,t,[{provide:Qu,useValue:this},{provide:du,useValue:this.componentFactoryResolver}],ut(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,t=kn.THROW_IF_NOT_FOUND,r=Oe.Default){return e===kn||e===Qu||e===Xc?this:this._r3Injector.get(e,t,r)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class M1 extends class{}{constructor(e){super(),this.moduleType=e,null!==_n(e)&&function(n){const e=new Set;!function t(r){const i=_n(r,!0),o=i.id;null!==o&&(function(n,e,t){if(e&&e!==t)throw new Error(`Duplicate module registered for ${n} - ${ut(e)} vs ${ut(e.name)}`)}(o,ml.get(o),r),ml.set(o,r));const s=Qs(i.imports);for(const a of s)e.has(a)||(e.add(a),t(a))}(n)}(e)}create(e){return new wP(this.moduleType,e)}}function fE(n,e,t,r,i,o){const s=e+t;return xi(n,s,i)?function(n,e,t){return n[e]=t}(n,s+1,o?r.call(o,i):r(i)):function(n,e){const t=n[e];return t===_t?void 0:t}(n,s+1)}function vE(n,e,t){const r=n+20,i=_e(),o=Sc(i,r);return function(n,e){cs.isWrapped(e)&&(e=cs.unwrap(e),n[wt.lFrame.bindingIndex]=_t);return e}(i,function(n,e){return n[1].data[e].pure}(i,r)?fE(i,function(){const n=wt.lFrame;let e=n.bindingRootIndex;return-1===e&&(e=n.bindingRootIndex=n.tView.bindingStartIndex),e}(),e,o.transform,t,o):o.transform(t))}function O1(n){return e=>{setTimeout(n,void 0,e)}}const Ei=class extends ce{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,r){var i,o,s;let a=e,c=t||(()=>null),f=r;if(e&&"object"==typeof e){const m=e;a=null===(i=m.next)||void 0===i?void 0:i.bind(m),c=null===(o=m.error)||void 0===o?void 0:o.bind(m),f=null===(s=m.complete)||void 0===s?void 0:s.bind(m)}this.__isAsync&&(c=O1(c),a&&(a=O1(a)),f&&(f=O1(f)));const p=super.subscribe({next:a,error:c,complete:f});return e instanceof Dt&&e.add(p),p}};function LP(){return this._results[Qc()]()}class zh{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=Qc(),r=zh.prototype;r[t]||(r[t]=LP)}get changes(){return this._changes||(this._changes=new Ei)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const r=this;r.dirty=!1;const i=Fo(e);(this._changesDetected=!function(n,e,t){if(n.length!==e.length)return!1;for(let r=0;r<n.length;r++){let i=n[r],o=e[r];if(t&&(i=t(i),o=t(o)),o!==i)return!1}return!0}(r._results,i,t))&&(r._results=i,r.length=i.length,r.last=i[this.length-1],r.first=i[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;class F1{constructor(e){this.queryList=e,this.matches=null}clone(){return new F1(this.queryList)}setDirty(){this.queryList.setDirty()}}class P1{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const r=null!==e.contentQueries?e.contentQueries[0]:t.length,i=[];for(let o=0;o<r;o++){const s=t.getByIndex(o);i.push(this.queries[s.indexInDeclarationView].clone())}return new P1(i)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==CE(e,t).matches&&this.queries[t].setDirty()}}class yE{constructor(e,t,r=null){this.predicate=e,this.flags=t,this.read=r}}class k1{constructor(e=[]){this.queries=e}elementStart(e,t){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let r=0;r<this.length;r++){const i=null!==t?t.length:0,o=this.getByIndex(r).embeddedTView(e,i);o&&(o.indexInDeclarationView=r,null!==t?t.push(o):t=[o])}return null!==t?new k1(t):null}template(e,t){for(let r=0;r<this.queries.length;r++)this.queries[r].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class L1{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new L1(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let r=e.parent;for(;null!==r&&8&r.type&&r.index!==t;)r=r.parent;return t===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const r=this.metadata.predicate;if(Array.isArray(r))for(let i=0;i<r.length;i++){const o=r[i];this.matchTNodeWithReadOption(e,t,UP(t,o)),this.matchTNodeWithReadOption(e,t,ih(t,e,o,!1,!1))}else r===Ia?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,ih(t,e,r,!1,!1))}matchTNodeWithReadOption(e,t,r){if(null!==r){const i=this.metadata.read;if(null!==i)if(i===Ui||i===na||i===Ia&&4&t.type)this.addMatch(t.index,-2);else{const o=ih(t,e,i,!1,!1);null!==o&&this.addMatch(t.index,o)}else this.addMatch(t.index,r)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function UP(n,e){const t=n.localNames;if(null!==t)for(let r=0;r<t.length;r+=2)if(t[r]===e)return t[r+1];return null}function WP(n,e,t,r){return-1===t?function(n,e){return 11&n.type?ll(n,e):4&n.type?Vh(n,e):null}(e,n):-2===t?function(n,e,t){return t===Ui?ll(e,n):t===Ia?Vh(e,n):t===na?UC(e,n):void 0}(n,e,r):uf(n,n[1],t,e)}function xE(n,e,t,r){const i=e[19].queries[r];if(null===i.matches){const o=n.data,s=t.matches,a=[];for(let c=0;c<s.length;c+=2){const f=s[c];a.push(f<0?null:WP(e,o[f],s[c+1],t.metadata.read))}i.matches=a}return i.matches}function B1(n,e,t,r){const i=n.queries.getByIndex(t),o=i.matches;if(null!==o){const s=xE(n,e,i,t);for(let a=0;a<o.length;a+=2){const c=o[a];if(c>0)r.push(s[a/2]);else{const f=o[a+1],p=e[-c];for(let m=10;m<p.length;m++){const y=p[m];y[17]===y[3]&&B1(y[1],y,f,r)}if(null!==p[9]){const m=p[9];for(let y=0;y<m.length;y++){const w=m[y];B1(w[1],w,f,r)}}}}}return r}function V1(n){const e=_e(),t=ln(),r=gx();L0(r+1);const i=CE(t,r);if(n.dirty&&cx(e)===(2==(2&i.metadata.flags))){if(null===i.matches)n.reset([]);else{const o=i.crossesNgTemplate?B1(t,e,r,[]):xE(t,e,i,r);n.reset(o,SC),n.notifyOnChanges()}return!0}return!1}function U1(n,e,t){const r=ln();r.firstCreatePass&&(function(n,e,t){null===n.queries&&(n.queries=new k1),n.queries.track(new L1(e,t))}(r,new yE(n,e,t),-1),2==(2&e)&&(r.staticViewQueries=!0)),function(n,e,t){const r=new zh(4==(4&t));tw(n,e,r,r.destroy),null===e[19]&&(e[19]=new P1),e[19].queries.push(new F1(r))}(r,_e(),e)}function j1(){return function(n,e){return n[19].queries[e].queryList}(_e(),gx())}function CE(n,e){return n.queries.getByIndex(e)}const Xh=new Nn("Application Initializer");let yl=(()=>{class n{constructor(t){this.appInits=t,this.resolve=Ph,this.reject=Ph,this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,i)=>{this.resolve=r,this.reject=i})}runInitializers(){if(this.initialized)return;const t=[],r=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let i=0;i<this.appInits.length;i++){const o=this.appInits[i]();if(r1(o))t.push(o);else if(ab(o)){const s=new Promise((a,c)=>{o.subscribe({complete:a,error:c})});t.push(s)}}Promise.all(t).then(()=>{r()}).catch(i=>{this.reject(i)}),0===t.length&&r(),this.initialized=!0}}return n.\u0275fac=function(t){return new(t||n)(Kt(Xh,8))},n.\u0275prov=Xe({token:n,factory:n.\u0275fac}),n})();const Kf=new Nn("AppId"),wk={provide:Kf,useFactory:function(){return`${X1()}${X1()}${X1()}`},deps:[]};function X1(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const UE=new Nn("Platform Initializer"),q1=new Nn("Platform ID"),bk=new Nn("appBootstrapListener");let K1=(()=>{class n{log(t){console.log(t)}warn(t){console.warn(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Xe({token:n,factory:n.\u0275fac}),n})();const pu=new Nn("LocaleId"),jE=new Nn("DefaultCurrencyCode");class Ek{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}const Q1=function(n){return new M1(n)},_k=Q1,Ik=function(n){return Promise.resolve(Q1(n))},WE=function(n){const e=Q1(n),r=Qs(_n(n).declarations).reduce((i,o)=>{const s=Et(o);return s&&i.push(new uE(s)),i},[]);return new Ek(e,r)},Ak=WE,Dk=function(n){return Promise.resolve(WE(n))};let Kh=(()=>{class n{constructor(){this.compileModuleSync=_k,this.compileModuleAsync=Ik,this.compileModuleAndAllComponentsSync=Ak,this.compileModuleAndAllComponentsAsync=Dk}clearCache(){}clearCacheFor(t){}getModuleId(t){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Xe({token:n,factory:n.\u0275fac}),n})();const Nk=(()=>Promise.resolve(0))();function $1(n){"undefined"==typeof Zone?Nk.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class Jr{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Ei(!1),this.onMicrotaskEmpty=new Ei(!1),this.onStable=new Ei(!1),this.onError=new Ei(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const i=this;i._nesting=0,i._outer=i._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(i._inner=i._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(i._inner=i._inner.fork(Zone.longStackTraceZoneSpec)),i.shouldCoalesceEventChangeDetection=!r&&t,i.shouldCoalesceRunChangeDetection=r,i.lastRequestAnimationFrameId=-1,i.nativeRequestAnimationFrame=function(){let n=kt.requestAnimationFrame,e=kt.cancelAnimationFrame;if("undefined"!=typeof Zone&&n&&e){const t=n[Zone.__symbol__("OriginalDelegate")];t&&(n=t);const r=e[Zone.__symbol__("OriginalDelegate")];r&&(e=r)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function(n){const e=()=>{!function(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(kt,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,J1(n),n.isCheckStableRunning=!0,Z1(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),J1(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,r,i,o,s,a)=>{try{return HE(n),t.invokeTask(i,o,s,a)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===o.type||n.shouldCoalesceRunChangeDetection)&&e(),zE(n)}},onInvoke:(t,r,i,o,s,a,c)=>{try{return HE(n),t.invoke(i,o,s,a,c)}finally{n.shouldCoalesceRunChangeDetection&&e(),zE(n)}},onHasTask:(t,r,i,o)=>{t.hasTask(i,o),r===i&&("microTask"==o.change?(n._hasPendingMicrotasks=o.microTask,J1(n),Z1(n)):"macroTask"==o.change&&(n.hasPendingMacrotasks=o.macroTask))},onHandleError:(t,r,i,o)=>(t.handleError(i,o),n.runOutsideAngular(()=>n.onError.emit(o)),!1)})}(i)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Jr.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Jr.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,t,r){return this._inner.run(e,t,r)}runTask(e,t,r,i){const o=this._inner,s=o.scheduleEventTask("NgZoneEvent: "+i,e,Mk,Ph,Ph);try{return o.runTask(s,t,r)}finally{o.cancelTask(s)}}runGuarded(e,t,r){return this._inner.runGuarded(e,t,r)}runOutsideAngular(e){return this._outer.run(e)}}const Mk={};function Z1(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function J1(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function HE(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function zE(n){n._nesting--,Z1(n)}class Pk{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Ei,this.onMicrotaskEmpty=new Ei,this.onStable=new Ei,this.onError=new Ei}run(e,t,r){return e.apply(t,r)}runGuarded(e,t,r){return e.apply(t,r)}runOutsideAngular(e){return e()}runTask(e,t,r,i){return e.apply(t,r)}}let em=(()=>{class n{constructor(t){this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Jr.assertNotInAngularZone(),$1(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())$1(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(t)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,r,i){let o=-1;r&&r>0&&(o=setTimeout(()=>{this._callbacks=this._callbacks.filter(s=>s.timeoutId!==o),t(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:t,timeoutId:o,updateCb:i})}whenStable(t,r,i){if(i&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,r,i),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(t,r,i){return[]}}return n.\u0275fac=function(t){return new(t||n)(Kt(Jr))},n.\u0275prov=Xe({token:n,factory:n.\u0275fac}),n})(),GE=(()=>{class n{constructor(){this._applications=new Map,tm.addToWindow(this)}registerApplication(t,r){this._applications.set(t,r)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,r=!0){return tm.findTestabilityInTree(this,t,r)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Xe({token:n,factory:n.\u0275fac}),n})();class kk{addToWindow(e){}findTestabilityInTree(e,t,r){return null}}let tm=new kk,YE=!0,XE=!1;let ps;const KE=new Nn("AllowMultipleToken");function QE(n,e,t=[]){const r=`Platform: ${e}`,i=new Nn(r);return(o=[])=>{let s=$E();if(!s||s.injector.get(KE,!1))if(n)n(t.concat(o).concat({provide:i,useValue:!0}));else{const a=t.concat(o).concat({provide:i,useValue:!0},{provide:If,useValue:"platform"});!function(n){if(ps&&!ps.destroyed&&!ps.injector.get(KE,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");ps=n.get(ZE);const e=n.get(UE,null);e&&e.forEach(t=>t())}(kn.create({providers:a,name:r}))}return function(n){const e=$E();if(!e)throw new Error("No platform exists!");if(!e.injector.get(n,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return e}(i)}}function $E(){return ps&&!ps.destroyed?ps:null}let ZE=(()=>{class n{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,r){const a=function(n,e){let t;return t="noop"===n?new Pk:("zone.js"===n?void 0:n)||new Jr({enableLongStackTrace:(XE=!0,YE),shouldCoalesceEventChangeDetection:!!(null==e?void 0:e.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==e?void 0:e.ngZoneRunCoalescing)}),t}(r?r.ngZone:void 0,{ngZoneEventCoalescing:r&&r.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:r&&r.ngZoneRunCoalescing||!1}),c=[{provide:Jr,useValue:a}];return a.run(()=>{const f=kn.create({providers:c,parent:this.injector,name:t.moduleType.name}),p=t.create(f),m=p.injector.get(Yu,null);if(!m)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return a.runOutsideAngular(()=>{const y=a.onError.subscribe({next:w=>{m.handleError(w)}});p.onDestroy(()=>{nm(this._modules,p),y.unsubscribe()})}),function(n,e,t){try{const r=t();return r1(r)?r.catch(i=>{throw e.runOutsideAngular(()=>n.handleError(i)),i}):r}catch(r){throw e.runOutsideAngular(()=>n.handleError(r)),r}}(m,a,()=>{const y=p.injector.get(yl);return y.runInitializers(),y.donePromise.then(()=>(c1(p.injector.get(pu,Nh)||Nh),this._moduleDoBootstrap(p),p))})})}bootstrapModule(t,r=[]){const i=JE({},r);return function(n,e,t){const r=new M1(t);return Promise.resolve(r)}(0,0,t).then(o=>this.bootstrapModuleFactory(o,i))}_moduleDoBootstrap(t){const r=t.injector.get(xl);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(i=>r.bootstrap(i));else{if(!t.instance.ngDoBootstrap)throw new Error(`The module ${ut(t.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);t.instance.ngDoBootstrap(r)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(t=>t.destroy()),this._destroyListeners.forEach(t=>t()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(t){return new(t||n)(Kt(kn))},n.\u0275prov=Xe({token:n,factory:n.\u0275fac}),n})();function JE(n,e){return Array.isArray(e)?e.reduce(JE,n):Object.assign(Object.assign({},n),e)}let xl=(()=>{class n{constructor(t,r,i,o,s){this._zone=t,this._injector=r,this._exceptionHandler=i,this._componentFactoryResolver=o,this._initStatus=s,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const a=new Ee(f=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{f.next(this._stable),f.complete()})}),c=new Ee(f=>{let p;this._zone.runOutsideAngular(()=>{p=this._zone.onStable.subscribe(()=>{Jr.assertNotInAngularZone(),$1(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,f.next(!0))})})});const m=this._zone.onUnstable.subscribe(()=>{Jr.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{f.next(!1)}))});return()=>{p.unsubscribe(),m.unsubscribe()}});this.isStable=qo(a,c.pipe(n=>Bs()(function(n,e){return function(r){let i;i="function"==typeof n?n:function(){return n};const o=Object.create(r,Qa);return o.source=r,o.subjectFactory=i,o}}(Yt)(n))))}bootstrap(t,r){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let i;i=t instanceof AC?t:this._componentFactoryResolver.resolveComponentFactory(t),this.componentTypes.push(i.componentType);const o=function(n){return n.isBoundToModule}(i)?void 0:this._injector.get(Qu),a=i.create(kn.NULL,[],r||i.selector,o),c=a.location.nativeElement,f=a.injector.get(em,null),p=f&&a.injector.get(GE);return f&&p&&p.registerApplication(c,f),a.onDestroy(()=>{this.detachView(a.hostView),nm(this.components,a),p&&p.unregisterApplication(c)}),this._loadComponent(a),a}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(t))}finally{this._runningTick=!1}}attachView(t){const r=t;this._views.push(r),r.attachToAppRef(this)}detachView(t){const r=t;nm(this._views,r),r.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(bk,[]).concat(this._bootstrapListeners).forEach(i=>i(t))}ngOnDestroy(){this._views.slice().forEach(t=>t.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return n.\u0275fac=function(t){return new(t||n)(Kt(Jr),Kt(kn),Kt(Yu),Kt(du),Kt(yl))},n.\u0275prov=Xe({token:n,factory:n.\u0275fac}),n})();function nm(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}const c8=QE(null,"core",[{provide:q1,useValue:"unknown"},{provide:ZE,deps:[kn]},{provide:GE,deps:[]},{provide:K1,deps:[]}]),p8=[{provide:xl,useClass:xl,deps:[Jr,kn,Yu,du,yl]},{provide:pP,deps:[Jr],useFactory:function(n){let e=[];return n.onStable.subscribe(()=>{for(;e.length;)e.pop()()}),function(t){e.push(t)}}},{provide:yl,useClass:yl,deps:[[new Xs,Xh]]},{provide:Kh,useClass:Kh,deps:[]},wk,{provide:kf,useFactory:function(){return aF},deps:[]},{provide:fl,useFactory:function(){return uF},deps:[]},{provide:pu,useFactory:function(n){return c1(n=n||"undefined"!=typeof $localize&&$localize.locale||Nh),n},deps:[[new gf(pu),new Xs,new zu]]},{provide:jE,useValue:"USD"}];let m8=(()=>{class n{constructor(t){}}return n.\u0275fac=function(t){return new(t||n)(Kt(xl))},n.\u0275mod=ct({type:n}),n.\u0275inj=Qi({providers:p8}),n})(),op=null;function ed(){return op}const Hi=new Nn("DocumentToken");var Tr=(()=>((Tr=Tr||{})[Tr.Zero=0]="Zero",Tr[Tr.One=1]="One",Tr[Tr.Two=2]="Two",Tr[Tr.Few=3]="Few",Tr[Tr.Many=4]="Many",Tr[Tr.Other=5]="Other",Tr))();const _L=function(n){return function(n){const e=function(n){return n.toLowerCase().replace(/_/g,"-")}(n);let t=eC(e);if(t)return t;const r=e.split("-")[0];if(t=eC(r),t)return t;if("en"===r)return B4;throw new Error(`Missing locale data for the locale "${n}".`)}(n)[Ve.PluralCase]};class gp{}let JL=(()=>{class n extends gp{constructor(t){super(),this.locale=t}getPluralCategory(t,r){switch(_L(r||this.locale)(t)){case Tr.Zero:return"zero";case Tr.One:return"one";case Tr.Two:return"two";case Tr.Few:return"few";case Tr.Many:return"many";default:return"other"}}}return n.\u0275fac=function(t){return new(t||n)(Kt(pu))},n.\u0275prov=Xe({token:n,factory:n.\u0275fac}),n})();class r6{constructor(e,t,r,i){this.$implicit=e,this.ngForOf=t,this.index=r,this.count=i}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let L_=(()=>{class n{constructor(t,r,i){this._viewContainer=t,this._template=r,this._differs=i,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;if(!this._differ&&t)try{this._differ=this._differs.find(t).create(this.ngForTrackBy)}catch(r){throw new Error(`Cannot find a differ supporting object '${t}' of type '${function(n){return n.name||typeof n}(t)}'. NgFor only supports binding to Iterables such as Arrays.`)}}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const r=[];t.forEachOperation((i,o,s)=>{if(null==i.previousIndex){const a=this._viewContainer.createEmbeddedView(this._template,new r6(null,this._ngForOf,-1,-1),null===s?void 0:s),c=new B_(i,a);r.push(c)}else if(null==s)this._viewContainer.remove(null===o?void 0:o);else if(null!==o){const a=this._viewContainer.get(o);this._viewContainer.move(a,s);const c=new B_(i,a);r.push(c)}});for(let i=0;i<r.length;i++)this._perViewChange(r[i].view,r[i].record);for(let i=0,o=this._viewContainer.length;i<o;i++){const s=this._viewContainer.get(i);s.context.index=i,s.context.count=o,s.context.ngForOf=this._ngForOf}t.forEachIdentityChange(i=>{this._viewContainer.get(i.currentIndex).context.$implicit=i.item})}_perViewChange(t,r){t.context.$implicit=r.item}static ngTemplateContextGuard(t,r){return!0}}return n.\u0275fac=function(t){return new(t||n)(Mt(na),Mt(Ia),Mt(kf))},n.\u0275dir=Je({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),n})();class B_{constructor(e,t){this.record=e,this.view=t}}let Cl=(()=>{class n{constructor(t,r){this._viewContainer=t,this._context=new o6,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){V_("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){V_("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,r){return!0}}return n.\u0275fac=function(t){return new(t||n)(Mt(na),Mt(Ia))},n.\u0275dir=Je({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),n})();class o6{constructor(){this.$implicit=null,this.ngIf=null}}function V_(n,e){if(e&&!e.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${ut(e)}'.`)}class f6{createSubscription(e,t){return e.subscribe({next:t,error:r=>{throw r}})}dispose(e){e.unsubscribe()}onDestroy(e){e.unsubscribe()}}class d6{createSubscription(e,t){return e.then(t,r=>{throw r})}dispose(e){}onDestroy(e){}}const h6=new d6,p6=new f6;let j_=(()=>{class n{constructor(t){this._ref=t,this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null}ngOnDestroy(){this._subscription&&this._dispose()}transform(t){return this._obj?t!==this._obj?(this._dispose(),this.transform(t)):this._latestValue:(t&&this._subscribe(t),this._latestValue)}_subscribe(t){this._obj=t,this._strategy=this._selectStrategy(t),this._subscription=this._strategy.createSubscription(t,r=>this._updateLatestValue(t,r))}_selectStrategy(t){if(r1(t))return h6;if(sb(t))return p6;throw function(n,e){return Error(`InvalidPipeArgument: '${e}' for pipe '${ut(n)}'`)}(n,t)}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(t,r){t===this._obj&&(this._latestValue=r,this._ref.markForCheck())}}return n.\u0275fac=function(t){return new(t||n)(Mt(y1,16))},n.\u0275pipe=St({name:"async",type:n,pure:!1}),n})(),N6=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ct({type:n}),n.\u0275inj=Qi({providers:[{provide:gp,useClass:JL}]}),n})();class Sm extends class extends class{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function(n){op||(op=n)}(new Sm)}onAndCancel(e,t,r){return e.addEventListener(t,r,!1),()=>{e.removeEventListener(t,r,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=(rd=rd||document.querySelector("base"),rd?rd.getAttribute("href"):null);return null==t?null:function(n){mp=mp||document.createElement("a"),mp.setAttribute("href",n);const e=mp.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){rd=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return function(n,e){e=encodeURIComponent(e);for(const t of n.split(";")){const r=t.indexOf("="),[i,o]=-1==r?[t,""]:[t.slice(0,r),t.slice(r+1)];if(i.trim()===e)return decodeURIComponent(o)}return null}(document.cookie,e)}}let mp,rd=null;const G_=new Nn("TRANSITION_ID"),U6=[{provide:Xh,useFactory:function(n,e,t){return()=>{t.get(yl).donePromise.then(()=>{const r=ed(),i=e.querySelectorAll(`style[ng-transition="${n}"]`);for(let o=0;o<i.length;o++)r.remove(i[o])})}},deps:[G_,Hi,kn],multi:!0}];class Nm{static init(){!function(n){tm=n}(new Nm)}addToWindow(e){kt.getAngularTestability=(r,i=!0)=>{const o=e.findTestabilityInTree(r,i);if(null==o)throw new Error("Could not find testability for element.");return o},kt.getAllAngularTestabilities=()=>e.getAllTestabilities(),kt.getAllAngularRootElements=()=>e.getAllRootElements(),kt.frameworkStabilizers||(kt.frameworkStabilizers=[]),kt.frameworkStabilizers.push(r=>{const i=kt.getAllAngularTestabilities();let o=i.length,s=!1;const a=function(c){s=s||c,o--,0==o&&r(s)};i.forEach(function(c){c.whenStable(a)})})}findTestabilityInTree(e,t,r){if(null==t)return null;const i=e.getTestability(t);return null!=i?i:r?ed().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null}}let j6=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Xe({token:n,factory:n.\u0275fac}),n})();const id=new Nn("EventManagerPlugins");let yp=(()=>{class n{constructor(t,r){this._zone=r,this._eventNameToPlugin=new Map,t.forEach(i=>i.manager=this),this._plugins=t.slice().reverse()}addEventListener(t,r,i){return this._findPluginFor(r).addEventListener(t,r,i)}addGlobalEventListener(t,r,i){return this._findPluginFor(r).addGlobalEventListener(t,r,i)}getZone(){return this._zone}_findPluginFor(t){const r=this._eventNameToPlugin.get(t);if(r)return r;const i=this._plugins;for(let o=0;o<i.length;o++){const s=i[o];if(s.supports(t))return this._eventNameToPlugin.set(t,s),s}throw new Error(`No event manager plugin found for event ${t}`)}}return n.\u0275fac=function(t){return new(t||n)(Kt(id),Kt(Jr))},n.\u0275prov=Xe({token:n,factory:n.\u0275fac}),n})();class Rm{constructor(e){this._doc=e}addGlobalEventListener(e,t,r){const i=ed().getGlobalEventTarget(this._doc,e);if(!i)throw new Error(`Unsupported event target ${i} for event ${t}`);return this.addEventListener(i,t,r)}}let X_=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(t){const r=new Set;t.forEach(i=>{this._stylesSet.has(i)||(this._stylesSet.add(i),r.add(i))}),this.onStylesAdded(r)}onStylesAdded(t){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Xe({token:n,factory:n.\u0275fac}),n})(),od=(()=>{class n extends X_{constructor(t){super(),this._doc=t,this._hostNodes=new Map,this._hostNodes.set(t.head,[])}_addStylesToHost(t,r,i){t.forEach(o=>{const s=this._doc.createElement("style");s.textContent=o,i.push(r.appendChild(s))})}addHost(t){const r=[];this._addStylesToHost(this._stylesSet,t,r),this._hostNodes.set(t,r)}removeHost(t){const r=this._hostNodes.get(t);r&&r.forEach(q_),this._hostNodes.delete(t)}onStylesAdded(t){this._hostNodes.forEach((r,i)=>{this._addStylesToHost(t,i,r)})}ngOnDestroy(){this._hostNodes.forEach(t=>t.forEach(q_))}}return n.\u0275fac=function(t){return new(t||n)(Kt(Hi))},n.\u0275prov=Xe({token:n,factory:n.\u0275fac}),n})();function q_(n){ed().remove(n)}const Mm={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},Om=/%COMP%/g;function xp(n,e,t){for(let r=0;r<e.length;r++){let i=e[r];Array.isArray(i)?xp(n,i,t):(i=i.replace(Om,n),t.push(i))}return t}function $_(n){return e=>{if("__ngUnwrap__"===e)return n;!1===n(e)&&(e.preventDefault(),e.returnValue=!1)}}let Fm=(()=>{class n{constructor(t,r,i){this.eventManager=t,this.sharedStylesHost=r,this.appId=i,this.rendererByCompId=new Map,this.defaultRenderer=new Pm(t)}createRenderer(t,r){if(!t||!r)return this.defaultRenderer;switch(r.encapsulation){case ke.Emulated:{let i=this.rendererByCompId.get(r.id);return i||(i=new nB(this.eventManager,this.sharedStylesHost,r,this.appId),this.rendererByCompId.set(r.id,i)),i.applyToHost(t),i}case 1:case ke.ShadowDom:return new rB(this.eventManager,this.sharedStylesHost,t,r);default:if(!this.rendererByCompId.has(r.id)){const i=xp(r.id,r.styles,[]);this.sharedStylesHost.addStyles(i),this.rendererByCompId.set(r.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(t){return new(t||n)(Kt(yp),Kt(od),Kt(Kf))},n.\u0275prov=Xe({token:n,factory:n.\u0275fac}),n})();class Pm{constructor(e){this.eventManager=e,this.data=Object.create(null)}destroy(){}createElement(e,t){return t?document.createElementNS(Mm[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){e.appendChild(t)}insertBefore(e,t,r){e&&e.insertBefore(t,r)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let r="string"==typeof e?document.querySelector(e):e;if(!r)throw new Error(`The selector "${e}" did not match any elements`);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,i){if(i){t=i+":"+t;const o=Mm[i];o?e.setAttributeNS(o,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){const i=Mm[r];i?e.removeAttributeNS(i,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,i){i&(xo.DashCase|xo.Important)?e.style.setProperty(t,r,i&xo.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&xo.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e[t]=r}setValue(e,t){e.nodeValue=t}listen(e,t,r){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,$_(r)):this.eventManager.addEventListener(e,t,$_(r))}}class nB extends Pm{constructor(e,t,r,i){super(e),this.component=r;const o=xp(i+"-"+r.id,r.styles,[]);t.addStyles(o),this.contentAttr=function(n){return"_ngcontent-%COMP%".replace(Om,n)}(i+"-"+r.id),this.hostAttr=function(n){return"_nghost-%COMP%".replace(Om,n)}(i+"-"+r.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}}class rB extends Pm{constructor(e,t,r,i){super(e),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const o=xp(i.id,i.styles,[]);for(let s=0;s<o.length;s++){const a=document.createElement("style");a.textContent=o[s],this.shadowRoot.appendChild(a)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let iB=(()=>{class n extends Rm{constructor(t){super(t)}supports(t){return!0}addEventListener(t,r,i){return t.addEventListener(r,i,!1),()=>this.removeEventListener(t,r,i)}removeEventListener(t,r,i){return t.removeEventListener(r,i)}}return n.\u0275fac=function(t){return new(t||n)(Kt(Hi))},n.\u0275prov=Xe({token:n,factory:n.\u0275fac}),n})();const eI=["alt","control","meta","shift"],fB={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},tI={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},dB={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let hB=(()=>{class n extends Rm{constructor(t){super(t)}supports(t){return null!=n.parseEventName(t)}addEventListener(t,r,i){const o=n.parseEventName(r),s=n.eventCallback(o.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>ed().onAndCancel(t,o.domEventName,s))}static parseEventName(t){const r=t.toLowerCase().split("."),i=r.shift();if(0===r.length||"keydown"!==i&&"keyup"!==i)return null;const o=n._normalizeKey(r.pop());let s="";if(eI.forEach(c=>{const f=r.indexOf(c);f>-1&&(r.splice(f,1),s+=c+".")}),s+=o,0!=r.length||0===o.length)return null;const a={};return a.domEventName=i,a.fullKey=s,a}static getEventFullKey(t){let r="",i=function(n){let e=n.key;if(null==e){if(e=n.keyIdentifier,null==e)return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===n.location&&tI.hasOwnProperty(e)&&(e=tI[e]))}return fB[e]||e}(t);return i=i.toLowerCase()," "===i?i="space":"."===i&&(i="dot"),eI.forEach(o=>{o!=i&&dB[o](t)&&(r+=o+".")}),r+=i,r}static eventCallback(t,r,i){return o=>{n.getEventFullKey(o)===t&&i.runGuarded(()=>r(o))}}static _normalizeKey(t){switch(t){case"esc":return"escape";default:return t}}}return n.\u0275fac=function(t){return new(t||n)(Kt(Hi))},n.\u0275prov=Xe({token:n,factory:n.\u0275fac}),n})();const bB=QE(c8,"browser",[{provide:q1,useValue:"browser"},{provide:UE,useValue:function(){Sm.makeCurrent(),Nm.init()},multi:!0},{provide:Hi,useFactory:function(){return function(n){de=n}(document),document},deps:[]}]),CB=[[],{provide:If,useValue:"root"},{provide:Yu,useFactory:function(){return new Yu},deps:[]},{provide:id,useClass:iB,multi:!0,deps:[Hi,Jr,q1]},{provide:id,useClass:hB,multi:!0,deps:[Hi]},[],{provide:Fm,useClass:Fm,deps:[yp,od,Kf]},{provide:kh,useExisting:Fm},{provide:X_,useExisting:od},{provide:od,useClass:od,deps:[Hi]},{provide:em,useClass:em,deps:[Jr]},{provide:yp,useClass:yp,deps:[id,Jr]},{provide:class{},useClass:j6,deps:[]},[]];let EB=(()=>{class n{constructor(t){if(t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(t){return{ngModule:n,providers:[{provide:Kf,useValue:t.appId},{provide:G_,useExisting:Kf},U6]}}}return n.\u0275fac=function(t){return new(t||n)(Kt(n,12))},n.\u0275mod=ct({type:n}),n.\u0275inj=Qi({providers:CB,imports:[N6,m8]}),n})();function rI(n,e,t,r,i,o,s){try{var a=n[o](s),c=a.value}catch(f){return void t(f)}a.done?e(c):Promise.resolve(c).then(r,i)}function Nr(n){return function(){var e=this,t=arguments;return new Promise(function(r,i){var o=n.apply(e,t);function s(c){rI(o,r,i,s,a,"next",c)}function a(c){rI(o,r,i,s,a,"throw",c)}s(void 0)})}}"undefined"!=typeof window&&window;var RB=ve(394);const xs_faceApiSourceUrl="https://cdn.jsdelivr.net/gh/cgarciagl/face-api.js/weights",MB={modelComplexity:1,smoothLandmarks:!0,enableSegmentation:!0,smoothSegmentation:!0,minDetectionConfidence:.5,minTrackingConfidence:.5};let OB=(()=>{class n{constructor(){this.initTempPoseInstance()}getPoseInstance(t,r=MB){var i=this;return Nr(function*(){const o=yield i.useTempPoseInstance();return o.setOptions(r),o.onResults(t),o})()}useTempPoseInstance(){var t=this;return Nr(function*(){let r;return t._poseInstance?r=t._poseInstance:(r=yield t.createTempPoseInstance(),t.initTempPoseInstance()),r})()}initTempPoseInstance(){var t=this;return Nr(function*(){t._poseInstance=yield t.createTempPoseInstance()})()}createTempPoseInstance(){return Nr(function*(){const t=new RB.Pose({locateFile:r=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5.1635988162/${r}`});return yield t.initialize(),t})()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Xe({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var iI=function(n,e){return(iI=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])})(n,e)};function ws(n,e){function t(){this.constructor=n}iI(n,e),n.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}function qe(n,e,t,r){return new(t||(t=Promise))(function(i,o){function s(f){try{c(r.next(f))}catch(p){o(p)}}function a(f){try{c(r.throw(f))}catch(p){o(p)}}function c(f){f.done?i(f.value):new t(function(p){p(f.value)}).then(s,a)}c((r=r.apply(n,e||[])).next())})}function Ke(n,e){var t,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(f){return function(p){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,r&&(i=2&p[0]?r.return:p[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,p[1])).done)return i;switch(r=0,i&&(p=[2&p[0],i.value]),p[0]){case 0:case 1:i=p;break;case 4:return s.label++,{value:p[1],done:!1};case 5:s.label++,r=p[1],p=[0];continue;case 7:p=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===p[0]||2===p[0])){s=0;continue}if(3===p[0]&&(!i||p[1]>i[0]&&p[1]<i[3])){s.label=p[1];break}if(6===p[0]&&s.label<i[1]){s.label=i[1],i=p;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(p);break}i[2]&&s.ops.pop(),s.trys.pop();continue}p=e.call(n,s)}catch(m){p=[6,m],r=0}finally{t=i=0}if(5&p[0])throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}([c,f])}}}var FB=function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},null!=this.urlFlags[e]){var i=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+i+"."),this.set(e,i)}},n.prototype.get=function(e){return e in this.flags||(this.flags[e]=this.evaluateFlag(e)),this.flags[e]},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),n.prototype.set=function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var r,i=(r={},this.global.location.search.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(o){for(var s=[],a=1;a<arguments.length;a++)s[a-1]=arguments[a];return PB(r,s[0],s[1]),s.join("=")}),r);"tfjsflags"in i&&i.tfjsflags.split(",").forEach(function(o){var s=o.split(":"),a=s[0];e.urlFlags[a]=function(f,p){if("true"===(p=p.toLowerCase())||"false"===p)return"true"===p;if(""+ +p===p)return+p;throw new Error("Could not parse value flag value "+p+" for flag "+f+".")}(a,s[1])})}},n}();function PB(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function le(){return oI}var oI=null,El=new Map,sd=new Map;function sI(n,e){var t=Um(n,e);return El.get(t)}function aI(n){for(var e=El.entries(),t=[];;){var r=e.next(),o=r.value;if(r.done)break;var a=o[1];o[0].split("_")[0]===n&&t.push(a)}return t}function uI(n){var e=n.kernelName,t=n.backendName,r=Um(e,t);if(El.has(r))throw new Error("The kernel '"+e+"' for backend '"+t+"' is already registered");El.set(r,n)}function LB(n){var e=n.kernelName;sd.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),sd.set(e,n)}function Um(n,e){return e+"_"+n}function cI(n){for(var e=n.length,t=0,r=0;e>0;)r=Math.random()*e|0,t=n[--e],n[e]=n[r],n[r]=t}function wp(n,e,t){return Math.max(n,Math.min(e,t))}function jm(n){return n%2==0?n:n+1}function lI(n){for(var e=0,t=0;t<n.length;t++)e+=n[t];return e}function H(n,e){if(!n)throw new Error("string"==typeof e?e:e())}function fn(n,e,t){void 0===t&&(t=""),H(Rr(n,e),function(){return t+" Shapes "+n+" and "+e+" must match"})}function tc(n){H(null!=n,function(){return"The input to the tensor constructor must be a non-null value."})}function Ta(n,e,t){if(void 0===e&&(e=[]),void 0===t&&(t=!1),null==e&&(e=[]),Array.isArray(n)||ui(n)&&!t)for(var r=0;r<n.length;++r)Ta(n[r],e,t);else e.push(n);return e}function $e(n){if(0===n.length)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function Rr(n,e){if(n===e)return!0;if(null==n||null==e||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function ir(n){return n%1==0}function fI(n){if(null!=Math.tanh)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var e=Math.exp(2*n);return(e-1)/(e+1)}function bp(n){var e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function nc(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function Wm(n,e,t){return void 0===e&&(e=function(r){return 0}),new Promise(function(r,i){var o=0,s=function(){if(n())r();else{o++;var a=e(o);null!=t&&o>=t?i():setTimeout(s,a)}};s()})}function dI(n,e){for(var t=1,r=-1,i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(-1===n[i]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(n[i]<0)throw Error("Shapes can not be < 0. Found "+n[i]+" at dim "+i);if(-1===r){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+n);return n}if(0===t)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var o=n.slice();return o[r]=e/t,o}function Mr(n,e){var t=e.length;return H((n=null==n?e.map(function(r,i){return i}):[].concat(n)).every(function(r){return r>=-t&&r<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+n}),H(n.every(function(r){return ir(r)}),function(){return"All values in axis param must be integers but got axis "+n}),n.map(function(r){return r<0?t+r:r})}function vu(n,e){for(var t=[],r=[],i=null!=e&&Array.isArray(e)&&0===e.length,o=null==e||i?null:Mr(e,n).sort(),s=0,a=0;a<n.length;++a){if(null!=o){if(o[s]===a&&1!==n[a])throw new Error("Can't squeeze axis "+a+" since its dim '"+n[a]+"' is not 1");(null==o[s]||o[s]>a)&&1===n[a]&&(t.push(n[a]),r.push(a)),o[s]<=a&&s++}1!==n[a]&&(t.push(n[a]),r.push(a))}return{newShape:t,keptDims:r}}function _l(n,e){var t=null;if(null==n||"float32"===n)t=new Float32Array(e);else if("int32"===n)t=new Int32Array(e);else{if("bool"!==n)throw new Error("Unknown data type "+n);t=new Uint8Array(e)}return t}function ad(n,e){var t=null;if(null==n||"float32"===n)t=new Float32Array(e);else if("int32"===n)t=new Int32Array(e);else if("bool"===n)t=new Uint8Array(e);else{if("string"!==n)throw new Error("Unknown data type "+n);t=new Array(e)}return t}function hI(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function pI(n){return"bool"===n||"complex64"===n||"float32"===n||"int32"===n||"string"===n}function gI(n,e){return!("complex64"===e||"float32"===e&&"complex64"!==n||"int32"===e&&"float32"!==n&&"complex64"!==n||"bool"===e&&"bool"===n)}function ui(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function Hm(n){if("float32"===n||"int32"===n)return 4;if("complex64"===n)return 8;if("bool"===n)return 1;throw new Error("Unknown dtype "+n)}function mI(n){if(null==n)return 0;var e=0;return n.forEach(function(t){return e+=t.length}),e}function yu(n){return"string"==typeof n||n instanceof String}function vI(n){return"boolean"==typeof n}function yI(n){return"number"==typeof n}function Il(n){return Array.isArray(n)?Il(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":yI(n)?"float32":yu(n)?"string":vI(n)?"bool":"float32"}function xu(n){return!!(n&&n.constructor&&n.call&&n.apply)}function Cp(n,e){for(var t=e;t<n;++t)if(n%t==0)return t;return n}function bs(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function zm(n,e,t){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Ta(n)),t&&hI(n,e),s=e,(o=n)instanceof Float32Array&&"float32"===s||o instanceof Int32Array&&"int32"===s||o instanceof Uint8Array&&"bool"===s)return n;var o,s;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(n);if("int32"===e)return new Int32Array(n);if("bool"===e){for(var r=new Uint8Array(n.length),i=0;i<r.length;++i)0!==Math.round(n[i])&&(r[i]=1);return r}throw new Error("Unknown data type "+e)}function Gm(n,e){if(0===n.length)return e[0];var t=n.reduce(function(r,i){return r*i});if(0===t)return[];if(t!==e.length)throw new Error("["+n+"] does not match the input size.");return function r(i,o,s){var a=new Array;if(1===o.length)for(var c=o[0],f=0;f<c;f++)a[f]=s[i+f];else{c=o[0];var p=o.slice(1),m=p.reduce(function(y,w){return y*w});for(f=0;f<c;f++)a[f]=r(i+f*m,p,s)}return a}(0,n,e)}function Ym(n,e){for(var t=Al(n,e),r=0;r<t.length;r++)t[r]=1;return t}function Al(n,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(n);if("int32"===e)return new Int32Array(n);if("bool"===e)return new Uint8Array(n);throw new Error("Unknown data type "+e)}function Cs(){return le().platform.now()}function Xm(n){n.forEach(function(e){H(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."})})}function xI(n,e){return void 0===e&&(e="utf-8"),e=e||"utf-8",le().platform.encode(n,e)}function ud(n,e){return void 0===e&&(e="utf-8"),e=e||"utf-8",le().platform.decode(n,e)}function qm(n,e,t){if(0===e)return 0;if(1===e)return n[0];for(var r=n[n.length-1],i=0;i<n.length-1;++i)r+=t[i]*n[i];return r}function wI(n,e,t){if(0===e)return[];if(1===e)return[n];for(var r=new Array(e),i=0;i<r.length-1;++i)r[i]=Math.floor(n/t[i]),n-=r[i]*t[i];return r[r.length-1]=n,r}Object.freeze({shuffle:cI,clamp:wp,nearestLargerEven:jm,sum:lI,randUniform:function(n,e){var t=Math.random();return e*t+(1-t)*n},distSquared:function(n,e){for(var t=0,r=0;r<n.length;r++){var i=Number(n[r])-Number(e[r]);t+=i*i}return t},assert:H,assertShapesMatch:fn,assertNonNull:tc,flatten:Ta,sizeFromShape:$e,isScalarShape:function(n){return 0===n.length},arraysEqual:Rr,isInt:ir,tanh:fI,sizeToSquarishShape:bp,createShuffledIndices:function(n){for(var e=new Uint32Array(n),t=0;t<n;++t)e[t]=t;return cI(e),e},rightPad:nc,repeatedTry:Wm,inferFromImplicitShape:dI,parseAxisParam:Mr,squeezeShape:vu,getTypedArrayFromDType:_l,getArrayFromDType:ad,checkConversionForErrors:hI,isValidDtype:pI,hasEncodingLoss:gI,isTypedArray:ui,bytesPerElement:Hm,bytesFromStringArray:mI,isString:yu,isBoolean:vI,isNumber:yI,inferDtype:Il,isFunction:xu,nearestDivisor:Cp,computeStrides:bs,toTypedArray:zm,toNestedArray:Gm,makeOnesTypedArray:Ym,makeZerosTypedArray:Al,now:Cs,assertNonNegativeIntegerDimensions:Xm,fetch:function(n,e){return le().platform.fetch(n,e)},encodeString:xI,decodeString:ud,locToIndex:qm,indexToLoc:wI});var BB=function(){function n(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new VB)}return n.prototype.profileKernel=function(e,t,r){var i,o=this,s=this.backendTimer.time(function(){i=r()});return i.forEach(function(a){a.data().then(function(c){(function(f,p,m){if("float32"!==p)return!1;for(var y=0;y<f.length;y++){var w=f[y];if(isNaN(w)||!isFinite(w))return console.warn("Found "+w+" in the result of '"+m+"'"),!0}})(c,a.dtype,e),s.then(function(f){var p="";null!=f.getExtraProfileInfo&&(p=f.getExtraProfileInfo()),o.logger.logKernelProfile(e,a,c,f.kernelMs,t,p)})})}),i},n}(),VB=function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,i,o,s){var a="number"==typeof i?nc(i+"ms",9):i.error,c=nc(e,25),f=t.rank,p=t.size,m=nc(t.shape.toString(),14),y="";for(var w in o){var E=o[w].shape||t.shape,A=E.length;y+=w+": "+A+"D "+(A>0?E:"")+" "}console.log("%c"+c+"\t%c"+a+"\t%c"+f+"D "+m+"\t%c"+p+"\t%c"+y+"\t%c"+s,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n}();function ld(n,e,t){return nc(Array.isArray(n)?parseFloat(n[0].toFixed(7))+" + "+parseFloat(n[1].toFixed(7))+"j":yu(n)?"'"+n+"'":"bool"===t?CI(n):parseFloat(n.toFixed(7)).toString(),e)}function CI(n){return 0===n?"false":"true"}function fd(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var dd=function(){function n(e,t,r){var i=this;if(this.dtype=t,this.shape=e.slice(),this.size=$e(e),null!=r){var o=r.length;H(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+i.size+"'."})}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||ad(t,this.size),this.strides=bs(e)}return n.prototype.set=function(e){for(var t=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];0===r.length&&(r=[0]),H(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+t.rank+")"});var o=this.locToIndex(r);this.values[o]=e},n.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var r=0,i=0,o=e;i<o.length;i++){var s=o[i];if(s<0||s>=this.shape[r]){var a="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(a)}r++}for(var c=e[e.length-1],f=0;f<e.length-1;++f)c+=this.strides[f]*e[f];return this.values[c]},n.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return ra().makeTensor(this.values,this.shape,this.dtype)},n}(),ra=null,ue=null,EI=null,Fn=function(){function n(e,t,r,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=$e(e),this.strides=bs(e),this.dataId=r,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}return n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),H(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},n.prototype.as3D=function(e,t,r){return this.throwIfDisposed(),this.reshape([e,t,r])},n.prototype.as4D=function(e,t,r,i){return this.throwIfDisposed(),this.reshape([e,t,r,i])},n.prototype.as5D=function(e,t,r,i,o){return this.throwIfDisposed(),this.reshape([e,t,r,i,o])},n.prototype.asType=function(e){return this.throwIfDisposed(),ue.cast(this,e)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return qe(this,void 0,void 0,function(){var e;return Ke(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,ue.buffer(this.shape,this.dtype,e)]}})})},n.prototype.bufferSync=function(){return ue.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return qe(this,void 0,void 0,function(){var e;return Ke(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Gm(this.shape,e)]}})})},n.prototype.arraySync=function(){return Gm(this.shape,this.dataSync())},n.prototype.data=function(){return qe(this,void 0,void 0,function(){var e,t;return Ke(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=ra().read(this.dataId),"string"!==this.dtype?[3,2]:[4,e];case 1:t=r.sent();try{return[2,t.map(function(i){return ud(i)})]}catch(i){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}})})},n.prototype.dataSync=function(){this.throwIfDisposed();var e=ra().readSync(this.dataId);if("string"===this.dtype)try{return e.map(function(t){return ud(t)})}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},n.prototype.bytes=function(){return qe(this,void 0,void 0,function(){var e;return Ke(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,ra().read(this.dataId)];case 1:return e=t.sent(),"string"===this.dtype?[2,e]:[2,new Uint8Array(e.buffer)]}})})},n.prototype.dispose=function(){this.isDisposed||(ra().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(e){return void 0===e&&(e=!1),ue.print(this,e)},n.prototype.reshape=function(e){return this.throwIfDisposed(),ue.reshape(this,e)},n.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},n.prototype.expandDims=function(e){return void 0===e&&(e=0),ue.expandDims(this,e)},n.prototype.cumsum=function(e,t,r){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===r&&(r=!1),ue.cumsum(this,e,t,r)},n.prototype.squeeze=function(e){return this.throwIfDisposed(),ue.squeeze(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),ue.clone(this)},n.prototype.oneHot=function(e,t,r){return this.throwIfDisposed(),ue.oneHot(this,e,t,r)},n.prototype.toString=function(e){return void 0===e&&(e=!1),function(n,e,t,r){var i=bs(e),o=function(f,p,m,y){var w=$e(p),E=y[y.length-1],A=new Array(E).fill(0),_=p.length,T="complex64"===m?fd(f):f;if(_>1)for(var N=0;N<w/E;N++)for(var M=N*E,R=0;R<E;R++)A[R]=Math.max(A[R],ld(T[M+R],0,m).length);return A}(n,e,t,i),s=e.length,a=function f(p,m,y,w,E,A){void 0===A&&(A=!0);var _="complex64"===y?2:1,T=m[0],N=m.length;if(0===N)return"complex64"===y?[ld(fd(p)[0],0,y)]:"bool"===y?[CI(p[0])]:[p[0].toString()];if(1===N){if(T>20){var R=Array.from(p.slice(0,3*_)),P=Array.from(p.slice((T-3)*_,T*_));return"complex64"===y&&(R=fd(R),P=fd(P)),["["+R.map(function(he,xe){return ld(he,E[xe],y)}).join(", ")+", ..., "+P.map(function(he,xe){return ld(he,E[T-3+xe],y)}).join(", ")+"]"]}return["["+("complex64"===y?fd(p):Array.from(p)).map(function(he,xe){return ld(he,E[xe],y)}).join(", ")+"]"]}var B=m.slice(1),Y=w.slice(1),X=w[0]*_,z=[];if(T>20){for(var G=0;G<3;G++){var ee=(J=G*X)+X;z.push.apply(z,f(p.slice(J,ee),B,y,Y,E,!1))}for(z.push("..."),G=T-3;G<T;G++)ee=(J=G*X)+X,z.push.apply(z,f(p.slice(J,ee),B,y,Y,E,G===T-1))}else for(G=0;G<T;G++){var J;ee=(J=G*X)+X,z.push.apply(z,f(p.slice(J,ee),B,y,Y,E,G===T-1))}var pe=2===N?",":"";for(z[0]="["+z[0]+pe,G=1;G<z.length-1;G++)z[G]=" "+z[G]+pe;var fe=",\n";for(G=2;G<N;G++)fe+="\n";return z[z.length-1]=" "+z[z.length-1]+"]"+(A?"":fe),z}(n,e,t,i,o),c=["Tensor"];return r&&(c.push("  dtype: "+t),c.push("  rank: "+s),c.push("  shape: ["+e+"]"),c.push("  values:")),c.push(a.map(function(f){return"    "+f}).join("\n")),c.join("\n")}(this.dataSync(),this.shape,this.dtype,e)},n.prototype.tile=function(e){return this.throwIfDisposed(),ue.tile(this,e)},n.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),ue.gather(this,e,t)},n.prototype.matMul=function(e,t,r){return void 0===t&&(t=!1),void 0===r&&(r=!1),this.throwIfDisposed(),ue.matMul(this,e,t,r)},n.prototype.dot=function(e){return this.throwIfDisposed(),ue.dot(this,e)},n.prototype.norm=function(e,t,r){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===r&&(r=!1),this.throwIfDisposed(),ue.norm(this,e,t,r)},n.prototype.slice=function(e,t){return this.throwIfDisposed(),ue.slice(this,e,t)},n.prototype.reverse=function(e){return this.throwIfDisposed(),ue.reverse(this,e)},n.prototype.concat=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),e instanceof n&&(e=[e]),ue.concat([this].concat(e),t)},n.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),ue.split(this,e,t)},n.prototype.stack=function(e,t){return void 0===t&&(t=0),ue.stack([this,e],t)},n.prototype.unstack=function(e){return void 0===e&&(e=0),ue.unstack(this,e)},n.prototype.pad=function(e,t){return void 0===t&&(t=0),ue.pad(this,e,t)},n.prototype.batchNormalization=function(e,t,r,i,o){return void 0===r&&(r=.001),EI("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,o,i,r)},n.prototype.batchNorm=function(e,t,r,i,o){return void 0===o&&(o=.001),this.throwIfDisposed(),ue.batchNorm(this,e,t,r,i,o)},n.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ue.all(this,e,t)},n.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ue.any(this,e,t)},n.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ue.logSumExp(this,e,t)},n.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ue.sum(this,e,t)},n.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ue.prod(this,e,t)},n.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ue.mean(this,e,t)},n.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ue.min(this,e,t)},n.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ue.max(this,e,t)},n.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),ue.argMin(this,e)},n.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),ue.argMax(this,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),ue.cast(this,e)},n.prototype.add=function(e){return this.throwIfDisposed(),ue.add(this,e)},n.prototype.addStrict=function(e){return this.throwIfDisposed(),ue.addStrict(this,e)},n.prototype.atan2=function(e){return this.throwIfDisposed(),ue.atan2(this,e)},n.prototype.sub=function(e){return this.throwIfDisposed(),ue.sub(this,e)},n.prototype.subStrict=function(e){return this.throwIfDisposed(),ue.subStrict(this,e)},n.prototype.pow=function(e){return this.throwIfDisposed(),ue.pow(this,e)},n.prototype.powStrict=function(e){return this.throwIfDisposed(),ue.powStrict(this,e)},n.prototype.mul=function(e){return this.throwIfDisposed(),ue.mul(this,e)},n.prototype.mulStrict=function(e){return this.throwIfDisposed(),ue.mulStrict(this,e)},n.prototype.div=function(e){return this.throwIfDisposed(),ue.div(this,e)},n.prototype.divNoNan=function(e){return this.throwIfDisposed(),ue.divNoNan(this,e)},n.prototype.floorDiv=function(e){return this.throwIfDisposed(),ue.floorDiv(this,e)},n.prototype.divStrict=function(e){return this.throwIfDisposed(),ue.divStrict(this,e)},n.prototype.minimum=function(e){return this.throwIfDisposed(),ue.minimum(this,e)},n.prototype.minimumStrict=function(e){return this.throwIfDisposed(),ue.minimumStrict(this,e)},n.prototype.maximum=function(e){return this.throwIfDisposed(),ue.maximum(this,e)},n.prototype.maximumStrict=function(e){return this.throwIfDisposed(),ue.maximumStrict(this,e)},n.prototype.mod=function(e){return this.throwIfDisposed(),ue.mod(this,e)},n.prototype.modStrict=function(e){return this.throwIfDisposed(),ue.modStrict(this,e)},n.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),ue.squaredDifferenceStrict(this,e)},n.prototype.transpose=function(e){return this.throwIfDisposed(),ue.transpose(this,e)},n.prototype.notEqual=function(e){return this.throwIfDisposed(),ue.notEqual(this,e)},n.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),ue.notEqualStrict(this,e)},n.prototype.less=function(e){return this.throwIfDisposed(),ue.less(this,e)},n.prototype.lessStrict=function(e){return this.throwIfDisposed(),ue.lessStrict(this,e)},n.prototype.equal=function(e){return this.throwIfDisposed(),ue.equal(this,e)},n.prototype.equalStrict=function(e){return this.throwIfDisposed(),ue.equalStrict(this,e)},n.prototype.lessEqual=function(e){return this.throwIfDisposed(),ue.lessEqual(this,e)},n.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),ue.lessEqualStrict(this,e)},n.prototype.greater=function(e){return this.throwIfDisposed(),ue.greater(this,e)},n.prototype.greaterStrict=function(e){return this.throwIfDisposed(),ue.greaterStrict(this,e)},n.prototype.greaterEqual=function(e){return this.throwIfDisposed(),ue.greaterEqual(this,e)},n.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),ue.greaterEqualStrict(this,e)},n.prototype.logicalAnd=function(e){return this.throwIfDisposed(),ue.logicalAnd(this,e)},n.prototype.logicalOr=function(e){return this.throwIfDisposed(),ue.logicalOr(this,e)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),ue.logicalNot(this)},n.prototype.logicalXor=function(e){return this.throwIfDisposed(),ue.logicalXor(this,e)},n.prototype.where=function(e,t){return this.throwIfDisposed(),ue.where(e,this,t)},n.prototype.neg=function(){return this.throwIfDisposed(),ue.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),ue.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),ue.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),ue.sign(this)},n.prototype.isNaN=function(){return this.throwIfDisposed(),ue.isNaN(this)},n.prototype.isInf=function(){return this.throwIfDisposed(),ue.isInf(this)},n.prototype.isFinite=function(){return this.throwIfDisposed(),ue.isFinite(this)},n.prototype.exp=function(){return this.throwIfDisposed(),ue.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),ue.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),ue.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),ue.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),ue.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),ue.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),ue.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),ue.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),ue.abs(this)},n.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),ue.clipByValue(this,e,t)},n.prototype.relu=function(){return this.throwIfDisposed(),ue.relu(this)},n.prototype.relu6=function(){return this.throwIfDisposed(),ue.relu6(this)},n.prototype.elu=function(){return this.throwIfDisposed(),ue.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),ue.selu(this)},n.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),ue.leakyRelu(this,e)},n.prototype.prelu=function(e){return this.throwIfDisposed(),ue.prelu(this,e)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),ue.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),ue.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),ue.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),ue.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),ue.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),ue.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),ue.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),ue.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),ue.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),ue.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),ue.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),ue.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),ue.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),ue.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),ue.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),ue.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),ue.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),ue.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),ue.round(this)},n.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),ue.step(this,e)},n.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),ue.softmax(this,e)},n.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),ue.logSoftmax(this,e)},n.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),ue.image.resizeBilinear(this,e,t)},n.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),ue.image.resizeNearestNeighbor(this,e,t)},n.prototype.conv1d=function(e,t,r,i,o,s){return void 0===i&&(i="NWC"),void 0===o&&(o=1),this.throwIfDisposed(),ue.conv1d(this,e,t,r,i,o,s)},n.prototype.conv2d=function(e,t,r,i,o,s){return void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),ue.conv2d(this,e,t,r,i,o,s)},n.prototype.conv2dTranspose=function(e,t,r,i,o){return this.throwIfDisposed(),ue.conv2dTranspose(this,e,t,r,i,o)},n.prototype.depthwiseConv2D=function(e,t,r,i,o,s){return void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),ue.depthwiseConv2d(this,e,t,r,i,o,s)},n.prototype.separableConv2d=function(e,t,r,i,o,s){return void 0===o&&(o=[1,1]),void 0===s&&(s="NHWC"),this.throwIfDisposed(),ue.separableConv2d(this,e,t,r,i,o,s)},n.prototype.avgPool=function(e,t,r,i){return this.throwIfDisposed(),ue.avgPool(this,e,t,r,i)},n.prototype.maxPool=function(e,t,r,i){return this.throwIfDisposed(),ue.maxPool(this,e,t,r,i)},n.prototype.localResponseNormalization=function(e,t,r,i){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===r&&(r=1),void 0===i&&(i=.5),ue.localResponseNormalization(this,e,t,r,i)},n.prototype.pool=function(e,t,r,i,o){return this.throwIfDisposed(),ue.pool(this,e,t,r,i,o)},n.prototype.variable=function(e,t,r){return void 0===e&&(e=!0),this.throwIfDisposed(),ra().makeVariable(this,e,t,r)},n.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),ue.unsortedSegmentSum(this,e,t)},n.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),ue.batchToSpaceND(this,e,t)},n.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),ue.spaceToBatchND(this,e,t)},n.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),ue.topk(this,e,t)},n.prototype.stridedSlice=function(e,t,r,i,o,s,a,c){return void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===c&&(c=0),this.throwIfDisposed(),ue.stridedSlice(this,e,t,r,i,o,s,a,c)},n.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),ue.depthToSpace(this,e,t)},n.prototype.fft=function(){return this.throwIfDisposed(),ue.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),ue.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),ue.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),ue.spectral.irfft(this)},n}();Object.defineProperty(Fn,Symbol.hasInstance,{value:function(n){return!!n&&null!=n.dataId&&null!=n.shape&&null!=n.dtype}});var _I,Qm,$m,Zm,Jm,Dl=function(n){function e(t,r,i,o){var s=n.call(this,t.shape,t.dtype,t.dataId,o)||this;return s.trainable=r,s.name=i,s}return ws(e,n),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!Rr(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");ra().disposeTensor(this),this.dataId=t.dataId,ra().incRef(this,null)},e.prototype.dispose=function(){ra().disposeVariable(this),this.isDisposedInternal=!0},e}(Fn);Object.defineProperty(Dl,Symbol.hasInstance,{value:function(n){return n instanceof Fn&&null!=n.assign&&n.assign instanceof Function}}),function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"}(_I||(_I={})),function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"}(Qm||(Qm={})),function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"}($m||($m={})),function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"}(Zm||(Zm={})),function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"}(Jm||(Jm={}));var jB={float32:Zm,int32:Qm,bool:$m,complex64:Jm};function ni(n,e){if("string"===n||"string"===e){if("string"===n&&"string"===e)return"string";throw new Error("Can not upcast "+n+" with "+e)}return jB[n][e]}function ev(n){return ni(n,"int32")}function $n(n,e){if(n.dtype===e.dtype)return[n,e];var t=ni(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function II(n,e){H(n.dtype===e.dtype,function(){return"The dtypes of the first("+n.dtype+") and second("+e.dtype+") input must match"})}function tv(n){var e=[];return function t(r,i,o){if(null!=r){if(r instanceof Fn)return void i.push(r);if(s=r,Array.isArray(s)||"object"==typeof s){var s,a=r;for(var c in a){var f=a[c];o.has(f)||(o.add(f),t(f,i,o))}}}}(n,e,new Set),e}Object.freeze({makeTypesMatch:$n,assertTypesMatch:II,isTensorInList:function(n,e){return e.some(function(t){return t.id===n.id})},getTensorsInContainer:tv});var nv,AI=function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n}(),WB=function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new AI}return n.prototype.ready=function(){return qe(this,void 0,void 0,function(){var e,t,r;return Ke(this,function(i){switch(i.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?[4,this.initializeBackend(r=e[t]).success]:[3,5];case 2:return i.sent()?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(n.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){return e in this.registry||e in this.registryFactory&&!this.initializeBackend(e).asyncInit?this.registry[e]:null},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return void 0===r&&(r=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return qe(this,void 0,void 0,function(){var t,r,i;return Ke(this,function(o){switch(o.label){case 0:if(null==this.registryFactory[e])throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,null!=this.registry[e]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,t.asyncInit?[4,r]:[3,2]);case 1:return i=o.sent(),[3,3];case 2:i=r,o.label=3;case 3:if(!i)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new BB(this.backendInstance),[2,!0]}})})},n.prototype.setupRegisteredKernels=function(){var e=this;aI(this.backendName).forEach(function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)})},n.prototype.disposeRegisteredKernels=function(e){var t=this;aI(e).forEach(function(r){null!=r.disposeFunc&&r.disposeFunc(t.registry[e])})},n.prototype.initializeBackend=function(e){var t=this,r=this.registryFactory[e];if(null==r)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var i=r.factory();if(Promise.resolve(i)===i){var o=++this.pendingBackendInitId,s=i.then(function(a){return!(o<t.pendingBackendInitId||(t.registry[e]=a,t.pendingBackendInit=null,0))}).catch(function(a){return!(o<t.pendingBackendInitId||(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(a.stack||a.message),1))});return this.pendingBackendInit=s,{success:s,asyncInit:!0}}return this.registry[e]=i,{success:!0,asyncInit:!1}}catch(a){return console.warn("Initialization of backend "+e+" failed"),console.warn(a.stack||a.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority})},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],i=this.initializeBackend(r),s=i.asyncInit;if(s||i.success)return{name:r,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){var r=this.state.tensorInfo.get(t),i=r.backend,o=this.readSync(t);i.disposeData(t),r.backend=e,e.move(t,o,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(e,t){var r,i=this,o=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun(function(){return i.startScope(o)},function(){return i.endScope(r)},function(){return(r=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},n.prototype.scopedRun=function(e,t,r){e();try{var i=r();return t(),i}catch(o){throw t(),o}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype);return this.addTapeNode(this.state.activeScope.name,{x:e},[t],function(i){return{x:function(){return i.toFloat()}}},[]),t},n.prototype.runKernel=function(e,t,r,i,o){return this.runKernelFunc(null,t,null,e,r,i,o)},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(e,t,r){var i=this.backend.numDataIds(),o=0;r.forEach(function(c){o+="complex64"===c.dtype?3:1});var a=i-t-o-this.state.numDataMovesStack[this.state.numDataMovesStack.length-1];if(a>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+a+" data ids) after running '"+e+"'")},n.prototype.runKernelFunc=function(e,t,r,i,o,s,a){var c,f=this;void 0===s&&(s=[]),void 0===a&&(a=[]);var p=[],m=this.isTapeOn();null==i&&(i=null!=this.state.activeScope?this.state.activeScope.name:"");var y,w=function(N){m&&(p=N.map(function(M){return f.keep(f.clone(M))}))},E=this.state.numBytes,A=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var _,T=sI(i,this.backendName);return y=null!=T?function(){var N=f.backend.numDataIds();_=T.kernelFunc({inputs:t,attrs:o,backend:f.backend});var M=Array.isArray(_)?_:[_];f.shouldCheckForMemLeaks()&&f.checkKernelForMemLeak(i,N,M);var R=M.map(function(B){return f.makeTensorFromDataId(B.dataId,B.shape,B.dtype)}),P=R.filter(function(B,Y){return a[Y]});return w((s||[]).slice().concat(P)),R}:function(){var N=f.backend.numDataIds();_=f.tidy(function(){return e(f.backend,w)});var M=Array.isArray(_)?_:[_];return f.shouldCheckForMemLeaks()&&f.checkKernelForMemLeak(i,N,M),M},this.scopedRun(function(){return f.state.kernelDepth++},function(){return f.state.kernelDepth--},function(){c=f.ENV.getBool("DEBUG")?f.profiler.profileKernel(i,t,function(){return y()}):y()}),m&&this.addTapeNode(i,t,c,r,p),this.state.profiling&&this.state.activeProfile.kernels.push({name:i,bytesAdded:this.state.numBytes-E,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-A,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(N){return t[N].shape}),outputShapes:c.map(function(N){return N.shape})}),Array.isArray(_)?c:c[0]},n.prototype.makeTensor=function(e,t,r,i){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");i=i||this.backend;var o=e;"string"===(r=r||"float32")&&yu(e[0])&&(o=e.map(function(p){return xI(p)}));var s=i.write(o,t,r),a=new Fn(t,r,s,this.nextTensorId());if(this.incRef(a,i),"string"===r){var c=this.state.tensorInfo.get(s),f=mI(o);this.state.numBytes+=f-c.bytes,c.bytes=f}return a},n.prototype.makeTensorFromDataId=function(e,t,r,i){var o=new Fn(t,r=r||"float32",e,this.nextTensorId());return this.incRef(o,i),o},n.prototype.makeVariable=function(e,t,r,i){void 0===t&&(t=!0),r=r||this.nextVariableId().toString(),null!=i&&i!==e.dtype&&(e=e.asType(i));var o=new Dl(e,t,r,this.nextTensorId());if(null!=this.state.registeredVariables[o.name])throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},n.prototype.incRef=function(e,t){var r=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===r){this.state.numDataBuffers++;var i=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(i=e.size*Hm(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:i,refCount:0}),this.state.numBytes+=i}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Dl||this.track(e)},n.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables)this.disposeVariable(this.state.registeredVariables[e])},n.prototype.disposeVariable=function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return qe(this,void 0,void 0,function(){var t,r;return Ke(this,function(i){return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(o){return o.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},n.prototype.addTapeNode=function(e,t,r,i,o){var s=this,a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:o},c=function(n){return sd.get(n)}(e);null!=c&&(i=c.gradFunc),null!=i&&(a.gradient=function(f){return f=f.map(function(p,m){if(null==p){var y=r[m],w=Al(y.size,y.dtype);return s.makeTensor(w,y.shape,y.dtype)}return p}),i(f.length>1?f:f[0],o)}),this.state.activeTape.push(a)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=tv(e),i=new Set(r.map(function(c){return c.id})),o=0;o<this.state.activeScope.track.length;o++){var s=this.state.activeScope.track[o];s.kept||i.has(s.id)||s.dispose()}var a=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(c){c.kept||c.scopeId!==a.id||t.track(c)})},n.prototype.gradients=function(e,t,r,i){var o=this;if(void 0===i&&(i=!1),H(t.length>0,function(){return"gradients() received an empty list of xs."}),null!=r&&"float32"!==r.dtype)throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var s=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",e)});H(s instanceof Fn,function(){return"The result y returned by f() must be a tensor."});var a=function(c,f,p){for(var m={},y={},w=0;w<f.length;w++)m[f[w].id]=!0;for(w=0;w<c.length;w++){var E=(B=c[w]).inputs;for(var A in E){for(var _=E[A],T=!1,N=0;N<f.length;N++)if(m[_.id]){B.outputs.forEach(function(G){return m[G.id]=!0}),T=!0,y[B.id]=!0;break}if(T)break}}var M={};M[p.id]=!0;var R={};for(w=c.length-1;w>=0;w--)for(E=(B=c[w]).inputs,N=0;N<B.outputs.length;N++)if(M[B.outputs[N].id]){for(var A in E)M[E[A].id]=!0,R[B.id]=!0;break}var P=[];for(w=0;w<c.length;w++){var B;if(y[(B=c[w]).id]&&R[B.id]){var Y={};for(var A in B.inputs){var X=B.inputs[A];m[X.id]&&(Y[A]=X)}var z=Object.assign({},B);z.inputs=Y,z.outputs=B.outputs,P.push(z)}}return P}(this.state.activeTape,t,s);if(!i&&0===a.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var c,f,p={};p[s.id]=null==r?(f=Ym($e(c=s.shape),"float32"),Q.makeTensor(f,c,"float32")):r,function(y,w,E){for(var A=function(T){var N=w[T],M=[];if(N.outputs.forEach(function(Y){var X=y[Y.id];M.push(null!=X?X:null)}),null==N.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+N.kernelName+".");var R=N.gradient(M),P=function(Y){if(!(Y in R))throw new Error("Cannot backprop through input "+Y+". Available gradients found: "+Object.keys(R)+".");var X=o.tidy(function(){return R[Y]()});if("float32"!==X.dtype)throw new Error("Error in gradient for op "+N.kernelName+". The gradient of input "+Y+" must have 'float32' dtype, but has '"+X.dtype+"'");var z=N.inputs[Y];if(!Rr(X.shape,z.shape))throw new Error("Error in gradient for op "+N.kernelName+". The gradient of input '"+Y+"' has shape '"+X.shape+"', which does not match the shape of the input '"+z.shape+"'");if(null==y[z.id])y[z.id]=X;else{var G=y[z.id];y[z.id]=G.add(X),G.dispose()}};for(var B in N.inputs)P(B)},_=w.length-1;_>=0;_--)A(_)}(p,a);var m=t.map(function(y){return p[y.id]});return 0===o.state.gradientDepth&&(o.state.activeTape.forEach(function(y){for(var w=0,E=y.saved;w<E.length;w++)E[w].dispose()}),o.state.activeTape=null),{value:s,grads:m}})},n.prototype.customGrad=function(e){var t=this;return H(xu(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];H(i.every(function(a){return a instanceof Fn}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var s={};return i.forEach(function(a,c){s[c]=a}),t.runKernelFunc(function(a,c){return H((r=e.apply(void 0,i.concat([c]))).value instanceof Fn,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),H(xu(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},s,function(a,c){var f=r.gradFunc(a,c),p=Array.isArray(f)?f:[f];H(p.length===i.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),H(p.every(function(y){return y instanceof Fn}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var m={};return p.forEach(function(y,w){m[w]=function(){return y}}),m})}},n.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},n.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},n.prototype.time=function(e){return qe(this,void 0,void 0,function(){var t,r;return Ke(this,function(i){switch(i.label){case 0:return t=Cs(),[4,this.backend.time(e)];case 1:return(r=i.sent()).wallMs=Cs()-t,[2,r]}})})},n.prototype.track=function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),n.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new AI,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n.nextTensorId=0,n.nextVariableId=0,n}(),Q=function(){var n=function(){if(null==nv){var t=void 0;if("undefined"!=typeof window)t=window;else if("undefined"!=typeof global)t=global;else if("undefined"!=typeof process)t=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}nv=t}return nv}();if(null==n._tfengine){var e=new FB(n);n._tfengine=new WB(e)}return oI=n._tfengine.ENV,ra=function(){return n._tfengine},n._tfengine}();function DI(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var Sa=le();Sa.registerFlag("DEBUG",function(){return!1},function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Sa.registerFlag("IS_BROWSER",function(){return DI()}),Sa.registerFlag("IS_NODE",function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node}),Sa.registerFlag("IS_CHROME",function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Sa.registerFlag("PROD",function(){return!1}),Sa.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Sa.getBool("DEBUG")}),Sa.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Sa.registerFlag("IS_TEST",function(){return!1});var hd,bo,Co,rc={},rv={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function TI(n,e){rc[n]=e}function ia(n){n in rc||(rc[n]=function(t){if(1!==t&&2!==t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(i){if("undefined"!=typeof OffscreenCanvas&&2===i)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t);return r.addEventListener("webglcontextlost",function(i){i.preventDefault(),delete rc[t]},!1),1===t?r.getContext("webgl",rv)||r.getContext("experimental-webgl",rv):r.getContext("webgl2",rv)}(n));var e=rc[n];return e.isContextLost()?(delete rc[n],ia(n)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),rc[n])}function Ep(n,e){return[e,n]}function pd(n){var e=$e(n);return bp(Math.ceil(e/4))}function gd(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function iv(n,e){var t,r,i,o,s,a,c,f,p,m=n;return 2===le().getNumber("WEBGL_VERSION")?(t=m.R32F,r=m.R16F,i=m.RGBA16F,o=m.RGBA32F,s=m.RED,a=4,c=1,f=m.HALF_FLOAT,p=m.FLOAT):(t=n.RGBA,r=n.RGBA,i=n.RGBA,o=m.RGBA,s=n.RGBA,a=4,c=4,f=null!=e?e.HALF_FLOAT_OES:null,p=n.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:s,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:a,defaultNumChannels:c,textureTypeHalfFloat:f,textureTypeFloat:p}}function Ge(n,e,t){var r=t();return e&&function(i){var o=i.getError();if(o!==i.NO_ERROR)throw new Error("WebGL Error: "+NI(i,o))}(n),r}function SI(n){return!!(le().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===n||5.96e-8<Math.abs(n)&&Math.abs(n)<65504)}function NI(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function md(n,e,t){return Na(n,e,function(){return n.getExtension(t)},'Extension "'+t+'" not supported on this browser.')}function RI(n,e,t){var r=Na(n,e,function(){return n.createShader(n.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Ge(n,e,function(){return n.shaderSource(r,t)}),Ge(n,e,function(){return n.compileShader(r)}),!1===n.getShaderParameter(r,n.COMPILE_STATUS))throw console.log(n.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function MI(n,e,t){var r=Na(n,e,function(){return n.createShader(n.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Ge(n,e,function(){return n.shaderSource(r,t)}),Ge(n,e,function(){return n.compileShader(r)}),!1===n.getShaderParameter(r,n.COMPILE_STATUS))throw function(i,o){var s=GB.exec(o);if(null==s)return console.log("Couldn't parse line number in error: "+o),void console.log(i);for(var a=+s[1],c=i.split("\n"),f=c.length.toString().length+2,p=c.map(function(_,T){return nc((T+1).toString(),f)+_}),m=0,y=0;y<p.length;y++)m=Math.max(p[y].length,m);var w=p.slice(0,a-1),E=p.slice(a-1,a),A=p.slice(a);console.log(w.join("\n")),console.log(o.split("\n")[0]),console.log("%c "+nc(E[0],m),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(A.join("\n"))}(t,n.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(hd||(hd={})),function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"}(bo||(bo={})),function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Co||(Co={}));var _p,Ip,GB=/ERROR: [0-9]+:([0-9]+):/g;function OI(n,e){return Na(n,e,function(){return n.createProgram()},"Unable to create WebGLProgram.")}function FI(n,e,t){if(Ge(n,e,function(){return n.linkProgram(t)}),!1===n.getProgramParameter(t,n.LINK_STATUS))throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function Ap(n,e,t){if(Ge(n,e,function(){return n.validateProgram(t)}),!1===n.getProgramParameter(t,n.VALIDATE_STATUS))throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function PI(n,e,t){var r=Na(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return Ge(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),Ge(n,e,function(){return n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function kI(n,e,t){var r=Na(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return Ge(n,e,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r)}),Ge(n,e,function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function LI(n,e){return Na(n,e,function(){return n.createTexture()},"Unable to create WebGLTexture.")}function BI(n,e){var t=le().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){var r="["+n+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t)throw r="["+n+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+t+"x"+t+"].")}function VI(n,e){return Na(n,e,function(){return n.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function ov(n,e,t,r,i,o,s,a){var c=n.getAttribLocation(t,r);return-1!==c&&(Ge(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,i)}),Ge(n,e,function(){return n.vertexAttribPointer(c,o,n.FLOAT,!1,s,a)}),Ge(n,e,function(){return n.enableVertexAttribArray(c)}),!0)}function UI(n,e,t,r){GI(n,r),Ge(n,e,function(){return n.activeTexture(n.TEXTURE0+r)}),Ge(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)})}function jI(n,e,t,r){return Na(n,e,function(){return n.getUniformLocation(t,r)},'uniform "'+r+'" not present in program.')}function WI(n,e,t){return n.getUniformLocation(e,t)}function HI(n,e,t,r,i,o){Ge(n,e,function(){return UI(n,e,r,o)}),Ge(n,e,function(){return n.uniform1i(i,o)})}function Dp(n,e,t,r){Ge(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)}),Ge(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0)})}function sv(n,e,t){Ge(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,t)}),Ge(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)})}function vd(n){var e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+zI(n,e))}function zI(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function Na(n,e,t,r){var i=Ge(n,e,function(){return t()});if(null==i)throw new Error(r);return i}function GI(n,e){var t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+t+"].")}function yd(n,e){return void 0===e&&(e=2),$e(n.slice(0,n.length-e))}function xd(n){if(0===n.length)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function Tp(n){var e=[1,1,1];return 0===n.length||1===n.length&&1===n[0]||(e=[yd(n)].concat(xd(n))),e}function YI(n,e){var t;void 0===e&&(e=!1);var r=le().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,1===(n=n.map(function(f,p){return p>=n.length-2?jm(n[p]):n[p]})).length&&(n=[2,n[0]])),2!==n.length){var i=vu(n);n=i.newShape}var o=$e(n);if(n.length<=1&&o<=r)return[1,o];if(2===n.length&&n[0]<=r&&n[1]<=r)return n;if(3===n.length&&n[0]*n[1]<=r&&n[2]<=r)return[n[0]*n[1],n[2]];if(3===n.length&&n[0]<=r&&n[1]*n[2]<=r)return[n[0],n[1]*n[2]];if(4===n.length&&n[0]*n[1]*n[2]<=r&&n[3]<=r)return[n[0]*n[1]*n[2],n[3]];if(4===n.length&&n[0]<=r&&n[1]*n[2]*n[3]<=r)return[n[0],n[1]*n[2]*n[3]];if(e){var s=yd(n),a=2,c=2;return n.length&&(a=(t=xd(n))[0],c=t[1]),bp(o=s*(a/2)*(c/2)).map(function(f){return 2*f})}return bp(o)}function Sp(n){return n%2==0}function wd(n,e){if(Rr(n=n.slice(-2),e=e.slice(-2))||!n.length||!e.length||0===n[0]||0===n[1]||0===e[0]||0===e[1])return!0;if(n.length!==e.length){var t=n.slice(-1)[0],r=e.slice(-1)[0];if(t===r||Sp(t)&&Sp(r)&&(1===n[0]||1===e[0]))return!0}return n[1]===e[1]&&Sp(n[0])&&Sp(e[0])}function XI(n){if(null==_p){var e=ia(n);_p=e.getParameter(e.MAX_TEXTURE_SIZE)}return _p}function qI(n){if(null==Ip){var e=ia(n);Ip=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Ip)}function KI(n){if(0===n)return 0;var e=ia(n);return Eo(e,"EXT_disjoint_timer_query_webgl2")&&2===n?2:Eo(e,"EXT_disjoint_timer_query")?1:0}function Eo(n,e){return null!=n.getExtension(e)}function av(n){try{if(null!=ia(n))return!0}catch(e){return!1}return!1}function QI(n){if(0===n)return!1;var e=ia(n);if(1===n){if(!Eo(e,"OES_texture_float"))return!1}else if(!Eo(e,"EXT_color_buffer_float"))return!1;return uv(e)}function $I(n){if(0===n)return!1;var e=ia(n);if(1!==n){if(Eo(e,"EXT_color_buffer_float"))return uv(e);if(Eo(e,"EXT_color_buffer_half_float")){var t=e.getExtension("EXT_color_buffer_half_float");return function(r,i){var o=iv(r,i),s=r.createTexture();r.bindTexture(r.TEXTURE_2D,s),r.texImage2D(r.TEXTURE_2D,0,o.internalFormatHalfFloat,1,1,0,o.textureFormatFloat,o.textureTypeHalfFloat,null);var a=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,a),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,s,0);var c=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(s),r.deleteFramebuffer(a),c}(e,t)}return!1}return!!Eo(e,"OES_texture_float")&&!!Eo(e,"WEBGL_color_buffer_float")&&uv(e)}function uv(n){var e=iv(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var r=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);var i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(r),i}function ZI(n){return 2===n&&null!=ia(n).fenceSync}var YB=Object.freeze({callAndCheck:Ge,canBeRepresented:SI,getWebGLErrorMessage:NI,getExtensionOrThrow:md,createVertexShader:RI,createFragmentShader:MI,createProgram:OI,linkProgram:FI,validateProgram:Ap,createStaticVertexBuffer:PI,createStaticIndexBuffer:kI,getNumChannels:function(){return 2===le().getNumber("WEBGL_VERSION")?1:4},createTexture:LI,validateTextureSize:BI,createFramebuffer:VI,bindVertexBufferToProgramAttribute:ov,bindTextureUnit:UI,unbindTextureUnit:function(n,e,t){GI(n,t),Ge(n,e,function(){return n.activeTexture(n.TEXTURE0+t)}),Ge(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:jI,getProgramUniformLocation:WI,bindTextureToProgramUniformSampler:HI,bindCanvasToFramebuffer:function(n,e){Ge(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,null)}),Ge(n,e,function(){return n.viewport(0,0,n.canvas.width,n.canvas.height)}),Ge(n,e,function(){return n.scissor(0,0,n.canvas.width,n.canvas.height)})},bindColorTextureToFramebuffer:Dp,unbindColorTextureFromFramebuffer:sv,validateFramebuffer:vd,getFramebufferErrorMessage:zI,getBatchDim:yd,getRowsCols:xd,getShapeAs3D:Tp,getTextureShapeFromLogicalShape:YI,isReshapeFree:wd,getWebGLMaxTextureSize:XI,resetMaxTextureSize:function(){_p=null},resetMaxTexturesInShader:function(){Ip=null},getMaxTexturesInShader:qI,getWebGLDisjointQueryTimerVersion:KI,hasExtension:Eo,isWebGLVersionEnabled:av,isCapableOfRenderingToFloatTexture:QI,isDownloadFloatTextureEnabled:$I,isWebGLFenceEnabled:ZI}),mt=le();function JI(n){le().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function We(n,e){return Q.tidy(n,e)}function to(n){tv(n).forEach(function(e){return e.dispose()})}function Np(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];le().getBool("IS_TEST")||console.warn.apply(console,n)}function oa(n,e){var t=n;if(ui(n))return"string"===e?[]:[n.length];if(!Array.isArray(n))return[];for(var r=[];Array.isArray(t)||ui(t)&&"string"!==e;)r.push(t.length),t=t[0];return Array.isArray(n)&&le().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function i(o,s,a){if(a=a||[],Array.isArray(o)||ui(o)){H(s.length>0,function(){return"Element arr["+a.join("][")+"] should be a primitive, but is an array of "+o.length+" elements"}),H(o.length===s[0],function(){return"Element arr["+a.join("][")+"] should have "+s[0]+" elements, but has "+o.length+" elements"});for(var c=s.slice(1),f=0;f<o.length;++f)i(o[f],c,a.concat(f))}else H(0===s.length,function(){return"Element arr["+a.join("][")+"] is a primitive, but should be an array/TypedArray of "+s[0]+" elements"})}(n,r,[]),r}function eA(n,e,t,r){if(null!=n&&("numeric"!==n&&n!==e||"numeric"===n&&"string"===e))throw new Error("Argument '"+t+"' passed to '"+r+"' must be "+n+" tensor, but got "+e+" tensor")}function U(n,e,t,r){if(void 0===r&&(r="numeric"),n instanceof Fn)return eA(r,n.dtype,e,t),n;var i=Il(n);if("string"!==i&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),eA(r,i,e,t),null==n||!ui(n)&&!Array.isArray(n)&&"number"!=typeof n&&"boolean"!=typeof n&&"string"!=typeof n)throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+(null==n?"null":n.constructor.name)+"'");var s=oa(n,i);ui(n)||Array.isArray(n)||(n=[n]);var a="string"!==i?zm(n,i,le().getBool("DEBUG")):Ta(n,[],!0);return Q.makeTensor(a,s,i)}function bd(n,e,t,r){if(void 0===r&&(r="numeric"),!Array.isArray(n))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return n.map(function(i,o){return U(i,e+"["+o+"]",t)},r)}function cv(n,e){for(var t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function tA(n,e,t){for(var r=n.length+e.length,i=[],o=0,s=0,a=0;a<r;a++)-1===t.indexOf(a)?i.push(n[o++]):i.push(e[s++]);return i}function ci(n,e){for(var t=[],r=n.length,i=0;i<r;i++)-1===e.indexOf(i)&&t.push(n[i]);return[t,e.map(function(o){return n[o]})]}function zi(n,e){return tA(n,e.map(function(t){return 1}),e)}function no(n,e,t){H(cv(e,t),function(){return n+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."})}function Es(n,e){if(cv(n,e))return null;for(var t=[],r=0;r<e;++r)-1===n.indexOf(r)&&t.push(r);return n.forEach(function(i){return t.push(i)}),t}function Rp(n){return n.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function _s(n,e){for(var t=[],r=e-n;r<e;++r)t.push(r);return t}function nA(n,e){var t=n[0].length;n.forEach(function(i,o){H(i.length===t,function(){return"Error in concat"+t+"D: rank of tensors["+o+"] must be the same as the rank of the rest ("+t+")"})}),H(e>=0&&e<t,function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."});var r=n[0];n.forEach(function(i,o){for(var s=0;s<t;s++)H(s===e||i[s]===r[s],function(){return"Error in concat"+t+"D: Shape of tensors["+o+"] ("+i+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}function ic(n,e){for(var t=n[0].slice(),r=1;r<n.length;r++)t[e]+=n[r][e];return t}function $(n){var e=Object.keys(n);if(1!==e.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var i=function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];Q.startScope(t);try{var a=r.apply(void 0,o);return a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Q.endScope(a),a}catch(c){throw Q.endScope(null),c}};return Object.defineProperty(i,"name",{value:t,configurable:!0}),i}mt.registerFlag("HAS_WEBGL",function(){return mt.getNumber("WEBGL_VERSION")>0}),mt.registerFlag("WEBGL_VERSION",function(){return av(2)?2:av(1)?1:0}),mt.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===mt.get("WEBGL_VERSION")}),mt.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),mt.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),mt.registerFlag("WEBGL_PACK",function(){return mt.getBool("HAS_WEBGL")}),mt.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return mt.getBool("WEBGL_PACK")}),mt.registerFlag("WEBGL_PACK_CLIP",function(){return mt.getBool("WEBGL_PACK")}),mt.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),mt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return mt.getBool("WEBGL_PACK")}),mt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return mt.getBool("WEBGL_PACK")}),mt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return mt.getBool("WEBGL_PACK")}),mt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return mt.getBool("WEBGL_PACK")}),mt.registerFlag("WEBGL_PACK_REDUCE",function(){return mt.getBool("WEBGL_PACK")}),mt.registerFlag("WEBGL_LAZILY_UNPACK",function(){return mt.getBool("WEBGL_PACK")}),mt.registerFlag("WEBGL_CONV_IM2COL",function(){return mt.getBool("WEBGL_PACK")}),mt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return XI(mt.getNumber("WEBGL_VERSION"))}),mt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return qI(mt.getNumber("WEBGL_VERSION"))}),mt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var n=mt.getNumber("WEBGL_VERSION");return 0===n?0:KI(n)}),mt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return mt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(n=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))));var n}),mt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return QI(mt.getNumber("WEBGL_VERSION"))}),mt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!mt.getBool("WEBGL_FORCE_F16_TEXTURES")&&mt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),mt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return $I(mt.getNumber("WEBGL_VERSION"))}),mt.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return ZI(mt.getNumber("WEBGL_VERSION"))}),mt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return mt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),EI=JI;var li=$({complex_:function(n,e){var t=U(n,"real","complex"),r=U(e,"imag","complex");return fn(t.shape,r.shape,"real and imag shapes, "+t.shape+" and "+r.shape+", must match in call to tf.complex()."),Q.runKernelFunc(function(i){return i.complex(t,r)},{$real:t,$imag:r})}}),jo=$({real_:function(n){var e=U(n,"input","real");return Q.runKernelFunc(function(t){return t.real(e)},{$input:e})}}),sa=$({imag_:function(n){var e=U(n,"input","imag");return Q.runKernelFunc(function(t){return t.imag(e)},{$input:e})}});function fi(n,e,t){return wu(n,e,oa(n,t),t)}function wu(n,e,t,r){if(null==r&&(r=Il(n)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!ui(n)&&!Array.isArray(n)&&"number"!=typeof n&&"boolean"!=typeof n&&"string"!=typeof n)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){Xm(e);var i=$e(e),o=$e(t);H(i===o,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+o});for(var s=0;s<t.length;++s){var c=s!==t.length-1||t[s]!==$e(e.slice(s));H(t[s]===e[s]||!c,function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+e+"). "})}}return ui(n)||Array.isArray(n)||(n=[n]),e=e||t,n="string"!==r?zm(n,r,le().getBool("DEBUG")):Ta(n,[],!0),Q.makeTensor(n,e,r)}function Pe(n,e){if((ui(n)&&"string"!==e||Array.isArray(n))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&ui(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return wu(n,[],[],e)}function Or(n,e){tc(n);var t=oa(n,e);if(1!==t.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return wu(n,null,t,e)}function bu(n,e,t){if(tc(n),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");var r=oa(n,t);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return wu(n,e,r,t)}function lv(n,e,t){if(tc(n),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");var r=oa(n,t);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return wu(n,e,r,t)}function ro(n,e,t){if(tc(n),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");var r=oa(n,t);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return wu(n,e,r,t)}function Tl(n,e){if(void 0===e&&(e="float32"),"complex64"===e){var t=Tl(n,"float32"),r=zn(n,"float32");return li(t,r)}var i=Ym($e(n),e);return Q.makeTensor(i,n,e)}function zn(n,e){if(void 0===e&&(e="float32"),"complex64"===e){var t=zn(n,"float32"),r=zn(n,"float32");return li(t,r)}var i=Al($e(n),e);return Q.makeTensor(i,n,e)}function aa(n,e,t){return Q.runKernelFunc(function(r){return r.fill(n,e,t)},{})}function Mp(n,e,t,r){if(void 0===t&&(t=1),void 0===r&&(r="float32"),0===t)throw new Error("Cannot have a step of zero");if(n===e||n<e&&t<0||e<n&&t>1)return zn([0],r);var i=Al(Math.abs(Math.ceil((e-n)/t)),r);e<n&&1===t&&(t=-1),i[0]=n;for(var o=1;o<i.length;o++)i[o]=i[o-1]+t;return Or(i,r)}var rA=$({onesLike_:function(n){var e=U(n,"x","onesLike");if("complex64"===e.dtype){var t=rA(jo(e)),r=dn(sa(e));return li(t,r)}return Q.runKernelFunc(function(i){return i.onesLike(e)},{$x:e},function(i,o){return{$x:function(){return dn(i)}}})}}),dn=$({zerosLike_:function(n){var e=U(n,"x","zerosLike");return Q.runKernelFunc(function(t){return t.zerosLike(e)},{$x:e},function(t,r){return{$x:function(){return dn(t)}}})}}),zr=$({concat_:function(n,e){void 0===e&&(e=0),H(n.length>=1,function(){return"Pass at least one tensor to concat"});var t=bd(n,"tensors","concat");"complex64"===t[0].dtype&&t.forEach(function(a){if("complex64"!==a.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+a.dtype+". ")}),e=Mr(e,t[0].shape)[0];var r=ic(t.map(function(a){return a.shape}),e);if(0===$e(r))return fi([],r);if(1===(t=t.filter(function(a){return a.size>0})).length)return t[0];var i=t.map(function(a){return a.shape});return nA(i,e),Q.runKernelFunc(function(a){return a.concat(t,e)},t,function(a){var c=i.map(function(f){return f[e]});return fv(a,c,e).map(function(f){return function(){return f}})},"Concat",{axis:e})}}),ZB=$({concat1d_:function(n){return zr(n,0)}}),JB=$({concat2d_:function(n,e){return zr(n,e)}}),e5=$({concat3d_:function(n,e){return zr(n,e)}}),t5=$({concat4d_:function(n,e){return zr(n,e)}}),fv=$({split_:function(n,e,t){void 0===t&&(t=0);var r,i=U(n,"x","split");return t=Mr(t,i.shape)[0],"number"==typeof e?(H(i.shape[t]%e==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(e).fill(i.shape[t]/e)):(H(i.shape[t]===e.reduce(function(o,s){return o+s}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=e),Q.runKernelFunc(function(o){return o.split(i,r,t)},{$x:i},function(o){return{$x:function(){return zr(o,t)}}})}});function oc(n,e){return n(e={exports:{}},e.exports),e.exports}"undefined"!=typeof globalThis||"undefined"!=typeof window||"undefined"!=typeof global&&global;var n5=oc(function(n){!function(e,t,r){function i(a){var c,f=this,p=(c=4022871197,function(m){m=m.toString();for(var y=0;y<m.length;y++){var w=.02519603282416938*(c+=m.charCodeAt(y));w-=c=w>>>0,c=(w*=c)>>>0,c+=4294967296*(w-=c)}return 2.3283064365386963e-10*(c>>>0)});f.next=function(){var m=2091639*f.s0+2.3283064365386963e-10*f.c;return f.s0=f.s1,f.s1=f.s2,f.s2=m-(f.c=0|m)},f.c=1,f.s0=p(" "),f.s1=p(" "),f.s2=p(" "),f.s0-=p(a),f.s0<0&&(f.s0+=1),f.s1-=p(a),f.s1<0&&(f.s1+=1),f.s2-=p(a),f.s2<0&&(f.s2+=1),p=null}function o(a,c){return c.c=a.c,c.s0=a.s0,c.s1=a.s1,c.s2=a.s2,c}function s(a,c){var f=new i(a),p=c&&c.state,m=f.next;return m.int32=function(){return 4294967296*f.next()|0},m.double=function(){return m()+11102230246251565e-32*(2097152*m()|0)},m.quick=m,p&&("object"==typeof p&&o(p,f),m.state=function(){return o(f,{})}),m}t&&t.exports?t.exports=s:this.alea=s}(0,n)}),r5=oc(function(n){!function(e,t,r){function i(a){var c=this,f="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var m=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^m^m>>>8},a===(0|a)?c.x=a:f+=a;for(var p=0;p<f.length+64;p++)c.x^=0|f.charCodeAt(p),c.next()}function o(a,c){return c.x=a.x,c.y=a.y,c.z=a.z,c.w=a.w,c}function s(a,c){var f=new i(a),p=c&&c.state,m=function(){return(f.next()>>>0)/4294967296};return m.double=function(){do{var y=((f.next()>>>11)+(f.next()>>>0)/4294967296)/(1<<21)}while(0===y);return y},m.int32=f.next,m.quick=m,p&&("object"==typeof p&&o(p,f),m.state=function(){return o(f,{})}),m}t&&t.exports?t.exports=s:this.xor128=s}(0,n)}),i5=oc(function(n){!function(e,t,r){function i(a){var c=this,f="";c.next=function(){var m=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^m^m<<1)|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,a===(0|a)?c.x=a:f+=a;for(var p=0;p<f.length+64;p++)c.x^=0|f.charCodeAt(p),p==f.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function o(a,c){return c.x=a.x,c.y=a.y,c.z=a.z,c.w=a.w,c.v=a.v,c.d=a.d,c}function s(a,c){var f=new i(a),p=c&&c.state,m=function(){return(f.next()>>>0)/4294967296};return m.double=function(){do{var y=((f.next()>>>11)+(f.next()>>>0)/4294967296)/(1<<21)}while(0===y);return y},m.int32=f.next,m.quick=m,p&&("object"==typeof p&&o(p,f),m.state=function(){return o(f,{})}),m}t&&t.exports?t.exports=s:this.xorwow=s}(0,n)}),o5=oc(function(n){!function(e,t,r){function i(a){var c=this;c.next=function(){var f,p,m=c.x,y=c.i;return f=m[y],p=(f^=f>>>7)^f<<24,p^=(f=m[y+1&7])^f>>>10,p^=(f=m[y+3&7])^f>>>3,p^=(f=m[y+4&7])^f<<7,f=m[y+7&7],p^=(f^=f<<13)^f<<9,m[y]=p,c.i=y+1&7,p},function(f,p){var m,y=[];if(p===(0|p))y[0]=p;else for(p=""+p,m=0;m<p.length;++m)y[7&m]=y[7&m]<<15^p.charCodeAt(m)+y[m+1&7]<<13;for(;y.length<8;)y.push(0);for(m=0;m<8&&0===y[m];++m);for(8==m&&(y[7]=-1),f.x=y,f.i=0,m=256;m>0;--m)f.next()}(c,a)}function o(a,c){return c.x=a.x.slice(),c.i=a.i,c}function s(a,c){null==a&&(a=+new Date);var f=new i(a),p=c&&c.state,m=function(){return(f.next()>>>0)/4294967296};return m.double=function(){do{var y=((f.next()>>>11)+(f.next()>>>0)/4294967296)/(1<<21)}while(0===y);return y},m.int32=f.next,m.quick=m,p&&(p.x&&o(p,f),m.state=function(){return o(f,{})}),m}t&&t.exports?t.exports=s:this.xorshift7=s}(0,n)}),s5=oc(function(n){!function(e,t,r){function i(a){var c=this;c.next=function(){var f,p,m=c.w,y=c.X,w=c.i;return c.w=m=m+1640531527|0,p=y[w+34&127],f=y[w=w+1&127],p^=p<<13,f^=f<<17,p=y[w]=(p^=p>>>15)^(f^=f>>>12),c.i=w,p+(m^m>>>16)|0},function(f,p){var m,y,w,E,A,_=[],T=128;for(p===(0|p)?(y=p,p=null):(p+="\0",y=0,T=Math.max(T,p.length)),w=0,E=-32;E<T;++E)p&&(y^=p.charCodeAt((E+32)%p.length)),0===E&&(A=y),y^=y<<10,y^=y>>>15,y^=y<<4,y^=y>>>13,E>=0&&(w=0==(m=_[127&E]^=y+(A=A+1640531527|0))?w+1:0);for(w>=128&&(_[127&(p&&p.length||0)]=-1),w=127,E=512;E>0;--E)y=_[w+34&127],m=_[w=w+1&127],y^=y<<13,m^=m<<17,_[w]=(y^=y>>>15)^(m^=m>>>12);f.w=A,f.X=_,f.i=w}(c,a)}function o(a,c){return c.i=a.i,c.w=a.w,c.X=a.X.slice(),c}function s(a,c){null==a&&(a=+new Date);var f=new i(a),p=c&&c.state,m=function(){return(f.next()>>>0)/4294967296};return m.double=function(){do{var y=((f.next()>>>11)+(f.next()>>>0)/4294967296)/(1<<21)}while(0===y);return y},m.int32=f.next,m.quick=m,p&&(p.X&&o(p,f),m.state=function(){return o(f,{})}),m}t&&t.exports?t.exports=s:this.xor4096=s}(0,n)}),a5=oc(function(n){!function(e,t,r){function i(a){var c=this,f="";c.next=function(){var m=c.b,y=c.c,w=c.d,E=c.a;return m=m<<25^m>>>7^y,y=y-w|0,w=w<<24^w>>>8^E,E=E-m|0,c.b=m=m<<20^m>>>12^y,c.c=y=y-w|0,c.d=w<<16^y>>>16^E,c.a=E-m|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,a===Math.floor(a)?(c.a=a/4294967296|0,c.b=0|a):f+=a;for(var p=0;p<f.length+20;p++)c.b^=0|f.charCodeAt(p),c.next()}function o(a,c){return c.a=a.a,c.b=a.b,c.c=a.c,c.d=a.d,c}function s(a,c){var f=new i(a),p=c&&c.state,m=function(){return(f.next()>>>0)/4294967296};return m.double=function(){do{var y=((f.next()>>>11)+(f.next()>>>0)/4294967296)/(1<<21)}while(0===y);return y},m.int32=f.next,m.quick=m,p&&("object"==typeof p&&o(p,f),m.state=function(){return o(f,{})}),m}t&&t.exports?t.exports=s:this.tychei=s}(0,n)}),sc=oc(function(n){!function(e,t){var r,i=this,o=256,a="random",c=t.pow(o,6),f=t.pow(2,52),p=2*f,m=255;function y(T,N,M){var R=[],P=A(function X(z,G){var ee,J=[],pe=typeof z;if(G&&"object"==pe)for(ee in z)try{J.push(X(z[ee],G-1))}catch(fe){}return J.length?J:"string"==pe?z:z+"\0"}((N=1==N?{entropy:!0}:N||{}).entropy?[T,_(e)]:null==T?function(){try{var X;return r&&(X=r.randomBytes)?X=X(o):(X=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(X)),_(X)}catch(ee){var z=i.navigator,G=z&&z.plugins;return[+new Date,i,G,i.screen,_(e)]}}():T,3),R),B=new w(R),Y=function(){for(var X=B.g(6),z=c,G=0;X<f;)X=(X+G)*o,z*=o,G=B.g(1);for(;X>=p;)X/=2,z/=2,G>>>=1;return(X+G)/z};return Y.int32=function(){return 0|B.g(4)},Y.quick=function(){return B.g(4)/4294967296},Y.double=Y,A(_(B.S),e),(N.pass||M||function(X,z,G,ee){return ee&&(ee.S&&E(ee,B),X.state=function(){return E(B,{})}),G?(t[a]=X,z):X})(Y,P,"global"in N?N.global:this==t,N.state)}function w(T){var N,M=T.length,R=this,P=0,B=R.i=R.j=0,Y=R.S=[];for(M||(T=[M++]);P<o;)Y[P]=P++;for(P=0;P<o;P++)Y[P]=Y[B=m&B+T[P%M]+(N=Y[P])],Y[B]=N;(R.g=function(X){for(var z,G=0,ee=R.i,J=R.j,pe=R.S;X--;)z=pe[ee=m&ee+1],G=G*o+pe[m&(pe[ee]=pe[J=m&J+z])+(pe[J]=z)];return R.i=ee,R.j=J,G})(o)}function E(T,N){return N.i=T.i,N.j=T.j,N.S=T.S.slice(),N}function A(T,N){for(var M,R=T+"",P=0;P<R.length;)N[m&P]=m&(M^=19*N[m&P])+R.charCodeAt(P++);return _(N)}function _(T){return String.fromCharCode.apply(0,T)}if(t["seed"+a]=y,A(t.random(),e),n.exports){n.exports=y;try{r=ve(369)}catch(T){}}}([],Math)});sc.alea=n5,sc.xor128=r5,sc.xorwow=i5,sc.xorshift7=o5,sc.xor4096=s5,sc.tychei=a5;var Op=sc.alea,dv=function(){function n(e,t,r,i,o){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var s=o||Math.random();this.random=Op(s.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,i=!1;!i;){var o=void 0,s=void 0,a=void 0;do{a=(o=2*this.random()-1)*o+(s=2*this.random()-1)*s}while(a>=1||0===a);var c=Math.sqrt(-2*Math.log(a)/a);t=this.mean+this.stdDev*o*c,r=this.mean+this.stdDev*s*c,this.truncated&&!this.isValidTruncated(t)||(i=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},n.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},n}(),u5=function(){function n(e,t,r,i){this.alpha=e,this.beta=1/t,this.dtype=r;var o=i||Math.random();this.randu=Op(o.toString()),this.randn=new dv(0,1,r,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var e,t,r,i,o,s;;){do{i=this.randn.nextValue(),s=1+this.c*i}while(s<=0);if(t=1-.331*(e=i*i)*e,r=.5*e+this.d*(1-(s*=s*s)+Math.log(s)),(o=this.randu())<t||Math.log(o)<r)break}return s*=1/this.beta*this.d,this.alpha<1&&(s*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(s)},n.prototype.convertValue=function(e){return"float32"===this.dtype?e:Math.round(e)},n}(),c5=function(){function n(e,t,r,i){var o=this;if(void 0===e&&(e=0),void 0===t&&(t=1),this.canReturnFloat=function(){return null==o.dtype||"float32"===o.dtype},this.min=e,this.range=t-e,this.dtype=r,null==i&&(i=Math.random()),"number"==typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=Op(i)}return n.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n}();function Tt(n,e,t){return void 0===e&&(e="float32"),e=e||"float32",Xm(n),new dd(n,e,t)}var iA=$({batchToSpaceND_:function(n,e,t){var r=U(n,"x","batchToSpaceND"),i=e.reduce(function(o,s){return o*s});return H(r.rank>=1+e.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length}),H(t.length===e.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length}),H(r.shape[0]%i==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+i}),Q.runKernelFunc(function(o){return o.batchToSpaceND(r,e,t)},{$x:r},function(o){return{$x:function(){return o.spaceToBatchND(e,t)}}})}}),f5=$({broadcastTo_:function(n,e){var t=U(n,"broadcastTo","x"),r=t.shape;if(e.some(function(c){return!(c>0)||c%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var i=t.shape.slice();i.length<e.length;)i.unshift(1);t=t.reshape(i)}for(var o=Array.from(e),s=e.length-1;s>=0;s--)if(t.shape[s]===e[s])o[s]=1;else if(1!==t.shape[s])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");var a=o.map(function(c,f){return c>1?f:-1}).filter(function(c){return c>=0});return 0===a.length?t.clone():Q.runKernelFunc(function(c){return c.tile(t,o)},{input:t},function(c){return{input:function(){return c.sum(a,!0)}}})}}),d5=$({cast_:function(n,e){var t=U(n,"x","cast");if(!pI(e))throw new Error("Failed to cast to unknown dtype "+e);if("string"===e&&"string"!==t.dtype||"string"!==e&&"string"===t.dtype)throw new Error("Only strings can be casted to strings");return Q.runKernelFunc(function(i){return i.cast(t,e)},{x:t},function(i){return{x:function(){return i.clone()}}},"Cast",{dtype:e})}}),h5=$({clone_:function(n){var e=U(n,"x","clone",null);return Q.runKernelFunc(function(){return Q.makeTensorFromDataId(e.dataId,e.shape,e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}}),p5=$({cumsum_:function(n,e,t,r){void 0===e&&(e=0),void 0===t&&(t=!1),void 0===r&&(r=!1);var i=U(n,"x","cumsum"),o=Es([e|=0],i.rank),s=i;null!=o&&(s=i.transpose(o));var a=_s(1,i.rank)[0],c=Q.runKernelFunc(function(f){return f.cumsum(s,a,t,r)},{permutedX:s},function(f){return{permutedX:function(){return f.cumsum(e,t,!r)}}});return null!=o&&(c=c.transpose(o)),c}}),g5=$({depthToSpace_:function(n,e,t){void 0===t&&(t="NHWC");var r=U(n,"x","depthToSpace"),i="NHWC"===t?r.shape[1]:r.shape[2],o="NHWC"===t?r.shape[2]:r.shape[3],s="NHWC"===t?r.shape[3]:r.shape[1];return H(i*e>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+e+"  for depthToSpace with input shape\n      "+r.shape}),H(o*e>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+e+" for depthToSpace with input shape\n          "+r.shape}),H(s%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+s+" for depthToSpace with input shape "+r.shape}),Q.runKernelFunc(function(a){return a.depthToSpace(r,e,t)},{$x:r})}}),Wo=$({expandDims_:function(n,e){void 0===e&&(e=0);var t=U(n,"x","expandDims",null);H(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var r=t.shape.slice();return e<0&&(H(-(t.rank+1)<=e,function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"}),e=t.rank+e+1),r.splice(e,0,1),Is(t,r)}}),oA=$({eye_:function(n,e,t,r){void 0===r&&(r="float32"),null==e&&(e=n);for(var i=Tt([n,e],r),o=n<=e?n:e,s=0;s<o;++s)i.set(1,s,s);var a=i.toTensor().as2D(n,e);if(null==t)return a;if(1===t.length)return Sl(Wo(a,0),[t[0],1,1]);if(2===t.length)return Sl(Wo(Wo(a,0),0),[t[0],t[1],1,1]);if(3===t.length)return Sl(Wo(Wo(Wo(a,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),m5=$({multinomial_:function(n,e,t,r){void 0===r&&(r=!1);var i=U(n,"logits","multinomial"),o=i.size,s=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(s>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+s);t=t||Math.random();var a=1===s?i.as2D(1,-1):i,c=Q.runKernelFunc(function(f){return f.multinomial(a,r,e,t)},{logits2D:a});return 1===s?c.as1D():c}}),hv=$({oneHot_:function(n,e,t,r){if(void 0===t&&(t=1),void 0===r&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=U(n,"indices","oneHot","int32"),o=i.shape.concat([e]);return i=i.flatten(),Q.runKernelFunc(function(s){return s.oneHot(i,e,t,r)},{$indices:i},function(s){return{$indices:function(){return zn(i.shape,"float32")}}}).reshape(o)}}),ac=$({pad_:function(n,e,t){void 0===t&&(t=0);var r=U(n,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");return Q.runKernelFunc(function(o){return o.pad(r,e,t)},{x:r},function(o){var s=e.map(function(a){return a[0]});return{x:function(){return o.slice(s,r.shape)}}},"PadV2",{paddings:e,constantValue:t})}}),v5=$({pad1d_:function(n,e,t){return void 0===t&&(t=0),H(2===e.length,function(){return"Invalid number of paddings. Must be length of 2."}),ac(n,[e],t)}}),y5=$({pad2d_:function(n,e,t){return void 0===t&&(t=0),H(2===e.length&&2===e[0].length&&2===e[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),ac(n,e,t)}}),x5=$({pad3d_:function(n,e,t){return void 0===t&&(t=0),H(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),ac(n,e,t)}}),w5=$({pad4d_:function(n,e,t){return void 0===t&&(t=0),H(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),ac(n,e,t)}}),b5=$({rand_:function(n,e,t){var r=$e(n),i=null;if(null==t||"float32"===t)i=new Float32Array(r);else if("int32"===t)i=new Int32Array(r);else{if("bool"!==t)throw new Error("Unknown data type "+t);i=new Uint8Array(r)}for(var o=0;o<r;o++)i[o]=e();return Q.makeTensor(i,n,t)}}),C5=$({randomNormal_:function(n,e,t,r,i){if(void 0===e&&(e=0),void 0===t&&(t=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var o=new dv(e,t,r,!1,i),s=Tt(n,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),E5=$({randomGamma_:function(n,e,t,r,i){if(void 0===t&&(t=1),void 0===r&&(r="float32"),null==t&&(t=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var o=new u5(e,t,r,i),s=Tt(n,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),sA=$({randomUniform_:function(n,e,t,r,i){void 0===e&&(e=0),void 0===t&&(t=1),void 0===r&&(r="float32");for(var o=Tt(n,r),s=new c5(e,t,null,i),a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}}),Is=$({reshape_:function(n,e){var t=U(n,"x","reshape",null);return e=dI(e,t.size),H(t.size===$e(e),function(){return"new shape and old shape must have the same number of elements."}),Q.runKernelFunc(function(i){return i.reshape(t,e)},{x:t},function(i){return{x:function(){return i.reshape(t.shape)}}},"Reshape",{shape:e})}}),aA=$({spaceToBatchND_:function(n,e,t){var r=U(n,"x","spaceToBatchND");return H(r.rank>=1+e.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length}),H(t.length===e.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length}),H(r.shape.reduce(function(i,o,s){return s>0&&s<=e.length?i&&(o+t[s-1][0]+t[s-1][1])%e[s-1]==0:i},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()}),Q.runKernelFunc(function(i){return i.spaceToBatchND(r,e,t)},{$x:r},function(i){return{$x:function(){return i.batchToSpaceND(e,t)}}})}}),uA=$({squeeze_:function(n,e){var t=U(n,"x","squeeze");return Is(t,vu(t.shape,e).newShape)}}),_o=$({stack_:function(n,e){void 0===e&&(e=0);var t=bd(n,"tensors","stack");if(H(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===t.length)return t[0].expandDims(e);var i=t[0].shape,o=t[0].dtype;H(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"}),t.forEach(function(a){fn(i,a.shape,"All tensors passed to stack must have matching shapes")}),t.forEach(function(a){H(o===a.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=t.map(function(a){return a.expandDims(e)});return zr(s,e)}}),Sl=$({tile_:function(n,e){var t=U(n,"x","tile",null);return H(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."}),Q.runKernelFunc(function(o,s){var a=o.tile(t,e);return s([t]),a},{x:t},function(o,s){var a=s[0];return{x:function(){var c=dn(a);if(1===a.rank)for(var f=0;f<e[0];++f)c=c.add(o.slice([f*a.shape[0]],[a.shape[0]]));else if(2===a.rank)for(f=0;f<e[0];++f)for(var p=0;p<e[1];++p)c=c.add(o.slice([f*a.shape[0],p*a.shape[1]],[a.shape[0],a.shape[1]]));else if(3===a.rank)for(f=0;f<e[0];++f)for(p=0;p<e[1];++p)for(var m=0;m<e[2];++m)c=c.add(o.slice([f*a.shape[0],p*a.shape[1],m*a.shape[2]],[a.shape[0],a.shape[1],a.shape[2]]));else{if(4!==a.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+a.rank+" tensors yet.");for(f=0;f<e[0];++f)for(p=0;p<e[1];++p)for(m=0;m<e[2];++m)for(var y=0;y<e[3];++y)c=c.add(o.slice([f*a.shape[0],p*a.shape[1],m*a.shape[2],y*a.shape[3]],[a.shape[0],a.shape[1],a.shape[2],a.shape[3]]))}return c}}},"Tile",{reps:e},[t])}}),_5=$({truncatedNormal_:function(n,e,t,r,i){if(void 0===e&&(e=0),void 0===t&&(t=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var o=new dv(e,t,r,!0,i),s=Tt(n,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),Gr=$({unstack_:function(n,e){void 0===e&&(e=0),e=e||0;var t=U(n,"x","unstack");return H(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"}),e<0&&(e+=t.shape.length),Q.runKernelFunc(function(i){return i.unstack(t,e)},{x:t},function(i){return{x:function(){return _o(i,e)}}},"Unpack",{axis:e})}});function Fp(n,e,t,r){void 0===r&&(r=!0);var i=[];if(r)(i=i.concat(e.slice(0))).push(n[0]/t),i=i.concat(n.slice(1));else{i=i.concat(n[0]);for(var o=e.length,s=0;s<o;++s)i=i.concat([n[s+1]/e[s],e[s]]);i=i.concat(n.slice(o+1))}return i}function Pp(n,e,t){void 0===t&&(t=!0);var r=[];if(t){r.push(e);for(var i=e+1;i<n;++i)i<=2*e?(r.push(i),r.push(i-(e+1))):r.push(i)}else{var o=[],s=[];for(i=1;i<n;++i)i>=2*e+1||i%2==1?s.push(i):o.push(i);r.push.apply(r,o),r.push(0),r.push.apply(r,s)}return r}function kp(n,e,t,r){void 0===r&&(r=!0);var i=[];i.push(r?n[0]/t:n[0]*t);for(var o=1;o<n.length;++o)i.push(o<=e.length?r?e[o-1]*n[o]:n[o]/e[o-1]:n[o]);return i}function cA(n,e){for(var t=[0],r=0;r<e;++r)t.push(n[r][0]);return t}function lA(n,e,t){for(var r=n.slice(0,1),i=0;i<t;++i)r.push(n[i+1]-e[i][0]-e[i][1]);return r}function pv(n,e){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==e.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+n.rank);if(0===n.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var t=e.shape,r=t[t.length-1],i=1,o=0;o<t.length-1;++o)i*=t[o];var s=n.shape,a=t.slice();a.pop();var c=1;for(o=r;o<n.rank;++o)c*=s[o],a.push(s[o]);var f=bs(n.shape).map(function(p){return p/c}).concat([1]).slice(0,r);return[a,i,c,f]}function Lp(n){return n<=30?n:Cp(n,Math.floor(Math.sqrt(n)))}function fA(n,e,t){var r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+e.shape+", shape: "+n+", sliceDim: "+r+", and batchDim: "+i+".";if(t.rank<i)throw new Error(o+" update.rank < "+i+". ");if(n.length<r+(t.rank-i))throw new Error(o+" Output shape length < "+(r+(t.rank-i)));if(t.rank!==i+n.length-r)throw new Error(o+" update.rank != "+(i+n.length-r));for(var s=0;s<i;++s)if(t.shape[s]!==e.shape[s])throw new Error(o+" updates.shape["+s+"] ("+t.shape[s]+") != indices.shape["+s+"] ("+e.shape[s]+").");for(s=0;s<t.rank-i;++s)if(t.shape[s+i]!==n[s+r])throw new Error(o+" updates.shape["+(s+i)+"] ("+t.shape[s+i]+") != shape["+(s+i)+"] ("+n[s+i]+")")}function dA(n,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if("int32"!==e.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(0===t.length){if(0===e.size)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(0===n.size)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}fA(t,e,n)}function Cd(n,e,t){for(var r=e.shape.length,i=r>1?e.shape[r-1]:1,o=t.length,s=1,a=i;a<o;++a)s*=t[a];var c=i<1?1:i;return{sliceRank:i,numUpdates:$e(e.shape)/c,sliceSize:s,strides:bs(t.slice(0,i)).concat([1]),outputSize:$e(t)}}function hA(n,e,t){H(n.rank===e.length,function(){return"Error in slice"+n.rank+"D: Length of begin "+e+" must match the rank of the array ("+n.rank+")."}),H(n.rank===t.length,function(){return"Error in slice"+n.rank+"D: Length of size "+t+" must match the rank of the array ("+n.rank+")."});for(var r=function(o){H(e[o]+t[o]<=n.shape[o],function(){return"Error in slice"+n.rank+"D: begin["+o+"] + size["+o+"] ("+(e[o]+t[o])+") would overflow input.shape["+o+"] ("+n.shape[o]+")"})},i=0;i<n.rank;++i)r(i)}function mv(n){for(var e=[],t=0;n>0;)1&n&&e.push(t),n/=2,t++;return e}function Bp(n,e,t){for(var r=[],i=0;i<n.length;i++)r[i]=Math.ceil((e[i]-n[i])/t[i]);return r}function pA(n,e,t,r,i){var o=e[i];(n&1<<i||null==o)&&(o=(t[i]||1)>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var a=r[i];return o<0&&(o+=a),wp(0,o,a-1)}function gA(n,e,t,r,i){var o=e[i],s=t[i]||1;(n&1<<i||null==o)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var a=r[i];return o<0&&(o+=a),s>0?wp(0,o,a):wp(-1,o,a-1)}function vv(n,e,t){for(var r=t.length,i=0;i<t.length;i++)if(t[i]>1){r=i;break}for(i=r+1;i<t.length;i++)if(e[i]>0||t[i]!==n[i])return!1;return!0}function yv(n,e){for(var t=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function Vp(n){return Q.customGrad(n)}Object.freeze({prepareAndValidate:pv}),Object.freeze({validateUpdateShape:fA,validateInput:dA,calculateShapes:Cd}),Object.freeze({assertParamsValid:hA,maskToAxes:mv,computeOutShape:Bp,startForAxis:pA,stopForAxis:gA,isSliceContinous:vv,computeFlatOffset:yv});var Ra=$({softmax_:function(n,e){void 0===e&&(e=-1);var t=U(n,"logits","softmax","float32");if(-1===e&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return Q.runKernelFunc(function(r,i){var o=r.softmax(t,e);return i([o]),o},{logits:t},function(r,i){var o=i[0],s=r.mul(o);return{logits:function(){return s.sub(s.sum([e],!0).mul(o))}}},"Softmax",{dim:e},[],[!0])}}),D5=$({logSoftmax_:function(n,e){void 0===e&&(e=-1);var t=U(n,"logits","logSoftmax");if(-1===e&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return Vp(function(r,i){var o=r.max(e,!0),s=r.sub(o),a=s.toFloat().sub(s.exp().sum(e,!0).log());return i([a]),{value:a,gradFunc:function(c,f){var p=f[0].exp();return c.sub(c.sum(e,!0).mul(p))}}})(t)}}),mA=function(){function n(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return n.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},n.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},n.prototype.has=function(e){return this.data.has(e)},n.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},n.prototype.numDataIds=function(){return this.dataIdsCount},n}(),vA=function(){function n(){}return n.prototype.time=function(e){return ae("time")},n.prototype.read=function(e){return ae("read")},n.prototype.readSync=function(e){return ae("readSync")},n.prototype.numDataIds=function(){return ae("numDataIds")},n.prototype.disposeData=function(e){return ae("disposeData")},n.prototype.write=function(e,t,r){return ae("write")},n.prototype.move=function(e,t,r,i){return ae("move")},n.prototype.memory=function(){return ae("memory")},n.prototype.floatPrecision=function(){return ae("floatPrecision")},n.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},n.prototype.batchMatMul=function(e,t,r,i){return ae("batchMatMul")},n.prototype.fusedBatchMatMul=function(e){return ae("fusedBatchMatMul")},n.prototype.slice=function(e,t,r){return ae("slice")},n.prototype.stridedSlice=function(e,t,r,i){return ae("stridedSlice")},n.prototype.unstack=function(e,t){return ae("unstack")},n.prototype.reverse=function(e,t){return ae("reverse")},n.prototype.concat=function(e,t){return ae("concat")},n.prototype.neg=function(e){return ae("neg")},n.prototype.add=function(e,t){return ae("add")},n.prototype.addN=function(e){return ae("addN")},n.prototype.subtract=function(e,t){return ae("subtract")},n.prototype.multiply=function(e,t){return ae("multiply")},n.prototype.realDivide=function(e,t){return ae("realDivide")},n.prototype.floorDiv=function(e,t){return ae("floorDiv")},n.prototype.sum=function(e,t){return ae("sum")},n.prototype.prod=function(e,t){return ae("prod")},n.prototype.unsortedSegmentSum=function(e,t,r){return ae("unsortedSegmentSum")},n.prototype.argMin=function(e,t){return ae("argMin")},n.prototype.argMax=function(e,t){return ae("argMax")},n.prototype.equal=function(e,t){return ae("equal")},n.prototype.notEqual=function(e,t){return ae("notEqual")},n.prototype.less=function(e,t){return ae("less")},n.prototype.lessEqual=function(e,t){return ae("lessEqual")},n.prototype.greater=function(e,t){return ae("greater")},n.prototype.greaterEqual=function(e,t){return ae("greaterEqual")},n.prototype.logicalNot=function(e){return ae("logicalNot")},n.prototype.logicalAnd=function(e,t){return ae("logicalAnd")},n.prototype.logicalOr=function(e,t){return ae("logicalOr")},n.prototype.where=function(e){return ae("where")},n.prototype.select=function(e,t,r){return ae("select")},n.prototype.topk=function(e,t,r){return ae("topk")},n.prototype.min=function(e,t){return ae("min")},n.prototype.minimum=function(e,t){return ae("minimum")},n.prototype.mod=function(e,t){return ae("mod")},n.prototype.max=function(e,t){return ae("max")},n.prototype.maximum=function(e,t){return ae("maximum")},n.prototype.all=function(e,t){return ae("all")},n.prototype.any=function(e,t){return ae("any")},n.prototype.squaredDifference=function(e,t){return ae("squaredDifference")},n.prototype.ceil=function(e){return ae("ceil")},n.prototype.floor=function(e){return ae("floor")},n.prototype.round=function(e){return ae("round")},n.prototype.sign=function(e){return ae("sign")},n.prototype.isNaN=function(e){return ae("isNaN")},n.prototype.isInf=function(e){return ae("isInf")},n.prototype.isFinite=function(e){return ae("isFinite")},n.prototype.pow=function(e,t){return ae("pow")},n.prototype.exp=function(e){return ae("exp")},n.prototype.expm1=function(e){return ae("expm1")},n.prototype.softmax=function(e,t){return ae("softmax")},n.prototype.log=function(e){return ae("log")},n.prototype.log1p=function(e){return ae("log1p")},n.prototype.sqrt=function(e){return ae("sqrt")},n.prototype.rsqrt=function(e){return ae("rsqrt")},n.prototype.square=function(e){return ae("square")},n.prototype.reciprocal=function(e){return ae("reciprocal")},n.prototype.relu=function(e){return ae("relu")},n.prototype.relu6=function(e){return ae("relu6")},n.prototype.prelu=function(e,t){return ae("prelu")},n.prototype.elu=function(e){return ae("elu")},n.prototype.eluDer=function(e,t){return ae("eluDer")},n.prototype.selu=function(e){return ae("selu")},n.prototype.int=function(e){return ae("int")},n.prototype.clip=function(e,t,r){return ae("clip")},n.prototype.abs=function(e){return ae("abs")},n.prototype.complexAbs=function(e){return ae("complexAbs")},n.prototype.sigmoid=function(e){return ae("sigmoid")},n.prototype.softplus=function(e){return ae("softplus")},n.prototype.sin=function(e){return ae("sin")},n.prototype.cos=function(e){return ae("cos")},n.prototype.tan=function(e){return ae("tan")},n.prototype.asin=function(e){return ae("asin")},n.prototype.acos=function(e){return ae("acos")},n.prototype.atan=function(e){return ae("atan")},n.prototype.atan2=function(e,t){return ae("atan2")},n.prototype.sinh=function(e){return ae("sinh")},n.prototype.cosh=function(e){return ae("cosh")},n.prototype.tanh=function(e){return ae("tanh")},n.prototype.asinh=function(e){return ae("asinh")},n.prototype.acosh=function(e){return ae("acosh")},n.prototype.atanh=function(e){return ae("atanh")},n.prototype.erf=function(e){return ae("erf")},n.prototype.step=function(e,t){return ae("step")},n.prototype.fusedConv2d=function(e){return ae("fusedConv2d")},n.prototype.conv2d=function(e,t,r){return ae("conv2d")},n.prototype.conv2dDerInput=function(e,t,r){return ae("conv2dDerInput")},n.prototype.conv2dDerFilter=function(e,t,r){return ae("conv2dDerFilter")},n.prototype.fusedDepthwiseConv2D=function(e){return ae("fusedDepthwiseConv2D")},n.prototype.depthwiseConv2D=function(e,t,r){return ae("depthwiseConv2D")},n.prototype.depthwiseConv2DDerInput=function(e,t,r){return ae("depthwiseConv2DDerInput")},n.prototype.depthwiseConv2DDerFilter=function(e,t,r){return ae("depthwiseConv2DDerFilter")},n.prototype.conv3d=function(e,t,r){return ae("conv3d")},n.prototype.conv3dDerInput=function(e,t,r){return ae("conv3dDerInput")},n.prototype.conv3dDerFilter=function(e,t,r){return ae("conv3dDerFilter")},n.prototype.maxPool=function(e,t){return ae("maxPool")},n.prototype.maxPoolBackprop=function(e,t,r,i){return ae("maxPoolBackprop")},n.prototype.avgPool=function(e,t){return ae("avgPool")},n.prototype.avgPoolBackprop=function(e,t,r){return ae("avgPoolBackprop")},n.prototype.avgPool3d=function(e,t){return ae("avgPool3d")},n.prototype.avgPool3dBackprop=function(e,t,r){return ae("avgPool3dBackprop")},n.prototype.maxPool3d=function(e,t){return ae("maxPool3d")},n.prototype.maxPool3dBackprop=function(e,t,r,i){return ae("maxPool3dBackprop")},n.prototype.reshape=function(e,t){return ae("reshape")},n.prototype.cast=function(e,t){return ae("cast")},n.prototype.tile=function(e,t){return ae("tile")},n.prototype.pad=function(e,t,r){return ae("pad")},n.prototype.transpose=function(e,t){return ae("transpose")},n.prototype.gather=function(e,t,r){return ae("gather")},n.prototype.gatherND=function(e,t){return ae("gatherND")},n.prototype.scatterND=function(e,t,r){return ae("scatterND")},n.prototype.batchToSpaceND=function(e,t,r){return ae("batchToSpaceND")},n.prototype.spaceToBatchND=function(e,t,r){return ae("spaceToBatchND")},n.prototype.resizeBilinear=function(e,t,r,i){return ae("resizeBilinear")},n.prototype.resizeBilinearBackprop=function(e,t,r){return ae("resizeBilinearBackprop")},n.prototype.resizeNearestNeighbor=function(e,t,r,i){return ae("resizeNearestNeighbor")},n.prototype.resizeNearestNeighborBackprop=function(e,t,r){return ae("resizeNearestNeighborBackprop")},n.prototype.batchNormalization=function(e,t,r,i,o,s){return ae("batchNormalization")},n.prototype.localResponseNormalization4D=function(e,t,r,i,o){return ae("localResponseNormalization4D")},n.prototype.LRNGrad=function(e,t,r,i,o,s,a){return ae("LRNGrad")},n.prototype.multinomial=function(e,t,r,i){return ae("multinomial")},n.prototype.oneHot=function(e,t,r,i){return ae("oneHot")},n.prototype.cumsum=function(e,t,r,i){return ae("cumsum")},n.prototype.nonMaxSuppression=function(e,t,r,i,o){return ae("nonMaxSuppression")},n.prototype.fft=function(e){return ae("fft")},n.prototype.ifft=function(e){return ae("ifft")},n.prototype.complex=function(e,t){return ae("complex")},n.prototype.real=function(e){return ae("real")},n.prototype.imag=function(e){return ae("imag")},n.prototype.cropAndResize=function(e,t,r,i,o,s){return ae("cropAndResize")},n.prototype.depthToSpace=function(e,t,r){return ae("depthToSpace")},n.prototype.split=function(e,t,r){return ae("split")},n.prototype.sparseToDense=function(e,t,r,i){return ae("sparseToDense")},n.prototype.diag=function(e){return ae("diag")},n.prototype.fill=function(e,t,r){return ae("fill")},n.prototype.onesLike=function(e){return ae("onesLike")},n.prototype.zerosLike=function(e){return ae("zerosLike")},n.prototype.linspace=function(e,t,r){return ae("linspace")},n.prototype.dispose=function(){return ae("dispose")},n}();function ae(n){throw new Error("'"+n+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Ma(n,e){for(var t=n.length,r=[],i=0;i<t;i++){var o=t-1-i;(e[e.length-1-i]||1)>1&&1===(n[o]||1)&&r.unshift(o)}return r}function Fr(n,e){for(var t=[],r=0;r<e.length;r++){var i=n[n.length-r-1],o=e.length-r-1;(null==i||1===i&&e[o]>1)&&t.unshift(o)}return t}function zt(n,e){for(var t=[],r=Math.max(n.length,e.length),i=0;i<r;i++){var o=n[n.length-i-1];null==o&&(o=1);var s=e[e.length-i-1];if(null==s&&(s=1),1===o)t.unshift(s);else if(1===s)t.unshift(o);else{if(o!==s)throw Error("Operands could not be broadcast together with shapes "+n+" and "+e+".");t.unshift(o)}}return t}function Nl(n,e,t,r,i,o,s){void 0===s&&(s="channelsLast");var a,c=jp(e),f=c[0],p=c[1];if("channelsLast"===s)a=[f,p,n[3],n[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);a=[f,p,n[1],n[1]]}return Cu(n,a,t,r,i,o,!1,s)}function Ed(n,e,t,r,i,o,s){void 0===s&&(s="NDHWC");var a,c,f=wv(e),p=f[0],m=f[1],y=f[2];if("NDHWC"===s)c="channelsLast",a=[p,m,y,n[4],n[4]];else{if("NCDHW"!==s)throw new Error("Unknown dataFormat "+s);c="channelsFirst",a=[p,m,y,n[1],n[1]]}return _d(n,a,t,r,i,!1,c,o)}function Cu(n,e,t,r,i,o,s,a){void 0===s&&(s=!1),void 0===a&&(a="channelsLast");var c=[-1,-1,-1,-1],f=c[0],p=c[1],m=c[2],y=c[3];if("channelsLast"===a)f=n[0],p=n[1],m=n[2],y=n[3];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);f=n[0],y=n[1],p=n[2],m=n[3]}var w,E=e[0],A=e[1],_=e[3],T=jp(t),N=T[0],M=T[1],R=jp(r),P=R[0],B=R[1],Y=Rl(E,P),X=Rl(A,B),z=function(fe,he,xe,we,me,Ie,De,je){var rt,lt,Ut;if("number"==typeof fe){rt={top:fe,bottom:fe,left:fe,right:fe,type:0===fe?"VALID":"NUMBER"};var jt=function(nn,Rn,xn,yr,ur){null==yr&&(yr=xv(nn,Rn,xn));var pa=nn[1],ga=Id((nn[0]-Rn+2*yr)/xn+1,ur);H(ir(ga),function(){return"The output # of rows ("+ga+") must be an integer. Change the stride and/or zero pad parameters"});var To=Id((pa-Rn+2*yr)/xn+1,ur);return H(ir(To),function(){return"The output # of columns ("+To+") must be an integer. Change the stride and/or zero pad parameters"}),[ga,To]}([he,xe],Ie,we,fe,je);lt=jt[0],Ut=jt[1]}else if("same"===fe){lt=Math.ceil(he/we),Ut=Math.ceil(xe/me);var $t=Math.max(0,(lt-1)*we+Ie-he),hn=Math.max(0,(Ut-1)*me+De-xe),tn=Math.floor($t/2),pn=$t-tn,_r=Math.floor(hn/2);rt={top:tn,bottom:pn,left:_r,right:hn-_r,type:"SAME"}}else{if("valid"!==fe)throw Error("Unknown padding parameter: "+fe);rt={top:0,bottom:0,left:0,right:0,type:"VALID"},lt=Math.ceil((he-Ie+1)/we),Ut=Math.ceil((xe-De+1)/me)}return{padInfo:rt,outHeight:lt,outWidth:Ut}}(i,p,m,N,M,Y,X,o),ee=z.outHeight,J=z.outWidth,pe=s?_*y:_;return"channelsFirst"===a?w=[f,pe,ee,J]:"channelsLast"===a&&(w=[f,ee,J,pe]),{batchSize:f,dataFormat:a,inHeight:p,inWidth:m,inChannels:y,outHeight:ee,outWidth:J,outChannels:pe,padInfo:z.padInfo,strideHeight:N,strideWidth:M,filterHeight:E,filterWidth:A,effectiveFilterHeight:Y,effectiveFilterWidth:X,dilationHeight:P,dilationWidth:B,inShape:n,outShape:w,filterShape:e}}function _d(n,e,t,r,i,o,s,a){void 0===o&&(o=!1),void 0===s&&(s="channelsLast");var c=[-1,-1,-1,-1,-1],f=c[0],p=c[1],m=c[2],y=c[3],w=c[4];if("channelsLast"===s)f=n[0],p=n[1],m=n[2],y=n[3],w=n[4];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);f=n[0],w=n[1],p=n[2],m=n[3],y=n[4]}var E,A=e[0],_=e[1],T=e[2],N=e[4],M=wv(t),R=M[0],P=M[1],B=M[2],Y=wv(r),X=Y[0],z=Y[1],G=Y[2],ee=Rl(A,X),J=Rl(_,z),pe=Rl(T,G),fe=function(De,je,rt,lt,Ut,jt,$t,hn,tn,pn,_r){var nn,Rn,xn,yr;if("number"==typeof De){nn={top:De,bottom:De,left:De,right:De,front:De,back:De,type:0===De?"VALID":"NUMBER"};var ur=function(ql,za,ex,Kl,ma,tx){null==ma&&(ma=xv(ql,za,Kl));var Sz=ql[1],Nz=ql[2],nx=Id((ql[0]-za+2*ma)/Kl+1,tx);H(ir(nx),function(){return"The output # of depths ("+nx+") must be an integer. Change the stride and/or zero pad parameters"});var rx=Id((Sz-za+2*ma)/Kl+1,tx);H(ir(rx),function(){return"The output # of rows ("+rx+") must be an integer. Change the stride and/or zero pad parameters"});var ix=Id((Nz-za+2*ma)/Kl+1,tx);return H(ir(ix),function(){return"The output # of columns ("+ix+") must be an integer. Change the stride and/or zero pad parameters"}),[nx,rx,ix,1]}([je,rt,lt,1],hn,0,Ut,De,_r);Rn=ur[0],xn=ur[1],yr=ur[2]}else if("same"===De){var cr=((Rn=Math.ceil(je/Ut))-1)*Ut+hn-je,pa=((xn=Math.ceil(rt/jt))-1)*jt+tn-rt,ga=((yr=Math.ceil(lt/$t))-1)*$t+pn-lt,To=Math.floor(cr/2),Xl=cr-To,Wa=Math.floor(pa/2),Ru=pa-Wa,Ha=Math.floor(ga/2);nn={top:Wa,bottom:Ru,left:Ha,right:ga-Ha,front:To,back:Xl,type:"SAME"}}else{if("valid"!==De)throw Error("Unknown padding parameter: "+De);nn={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Rn=Math.ceil((je-hn+1)/Ut),xn=Math.ceil((rt-tn+1)/jt),yr=Math.ceil((lt-pn+1)/$t)}return{padInfo:nn,outDepth:Rn,outHeight:xn,outWidth:yr}}(i,p,m,y,R,P,B,ee,J,pe,a),xe=fe.outDepth,we=fe.outHeight,me=fe.outWidth,Ie=o?N*w:N;return"channelsFirst"===s?E=[f,Ie,xe,we,me]:"channelsLast"===s&&(E=[f,xe,we,me,Ie]),{batchSize:f,dataFormat:s,inDepth:p,inHeight:m,inWidth:y,inChannels:w,outDepth:xe,outHeight:we,outWidth:me,outChannels:Ie,padInfo:fe.padInfo,strideDepth:R,strideHeight:P,strideWidth:B,filterDepth:A,filterHeight:_,filterWidth:T,effectiveFilterDepth:ee,effectiveFilterHeight:J,effectiveFilterWidth:pe,dilationDepth:X,dilationHeight:z,dilationWidth:G,inShape:n,outShape:E,filterShape:e}}function xv(n,e,t,r){void 0===r&&(r=1);var i=Rl(e,r);return Math.floor((n[0]*(t-1)-t+i)/2)}function jp(n){return"number"==typeof n?[n,n,n]:2===n.length?[n[0],n[1],1]:n}function wv(n){return"number"==typeof n?[n,n,n]:n}function Rl(n,e){return e<=1?n:n+(n-1)*(e-1)}function Id(n,e){if(!e)return n;switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+e)}}function uc(n){var e=jp(n);return 1===e[0]&&1===e[1]&&1===e[2]}function Gi(n,e){return uc(n)||uc(e)}function Wp(n){if("NHWC"===n)return"channelsLast";if("NCHW"===n)return"channelsFirst";throw new Error("Unknown dataFormat "+n)}function bv(n,e,t){if("complex64"===e){if("complex64"===n.dtype)return n.clone();var r=zn(n.shape),i=n.toFloat(),o=t.complex(i,r);return r.dispose(),i.dispose(),o}if(!gI(n.dtype,e))return Q.makeTensorFromDataId(n.dataId,n.shape,e);if("complex64"===n.dtype){var s=t.real(n);return o=s.cast(e),s.dispose(),o}if("int32"===e)return t.int(n);if("bool"===e){var a=Pe(0,n.dtype);return o=t.notEqual(n,a),a.dispose(),o}throw new Error("Error in Cast: failed to cast "+n.dtype+" to "+e)}function Hp(n,e){return Q.makeTensorFromDataId(n.dataId,e,n.dtype)}function Cv(n,e,t){var r=(e-n)/(t-1),i=Al(t,"float32");i[0]=n;for(var o=1;o<i.length;o++)i[o]=i[o-1]+r;return Or(i,"float32")}function Ev(n,e){if(n.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+e.length+".");for(var t=new Float32Array(2*n.length),r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function yA(n,e){return{real:n[2*e],imag:n[2*e+1]}}function T5(n,e,t,r){n[2*r]=e,n[2*r+1]=t}function S5(n,e,t){var r=(t?2:-2)*Math.PI*(n/e);return{real:Math.cos(r),imag:Math.sin(r)}}function N5(n,e,t){var r=function(c,f,p){for(var m=0,y=c.length,w=0,E=!1;m<y;){var A=p(f,c[w=m+(y-m>>>1)]);A>0?m=w+1:(y=w,E=!A)}return E?m:-m-1}(n,e,t||R5);n.splice(r<0?-(r+1):r,0,e)}function R5(n,e){return n>e?1:n<e?-1:0}function _v(n,e,t,r,i){return xA(n,e,t,r,i,0).selectedIndices}function Iv(n,e,t,r,i,o){var s=xA(n,e,t,r,i,o,!0);return s.numValidOutputs.dispose(),{selectedIndices:s.selectedIndices,selectedScores:s.selectedScores}}function xA(n,e,t,r,i,o,s,a){void 0===s&&(s=!1),void 0===a&&(a=!1);for(var c=Array.from(e).map(function(R,P){return{score:R,boxIndex:P,suppressBeginIndex:0}}).filter(function(R){return R.score>i}).sort(wA),f=o>0?-.5/o:0,p=[],m=[];p.length<t&&c.length>0;){var y=c.pop(),w=y.score,E=y.boxIndex,A=y.suppressBeginIndex;if(w<i)break;for(var _=!1,T=p.length-1;T>=A;--T){var N=M5(n,E,p[T]);if(N>=r){_=!0;break}if(y.score=y.score*O5(r,f,N),y.score<=i)break}y.suppressBeginIndex=p.length,_||(y.score===w?(p.push(E),m.push(y.score)):y.score>i&&N5(c,y,wA))}var M=p.length;return a&&(p.fill(0,M),m.fill(0,M)),{selectedIndices:Or(p,"int32"),selectedScores:Or(m,"float32"),numValidOutputs:Pe(M,"int32")}}function M5(n,e,t){var r=n.subarray(4*e,4*e+4),i=n.subarray(4*t,4*t+4),o=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),c=Math.max(r[1],r[3]),f=Math.min(i[0],i[2]),p=Math.min(i[1],i[3]),m=Math.max(i[0],i[2]),y=Math.max(i[1],i[3]),w=(a-o)*(c-s),E=(m-f)*(y-p);if(w<=0||E<=0)return 0;var A=Math.max(o,f),_=Math.max(s,p),T=Math.min(a,m),N=Math.min(c,y),M=Math.max(T-A,0)*Math.max(N-_,0);return M/(w+E-M)}function O5(n,e,t){var r=Math.exp(e*t*t);return t<=n?r:0}function wA(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}function bA(n,e,t){var r=new Array(n.rank).fill(0),i=n.shape.slice();return e.map(function(o){i[t]=o;var s=n.slice(r,i);return r[t]+=o,s})}function CA(n,e){for(var t=new Array(n.rank),r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];var i=Tt(t,n.dtype);for(r=0;r<i.values.length;++r){for(var o=i.indexToLoc(r),s=new Array(n.rank),a=0;a<s.length;a++)s[a]=o[a]%n.shape[a];var c=n.locToIndex(s);i.values[r]=n.values[c]}return i.toTensor()}function EA(n,e,t,r,i){for(var o=e[e.length-1],s=[n.length/o,o],a=s[0],c=s[1],f=_l(t,a*r),p=_l("int32",a*r),m=0;m<a;m++){for(var y=m*c,w=n.subarray(y,y+c),E=[],A=0;A<w.length;A++)E.push({value:w[A],index:A});E.sort(function(R,P){return P.value-R.value});var _=m*r,T=f.subarray(_,_+r),N=p.subarray(_,_+r);for(A=0;A<r;A++)T[A]=E[A].value,N[A]=E[A].index}var M=e.slice();return M[M.length-1]=r,[fi(f,M,t),fi(p,M,"int32")]}function Av(n,e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(r);var i=Tt(n,"int32"),o=Tt([t.length,n.length],"int32");for(r=0;r<t.length;r++){var s=i.indexToLoc(t[r]);o.values.set(s,r*n.length)}return o.toTensor()}Object.freeze({castTensor:bv,reshapeTensor:Hp,linspaceImpl:Cv,upcastType:ni,axesAreInnerMostDims:cv,combineLocations:tA,computeOutAndReduceShapes:ci,expandShapeToKeepDim:zi,assertAxesAreInnerMostDims:no,getAxesPermutation:Es,getUndoAxesPermutation:Rp,getInnerMostAxes:_s,getBroadcastDims:Ma,getReductionAxes:Fr,assertAndGetBroadcastShape:zt,assertParamsConsistent:nA,computeOutShape:ic,computePool2DInfo:Nl,computePool3DInfo:Ed,computeConv2DInfo:Cu,computeConv3DInfo:_d,computeDefaultPad:xv,tupleValuesAreOne:uc,eitherStridesOrDilationsAreOne:Gi,convertConv2DDataFormat:Wp,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:Lp});var F5=function(n,e){this.outputShape=[],this.outputShape=n,this.variableNames=e.map(function(i,o){return"T"+o});var t=[];this.variableNames.forEach(function(i){t.push("float v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode="\n      void main() {\n        "+t.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},P5=function(n,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=e.map(function(i,o){return"T"+o});var t=[];this.variableNames.forEach(function(i){t.push("vec4 v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode="\n      void main() {\n        "+t.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},k5=function(n,e,t){this.variableNames=["A"];var r=n.windowSize,i=n.batchSize,s=Math.ceil(n.inSize/r);t||this.variableNames.push("bestIndicesA"),this.outputShape=[i,s],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+(t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));")+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+("max"===e?">":"<")+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function _A(n,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return n+"."+t})}function io(n,e){return 1===e?[n]:_A(n,e)}function _i(){var n,e,t,r,i,o,s,a,c,f;return 2===le().getNumber("WEBGL_VERSION")?(n="#version 300 es",e="in",t="out",r="in",i="texture",o="outputColor",s="out vec4 outputColor;",a="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",c="",f="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(n="",e="attribute",t="varying",r="varying",i="texture2D",o="gl_FragColor",s="",a="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",c="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",f="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:i,output:o,defineOutput:s,defineSpecialNaN:a,defineSpecialInf:c,defineRound:f}}function cc(n,e,t){void 0===t&&(t="index");var r=bs(e);return r.map(function(i,o){return"int "+n[o]+" = "+t+" / "+i+"; "+(o===r.length-1?"int "+n[o+1]+" = "+t+" - "+n[o]+" * "+i:"index -= "+n[o]+" * "+i)+";"}).join("")}function Dv(n){var e=bs(n).map(function(t){return t.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+e[0]+" + coords.y * "+e[1]+" + coords.z;\n  }\n"}var IA="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function L5(n,e,t,r){var i=[];n.forEach(function(w){var E=$e(w.shapeInfo.logicalShape);w.shapeInfo.isUniform?i.push("uniform float "+w.name+(E>1?"["+E+"]":"")+";"):(i.push("uniform sampler2D "+w.name+";"),i.push("uniform int offset"+w.name+";"))});var o,s,w,a=i.join("\n"),c=n.map(function(w){return function(E,A,_){void 0===_&&(_=!1);var T="";return T+=_?AA(E):Ml(E),E.shapeInfo.logicalShape.length<=A.logicalShape.length&&(T+=_?function(R,P){var B,xe,Y=R.name,X=Y.charAt(0).toUpperCase()+Y.slice(1),z="get"+X+"AtOutCoords",G=R.shapeInfo.logicalShape.length,ee=P.logicalShape.length,J=Ma(R.shapeInfo.logicalShape,P.logicalShape),pe=Bn(ee),fe=ee-G,he=["x","y","z","w","u","v"];B=0===G?"":ee<2&&J.length>=1?"coords = 0;":J.map(function(rt){return"coords."+he[rt+fe]+" = 0;"}).join("\n"),xe=ee<2&&G>0?"coords":R.shapeInfo.logicalShape.map(function(rt,lt){return"coords."+he[lt+fe]}).join(", ");var we="return outputValue;",me=1===$e(R.shapeInfo.logicalShape),Ie=1===$e(P.logicalShape);if(1!==G||me||Ie){if(me&&!Ie)we=1===ee?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(J.length){var De=G-2,je=G-1;J.indexOf(De)>-1&&J.indexOf(je)>-1?we="return vec4(outputValue.x);":J.indexOf(De)>-1?we="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":J.indexOf(je)>-1&&(we="return vec4(outputValue.xx, outputValue.zz);")}}else we="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+z+"() {\n      "+pe+" coords = getOutputCoords();\n      "+B+"\n      vec4 outputValue = get"+X+"("+xe+");\n      "+we+"\n    }\n  "}(E,A):function(R,P){var B=R.name,Y=B.charAt(0).toUpperCase()+B.slice(1),X="get"+Y+"AtOutCoords",ee=R.shapeInfo.logicalShape.length,J=P.logicalShape.length;if(!R.shapeInfo.isUniform&&ee===J&&null==R.shapeInfo.flatOffset&&Rr(R.shapeInfo.texShape,P.texShape))return"\n      float "+X+"() {\n        return sampleTexture("+B+", resultUV);\n      }\n    ";var fe=Bn(J),he=Ma(R.shapeInfo.logicalShape,P.logicalShape),xe=J-ee,we=["x","y","z","w","u","v"];return"\n    float "+X+"() {\n      "+fe+" coords = getOutputCoords();\n      "+(0===ee?"":J<2&&he.length>=1?"coords = 0;":he.map(function(Ie){return"coords."+we[Ie+xe]+" = 0;"}).join("\n"))+"\n      return get"+Y+"("+(J<2&&ee>0?"coords":R.shapeInfo.logicalShape.map(function(Ie,De){return"coords."+we[De+xe]}).join(", "))+");\n    }\n  "}(E,A)),T}(w,e,r)}).join("\n"),f=e.texShape,p=_i(),m="\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+p.texture2D+"(textureSampler, uv).r;\n    }\n  ",y=(w=p).version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+w.varyingFs+" vec2 resultUV;\n    "+w.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+w.defineSpecialNaN+"\n    "+w.defineSpecialInf+"\n    "+w.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+B5+"\n    "+V5+"\n    "+U5+"\n  ";return e.isPacked?(o=function(w,E){switch(w.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return P=E,1===(B=[Math.ceil(P[0]/2),Math.ceil(P[1]/2)])[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+B[1]+".0);\n      }\n    ":1===B[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+B[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+B[0]+", "+B[1]+"));\n      return 2 * (resTexRC.x * "+B[1]+" + resTexRC.y);\n    }\n  ";case 2:return function(R,P){var B=[Math.ceil(P[0]/2),Math.ceil(P[1]/2)];if(Rr(R,P))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+B[0]+", "+B[1]+"));\n      }\n    ";var Y=Math.ceil(R[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+B[0]+", "+B[1]+"));\n\n      int index = resTexRC.x * "+B[1]+" + resTexRC.y;\n      int r = 2 * (index / "+Y+");\n      int c = imod(index, "+Y+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(w,E);case 3:return A=w,_=E,T=[Math.ceil(_[0]/2),Math.ceil(_[1]/2)],M=(N=Math.ceil(A[2]/2))*Math.ceil(A[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+T[0]+", "+T[1]+"));\n      int index = resTexRC.x * "+T[1]+" + resTexRC.y;\n\n      int b = index / "+M+";\n      index -= b * "+M+";\n\n      int r = 2 * (index / "+N+");\n      int c = imod(index, "+N+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(R,P){for(var B=[Math.ceil(P[0]/2),Math.ceil(P[1]/2)],Y=Math.ceil(R[R.length-1]/2),X=Y*Math.ceil(R[R.length-2]/2),z=X,G="",ee="b, r, c",J=2;J<R.length-1;J++)G="\n      int b"+J+" = index / "+(z*=R[R.length-J-1])+";\n      index -= b"+J+" * "+z+";\n    "+G,ee="b"+J+", "+ee;return"\n    ivec"+R.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+B[0]+", "+B[1]+"));\n      int index = resTexRC.x * "+B[1]+" + resTexRC.y;\n\n      "+G+"\n\n      int b = index / "+X+";\n      index -= b * "+X+";\n\n      int r = 2 * (index / "+Y+");\n      int c = imod(index, "+Y+") * 2;\n\n      return ivec"+R.length+"("+ee+");\n    }\n  "}(w,E)}var P,B,A,_,T,N,M}(e.logicalShape,f),s=function(w){return"\n    void setOutput(vec4 val) {\n      "+w.output+" = val;\n    }\n  "}(p)):(o=function(w,E){switch(w.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return 1===(N=E)[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+N[1]+".0);\n      }\n    ":1===N[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+N[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+N[0]+", "+N[1]+"));\n      return resTexRC.x * "+N[1]+" + resTexRC.y;\n    }\n  ";case 2:return function(T,N){return Rr(T,N)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+N[0]+", "+N[1]+"));\n      }\n    ":1===T[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+N[0]+", "+N[1]+"));\n        int index = resTexRC.x * "+N[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===T[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+N[0]+", "+N[1]+"));\n        int index = resTexRC.x * "+N[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+N[0]+", "+N[1]+"));\n      int index = resTexRC.x * "+N[1]+" + resTexRC.y;\n      int r = index / "+T[1]+";\n      int c = index - r * "+T[1]+";\n      return ivec2(r, c);\n    }\n  "}(w,E);case 3:return A=E,_=cc(["r","c","d"],w),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+A[0]+", "+A[1]+"));\n      int index = resTexRC.x * "+A[1]+" + resTexRC.y;\n      "+_+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(T,N){var M=cc(["r","c","d","d2"],T);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+N[0]+", "+N[1]+"));\n      int index = resTexRC.x * "+N[1]+" + resTexRC.y;\n      "+M+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(w,E);case 5:return function(T,N){var M=cc(["r","c","d","d2","d3"],T);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+N[0]+",\n                             "+N[1]+"));\n\n      int index = resTexRC.x * "+N[1]+" + resTexRC.y;\n\n      "+M+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(w,E);case 6:return function(T,N){var M=cc(["r","c","d","d2","d3","d4"],T);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+N[0]+", "+N[1]+"));\n      int index = resTexRC.x * "+N[1]+" + resTexRC.y;\n\n      "+M+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(w,E);default:throw new Error(w.length+"-D output sampling is not yet supported")}var N,A,_}(e.logicalShape,f),s=function(w){return"\n    void setOutput(float val) {\n      "+w.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(p)),r&&(y+=j5),[y,m,s,a,o,c,t].join("\n")}function Ml(n){var e=n.shapeInfo.logicalShape;switch(e.length){case 0:return function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return"float "+i+"() {return "+r+";}";var o=t.shapeInfo.texShape;if(1===o[0]&&1===o[1])return"\n      float "+i+"() {\n        return sampleTexture("+r+", halfCR);\n      }\n    ";var c=t.shapeInfo.texShape;return"\n    float "+i+"() {\n      vec2 uv = uvFromFlat("+c[0]+", "+c[1]+", "+lc(r)+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(n);case 1:return function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return"\n      float "+i+"(int index) {\n        "+Ol(t)+"\n      }\n    ";var o=t.shapeInfo.texShape,s=o[0],a=o[1];if(1===a&&1===s)return"\n      float "+i+"(int index) {\n        return sampleTexture("+r+", halfCR);\n      }\n    ";var c=lc(r);return 1===a?"\n      float "+i+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+c+") + 0.5) / "+s+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":1===s?"\n      float "+i+"(int index) {\n        vec2 uv = vec2((float(index + "+c+") + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+i+"(int index) {\n      vec2 uv = uvFromFlat("+s+", "+a+", index + "+c+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(n);case 2:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=t.shapeInfo.texShape;if(null!=s&&Rr(r,s))return"\n    float "+o+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+s[1]+".0, "+s[0]+".0);\n      return sampleTexture("+i+", uv);\n    }\n  ";var f=vu(r),p=f.newShape,m=f.keptDims;if(p.length<r.length)return"\n      "+Ml(Fl(t,p))+"\n      float "+o+"(int row, int col) {\n        return "+o+"("+Pl(["row","col"],m)+");\n      }\n    ";if(t.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+r[1]+", 1)));\n        "+Ol(t)+"\n      }\n    ";var E=s[0],A=s[1],_=lc(i);return 1===A?"\n    float "+o+"(int row, int col) {\n      float index = dot(vec3(row, col, "+_+"), vec3("+r[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+E+".0);\n      return sampleTexture("+i+", uv);\n    }\n  ":1===E?"\n    float "+o+"(int row, int col) {\n      float index = dot(vec3(row, col, "+_+"), vec3("+r[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+A+".0, 0.5);\n      return sampleTexture("+i+", uv);\n    }\n  ":"\n  float "+o+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+r[1]+" + col + "+_+";\n    vec2 uv = uvFromFlat("+E+", "+A+", index);\n    return sampleTexture("+i+", uv);\n  }\n"}(n);case 3:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[1]*r[2],a=r[2],c=vu(r),f=c.newShape,p=c.keptDims;if(f.length<r.length)return"\n        "+Ml(Fl(t,f))+"\n        float "+o+"(int row, int col, int depth) {\n          return "+o+"("+Pl(["row","col","depth"],p)+");\n        }\n      ";if(t.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+s+", "+a+", 1)));\n        "+Ol(t)+"\n      }\n    ";var w=t.shapeInfo.texShape,E=w[0],A=w[1],_=t.shapeInfo.flatOffset;return A===s&&null==_?"\n        float "+o+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+A+".0, "+E+".0);\n          return sampleTexture("+i+", uv);\n        }\n      ":A===a&&null==_?"\n    float "+o+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+r[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+A+".0, "+E+".0);\n      return sampleTexture("+i+", uv);\n    }\n  ":"\n      float "+o+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+s+" + col * "+a+" + depth + "+lc(i)+";\n        vec2 uv = uvFromFlat("+E+", "+A+", index);\n        return sampleTexture("+i+", uv);\n      }\n  "}(n);case 4:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[3],a=r[2]*s,c=r[1]*a,f=vu(r),p=f.newShape,m=f.keptDims;if(p.length<r.length)return"\n      "+Ml(Fl(t,p))+"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        return "+o+"("+Pl(["row","col","depth","depth2"],m)+");\n      }\n    ";if(t.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+c+", "+a+", "+s+", 1)));\n        "+Ol(t)+"\n      }\n    ";var w=t.shapeInfo.flatOffset,E=t.shapeInfo.texShape,A=E[0],_=E[1];return _===c&&null==w?"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+a+", "+s+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+_+".0, "+A+".0);\n        return sampleTexture("+i+", uv);\n      }\n    ":_===s&&null==w?"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+r[1]*r[2]+", "+r[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+_+".0, "+A+".0);\n        return sampleTexture("+i+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+c+" + col * "+a+" +\n          depth * "+s+" + depth2;\n      vec2 uv = uvFromFlat("+A+", "+_+", index + "+lc(i)+");\n      return sampleTexture("+i+", uv);\n    }\n  "}(n);case 5:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[4],a=r[3]*s,c=r[2]*a,f=r[1]*c,p=vu(r),m=p.newShape,y=p.keptDims;if(m.length<r.length)return"\n      "+Ml(Fl(t,m))+"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+o+"("+Pl(["row","col","depth","depth2","depth3"],y)+");\n      }\n    ";if(t.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+f+", "+c+", "+a+", "+s+")) +\n          depth3;\n        "+Ol(t)+"\n      }\n    ";var E=t.shapeInfo.flatOffset,A=t.shapeInfo.texShape,_=A[0],T=A[1];return T===f&&null==E?"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+c+", "+a+", "+s+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+T+".0, "+_+".0);\n        return sampleTexture("+i+", uv);\n      }\n    ":T===s&&null==E?"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+r[1]*r[2]*r[3]+",\n               "+r[2]*r[3]+", "+r[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+T+".0, "+_+".0);\n        return sampleTexture("+i+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+f+" + col * "+c+" + depth * "+a+" +\n          depth2 * "+s+" + depth3 + "+lc(i)+";\n      vec2 uv = uvFromFlat("+_+", "+T+", index);\n      return sampleTexture("+i+", uv);\n    }\n  "}(n);case 6:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=vu(r),a=s.newShape,c=s.keptDims;if(a.length<r.length)return"\n      "+Ml(Fl(t,a))+"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+o+"("+Pl(["row","col","depth","depth2","depth3","depth4"],c)+");\n      }\n    ";var p=r[5],m=r[4]*p,y=r[3]*m,w=r[2]*y,E=r[1]*w;if(t.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+E+", "+w+", "+y+", "+m+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+p+", 1)));\n        "+Ol(t)+"\n      }\n    ";var A=t.shapeInfo.flatOffset,_=t.shapeInfo.texShape,T=_[0],N=_[1];return N===E&&null==A?"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+w+", "+y+", "+m+", "+p+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+N+".0, "+T+".0);\n        return sampleTexture("+i+", uv);\n      }\n    ":N===p&&null==A?"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+r[1]*r[2]*r[3]*r[4]+",\n               "+r[2]*r[3]*r[4]+",\n               "+r[3]*r[4]+",\n               "+r[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+N+".0, "+T+".0);\n        return sampleTexture("+i+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+E+" + col * "+w+" + depth * "+y+" +\n          depth2 * "+m+" + depth3 * "+p+" + depth4 + "+lc(i)+";\n      vec2 uv = uvFromFlat("+T+", "+N+", index);\n      return sampleTexture("+i+", uv);\n    }\n  "}(n);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function AA(n){var e,i,o,s,a,c,f;switch(n.shapeInfo.logicalShape.length){case 0:return"\n    vec4 get"+(e=n.name).charAt(0).toUpperCase()+e.slice(1)+"() {\n      return "+_i().texture2D+"("+e+", halfCR);\n    }\n  ";case 1:return s="get"+(o=(i=n).name).charAt(0).toUpperCase()+o.slice(1),a=i.shapeInfo.texShape,c=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],f=_i(),"\n    vec4 "+s+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+c[0]+", "+c[1]+", index);\n      return "+f.texture2D+"("+o+", uv);\n    }\n  ";case 2:return function(i){var o=i.shapeInfo.logicalShape,s=i.name,a="get"+s.charAt(0).toUpperCase()+s.slice(1),c=i.shapeInfo.texShape,f=c[0],p=c[1],m=_i();if(null!=c&&Rr(o,c))return"\n      vec4 "+a+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+p+".0, "+f+".0);\n\n        return "+m.texture2D+"("+s+", uv);\n      }\n    ";var y=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];return"\n    vec4 "+a+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(o[1]/2)+", "+y[0]+", "+y[1]+", row, col);\n      return "+m.texture2D+"("+s+", uv);\n    }\n  "}(n);case 3:return function(i){var o=i.shapeInfo.logicalShape,s=i.name,a="get"+s.charAt(0).toUpperCase()+s.slice(1),c=i.shapeInfo.texShape,f=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];if(1===o[0])return"\n        "+AA(Fl(i,o.slice(1)))+"\n        vec4 "+a+"(int b, int row, int col) {\n          return "+a+"("+Pl(["b","row","col"],[1,2])+");\n        }\n      ";var y=f[0],w=f[1],E=Math.ceil(o[2]/2);return"\n    vec4 "+a+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+y+", "+w+", "+E*Math.ceil(o[1]/2)+", "+E+", b, row, col);\n      return "+_i().texture2D+"("+s+", uv);\n    }\n  "}(n);default:return function(i){for(var o=i.shapeInfo.logicalShape,s=o.length,a=i.name,c="get"+a.charAt(0).toUpperCase()+a.slice(1),f=i.shapeInfo.texShape,p=[Math.ceil(f[0]/2),Math.ceil(f[1]/2)],m=p[0],y=p[1],w=Math.ceil(o[s-1]/2),E=w*Math.ceil(o[s-2]/2),A="int b, int row, int col",_="b * "+E+" + (row / 2) * "+w+" + (col / 2)",T=2;T<s-1;T++)A="int b"+T+", "+A,_="b"+T+" * "+(E*=o[s-T-1])+" + "+_;return"\n    vec4 "+c+"("+A+") {\n      int index = "+_+";\n      int texR = index / "+y+";\n      int texC = index - texR * "+y+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+y+", "+m+");\n      return "+_i().texture2D+"("+a+", uv);\n    }\n  "}(n)}}var B5="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",V5="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",U5="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",j5="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function lc(n){return"offset"+n}function Ol(n){var e=n.name,t=$e(n.shapeInfo.logicalShape);return t<2?"return "+e+";":"\n    for (int i = 0; i < "+t+"; i++) {\n      if (i == index) {\n        return "+e+"[i];\n      }\n    }\n  "}function Bn(n){if(n<=1)return"int";if(2===n)return"ivec2";if(3===n)return"ivec3";if(4===n)return"ivec4";if(5===n)return"ivec5";if(6===n)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function Fl(n,e){var t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Pl(n,e){return e.map(function(t){return n[t]}).join(", ")}var W5=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,H(n.length>2,function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."});var o=Math.ceil(n[n.length-1]/e);this.outputShape=n.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var s,a,c=this.outputShape,f=c.length,p=Bn(f),m=io("coords",f);if(1===o){var y=Bn(a=f+1);s="\n        "+y+" sourceLocR = "+y+"("+m.join()+", 0);\n        ++"+m[f-1]+";\n        "+y+" sourceLocG = "+y+"("+m.join()+", 0);\n        ++"+m[f-2]+";\n        "+y+" sourceLocA = "+y+"("+m.join()+", 0);\n        --"+m[f-1]+";\n        "+y+" sourceLocB = "+y+"("+m.join()+", 0);\n        --"+m[f-2]+";"}else a=f,s="\n        "+p+" sourceLocR = coords;\n        ++"+m[f-1]+";\n        "+p+" sourceLocG = coords;\n        ++"+m[f-2]+";\n        "+p+" sourceLocA = coords;\n        --"+m[f-1]+";\n        "+p+" sourceLocB = coords;\n        --"+m[f-2]+";";var w=["x","y","z","w","u","v"].slice(0,a),E="."+w[a-1],A=w.map(function(X){return"int "+X}),_=io("sourceLocR",a-1).concat("inIdx.r"),T=io("sourceLocG",a-1).concat("inIdx.g"),N=io("sourceLocB",a-1).concat("inIdx.b"),M=io("sourceLocA",a-1).concat("inIdx.a"),R="max"===t?"greaterThan":"lessThan",P=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+_.join()+"),\n                             getBestIndicesAChannel("+T.join()+"),\n                             getBestIndicesAChannel("+N.join()+"),\n                             getBestIndicesAChannel("+M.join()+")));",B="vec4(\n            getAChannel("+_.join()+"),\n            hasNextCol ? getAChannel("+T.join()+") : 0.,\n            hasNextRow ? getAChannel("+N.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+M.join()+") : 0.)",Y=r?"":"\n      float getBestIndicesAChannel("+A.join()+") {\n        return getChannel(getBestIndicesA("+w.join()+"),\n                                          vec2("+w.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+A.join()+") {\n        return getChannel(getA("+w.join()+"),\n                               vec2("+w.slice(-2).join()+"));\n      }\n      "+Y+"\n      void main() {\n        "+p+" coords = getOutputCoords();\n        bool hasNextCol = "+m[f-1]+" < "+(c[f-1]-1)+";\n        bool hasNextRow = "+m[f-2]+" < "+(c[f-2]-1)+";\n        "+s+"\n        ivec4 srcIdx = ivec4(sourceLocR"+E+", sourceLocG"+E+",\n          sourceLocB"+E+", sourceLocA"+E+") * "+e+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+B+";\n\n        for (int i = 0; i < "+e+"; i++) {\n          inIdx = srcIdx;\n          "+P+"\n          vec4 candidate = "+B+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+R+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},H5=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var a=n.effectiveFilterHeight,c=n.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(a-1-n.padInfo.top)+", "+(c-1-n.padInfo.left)+");\n      const float avgMultiplier = float("+1/(n.filterHeight*n.filterWidth)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+a+";\n            wR += "+n.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+c+";\n            wC+= "+n.dilationWidth+") {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},z5=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var p=n.effectiveFilterDepth,m=n.effectiveFilterHeight,y=n.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(p-1-n.padInfo.front)+", "+(m-1-n.padInfo.top)+", "+(y-1-n.padInfo.left)+");\n      const float avgMultiplier = float("+1/(n.filterDepth*n.filterHeight*n.filterWidth)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+p+";\n            wD += "+n.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+n.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+n.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+m+";\n              wR += "+n.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+n.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+y+";\n                wC += "+n.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},G5=function(n,e,t,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],zt(n,e),zt(n,t);var s="0.0";null!=r&&(zt(n,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var a="1.0";null!=i&&(zt(n,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=n,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+s+";\n        float scale = "+a+";\n        float inv = scale * inversesqrt(variance + float("+o+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},Y5=function(n,e,t,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],zt(n,e),zt(n,t);var s="vec4(0.0)";null!=r&&(zt(n,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var a="vec4(1.0)";null!=i&&(zt(n,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=n,this.userCode="\n      void main() {\n        vec4 offset = "+s+";\n        vec4 scale = "+a+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+o+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},DA=function(n,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=zt(e,t),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+n+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},Tv="return a + b;",Sv="return a - b;",TA="return a * b;",SA="return (a < 0.) ? b * a : a;",vr=function(n,e,t){this.variableNames=["A","B"],this.outputShape=zt(e,t),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+n+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},NA="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",Oa=function(n,e,t,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=zt(e,t);var i=this.outputShape.length,o="";if(r)if(0===i||1===$e(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(o="\n          "+Bn(i)+" coords = getOutputCoords();\n        ",1===i)o+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var s=io("coords",i);o+="\n            bool nextRowOutOfBounds =\n              ("+s[i-2]+" + 1) >= "+this.outputShape[i-2]+";\n            bool nextColOutOfBounds =\n              ("+s[i-1]+" + 1) >= "+this.outputShape[i-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+n+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+o+"\n\n        setOutput(result);\n      }\n    "},K5=function(){function n(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,o){null==r.minLoc&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n}(),Q5=function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,o){null==r.minLoc&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n}(),$5=function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},Z5=function(n){this.outputShape=[],this.outputShape=ic(n,1),this.variableNames=n.map(function(a,c){return"T"+c});var e=new Array(n.length-1);e[0]=n[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+n[t][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++)r.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+e[t-1]+"));");r.push("else setOutput(getT"+e.length+"(yR, yC-"+e[e.length-1]+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},J5=function(n,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=ic(n,e);var t=this.outputShape,r=t.length,i=Bn(r),o=io("coords",r),s=["x","y","z","w","u","v"].slice(0,r);this.variableNames=n.map(function(_,T){return"T"+T});var a=new Array(n.length-1);a[0]=n[0][e];for(var c=1;c<a.length;c++)a[c]=a[c-1]+n[c][e];var f=s[e],p=s.slice(-2),m=s.join(),y="if ("+f+" < "+a[0]+") {\n        return getChannel(\n            getT0("+m+"), vec2("+p.join()+"));\n        }";for(c=1;c<a.length;c++){var w=a[c-1];y+="\n        if ("+f+" < "+a[c]+"  && "+f+" >= "+a[c-1]+") {\n          return getChannel(\n            getT"+c+"("+zp(s,f,w)+"),\n            vec2("+zp(p,f,w)+"));\n        }"}var A=a[a.length-1];y+="\n        return getChannel(\n          getT"+a.length+"("+zp(s,f,A)+"),\n          vec2("+zp(p,f,A)+"));",this.userCode="\n      float getValue("+s.map(function(_){return"int "+_})+") {\n        "+y+"\n      }\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+o+"), 0., 0., 0.);\n\n        "+o[r-1]+" = "+o[r-1]+" + 1;\n        if ("+o[r-1]+" < "+t[r-1]+") {\n          result.g = getValue("+o+");\n        }\n\n        "+o[r-2]+" = "+o[r-2]+" + 1;\n        if ("+o[r-2]+" < "+t[r-2]+") {\n          result.a = getValue("+o+");\n        }\n\n        "+o[r-1]+" = "+o[r-1]+" - 1;\n        if ("+o[r-2]+" < "+t[r-2]+" &&\n            "+o[r-1]+" < "+t[r-1]+") {\n          result.b = getValue("+o+");\n        }\n        setOutput(result);\n      }\n    "};function zp(n,e,t){var r=n.indexOf(e);return n.map(function(i,o){return o===r?i+" - "+t:i}).join()}var e7=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n            int xR = wR + yR * "+n.strideHeight+" - "+n.padInfo.top+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n              int xC = wC + yC * "+n.strideWidth+" - "+n.padInfo.left+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              if ("+("channelsLast"===n.dataFormat)+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},t7=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,o="channelsLast"===n.dataFormat;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-n.padInfo.top)+", "+(t-1-n.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+(o?3:1)+"];\n\n        ivec2 dyCorner = ivec2(coords["+(o?1:2)+"], coords["+(o?2:3)+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+t+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+t+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+n.outChannels+"; d2++) {\n\n              if ("+o+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},n7=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape,this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yF = 0; yF < "+n.outDepth+"; yF++) {\n            int xF = wF + yF * "+n.strideDepth+" - "+n.padInfo.front+";\n\n            if (xF < 0 || xF >= "+n.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n              int xR = wR + yR * "+n.strideHeight+" - "+n.padInfo.top+";\n\n              if (xR < 0 || xR >= "+n.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n                int xC = wC + yC * "+n.strideWidth+" - "+n.padInfo.left+";\n\n                if (xC < 0 || xC >= "+n.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},r7=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(e-1-n.padInfo.front)+", "+(t-1-n.padInfo.top)+", "+(r-1-n.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+e+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+n.strideDepth+".0;\n\n          if (dyF < 0.0 || dyF >= "+n.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+e+" - 1 - wF;\n\n          for (int wR = 0; wR < "+t+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+n.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+t+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+n.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},i7=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+n.outChannels/n.inChannels+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n            int xR = wR + yR * "+n.strideHeight+" - "+n.padInfo.top+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n              int xC = wC + yC * "+n.strideWidth+" - "+n.padInfo.left+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},o7=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,a=n.outChannels/n.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-n.padInfo.top)+", "+(t-1-n.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+t+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+t+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+a+"; dm++) {\n              int d2 = d1 * "+a+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},RA=function(n,e,t,r){void 0===e&&(e=!1),void 0===t&&(t=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var i=n.padInfo.top,o=n.padInfo.left,s=n.strideHeight,a=n.strideWidth,c=n.dilationHeight,f=n.dilationWidth,p=n.filterHeight,m=n.filterWidth,y=4*Math.floor(n.inChannels/4),w=n.inChannels%4,E="channelsLast"===n.dataFormat,A=E?1:2,_=E?2:3,T=E?3:1,N="",M="";t&&(N=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+t+"\n        }":"\n          float activation(float x) {\n            "+t+"\n          }\n        ",M="result = activation(result);");var R=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+N+"\n\n      const ivec2 strides = ivec2("+s+", "+a+");\n      const ivec2 pads = ivec2("+i+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+T+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+A+"], coords["+_+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+p+"; wR++) {\n          int xR = xRCorner + wR * "+c+";\n\n          if (xR < 0 || xR >= "+n.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+m+"; wC++) {\n            int xC = xCCorner + wC * "+f+";\n\n            if (xC < 0 || xC >= "+n.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+y+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+E+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===w)+") {\n\n              if ("+E+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+y+") *\n                    getW(wR, wC, "+y+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+y+", xR, xC) *\n                    getW(wR, wC, "+y+", d2);\n              }\n\n            } else if ("+(2===w)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+y+", d2),\n                getW(wR, wC, "+y+" + 1, d2)\n              );\n\n              if ("+E+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+y+"),\n                  getX(batch, xR, xC, "+y+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+y+", xR, xC),\n                  getX(batch, "+y+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===w)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+y+", d2),\n                getW(wR, wC, "+y+" + 1, d2),\n                getW(wR, wC, "+y+" + 2, d2)\n              );\n\n              if ("+E+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+y+"),\n                  getX(batch, xR, xC, "+y+" + 1),\n                  getX(batch, xR, xC, "+y+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+y+", xR, xC),\n                  getX(batch, "+y+" + 1, xR, xC),\n                  getX(batch, "+y+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+R+"\n        "+M+"\n        setOutput(result);\n      }\n    "},s7=function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.padInfo.front,t=n.padInfo.top,r=n.padInfo.left,i=n.strideDepth,o=n.strideHeight,s=n.strideWidth,a=n.dilationDepth,c=n.dilationHeight,f=n.dilationWidth,p=n.filterDepth,m=n.filterHeight,y=n.filterWidth,w=4*Math.floor(n.inChannels/4),E=n.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+i+", "+o+", "+s+");\n      const ivec3 pads = ivec3("+e+", "+t+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+p+"; wF++) {\n          int xF = xFCorner + wF * "+a+";\n\n          if (xF < 0 || xF >= "+n.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+m+"; wR++) {\n            int xR = xRCorner + wR * "+c+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+y+"; wC++) {\n              int xC = xCCorner + wC * "+f+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+w+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===E)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+w+") *\n                  getW(wF, wR, wC, "+w+", d2);\n              } else if ("+(2===E)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+w+"),\n                  getX(batch, xF, xR, xC, "+w+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+w+", d2),\n                  getW(wF, wR, wC, "+w+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===E)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+w+"),\n                  getX(batch, xF, xR, xC, "+w+" + 1),\n                  getX(batch, xF, xR, xC, "+w+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+w+", d2),\n                  getW(wF, wR, wC, "+w+" + 1, d2),\n                  getW(wF, wR, wC, "+w+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},MA=function(n,e,t,r){void 0===e&&(e=!1),void 0===t&&(t=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var i=n.inHeight,o=n.inWidth,s=n.padInfo.top,a=n.padInfo.left,c=n.strideHeight,f=n.strideWidth,p=n.dilationHeight,m=n.dilationWidth,y=n.filterHeight,w=n.filterWidth,E=n.outChannels/n.inChannels,A="",_="";t&&(A=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+t+"\n        }":"\n          float activation(float x) {\n            "+t+"\n          }\n        ",_="result = activation(result);");var T=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+A+"\n\n      const ivec2 strides = ivec2("+c+", "+f+");\n      const ivec2 pads = ivec2("+s+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+E+";\n        int q = d2 - d1 * "+E+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+y+"; wR++) {\n          int xR = xRCorner + wR * "+p+";\n\n          if (xR < 0 || xR >= "+i+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+w+"; wC++) {\n            int xC = xCCorner + wC * "+m+";\n\n            if (xC < 0 || xC >= "+o+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+T+"\n        "+_+"\n        setOutput(result);\n      }\n    "},OA=function(n,e,t,r){void 0===e&&(e=!1),void 0===t&&(t=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;for(var i=n.inHeight,o=n.inWidth,s=n.padInfo.top,a=n.padInfo.left,c=n.strideHeight,f=n.strideWidth,p=n.dilationHeight,m=n.dilationWidth,y=n.filterHeight,w=n.filterWidth,E=w,A="int xR; int xC; int xCOffset;",_=0;_<y;_++)for(var T=0;T<w;T++)A+="\n          vec4 xTexelR"+_+"C"+2*T+" = vec4(0.);\n          vec4 wR"+_+"C"+T+" = vec4(0.);\n          vec4 xR"+_+"C"+T+" = vec4(0.);";for(_=0;_<y;_++)for(var N=0;N<E;N++){if(A+="\n          xR = xRCorner + "+_*p+";\n          xC = xCCorner + "+(T=2*N)*m+";\n        ",1===f){if(T<w&&(A+=a%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+o+") {\n                  xTexelR"+_+"C"+T+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+o+") {\n                    xTexelR"+_+"C"+T+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+_+"C"+T+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+o+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+o+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+_+"C"+T+" = vec4(previous.zw, xTexelR"+_+"C"+T+".xy);\n                } else {\n                  xR"+_+"C"+T+" = vec4(0, 0, xTexelR"+_+"C"+T+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+i+" && xC >= 0 && xC < "+o+") {\n                  xTexelR"+_+"C"+T+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+_+"C"+T+" = vec4(0.);\n                }\n\n                xR"+_+"C"+T+" = xTexelR"+_+"C"+T+";\n              ",T+1<w)){var M=a%2==0?jm(m):m;m%2==0&&a%2==1||m%2!=0&&a%2!=1?(A+="\n                  xCOffset = xC + "+a%2+" + "+M+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+o+") {\n                    xTexelR"+_+"C"+(T+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",m>1&&(A+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+i+" &&\n                      xCOffset >= 0 && xCOffset < "+o+") {\n                      xTexelR"+_+"C"+T+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+_+"C"+T+" = vec4(0.);\n                    }\n                  "),A+="\n                  xR"+_+"C"+(T+1)+" = vec4(\n                    xTexelR"+_+"C"+T+".zw, xTexelR"+_+"C"+(T+2)+".xy);\n                "):A+="\n                  xCOffset = xC + "+M+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+o+") {\n                    xTexelR"+_+"C"+(T+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+_+"C"+(T+1)+" = xTexelR"+_+"C"+(T+2)+";\n                "}}else T<w&&(A+="\n              if(xR >= 0 && xR < "+i+") {\n            ",a%2==1?(A+="\n                xCOffset = xC + 1 - "+f+";\n                if(xCOffset >= 0 && xCOffset < "+o+") {\n                  xTexelR"+_+"C"+T+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+_+"C"+T+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+o+") {\n                  xTexelR"+_+"C"+(T+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+_+"C"+(T+2)+" = vec4(0.);\n                }\n\n                xR"+_+"C"+T+" = vec4(\n                  xTexelR"+_+"C"+T+".zw, xTexelR"+_+"C"+(T+2)+".zw);\n              ",T+1<w&&(A+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+f+";\n                  if(xCOffset >= 0 && xCOffset < "+o+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+_+"C"+(T+1)+" = vec4(xTexelR"+_+"C"+(T+2)+".xy, final.xy);\n                ")):(A+="\n                if(xC >= 0 && xC < "+o+") {\n                  xTexelR"+_+"C"+T+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+_+"C"+T+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+f+";\n                if(xCOffset >= 0 && xCOffset < "+o+") {\n                  xTexelR"+_+"C"+(T+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+_+"C"+(T+2)+" = vec4(0.);\n                }\n\n                xR"+_+"C"+T+" = vec4(\n                  xTexelR"+_+"C"+T+".xy, xTexelR"+_+"C"+(T+2)+".xy);\n              ",T+1<w&&(A+="\n                  xR"+_+"C"+(T+1)+" = vec4(\n                    xTexelR"+_+"C"+T+".zw, xTexelR"+_+"C"+(T+2)+".zw);\n                ")),A+="}");T<w&&(A+="\n            vec4 wTexelR"+_+"C"+T+" = getW("+_+", "+T+", d1, q);\n            wR"+_+"C"+T+" = vec4(wTexelR"+_+"C"+T+".xz, wTexelR"+_+"C"+T+".xz);\n          ",T+1<w&&(A+="\n              vec4 wTexelR"+_+"C"+(T+1)+" = getW("+_+", "+(T+1)+", d1, q);\n              wR"+_+"C"+(T+1)+" =\n                vec4(wTexelR"+_+"C"+(T+1)+".xz, wTexelR"+_+"C"+(T+1)+".xz);"))}for(_=0;_<y;_++)for(T=0;T<w;T++)A+="dotProd += xR"+_+"C"+T+" * wR"+_+"C"+T+";";var R="",P="";t&&(R=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+t+"\n        }":"vec4 activation(vec4 x) {\n          "+t+"\n        }",P="result = activation(result);");var B=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+R+"\n\n      const ivec2 strides = ivec2("+c+", "+f+");\n      const ivec2 pads = ivec2("+s+", "+a+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+A+"\n\n        vec4 result = dotProd;\n        "+B+"\n        "+P+"\n        setOutput(result);\n      }\n    "},a7=function(n,e,t,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=n[0],s=n[1],a=n[2],p=t[0],m=t[1];this.outputShape=[e[0],p,m,n[3]];var w=[s-1+".0",a-1+".0"],E=w[0],A=w[1],_=p>1?[""+(s-1)/(p-1),"(y2-y1) * height_ratio","y1*"+E+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+E],R=m>1?[""+(a-1)/(m-1),"(x2-x1) * width_ratio","x1*"+A+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+A];this.userCode="\n      const float height_ratio = float("+_[0]+");\n      const float width_ratio = float("+R[0]+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+o+") {\n          return;\n        }\n\n        float height_scale = "+_[1]+";\n        float width_scale = "+R[1]+";\n\n        float in_y = "+_[2]+";\n        if( in_y < 0.0 || in_y > "+E+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n        float in_x = "+R[2]+";\n        if( in_x < 0.0 || in_x > "+A+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+("bilinear"===r?1:0)+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},u7=function(n,e,t){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=n[n.length-1],o=t?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(t?"return "+i+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+Bn(r)+" coords = getOutputCoords();\n        int end = "+FA(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+i+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+o+" end) {\n            continue;\n          }\n          if (idx == end && "+e+") {\n            continue;\n          }\n          "+FA(r,"coords")+" = idx;\n          val += getX("+function(s,a){if(1===s)return""+a;if(2===s)return a+".x, "+a+".y";if(3===s)return a+".x, "+a+".y, "+a+".z";if(4===s)return a+".x, "+a+".y, "+a+".z, "+a+".w";throw Error("Cumulative sum for rank "+s+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function FA(n,e){if(1===n)return""+e;if(2===n)return e+".y";if(3===n)return e+".z";if(4===n)return e+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var c7=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=hd.DENSE;var e=pd(n),t=_i();this.outputShape=n,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+cc(["r","c","d"],n)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+e[0]+", "+e[1]+"));\n        int index = 4 * (resTexRC.x * "+e[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+t.output+" = result;\n      }\n    "},l7=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=hd.DENSE;var e=pd(n),t=_i();this.outputShape=n,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+cc(["r","c","d"],n)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+e[0]+", "+e[1]+"));\n        int index = 4 * (resTexRC.x * "+e[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+t.output+" = result;\n      }\n    "},f7=function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return n.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n}(),d7=function(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},h7=function(n){this.variableNames=["A"],this.outTexUsage=bo.DOWNLOAD;var e=_i();this.outputShape=n,this.userCode="\n      "+IA+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+e.output+" = encode_float(x);\n      }\n    "},p7=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=bo.DOWNLOAD;var e=_i();this.outputShape=n,this.userCode="\n      "+IA+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+e.output+" = encode_float(x);\n      }\n    "},g7=function(n,e,t){void 0===t&&(t=!1),this.variableNames=["A"];var r=_i(),i=e[0],o=e[1];this.outputShape=n;var s="result";t&&(s="floor(result * 255. + 0.5)"),this.userCode="\n      "+Dv(n)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+o+";\n        int c = imod(flatIndex, "+o+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+o+".0, "+i+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+s+", 0., 0., 0.);\n      }\n    "},m7=function(n,e,t){void 0===t&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=_i(),i=e[0],o=e[1];this.outputShape=n;var s="",a="result";t&&(a="floor(result * 255. + 0.5)");for(var c=0;c<=1;c++)for(var f=0;f<=1;f++){var p=2*c+f;s+="\n          localCoords = coords;\n          if(localCoords[2] + "+f+" < "+n[2]+") {\n            localCoords[2] += "+f+";\n            if(localCoords[1] + "+c+" < "+n[1]+") {\n              localCoords[1] += "+c+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+o+";\n              c = imod(flatIndex, "+o+");\n              uv = (vec2(c, r) + halfCR) / vec2("+o+".0, "+i+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+p+"] = values[0];\n              } else if(offset == 1) {\n                result["+p+"] = values[1];\n              } else if(offset == 2) {\n                result["+p+"] = values[2];\n              } else {\n                result["+p+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+Dv(n)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+s+"\n\n        "+r.output+" = "+a+";\n      }\n    "},PA=function(n,e,t){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var i=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI;this.userCode="\n      const float exponentMultiplier = "+i+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+n+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+(t?r+".0":"1.0")+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},x7=function(){function n(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){null==t.valueLoc&&(t.valueLoc=r.getUniformLocationNoThrow(i,"value")),r.gl.uniform1f(t.valueLoc,e)}},n}(),w7=function(n,e,t){this.variableNames=["A","indices"];var r=n.slice();r[t]=e,this.outputShape=r,this.rank=r.length;var i=Bn(this.rank),o=function(s,a){var c=s.length;if(c>4)throw Error("Gather for rank "+c+" is not yet supported");if(1===c)return"int(getIndices(resRC))";for(var f=["resRC.x","resRC.y","resRC.z","resRC.w"],p=[],m=0;m<s.length;m++)p.push(m===a?"int(getIndices("+f[m]+"))":""+f[m]);return p.join()}(n,t);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+o+"));\n      }\n    "},b7=function(n,e,t){this.sliceDim=n,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var r=Bn(e.length),i=Bn(t.length);this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+i+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+(this.sliceDim>1?"strides[j]":"strides")+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function kA(n,e){var t=_i();return RI(n,e,t.version+"\n    precision highp float;\n    "+t.attribute+" vec3 clipSpacePos;\n    "+t.attribute+" vec2 uv;\n    "+t.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function LA(n,e){return PI(n,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function BA(n,e){return kI(n,e,new Uint16Array([0,1,2,2,1,3]))}function Ad(n,e,t,r,i,o,s){BI(t,r);var a=LI(n,e),c=n.TEXTURE_2D;return Ge(n,e,function(){return n.bindTexture(c,a)}),Ge(n,e,function(){return n.texParameteri(c,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)}),Ge(n,e,function(){return n.texParameteri(c,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)}),Ge(n,e,function(){return n.texParameteri(c,n.TEXTURE_MIN_FILTER,n.NEAREST)}),Ge(n,e,function(){return n.texParameteri(c,n.TEXTURE_MAG_FILTER,n.NEAREST)}),Ge(n,e,function(){return n.texImage2D(c,0,i,t,r,0,o,s,null)}),Ge(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)}),a}function VA(n,e,t,r,i){var o=Ep(t,r);return Ad(n,e,o[0],o[1],i.internalFormatFloat,i.textureFormatFloat,n.FLOAT)}function UA(n,e,t,r,i){var o=Ep(t,r);return Ad(n,e,o[0],o[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function jA(n,e,t,r,i){var o=Ep(t,r);return Ad(n,e,o[0],o[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function WA(n,e,t,r,i){var o=gd(t,r);return Ad(n,e,o[0],o[1],i.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function HA(n,e,t,r,i){var o=gd(t,r);return Ad(n,e,o[0],o[1],i.internalFormatPackedHalfFloat,n.RGBA,i.textureTypeHalfFloat)}function zA(n,e,t,r){return Ge(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),ov(n,e,t,"clipSpacePos",r,3,20,0)&&ov(n,e,t,"uv",r,2,20,12)}function GA(n,e,t,r,i,o,s){var a,c,f;Ge(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),o instanceof Uint8Array?(a=new Uint8Array(r*i*4),c=n.UNSIGNED_BYTE,f=n.RGBA):(a=new Float32Array(r*i*4),c=n.FLOAT,f=s.internalFormatPackedFloat),a.set(o),Ge(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,f,r,i,0,n.RGBA,c,a)}),Ge(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function YA(n,e,t,r){Ge(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),r.data instanceof Uint8Array?Ge(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r.width,r.height,0,n.RGBA,n.UNSIGNED_BYTE,r.data)}):Ge(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)}),Ge(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function XA(n,e,t,r,i){var o=n.createBuffer();Ge(n,e,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,o)});var s=16*t*r;return Ge(n,e,function(){return n.bufferData(n.PIXEL_PACK_BUFFER,s,n.STREAM_READ)}),Ge(n,e,function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,0)}),Ge(n,e,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)}),o}function qA(n,e,t){var r=n,i=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function KA(n,e,t,r,i){var o=Ep(t,r),s=o[0],a=o[1],c=new Uint8Array(t*r*4);return Ge(n,e,function(){return n.readPixels(0,0,s,a,i.downloadTextureFormat,n.UNSIGNED_BYTE,c)}),new Float32Array(c.buffer)}function QA(n,e,t,r,i,o,s,a){var y,c=n,f=new Float32Array((y=gd(o,s))[0]*y[1]*4);return c.bindBuffer(c.PIXEL_PACK_BUFFER,e),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,f),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),f}function $A(n,e,t,r){var i=new Float32Array(t*r*4);return Ge(n,e,function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,i)}),i}var C7=Object.freeze({createVertexShader:kA,createVertexBuffer:LA,createIndexBuffer:BA,createFloat32MatrixTexture:VA,createFloat16MatrixTexture:UA,createUnsignedBytesMatrixTexture:jA,createPackedMatrixTexture:WA,createFloat16PackedMatrixTexture:HA,bindVertexProgramAttributeStreams:zA,uploadDenseMatrixToTexture:GA,uploadPixelDataToTexture:YA,createBufferFromOutputTexture:XA,downloadFloat32MatrixFromBuffer:qA,downloadByteEncodedFloatMatrixFromOutputTexture:KA,downloadPackedMatrixFromBuffer:QA,downloadMatrixFromPackedOutputTexture:$A}),ZA=function(){function n(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=le().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,TI(t,e)):this.gl=ia(t);var r="WEBGL_color_buffer_float";if(1===le().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=md(this.gl,this.debug,"OES_texture_float"),Eo(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=md(this.gl,this.debug,"OES_texture_half_float");else if(le().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Eo(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=md(this.gl,this.debug,"EXT_color_buffer_half_float");else if(le().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(Eo(this.gl,r="EXT_color_buffer_float"))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!Eo(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=LA(this.gl,this.debug),this.indexBuffer=BA(this.gl,this.debug),this.framebuffer=VI(this.gl,this.debug),this.textureConfig=iv(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return le().getBool("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Ge(t,this.debug,function(){return t.finish()}),Ge(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Ge(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),Ge(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),Ge(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),Ge(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),VA(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),UA(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),jA(this.gl,this.debug,e,t)},n.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),YA(this.gl,this.debug,e,t)},n.prototype.uploadDenseMatrixToTexture=function(e,t,r,i){this.throwIfDisposed(),GA(this.gl,this.debug,e,t,r,i,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),HA(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),WA(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(sv(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Ge(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,function(){return KA(i.gl,i.debug,t,r,i.textureConfig)})},n.prototype.downloadPackedMatrixFromBuffer=function(e,t,r,i,o,s){return QA(this.gl,e,0,0,0,o,s)},n.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return qA(this.gl,e,t)},n.prototype.createBufferFromTexture=function(e,t,r){this.bindTextureToFrameBuffer(e);var i=XA(this.gl,this.debug,t,r);return this.unbindTextureToFrameBuffer(),i},n.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},n.prototype.createFence=function(e){var t,r,i=this;if(le().getBool("WEBGL_FENCE_API_ENABLED")){var o=e,s=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=function(){var a=o.clientWaitSync(s,0,0);return a===o.ALREADY_SIGNALED||a===o.CONDITION_SATISFIED},t=s}else le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=function(){return i.isQueryAvailable(t,le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:t,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,function(){return $A(i.gl,i.debug,t,r)})},n.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,r=MI(t,this.debug,e),i=kA(t,this.debug),o=OI(t,this.debug);return Ge(t,this.debug,function(){return t.attachShader(o,i)}),Ge(t,this.debug,function(){return t.attachShader(o,r)}),FI(t,this.debug,o),this.debug&&Ap(t,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=zA(t,this.debug,this.program,this.vertexBuffer)),o},n.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&Ge(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},n.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&Ap(this.gl,this.debug,this.program),Ge(this.gl,this.debug,function(){return t.gl.useProgram(e)})},n.prototype.getUniformLocation=function(e,t,r){return void 0===r&&(r=!0),this.throwIfDisposed(),r?jI(this.gl,this.debug,e,t):WI(this.gl,e,t)},n.prototype.getAttributeLocation=function(e,t){var r=this;return this.throwIfDisposed(),Ge(this.gl,this.debug,function(){return r.gl.getAttribLocation(e,t)})},n.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},n.prototype.setInputMatrixTexture=function(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),HI(this.gl,this.debug,0,e,t,r)},n.prototype.setOutputMatrixTexture=function(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)},n.prototype.setOutputPackedMatrixTexture=function(e,t,r){this.throwIfDisposed();var i=gd(t,r);this.setOutputMatrixTextureDriver(e,i[0],i[1])},n.prototype.setOutputMatrixWriteRegion=function(e,t,r,i){this.setOutputMatrixWriteRegionDriver(r,e,i,t)},n.prototype.setOutputPackedMatrixWriteRegion=function(e,t,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){null!=this.program&&Ap(this.gl,this.debug,this.program),vd(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Ge(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},n.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Ge(this.gl,this.debug,function(){return e.gl.finish()})},n.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=md(this.gl,this.debug,2===le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(2===le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,r),r}var i=this.getQueryTimerExtensionWebGL1(),o=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,o),o},n.prototype.endQuery=function(){if(2!==le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(e){return qe(this,void 0,void 0,function(){var t=this;return Ke(this,function(r){switch(r.label){case 0:return[4,Wm(function(){return t.disposed||t.isQueryAvailable(e,le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(e,le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},n.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var r=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint},n.prototype.pollFence=function(e){var t=this;return new Promise(function(r){t.addItemToPoll(function(){return e.isFencePassed()},function(){return r()})})},n.prototype.pollItems=function(){for(var e=function(r){for(var i=0;i<r.length&&r[i]();++i);return i-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},n.prototype.addItemToPoll=function(e,t){var r=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||Wm(function(){return r.pollItems(),0===r.itemsToPoll.length})},n.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),Dp(this.gl,this.debug,e,this.framebuffer),this.debug&&vd(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(Dp(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&vd(this.gl)):sv(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var r=t();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(e,t,r){this.throwIfDisposed();var i=this.gl;Dp(i,this.debug,e,this.framebuffer),this.debug&&vd(i),this.outputTexture=e,Ge(i,this.debug,function(){return i.viewport(0,0,t,r)}),Ge(i,this.debug,function(){return i.scissor(0,0,t,r)})},n.prototype.setOutputMatrixWriteRegionDriver=function(e,t,r,i){var o=this;this.throwIfDisposed(),Ge(this.gl,this.debug,function(){return o.gl.scissor(e,t,r,i)})},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},n}();function JA(n,e){if(n.length!==e.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+e.length+" inputs");n.forEach(function(t,r){var i=t.logicalShape,o=e[r],s=o.shape;if(!Rr(i,s))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+s+" must match");if(!t.isUniform||!o.isUniform){var a=t.texShape,c=o.isUniform?null:o.texData.texShape;if(!Rr(a,c))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+c+" must match")}})}var E7=function(n,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var i=t.inChannels,o=t.strideWidth,s=t.strideHeight,a=t.padInfo,c=t.outWidth,f=t.dilationWidth,p=t.dilationHeight,m=t.dataFormat,y=a.left,w=a.top,E=i*t.filterWidth,A=_i(),_="channelsLast"===m,T=_?0:1,N=_?1:2,M="",R=0;R<=1;R++)for(var P=0;P<=1;P++)M+="\n          blockIndex = rc.y + "+P+";\n          pos = rc.x + "+R+";\n\n          if(blockIndex < "+n[1]+" && pos < "+n[0]+") {\n            offsetY = int(blockIndex / ("+c+")) * "+s+" - "+w+";\n            d0 = offsetY + "+p+" * (pos / "+E+");\n\n            if(d0 < "+e[T]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+c+".) * "+o+". - "+y+".);\n              d1 = offsetX + "+f+" * (int(mod(float(pos), "+E+".) / "+i+".));\n\n              if(d1 < "+e[N]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+i+".));\n\n                if ("+_+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*R+P)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*R+P)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+M+"\n\n        "+A.output+" = result;\n      }\n    "},_7=function(n,e,t,r,i){this.variableNames=["x"],this.outputShape=[];var s=e,a=n[3]-1;this.outputShape=n;var c="float("+t+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+s+"; j <= "+s+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+a+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+(.5===i?"inversesqrt("+c+")":1===i?"1.0/("+c+")":"exp(log("+c+") * float(-"+i+"));")+";\n        setOutput(val);\n      }\n    "},I7=function(n,e,t,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=e,this.bias=t,this.alpha=r,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+e+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+e+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+t+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+i+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+i+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},A7=function(n,e,t,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var s=e,a=n[3]-1;this.outputShape=n;var c="float("+t+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+s+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+s+"; j <= "+s+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+a+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+(.5===i?"inversesqrt("+c+")":1===i?"1.0/("+c+")":"exp(log("+c+") * float(-"+i+"));")+";\n        setOutput(result);\n      }\n    "},D7=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var i=n.effectiveFilterHeight,o=n.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(i-1-n.padInfo.top)+", "+(o-1-n.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+i+";\n          wR += "+n.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+o+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+(i*o-1)+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+o+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},T7=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var a=n.effectiveFilterDepth,c=n.effectiveFilterHeight,f=n.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(a-1-n.padInfo.front)+", "+(c-1-n.padInfo.top)+", "+(f-1-n.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+a+";\n           wD += "+n.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+n.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+n.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+c+";\n              wR += "+n.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+n.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+f+";\n                wC += "+n.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+(a*c*f-1)+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+c+" * "+f+" +\n                  wR * "+f+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Nv=function(n,e,t,r,i,o,s){void 0===t&&(t=!1),void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===o&&(o=null),void 0===s&&(s=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var c=Math.ceil((t?n[1]:n[2])/2),f=t?"i * 2, rc.y":"rc.y, i * 2",p=r?"rc.z, i * 2":"i * 2, rc.z",m=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],y=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],w="",E="";o&&(w=s?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+o+"\n        }":"vec4 activation(vec4 x) {\n          "+o+"\n        }",E="result = activation(result);");var A=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+w+"\n\n      const float sharedDimension = "+c+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+c+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+f+");\n          vec4 b = getMatrixB(rc.x, "+p+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+m[0]+" * "+y[0]+");\n          result += ("+m[1]+" * "+y[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+A+"\n\n        "+E+"\n\n        setOutput(result);\n      }\n    "},S7=function(){function n(e,t,r){this.variableNames=["probs"],this.outputShape=[e,r],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){null==t.seedLoc&&(t.seedLoc=r.getUniformLocation(i,"seed")),r.gl.uniform1f(t.seedLoc,e)}},n}(),N7=function(n,e,t,r){this.variableNames=["indices"],this.outputShape=[n,e],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+t+"),\n                      float(index == coords.y)));\n      }\n    "},R7=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;var a,f,p,e=n.length;if(0===e)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var t=io("rc",e),r=Bn(e),i=function(a,c,f){if(1===a)return"rc > "+c[0];for(var p="",m=a-2;m<a;m++)p+=f[m]+" >= "+c[m],m<a-1&&(p+="||");return p}(e,n,t),o=function(a,c,f,p){if(1===a)return"";var m=p.slice(-2);return"\n    int r = "+m[0]+";\n    int c = "+m[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+c+";\n    bool rEdge = rp1 >= "+f+";\n  "}(e,n[n.length-1],n[n.length-2],t),s=(p=function(m,y){for(var w=[],E=0;E<=1;E++)for(var A=0;A<=1;A++){for(var _=(0===E?"r":"rp1")+", "+(0===A?"c":"cp1"),T=2;T<m;T++)_=y[y.length-1-T]+","+_;w.push(_)}return w}(f=(a=n).length,t),1===f?"getA(rc),\n            rc + 1 >= "+a[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+p[0]+"),\n          cEdge ? 0. : getA("+p[1]+"),\n          rEdge ? 0. : getA("+p[2]+"),\n          rEdge || cEdge ? 0. : getA("+p[3]+")");this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+i+") {\n            setOutput(vec4(0));\n          } else {\n            "+o+"\n\n            setOutput(vec4("+s+"));\n          }\n        }\n      "}},M7=function(n,e,t){this.variableNames=["x"],this.outputShape=e.map(function(c,f){return c[0]+n[f]+c[1]});var r=n.length,i=Bn(r),o=e.map(function(c){return c[0]}).join(","),s=e.map(function(c,f){return c[0]+n[f]}).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+i+" start = "+i+"("+o+");\n      "+i+" end = "+i+"("+s+");\n\n      void main() {\n        "+i+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+t+"));\n        } else {\n          "+i+" coords = outC - start;\n          setOutput(getX("+a+"));\n        }\n      }\n    ":"\n        int start = "+o+";\n        int end = "+s+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+t+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},O7=function(n,e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(function(_,T){return _[0]+n[T]+_[1]});for(var r=n.length,i=Bn(r),o=e.map(function(_){return _[0]}).join(","),s=e.map(function(_,T){return _[0]+n[T]}).join(","),a=io("rc",r),c=io("source",r),f=a[r-1]+" < "+this.outputShape[r-1],p=1===r?"source":"vec2("+c.slice(-2).join()+")",m=[i+" rc = outputLoc;",a[r-1]+" += 1;\n       if("+f+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+a[r-2]+" += 1;\n       if("+a[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+a[r-1]+" += 1;\n         if("+f+") {"],y=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",w="",E=0,A=1===r?2:4;E<A;E++)w+="\n        "+m[E]+"\n        if ("+y+") {\n          result["+E+"] = float("+t+");\n        } else {\n          "+i+" source = rc - start;\n          result["+E+"] = getChannel(getX("+c.join()+"), "+p+");\n        }\n      ";this.userCode="\n      const "+i+" start = "+i+"("+o+");\n      const "+i+" end = "+i+"("+s+");\n\n      void main() {\n        "+i+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+(w+=1===r?"} ":"}}")+"\n        setOutput(result);\n      }\n    "},Rv=function(n,e,t){if(this.variableNames=["x"],"avg"===e&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,i=n.strideHeight,o=n.strideWidth,s=n.dilationHeight,a=n.dilationWidth,c=n.effectiveFilterHeight,f=n.effectiveFilterWidth,p=n.padInfo.top,m=n.padInfo.left;this.outputShape=n.outShape;var y="avg"===e,w="0.0";if(y||(w="-1.0 / 1e-20"),t)this.userCode="\n        const ivec2 strides = ivec2("+i+", "+o+");\n        const ivec2 pads = ivec2("+p+", "+m+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+c+";\n              wR += "+s+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+f+";\n                wC += "+a+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+f+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var E=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(E="avgValue / count");var A=4*Math.floor(r/4),_=r%4,T="\n      if ("+y+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+i+", "+o+");\n      const ivec2 pads = ivec2("+p+", "+m+");\n      const float initializationValue = "+w+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+n.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+w+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+c+";\n            wR += "+s+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+n.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+A+"; wC += 4) {\n            int xC = xCCorner + wC * "+a+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+a+", d),\n              getValue(batch, xR, xC + 2 * "+a+", d),\n              getValue(batch, xR, xC + 3 * "+a+", d)\n            );\n\n            "+T+"\n          }\n\n          int xC = xCCorner + "+A+";\n          if ("+(1===_)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+T+"\n          } else if ("+(2===_)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+a+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+T+"\n          } else if ("+(3===_)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+a+", d),\n              getValue(batch, xR, xC + 2 * "+a+", d),\n              initializationValue\n            );\n\n            "+T+"\n          }\n        }\n        setOutput("+E+");\n      }\n    "}},Mv=function(n,e,t){if(this.variableNames=["x"],"avg"===e&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,i=n.strideDepth,o=n.strideHeight,s=n.strideWidth,a=n.dilationDepth,c=n.dilationHeight,f=n.dilationWidth,p=n.effectiveFilterDepth,m=n.effectiveFilterHeight,y=n.effectiveFilterWidth,w=n.padInfo.front,E=n.padInfo.top,A=n.padInfo.left;this.outputShape=n.outShape;var _="avg"===e,T="0.0";if(_||(T="-1.0 / 1e-20"),t)this.userCode="\n        const ivec3 strides =\n            ivec3("+i+", "+o+", "+s+");\n        const ivec3 pads = ivec3("+w+", "+E+", "+A+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+p+";\n              wD += "+a+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+n.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+m+";\n                wR += "+c+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+n.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+y+";\n                  wC += "+f+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+n.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+m+" * "+y+" +\n                      wR * "+y+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var N=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(N="avgValue / count");var M=4*Math.floor(r/4),R=r%4,P="\n      if ("+_+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+i+", "+o+", "+s+");\n      const ivec3 pads = ivec3("+w+", "+E+", "+A+");\n      const float initializationValue = "+T+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+n.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+T+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+p+";\n            wD += "+a+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+n.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+m+";\n            wR += "+c+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+M+"; wC += 4) {\n              int xC = xCCorner + wC * "+f+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+f+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+f+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+f+", ch)\n              );\n\n              "+P+"\n            }\n\n            int xC = xCCorner + "+M+";\n            if ("+(1===R)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+P+"\n            } else if ("+(2===R)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+f+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+P+"\n            } else if ("+(3===R)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+f+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+f+", ch),\n                initializationValue\n              );\n\n              "+P+"\n            }\n          }\n          setOutput("+N+");\n        }\n      }\n    "}},F7=function(n,e){this.variableNames=["x"];var t=n.windowSize,r=n.batchSize,i=n.inSize,o=Math.ceil(i/t);this.outputShape=[r,o];var s="0.0",a="";"prod"===e?s="1.0":"min"===e?(s="1.0 / 1e-20",a="min"):"max"===e&&(s="-1.0 / 1e-20",a="max");var c=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===e?c="sumValue":"prod"===e?c="prodValue":"all"===e?c="allValue":"any"===e&&(c="anyValue");var f=4*Math.floor(t/4),p=t%4,m="\n      if ("+("sum"===e)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===e)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+a+"(values, minMaxValue);\n      }\n    ",y="vec4";"all"===e?(s="1.0",m="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",y="bvec4"):"any"===e&&(s="0.0",m="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",y="bvec4");var w="";i%t>0&&(w="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+s+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+w+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+t+";\n\n        vec4 minMaxValue = vec4("+s+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+f+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+y+" values = "+y+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+m+"\n        }\n\n        int inIdx = inOffset + "+f+";\n        if ("+(1===p)+") {\n          "+y+" values = "+y+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+m+"\n        } else if ("+(2===p)+") {\n          "+y+" values = "+y+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+m+"\n        } else if ("+(3===p)+") {\n          "+y+" values = "+y+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+m+"\n        }\n        setOutput("+c+");\n      }\n    "},P7=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var t="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),t+="\n        "+i+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+cc(["r","c","d"],e)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+Dv(n)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+n[1]+";\n        int cols = "+n[2]+";\n\n        "+t+"\n\n        setOutput(result);\n      }\n    "},k7=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],s=n.shape,a=s[1],c=s[2],f=[t&&a>1?i-1:i,t&&c>1?o-1:o],p=[t&&a>1?a-1:a,t&&c>1?c-1:c],m=f[0]/p[0],y=f[1]/p[1],w=1/m,E=1/y,A=2*Math.ceil(w)+2,_=2*Math.ceil(E)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+m+");\n        const float widthScale = float("+y+");\n\n        const float invHeightScale = float("+w+");\n        const float invWidthScale = float("+E+");\n\n        const int winHeight = int("+A+");\n        const int winWidth = int("+_+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+a+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+c+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(i-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(o-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},L7=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var o=n[1],s=n[2];this.outputShape=[n[0],e,t,n[3]];var c=[r&&e>1?o-1:o,r&&t>1?s-1:s],f=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+c[0]/f[0]+",\n          "+c[1]/f[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+s+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},B7=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=n[1],s=n[2],a=n[3];this.outputShape=[n[0],e,t,a];var c=[r&&e>1?o-1:o,r&&t>1?s-1:s],f=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+c[0]/f[0]+",\n          "+c[1]/f[1]+",\n          "+c[1]/f[1]+");\n      const vec3 inputShapeRC = vec3("+o+".0, "+s+".0,\n                                     "+s+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(a-1)+";\n        bool hasNextRow = coords.z < "+(t-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},V7=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],s=n.shape,a=s[1],c=s[2],f=[t&&a>1?i-1:i,t&&c>1?o-1:o],p=[t&&a>1?a-1:a,t&&c>1?c-1:c],m=f[0]/p[0],y=f[1]/p[1],w=1/m,E=1/y,A=2*Math.ceil(w)+2,_=2*Math.ceil(E)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+m+");\n        const float widthScale = float("+y+");\n\n        const float invHeightScale = float("+w+");\n        const float invWidthScale = float("+E+");\n\n        const int winHeight = int("+A+");\n        const int winWidth = int("+_+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+a+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+c+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+f[0]+") *\n                (float(dyR) / float("+p[0]+"));\n\n            float sourceFracCol =\n                float("+f[1]+") *\n                  (float(dyC) / float("+p[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+i+") - 1),\n                "+t+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+o+") - 1),\n                "+t+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},U7=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var o=n[1],s=n[2];this.outputShape=[n[0],e,t,n[3]];var c=[r&&e>1?o-1:o,r&&t>1?s-1:s],f=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+c[0]/f[0]+",\n          "+c[1]/f[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+s+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+(r?"0.5":"0.0")+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},j7=function(n,e){this.variableNames=["x"];var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=n,1!==t){var r=n.map(function(o,s){return-1!==e.indexOf(a=s)&&1!==n[a]?n[a]+" - coords["+a+"] - 1":"coords["+a+"]";var a}).join(","),i=Bn(t);this.userCode="\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+n[0]+" - coord - 1));\n        }\n      "},W7=function(n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=n;var c,r=io("rc",t),i=r[t-1]+" + 1 < "+this.outputShape[t-1],o=r[t-2]+" + 1 < "+this.outputShape[t-2],s=Bn(t);function a(c){var f=n.map(function(p,m){return w=c,-1!==e.indexOf(y=m)&&1!==n[y]?n[y]+" - "+w[y]+" - 1":""+w[y];var y,w});return"getChannel(getX("+f.join(",")+"), vec2("+f.slice(-2).join(",")+"))"}this.userCode=1===t?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+n[0]+" - rc - 1),\n            "+n[0]+" - rc - 1);\n          if("+i+"){\n              result.g = getChannel(getX("+n[0]+" - (rc  + 1) - 1),\n                "+n[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+s+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+a(r.slice())+";\n          if("+i+"){\n            result.g = "+((c=r.slice())[t-1]="("+c[t-1]+" + 1)",a(c)+";\n          }\n          if(")+o+") {\n            result.b = "+function(c){return c[t-2]="("+c[t-2]+" + 1)",a(c)}(r.slice())+";\n            if("+i+") {\n              result.a = "+function(c){return c[t-1]="("+c[t-1]+" + 1)",c[t-2]="("+c[t-2]+" + 1)",a(c)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},eD=function(n,e,t,r,i,o,s){void 0===s&&(s=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var a=Bn(i.length),c=Bn(o.length),f="";1===t?f="i":2===t&&(f="i, j");var m="";1===r?m="i":2===r&&(m="i, coords[1]"),this.userCode="\n        "+a+" strides = "+a+"("+i+");\n\n        void main() {\n          "+c+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+n+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+e+"; j++) {\n              int index = round(getIndices("+f+"));\n              flattenedIndex += index * "+(e>1?"strides[j]":"strides")+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates("+m+");\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},H7=function(n,e){this.variableNames=["x","segmentIds"];var t=n.windowSize,r=n.batchSize,i=n.inSize,o=n.numSegments,s=o*Math.ceil(i/t);this.outputShape=[r,s];var a=4*Math.floor(t/4),c=t%4,f="\n        sumValue += dot(values, segFilter);\n    ",p="";i%t>0&&(p="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      ");var m="";i%t>0&&(m="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+p+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+m+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+o+")) * float("+t+"));\n        int currentSeg = int(mod(float(outIdx), float("+o+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+a+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+f+"\n        }\n\n        int inIdx = inOffset + "+a+";\n        if ("+(1===c)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+f+"\n        } else if ("+(2===c)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+f+"\n        } else if ("+(3===c)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+f+"\n        }\n        setOutput(sumValue);\n      }\n    "},z7=function(n,e,t){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(1===t)i="resRC",r="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],a=[],c=0;c<e.length;c++)a.push(""+o[c]),c<n&&s.push(""+o[c]);r=s.join(),i=a.join()}var f=Bn(t);this.userCode="\n      void main() {\n        "+f+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+i+"));\n        } else {\n          setOutput(getB("+i+"));\n        }\n      }\n    "},G7=function(){function n(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,r=Bn(this.rank),i="uniform int start["+this.rank+"];",o=function(s){if(1===s)return"sourceLoc";if(s<=6)return Ov.slice(0,s).map(function(a){return"sourceLoc."+a}).join(",");throw Error("Slicing for rank "+s+" is not yet supported")}(this.rank);t="\n        "+r+" sourceLoc;\n        "+r+" coords = getOutputCoords();\n        "+e.map(function(s,a){return"sourceLoc."+Ov[a]+" = start["+a+"] + coords."+Ov[a]+";"}).join("\n")+"\n      ",this.userCode="\n      "+i+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+o+"));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){null==t.startLoc&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),null==t.startLoc)||r.gl.uniform1iv(t.startLoc,e)}},n}(),Ov=["x","y","z","w","u","v"],Y7=function(){function n(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=Bn(this.rank),r=io("coords",this.rank),i=io("sourceLoc",this.rank),o=1===this.rank?"sourceLoc":"vec2("+i.slice(-2).join()+")",s="getChannel(getSource("+i.join()+"), "+o+")",a="\n      result.x = "+s+";\n      if (++"+r[this.rank-1]+" < "+e[this.rank-1]+") {\n        ++"+i[this.rank-1]+";\n        result.y = "+s+";\n        --"+i[this.rank-1]+";\n      }\n    ",c=1===this.rank?"":"\n      --"+r[this.rank-1]+";\n      if (++"+r[this.rank-2]+" < "+e[this.rank-2]+") {\n        ++"+i[this.rank-2]+";\n        result.z = "+s+";\n        if (++"+r[this.rank-1]+" < "+e[this.rank-1]+") {\n          ++"+i[this.rank-1]+";\n          result.w = "+s+";\n        }\n      }\n    ",f=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+e.map(function(p,m){return"start["+m+"]"}).join()+");":e.map(function(p,m){return i[m]+" = "+r[m]+" + start["+m+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+f+"\n        vec4 result = vec4(0.);\n        "+a+"\n        "+c+"\n        setOutput(result);\n      }\n    "}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){null==t.startLoc&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),null==t.startLoc)||r.gl.uniform1iv(t.startLoc,e)}},n}(),X7=function(n,e,t){this.variableNames=["x"],this.outputShape=t;var r=t.length,i=Bn(t.length),o=Bn(t.length),s="";if(1===r)s="coords * strides + begin";else{var a=0;s=t.map(function(c,f){return a++,1===t.length?"coords * strides["+f+"] + begin["+f+"]":"coords["+(a-1)+"] * strides["+f+"] + begin["+f+"]"}).join(",")}this.userCode="\n      "+i+" begin = "+i+"("+n+");\n      "+i+" strides = "+i+"("+e+");\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+s+"));\n      }\n    "},q7=function(){function n(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(e,t,r){var i,o=tD(t,r),s=nD(e,o,r);if(s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]),this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var a=this.freeTextures[s].shift();return this.usedTextures[s].push(a),a}return this.numUsedTextures++,this.log(),o===Co.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===Co.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===Co.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===Co.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===Co.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[s].push(i),i},n.prototype.releaseTexture=function(e,t,r,i){if(null!=this.freeTextures){var o=nD(t,tD(r,i),i);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var s=this.usedTextures[o],a=s.indexOf(e);if(a<0)throw new Error("Cannot release a texture that was never provided by this texture manager");s.splice(a,1),this.log()}},n.prototype.log=function(){this.logEnabled&&console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+(this.numFreeTextures+this.numUsedTextures)+")")},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(r){e.gpgpu.deleteMatrixTexture(r)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(i){e.gpgpu.deleteMatrixTexture(i)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n}();function tD(n,e){if(n===bo.UPLOAD)return Co.PACKED_2X2_FLOAT32;if(n===bo.RENDER||null==n)return t=e,le().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Co.PACKED_2X2_FLOAT32:Co.UNPACKED_FLOAT32:t?Co.PACKED_2X2_FLOAT16:Co.UNPACKED_FLOAT16;var t;if(n===bo.DOWNLOAD||n===bo.PIXELS)return Co.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function nD(n,e,t){return n[0]+"_"+n[1]+"_"+e+"_"+t}var K7=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[r]*e[r];this.outputShape=t,this.rank=t.length;var i=Bn(this.rank),o=function(s){var a=s.length;if(a>5)throw Error("Tile for rank "+a+" is not yet supported");if(1===a)return"imod(resRC, "+s[0]+")";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],f=[],p=0;p<s.length;p++)f.push("imod("+c[p]+", "+s[p]+")");return f.join()}(n);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+o+"));\n      }\n    "},Q7=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];this.outputShape=t,this.rank=t.length;var i=Bn(this.rank),o=function(s){var a=s.length;if(a>6)throw Error("Transpose for rank "+a+" is not yet supported");for(var c=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],f=new Array(a),p=0;p<s.length;p++)f[s[p]]=c[p];return f.join()}(e);this.userCode="\n    void main() {\n      "+i+" resRC = getOutputCoords();\n      setOutput(getA("+o+"));\n    }\n    "},$7=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=Bn(this.rank),o=_A("rc",this.rank),s=new Array(this.rank);for(r=0;r<e.length;r++)s[e[r]]=o[r];var a="vec2("+s.slice(-2).join()+")",c="++"+o[this.rank-1]+" < "+t[this.rank-1],f="getChannel(getA("+s.join()+"), "+a+")";this.userCode="\n    void main() {\n      "+i+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+f+";\n      if("+c+") {\n        result[1] = "+f+";\n      }\n      --"+o[this.rank-1]+";\n      if(++"+o[this.rank-2]+" < "+t[this.rank-2]+") {\n        result[2] = "+f+";\n        if("+c+") {\n          result[3] = "+f+";\n        }\n      }\n      setOutput(result);\n    }\n    "},Ft=function(n,e){this.variableNames=["A"],this.outputShape=n,this.userCode="\n      float unaryOperation(float x) {\n        "+e+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},As="if (isnan(x)) return x;",rD="return abs(x);",iD=As+"\n  return (x < 0.0) ? 0.0 : x;\n",oD=As+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",sD="return (x >= 0.0) ? x : (exp(x) - 1.0);",aD="return -x;",uD="return ceil(x);",cD="return floor(x);",lD="return exp(x);",fD="return exp(x) - 1.0;",Gp="return x;",dD="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",hD="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",pD="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",Dd=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},c9=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;var e=n.length,t=io("rc",e),r=Bn(e),i=function(a,c){if(1===a)return"rc";for(var f="",p=0;p<a;p++)f+=c[p],p<a-1&&(f+=",");return f}(e,t),o=t.slice(-2),s=e<=1?"rc":"vec2("+o.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+i+");\n\n        setOutput(getChannel(packedInput, "+s+"));\n      }\n    "},Yp={};function Xp(n,e){if(void 0===e&&(e=!1),"linear"===n)return"return x;";if("relu"===n)return e?dD:iD;if("elu"===n)return e?pD:sD;if("relu6"===n)return e?hD:oD;if("prelu"===n)return e?NA:SA;throw new Error("Activation "+n+" has not been implemented for the WebGL backend.")}var gD=function(n){function e(t){var r,i=n.call(this)||this;if(i.pendingRead=new WeakMap,i.pendingDisposal=new WeakSet,i.dataRefCount=new WeakMap,i.numBytesInGPU=0,i.uploadWaitMs=0,i.downloadWaitMs=0,i.warnedAboutMemory=!1,i.pendingDeletes=0,i.disposed=!1,!le().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==t){var o=ia(le().getNumber("WEBGL_VERSION"));i.binaryCache=((r=le().getNumber("WEBGL_VERSION"))in Yp||(Yp[r]={}),Yp[r]),i.gpgpu=new ZA(o),i.canvas=o.canvas,i.gpgpuCreatedLocally=!0}else i.gpgpu=t,i.binaryCache={},i.gpgpuCreatedLocally=!1,i.canvas=t.gl.canvas;return i.textureManager=new q7(i.gpgpu),i.numMBBeforeWarning=null==le().global.screen?1024:le().global.screen.height*le().global.screen.width*window.devicePixelRatio*600/1024/1024,i.texData=new mA(i,Q),i}return ws(e,n),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,r,i){if(le().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===i&&null!=t)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var o={};return this.texData.set(o,{shape:r,dtype:i,values:t,usage:bo.UPLOAD}),o},e.prototype.move=function(t,r,i,o){if(le().getBool("DEBUG")&&this.checkNumericalProblems(r),"complex64"===o)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:i,dtype:o,values:r,usage:bo.UPLOAD})},e.prototype.readSync=function(t){var r=this.texData.get(t),i=r.values,o=r.dtype,s=r.complexTensors,c=r.shape;if(null!=r.slice){var p;p=r.isPacked?new Dd(c,Gp):new Ft(c,Gp);var m=this.runWebGLProgram(p,[{dataId:t,shape:c,dtype:o}],o),y=this.readSync(m.dataId);return this.disposeData(m.dataId),y}if(null!=i)return this.convertAndCacheOnCPU(t);if("string"===o)return i;var w,E,A=null!=this.activeTimers;return A&&(w=Cs()),E="complex64"===o?Ev(s.real.dataSync(),s.imag.dataSync()):this.getValuesFromTexture(t),A&&(this.downloadWaitMs+=Cs()-w),this.convertAndCacheOnCPU(t,E)},e.prototype.read=function(t){return qe(this,void 0,void 0,function(){var r,i,o,s,c,f,p,m,y,w,E,A,_,T,N,P,B,Y,X;return Ke(this,function(z){switch(z.label){case 0:if(this.pendingRead.has(t))return r=this.pendingRead.get(t),[2,new Promise(function(G){return r.push(G)})];if(i=this.texData.get(t),o=i.values,s=i.shape,c=i.dtype,f=i.complexTensors,p=i.isPacked,null!=i.slice)return m=p?new Dd(s,Gp):new Ft(s,Gp),y=this.runWebGLProgram(m,[{dataId:t,shape:s,dtype:c}],c),w=this.read(y.dataId),this.disposeData(y.dataId),[2,w];if(null!=o)return[2,this.convertAndCacheOnCPU(t)];if(!le().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===le().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return E=null,"complex64"!==c&&le().get("WEBGL_BUFFER_SUPPORTED")&&(A=this.decode(t),_=this.texData.get(A.dataId),E=(X=this.gpgpu).createBufferFromTexture.apply(X,[_.texture].concat(pd(s)))),this.pendingRead.set(t,[]),"complex64"===c?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:z.sent(),z.label=2;case 2:return"complex64"!==c?[3,4]:[4,Promise.all([f.real.data(),f.imag.data()])];case 3:return N=z.sent(),T=Ev(N[0],N[1]),[3,5];case 4:null==E?T=this.getValuesFromTexture(t):(P=$e(s),T=this.gpgpu.downloadFloat32MatrixFromBuffer(E,P)),z.label=5;case 5:return null!=A&&this.disposeData(A.dataId),B=this.convertAndCacheOnCPU(t,T),Y=this.pendingRead.get(t),this.pendingRead.delete(t),Y.forEach(function(G){return G(B)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,B]}})})},e.prototype.checkNumericalProblems=function(t){if(null!=t)for(var r=0;r<t.length;r++){var i=t[r];if(!SI(i))throw le().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+i+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+i+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(t){var r,i=this.texData.get(t),o=i.shape,s=i.dtype,a=i.isPacked,c=$e(o);if(le().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var f=this.decode(t),p=this.texData.get(f.dataId),m=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[p.texture].concat(pd(o))).subarray(0,c);return this.disposeData(f.dataId),m}var y=le().getBool("WEBGL_PACK")&&!0===a,w=y?Tp(o):o,E=y?new p7(w):new h7(w),A=this.runWebGLProgram(E,[{shape:w,dtype:s,dataId:t}],"float32"),_=this.texData.get(A.dataId),T=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(_.texture,_.texShape[0],_.texShape[1]).subarray(0,c);return this.disposeData(A.dataId),T},e.prototype.time=function(t){return qe(this,void 0,void 0,function(){var r,i,o,s,a,c,f;return Ke(this,function(p){switch(p.label){case 0:return r=this.activeTimers,i=[],o=!1,null==this.programTimersStack?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,t(),s=Ta(this.activeTimers.map(function(m){return m.query})).filter(function(m){return null!=m}),a=Ta(this.activeTimers.map(function(m){return m.name})).filter(function(m){return null!=m}),this.activeTimers=r,o&&(this.programTimersStack=null),c={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(s)]:[3,2];case 1:return f=p.sent(),c.kernelMs=lI(f),c.getExtraProfileInfo=function(){return f.map(function(m,y){return{name:a[y],ms:m}}).map(function(m){return m.name+": "+m.ms}).join(", ")},[3,3];case 2:c.kernelMs={error:"WebGL query timers are not supported in this environment."},p.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,c]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Cs(),endMs:null}},e.prototype.endTimer=function(t){return le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=Cs(),t)},e.prototype.getQueryTime=function(t){return qe(this,void 0,void 0,function(){var r;return Ke(this,function(i){return le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(r=t).endMs-r.startMs]})})},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var r=this.texData.get(t).complexTensors;null!=r&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var r=this.texData.get(t),i=r.texture,o=r.dtype,s=r.texShape,a=r.usage,c=r.isPacked,f=r.slice,p=f&&f.origDataId||t,m=this.dataRefCount.get(p);m>1?this.dataRefCount.set(p,m-1):(this.dataRefCount.delete(p),null!=i&&(this.numBytesInGPU-=this.computeBytes(s,o),this.textureManager.releaseTexture(i,s,a,c)));var y=this.texData.get(t);y.texture=null,y.texShape=null,y.isPacked=!1,y.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return le().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=Q.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,r){var i=this;return void 0===r&&(r=128),null!=this.getCPUBackend()&&t.every(function(o){return null==i.texData.get(o.dataId).texture&&o.size<r})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,r){var i=this.makeOutput(t.shape,"complex64");return this.texData.get(i.dataId).complexTensors={real:Q.keep(t.clone()),imag:Q.keep(r.clone())},i},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,i){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,r,i);if(0===$e(i))return fi([],i,t.dtype);var o=this.texData.get(t.dataId).isPacked,s=vv(t.shape,r,i);if(o||!s){var a=le().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Y7(i):new G7(i),c=a.getCustomSetupFunc(r);return this.compileAndRun(a,[t],null,c)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,r,i)},e.prototype.shallowSlice=function(t,r,i){var o=this.texData.get(t.dataId),s=this.makeOutput(i,t.dtype),a=this.texData.get(s.dataId);Object.assign(a,o),a.shape=i,a.dtype=t.dtype;var c=yv(r,t.strides);o.slice&&(c+=o.slice.flatOffset),a.slice={flatOffset:c,origDataId:o.slice&&o.slice.origDataId||t.dataId};var f=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,f+1),s},e.prototype.stridedSlice=function(t,r,i,o){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,r,i,o);var s=Bp(r,i,o);if(s.some(function(c){return 0===c}))return fi([],s);var a=new X7(r,o,s);return this.compileAndRun(a,[t])},e.prototype.reverse=function(t,r){var i=le().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new W7(t.shape,r):new j7(t.shape,r);return this.compileAndRun(i,[t])},e.prototype.concat=function(t,r){if("complex64"===t[0].dtype){var i=t.map(function(w){return jo(w)}),o=t.map(function(w){return sa(w)});return li(this.concat(i,r),this.concat(o,r))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,r);if(1===t.length)return t[0];if(t.length>le().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var s=Math.floor(t.length/2),a=this.concat(t.slice(0,s),r),c=this.concat(t.slice(s),r);return this.concat([a,c],r)}if(le().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var f=new J5(t.map(function(w){return w.shape}),r);return this.compileAndRun(f,t)}var p=ic(t.map(function(w){return w.shape}),r),m=t.map(function(w){return w.as2D(-1,$e(w.shape.slice(r)))}),y=new Z5(m.map(function(w){return w.shape}));return this.compileAndRun(y,m).reshape(p)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(le().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,aD,t.dtype);var r=new Ft(t.shape,aD);return this.compileAndRun(r,[t])},e.prototype.batchMatMul=function(t,r,i,o){var s=i?t.shape[2]:t.shape[1],a=o?r.shape[1]:r.shape[2],c=i?t.shape[1]:t.shape[2],f=t.shape[0];if((1===s||1===a)&&c>1e3){i&&(t=t.transpose([0,2,1])),o&&(r=r.transpose([0,2,1]));var p=1===a?t:t.as3D(f,c,1),m=1===a?2:1,y=1===a?r.as3D(f,1,c):r;return this.multiply(p,y).sum(m,!0)}var w=ni(t.dtype,r.dtype),E=new Nv(t.shape,[f,s,a],i,o);return this.compileAndRun(E,[t,r],w)},e.prototype.fusedBatchMatMul=function(t){var r=t.a,i=t.b,o=t.transposeA,s=t.transposeB,a=t.bias,c=t.activation,f=t.preluActivationWeights,p=o?r.shape[2]:r.shape[1],m=s?i.shape[1]:i.shape[2],y=r.shape[0],w=ni(r.dtype,i.dtype),E=null!=a,A=null!=f,_=c?Xp(c,!0):null,T=new Nv(r.shape,[y,p,m],o,s,E,_,A),N=[r,i];return a&&N.push(a),f&&N.push(f),this.compileAndRun(T,N,w)},e.prototype.multiply=function(t,r){if("complex64"===t.dtype){var i=this.texData.get(t.dataId),o=this.texData.get(r.dataId),s=new DA("return areal * breal - aimag * bimag;",t.shape,r.shape),a=new DA("return areal * bimag + aimag * breal;",t.shape,r.shape),c=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag),this.makeComplexComponentTensorInfo(r,o.complexTensors.real),this.makeComplexComponentTensorInfo(r,o.complexTensors.imag)],f=this.compileAndRun(s,c),p=this.compileAndRun(a,c),m=this.complex(f,p);return f.dispose(),p.dispose(),m}if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.multiply(t,r);if(le().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,TA,t.dtype);var y=new vr(TA,t.shape,r.shape);return this.compileAndRun(y,[t,r],t.dtype)},e.prototype.batchNormalization=function(t,r,i,o,s,a){var c=[t,r,i],f=null;null!=a&&(f=a.shape,c.push(a));var p=null;if(null!=s&&(p=s.shape,c.push(s)),le().getBool("WEBGL_PACK_NORMALIZATION")){var m=new Y5(t.shape,r.shape,i.shape,f,p,o);return this.compileAndRun(m,c)}var y=new G5(t.shape,r.shape,i.shape,f,p,o);return this.compileAndRun(y,c)},e.prototype.localResponseNormalization4D=function(t,r,i,o,s){var a=le().getBool("WEBGL_PACK_NORMALIZATION")?new A7(t.shape,r,i,o,s):new _7(t.shape,r,i,o,s);return this.compileAndRun(a,[t])},e.prototype.LRNGrad=function(t,r,i,o,s,a,c){var f=new I7(r.shape,o,s,a,c);return this.compileAndRun(f,[r,i,t])},e.prototype.tile=function(t,r){if("string"===t.dtype){var i=this.readSync(t.dataId).map(function(s){return ud(s)});return CA(Tt(t.shape,t.dtype,i),r)}var o=new K7(t.shape,r);return this.compileAndRun(o,[t])},e.prototype.pad=function(t,r,i){var o=le().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new O7(t.shape,r,i):new M7(t.shape,r,i);return this.compileAndRun(o,[t])},e.prototype.transpose=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,r);var i=le().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new $7(t.shape,r):new Q7(t.shape,r);return this.compileAndRun(i,[t])},e.prototype.gather=function(t,r,i){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.gather(t,r,i);var o=new w7(t.shape,r.size,i);return this.compileAndRun(o,[t,r])},e.prototype.batchToSpaceND=function(t,r,i){H(t.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var o=r.reduce(function(m,y){return m*y}),s=Fp(t.shape,r,o),a=Pp(s.length,r.length),c=kp(t.shape,r,o),f=cA(i,r.length),p=lA(c,i,r.length);return t.reshape(s).transpose(a).reshape(c).slice(f,p)},e.prototype.spaceToBatchND=function(t,r,i){H(t.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var o=r.reduce(function(y,w){return y*w}),s=[[0,0]];s.push.apply(s,i);for(var a=1+r.length;a<t.shape.length;++a)s.push([0,0]);var c=t.pad(s),f=Fp(c.shape,r,o,!1),p=Pp(f.length,r.length,!1),m=kp(c.shape,r,o,!1);return c.reshape(f).transpose(p).reshape(m)},e.prototype.reduce=function(t,r,i){var o=t.shape[0],s=t.shape[1],a=Lp(s),c=new F7({windowSize:a,inSize:s,batchSize:o},r),f=this.compileAndRun(c,[t],i);return 1===f.shape[1]?f:this.reduce(f,r,i)},e.prototype.argReduce=function(t,r,i){void 0===i&&(i=null);var o=t.shape[0],s=t.shape[1];null!=i&&(o=i.shape[0],s=i.shape[1]);var a=Lp(s),c=new k5({windowSize:a,inSize:s,batchSize:o},r,null==i),f=[t];null!=i&&f.push(i);var p=this.compileAndRun(c,f,"int32");return 1===p.shape[1]?p:this.argReduce(t,r,p)},e.prototype.argReducePacked=function(t,r,i){void 0===i&&(i=null);var o=null!=i?i.shape:t.shape,s=Lp(o[o.length-1]),a=new W5(o,s,r,null==i),f=this.compileAndRun(a,null==i?[t]:[t,i],"int32");return f.rank===t.rank?this.argReducePacked(t,r,f):f},e.prototype.sum=function(t,r){no("sum",r,t.rank);var i=ci(t.shape,r),o=i[0],s=$e(i[1]),a=t.as2D(-1,s),c=ev(t.dtype);return this.reduce(a,"sum",c).reshape(o)},e.prototype.prod=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,r);var i=ci(t.shape,r),o=i[0],s=$e(i[1]),a=t.as2D(-1,s),c=ev(t.dtype);return this.reduce(a,"prod",c).reshape(o)},e.prototype.unsortedSegmentSum=function(t,r,i){var o=0,s=Es([o],t.rank),a=t;null!=s&&(a=t.transpose(s),o=_s(1,t.rank)[0]);var c=function(w,E,A){for(var _=[],T=w.length,N=0;N<T;N++)_.push(N!==E?w[N]:A);return _}(a.shape,o,i),f=$e([a.shape[o]]),p=a.as2D(-1,f),m=ev(t.dtype),y=this.segOpCompute(p,"unsortedSegmentSum",r,m,i).reshape(c);return null!=s&&(y=y.transpose(Rp(s))),y},e.prototype.segOpCompute=function(t,r,i,o,s){var a=t.shape[0],c=t.shape[1],f=function(y,w){var E,A=!1;for(y<=30?(E=y,A=!0):E=Cp(y,Math.floor(Math.sqrt(y)));!A;)E>w||E===y?A=!0:E=Cp(y,E+1);return E}(c,s),p=new H7({windowSize:f,inSize:c,batchSize:a,numSegments:s},r),m=this.compileAndRun(p,[t,i],o);return m.shape[1]===s?m:(i=Mp(0,s).tile([c/f]),this.segOpCompute(m,r,i,o,s))},e.prototype.argMinMaxReduce=function(t,r,i){var o=[r];if(no("arg"+i.charAt(0).toUpperCase()+i.slice(1),o,t.rank),!le().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var s=ci(t.shape,o),a=s[0],c=$e(s[1]),f=t.as2D(-1,c);return this.argReduce(f,i).reshape(a)}return this.argReducePacked(t,i)},e.prototype.argMin=function(t,r){return this.argMinMaxReduce(t,r,"min")},e.prototype.argMax=function(t,r){return this.argMinMaxReduce(t,r,"max")},e.prototype.cumsum=function(t,r,i,o){if(r!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+r);var s=new u7(t.shape,i,o);return this.compileAndRun(s,[t])},e.prototype.equal=function(t,r){if(le().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  return vec4(equal(a, b));\n","bool");var i=new vr("return float(a == b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.notEqual=function(t,r){if(le().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  return vec4(notEqual(a, b));\n","bool");var i=new vr("return float(a != b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.less=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.less(t,r);if(le().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  return vec4(lessThan(a, b));\n","bool");var i=new vr("return float(a < b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.lessEqual=function(t,r){if(le().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  return vec4(lessThanEqual(a, b));\n","bool");var i=new vr("return float(a <= b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.greater=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.greater(t,r);if(le().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  return vec4(greaterThan(a, b));\n","bool");var i=new vr("return float(a > b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.greaterEqual=function(t,r){if(le().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var i=new vr("return float(a >= b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.logicalNot=function(t){var r=new Ft(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[t])},e.prototype.logicalAnd=function(t,r){if(le().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var i=new vr("return float(a >= 1.0 && b >= 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.logicalOr=function(t,r){if(le().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var i=new vr("return float(a >= 1.0 || b >= 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.select=function(t,r,i){var o=new z7(t.rank,r.shape,r.rank);return this.compileAndRun(o,[t,r,i],ni(r.dtype,i.dtype))},e.prototype.where=function(t){Np("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=t.dataSync();return Av(t.shape,r)},e.prototype.topk=function(t,r,i){return EA(t.dataSync(),t.shape,t.dtype,r)},e.prototype.min=function(t,r){no("min",r,t.rank);var i=ci(t.shape,r),o=i[0],s=$e(i[1]),a=t.as2D(-1,s);return this.reduce(a,"min",a.dtype).reshape(o)},e.prototype.minimum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.minimum(t,r);var i=le().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Oa("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,r.shape):new vr("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.mod=function(t,r){var i=le().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Oa("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,r.shape):new vr("if (b == 0.0) return NAN;\n  return mod(a, b);",t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.max=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,r);no("max",r,t.rank);var i=ci(t.shape,r),o=i[0],s=$e(i[1]),a=t.as2D(-1,s);return this.reduce(a,"max",a.dtype).reshape(o)},e.prototype.maximum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.maximum(t,r);var i=le().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Oa("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,r.shape):new vr("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.all=function(t,r){no("all",r,t.rank);var i=ci(t.shape,r),o=i[0],s=$e(i[1]),a=t.as2D(-1,s);return this.reduce(a,"all",a.dtype).reshape(o)},e.prototype.any=function(t,r){no("any",r,t.rank);var i=ci(t.shape,r),o=i[0],s=$e(i[1]),a=t.as2D(-1,s);return this.reduce(a,"any",a.dtype).reshape(o)},e.prototype.realDivide=function(t,r){if(le().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var i=new vr("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",t.shape,r.shape);return this.compileAndRun(i,[t,r],"float32")},e.prototype.floorDiv=function(t,r){if(le().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var i=new vr("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",t.shape,r.shape);return this.compileAndRun(i,[t,r],"int32")},e.prototype.add=function(t,r){if("complex64"===t.dtype&&"complex64"===r.dtype)return this.complexSeparableBinaryOp(t,r,Tv);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.add(t,r);var i=ni(t.dtype,r.dtype);if(le().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,Tv,i);var o=new vr(Tv,t.shape,r.shape);return this.compileAndRun(o,[t,r],i)},e.prototype.packedUnaryOp=function(t,r,i){var o=new Dd(t.shape,r);return this.compileAndRun(o,[t],i)},e.prototype.packedBinaryOp=function(t,r,i,o,s){void 0===s&&(s=!1);var a=new Oa(i,t.shape,r.shape,s);return this.compileAndRun(a,[t,r],o)},e.prototype.complexSeparableBinaryOp=function(t,r,i){var o=this,s=this.texData.get(t.dataId),a=this.texData.get(r.dataId),c=[[s.complexTensors.real,a.complexTensors.real],[s.complexTensors.imag,a.complexTensors.imag]].map(function(y){var w=y[0],E=y[1],A=o.makeComplexComponentTensorInfo(t,w),_=o.makeComplexComponentTensorInfo(r,E),T=new vr(i,t.shape,r.shape);return o.compileAndRun(T,[A,_],ni(w.dtype,E.dtype))}),f=c[0],p=c[1],m=this.complex(f,p);return f.dispose(),p.dispose(),m},e.prototype.makeComplexComponentTensorInfo=function(t,r){return{dataId:r.dataId,dtype:r.dtype,shape:t.shape}},e.prototype.addN=function(t){if(1===t.length)return t[0];if(t.length>le().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(t.length/2),i=this.addN(t.slice(0,r)),o=this.addN(t.slice(r));return this.addN([i,o])}var s=t.map(function(f){return f.dtype}).reduce(function(f,p){return ni(f,p)}),a=t.map(function(f){return f.shape}),c=le().getBool("WEBGL_PACK")?new P5(t[0].shape,a):new F5(t[0].shape,a);return this.compileAndRun(c,t,s)},e.prototype.subtract=function(t,r){if("complex64"===t.dtype&&"complex64"===r.dtype)return this.complexSeparableBinaryOp(t,r,Sv);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.subtract(t,r);var i=ni(t.dtype,r.dtype);if(le().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,Sv,t.dtype);var o=new vr(Sv,t.shape,r.shape);return this.compileAndRun(o,[t,r],i)},e.prototype.pow=function(t,r){var i=le().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Oa("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,r.shape):new vr("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",t.shape,r.shape),o=ni(t.dtype,r.dtype);return this.compileAndRun(i,[t,r],o)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(le().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,uD,t.dtype);var r=new Ft(t.shape,uD);return this.compileAndRun(r,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(le().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,cD,t.dtype);var r=new Ft(t.shape,cD);return this.compileAndRun(r,[t])},e.prototype.sign=function(t){var r=new Ft(t.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(r,[t])},e.prototype.isNaN=function(t){var r=new Ft(t.shape,"return float(isnan(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isInf=function(t){var r=new Ft(t.shape,"return float(isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isFinite=function(t){var r=new Ft(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.round=function(t){var r=new Ft(t.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(r,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(le().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,lD,t.dtype);var r=new Ft(t.shape,lD);return this.compileAndRun(r,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(le().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,fD,t.dtype);var r=new Ft(t.shape,fD);return this.compileAndRun(r,[t])},e.prototype.softmax=function(t,r){var i=Mr([r],t.shape),o=this.max(t,i),s=zi(o.shape,i),a=this.subtract(t,o.reshape(s)),c=this.exp(a),f=this.sum(c,i).reshape(s);return this.realDivide(c,f)},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(le().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",t.dtype);var r=new Ft(t.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(r,[t])},e.prototype.log1p=function(t){var r=new Ft(t.shape,"return log(1.0 + x);");return this.compileAndRun(r,[t])},e.prototype.sqrt=function(t){var r=new Ft(t.shape,"return sqrt(x);");return this.compileAndRun(r,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var r=new Ft(t.shape,"return inversesqrt(x);");return this.compileAndRun(r,[t])},e.prototype.reciprocal=function(t){var r=new Ft(t.shape,"return 1.0 / x;");return this.compileAndRun(r,[t])},e.prototype.relu=function(t){var r;return r=le().getBool("WEBGL_PACK")?new Dd(t.shape,dD):new Ft(t.shape,iD),this.compileAndRun(r,[t])},e.prototype.relu6=function(t){var r;return r=le().getBool("WEBGL_PACK")?new Dd(t.shape,hD):new Ft(t.shape,oD),this.compileAndRun(r,[t])},e.prototype.prelu=function(t,r){var i=le().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Oa(NA,t.shape,r.shape):new vr(SA,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.elu=function(t){if(le().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,pD,t.dtype);var r=new Ft(t.shape,sD);return this.compileAndRun(r,[t])},e.prototype.eluDer=function(t,r){var i=le().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Oa("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",t.shape,r.shape):new vr("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.selu=function(t){var r=new Ft(t.shape,"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n");return this.compileAndRun(r,[t])},e.prototype.int=function(t){var r=new Ft(t.shape,"return float(int(x));");return this.compileAndRun(r,[t],"int32")},e.prototype.clip=function(t,r,i){var o,s=(o=le().getBool("WEBGL_PACK_CLIP")?new Q5(t.shape):new K5(t.shape)).getCustomSetupFunc(r,i);return this.compileAndRun(o,[t],null,s)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(le().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,rD,t.dtype);var r=new Ft(t.shape,rD);return this.compileAndRun(r,[t])},e.prototype.complexAbs=function(t){var r=this.texData.get(t.dataId),i=new $5(t.shape),o=[this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)];return this.compileAndRun(i,o)},e.prototype.sigmoid=function(t){var r=new Ft(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[t])},e.prototype.softplus=function(t){var r=new Ft(t.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(r,[t])},e.prototype.sin=function(t){var r=new Ft(t.shape,"if (isnan(x)) return x;\n  return sin(x);\n");return this.compileAndRun(r,[t])},e.prototype.cos=function(t){var r=new Ft(t.shape,"if (isnan(x)) return x;\n  return cos(x);\n");return this.compileAndRun(r,[t])},e.prototype.tan=function(t){var r=new Ft(t.shape,"return tan(x);");return this.compileAndRun(r,[t])},e.prototype.asin=function(t){var r=new Ft(t.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n");return this.compileAndRun(r,[t])},e.prototype.acos=function(t){var r=new Ft(t.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n");return this.compileAndRun(r,[t])},e.prototype.atan=function(t){var r=new Ft(t.shape,"if (isnan(x)) return x;\n  return atan(x);\n");return this.compileAndRun(r,[t])},e.prototype.atan2=function(t,r){var i=le().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Oa("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,r.shape):new vr("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.sinh=function(t){var r=new Ft(t.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(r,[t])},e.prototype.cosh=function(t){var r=new Ft(t.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(r,[t])},e.prototype.tanh=function(t){var r=new Ft(t.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(r,[t])},e.prototype.asinh=function(t){var r=new Ft(t.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(r,[t])},e.prototype.acosh=function(t){var r=new Ft(t.shape,"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(r,[t])},e.prototype.atanh=function(t){var r=new Ft(t.shape,"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(r,[t])},e.prototype.erf=function(t){var r=new Ft(t.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(r,[t])},e.prototype.step=function(t,r){var o,i=new Ft(t.shape,(void 0===(o=r)&&(o=0),As+"\n    return x > 0.0 ? 1.0 : float("+o+");\n  "));return this.compileAndRun(i,[t])},e.prototype.conv2dByMatMul=function(t,r,i,o,s,a){var c=t.shape,f=this.texData.get(t.dataId),w="channelsLast"===i.dataFormat,A=c[2]%2!=0&&!!f.isPacked;if((1==c[0]*c[1]*c[2]||1===i.outChannels)&&i.inChannels>1e3||!le().getBool("WEBGL_LAZILY_UNPACK")||!le().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!A){var T=this.reshape(t,[1,w?c[0]*c[1]*c[2]:c[0]*c[2]*c[3],i.inChannels]),N=this.reshape(r,[1,i.inChannels,i.outChannels]);return this.reshape(this.fusedBatchMatMul({a:T,b:N,transposeA:!1,transposeB:!1,bias:o,activation:s,preluActivationWeights:a}),i.outShape)}var R={dataId:t.dataId,shape:[1,w?c[0]*c[1]*(c[2]+1):c[0]*c[2]*(c[3]+1),i.inChannels],dtype:t.dtype},P=f.shape;f.shape=f.shape.slice(),f.shape[f.shape.length-2]++,H(wd(f.shape,R.shape),function(){return"packed reshape "+f.shape+" to "+R.shape+" isn't free"});var B=this.reshape(r,[1,i.inChannels,i.outChannels]),Y=this.fusedBatchMatMul({a:R,b:B,transposeA:!1,transposeB:!1,bias:o,activation:s,preluActivationWeights:a}),X=this.texData.get(Y.dataId);return H(X.isPacked,function(){return"batchMatMul result is expected to be packed"}),f.shape=P,X.shape=i.outShape,Q.makeTensorFromDataId(Y.dataId,i.outShape,Y.dtype)},e.prototype.conv2dWithIm2Row=function(t,r,i,o,s,a){var m=i.outWidth,y=i.outHeight,w="channelsLast"===i.dataFormat,E=i.filterWidth*i.filterHeight*i.inChannels,A=y*m,_=[E,A],T=t.squeeze([0]),N=r.reshape([1,E,-1]),M=new E7(_,T.shape,i),R=this.compileAndRun(M,[T]).reshape([1,_[0],_[1]]),P=null!=o,B=null!=a,Y=s?Xp(s,!0):null,X=new Nv(R.shape,[1,A,i.outChannels],!0,!1,P,Y,B),z=[R,N];return o&&z.push(o),B&&z.push(a),this.compileAndRun(X,z).reshape(w?[1,y,m,i.outChannels]:[1,i.outChannels,y,m])},e.prototype.fusedConv2d=function(t){var r=t.input,i=t.filter,o=t.convInfo,s=t.bias,a=t.activation,c=t.preluActivationWeights;if(1===o.filterHeight&&1===o.filterWidth&&1===o.dilationHeight&&1===o.dilationWidth&&1===o.strideHeight&&1===o.strideWidth&&("SAME"===o.padInfo.type||"VALID"===o.padInfo.type))return this.conv2dByMatMul(r,i,o,s,a,c);if(le().getBool("WEBGL_CONV_IM2COL")&&1===r.shape[0])return this.conv2dWithIm2Row(r,i,o,s,a,c);var f=null!=s,p=null!=c,m=a?Xp(a,!1):null,y=new RA(o,f,m,p),w=[r,i];return s&&w.push(s),c&&w.push(c),this.compileAndRun(y,w)},e.prototype.conv2d=function(t,r,i){if(1===i.filterHeight&&1===i.filterWidth&&1===i.dilationHeight&&1===i.dilationWidth&&1===i.strideHeight&&1===i.strideWidth&&("SAME"===i.padInfo.type||"VALID"===i.padInfo.type))return this.conv2dByMatMul(t,r,i);if(le().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,r,i);var o=new RA(i);return this.compileAndRun(o,[t,r])},e.prototype.conv2dDerInput=function(t,r,i){var o=new t7(i);return this.compileAndRun(o,[t,r])},e.prototype.conv2dDerFilter=function(t,r,i){var o=new e7(i);return this.compileAndRun(o,[t,r])},e.prototype.fusedDepthwiseConv2D=function(t){var r,i=t.input,o=t.filter,s=t.convInfo,a=t.bias,c=t.activation,f=t.preluActivationWeights,p=le().getBool("WEBGL_PACK_DEPTHWISECONV")&&s.strideWidth<=2&&s.outChannels/s.inChannels==1,m=c?Xp(c,p):null,y=[i,o],w=null!=a,E=null!=f;return w&&y.push(a),E&&y.push(f),p?(r=new OA(s,w,m,E),this.compileAndRun(r,y)):(r=new MA(s,w,m,E),this.compileAndRun(r,y))},e.prototype.depthwiseConv2D=function(t,r,i){var o;return le().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1?(o=new OA(i),this.compileAndRun(o,[t,r])):(o=new MA(i),this.compileAndRun(o,[t,r]))},e.prototype.depthwiseConv2DDerInput=function(t,r,i){var o=new o7(i);return this.compileAndRun(o,[t,r])},e.prototype.depthwiseConv2DDerFilter=function(t,r,i){var o=new i7(i);return this.compileAndRun(o,[t,r])},e.prototype.conv3d=function(t,r,i){var o=new s7(i);return this.compileAndRun(o,[t,r])},e.prototype.conv3dDerInput=function(t,r,i){var o=new r7(i);return this.compileAndRun(o,[t,r])},e.prototype.conv3dDerFilter=function(t,r,i){var o=new n7(i);return this.compileAndRun(o,[t,r])},e.prototype.maxPool=function(t,r){var i=new Rv(r,"max",!1);return this.compileAndRun(i,[t])},e.prototype.avgPool=function(t,r){var i=new Rv(r,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPoolBackprop=function(t,r,i,o){var s=new Rv(o,"max",!0),a=this.compileAndRun(s,[r]),c=new D7(o),f=this.compileAndRun(c,[t,a],r.dtype);return a.dispose(),f},e.prototype.avgPoolBackprop=function(t,r,i){var o=new H5(i);return this.compileAndRun(o,[t],r.dtype)},e.prototype.cast=function(t,r){return bv(t,r,this)},e.prototype.unstack=function(t,r){for(var i=t.shape[r],o=new Array(t.rank-1),s=0,a=0;a<t.rank;a++)a!==r&&(o[s++]=t.shape[a]);var c=new Array(t.rank).fill(0),f=t.shape.slice();f[r]=1;var p=new Array(i);for(a=0;a<p.length;a++)c[r]=a,p[a]=this.slice(t,c,f).reshape(o);return p},e.prototype.avgPool3d=function(t,r){var i=new Mv(r,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,r,i){var o=new z5(i);return this.compileAndRun(o,[t],r.dtype)},e.prototype.maxPool3d=function(t,r){var i=new Mv(r,"max",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,r,i,o){var s=new Mv(o,"max",!0),a=this.compileAndRun(s,[r]),c=new T7(o),f=this.compileAndRun(c,[t,a],r.dtype);return a.dispose(),f},e.prototype.reshape=function(t,r){var i=this.texData.get(t.dataId);if(i.isPacked&&!wd(t.shape,r)&&(null===i.texture||!wd(i.shape,r))){var o=this.packedReshape(t,r);return Q.makeTensorFromDataId(o.dataId,o.shape,o.dtype)}return Hp(t,r)},e.prototype.resizeBilinear=function(t,r,i,o){var s=le().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new B7(t.shape,r,i,o):new L7(t.shape,r,i,o);return this.compileAndRun(s,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,r,i){var o=new k7(t,r,i);return this.compileAndRun(o,[t])},e.prototype.resizeNearestNeighbor=function(t,r,i,o){var s=new U7(t.shape,r,i,o);return this.compileAndRun(s,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,r,i){var o=new V7(t,r,i);return this.compileAndRun(o,[t])},e.prototype.multinomial=function(t,r,i,o){var s=r?t:Ra(t),f=new S7(s.shape[0],s.shape[1],i),p=f.getCustomSetupFunc(o);return this.compileAndRun(f,[s],"int32",p)},e.prototype.oneHot=function(t,r,i,o){var s=new N7(t.size,r,i,o);return this.compileAndRun(s,[t])},e.prototype.diag=function(t){var r=new d7(t.size);return this.compileAndRun(r,[t])},e.prototype.nonMaxSuppression=function(t,r,i,o,s){return Np("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),_v(t.dataSync(),r.dataSync(),i,o,s)},e.prototype.cropAndResize=function(t,r,i,o,s,a){var c=new a7(t.shape,r.shape,o,s,a);return this.compileAndRun(c,[t,r,i],"float32")},e.prototype.depthToSpace=function(t,r,i){H(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var o=t.shape[0],f=("NHWC"===i?t.shape[1]:t.shape[2])*r,p=("NHWC"===i?t.shape[2]:t.shape[3])*r,m=("NHWC"===i?t.shape[3]:t.shape[1])/(r*r),y=new f7("NHWC"===i?[o,f,p,m]:[o,m,f,p],r,i);return this.compileAndRun(y,[t])},e.prototype.split=function(t,r,i){return bA(t,r,i)},e.prototype.scatterND=function(t,r,i){var o=Cd(0,t,i),s=o.sliceRank,a=o.numUpdates,c=o.sliceSize,f=o.strides,p=o.outputSize,m=[p/c,c],y=t.reshape([a,s]),w=r.reshape([a,c]);if(0===p)return Hp(fi([]),i);var E=Pe(0),A=new eD(a,s,y.rank,w.rank,f,m);return this.compileAndRun(A,[w,y,E]).reshape(i)},e.prototype.sparseToDense=function(t,r,i,o){var s=Cd(0,t,i),m=new eD(s.numUpdates,s.sliceRank,t.rank,r.rank,s.strides,[s.outputSize,1],!1);return this.compileAndRun(m,[r,t,o]).reshape(i)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,r){var i=this.texData.get(t.dataId),o=new PA("return real * expR - imag * expI;",t.shape,r),s=new PA("return real * expI + imag * expR;",t.shape,r),a=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag)],c=this.compileAndRun(o,a),f=this.compileAndRun(s,a),p=this.complex(c,f).as2D(t.shape[0],t.shape[1]);return c.dispose(),f.dispose(),p},e.prototype.gatherND=function(t,r){var i=r.shape,o=i[i.length-1],s=pv(t,r),a=s[0],c=s[1],f=s[2],p=s[3],m=r.reshape([c,o]),y=t.reshape([t.size/f,f]),w=new b7(o,p,[c,f]);return this.compileAndRun(w,[y,m]).reshape(a)},e.prototype.fill=function(t,r,i){if("string"===(i=i||Il(r))){var o=ad(i,$e(t));return o.fill(r),Q.makeTensor(o,t,i,this)}var s=new x7(t,r),a=s.getCustomSetupFunc(r);return this.compileAndRun(s,[],i,a)},e.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,"string"===t.dtype?"":0,t.dtype)},e.prototype.linspace=function(t,r,i){return Cv(t,r,i)},e.prototype.makeTensorInfo=function(t,r){var i=this.write(null,t,r);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:r}},e.prototype.makeOutput=function(t,r){var i=this.makeTensorInfo(t,r).dataId;return Q.makeTensorFromDataId(i,t,r,this)},e.prototype.unpackTensor=function(t){var r=new c9(t.shape);return this.runWebGLProgram(r,[t],t.dtype)},e.prototype.packTensor=function(t){var r=new R7(t.shape);return this.runWebGLProgram(r,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,r){var i=[yd(t.shape)].concat(xd(t.shape)),o={dtype:t.dtype,shape:i,dataId:t.dataId},s=[yd(r)].concat(xd(r)),a=new P7(s,i),c=this.runWebGLProgram(a,[o],t.dtype,null,!0);return{dataId:c.dataId,shape:r,dtype:c.dtype}},e.prototype.decode=function(t){var r,i=this.texData.get(t),o=i.isPacked,s=i.shape,a=i.dtype,c=Tp(s);return r=o?new l7(c):new c7(c),{dtype:a,shape:s,dataId:this.runWebGLProgram(r,[{shape:c,dtype:a,dataId:t}],a,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,r,i,o,s){var a=this;void 0===s&&(s=!1);var c=this.makeTensorInfo(t.outputShape,i),f=this.texData.get(c.dataId);if(t.packedOutput&&(f.isPacked=!0),t.outPackingScheme===hd.DENSE){var p=pd(t.outputShape);f.texShape=p.map(function(M){return 2*M})}if(null!=t.outTexUsage&&(f.usage=t.outTexUsage),0===$e(c.shape))return f.values=_l(c.dtype,0),c;var m=[],y=r.map(function(M){if("complex64"===M.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var R=a.texData.get(M.dataId);if(null==R.texture){if(!t.packedInputs&&$e(M.shape)<=le().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:M.shape,texData:null,isUniform:!0,uniformValues:R.values};t.packedInputs&&(R.isPacked=!0,R.shape=M.shape)}else if(!!R.isPacked!=!!t.packedInputs)M=R.isPacked?a.unpackTensor(M):a.packTensor(M),m.push(M),R=a.texData.get(M.dataId);else if(R.isPacked&&!wd(R.shape,M.shape)){var P=M,B=M.shape;M.shape=R.shape,M=a.packedReshape(M,B),m.push(M),R=a.texData.get(M.dataId),P.shape=B}return a.uploadToGPU(M.dataId),{shape:M.shape,texData:R,isUniform:!1}});this.uploadToGPU(c.dataId);var w,M,B,E={shape:c.shape,texData:f,isUniform:!1},A=(M=t,B="",y.concat(E).forEach(function(z){B+=z.shape+"_"+(z.isUniform?"uniform":z.texData.texShape)+"_"+(null!=z.texData&&null!=z.texData.slice&&z.texData.slice.flatOffset>0)}),M.constructor.name+"_"+B+"_"+M.userCode),_=this.getAndSaveBinary(A,function(){return function(M,R,P,B){var Y=R.userCode,X=P.map(function(me,Ie){var De={logicalShape:me.shape,texShape:me.isUniform?null:me.texData.texShape,isUniform:me.isUniform,isPacked:!me.isUniform&&me.texData.isPacked,flatOffset:null};return null!=me.texData&&null!=me.texData.slice&&me.texData.slice.flatOffset>0&&(De.flatOffset=me.texData.slice.flatOffset),{name:R.variableNames[Ie],shapeInfo:De}}),z=X.map(function(me){return me.shapeInfo}),G={logicalShape:B.shape,texShape:B.texData.texShape,isUniform:!1,isPacked:B.texData.isPacked,flatOffset:null},ee=L5(X,G,Y,R.packedInputs),J=M.createProgram(ee),pe=null,fe=M.getUniformLocation(J,"NAN",!1);1===le().getNumber("WEBGL_VERSION")&&(pe=M.getUniformLocation(J,"INFINITY",!1));for(var he={},xe=0;xe<R.variableNames.length;xe++){var we=R.variableNames[xe];he[we]=M.getUniformLocation(J,we,!1),he["offset"+we]=M.getUniformLocation(J,"offset"+we,!1)}return{program:R,source:ee,webGLProgram:J,uniformLocations:he,inShapeInfos:z,outShapeInfo:G,infLoc:pe,nanLoc:fe}}(a.gpgpu,t,y,E)}),T=null!=this.activeTimers;if(T&&(w=this.startTimer()),function(M,R,P,B,Y){JA(R.inShapeInfos,P),JA([R.outShapeInfo],[B]);var X=B.texData.texture,z=B.texData.texShape;B.texData.isPacked?M.setOutputPackedMatrixTexture(X,z[0],z[1]):M.setOutputMatrixTexture(X,z[0],z[1]),M.setProgram(R.webGLProgram),1===le().getNumber("WEBGL_VERSION")&&null!==R.infLoc&&M.gl.uniform1f(R.infLoc,1/0),null!==R.nanLoc&&M.gl.uniform1f(R.nanLoc,NaN),P.forEach(function(G,ee){var J=R.program.variableNames[ee],pe=R.uniformLocations[J],fe=R.uniformLocations["offset"+J];if(null!=pe)if(G.isUniform)if($e(G.shape)<2)M.gl.uniform1f(pe,G.uniformValues[0]);else{var he=G.uniformValues;he instanceof Float32Array||(he=new Float32Array(he)),M.gl.uniform1fv(pe,he)}else null!=G.texData.slice&&null!=fe&&M.gl.uniform1i(fe,G.texData.slice.flatOffset),M.setInputMatrixTexture(G.texData.texture,pe,ee)}),null!=Y&&Y(M,R.webGLProgram),M.executeProgram()}(this.gpgpu,_,y,E,o),m.forEach(function(M){return a.disposeData(M.dataId)}),T&&(w=this.endTimer(w),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(w)})),!le().getBool("WEBGL_LAZILY_UNPACK")&&f.isPacked&&!1===s){var N=this.unpackTensor(c);return this.disposeData(c.dataId),N}return c},e.prototype.compileAndRun=function(t,r,i,o,s){void 0===s&&(s=!1);var a=this.runWebGLProgram(t,r,i=i||r[0].dtype,o,s);return Q.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},e.prototype.getAndSaveBinary=function(t,r){return t in this.binaryCache||(this.binaryCache[t]=r()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(le().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){t.gpgpu.deleteProgram(t.binaryCache[r].webGLProgram),delete t.binaryCache[r]}),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=We(function(){if(!le().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=le().getBool("DEBUG");le().set("DEBUG",!1);var i=t.abs(Pe(1e-8)).dataSync()[0];if(le().set("DEBUG",r),i>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var r,i=this.texData.get(t),o=i.shape,s=i.dtype,a=i.values,f=i.usage,p=i.isPacked;if(null==i.texture){var m,y=null!=this.activeTimers;y&&(m=Cs());var w=i.texShape;if(null==w&&(w=YI(o,p),i.texShape=w),null!=a){var E=Tp(o),A=void 0,_=w[1],T=w[0],N=a instanceof Uint8Array;p?(_=(r=gd(w[0],w[1]))[0],A=new m7(E,[T=r[1],_],N)):A=new g7(E,[T,_],N);var M=this.makeTensorInfo([T,_],s);this.texData.get(M.dataId).usage=N?bo.PIXELS:bo.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(M.dataId),_,T,a);var R=this.runWebGLProgram(A,[M],s,null,!0),P=this.texData.get(R.dataId);i.texture=P.texture,i.texShape=P.texShape,i.isPacked=P.isPacked,i.usage=P.usage,this.disposeData(M.dataId),this.texData.delete(R.dataId),i.values=null,y&&(this.uploadWaitMs+=Cs()-m)}else{var B=this.acquireTexture(w,f,s,p);i.texture=B}}},e.prototype.convertAndCacheOnCPU=function(t,r){var i=this.texData.get(t),o=i.dtype;return this.releaseGPUData(t),null!=r&&(i.values=function(s,a){if("float32"===a||"complex64"===a)return s;if("int32"===a||"bool"===a){for(var c="int32"===a?new Int32Array(s.length):new Uint8Array(s.length),f=0;f<c.length;++f)c[f]=Math.round(s[f]);return c}throw new Error("Unknown dtype "+a)}(r,o)),i.values},e.prototype.acquireTexture=function(t,r,i,o){if(this.numBytesInGPU+=this.computeBytes(t,i),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+s+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,r,o)},e.prototype.computeBytes=function(t,r){return t[0]*t[1]*Hm(r)},e}(vA);DI()&&Q.registerBackend("webgl",function(){return new gD},2);var f9=$({square_:function(n){var e=U(n,"x","square");return Q.runKernelFunc(function(r,i){return i([e]),r.square(e)},{x:e},null,"Square",{},[e],[])}}),Td="SquaredDifference",mD=$({squaredDifference_:function(n,e){var t,r=U(n,"a","squaredDifference"),i=U(e,"b","squaredDifference");return t=$n(r,i),zt((r=t[0]).shape,(i=t[1]).shape),Q.runKernelFunc(function(a,c){var f=a.squaredDifference(r,i);return c([r,i]),f},{a:r,b:i},function(a,c){var f=c[0],p=c[1],m=Pe(2);return{a:function(){return a.mul(f.sub(p).mul(m))},b:function(){return a.mul(p.sub(f).mul(m))}}},Td,{},[r,i],[])}}),d9=$({abs_:function(n){var e=U(n,"x","abs");return"complex64"===e.dtype?Q.runKernelFunc(function(t){return t.complexAbs(e)},{$x:e}):Q.runKernelFunc(function(t,r){var i=t.abs(e);return r([e]),i},{x:e},function(t,r){var i=r[0];return{x:function(){return t.mul(i.toFloat().step(-1))}}},"Abs")}}),h9=$({acos_:function(n){var e=U(n,"x","acos");return Q.runKernelFunc(function(t,r){var i=t.acos(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(Pe(1).sub(i.toFloat().square()).sqrt()).neg()}}})}}),p9=$({acosh_:function(n){var e=U(n,"x","acosh");return Q.runKernelFunc(function(t,r){var i=t.acosh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(i.toFloat().square().sub(1).sqrt())}}})}}),g9=$({asin_:function(n){var e=U(n,"x","asin");return Q.runKernelFunc(function(t,r){var i=t.asin(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(Pe(1).sub(i.toFloat().square()).sqrt())}}})}}),m9=$({asinh_:function(n){var e=U(n,"x","asinh");return Q.runKernelFunc(function(t,r){var i=t.asinh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(Pe(1).add(i.toFloat().square()).sqrt())}}})}}),v9=$({atan_:function(n){var e=U(n,"x","atan");return Q.runKernelFunc(function(t,r){var i=t.atan(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().square().add(1))}}})}}),y9=$({atanh_:function(n){var e=U(n,"x","atanh");return Q.runKernelFunc(function(t,r){var i=t.atanh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(Pe(1).sub(i.toFloat().square()))}}})}}),x9=$({ceil_:function(n){var e=U(n,"x","ceil");return Q.runKernelFunc(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return dn(t)}}})}}),kv=$({clipByValue_:function(n,e,t){var r=U(n,"x","clipByValue");return H(e<=t,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."}),Q.runKernelFunc(function(s,a){var c=s.clip(r,e,t);return a([r]),c},{x:r},function(s,a){var c=a[0];return{x:function(){return s.where(c.greaterEqual(e).logicalAnd(c.lessEqual(t)),dn(s))}}},"ClipByValue",{min:e,max:t},[r])}}),w9=$({cos_:function(n){var e=U(n,"x","cos");return Q.runKernelFunc(function(r,i){var o=r.cos(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return o.toFloat().sin().neg().mul(r)}}},"Cos",{},[e])}}),b9=$({cosh_:function(n){var e=U(n,"x","cosh");return Q.runKernelFunc(function(t,r){var i=t.cosh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().sinh().mulStrict(t)}}})}}),C9=$({erf_:function(n){var e=U(n,"x","erf");return H("int32"===e.dtype||"float32"===e.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===e.dtype&&(e=e.toFloat()),Q.runKernelFunc(function(t,r){var i=t.erf(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Lv=$({exp_:function(n){var e=U(n,"x","exp");return Q.runKernelFunc(function(t,r){var i=t.exp(e);return r([i]),i},{x:e},function(t,r){return{x:function(){return t.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),E9=$({expm1_:function(n){var e=U(n,"x","expm1");return Q.runKernelFunc(function(t,r){var i=t.expm1(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.exp())}}})}}),_9=$({floor_:function(n){var e=U(n,"x","floor");return Q.runKernelFunc(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return dn(t)}}})}}),I9=$({log_:function(n){var e=U(n,"x","log");return Q.runKernelFunc(function(r,i){var o=r.log(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return r.div(o.toFloat())}}},"Log",{},[e])}}),A9=$({log1p_:function(n){var e=U(n,"x","log1p");return Q.runKernelFunc(function(t,r){var i=t.log1p(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.add(1))}}})}}),D9=$({logSigmoid_:function(n){var e=U(n,"x","logSigmoid");return Q.runKernelFunc(function(t,r){var i=t.softplus(e.neg()).neg();return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.neg().sigmoid())}}})}}),qp=$({neg_:function(n){var e=U(n,"x","neg");return Q.runKernelFunc(function(r){return r.neg(e)},{x:e},function(r){return{x:function(){return r.neg()}}},"Neg",{},[e])}}),T9=$({reciprocal_:function(n){var e=U(n,"x","reciprocal");return Q.runKernelFunc(function(t,r){var i=t.reciprocal(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.square().neg())}}})}}),S9=$({round_:function(n){var e=U(n,"x","round");return Q.runKernelFunc(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return dn(t)}}})}}),vD=$({rsqrt_:function(n){var e=U(n,"x","rsqrt");return Q.runKernelFunc(function(r,i){var o=r.rsqrt(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return r.div(o.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},[e])}}),yD=$({sigmoid_:function(n){var e=U(n,"x","sigmoid");return Q.runKernelFunc(function(t,r){var i=t.sigmoid(e);return r([i]),i},{x:e},function(t,r){var i=r[0];return{x:function(){return t.mul(i.mul(Pe(1).sub(i)))}}},"Sigmoid")}}),N9=$({sign_:function(n){var e=U(n,"x","sign");return Q.runKernelFunc(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return dn(t)}}})}}),R9=$({isNaN_:function(n){var e=U(n,"x","isNaN");return Q.runKernelFunc(function(t){return t.isNaN(e)},{$x:e},function(t){return{$x:function(){return dn(t)}}})}}),M9=$({isInf_:function(n){var e=U(n,"x","isInf");return Q.runKernelFunc(function(t){return t.isInf(e)},{$x:e},function(t){return{$x:function(){return dn(t)}}})}}),O9=$({isFinite_:function(n){var e=U(n,"x","isFinite");return Q.runKernelFunc(function(t){return t.isFinite(e)},{$x:e},function(t){return{$x:function(){return dn(t)}}})}}),F9=$({sin_:function(n){var e=U(n,"x","sin");return Q.runKernelFunc(function(r,i){var o=r.sin(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return o.toFloat().cos().mul(r)}}},"Sin",{},[e])}}),P9=$({sinh_:function(n){var e=U(n,"x","sinh");return Q.runKernelFunc(function(t,r){var i=t.sinh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().cosh().mulStrict(t)}}})}}),k9=$({softplus_:function(n){var e=U(n,"x","softplus");return Q.runKernelFunc(function(t,r){var i=t.softplus(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.sigmoid())}}})}}),L9=$({sqrt_:function(n){var e=U(n,"x","sqrt");return Q.runKernelFunc(function(t,r){var i=t.sqrt(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().sqrt().mul(2))}}})}}),B9=$({step_:function(n,e){void 0===e&&(e=0);var t=U(n,"x","step");return Q.runKernelFunc(function(r){return r.step(t,e)},{$x:t},function(r){return{$x:function(){return dn(r)}}})}}),V9=$({tan_:function(n){var e=U(n,"x","tan");return Q.runKernelFunc(function(t,r){var i=t.tan(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.cos().square())}}})}}),U9=$({tanh_:function(n){var e=U(n,"x","tanh");return Q.runKernelFunc(function(t,r){var i=t.tanh(e);return r([i]),i},{x:e},function(t,r){var i=r[0];return{x:function(){return Pe(1).sub(i.square()).mulStrict(t)}}},"Tanh",{},null,[!0])}});function xD(n,e,t,r,i,o){var s,a,c=U(n,"x","batchNorm"),f=U(e,"mean","batchNorm"),p=U(t,"variance","batchNorm");return null!=i&&(s=U(i,"scale","batchNorm")),null!=r&&(a=U(r,"offset","batchNorm")),H(2===c.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."}),H(2===f.rank||1===f.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+f.rank+"."}),H(2===p.rank||1===p.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+p.rank+"."}),null!=s&&H(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+s.rank+"."}),null!=a&&H(2===a.rank||1===a.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+a.rank+"."}),Sd(c,f,p,a,s,o)}function wD(n,e,t,r,i,o){var s,a,c=U(n,"x","batchNorm"),f=U(e,"mean","batchNorm"),p=U(t,"variance","batchNorm");return null!=i&&(s=U(i,"scale","batchNorm")),null!=r&&(a=U(r,"offset","batchNorm")),H(3===c.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."}),H(3===f.rank||1===f.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+f.rank+"."}),H(3===p.rank||1===p.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+p.rank+"."}),null!=s&&H(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+s.rank+"."}),null!=a&&H(3===a.rank||1===a.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+a.rank+"."}),Sd(c,f,p,a,s,o)}function bD(n,e,t,r,i,o){var s,a,c=U(n,"x","batchNorm"),f=U(e,"mean","batchNorm"),p=U(t,"variance","batchNorm");return null!=i&&(s=U(i,"scale","batchNorm")),null!=r&&(a=U(r,"offset","batchNorm")),H(4===c.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+c.rank+"."}),H(4===f.rank||1===f.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+f.rank+"."}),H(4===p.rank||1===p.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+p.rank+"."}),null!=s&&H(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+s.rank+"."}),null!=a&&H(4===a.rank||1===a.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+a.rank+"."}),Sd(c,f,p,a,s,o)}function Sd(n,e,t,r,i,o){null==o&&(o=.001);var s,a,c,f=U(n,"x","batchNorm"),p=U(e,"mean","batchNorm"),m=U(t,"variance","batchNorm");return null!=i&&(s=U(i,"scale","batchNorm")),null!=r&&(a=U(r,"offset","batchNorm")),H(p.rank===m.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),H(null==a||p.rank===a.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),H(null==s||p.rank===s.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),c=0===f.rank||1===f.rank?f.as4D(1,1,1,f.size):2===f.rank?f.as4D(1,1,f.shape[0],f.shape[1]):3===f.rank?f.as4D(1,f.shape[0],f.shape[1],f.shape[2]):f,Q.runKernelFunc(function(w,E){var A=w.batchNormalization(c,Kp(p),Kp(m),o,Kp(s),Kp(a));return E([f,p,m,s]),A},{x:f,mean:p,variance:m,scale:s,offset:a},function(w,E){var _=E[0],T=E[1],N=E[2],M=E[3],R=null==M?Pe(1):M,P=Fr(T.shape,c.shape),B=[];if(1===T.rank){for(var Y=0;Y<c.shape.length-1;++Y)B.push(c.shape[Y]);B.push(1)}var X=_.sub(T),z=w.mul(R),G=vD(N.add(Pe(o))),ee=G.mul(G).mul(G).mul(Pe(-.5));return{x:function(){return 1===T.rank?w.mul(Sl(G.as4D(1,1,1,T.shape[0]),B)).mul(R).reshape(_.shape):w.mul(G).mul(R).reshape(_.shape)},mean:function(){var J=G.mul(Pe(-1)).mul(z);return 1===T.rank&&(J=J.sum(P)),J.reshape(T.shape)},variance:function(){var J=ee.mul(X).mul(z);return 1===T.rank&&(J=J.sum(P)),J.reshape(T.shape)},scale:function(){var J=X.mul(G),pe=w.mul(J);return 1===T.rank&&(pe=pe.sum(P)),pe.reshape(T.shape)},offset:function(){var J=w;return 1===T.rank&&(J=J.sum(P)),J.reshape(T.shape)}}},"BatchNormalization",{varianceEpsilon:o},[f,p,m,s]).reshape(f.shape)}function Kp(n){return null==n?null:0===n.rank?n.as1D():1===n.rank?n:2===n.rank?n.as4D(1,1,n.shape[0],n.shape[1]):3===n.rank?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function Qp(){JI("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var j9=$({batchNormalization2d_:function(n,e,t,r,i,o){return void 0===r&&(r=.001),Qp(),xD(n,e,t,o,i,r)}}),W9=$({batchNormalization3d_:function(n,e,t,r,i,o){return void 0===r&&(r=.001),Qp(),wD(n,e,t,o,i,r)}}),H9=$({batchNormalization4d_:function(n,e,t,r,i,o){return void 0===r&&(r=.001),Qp(),bD(n,e,t,o,i,r)}}),z9=$({batchNormalization_:function(n,e,t,r,i,o){return void 0===r&&(r=.001),Qp(),Sd(n,e,t,o,i,r)}}),CD=$({batchNorm_:Sd}),G9=$({batchNorm2d_:xD}),Y9=$({batchNorm3d_:wD}),X9=$({batchNorm4d_:bD}),$p=$({logicalAnd_:function(n,e){var t=U(n,"a","logicalAnd","bool"),r=U(e,"b","logicalAnd","bool");return zt(t.shape,r.shape),Q.runKernelFunc(function(i){return i.logicalAnd(t,r)},{a:t,b:r},null,"LogicalAnd")}}),q9=$({logicalNot_:function(n){var e=U(n,"x","logicalNot","bool");return Q.runKernelFunc(function(t){return t.logicalNot(e)},{$x:e})}}),ED=$({logicalOr_:function(n,e){var t=U(n,"a","logicalOr","bool"),r=U(e,"b","logicalOr","bool");return zt(t.shape,r.shape),Q.runKernelFunc(function(i){return i.logicalOr(t,r)},{$a:t,$b:r})}}),K9=$({logicalXor_:function(n,e){var t=U(n,"a","logicalXor","bool"),r=U(e,"b","logicalXor","bool");return zt(t.shape,r.shape),ED(n,e).logicalAnd($p(n,e).logicalNot())}}),fc=$({where_:function(n,e,t){var r=U(e,"a","where"),i=U(t,"b","where"),o=U(n,"condition","where","bool");return fn(r.shape,i.shape,"Error in where: "),1===o.rank?H(o.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):fn(o.shape,i.shape,"Error in where: "),Q.runKernelFunc(function(s,a){var c=s.select(o,r,i);return a([o]),c},{$condition:o,$a:r,$b:i},function(s,a){var c=a[0];return{$condition:function(){return dn(c).toFloat()},$a:function(){return s.mul(c.cast(s.dtype))},$b:function(){return s.mul(c.logicalNot().cast(s.dtype))}}})}}),_D=function(n){return qe(this,void 0,void 0,function(){var e,t,r;return Ke(this,function(i){switch(i.label){case 0:return[4,(e=U(n,"condition","whereAsync","bool")).data()];case 1:return t=i.sent(),r=Av(e.shape,t),n!==e&&e.dispose(),[2,r]}})})},Gt=$({add_:function(n,e){var t,r=U(n,"a","add"),i=U(e,"b","add");t=$n(r,i);var o=zt((r=t[0]).shape,(i=t[1]).shape);return Q.runKernelFunc(function(s){return s.add(r,i)},{a:r,b:i},function(s){return{a:function(){var a=s,c=Fr(r.shape,o);return c.length>0&&(a=a.sum(c)),a.reshape(r.shape)},b:function(){var a=s,c=Fr(i.shape,o);return c.length>0&&(a=a.sum(c)),a.reshape(i.shape)}}},"Add")}}),Q9=$({addN_:function(n){H(Array.isArray(n),function(){return"The argument passed to tf.addN() must be a list of tensors"}),H(n.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length});var e=n.map(function(i,o){return U(i,"tensors"+o,"addN")}),t=e[0];return e.forEach(function(i){if(i.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(i){if(!Rr(i.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}),Q.runKernelFunc(function(i){return i.addN(e)},e,function(i){var o={};return e.forEach(function(s,a){o[a]=function(){return i.clone()}}),o},"AddN")}}),$9=$({addStrict_:function(n,e){var t=U(n,"a","addStrict"),r=U(e,"b","addStrict");return fn(t.shape,r.shape,"Error in addStrict: "),t.add(r)}}),Z9=$({atan2_:function(n,e){var t,r=U(n,"a","atan2"),i=U(e,"b","atan2");t=$n(r,i);var o=zt((r=t[0]).shape,(i=t[1]).shape);return Q.runKernelFunc(function(s,a){var c=s.atan2(r,i);return a([r,i]),c},{$a:r,$b:i},function(s,a){var c=a[0],f=a[1];return{$a:function(){var p=Gt(c.square(),f.square()),m=s.mul(f.div(p)),y=Fr(c.shape,o);return y.length>0&&(m=m.sum(y)),m.reshape(c.shape)},$b:function(){var p=Gt(c.square(),f.square()),m=qp(s.mul(c.div(p))),y=Fr(f.shape,o);return y.length>0&&(m=m.sum(y)),m.reshape(f.shape)}}})}}),Ds=$({div_:function(n,e){var t,r=U(n,"a","div"),i=U(e,"b","div");if(t=$n(r,i),i=t[1],"int32"===(r=t[0]).dtype&&"int32"===i.dtype)return ID(r,i);var o=zt(r.shape,i.shape);return Q.runKernelFunc(function(s,a){var c=s.realDivide(r,i);return a([r,i]),c},{a:r,b:i},function(s,a){var c=a[0],f=a[1];return{a:function(){var p=s.div(f.toFloat()),m=Fr(c.shape,o);return m.length>0?p.sum(m).reshape(c.shape):p},b:function(){var p=s.mul(c.toFloat()),m=Fr(f.shape,o);m.length>0&&(p=p.sum(m).reshape(f.shape));var y=f.square();return p.div(y.toFloat()).neg()}}},"Div")}}),J9=$({divNoNan_:function(n,e){var t,r=U(n,"a","div"),i=U(e,"b","div");r=(t=$n(r,i))[0];var o=Ds(r,i=t[1]),s=dn(o),a=i.equal(s);return fc(a,s,o)}}),eV=$({divStrict_:function(n,e){var t=U(n,"a","div"),r=U(e,"b","div");return fn(t.shape,r.shape,"Error in divideStrict: "),t.div(r)}}),ID=$({floorDiv_:function(n,e){var t,r=U(n,"a","floorDiv"),i=U(e,"b","floorDiv");t=$n(r,i);var o=zt((r=t[0]).shape,(i=t[1]).shape);return Q.runKernelFunc(function(s,a){var c=s.floorDiv(r,i);return a([r,i]),c},{a:r,b:i},function(s,a){var c=a[0],f=a[1];return{a:function(){var p=s.div(f.toFloat()),m=Fr(c.shape,o);return m.length>0?p.sum(m).reshape(c.shape):p},b:function(){var p=s.mul(c.toFloat()),m=Fr(f.shape,o);m.length>0&&(p=p.sum(m).reshape(f.shape));var y=f.square();return p.div(y.toFloat()).neg()}}},"FloorDiv")}}),Bv=$({maximum_:function(n,e){var t,r=U(n,"a","maximum"),i=U(e,"b","maximum");return t=$n(r,i),i=t[1],"bool"===(r=t[0]).dtype&&(r=r.toInt(),i=i.toInt()),zt(r.shape,i.shape),Q.runKernelFunc(function(o,s){var a=o.maximum(r,i);return s([r,i]),a},{a:r,b:i},function(o,s){var a=s[0],c=s[1];return{a:function(){return o.mul(a.greaterEqual(c).toFloat())},b:function(){return o.mul(a.less(c).toFloat())}}},"Maximum")}}),tV=$({maximumStrict_:function(n,e){var t=U(n,"a","maximumStrict"),r=U(e,"b","maximumStrict");return fn(t.shape,r.shape,"Error in maximumStrict: "),t.maximum(r)}}),AD=$({minimum_:function(n,e){var t,r=U(n,"a","minimum"),i=U(e,"b","minimum");return t=$n(r,i),i=t[1],"bool"===(r=t[0]).dtype&&(r=r.toInt(),i=i.toInt()),zt(r.shape,i.shape),Q.runKernelFunc(function(o,s){var a=o.minimum(r,i);return s([r,i]),a},{a:r,b:i},function(o,s){var a=s[0],c=s[1];return{a:function(){return o.mul(a.lessEqual(c).toFloat())},b:function(){return o.mul(a.greater(c).toFloat())}}},"Minimum")}}),nV=$({minimumStrict_:function(n,e){var t=U(n,"a","minimumStrict"),r=U(e,"b","minimumStrict");return fn(t.shape,r.shape,"Error in minimumStrict: "),t.minimum(r)}}),rV=$({mod_:function(n,e){var t,r=U(n,"a","mod"),i=U(e,"b","mod");t=$n(r,i);var o=zt((r=t[0]).shape,(i=t[1]).shape);return Q.runKernelFunc(function(s,a){var c=s.mod(r,i);return a([r,i]),c},{$a:r,$b:i},function(s,a){var c=a[0],f=a[1];return{$a:function(){var p=Fr(c.shape,o);return p.length>0?s.sum(p).reshape(c.shape):s},$b:function(){var p=s.mul(c.div(f).floor().neg()),m=Fr(f.shape,o);return m.length>0?p.sum(m).reshape(f.shape):p}}})}}),iV=$({modStrict_:function(n,e){var t=U(n,"a","modStrict"),r=U(e,"b","modStrict");return fn(t.shape,r.shape,"Error in modStrict: "),t.mod(r)}}),Ii=$({mul_:function(n,e){var t,r=U(n,"a","mul"),i=U(e,"b","mul");t=$n(r,i);var o=zt((r=t[0]).shape,(i=t[1]).shape);return Q.runKernelFunc(function(s,a){var c=s.multiply(r,i);return a([r,i]),c},{a:r,b:i},function(s,a){var c=a[0],f=a[1];return{a:function(){var p=s.mul(f.toFloat()),m=Fr(c.shape,o);return m.length>0?p.sum(m).reshape(c.shape):p},b:function(){var p=s.mul(c.toFloat()),m=Fr(f.shape,o);return m.length>0?p.sum(m).reshape(f.shape):p}}},"Mul")}}),oV=$({mulStrict_:function(n,e){var t=U(n,"a","mul"),r=U(e,"b","mul");return fn(t.shape,r.shape,"Error in multiplyStrict: "),t.mul(r)}}),Zp=$({pow_:function(n,e){var t,r=U(n,"base","pow"),i=U(e,"exp","pow");t=$n(r,i);var o=zt((r=t[0]).shape,(i=t[1]).shape);return Q.runKernelFunc(function(a,c){var f=a.pow(r,i);return c([r,i,f]),f},{a:r,b:i},function(a,c){var f=c[0],p=c[1],m=c[2];return{a:function(){var y=p.toFloat(),w=a.mul(y.mul(f.pow(y.sub(Pe(1))))),E=Fr(f.shape,o);return E.length>0&&(w=w.sum(E)),w.reshape(f.shape)},b:function(){var y=f.greater(0),w=f.log().where(y,dn(f)),E=a.mul(m.mul(w)),A=Fr(p.shape,o);return A.length>0&&(E=E.sum(A)),E.reshape(p.shape)}}},"Pow",{},[r,i],[!0])}}),sV=$({powStrict_:function(n,e){return fn(n.shape,e.shape,"Error in powStrict: "),n.pow(e)}}),aV=$({squaredDifferenceStrict_:function(n,e){var t=U(n,"a","squaredDifferenceStrict"),r=U(e,"b","squaredDifferenceStrict");return fn(t.shape,r.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(r)}}),Yr=$({sub_:function(n,e){var t,r=U(n,"a","sub"),i=U(e,"b","sub");t=$n(r,i);var o=zt((r=t[0]).shape,(i=t[1]).shape);return Q.runKernelFunc(function(s){return s.subtract(r,i)},{a:r,b:i},function(s){return{a:function(){var a=s,c=Fr(r.shape,o);return c.length>0&&(a=a.sum(c)),a.reshape(r.shape)},b:function(){var a=s,c=Fr(i.shape,o);return c.length>0&&(a=a.sum(c)),a.neg().reshape(i.shape)}}},"Sub")}}),uV=$({subStrict_:function(n,e){var t=U(n,"a","subStrict"),r=U(e,"b","subStrict");return fn(t.shape,r.shape,"Error in subStrict: "),t.sub(r)}}),DD=$({equal_:function(n,e){var t,r=U(n,"a","equal"),i=U(e,"b","equal");return t=$n(r,i),zt((r=t[0]).shape,(i=t[1]).shape),Q.runKernelFunc(function(o){return o.equal(r,i)},{$a:r,$b:i})}}),cV=$({equalStrict_:function(n,e){var t=U(n,"a","equalStrict"),r=U(e,"b","equalStrict");return fn(t.shape,r.shape,"Error in equalStrict: "),t.equal(r)}}),lV=$({greater_:function(n,e){var t,r=U(n,"a","greater"),i=U(e,"b","greater");return t=$n(r,i),zt((r=t[0]).shape,(i=t[1]).shape),Q.runKernelFunc(function(o){return o.greater(r,i)},{a:r,b:i},null,"Greater")}}),TD=$({greaterEqual_:function(n,e){var t,r=U(n,"a","greaterEqual"),i=U(e,"b","greaterEqual");return t=$n(r,i),zt((r=t[0]).shape,(i=t[1]).shape),Q.runKernelFunc(function(o,s){var a=o.greaterEqual(r,i);return s([r,i]),a},{a:r,b:i},function(o,s){var a=s[0],c=s[1];return{a:function(){return dn(a)},b:function(){return dn(c)}}},"GreaterEqual")}}),fV=$({greaterEqualStrict_:function(n,e){var t=U(n,"a","greaterEqualStrict"),r=U(e,"b","greaterEqualStrict");return fn(t.shape,r.shape,"Error in greaterEqualStrict: "),t.greaterEqual(r)}}),dV=$({greaterStrict_:function(n,e){var t=U(n,"a","greaterStrict"),r=U(e,"b","greaterStrict");return fn(t.shape,r.shape,"Error in greaterStrict: "),t.greater(r)}}),hV=$({less_:function(n,e){var t,r=U(n,"a","less"),i=U(e,"b","less");return t=$n(r,i),zt((r=t[0]).shape,(i=t[1]).shape),Q.runKernelFunc(function(o){return o.less(r,i)},{a:r,b:i},null,"Less")}}),pV=$({lessEqual_:function(n,e){var t,r=U(n,"a","lessEqual"),i=U(e,"b","lessEqual");return t=$n(r,i),zt((r=t[0]).shape,(i=t[1]).shape),Q.runKernelFunc(function(o,s){var a=o.lessEqual(r,i);return s([r,i]),a},{a:r,b:i},null,"LessEqual")}}),gV=$({lessEqualStrict_:function(n,e){var t=U(n,"a","lessEqualStrict"),r=U(e,"b","lessEqualStrict");return fn(t.shape,r.shape,"Error in lessEqualStrict: "),t.lessEqual(r)}}),mV=$({lessStrict_:function(n,e){var t=U(n,"a","lessStrict"),r=U(e,"b","lessStrict");return fn(t.shape,r.shape,"Error in lessStrict: "),t.less(r)}}),vV=$({notEqual_:function(n,e){var t,r=U(n,"a","notEqual"),i=U(e,"b","notEqual");return t=$n(r,i),zt((r=t[0]).shape,(i=t[1]).shape),Q.runKernelFunc(function(o){return o.notEqual(r,i)},{a:r,b:i},null,"NotEqual")}}),yV=$({notEqualStrict_:function(n,e){var t=U(n,"a","notEqualStrict"),r=U(e,"b","notEqualStrict");return fn(t.shape,r.shape,"Error in notEqualStrict: "),t.notEqual(r)}});function SD(n,e){for(var t=[],r=n;r<e;++r)t.push(r);return t}function ND(n){for(var e=[],t=0;t<n.length;++t)for(var r=0;r<n[t].length;++r)e.push(n[t][r]);return e}var Vv=$({gather_:function(n,e,t){void 0===t&&(t=0);var r=U(n,"x","gather"),i=U(e,"indices","gather","int32");t=Mr(t,r.shape)[0];var o=function(s,a,c){for(var f=s.shape[c],p=[],m=1,y=1,w=0;w<c;w++)p.push(s.shape[w]),m*=s.shape[w];for(w=0;w<a.rank;w++)p.push(a.shape[w]);for(w=c+1;w<s.rank;w++)p.push(s.shape[w]),y*=s.shape[w];return{batchSize:m,sliceSize:y,dimSize:f,outputShape:p}}(r,i,t);return Q.runKernelFunc(function(s,a){var c=s.gather(r,i.flatten(),t);return a([i]),c},{x:r,indices:i},function(s,a){var c=a[0];return{x:function(){var f=r.shape,p=c.size,m=f.slice(0,t),y=m.length,w=f.slice(t,f.length).slice(1),E=w.length,A=SD(0,y),_=SD(y+1,y+1+E),T=ND([m,[p],w]),N=s.reshape(T),M=c.reshape([p]),R=ND([[y],A,_]),P=N.transpose(R),B=RD(P,M,r.shape[t]),Y=Rp(R);return B.transpose(Y)},indices:function(){return c}}},"Gather",{axis:t}).reshape(o.outputShape)}}),RD=$({unsortedSegmentSum_:function(n,e,t){var r=U(n,"x","unsortedSegmentSum"),i=U(e,"segmentIds","unsortedSegmentSum","int32");return H(ir(t),function(){return"numSegments must be of dtype int"}),Q.runKernelFunc(function(o,s){var a=o.unsortedSegmentSum(r,i,t);return s([i]),a},{$x:r},function(o,s){var a=s[0];return{$x:function(){return function(c,f){for(var p=Bv(f,dn(f)),m=Vv(c,p),y=TD(f,Pe(0,"int32")),w=m.rank-y.rank,E=0;E<w;++E)y=Wo(y,E+1);y=$p(y,Tl(m.shape,"bool"));var A=dn(m);return fc(y,m,A)}(o,a)}}})}});function MD(n,e,t,r,i,o,s){void 0===o&&(o="NHWC"),H(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var a=n,c=e,f=!1;3===e.rank&&(f=!0,c=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),a=[1,n[0],n[1],n[2]]),H(4===a.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+a.length+"."}),H(4===c.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+c.rank}),H(4===t.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank});var p="NHWC"===o?a[3]:a[1],m="NHWC"===o?c.shape[3]:c.shape[1];H(p===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+p+") must match input depth for filter "+t.shape[2]+"."}),H(m===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+m+") must match output depth for filter "+t.shape[3]+"."}),null!=s&&H(ir(i),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."});var y=Wp(o),w=Cu(a,t.shape,r,1,i,s,!1,y),E=Q.runKernelFunc(function(A,_){var T=A.conv2dDerInput(c,t,w);return _([t,c]),T},{dy4D:c,filter:t},function(A,_){var T=_[0],N=_[1];return{dy4D:function(){return Ho(A,T,r,i,o,1,s)},filter:function(){return jv(A,N,T.shape,r,i,o,s)}}});return f?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}function Uv(n){var o,e="number"==typeof(o=n)?[o,o,o]:2===o.length?[o[0],o[1],1]:o;return 1===e[0]&&1===e[1]&&1===e[2]}function OD(n,e,t,r,i){H(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var o=n,s=e,a=!1;4===e.rank&&(a=!0,s=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),o=[1,n[0],n[1],n[2],n[3]]);var c=o[4],f=s.shape[4];H(5===o.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."}),H(5===s.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+s.rank}),H(5===t.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank}),H(c===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+c+") must match input depth for filter "+t.shape[3]+"."}),H(f===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+f+") must match output depth for filter "+t.shape[4]+"."});var p=_d(o,t.shape,r,1,i),m=Q.runKernelFunc(function(y){return y.conv3dDerInput(s,t,p)},{dy5D:s});return a?m.as4D(m.shape[1],m.shape[2],m.shape[3],m.shape[4]):m}var wV=$({conv1d_:function(n,e,t,r,i,o,s){void 0===i&&(i="NWC"),void 0===o&&(o=1);var a=U(n,"x","conv1d"),c=U(e,"filter","conv1d"),f=a,p=!1;2===a.rank&&(p=!0,f=a.as3D(1,a.shape[0],a.shape[1])),H(3===f.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+f.rank+"."}),H(3===c.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+c.rank+"."}),null!=s&&H(ir(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."}),H(f.shape[2]===c.shape[1],function(){return"Error in conv1d: depth of input ("+f.shape[2]+") must match input depth for filter "+c.shape[1]+"."}),H(Gi(t,o),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+o+"'"}),H("NWC"===i,function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."});var m=c.as4D(1,c.shape[0],c.shape[1],c.shape[2]),y=f.as4D(f.shape[0],1,f.shape[1],f.shape[2]),w=Ho(y,m,[1,t],r,"NHWC",[1,o],s);return p?w.as2D(w.shape[2],w.shape[3]):w.as3D(w.shape[0],w.shape[2],w.shape[3])}}),Ho=$({conv2d_:function(n,e,t,r,i,o,s){void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]);var a=U(n,"x","conv2d"),c=U(e,"filter","conv2d"),f=a,p=!1;3===a.rank&&(p=!0,f=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),H(4===f.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+f.rank+"."}),H(4===c.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+c.rank+"."}),null!=s&&H(ir(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."});var m="NHWC"===i?f.shape[3]:f.shape[1];H(m===c.shape[2],function(){return"Error in conv2d: depth of input ("+m+") must match input depth for filter "+c.shape[2]+"."}),H(Gi(t,o),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"});var y=Wp(i),w=Cu(f.shape,c.shape,t,o,r,s,!1,y),A=Q.runKernelFunc(function(_,T){var N=_.conv2d(f,c,w);return T([c,f]),N},{x:f,filter:c},function(_,T){var M=T[0],R=T[1];return H(uc(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}),{x:function(){return FD(R.shape,_,M,t,r,i)},filter:function(){return jv(R,_,M.shape,t,r,i)}}},"Conv2D",w,[c,f]);return p?A.as3D(A.shape[1],A.shape[2],A.shape[3]):A}}),bV=$({conv3d_:function(n,e,t,r,i,o){void 0===i&&(i="NDHWC"),void 0===o&&(o=[1,1,1]);var w,s=U(n,"x","conv3d"),a=U(e,"filter","conv3d"),c=s,f=!1;4===s.rank&&(f=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),H(5===c.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+c.rank+"."}),H(5===a.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+a.rank+"."}),H(c.shape[4]===a.shape[3],function(){return"Error in conv3d: depth of input ("+c.shape[4]+") must match input depth for filter "+a.shape[3]+"."}),H((w=o,Uv(t)||Uv(w)),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),H("NDHWC"===i,function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."});var p=_d(c.shape,a.shape,t,o,r),m=Q.runKernelFunc(function(y,w){var E=y.conv3d(c,a,p);return w([c,a]),E},{x:c,$filter:a},function(y,w){H(Uv(o),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"});var E=w[0],A=w[1];return{x:function(){return OD(E.shape,y,A,t,r)},$filter:function(){return function(_,T,N,M,R){var P=_;4===_.rank&&(P=_.as5D(1,_.shape[0],_.shape[1],_.shape[2],_.shape[3]));var B=T;4===B.rank&&(B=T.as5D(1,T.shape[0],T.shape[1],T.shape[2],T.shape[3])),H(5===P.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+P.shape+"."}),H(5===B.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+B.shape+"."}),H(5===N.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+N+"."}),H(P.shape[4]===N[3],function(){return"Error in conv3dDerFilter: depth of input "+P.shape[4]+") must match input depth in filter ("+N[3]+"."}),H(B.shape[4]===N[4],function(){return"Error in conv3dDerFilter: depth of dy ("+B.shape[4]+") must match output depth for filter ("+N[4]+")."});var Y=_d(P.shape,N,M,1,R);return Q.runKernelFunc(function(X){return X.conv3dDerFilter(P,B,Y)},{x5D:P,dy5D:B})}(E,y,A.shape,t,r)}}});return f?m.as4D(m.shape[1],m.shape[2],m.shape[3],m.shape[4]):m}}),jv=$({conv2dDerFilter_:function(n,e,t,r,i,o,s){void 0===o&&(o="NHWC");var a=n;3===n.rank&&(a=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var c=e;3===c.rank&&(c=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),H(4===a.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+a.shape+"."}),H(4===c.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+c.shape+"."}),H(4===t.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."});var f="NHWC"===o?a.shape[3]:a.shape[1],p="NHWC"===o?c.shape[3]:c.shape[1];H(f===t[2],function(){return"Error in conv2dDerFilter: depth of input "+f+") must match input depth in filter ("+t[2]+"."}),H(p===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+p+") must match output depth for filter ("+t[3]+")."}),null!=s&&H(ir(i),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."});var m=Wp(o),y=Cu(a.shape,t,r,1,i,s,!1,m);return Q.runKernelFunc(function(w){return w.conv2dDerFilter(a,c,y)},{x4D:a,dy4D:c})}}),FD=$({conv2dDerInput_:MD}),Jp=$({depthwiseConv2d_:function(n,e,t,r,i,o,s){void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]);var a=U(n,"x","depthwiseConv2d"),c=U(e,"filter","depthwiseConv2d"),f=a,p=!1;3===a.rank&&(p=!0,f=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),H(4===f.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+f.rank+"."}),H(4===c.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+c.rank+"."}),H(f.shape[3]===c.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+f.shape[3]+") must match the inChannels dimension in filter "+c.shape[2]+"."}),null==o&&(o=[1,1]),H(Gi(t,o),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),null!=s&&H(ir(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."});var m=Cu(f.shape,c.shape,t,o,r,s,!0),w=Q.runKernelFunc(function(E,A){var _=E.depthwiseConv2D(f,c,m);return A([f,c]),_},{x:f,filter:c},function(E,A){H(uc(o),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"});var _=A[0],T=A[1];return{x:function(){return PD(_.shape,E,T,m)},filter:function(){return kD(_,E,T.shape,m)}}},"DepthwiseConv2dNative",m,[f,c]);return p?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}}),PD=$({depthwiseConv2dDerInput_:function(n,e,t,r){var i=e,o=!1;3===e.rank&&(o=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var s=Q.runKernelFunc(function(a){return a.depthwiseConv2DDerInput(i,t,r)},{dy4D:i});return o?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),kD=$({depthwiseConv2dDerFilter_:function(n,e,t,r){var i=n;3===n.rank&&(i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var o=e;return 3===o.rank&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),Q.runKernelFunc(function(s){return s.depthwiseConv2DDerFilter(i,o,r)},{x4D:i,dy4D:o})}}),Wv=$({separableConv2d_:function(n,e,t,r,i,o,s){void 0===o&&(o=[1,1]),void 0===s&&(s="NHWC");var a=U(n,"x","separableConv2d"),c=U(e,"depthwiseFilter","separableConv2d"),f=U(t,"pointwiseFilter","separableConv2d"),p=a,m=!1;if(3===a.rank&&(m=!0,p=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),"NCHW"===s)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");H(4===p.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+p.rank+"."}),H(4===c.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+c.rank+"."}),H(4===f.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+c.rank+"."}),H(1===f.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+f.shape[0]+"."}),H(1===f.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+f.shape[1]+"."});var y=c.shape[2],w=c.shape[3];H(f.shape[2]===y*w,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+y*w+", but got "+f.shape[2]+"."});var E=Jp(p,c,r,i,s,o),A=Ho(E,f,1,"valid",s);return m?A.as3D(A.shape[1],A.shape[2],A.shape[3]):A}}),CV=$({conv2dTranspose_:function(n,e,t,r,i,o){return MD(t,U(n,"x","conv2dTranspose"),U(e,"filter","conv2dTranspose"),r,i,"NHWC",o)}}),EV=$({conv3dTranspose_:function(n,e,t,r,i){return OD(t,U(n,"x","conv3dTranspose"),U(e,"filter","conv3dTranspose"),r,i)}}),e0=$({matMul_:function(n,e,t,r){var i;void 0===t&&(t=!1),void 0===r&&(r=!1);var o=U(n,"a","matMul"),s=U(e,"b","matMul");i=$n(o,s),o=i[0],s=i[1];var a=t?o.shape[o.rank-2]:o.shape[o.rank-1],c=r?s.shape[s.rank-1]:s.shape[s.rank-2],f=t?o.shape[o.rank-1]:o.shape[o.rank-2],p=r?s.shape[s.rank-2]:s.shape[s.rank-1],m=o.shape.slice(0,-2),y=s.shape.slice(0,-2),w=$e(m),E=$e(y);H(o.rank>=2&&s.rank>=2&&o.rank===s.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+s.rank+"."}),H(Rr(m,y),function(){return"Error in matMul: outer dimensions ("+m+") and ("+y+") of Tensors with shapes "+o.shape+" and "+s.shape+" must match."}),H(a===c,function(){return"Error in matMul: inner shapes ("+a+") and ("+c+") of Tensors with shapes "+o.shape+" and "+s.shape+" and transposeA="+t+" and transposeB="+r+" must match."});var A=o.shape.slice(0,-2).concat([f,p]),_=t?o.as3D(w,a,f):o.as3D(w,f,a),T=r?s.as3D(E,p,c):s.as3D(E,c,p);return Q.runKernelFunc(function(M,R){var P=M.batchMatMul(_,T,t,r);return R([_,T]),P},{a:_,b:T},function(M,R){var B=R[0],Y=R[1];return t||r?!t&&r?{a:function(){return M.matMul(Y,!1,!1)},b:function(){return M.matMul(B,!0,!1)}}:t&&!r?{a:function(){return Y.matMul(M,!1,!0)},b:function(){return B.matMul(M,!1,!1)}}:{a:function(){return Y.matMul(M,!0,!0)},b:function(){return M.matMul(B,!0,!0)}}:{a:function(){return M.matMul(Y,!1,!0)},b:function(){return B.matMul(M,!0,!1)}}},"BatchMatMul",{transposeA:t,transposeB:r}).reshape(A)}}),_V=$({dot_:function(n,e){var t=U(n,"t1","dot"),r=U(e,"t2","dot");H(!(1!==t.rank&&2!==t.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+r.rank+"."});var i=1===t.rank?t.size:t.shape[1],o=1===r.rank?r.size:r.shape[0];return H(i===o,function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."}),1===t.rank&&1===r.rank?t.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===t.rank&&2===r.rank?t.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===t.rank&&1===r.rank?t.matMul(r.as2D(-1,1)).as1D():t.matMul(r.as2D(r.shape[0],r.shape[1]))}}),IV=$({outerProduct_:function(n,e){var t=U(n,"v1","outerProduct"),r=U(e,"v2","outerProduct");return H(1===t.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+r.rank+"."}),t.as2D(-1,1).matMul(r.as2D(1,-1))}}),Nd=$({reverse_:function(n,e){var t=U(n,"x","reverse");if(0===t.rank)return t.clone();var r=Mr(e,t.shape);return Q.runKernelFunc(function(i){return i.reverse(t,r)},{$x:t},function(i){return{$x:function(){return i.reverse(r)}}}).reshapeAs(t)}}),AV=$({reverse1d_:function(n){var e=U(n,"x","reverse");return H(1===e.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),Nd(e,0)}}),DV=$({reverse2d_:function(n,e){var t=U(n,"x","reverse");return H(2===t.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),Nd(t,e)}}),TV=$({reverse3d_:function(n,e){var t=U(n,"x","reverse");return H(3===t.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),Nd(t,e)}}),SV=$({reverse4d_:function(n,e){var t=U(n,"x","reverse");return H(4===t.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),Nd(t,e)}});function LD(n,e,t,r,i,o){var s=U(n,"x","maxPool"),a=s,c=!1;3===s.rank&&(c=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),null==r&&(r=[1,1]),H(4===a.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+a.rank+"."}),H(Gi(t,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"}),null!=o&&H(ir(i),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var f=Nl(a.shape,e,t,r,i,o);if(1===f.filterWidth&&1===f.filterHeight&&Rr(f.inShape,f.outShape))return s.clone();var m=Q.runKernelFunc(function(y,w){var E=y.maxPool(a,f);return w([a,E]),E},{x:a},function(y,w){var E=w[0],A=w[1];return{x:function(){return function(_,T,N,M,R,P,B,Y){var X=U(_,"dy","maxPoolBackprop"),z=U(T,"input","maxPoolBackprop"),G=U(N,"output","maxPoolBackprop");H(z.rank===X.rank,function(){return"Rank of input ("+z.rank+") does not match rank of dy ("+X.rank+")"}),null==P&&(P=[1,1]),H(Gi(R,P),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+R+" and dilations '"+P+"'"}),H(4===X.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+X.rank+"."}),H(4===z.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+z.rank+"."});var ee=Nl(z.shape,M,R,P,B,void 0);return Q.runKernelFunc(function(J){return J.maxPoolBackprop(X,z,G,ee)},{$dy:X,$input:z})}(y,E,A,e,t,r,i)}}},"MaxPool",f,[a]);return c?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}function BD(n,e,t,r,i,o){var s=U(n,"x","avgPool","float32");null==r&&(r=[1,1]),H(Gi(t,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"});var a=s,c=!1;3===s.rank&&(c=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),H(4===a.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+a.rank+"."}),null!=o&&H(ir(i),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var f=Nl(a.shape,e,t,r,i,o);if(1===f.filterWidth&&1===f.filterHeight&&Rr(f.inShape,f.outShape))return s.clone();var p=Q.runKernelFunc(function(m){return m.avgPool(a,f)},{x:a},function(m){return{x:function(){return function(y,w,E,A,_,T){var N=U(y,"dy","avgPoolBackprop"),M=U(w,"input","avgPoolBackprop");H(M.rank===N.rank,function(){return"Rank of input ("+M.rank+") does not match rank of dy ("+N.rank+")"}),null==_&&(_=[1,1]),H(Gi(A,_),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+A+" and dilations '"+_+"'"});var R=M,P=N,B=!1;3===M.rank&&(B=!0,R=M.as4D(1,M.shape[0],M.shape[1],M.shape[2]),P=N.as4D(1,N.shape[0],N.shape[1],N.shape[2])),H(4===P.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+P.rank+"."}),H(4===R.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+R.rank+"."});var Y=Nl(R.shape,E,A,_,T),X=Q.runKernelFunc(function(z){return z.avgPoolBackprop(P,R,Y)},{dy4D:P,input4D:R});return B?X.as3D(X.shape[1],X.shape[2],X.shape[3]):X}(m,a,e,t,r,i)}}},"AvgPool",f);return p=p.cast(s.dtype),c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}var ri=$({maxPool_:function(n,e,t,r,i){return LD(n,e,t,1,r,i)}}),Rd=$({avgPool_:function(n,e,t,r,i){return BD(n,e,t,1,r,i)}}),NV=$({pool_:function(n,e,t,r,i,o){null==i&&(i=[1,1]),null==o&&(o=1),0===r&&(r="valid");var s=U(n,"x","maxPool"),a=s,c=!1;3===s.rank&&(c=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),H(Gi(o,i),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"});var f,P,B,Y,X,p=Nl(a.shape,e,o,i,r),m=[p.dilationHeight,p.dilationWidth];f="same"===r?(P=m,B=[p.filterHeight,p.filterWidth].map(function(z,G){return z+(z-1)*(P[G]-1)}).map(function(z){return z-1}),Y=B.map(function(z){return Math.floor(z/2)}),X=B.map(function(z,G){return z-Y[G]}),B.map(function(z,G){return[Y[G],X[G]]})):[[0,0],[0,0]];var y=1===m[0]&&1===m[1],w=function(R,P,B){var Y=B.map(function(fe){return fe[0]}),X=B.map(function(fe){return fe[1]}),z=R.concat(Y,X),G=P.map(function(fe,he){return(fe-z[he]%fe)%fe}),ee=X.map(function(fe,he){return fe+G[he]});return[P.map(function(fe,he){return[Y[he],ee[he]]}),P.map(function(fe,he){return[0,G[he]]})]}([p.inHeight,p.inWidth],m,f),A=w[1],_=y?r:"valid",T=y?a:aA(a,m,w[0]),N=("avg"===t?function(){return BD(T,e,o,1,_)}:function(){return LD(T,e,o,1,_)})(),M=y?N:iA(N,m,A);return c?M.as3D(M.shape[1],M.shape[2],M.shape[3]):M}}),RV=$({maxPool3d_:function(n,e,t,r,i,o,s){void 0===o&&(o="NDHWC");var a=U(n,"x","maxPool3d"),c=a,f=!1;4===a.rank&&(f=!0,c=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),null==s&&(s=[1,1,1]),H(5===c.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+c.rank+"."}),H("NDHWC"===o,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),H(Gi(t,s),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+s+"'"}),null!=i&&H(ir(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var p=Ed(c.shape,e,t,s,r,i,o),m=Q.runKernelFunc(function(y,w){var E=y.maxPool3d(c,p);return w([c,E]),E},{x:c},function(y,w){var E=w[0],A=w[1];return{x:function(){return function(_,T,N,M,R,P,B,Y){var X=U(_,"dy","maxPool3dBackprop"),z=U(T,"input","maxPool3dBackprop"),G=U(N,"output","maxPool3dBackprop"),ee=X,J=z,pe=G,fe=!1;4===z.rank&&(fe=!0,ee=X.as5D(1,X.shape[0],X.shape[1],X.shape[2],X.shape[3]),J=z.as5D(1,z.shape[0],z.shape[1],z.shape[2],z.shape[3]),pe=G.as5D(1,G.shape[0],G.shape[1],G.shape[2],G.shape[3])),H(5===ee.rank,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+ee.rank+"."}),H(5===J.rank,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+J.rank+"."}),H(5===pe.rank,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+pe.rank+"."}),null==P&&(P=[1,1,1]),H(Gi(R,P),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+R+" and dilations '"+P+"'"}),null!=Y&&H(ir(B),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+Y+" but got pad "+B+"."});var he=Ed(J.shape,M,R,P,B,Y),xe=Q.runKernelFunc(function(we){return we.maxPool3dBackprop(ee,J,pe,he)},{dy5D:ee,input5D:J});return fe?xe.as4D(xe.shape[1],xe.shape[2],xe.shape[3],xe.shape[4]):xe}(y,E,A,e,t,s,r,i)}}});return f?m.as4D(m.shape[1],m.shape[2],m.shape[3],m.shape[4]):m}}),MV=$({avgPool3d_:function(n,e,t,r,i,o,s){void 0===o&&(o="NDHWC");var a=U(n,"x","avgPool3d","float32"),c=a,f=!1;4===a.rank&&(f=!0,c=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),null==s&&(s=[1,1,1]),H(5===c.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+c.rank+"."}),H("NDHWC"===o,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),H(Gi(t,s),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+s+"'"}),null!=i&&H(ir(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var p=Ed(c.shape,e,t,s,r,i,o),m=Q.runKernelFunc(function(y){return y.avgPool3d(c,p)},{x:c},function(y){return{x:function(){return function(w,E,A,_,T,N,M){var R=U(w,"dy","avgPool3dBackprop"),P=U(E,"input","avgPool3dBackprop"),B=R,Y=P,X=!1;4===P.rank&&(X=!0,B=R.as5D(1,R.shape[0],R.shape[1],R.shape[2],R.shape[3]),Y=P.as5D(1,P.shape[0],P.shape[1],P.shape[2],P.shape[3])),H(5===B.rank,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+B.rank+"."}),H(5===Y.rank,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+Y.rank+"."}),null==T&&(T=[1,1,1]),H(Gi(_,T),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+_+" and dilations '"+T+"'"}),null!=M&&H(ir(N),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+M+" but got pad "+N+"."});var z=Ed(Y.shape,A,_,T,N,M),G=Q.runKernelFunc(function(ee){return ee.avgPool3dBackprop(B,Y,z)},{dy5D:B,input5D:Y});return X?G.as4D(G.shape[1],G.shape[2],G.shape[3],G.shape[4]):G}(y,c,e,t,s,r,i)}}});return m=m.cast(c.dtype),f?m.as4D(m.shape[1],m.shape[2],m.shape[3],m.shape[4]):m}}),ua=$({slice_:function(n,e,t){var r,i,o=U(n,"x","slice");if(0===o.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof e?[e].concat(new Array(o.rank-1).fill(0)):e.length<o.rank?e.concat(new Array(o.rank-e.length).fill(0)):e.slice()).forEach(function(c){H(-1!==c,function(){return"slice() does not support negative begin indexing."})}),i=(i=null==t?new Array(o.rank).fill(-1):"number"==typeof t?[t].concat(new Array(o.rank-1).fill(-1)):t.length<o.rank?t.concat(new Array(o.rank-t.length).fill(-1)):t).map(function(c,f){return c>=0?c:(H(-1===c,function(){return"Negative size values should be exactly -1 but got "+c+" for the slice() size at index "+f+"."}),o.shape[f]-r[f])}),hA(o,r,i);var s=o.shape;return Q.runKernelFunc(function(c){return c.slice(o,r,i)},{x:o},function(c){for(var f=[],p=0;p<c.rank;p++)f.push([r[p],s[p]-r[p]-i[p]]);return{x:function(){return c.pad(f)}}},"Slice",{begin:r,size:i})}}),OV=$({slice1d_:function(n,e,t){var r=U(n,"x","slice1d");return H(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),ua(r,[e],[t])}}),FV=$({slice2d_:function(n,e,t){var r=U(n,"x","slice2d");return H(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),ua(r,e,t)}}),VD=$({slice3d_:function(n,e,t){var r=U(n,"x","slice3d");return H(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),ua(r,e,t)}}),PV=$({slice4d_:function(n,e,t){var r=U(n,"x","slice4d");return H(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),ua(r,e,t)}});function UD(n,e,t,r,i){return e.rank<t.rank&&(e=e.reshape(zi(e.shape,r))),n.rank<t.rank&&(n=n.reshape(zi(n.shape,r))),{x:function(){var o=n.mul(t.equal(e).cast(n.dtype));return null==i?o:o.transpose(i)}}}var kV=$({all_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=U(n,"x","all","bool"),i=Mr(e,r.shape),o=i,s=Es(o,r.rank);null!=s&&(r=r.transpose(s),o=_s(o.length,r.rank));var a=Q.runKernelFunc(function(f){return f.all(r,o)},{$x:r});if(t){var c=zi(a.shape,i);return a.reshape(c)}return a}}),LV=$({any_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=U(n,"x","any","bool"),i=Mr(e,r.shape),o=i,s=Es(o,r.rank);null!=s&&(r=r.transpose(s),o=_s(o.length,r.rank));var a=Q.runKernelFunc(function(f){return f.any(r,o)},{$x:r});if(t){var c=zi(a.shape,i);return a.reshape(c)}return a}}),BV=$({argMax_:function(n,e){void 0===e&&(e=0);var t=U(n,"x","argMax");null==e&&(e=0);var r=Mr(e,t.shape),i=Es(r,t.rank);return null!=i&&(t=t.transpose(i),r=_s(r.length,t.rank)),Q.runKernelFunc(function(a,c){var f=a.argMax(t,r[0]);return c([t]),f},{x:t},function(a,c){var f=c[0];return{x:function(){return dn(f)}}},"ArgMax",{axis:r[0]},[t])}}),VV=$({argMin_:function(n,e){void 0===e&&(e=0);var t=U(n,"x","argMin");null==e&&(e=0);var r=Mr(e,t.shape),i=Es(r,t.rank);return null!=i&&(t=t.transpose(i),r=_s(r.length,t.rank)),Q.runKernelFunc(function(o,s){var a=o.argMin(t,r[0]);return s([t]),a},{$x:t},function(o,s){var a=s[0];return{$x:function(){return dn(a)}}})}}),UV=$({logSumExp_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=U(n,"x","logSumExp"),i=Mr(e,r.shape),o=r.max(i,!0),s=r.sub(o).exp().sum(i).log(),a=o.reshape(s.shape).add(s);if(t){var c=zi(a.shape,i);return a.reshape(c)}return a}}),t0=$({max_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=U(n,"x","max"),i=r,o=Mr(e,r.shape),s=o,a=Es(s,r.rank);null!=a&&(r=r.transpose(a),s=_s(s.length,r.rank));var f=Q.runKernelFunc(function(m,y){var w=m.max(r,s);return y([i,w]),w},{x:r},function(m,y){return UD(m,y[1],y[0],o,a)},"Max",{axes:s},[r],[!0]);if(t){var p=zi(f.shape,o);f=f.reshape(p)}return f}}),jV=$({mean_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=U(n,"x","mean"),i=Mr(e,r.shape),o=$e(ci(r.shape,i)[1]);return Vp(function(s){var a=Pe(o);return{value:(a.dtype===s.dtype?s:s.cast(a.dtype)).div(a).sum(e,t),gradFunc:function(c){var f=s.shape.slice();return i.forEach(function(p){f[p]=1}),c.reshape(f).mul(Tl(s.shape,"float32")).div(o)}}})(r)}}),WV=$({min_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=U(n,"x","min"),i=r,o=Mr(e,r.shape),s=o,a=Es(s,r.rank);null!=a&&(r=r.transpose(a),s=_s(s.length,r.rank));var f=Q.runKernelFunc(function(m,y){var w=m.min(r,s);return y([i,w]),w},{x:r},function(m,y){return UD(m,y[1],y[0],o,a)},"Min",{axes:s},[r],[!0]);if(t){var p=zi(f.shape,o);f=f.reshape(p)}return f}}),HV=$({moments_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=Mr(e,(n=U(n,"x","moments")).shape),i=n.mean(r,t),o=i.shape;t||(o=zi(i.shape,r));var s=n.toFloat().sub(i.reshape(o)).square();return{mean:i,variance:s.mean(r,t)}}}),jD=$({sum_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=U(n,"x","sum");"bool"===r.dtype&&(r=r.toInt());var i=Mr(e,r.shape);return Vp(function(o){var s=Es(i,o.rank),a=i,c=o;null!=s&&(c=o.transpose(s),a=_s(a.length,o.rank));var f=function(w){var E=o.shape.slice();return i.forEach(function(A){E[A]=1}),w.reshape(E).mul(Tl(o.shape,"float32"))},m=Q.runKernelFunc(function(w){return w.sum(c,a)},{x:c},function(w){return{x:function(){return f(w)}}},"Sum",{axes:a});if(t){var y=zi(m.shape,i);m=m.reshape(y)}return{value:m,gradFunc:f}})(r)}}),zV=$({prod_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=U(n,"x","prod");"bool"===r.dtype&&(r=r.toInt());var i=Mr(e,r.shape),o=Es(i,r.rank),s=i,a=r;null!=o&&(a=r.transpose(o),s=_s(s.length,r.rank));var c=Q.runKernelFunc(function(p){return p.prod(a,s)},{permutedX:a});if(t){var f=zi(c.shape,i);c=c.reshape(f)}return c}}),WD=$({elu_:function(n){var e=U(n,"x","elu");return Q.runKernelFunc(function(t,r){var i=t.elu(e);return r([i]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return Q.runKernelFunc(function(o){return o.eluDer(t,i)},{dy:t,y:i})}}})}}),GV=$({leakyRelu_:function(n,e){void 0===e&&(e=.2);var t=U(n,"x","leakyRelu");return Bv(Pe(e).mul(t),t)}}),HD=$({prelu_:function(n,e){var t=U(n,"x","prelu"),r=U(e,"alpha","prelu");return Q.runKernelFunc(function(i,o){var s=i.prelu(t,r);return o([t,r]),s},{x:t,alpha:r},function(i,o){var s=o[0],a=o[1],c=s.greater(0);return{x:function(){return fc(c,i,i.mul(a))},alpha:function(){var f=fc(c,dn(i),i.mul(s)),p=Fr(a.shape,i.shape);return p.length>0&&(f=f.sum(p)),f.reshape(a.shape)}}},"Prelu")}}),or=$({relu_:function(n){var e=U(n,"x","relu");return"bool"===e.dtype?e.toInt():Q.runKernelFunc(function(t,r){var i=t.relu(e);return r([e]),i},{x:e},function(t,r){var i=r[0];return{x:function(){return t.mulStrict(i.step().toFloat())}}},"Relu")}}),zD=$({relu6_:function(n){var e=U(n,"x","relu6");return"bool"===e.dtype?e.toInt():Q.runKernelFunc(function(t,r){var i=t.relu6(e);return r([e]),i},{x:e},function(t,r){var i=r[0],o=i.lessEqual(6).mul(i.step());return{x:function(){return t.mulStrict(o.toFloat())}}},"Relu6")}}),YV=$({selu_:function(n){var e=U(n,"x","selu");return Q.runKernelFunc(function(t,r){var i=t.selu(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){var o=i.greater(Pe(0)),s=Pe(1.7580993408473768),a=Pe(1.0507009873554805),c=t.mul(a),f=t.mul(s).mul(i.toFloat().exp());return fc(o,c,f)}}})}}),Eu=$({transpose_:function(n,e){var t=U(n,"x","transpose");return null==e&&(e=t.shape.map(function(i,o){return o}).reverse()),H(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."}),e.forEach(function(i){H(i>=0&&i<t.rank,function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e})}),t.rank<=1?t.clone():Q.runKernelFunc(function(i){return i.transpose(t,e)},{x:t},function(i){var o=Rp(e);return{x:function(){return i.transpose(o)}}},"Transpose",{perm:e})}}),XV=$({localResponseNormalization_:function(n,e,t,r,i){void 0===e&&(e=5),void 0===t&&(t=1),void 0===r&&(r=1),void 0===i&&(i=.5);var o=U(n,"x","localResponseNormalization");H(4===o.rank||3===o.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+o.rank+"."}),H(ir(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var s=o,a=!1;3===o.rank&&(a=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var c=Q.runKernelFunc(function(f,p){var m=f.localResponseNormalization4D(s,e,t,r,i);return p([s,m]),m},{x4D:s},function(f,p){var m=p[0],y=p[1];return{x4D:function(){return Q.runKernelFunc(function(w){return w.LRNGrad(f,m,y,e,t,r,i)},{})}}});return a?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),GD=$({norm_:function(n,e,t,r){void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===r&&(r=!1);var i=function a(c,f,p){if(void 0===p&&(p=null),0===c.rank)return c.abs();if(1!==c.rank&&null===p)return a(c.reshape([-1]),f,p);if(1===c.rank||"number"==typeof p||Array.isArray(p)&&1===p.length){if(1===f)return c.abs().sum(p);if(f===1/0)return c.abs().max(p);if(f===-1/0)return c.abs().min(p);if("euclidean"===f||2===f)return c.abs().pow(Pe(2,"int32")).sum(p).sqrt();throw new Error("Error in norm: invalid ord value: "+f)}if(Array.isArray(p)&&2===p.length){if(1===f)return c.abs().sum(p[0]).max(p[1]-1);if(f===1/0)return c.abs().sum(p[1]).max(p[0]);if(f===-1/0)return c.abs().sum(p[1]).min(p[0]);if("fro"===f||"euclidean"===f)return c.square().sum(p).sqrt();throw new Error("Error in norm: invalid ord value: "+f)}throw new Error("Error in norm: invalid axis: "+p)}(n=U(n,"x","norm"),e,t),o=i.shape;if(r){var s=Mr(t,n.shape);o=zi(i.shape,s)}return i.reshape(o)}}),qV=$({basicLSTMCell_:function(n,e,t,r,i,o){var s=U(n,"forgetBias","basicLSTMCell"),a=U(e,"lstmKernel","basicLSTMCell"),c=U(t,"lstmBias","basicLSTMCell"),f=U(r,"data","basicLSTMCell"),p=U(i,"c","basicLSTMCell"),m=U(o,"h","basicLSTMCell"),y=f.concat(m,1).matMul(a).add(c),E=y.shape[1]/4,A=[y.shape[0],E],_=y.slice([0,0],A),T=y.slice([0,E],A),N=y.slice([0,2*E],A),M=y.slice([0,3*E],A),R=_.sigmoid().mulStrict(T.tanh()).addStrict(p.mulStrict(s.add(N).sigmoid())),P=R.tanh().mulStrict(M.sigmoid());return[R,P]}}),KV=$({multiRNNCell_:function(n,e,t,r){for(var i=U(e,"data","multiRNNCell"),o=bd(t,"c","multiRNNCell"),s=bd(r,"h","multiRNNCell"),a=i,c=[],f=0;f<n.length;f++){var p=n[f](a,o[f],s[f]);c.push(p[0]),c.push(p[1]),a=p[1]}var m=[],y=[];for(f=0;f<c.length;f+=2)m.push(c[f]),y.push(c[f+1]);return[m,y]}}),QV=$({movingAverage_:function(n,e,t,r,i){void 0===i&&(i=!0);var o=U(n,"v","movingAverage"),s=U(e,"x","movingAverage"),a=U(t,"decay","movingAverage");II(o,s),H(Rr(o.shape,s.shape),function(){return"Shape mismatch in v and x"});var c=Pe(1),f=c.sub(a),p=s.sub(o).mul(f);if(i){H(null!=r,function(){return"When using zeroDebias: true, step is required."});var m=U(r,"step","movingAverage");p=p.div(c.sub(Zp(a,m)))}return o.add(p)}}),$V=$({stridedSlice_:function(n,e,t,r,i,o,s,a,c){if(void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===c&&(c=0),null==r&&(r=new Array(e.length)),0!==s)throw new Error("ellipsis mask is not yet supported");var f=U(n,"x","stridedSlice"),p=mv(a),m=f.shape.slice();p.forEach(function(_){e[_]=0,t[_]=1,m.splice(_,0,1)}),f=f.reshape(m);for(var y=0;y<f.rank;y++)e[y]=pA(i,e,r,f.shape,y),t[y]=gA(o,t,r,f.shape,y),r[y]=r[y]||1;var w=mv(c);w.forEach(function(_){t[_]=e[_]+1,r[_]=1});var E=Bp(e,t,r),A=E.filter(function(_,T){return-1===w.indexOf(T)});return r.every(function(_){return 1===_})?ua(f,e,E).reshape(A):Q.runKernelFunc(function(_){return _.stridedSlice(f,e,t,r)},{$x:f}).reshape(A)}}),ZV=$({topk_:function(n,e,t){void 0===e&&(e=1),void 0===t&&(t=!0);var r=U(n,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(e>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+e);var o=Q.runKernelFunc(function(s){return s.topk(r,e,t)},{$x:r});return{values:o[0],indices:o[1]}}}),JV=$({scatterND_:function(n,e,t){var r=U(n,"indices","scatterND","int32"),i=U(e,"updates","scatterND");return dA(i,r,t),Q.runKernelFunc(function(o){return o.scatterND(r,i,t)},{indices:r,updates:i},null,"ScatterNd",{shape:t})}}),Hv=$({fft_:function(n){H("complex64"===n.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],r=n.as2D(n.size/e,e);return Q.runKernelFunc(function(i){return i.fft(r)},{input:n}).reshape(n.shape)}}),n0=$({ifft_:function(n){H("complex64"===n.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],r=n.as2D(n.size/e,e);return Q.runKernelFunc(function(i){return i.ifft(r)},{input:n}).reshape(n.shape)}}),zv=$({rfft_:function(n,e){H("float32"===n.dtype,function(){return"The dtype for rfft() must be real value but got "+n.dtype});var t,r=n.shape[n.shape.length-1],i=n.size/r;if(null!=e&&e<r){var o=n.shape.map(function(T){return 0}),s=n.shape.map(function(T){return T});s[n.shape.length-1]=e,t=n.slice(o,s),r=e}else if(null!=e&&e>r){var a=n.shape.map(function(T){return T});a[n.shape.length-1]=e-r,t=n.concat(zn(a),n.shape.length-1),r=e}else t=n;var c=t.zerosLike(),f=li(t,c).as2D(i,r),p=Hv(f),m=Math.floor(r/2)+1,y=jo(p),w=sa(p),E=y.split([m,r-m],y.shape.length-1),A=w.split([m,r-m],w.shape.length-1),_=t.shape.slice();return _[t.shape.length-1]=m,li(E[0],A[0]).reshape(_)}}),YD=$({irfft_:function(n){var e=n.shape[n.shape.length-1],t=n.size/e;if(e<=2){var r=n.as2D(t,e),i=n0(r);return jo(i)}var o=[t,2*(e-1)],s=jo(n).as2D(t,e),a=sa(n).as2D(t,e),c=s.slice([0,1],[t,e-2]).reverse(1),f=a.slice([0,1],[t,e-2]).reverse(1).mul(Pe(-1)),p=s.concat(c,1),m=a.concat(f,1);return r=li(p,m).as2D(o[0],o[1]),i=n0(r),jo(i)}}),eU=Object.freeze({fft:Hv,ifft:n0,rfft:zv,irfft:YD}),tU=$({sparseToDense_:function(n,e,t,r){void 0===r&&(r=0);var i=U(n,"sparseIndices","sparseToDense","int32"),o=U(e,"sparseValues","sparseToDense"),s=U(r,"defaultValue","sparseToDense",o.dtype);return function(a,c,f,p){if("int32"!==a.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+a.dtype+".");if(a.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+a.shape+".");var m=a.rank>0?a.shape[0]:1,y=a.rank>1?a.shape[1]:1;if(f.length!==y)throw new Error("outputShape has incorrect number of elements:, "+f.length+", should be: "+y+".");if(0!==c.rank&&(1!==c.rank||c.size!==m))throw new Error("sparseValues has incorrect shape "+c.shape+", should be [] or ["+m+"]");if(c.dtype!==p.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,o,t,s),Q.runKernelFunc(function(a){return a.sparseToDense(i,o,t,s)},{$sparseIndices:i,$sparseValues:o,$defaultValue:s})}}),nU=$({gatherND_:function(n,e){var t=U(e,"indices","gatherND","int32"),r=U(n,"x","gatherND");return Q.runKernelFunc(function(i){return i.gatherND(r,t)},{x:r,indices:t},null,"GatherNd")}}),rU=$({diag_:function(n){var e=U(n,"x","diag").flatten(),t=n.shape.concat(n.shape);return Q.runKernelFunc(function(r){return r.diag(e)},{$x:e}).reshape(t)}}),iU=$({dropout_:function(n,e,t,r){var i=U(n,"x","dropout");if(H("float32"===i.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."}),H(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),0===e)return n instanceof Fn?i.clone():i;var o=function(c,f){if(null==f)return c.shape.slice();if(Rr(c.shape,f))return f;if(c.shape.length===f.length){for(var p=[],m=0;m<c.shape.length;m++)p.push(null==f[m]&&null!=c.shape[m]?c.shape[m]:f[m]);return p}return f}(i,t),s=1-e,a=sA(o,0,1,"float32",r).add(s).floor().div(s);return i.mul(a)}});function XD(n,e,t){for(var r=1-n%2,i=new Float32Array(n),o=0;o<n;++o){var s=2*Math.PI*o/(n+r-1);i[o]=e-t*Math.cos(s)}return Or(i,"float32")}var Ai,Gv=$({hannWindow_:function(n){return XD(n,.5,.5)}}),qD=$({hammingWindow_:function(n){return XD(n,.54,.46)}}),Yv=$({frame_:function(n,e,t,r,i){void 0===r&&(r=!1),void 0===i&&(i=0);for(var o=0,s=[];o+e<=n.size;)s.push(ua(n,o,e)),o+=t;if(r)for(;o<n.size;){var a=o+e-n.size,c=zr([ua(n,o,e-a),aa([a],i)]);s.push(c),o+=t}return 0===s.length?bu([],[0,e]):zr(s).as2D(s.length,e)}}),KD=$({stft_:function(n,e,t,r,i){void 0===i&&(i=Gv),null==r&&(r=Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2)))));for(var s=Yv(n,e,t),a=Ii(s,i(e)),c=[],f=0;f<s.shape[0];f++)c.push(zv(a.slice([f,0],[1,e]),r));return zr(c)}}),oU=Object.freeze({hannWindow:Gv,hammingWindow:qD,frame:Yv,stft:KD});!function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Ai||(Ai={}));var aU=$({absoluteDifference_:function(n,e,t,r){void 0===r&&(r=Ai.SUM_BY_NONZERO_WEIGHTS);var i=U(n,"labels","absoluteDifference"),o=U(e,"predictions","absoluteDifference"),s=null;null!=t&&(s=U(t,"weights","absoluteDifference")),fn(i.shape,o.shape,"Error in absoluteDifference: ");var a=i.sub(o).abs();return Fa(a,s,r)}}),Fa=$({computeWeightedLoss_:function(n,e,t){void 0===t&&(t=Ai.SUM_BY_NONZERO_WEIGHTS);var r=U(n,"losses","computeWeightedLoss"),i=null;null!=e&&(i=U(e,"weights","computeWeightedLoss"));var o=null==i?r:r.mul(i);if(t===Ai.NONE)return o;if(t===Ai.SUM)return o.sum();if(t===Ai.MEAN){if(null==i)return o.mean();var s=r.size/i.size,a=o.sum().div(i.sum());return s>1?a.div(Pe(s)):a}if(t===Ai.SUM_BY_NONZERO_WEIGHTS){if(null==i)return o.sum().div(Pe(r.size));var c=i.mul(Tl(r.shape)).notEqual(Pe(0)).sum().toFloat();return o.sum().div(c)}throw Error("Unknown reduction: "+t)}}),uU=$({cosineDistance_:function(n,e,t,r,i){void 0===i&&(i=Ai.SUM_BY_NONZERO_WEIGHTS);var o=U(n,"labels","cosineDistance"),s=U(e,"predictions","cosineDistance"),a=null;null!=r&&(a=U(r,"weights","cosineDistance")),fn(o.shape,s.shape,"Error in cosineDistance: ");var c=Pe(1).sub(o.mul(s).sum(t,!0));return Fa(c,a,i)}}),cU=$({hingeLoss_:function(n,e,t,r){void 0===r&&(r=Ai.SUM_BY_NONZERO_WEIGHTS);var i=U(n,"labels","hingeLoss"),o=U(e,"predictions","hingeLoss"),s=null;null!=t&&(s=U(t,"weights","hingeLoss")),fn(i.shape,o.shape,"Error in hingeLoss: ");var a=Pe(1);i=Pe(2).mul(i).sub(a);var c=a.sub(i.mul(o)).relu();return Fa(c,s,r)}}),lU=$({huberLoss_:function(n,e,t,r,i){void 0===r&&(r=1),void 0===i&&(i=Ai.SUM_BY_NONZERO_WEIGHTS);var o=U(n,"labels","huberLoss"),s=U(e,"predictions","huberLoss"),a=null;null!=t&&(a=U(t,"weights","huberLoss")),fn(o.shape,s.shape,"Error in huberLoss: ");var c=Pe(r),f=s.sub(o).abs(),p=AD(f,c),m=f.sub(p),y=Pe(.5).mul(p.square()).add(c.mul(m));return Fa(y,a,i)}}),fU=$({logLoss_:function(n,e,t,r,i){void 0===r&&(r=1e-7),void 0===i&&(i=Ai.SUM_BY_NONZERO_WEIGHTS);var o=U(n,"labels","logLoss"),s=U(e,"predictions","logLoss"),a=null;null!=t&&(a=U(t,"weights","logLoss")),fn(o.shape,s.shape,"Error in logLoss: ");var c=Pe(1),f=Pe(r),p=o.mul(s.add(f).log()).neg().sub(c.sub(o).mul(c.sub(s).add(f).log()));return Fa(p,a,i)}}),dU=$({meanSquaredError_:function(n,e,t,r){void 0===r&&(r=Ai.SUM_BY_NONZERO_WEIGHTS);var i=U(n,"labels","meanSquaredError"),o=U(e,"predictions","meanSquaredError"),s=null;null!=t&&(s=U(t,"weights","meanSquaredError")),fn(i.shape,o.shape,"Error in meanSquaredError: ");var a=i.squaredDifference(o);return Fa(a,s,r)}}),hU=$({sigmoidCrossEntropy_:function(n,e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=Ai.SUM_BY_NONZERO_WEIGHTS);var o=U(n,"multiClassLabels","sigmoidCrossEntropy"),s=U(e,"logits","sigmoidCrossEntropy"),a=null;if(null!=t&&(a=U(t,"weights","sigmoidCrossEntropy")),fn(o.shape,s.shape,"Error in sigmoidCrossEntropy: "),r>0){var c=Pe(r),f=Pe(1),p=Pe(.5);o=o.mul(f.sub(c)).add(p.mul(c))}var m=function(y,w){var E=U(y,"labels","sigmoidCrossEntropyWithLogits"),A=U(w,"logits","sigmoidCrossEntropyWithLogits");fn(E.shape,A.shape,"Error in sigmoidCrossEntropyWithLogits: ");var _=A.relu(),T=A.mul(E),N=A.abs().neg().exp().log1p();return _.sub(T).add(N)}(o,s);return Fa(m,a,i)}}),pU=$({softmaxCrossEntropy_:function(n,e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=Ai.SUM_BY_NONZERO_WEIGHTS);var o=U(n,"onehotLabels","softmaxCrossEntropy"),s=U(e,"logits","softmaxCrossEntropy"),a=null;if(null!=t&&(a=U(t,"weights","softmaxCrossEntropy")),fn(o.shape,s.shape,"Error in softmaxCrossEntropy: "),r>0){var c=Pe(r),f=Pe(1),p=Pe(o.shape[1]);o=o.mul(f.sub(c)).add(c.div(p))}var m=function(y,w,E){if(void 0===E&&(E=-1),-1===E&&(E=w.rank-1),E!==w.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+w.rank+" and dim was "+E);return Vp(function(A,_,T){var N=_.logSumExp([E],!0),M=_.toFloat().sub(N);return T([A,M]),{value:M.mul(A).neg().sum([E]),gradFunc:function(R,P){var B=P[0],Y=P[1],X=zi(R.shape,[E]);return[R.reshape(X).mul(B.toFloat().sub(Y.exp())),R.reshape(X).mul(Y.exp().sub(B.toFloat()))]}}})(y,w)}(o,s);return Fa(m,a,i)}}),gU=Object.freeze({get Reduction(){return Ai},absoluteDifference:aU,computeWeightedLoss:Fa,cosineDistance:uU,hingeLoss:cU,huberLoss:lU,logLoss:fU,meanSquaredError:dU,sigmoidCrossEntropy:hU,softmaxCrossEntropy:pU});function QD(n,e){return void 0===e&&(e=!1),Q.tidy(function(){if(2!==n.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var t=n.shape[0],r=n.shape[1],i=oA(t),o=n.clone(),s=bu([[1]],[1,1]),a=s.clone(),c=t>=r?r:t,f=function(m){var y,w=o,E=a,A=i;y=Q.tidy(function(){var _=o.slice([m,m],[t-m,1]),T=_.norm(),N=o.slice([m,m],[1,1]),M=bu([[-1]]).where(N.greater(0),bu([[1]])),R=N.sub(M.mul(T)),P=_.div(R);a=1===P.shape[0]?s.clone():s.concat(P.slice([1,0],[P.shape[0]-1,P.shape[1]]),0);var B=M.matMul(R).div(T).neg(),Y=o.slice([m,0],[t-m,r]),X=B.mul(a);if(0===m)o=Y.sub(X.matMul(a.transpose().matMul(Y)));else{var z=Y.sub(X.matMul(a.transpose().matMul(Y)));o=o.slice([0,0],[m,r]).concat(z,0)}var G=i.slice([0,m],[t,i.shape[1]-m]);if(0===m)i=G.sub(G.matMul(a).matMul(X.transpose()));else{var ee=G.sub(G.matMul(a).matMul(X.transpose()));i=i.slice([0,0],[t,m]).concat(ee,1)}return[a,o,i]}),a=y[0],o=y[1],i=y[2],to([w,E,A])},p=0;p<c;++p)f(p);return!e&&t>r&&(i=i.slice([0,0],[t,r]),o=o.slice([0,0],[r,r])),[i,o]})}var mU=$({bandPart_:function(n,e,t){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(t%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+t+".");var r=U(n,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var i=r.shape,o=r.shape.slice(-2),s=o[0],a=o[1];if(!(e<=s))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+s+").");if(!(t<=a))throw new Error("bandPart(): numUpper ("+t+") must not be greater than the number of columns ("+a+").");e<0&&(e=s),t<0&&(t=a);var c=Mp(0,s,1,"int32").reshape([-1,1]),f=Mp(0,a,1,"int32"),p=Yr(c,f),m=$p(p.lessEqual(Pe(+e,"int32")),p.greaterEqual(Pe(-t,"int32"))),y=zn([s,a],r.dtype);return _o(Gr(r.reshape([-1,s,a])).map(function(w){return fc(m,w,y)})).reshape(i)}}),vU=$({gramSchmidt_:function(n){var e;if(Array.isArray(n)){e=!1,H(null!=n&&n.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=n[0].shape[0],r=function(c){H(n[c].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[c].shape[0]+" vs. "+t+")"})},i=1;i<n.length;++i)r(i)}else e=!0,n=fv(n,n.shape[0],0).map(function(c){return uA(c,[0])});H(n.length<=n[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."});var o=[],s=n,a=function(c){o.push(Q.tidy(function(){var f=s[c];if(c>0)for(var p=0;p<c;++p){var m=jD(o[p].mulStrict(f)).mul(o[p]);f=f.sub(m)}return f.div(GD(f,"euclidean"))}))};for(i=0;i<n.length;++i)a(i);return e?_o(o,0):o}}),yU=$({qr_:function(n,e){if(void 0===e&&(e=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(2===n.rank)return QD(n,e);var t=n.shape.slice(0,n.shape.length-2).reduce(function(s,a){return s*a}),r=Gr(n.reshape([t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),i=[],o=[];return r.forEach(function(s){var a=QD(s,e),f=a[1];i.push(a[0]),o.push(f)}),[_o(i,0).reshape(n.shape),_o(o,0).reshape(n.shape)]}}),xU=Object.freeze({bandPart:mU,gramSchmidt:vU,qr:yU});function r0(n,e,t,r,i,o){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==o&&(o=0);var s=n.shape[0];return t=Math.min(t,s),H(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),H(2===n.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"}),H(4===n.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]}),H(1===e.rank,function(){return"scores must be a 1D tensor"}),H(e.shape[0]===s,function(){return"scores has incompatible shape with boxes. Expected "+s+", but was "+e.shape[0]}),H(0<=o&&o<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+o+"'"}),{maxOutputSize:t,iouThreshold:r,scoreThreshold:i,softNmsSigma:o}}var wU=$({resizeBilinear_:function(n,e,t){void 0===t&&(t=!1);var r=U(n,"images","resizeBilinear");H(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),H(2===e.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var i=r,o=!1;3===r.rank&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=e[0],a=e[1],c=Q.runKernelFunc(function(f,p){return p([i]),f.resizeBilinear(i,s,a,t)},{x:i},function(f,p){return{x:function(){return Q.runKernelFunc(function(m){return m.resizeBilinearBackprop(f,p[0],t)},{})}}},"ResizeBilinear",{alignCorners:t,newHeight:s,newWidth:a});return o?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),bU=$({resizeNearestNeighbor_:function(n,e,t){void 0===t&&(t=!1);var r=U(n,"images","resizeNearestNeighbor");H(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),H(2===e.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),H("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var i=r,o=!1;3===r.rank&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=e[0],a=e[1],c=Q.runKernelFunc(function(f,p){return p([i]),f.resizeNearestNeighbor(i,s,a,t)},{batchImages:i},function(f,p){return{batchImages:function(){return Q.runKernelFunc(function(m){return m.resizeNearestNeighborBackprop(f,p[0],t)},{})}}});return o?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),CU=$({nonMaxSuppression_:function(n,e,t,r,i){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY);var o=U(n,"boxes","nonMaxSuppression"),s=U(e,"scores","nonMaxSuppression"),a=r0(o,s,t,r,i);return Q.runKernelFunc(function(f){return f.nonMaxSuppression(o,s,t,r,i)},{boxes:o,scores:s},null,"NonMaxSuppressionV3",{maxOutputSize:t=a.maxOutputSize,iouThreshold:r=a.iouThreshold,scoreThreshold:i=a.scoreThreshold})}}),_U=$({nonMaxSuppressionWithScore_:function(n,e,t,r,i,o){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===o&&(o=0);var s=U(n,"boxes","nonMaxSuppression"),a=U(e,"scores","nonMaxSuppression"),c=r0(s,a,t,r,i,o),f={maxOutputSize:t=c.maxOutputSize,iouThreshold:r=c.iouThreshold,scoreThreshold:i=c.scoreThreshold,softNmsSigma:o=c.softNmsSigma},p=Q.runKernel("NonMaxSuppressionV5",{boxes:s,scores:a},f);return{selectedIndices:p[0],selectedScores:p[1]}}}),AU=$({cropAndResize_:function(n,e,t,r,i,o){var s=U(n,"image","cropAndResize"),a=U(e,"boxes","cropAndResize","float32"),c=U(t,"boxInd","cropAndResize","int32");i=i||"bilinear",o=o||0;var f=a.shape[0];return H(4===s.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+s.rank+"."}),H(2===a.rank&&4===a.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+f+",4] but had shape "+a.shape+"."}),H(1===c.rank&&c.shape[0]===f,function(){return"Error in cropAndResize: boxInd must be have size ["+f+"] but had shape "+a.shape+"."}),H(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),H(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),H("bilinear"===i||"nearest"===i,function(){return"method must be bilinear or nearest, but was "+i}),Q.runKernelFunc(function(p,m){return p.cropAndResize(s,a,c,r,i,o)},{images:s,boxes:a,boxInd:c},null,"CropAndResize",{method:i,extrapolationValue:o,cropSize:r})}}),Xv=Object.freeze({resizeBilinear:wU,resizeNearestNeighbor:bU,nonMaxSuppression:CU,nonMaxSuppressionAsync:function(n,e,t,r,i){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),qe(this,void 0,void 0,function(){var o,s,a,c,m;return Ke(this,function(y){switch(y.label){case 0:return o=U(n,"boxes","nonMaxSuppressionAsync"),s=U(e,"scores","nonMaxSuppressionAsync"),a=r0(o,s,t,r,i),t=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return c=y.sent(),m=_v(c[0],c[1],t,r,i),o!==n&&o.dispose(),s!==e&&s.dispose(),[2,m]}})})},nonMaxSuppressionWithScore:_U,nonMaxSuppressionWithScoreAsync:function(n,e,t,r,i,o){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===o&&(o=0),qe(this,void 0,void 0,function(){var s,a,c,f,y;return Ke(this,function(w){switch(w.label){case 0:return s=U(n,"boxes","nonMaxSuppressionAsync"),a=U(e,"scores","nonMaxSuppressionAsync"),c=r0(s,a,t,r,i,o),t=c.maxOutputSize,r=c.iouThreshold,i=c.scoreThreshold,o=c.softNmsSigma,[4,Promise.all([s.data(),a.data()])];case 1:return f=w.sent(),y=Iv(f[0],f[1],t,r,i,o),s!==n&&s.dispose(),a!==e&&a.dispose(),[2,y]}})})},cropAndResize:AU}),qv=function(n,e){return!(n>0)||"linear"===e},Kv=function(n,e,t){if(null==t||"linear"===t)return n;if("relu"===t)return n.mul(e.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},Qv=function(n,e){var t=e,r=Fr(n.shape,e.shape);return r.length>0&&(t=t.sum(r)),t.reshape(n.shape)},$v=function(n,e,t){if("linear"===e)return n;if("relu"===e)return or(n);if("elu"===e)return WD(n);if("relu6"===e)return zD(n);if("prelu"===e)return HD(n,t);throw new Error("Unknown fused activation "+e+".")},DU=$({fusedMatMul_:function(n){var e,t=n.a,r=n.b,i=n.transposeA,o=void 0!==i&&i,s=n.transposeB,a=void 0!==s&&s,c=n.bias,f=n.activation,p=void 0===f?"linear":f,m=n.preluActivationWeights;if(!1===qv(Q.state.gradientDepth,p)){var y=e0(t,r,o,a);return null!=c&&(y=Gt(y,c)),$v(y,p,m)}var w=U(t,"a","fused matMul"),E=U(r,"b","fused matMul");e=$n(w,E),w=e[0],E=e[1];var A=o?w.shape[w.rank-2]:w.shape[w.rank-1],_=a?E.shape[E.rank-1]:E.shape[E.rank-2],T=o?w.shape[w.rank-1]:w.shape[w.rank-2],N=a?E.shape[E.rank-2]:E.shape[E.rank-1],M=w.shape.slice(0,-2),R=E.shape.slice(0,-2),P=$e(M),B=$e(R);H(w.rank>=2&&E.rank>=2&&w.rank===E.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+w.rank+" and "+E.rank+"."}),H(Rr(M,R),function(){return"Error in fused matMul: outer dimensions ("+M+") and ("+R+") of Tensors with shapes "+w.shape+" and "+E.shape+" must match."}),H(A===_,function(){return"Error in fused matMul: inner shapes ("+A+") and ("+_+") of Tensors with shapes "+w.shape+" and "+E.shape+" and transposeA="+o+" and transposeB="+a+" must match."});var Y,X,z=w.shape.slice(0,-2).concat([T,N]),G=o?w.as3D(P,A,T):w.as3D(P,T,A),ee=a?E.as3D(B,N,_):E.as3D(B,_,N);null!=c&&zt(z,(Y=$n(Y=U(c,"bias","fused matMul"),w)[0]).shape),null!=m&&(X=U(m,"prelu weights","fused matMul"));var J={a:G,b:ee};return null!=c&&(J.bias=Y),null!=m&&(J.preluActivationWeights=X),Q.runKernelFunc(function(fe,he){var xe=fe.fusedBatchMatMul({a:G,b:ee,transposeA:o,transposeB:a,bias:Y,activation:p,preluActivationWeights:X});return he([G,ee,xe]),xe},J,function(fe,he){var xe=he[0],we=he[1],Ie=Kv(fe,he[2],p),De={};return null!=c&&(De={bias:function(){return Qv(Y,Ie)}}),Object.assign(o||a?!o&&a?{a:function(){return Ie.matMul(we,!1,!1)},b:function(){return Ie.matMul(xe,!0,!1)}}:o&&!a?{a:function(){return we.matMul(Ie,!1,!0)},b:function(){return xe.matMul(Ie,!1,!1)}}:{a:function(){return we.matMul(Ie,!0,!0)},b:function(){return Ie.matMul(xe,!0,!0)}}:{a:function(){return Ie.matMul(we,!1,!0)},b:function(){return xe.matMul(Ie,!0,!1)}},De)},"_FusedMatMul",{transposeA:o,transposeB:a,activation:p},[G,ee],[!0]).reshape(z)}}),TU=$({fusedConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,i=n.pad,o=n.dataFormat,s=void 0===o?"NHWC":o,a=n.dilations,c=void 0===a?[1,1]:a,f=n.dimRoundingMode,p=n.bias,m=n.activation,y=void 0===m?"linear":m,w=n.preluActivationWeights;if(!1===qv(Q.state.gradientDepth,y=y||"linear")){var E=Ho(e,t,r,i,s,c,f);return null!=p&&(E=Gt(E,p)),$v(E,y,w)}var A=U(e,"x","conv2d"),_=U(t,"filter","conv2d"),T=A,N=!1;3===A.rank&&(N=!0,T=A.as4D(1,A.shape[0],A.shape[1],A.shape[2])),H(4===T.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+T.rank+"."}),H(4===_.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+_.rank+"."}),null!=f&&H(ir(i),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+f+" but got pad "+i+"."}),H(T.shape[3]===_.shape[2],function(){return"Error in conv2d: depth of input ("+T.shape[3]+") must match input depth for filter "+_.shape[2]+"."}),H(Gi(r,c),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+c+"'"}),H("NHWC"===s,function(){return"Error in conv2d: got dataFormat of "+s+" but only NHWC is currently supported."});var M,R,P=Cu(T.shape,_.shape,r,c,i,f);null!=p&&(M=$n(M=U(p,"bias","fused conv2d"),A)[0],zt(P.outShape,M.shape)),null!=w&&(R=U(w,"prelu weights","fused conv2d"));var B={x:T,filter:_};null!=p&&(B.bias=M),null!=w&&(B.preluActivationWeights=R);var X=Q.runKernelFunc(function(z,G){var ee=z.fusedConv2d({input:T,filter:_,convInfo:P,bias:M,activation:y,preluActivationWeights:R});return G([_,T,ee]),ee},B,function(z,G){var J=G[0],pe=G[1],he=Kv(z,G[2],y);H(uc(c),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+c+"'"});var xe={};return null!=p&&(xe={bias:function(){return Qv(M,he)}}),Object.assign({x:function(){return FD(pe.shape,he,J,r,i)},filter:function(){return jv(pe,he,J.shape,r,i)}},xe)},"FusedConv2D",{convInfo:P,activation:y},[_,T],[!0]);return N?X.as3D(X.shape[1],X.shape[2],X.shape[3]):X}}),SU=$({fusedDepthwiseConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,i=n.pad,o=n.dataFormat,s=void 0===o?"NHWC":o,a=n.dilations,c=void 0===a?[1,1]:a,f=n.dimRoundingMode,p=n.bias,m=n.activation,y=void 0===m?"linear":m,w=n.preluActivationWeights;if(!1===qv(Q.state.gradientDepth,y)){var E=Jp(e,t,r,i,s,c,f);return null!=p&&(E=Gt(E,p)),$v(E,y,w)}var A=U(e,"x","depthwiseConv2d"),_=U(t,"filter","depthwiseConv2d"),T=A,N=!1;3===A.rank&&(N=!0,T=A.as4D(1,A.shape[0],A.shape[1],A.shape[2])),H(4===T.rank,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+T.rank+"."}),H(4===_.rank,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+_.rank+"."}),H(T.shape[3]===_.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+T.shape[3]+") must match the inChannels dimension in filter "+_.shape[2]+"."}),null==c&&(c=[1,1]),H(Gi(r,c),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+c+"'"}),null!=f&&H(ir(i),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+f+" but got pad "+i+"."});var M,R,P=Cu(T.shape,_.shape,r,c,i,f,!0);null!=p&&(M=$n(M=U(p,"bias","fused conv2d"),A)[0],zt(P.outShape,M.shape)),null!=w&&(R=U(w,"prelu weights","fused depthwiseConv2d"));var B={x:T,filter:_};null!=p&&(B.bias=M),null!=w&&(B.preluActivationWeights=R);var X=Q.runKernelFunc(function(z,G){var ee=z.fusedDepthwiseConv2D({input:T,filter:_,convInfo:P,bias:M,activation:y,preluActivationWeights:R});return G([_,T,ee]),ee},B,function(z,G){H(uc(c),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+c+"'"});var ee=G[0],J=G[1],fe=Kv(z,G[2],y),he={};return null!=p&&(he={bias:function(){return Qv(M,fe)}}),Object.assign({x:function(){return PD(J.shape,fe,ee,P)},filter:function(){return kD(J,fe,ee.shape,P)}},he)},"FusedDepthwiseConv2D",{convInfo:P,activation:y},[_,T],[!0]);return N?X.as3D(X.shape[1],X.shape[2],X.shape[3]):X}}),NU=Object.freeze({matMul:DU,conv2d:TU,depthwiseConv2d:SU}),RU=Object.freeze({image:Xv,linalg:xU,losses:gU,spectral:eU,fused:NU,signal:oU,square:f9,squaredDifference:mD,conv1d:wV,conv2d:Ho,conv3d:bV,depthwiseConv2d:Jp,separableConv2d:Wv,conv2dTranspose:CV,conv3dTranspose:EV,op:$,batchNormalization2d:j9,batchNormalization3d:W9,batchNormalization4d:H9,batchNormalization:z9,batchNorm:CD,batchNorm2d:G9,batchNorm3d:Y9,batchNorm4d:X9,booleanMaskAsync:function(n,e,t){return qe(this,void 0,void 0,function(){var r,i,o,s,a,c,f,p,m,y,w,E,A;return Ke(this,function(_){switch(_.label){case 0:for(r=U(n,"tensor","boolMask"),i=U(e,"mask","boolMask","bool"),o=null==t?0:t,a=r.shape,H((s=i.rank)>0,function(){return"mask cannot be scalar"}),fn(a.slice(o,o+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,f=o;f<o+s;f++)c*=a[f];return p=a.slice(0,o).concat([c],a.slice(o+s)),m=r.reshape(p),y=i.reshape([-1]),[4,_D(y)];case 1:return w=_.sent(),E=w.squeeze([1]),A=Vv(m,E,o),n!==r&&r.dispose(),e!==i&&i.dispose(),E.dispose(),m.dispose(),y.dispose(),w.dispose(),[2,A]}})})},complex:li,real:jo,imag:sa,concat:zr,concat1d:ZB,concat2d:JB,concat3d:e5,concat4d:t5,split:fv,matMul:e0,dot:_V,outerProduct:IV,reverse:Nd,reverse1d:AV,reverse2d:DV,reverse3d:TV,reverse4d:SV,maxPool:ri,avgPool:Rd,pool:NV,maxPool3d:RV,avgPool3d:MV,slice:ua,slice1d:OV,slice2d:FV,slice3d:VD,slice4d:PV,abs:d9,acos:h9,acosh:p9,asin:g9,asinh:m9,atan:v9,atanh:y9,ceil:x9,clipByValue:kv,cos:w9,cosh:b9,erf:C9,exp:Lv,expm1:E9,floor:_9,log:I9,log1p:A9,logSigmoid:D9,neg:qp,reciprocal:T9,round:S9,rsqrt:vD,sigmoid:yD,sign:N9,isNaN:R9,isInf:M9,isFinite:O9,sin:F9,sinh:P9,softplus:k9,sqrt:L9,step:B9,tan:V9,tanh:U9,all:kV,any:LV,argMax:BV,argMin:VV,logSumExp:UV,max:t0,mean:jV,min:WV,moments:HV,sum:jD,prod:zV,equal:DD,equalStrict:cV,greater:lV,greaterEqual:TD,greaterEqualStrict:fV,greaterStrict:dV,less:hV,lessEqual:pV,lessEqualStrict:gV,lessStrict:mV,notEqual:vV,notEqualStrict:yV,add:Gt,addN:Q9,addStrict:$9,atan2:Z9,div:Ds,divNoNan:J9,divStrict:eV,floorDiv:ID,maximum:Bv,maximumStrict:tV,minimum:AD,minimumStrict:nV,mod:rV,modStrict:iV,mul:Ii,mulStrict:oV,pow:Zp,powStrict:sV,squaredDifferenceStrict:aV,sub:Yr,subStrict:uV,elu:WD,leakyRelu:GV,prelu:HD,relu:or,relu6:zD,selu:YV,logicalAnd:$p,logicalNot:q9,logicalOr:ED,logicalXor:K9,where:fc,whereAsync:_D,buffer:Tt,print:function(n,e){void 0===e&&(e=!1),console.log(n.toString(e))},batchToSpaceND:iA,broadcastTo:f5,cast:d5,clone:h5,cumsum:p5,depthToSpace:g5,expandDims:Wo,eye:oA,multinomial:m5,oneHot:hv,pad:ac,pad1d:v5,pad2d:y5,pad3d:x5,pad4d:w5,rand:b5,randomNormal:C5,randomGamma:E5,randomUniform:sA,reshape:Is,spaceToBatchND:aA,squeeze:uA,stack:_o,tile:Sl,truncatedNormal:_5,unstack:Gr,setdiff1dAsync:function(n,e){return qe(this,void 0,void 0,function(){var t,r,i,o,s,a,c,f,p,m;return Ke(this,function(y){switch(y.label){case 0:return t=U(n,"x","setdiff1d"),r=U(e,"y","setdiff1d"),H(t.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+r.dtype+")."}),H(1===t.rank,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),H(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,t.data()];case 1:return i=y.sent(),[4,r.data()];case 2:for(o=y.sent(),s=new Set(o),a=0,p=0;p<i.length;p++)s.has(i[p])||a++;for(c=new dd([a],t.dtype),f=new dd([a],"int32"),p=0,m=0;p<i.length;p++)s.has(i[p])||(c.values[m]=i[p],f.values[m]=p,m++);return[2,[c.toTensor(),f.toTensor()]]}})})},fill:aa,linspace:function(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");return Q.runKernelFunc(function(r){return r.linspace(n,e,t)},{})},ones:Tl,range:Mp,scalar:Pe,tensor:fi,tensor1d:Or,tensor2d:bu,tensor3d:lv,tensor4d:ro,tensor5d:function(n,e,t){if(tc(n),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");var r=oa(n,t);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return wu(n,e,r,t)},tensor6d:function(n,e,t){if(tc(n),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");var r=oa(n,t);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return wu(n,e=e||r,r,t)},variable:function(n,e,t,r){return void 0===e&&(e=!0),Q.makeVariable(n,e,t,r)},zeros:zn,onesLike:rA,zerosLike:dn,transpose:Eu,softmax:Ra,logSoftmax:D5,localResponseNormalization:XV,norm:GD,gather:Vv,unsortedSegmentSum:RD,basicLSTMCell:qV,multiRNNCell:KV,movingAverage:QV,stridedSlice:$V,topk:ZV,scatterND:JV,fft:Hv,ifft:n0,rfft:zv,irfft:YD,sparseToDense:tU,gatherND:nU,diag:rU,dropout:iU,hannWindow:Gv,hammingWindow:qD,frame:Yv,stft:KD,inTopKAsync:function(n,e,t){return void 0===t&&(t=1),qe(this,void 0,void 0,function(){var r,i,o,s,a,c,f,p,m,y,w,E,A,_;return Ke(this,function(T){switch(T.label){case 0:return r=U(n,"predictions","inTopK"),i=U(e,"targets","inTopK"),H(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),H(r.rank-1===i.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank}),fn(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=r.shape[r.shape.length-1],H(t>0&&t<=o,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+o+"), but got "+t}),[4,r.data()];case 1:return s=T.sent(),[4,i.data()];case 2:for(a=T.sent(),p=(c=[s.length/o,o])[1],m=_l("bool",f=c[0]),y=0;y<f;y++){for(E=s.subarray(w=y*p,w+p),A=[],_=0;_<E.length;_++)A.push({value:E[_],index:_});for(A.sort(function(N,M){return M.value-N.value}),m[y]=0,_=0;_<t;_++)if(A[_].index===a[y]){m[y]=1;break}}return n!==r&&r.dispose(),e!==i&&i.dispose(),[2,fi(m,i.shape,"bool")]}})})}});function Ce(n,e){Array.isArray(n)||(n=[n]),n.forEach(function(t){null!=t&&H("complex64"!==t.dtype,function(){return e+" does not support complex64 tensors."})})}function Zv(n,e,t,r){if("linear"===t)return n.linear(e);if("relu"===t)return n.relu(e);if("elu"===t)return n.elu(e);if("relu6"===t)return n.relu6(e);if("prelu"===t)return n.prelu(e,r);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var MU=function(n){function e(){var t=n.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new mA(t,Q),t}return ws(e,n),e.prototype.write=function(t,r,i){this.firstUse&&(this.firstUse=!1,le().get("IS_NODE")&&Np("\n============================\nHi there \u{1f44b}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var o={};return this.data.set(o,{values:t,dtype:i}),o},e.prototype.move=function(t,r,i,o){this.data.set(t,{values:r,dtype:o})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return qe(this,void 0,void 0,function(){return Ke(this,function(r){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var r=this.data.get(t),o=r.complexTensors;return"complex64"===r.dtype?Ev(this.readSync(o.real.dataId),this.readSync(o.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var r=this.readSync(t.dataId),i=r;if("string"===t.dtype)try{i=r.map(function(o){return ud(o)})}catch(o){throw new Error("Failed to decode encoded string bytes into utf-8")}return Tt(t.shape,t.dtype,i)},e.prototype.makeOutput=function(t,r,i){var o=this.write(t,r,i);return Q.makeTensorFromDataId(o,r,i,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var r=this.data.get(t).complexTensors;null!=r&&(r.real.dispose(),r.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return qe(this,void 0,void 0,function(){var r;return Ke(this,function(i){return r=Cs(),t(),[2,{kernelMs:Cs()-r}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,r){var i=this.makeOutput(null,t.shape,"complex64");return this.data.get(i.dataId).complexTensors={real:Q.keep(t.clone()),imag:Q.keep(r.clone())},i},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,i){if(Ce(t,"slice"),vv(t.shape,r,i)){var o=yv(r,t.strides),s=$e(i);return fi(this.readSync(t.dataId).subarray(o,o+s),i,t.dtype)}for(var a=Tt(i,t.dtype),c=this.bufferSync(t),f=0;f<a.size;++f){var p=a.indexToLoc(f).map(function(m,y){return m+r[y]});a.values[f]=c.get.apply(c,p)}return a.toTensor()},e.prototype.stridedSlice=function(t,r,i,o){Ce(t,"stridedSlice");var s=Bp(r,i,o);if(s.some(function(w){return 0===w}))return fi([],s);for(var a=Tt(s,t.dtype),c=this.bufferSync(t),f=0;f<a.size;f++){for(var p=a.indexToLoc(f),m=new Array(p.length),y=0;y<m.length;y++)m[y]=p[y]*o[y]+r[y];a.set.apply(a,[c.get.apply(c,m)].concat(p))}return a.toTensor()},e.prototype.diag=function(t){for(var r=this.readSync(t.dataId),i=Tt([t.size,t.size],t.dtype),o=i.values,s=0;s<r.length;s++)o[s*t.size+s]=r[s];return i.toTensor()},e.prototype.unstack=function(t,r){for(var i=t.shape[r],o=new Array(t.rank-1),s=0,a=0;a<t.rank;a++)a!==r&&(o[s++]=t.shape[a]);var c=new Array(t.rank).fill(0),f=t.shape.slice();f[r]=1;var p=new Array(i);for(a=0;a<p.length;a++)c[r]=a,p[a]=this.slice(t,c,f).reshape(o);return p},e.prototype.reverse=function(t,r){Ce(t,"reverse");for(var i=Tt(t.shape,t.dtype),o=this.bufferSync(t),s=function(c){var f=i.indexToLoc(c),p=f.slice();r.forEach(function(m){return p[m]=t.shape[m]-1-p[m]}),i.set.apply(i,[o.get.apply(o,p)].concat(f))},a=0;a<i.size;a++)s(a);return i.toTensor()},e.prototype.concat=function(t,r){var i=this;if("complex64"===t[0].dtype){var o=t.map(function(w){return jo(w)}),s=t.map(function(w){return sa(w)});return li(this.concat(o,r),this.concat(s,r))}var a=t.map(function(w){var E=$e(w.shape.slice(r));return w.as2D(-1,E)}),c=ic(a.map(function(w){return w.shape}),1),f=Tt(c,t[0].dtype).values;if(1===a[0].shape[0]){var p=0;a.forEach(function(w){f.set(i.readSync(w.dataId),p),p+=w.size})}else{var m=0;a.forEach(function(w){for(var E=i.readSync(w.dataId),A=0,_=0;_<w.shape[0];++_)for(var T=_*c[1]+m,N=0;N<w.shape[1];++N)f[T+N]=E[A++];m+=w.shape[1]})}var y=ic(t.map(function(w){return w.shape}),r);return fi(f,y,t[0].dtype)},e.prototype.neg=function(t){return Ce(t,"neg"),this.multiply(Pe(-1),t)},e.prototype.add=function(t,r){return"complex64"===t.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(i,o,s,a){return{real:i+s,imag:o+a}}):this.broadcastedBinaryOp(t,r,ni(t.dtype,r.dtype),function(i,o){return i+o})},e.prototype.addN=function(t){var r=this;Ce(t,"addN");for(var i=t.map(function(p){return r.readSync(p.dataId)}),o=Tt(t[0].shape,t[0].dtype),s=o.values,a=0;a<t.length;a++)for(var c=i[a],f=0;f<s.length;f++)s[f]+=c[f];return o.toTensor()},e.prototype.softmax=function(t,r){var i=Mr([r],t.shape),o=this.max(t,i),s=zi(o.shape,i),a=this.subtract(t,o.reshape(s)),c=this.exp(a),f=this.sum(c,i).reshape(s);return this.realDivide(c,f)},e.prototype.subtract=function(t,r){return"complex64"===t.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(i,o,s,a){return{real:i-s,imag:o-a}}):this.broadcastedBinaryOp(t,r,ni(t.dtype,r.dtype),function(i,o){return i-o})},e.prototype.pow=function(t,r){return Ce([t,r],"pow"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return Math.pow(i,o)})},e.prototype.batchMatMul=function(t,r,i,o){Ce([t,r],"matMul");for(var s=i?t.shape[1]:t.shape[2],a=i?t.shape[2]:t.shape[1],c=o?r.shape[1]:r.shape[2],f=t.shape[0],p=this.readSync(t.dataId),m=this.readSync(r.dataId),y=i?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],w=y[0],E=y[1],A=y[2],_=o?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],T=_[0],N=_[1],M=_[2],R=a*c,P=Tt([f,a,c],t.dtype),B=P.values,Y=this.blockSize,X=0;X<f;X++)for(var z=0;z<a;z+=Y)for(var G=0;G<c;G+=Y)for(var ee=0;ee<s;ee+=Y)for(var J=Math.min(z+Y,a),pe=Math.min(G+Y,c),fe=Math.min(ee+Y,s),he=z;he<J;he++)for(var xe=G;xe<pe;xe++){for(var we=0,me=ee;me<fe;me++)we+=p[X*w+he*E+me*A]*m[me*T+xe*N+X*M];B[X*R+(he*c+xe)]+=we}return P.toTensor()},e.prototype.fusedBatchMatMul=function(t){var a=t.bias,c=t.activation,f=t.preluActivationWeights,p=this.batchMatMul(t.a,t.b,t.transposeA,t.transposeB);return a&&(p=this.add(p,a)),c&&(p=Zv(this,p,c,f)),p},e.prototype.multiply=function(t,r){return"complex64"===t.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(i,o,s,a){return{real:i*s-o*a,imag:i*a+o*s}}):this.broadcastedBinaryOp(t,r,ni(t.dtype,r.dtype),function(i,o){return i*o})},e.prototype.realDivide=function(t,r){return Ce([t,r],"realDivide"),this.broadcastedBinaryOp(t,r,"float32",function(i,o){return i/o})},e.prototype.floorDiv=function(t,r){return Ce([t,r],"floorDiv"),this.broadcastedBinaryOp(t,r,"int32",function(i,o){return Math.floor(i/o)})},e.prototype.sum=function(t,r){Ce(t,"sum"),no("sum",r,t.rank);for(var i=ci(t.shape,r),s=i[1],a=zn(i[0],ni(t.dtype,"int32")),c=$e(s),f=this.readSync(a.dataId),p=this.readSync(t.dataId),m=0;m<f.length;++m){for(var y=m*c,w=0,E=0;E<c;++E)w+=p[y+E];f[m]=w}return a},e.prototype.prod=function(t,r){Ce(t,"sum");for(var i=ci(t.shape,r),s=i[1],a=zn(i[0],ni(t.dtype,"int32")),c=$e(s),f=this.readSync(a.dataId),p=this.readSync(t.dataId),m=0;m<f.length;++m){for(var y=m*c,w=1,E=0;E<c;++E)w*=p[y+E];f[m]=w}return a},e.prototype.unsortedSegmentSum=function(t,r,i){Ce(t,"unsortedSegmentSum");for(var o=[],s=t.rank-r.rank,a=0;a<s;++a)r=r.expandDims(a+1);for(a=0;a<i;++a){var c=Pe(a,"int32"),f=DD(c,r).asType("float32").mul(t).sum(0);o.push(f)}return _o(o)},e.prototype.argMin=function(t,r){Ce(t,"argMin");var i=[r];no("argMin",i,t.rank);for(var o=ci(t.shape,i),a=o[1],c=zn(o[0],"int32"),f=$e(a),p=this.readSync(c.dataId),m=this.readSync(t.dataId),y=0;y<p.length;++y){for(var w=y*f,E=m[w],A=0,_=0;_<f;++_){var T=m[w+_];T<E&&(E=T,A=_)}p[y]=A}return c},e.prototype.argMax=function(t,r){Ce(t,"argMax");var i=[r];no("argMax",i,t.rank);for(var o=ci(t.shape,i),a=o[1],c=zn(o[0],"int32"),f=$e(a),p=this.readSync(c.dataId),m=this.readSync(t.dataId),y=0;y<p.length;++y){for(var w=y*f,E=m[w],A=0,_=0;_<f;++_){var T=m[w+_];T>E&&(E=T,A=_)}p[y]=A}return c},e.prototype.cumsum=function(t,r,i,o){if(Ce(t,"cumsum"),r!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+r);for(var s=ni(t.dtype,"int32"),a=zn(t.shape,s),c=this.readSync(a.dataId),f=this.readSync(t.dataId),p=t.shape[t.rank-1],m=o?function(_,T){return _+p-T-1}:function(_,T){return _+T},y=0;y<f.length;y+=p)for(var w=0;w<p;w++){var E=m(y,w);if(0===w)c[E]=i?0:f[E];else{var A=m(y,w-1);c[E]=i?f[A]+c[A]:f[E]+c[A]}}return a},e.prototype.equal=function(t,r){return Ce([t,r],"equal"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i===o?1:0})},e.prototype.notEqual=function(t,r){return Ce([t,r],"notEqual"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i!==o?1:0})},e.prototype.less=function(t,r){return Ce([t,r],"less"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i<o?1:0})},e.prototype.lessEqual=function(t,r){return Ce([t,r],"lessEqual"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i<=o?1:0})},e.prototype.greater=function(t,r){return Ce([t,r],"greater"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i>o?1:0})},e.prototype.greaterEqual=function(t,r){return Ce([t,r],"greaterEqual"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i>=o?1:0})},e.prototype.logicalNot=function(t){Ce(t,"logicalNot");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)i[o]=r[o]?0:1;return this.makeOutput(i,t.shape,"bool")},e.prototype.logicalAnd=function(t,r){return Ce([t,r],"logicalAnd"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i&&o})},e.prototype.logicalOr=function(t,r){return Ce([t,r],"logicalOr"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i||o})},e.prototype.select=function(t,r,i){Ce([t,r,i],"select");for(var o=this.readSync(t.dataId),s=this.readSync(r.dataId),a=this.readSync(i.dataId),c=zn(r.shape,ni(r.dtype,i.dtype)),f=this.readSync(c.dataId),p=0,m=0===t.rank||t.rank>1||1===r.rank?1:$e(r.shape.slice(1)),y=0;y<o.length;y++)for(var w=0;w<m;w++)f[p++]=1===o[y]?s[y]:a[y];return c},e.prototype.where=function(t){Ce([t],"where");var r=this.readSync(t.dataId);return Av(t.shape,r)},e.prototype.topk=function(t,r,i){return Ce(t,"topk"),EA(this.readSync(t.dataId),t.shape,t.dtype,r)},e.prototype.min=function(t,r){Ce(t,"min"),no("min",r,t.rank);for(var i=ci(t.shape,r),s=i[1],a=zn(i[0],t.dtype),c=$e(s),f=this.readSync(a.dataId),p=this.readSync(t.dataId),m=0;m<f.length;++m){for(var y=m*c,w=p[y],E=0;E<c;++E){var A=p[y+E];A<w&&(w=A)}f[m]=w}return a},e.prototype.minimum=function(t,r){return Ce([t,r],"minimum"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return Math.min(i,o)})},e.prototype.mod=function(t,r){return Ce([t,r],"mod"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){var s=i%o;return i<0&&o<0||i>=0&&o>=0?s:(s+o)%o})},e.prototype.max=function(t,r){Ce(t,"max"),no("max",r,t.rank);for(var i=ci(t.shape,r),s=i[1],a=zn(i[0],t.dtype),c=$e(s),f=this.readSync(a.dataId),p=this.readSync(t.dataId),m=0;m<f.length;++m){for(var y=m*c,w=p[y],E=0;E<c;++E){var A=p[y+E];A>w&&(w=A)}f[m]=w}return a},e.prototype.maximum=function(t,r){return Ce([t,r],"maximum"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return Math.max(i,o)})},e.prototype.all=function(t,r){Ce(t,"all"),no("all",r,t.rank);for(var i=ci(t.shape,r),s=i[1],a=zn(i[0],t.dtype),c=$e(s),f=this.readSync(a.dataId),p=this.readSync(t.dataId),m=0;m<f.length;++m){for(var y=m*c,w=p[y],E=0;E<c;++E)w=w&&p[y+E];f[m]=w}return a},e.prototype.any=function(t,r){Ce(t,"any"),no("any",r,t.rank);for(var i=ci(t.shape,r),s=i[1],a=zn(i[0],t.dtype),c=$e(s),f=this.readSync(a.dataId),p=this.readSync(t.dataId),m=0;m<f.length;++m){for(var y=m*c,w=p[y],E=0;E<c;++E)w=w||p[y+E];f[m]=w}return a},e.prototype.squaredDifference=function(t,r){return Ce([t,r],"squaredDifference"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){var s=i-o;return s*s})},e.prototype.ceil=function(t){Ce(t,"ceil");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.ceil(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.floor=function(t){Ce(t,"floor");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.floor(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.sign=function(t){Ce(t,"x");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=r[o]<0?-1:r[o]>0?1:0;return this.makeOutput(i,t.shape,"float32")},e.prototype.isNaN=function(t){Ce(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isNaN(r[o])&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isInf=function(t){Ce(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Math.abs(r[o])===1/0&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isFinite=function(t){Ce(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isFinite(r[o])&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.round=function(t){Ce(t,"round");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var s=Math.floor(r[o]);i[o]=r[o]-s<.5?Math.floor(r[o]):r[o]-s>.5?Math.ceil(r[o]):s%2==0?s:s+1}return this.makeOutput(i,t.shape,"float32")},e.prototype.exp=function(t){Ce(t,"exp");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.exp(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.expm1=function(t){Ce(t,"expm1");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.expm1(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.log=function(t){Ce(t,"log");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.log(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.log1p=function(t){Ce(t,"log1p");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.log1p(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.sqrt=function(t){Ce(t,"sqrt");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.sqrt(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.rsqrt=function(t){Ce(t,"rsqrt");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=1/Math.sqrt(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.reciprocal=function(t){Ce(t,"reciprocal");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=1/r[o];return this.makeOutput(i,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){Ce(t,"relu");for(var r=zn(t.shape,t.dtype),i=this.readSync(r.dataId),o=this.readSync(t.dataId),s=0;s<o.length;++s)i[s]=Math.max(0,o[s]);return r},e.prototype.relu6=function(t){Ce(t,"relu");for(var r=zn(t.shape,t.dtype),i=this.readSync(r.dataId),o=this.readSync(t.dataId),s=0;s<o.length;++s)i[s]=Math.min(Math.max(0,o[s]),6);return r},e.prototype.prelu=function(t,r){return Ce([t,r],"prelu"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return i<0?o*i:i})},e.prototype.elu=function(t){Ce(t,"elu");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o){var s=i[o];r[o]=s>=0?s:Math.exp(s)-1}return this.makeOutput(r,t.shape,"float32")},e.prototype.eluDer=function(t,r){Ce([t,r],"eluDer");for(var i=new Float32Array(r.size),o=this.readSync(r.dataId),s=this.readSync(t.dataId),a=0;a<o.length;++a){var c=o[a];i[a]=c>=1?s[a]:s[a]*(c+1)}return this.makeOutput(i,r.shape,"float32")},e.prototype.selu=function(t){Ce(t,"selu");for(var o=new Float32Array(t.size),s=this.readSync(t.dataId),a=0;a<s.length;++a){var c=s[a];o[a]=c>=0?1.0507009873554805*c:1.7580993408473768*(Math.exp(c)-1)}return this.makeOutput(o,t.shape,"float32")},e.prototype.clip=function(t,r,i){Ce(t,"clip");for(var o=new Float32Array(t.size),s=this.readSync(t.dataId),a=0;a<s.length;++a){var c=s[a];o[a]=c>i?i:c<r?r:c}return this.makeOutput(o,t.shape,"float32")},e.prototype.abs=function(t){for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.abs(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<t.size;++o)r[o]=Math.hypot(i[2*o],i[2*o+1]);return this.makeOutput(r,t.shape,"float32")},e.prototype.int=function(t){Ce(t,"int");for(var r=new Int32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=i[o];return this.makeOutput(r,t.shape,"int32")},e.prototype.sigmoid=function(t){Ce(t,"sigmoid");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=1/(1+Math.exp(-i[o]));return this.makeOutput(r,t.shape,"float32")},e.prototype.softplus=function(t){Ce(t,"softplus");for(var r=Math.log(1.1920928955078125e-7)+2,i=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s){var p,a=o[s]>-r,c=o[s]<r,f=Math.exp(o[s]);p=c?f:a?o[s]:Math.log(1+f),i[s]=p}return this.makeOutput(i,t.shape,"float32")},e.prototype.sin=function(t){Ce(t,"sin");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.sin(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cos=function(t){Ce(t,"cos");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.cos(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tan=function(t){Ce(t,"tan");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.tan(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asin=function(t){Ce(t,"asin");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.asin(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acos=function(t){Ce(t,"acos");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.acos(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan=function(t){Ce(t,"atan");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.atan(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan2=function(t,r){return Ce([t,r],"atan2"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return Math.atan2(i,o)})},e.prototype.sinh=function(t){Ce(t,"sinh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.sinh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cosh=function(t){Ce(t,"cosh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.cosh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tanh=function(t){Ce(t,"tanh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=fI(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asinh=function(t){Ce(t,"asinh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.asinh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acosh=function(t){Ce(t,"acosh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.acosh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atanh=function(t){Ce(t,"atanh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.atanh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.erf=function(t){Ce(t,"erf");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o){var s=Math.sign(i[o]),a=Math.abs(i[o]),c=1/(1+.3275911*a);r[o]=s*(1-((((1.061405429*c-1.453152027)*c+1.421413741)*c-.284496736)*c+.254829592)*c*Math.exp(-a*a))}return this.makeOutput(r,t.shape,"float32")},e.prototype.step=function(t,r){void 0===r&&(r=0),Ce(t,"step");for(var i=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s){var a=o[s];i[s]=isNaN(a)?NaN:a>0?1:r}return this.makeOutput(i,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var s=t.bias,a=t.activation,c=t.preluActivationWeights,f=this.conv2d(t.input,t.filter,t.convInfo);return s&&(f=this.add(f,s)),a&&(f=Zv(this,f,a,c)),f},e.prototype.conv2d=function(t,r,i){Ce([t,r],"conv2d");for(var o=i.filterHeight,s=i.filterWidth,a=i.dilationHeight,c=i.dilationWidth,f=i.padInfo.left,p=i.padInfo.top,m="channelsLast"===i.dataFormat,y=Tt(i.outShape,t.dtype),w=t.strides[0],E=m?t.strides[1]:t.strides[2],A=m?t.strides[2]:1,_=m?1:t.strides[1],T=y.strides[0],N=m?y.strides[1]:y.strides[2],M=m?y.strides[2]:1,R=m?1:y.strides[1],P=this.readSync(t.dataId),B=this.readSync(r.dataId),Y=y.values,X=0;X<i.batchSize;++X)for(var z=X*w,G=X*T,ee=0;ee<i.outHeight;++ee)for(var J=G+ee*N,pe=ee*i.strideHeight-p,fe=0;fe<o;fe++){var he=pe+fe*a;if(!(he<0||he>=i.inHeight))for(var xe=fe*r.strides[0],we=z+he*E,me=0;me<i.outWidth;++me)for(var Ie=J+me*M,De=me*i.strideWidth-f,je=0;je<s;je++){var rt=De+je*c;if(!(rt<0||rt>=i.inWidth))for(var lt=we+rt*A,Ut=xe+je*r.strides[1],jt=0;jt<i.inChannels;++jt){for(var $t=P[lt+jt*_],hn=0;hn<i.outChannels;++hn)Y[Ie+hn*R]+=$t*B[Ut+hn];Ut+=i.outChannels}}}return y.toTensor()},e.prototype.conv3d=function(t,r,i){for(var o=i.filterDepth,s=i.filterHeight,a=i.filterWidth,c=i.dilationDepth,f=i.dilationHeight,p=i.dilationWidth,m=i.padInfo.front,y=i.padInfo.left,w=i.padInfo.top,E=Tt(i.outShape,t.dtype),A=this.readSync(t.dataId),_=this.readSync(r.dataId),T=E.values,N=0;N<i.batchSize;++N)for(var M=N*t.strides[0],R=N*E.strides[0],P=0;P<i.outDepth;++P)for(var B=R+P*E.strides[1],Y=P*i.strideDepth-m,X=0;X<o;X++){var z=Y+X*c;if(!(z<0||z>=i.inDepth))for(var G=X*r.strides[0],ee=M+z*t.strides[1],J=0;J<i.outHeight;++J)for(var pe=B+J*E.strides[2],fe=J*i.strideHeight-w,he=0;he<s;he++){var xe=fe+he*f;if(!(xe<0||xe>=i.inHeight))for(var we=G+he*r.strides[1],me=ee+xe*t.strides[2],Ie=0;Ie<i.outWidth;++Ie)for(var De=pe+Ie*i.outChannels,je=Ie*i.strideWidth-y,rt=0;rt<a;rt++){var lt=je+rt*p;if(!(lt<0||lt>=i.inWidth))for(var jt=me+lt*i.inChannels,$t=we+rt*r.strides[2],hn=0;hn<i.inChannels;++hn){for(var tn=A[jt+hn],pn=0;pn<i.outChannels;++pn)T[De+pn]+=tn*_[$t+pn];$t+=i.outChannels}}}}return E.toTensor()},e.prototype.conv2dDerInput=function(t,r,i){Ce([t,r],"conv2dDerInput");for(var o=Tt(i.inShape,"float32"),s=o.values,a=this.readSync(t.dataId),c=this.readSync(r.dataId),f=r.strides,p=f[0],m=f[1],y=f[2],w=i.batchSize,E=i.filterHeight,A=i.filterWidth,_=i.inChannels,T=i.inHeight,N=i.inWidth,M=i.outChannels,R=i.outHeight,P=i.outWidth,B=i.strideHeight,Y=i.strideWidth,z=E-1-i.padInfo.top,G=A-1-i.padInfo.left,ee="channelsLast"===i.dataFormat,J=o.strides[0],pe=ee?o.strides[1]:o.strides[2],fe=ee?o.strides[2]:1,he=ee?1:o.strides[1],xe=t.strides[0],we=ee?t.strides[1]:t.strides[2],me=ee?t.strides[2]:1,Ie=ee?1:t.strides[1],De=0;De<w;++De)for(var je=0;je<_;++je)for(var rt=0;rt<T;++rt)for(var lt=rt-z,Ut=Math.max(0,Math.ceil(lt/B)),jt=Math.min(R,(E+lt)/B),$t=0;$t<N;++$t){for(var hn=$t-G,tn=Math.max(0,Math.ceil(hn/Y)),pn=Math.min(P,(A+hn)/Y),_r=0,nn=Ut;nn<jt;++nn)for(var Rn=nn*B-lt,xn=tn;xn<pn;++xn)for(var yr=xe*De+we*nn+me*xn,ur=p*(E-1-Rn)+m*(A-1-(xn*Y-hn))+y*je,cr=0;cr<M;++cr)_r+=a[yr+Ie*cr]*c[ur+cr];s[J*De+pe*rt+fe*$t+he*je]=_r}return o.toTensor()},e.prototype.conv3dDerInput=function(t,r,i){for(var o=Tt(i.inShape,"float32"),s=o.values,a=o.strides,c=a[0],f=a[1],p=a[2],m=a[3],y=this.readSync(t.dataId),w=t.strides,E=w[0],A=w[1],_=w[2],T=w[3],N=this.readSync(r.dataId),M=r.strides,R=M[0],P=M[1],B=M[2],Y=M[3],X=i.batchSize,z=i.filterDepth,G=i.filterHeight,ee=i.filterWidth,J=i.inChannels,pe=i.inDepth,fe=i.inHeight,he=i.inWidth,xe=i.outChannels,we=i.outDepth,me=i.outHeight,Ie=i.outWidth,De=i.strideDepth,je=i.strideHeight,rt=i.strideWidth,lt=z-1-i.padInfo.front,Ut=G-1-i.padInfo.top,jt=ee-1-i.padInfo.left,$t=0;$t<X;++$t)for(var hn=0;hn<J;++hn)for(var tn=0;tn<pe;++tn)for(var pn=tn-lt,_r=Math.max(0,Math.ceil(pn/De)),nn=Math.min(we,(z+pn)/De),Rn=0;Rn<fe;++Rn)for(var xn=Rn-Ut,yr=Math.max(0,Math.ceil(xn/je)),ur=Math.min(me,(G+xn)/je),cr=0;cr<he;++cr){for(var pa=cr-jt,ga=Math.max(0,Math.ceil(pa/rt)),To=Math.min(Ie,(ee+pa)/rt),Xl=0,Wa=_r;Wa<nn;++Wa)for(var Ru=Wa*De-pn,Ha=yr;Ha<ur;++Ha)for(var ql=Ha*je-xn,za=ga;za<To;++za)for(var ex=E*$t+A*Wa+_*Ha+T*za,Kl=R*(z-1-Ru)+P*(G-1-ql)+B*(ee-1-(za*rt-pa))+Y*hn,ma=0;ma<xe;++ma)Xl+=y[ex+ma]*N[Kl+ma];s[c*$t+f*tn+p*Rn+m*cr+hn]=Xl}return o.toTensor()},e.prototype.conv2dDerFilter=function(t,r,i){Ce([t,r],"conv2dDerFilter");for(var o=i.strideHeight,s=i.strideWidth,a=i.filterHeight,c=i.filterWidth,f="channelsLast"===i.dataFormat,p=Tt(i.filterShape,"float32"),m=i.padInfo.left,y=i.padInfo.top,w=this.bufferSync(t),E=this.bufferSync(r),A=0;A<a;++A)for(var _=Math.max(0,Math.ceil((y-A)/o)),T=Math.min(i.outHeight,(i.inHeight+y-A)/o),N=0;N<c;++N)for(var M=Math.max(0,Math.ceil((m-N)/s)),R=Math.min(i.outWidth,(i.inWidth+m-N)/s),P=0;P<i.inChannels;++P)for(var B=0;B<i.outChannels;++B){for(var Y=0,X=0;X<i.batchSize;++X)for(var z=_;z<T;++z)for(var G=A+z*o-y,ee=M;ee<R;++ee){var J=N+ee*s-m;Y+=f?w.get(X,G,J,P)*E.get(X,z,ee,B):w.get(X,P,G,J)*E.get(X,B,z,ee)}p.set(Y,A,N,P,B)}return p.toTensor()},e.prototype.conv3dDerFilter=function(t,r,i){for(var o=i.strideDepth,s=i.strideHeight,a=i.strideWidth,c=i.filterDepth,f=i.filterHeight,p=i.filterWidth,m=Tt(i.filterShape,"float32"),y=m.values,w=m.strides,E=w[0],A=w[1],_=w[2],T=w[3],N=this.readSync(r.dataId),M=r.strides,R=M[0],P=M[1],B=M[2],Y=M[3],X=this.readSync(t.dataId),z=t.strides,G=z[0],ee=z[1],J=z[2],pe=z[3],fe=i.padInfo.front,he=i.padInfo.left,xe=i.padInfo.top,we=0;we<c;++we)for(var me=Math.max(0,Math.ceil((fe-we)/o)),Ie=Math.min(i.outDepth,(i.inDepth+fe-we)/o),De=we*E,je=0;je<f;++je)for(var rt=Math.max(0,Math.ceil((xe-je)/s)),lt=Math.min(i.outHeight,(i.inHeight+xe-je)/s),Ut=je*A+De,jt=0;jt<p;++jt)for(var $t=Math.max(0,Math.ceil((he-jt)/a)),hn=Math.min(i.outWidth,(i.inWidth+he-jt)/a),tn=jt*_+Ut,pn=0;pn<i.inChannels;++pn)for(var _r=pn*T+tn,nn=0;nn<i.outChannels;++nn){for(var Rn=0,xn=0;xn<i.batchSize;++xn)for(var yr=xn*G,ur=xn*R,cr=me;cr<Ie;++cr)for(var pa=(we+cr*o-fe)*ee+yr,ga=cr*P+ur,To=rt;To<lt;++To)for(var Xl=(je+To*s-xe)*J+pa,Wa=To*B+ga,Ru=$t;Ru<hn;++Ru)Rn+=X[(jt+Ru*a-he)*pe+Xl+pn]*N[Ru*Y+Wa+nn];y[_r+nn]=Rn}return m.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var s=t.bias,a=t.activation,c=t.preluActivationWeights,f=this.depthwiseConv2D(t.input,t.filter,t.convInfo);return s&&(f=this.add(f,s)),a&&(f=Zv(this,f,a,c)),f},e.prototype.depthwiseConv2D=function(t,r,i){Ce([t,r],"depthwiseConv2D");for(var o=i.filterHeight,s=i.filterWidth,a=i.dilationHeight,c=i.dilationWidth,f=i.padInfo.left,p=i.padInfo.top,m=i.outChannels/i.inChannels,y=Tt(i.outShape,t.dtype),w=this.readSync(t.dataId),E=this.readSync(r.dataId),A=y.values,_=0;_<i.batchSize;++_)for(var T=_*t.strides[0],N=_*y.strides[0],M=0;M<i.outHeight;++M)for(var R=N+M*y.strides[1],P=M*i.strideHeight-f,B=0;B<o;++B){var Y=P+B*a;if(!(Y<0||Y>=i.inHeight))for(var X=B*r.strides[0],z=T+Y*t.strides[1],G=0;G<i.outWidth;++G)for(var ee=R+G*y.strides[2],J=G*i.strideWidth-p,pe=0;pe<s;++pe){var fe=J+pe*c;if(!(fe<0||fe>=i.inWidth))for(var xe=z+fe*i.inChannels,we=ee,me=X+pe*r.strides[1],Ie=0;Ie<i.inChannels;++Ie){for(var De=w[xe+Ie],je=0;je<m;++je)A[we+je]+=De*E[me+je];we+=m,me+=m}}}return y.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,r,i){Ce([t,r],"depthwiseConv2DDerInput");for(var o=Tt(i.inShape,"float32"),s=o.values,a=o.strides,c=a[0],f=a[1],p=a[2],m=this.readSync(t.dataId),y=t.strides,w=y[0],E=y[1],A=y[2],_=this.readSync(r.dataId),T=r.strides,N=T[0],M=T[1],R=T[2],P=i.batchSize,B=i.filterHeight,Y=i.filterWidth,X=i.inChannels,z=i.inHeight,G=i.inWidth,J=i.outHeight,pe=i.outWidth,fe=i.strideHeight,he=i.strideWidth,xe=B-1-i.padInfo.top,we=Y-1-i.padInfo.left,me=i.outChannels/X,Ie=0;Ie<P;++Ie)for(var De=0;De<X;++De)for(var je=0;je<z;++je)for(var rt=je-xe,lt=Math.max(0,Math.ceil(rt/fe)),Ut=Math.min(J,(B+rt)/fe),jt=0;jt<G;++jt){for(var $t=jt-we,hn=Math.max(0,Math.ceil($t/he)),tn=Math.min(pe,(Y+$t)/he),pn=0,_r=lt;_r<Ut;++_r)for(var nn=_r*fe-rt,Rn=hn;Rn<tn;++Rn)for(var xn=w*Ie+E*_r+A*Rn,yr=N*(B-1-nn)+M*(Y-1-(Rn*he-$t))+R*De,ur=0;ur<me;++ur)pn+=m[xn+(De*me+ur)]*_[yr+ur];s[c*Ie+f*je+p*jt+De]=pn}return o.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,r,i){Ce([t,r],"depthwiseConv2DDerFilter");for(var o=i.strideHeight,s=i.strideWidth,a=i.filterHeight,c=i.filterWidth,f=Tt(i.filterShape,"float32"),p=i.padInfo.left,m=i.padInfo.top,y=i.outChannels/i.inChannels,w=this.bufferSync(t),E=this.bufferSync(r),A=0;A<a;++A)for(var _=Math.max(0,Math.ceil((m-A)/o)),T=Math.min(i.outHeight,(i.inHeight+m-A)/o),N=0;N<c;++N)for(var M=Math.max(0,Math.ceil((p-N)/s)),R=Math.min(i.outWidth,(i.inWidth+p-N)/s),P=0;P<i.outChannels;++P){for(var B=Math.trunc(P/y),Y=P%y,X=0,z=0;z<i.batchSize;++z)for(var G=_;G<T;++G)for(var ee=A+G*o-m,J=M;J<R;++J)X+=w.get(z,ee,N+J*s-p,B)*E.get(z,G,J,P);f.set(X,A,N,B,Y)}return f.toTensor()},e.prototype.tile=function(t,r){return Ce(t,"tile"),CA(this.bufferSync(t),r)},e.prototype.pad=function(t,r,i){Ce(t,"pad");var o=r.map(function(y,w){return y[0]+t.shape[w]+y[1]}),s=r.map(function(y){return y[0]}),a=this.bufferSync(t),c=Tt(o,t.dtype);0!==i&&c.values.fill(i);for(var f=0;f<t.size;f++){var p=a.indexToLoc(f),m=p.map(function(y,w){return y+s[w]});c.set.apply(c,[a.get.apply(a,p)].concat(m))}return c.toTensor()},e.prototype.transpose=function(t,r){Ce(t,"transpose");for(var i=new Array(t.rank),o=0;o<i.length;o++)i[o]=t.shape[r[o]];var s=this.readSync(t.dataId),a=Tt(i,t.dtype),c=this.bufferSync(t);for(o=0;o<t.size;++o){for(var f=c.indexToLoc(o),p=new Array(f.length),m=0;m<p.length;m++)p[m]=f[r[m]];var y=a.locToIndex(p);a.values[y]=s[o]}return a.toTensor()},e.prototype.gather=function(t,r,i){Ce([t,r],"gather");var o=t.shape.slice(),s=this.readSync(r.dataId);o[i]=s.length;for(var a=Tt(o,t.dtype),c=this.bufferSync(t),f=0;f<a.size;++f){var p=a.indexToLoc(f),m=p.slice();m[i]=s[p[i]];var y=c.locToIndex(m);a.values[f]=c.values[y]}return a.toTensor()},e.prototype.batchToSpaceND=function(t,r,i){Ce([t],"batchToSpaceND");var o=r.reduce(function(m,y){return m*y}),s=Fp(t.shape,r,o),a=Pp(s.length,r.length),c=kp(t.shape,r,o),f=cA(i,r.length),p=lA(c,i,r.length);return t.reshape(s).transpose(a).reshape(c).slice(f,p)},e.prototype.spaceToBatchND=function(t,r,i){Ce([t],"spaceToBatchND");var o=r.reduce(function(y,w){return y*w}),s=[[0,0]];s.push.apply(s,i);for(var a=1+r.length;a<t.shape.length;++a)s.push([0,0]);var c=t.pad(s),f=Fp(c.shape,r,o,!1),p=Pp(f.length,r.length,!1),m=kp(c.shape,r,o,!1);return c.reshape(f).transpose(p).reshape(m)},e.prototype.pool=function(t,r,i){Ce(t,"pool");for(var o=r.strideHeight,s=r.strideWidth,a=r.dilationHeight,c=r.dilationWidth,f=r.effectiveFilterHeight,p=r.effectiveFilterWidth,m=r.padInfo.top,y=r.padInfo.left,w="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,E=this.readSync(t.dataId),A=Tt(r.outShape,t.dtype),_=A.values,T=r.outShape[1]*r.outShape[2]*r.outShape[3],N=r.outShape[2]*r.outShape[3],M=r.outShape[3],R=0;R<r.batchSize;++R)for(var P=R*T,B=R*t.strides[0],Y=0;Y<r.inChannels;++Y)for(var X=0;X<r.outHeight;++X)for(var z=X*o-m,G=Math.max(0,z),ee=Math.min(r.inHeight,f+z),J=P+X*N,pe=0;pe<r.outWidth;++pe){for(var fe=pe*s-y,he=Math.max(0,fe),xe=Math.min(r.inWidth,p+fe),we=w,me=0,Ie=0,De=G;De<ee;De+=a){for(var je=B+De*t.strides[1],rt=he;rt<xe;rt+=c){var lt=E[je+rt*t.strides[2]+Y];"max"===i&&lt>we?we=lt:"avg"===i&&(me+=lt,Ie++)}if(isNaN(we))break}_[J+pe*M+Y]="avg"===i?me/Ie:we}return A.toTensor()},e.prototype.maxPool=function(t,r){return this.pool(t,r,"max")},e.prototype.maxPoolPositions=function(t,r){for(var i=Tt(r.outShape,"int32"),o=r.strideHeight,s=r.strideWidth,a=r.dilationHeight,c=r.dilationWidth,f=r.effectiveFilterHeight,p=r.effectiveFilterWidth,m=r.padInfo.top,y=r.padInfo.left,w=this.bufferSync(t),E=0;E<r.batchSize;++E)for(var A=0;A<r.inChannels;++A)for(var _=0;_<r.outHeight;++_){for(var T=_*o-m,N=T;N<0;)N+=a;for(var M=Math.min(r.inHeight,f+T),R=0;R<r.outWidth;++R){for(var P=R*s-y,B=P;B<0;)B+=c;for(var Y=Math.min(r.inWidth,p+P),X=Number.NEGATIVE_INFINITY,z=-1,G=N;G<M;G+=a)for(var ee=G-T,J=B;J<Y;J+=c){var pe=J-P,fe=w.get(E,G,J,A);fe>X&&(X=fe,z=ee*p+pe)}i.set(z,E,_,R,A)}}return i.toTensor()},e.prototype.maxPoolBackprop=function(t,r,i,o){Ce([r,i],"maxPoolBackprop");for(var s=this.maxPoolPositions(r,o),a=o.strideHeight,c=o.strideWidth,f=o.dilationHeight,p=o.dilationWidth,m=o.effectiveFilterHeight,y=o.effectiveFilterWidth,w=y-1-o.padInfo.left,E=m-1-o.padInfo.top,A=Tt(r.shape,"float32"),_=this.bufferSync(s),T=this.bufferSync(t),N=0;N<o.batchSize;++N)for(var M=0;M<o.inChannels;++M)for(var R=0;R<o.inHeight;++R)for(var P=0;P<o.inWidth;++P){for(var B=R-E,Y=P-w,X=0,z=0;z<m;z+=f){var G=(B+z)/a;if(!(G<0||G>=o.outHeight||Math.floor(G)!==G))for(var ee=0;ee<y;ee+=p){var J=(Y+ee)/c;if(!(J<0||J>=o.outWidth||Math.floor(J)!==J)){var pe=m*y-1-_.get(N,G,J,M)===z*y+ee?1:0;0!==pe&&(X+=T.get(N,G,J,M)*pe)}}}A.set(X,N,R,P,M)}return A.toTensor()},e.prototype.avgPoolBackprop=function(t,r,i){Ce([t,r],"avgPoolBackprop");for(var o=i.strideHeight,s=i.strideWidth,a=i.filterHeight,c=i.filterWidth,f=i.dilationHeight,p=i.dilationWidth,m=i.effectiveFilterHeight,y=i.effectiveFilterWidth,w=y-1-i.padInfo.left,E=m-1-i.padInfo.top,A=Tt(r.shape,"float32"),_=1/(a*c),T=this.bufferSync(t),N=0;N<i.batchSize;++N)for(var M=0;M<i.inChannels;++M)for(var R=0;R<i.inHeight;++R)for(var P=0;P<i.inWidth;++P){for(var B=R-E,Y=P-w,X=0,z=0;z<m;z+=f){var G=(B+z)/o;if(!(G<0||G>=i.outHeight||Math.floor(G)!==G))for(var ee=0;ee<y;ee+=p){var J=(Y+ee)/s;J<0||J>=i.outWidth||Math.floor(J)!==J||(X+=T.get(N,G,J,M))}}A.set(X*_,N,R,P,M)}return A.toTensor()},e.prototype.pool3d=function(t,r,i){Ce(t,"pool3d");for(var o=r.strideDepth,s=r.strideHeight,a=r.strideWidth,c=r.dilationDepth,f=r.dilationHeight,p=r.dilationWidth,m=r.effectiveFilterDepth,y=r.effectiveFilterHeight,w=r.effectiveFilterWidth,E=r.padInfo.front,A=r.padInfo.top,_=r.padInfo.left,T="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,N=this.readSync(t.dataId),M=Tt(r.outShape,t.dtype),R=M.values,P=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],B=r.outShape[2]*r.outShape[3]*r.outShape[4],Y=r.outShape[3]*r.outShape[4],X=r.outShape[4],z=0;z<r.batchSize;++z)for(var G=z*P,ee=z*t.strides[0],J=0;J<r.inChannels;++J)for(var pe=0;pe<r.outDepth;++pe){for(var fe=pe*o-E,he=fe;he<0;)he+=c;for(var xe=Math.min(r.inDepth,m+fe),we=G+pe*B,me=0;me<r.outHeight;++me){for(var Ie=me*s-A,De=Ie;De<0;)De+=f;for(var je=Math.min(r.inHeight,y+Ie),rt=we+me*Y,lt=0;lt<r.outWidth;++lt){for(var Ut=lt*a-_,jt=Ut;jt<0;)jt+=p;for(var $t=Math.min(r.inWidth,w+Ut),hn=rt+lt*X,tn=T,pn=0,_r=0,nn=he;nn<xe;nn+=c){for(var Rn=ee+nn*t.strides[1],xn=De;xn<je;xn+=f){for(var yr=Rn+xn*t.strides[2],ur=jt;ur<$t;ur+=p){var cr=N[yr+ur*t.strides[3]+J];if("max"===i&&cr>tn?tn=cr:"avg"===i&&(pn+=cr,_r++),isNaN(tn))break}if(isNaN(tn))break}if(isNaN(tn))break}R[hn+J]="avg"===i?pn/_r:tn}}}return M.toTensor()},e.prototype.avgPool3d=function(t,r){return Ce(t,"avgPool3d"),this.pool3d(t,r,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,r,i){Ce([t,r],"avgPool3dBackprop");for(var o=i.strideDepth,s=i.strideHeight,a=i.strideWidth,c=i.filterDepth,f=i.filterHeight,p=i.filterWidth,m=i.dilationDepth,y=i.dilationHeight,w=i.dilationWidth,E=i.effectiveFilterDepth,A=i.effectiveFilterHeight,_=i.effectiveFilterWidth,T=E-1-i.padInfo.front,N=_-1-i.padInfo.left,M=A-1-i.padInfo.top,R=Tt(r.shape,"float32"),P=1/(c*f*p),B=this.bufferSync(t),Y=0;Y<i.batchSize;++Y)for(var X=0;X<i.inChannels;++X)for(var z=0;z<i.inDepth;++z)for(var G=0;G<i.inHeight;++G)for(var ee=0;ee<i.inWidth;++ee){for(var J=z-T,pe=G-M,fe=ee-N,he=0,xe=0;xe<E;xe+=m){var we=(J+xe)/o;if(!(we<0||we>=i.outDepth||Math.floor(we)!==we))for(var me=0;me<A;me+=y){var Ie=(pe+me)/s;if(!(Ie<0||Ie>=i.outHeight||Math.floor(Ie)!==Ie))for(var De=0;De<_;De+=w){var je=(fe+De)/a;je<0||je>=i.outWidth||Math.floor(je)!==je||(he+=B.get(Y,we,Ie,je,X))}}}R.set(he*P,Y,z,G,ee,X)}return R.toTensor()},e.prototype.maxPool3d=function(t,r){return Ce(t,"maxPool3d"),this.pool3d(t,r,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,r){for(var i=Tt(r.outShape,"int32"),o=r.strideDepth,s=r.strideHeight,a=r.strideWidth,c=r.dilationDepth,f=r.dilationHeight,p=r.dilationWidth,m=r.effectiveFilterDepth,y=r.effectiveFilterHeight,w=r.effectiveFilterWidth,E=r.padInfo.front,A=r.padInfo.top,_=r.padInfo.left,T=this.bufferSync(t),N=0;N<r.batchSize;++N)for(var M=0;M<r.inChannels;++M)for(var R=0;R<r.outDepth;++R){for(var P=R*o-E,B=P;B<0;)B+=c;for(var Y=Math.min(r.inDepth,m+P),X=0;X<r.outHeight;++X){for(var z=X*s-A,G=z;G<0;)G+=f;for(var ee=Math.min(r.inHeight,y+z),J=0;J<r.outWidth;++J){for(var pe=J*a-_,fe=pe;fe<0;)fe+=p;for(var he=Math.min(r.inWidth,w+pe),xe=Number.NEGATIVE_INFINITY,we=-1,me=B;me<Y;me+=c)for(var Ie=me-P,De=G;De<ee;De+=f)for(var je=De-z,rt=fe;rt<he;rt+=p){var lt=rt-pe,Ut=T.get(N,me,De,rt,M);Ut>=xe&&(xe=Ut,we=Ie*y*w+je*y+lt)}i.set(we,N,R,X,J,M)}}}return i.toTensor()},e.prototype.maxPool3dBackprop=function(t,r,i,o){Ce([r,i],"maxPool3dBackprop");for(var s=this.maxPool3dPositions(r,o),a=o.strideDepth,c=o.strideHeight,f=o.strideWidth,p=o.dilationDepth,m=o.dilationHeight,y=o.dilationWidth,w=o.effectiveFilterDepth,E=o.effectiveFilterHeight,A=o.effectiveFilterWidth,_=w-1-o.padInfo.front,T=A-1-o.padInfo.left,N=E-1-o.padInfo.top,M=Tt(r.shape,"float32"),R=this.bufferSync(s),P=this.bufferSync(t),B=0;B<o.batchSize;++B)for(var Y=0;Y<o.inChannels;++Y)for(var X=0;X<o.inDepth;++X)for(var z=0;z<o.inHeight;++z)for(var G=0;G<o.inWidth;++G){for(var ee=X-_,J=z-N,pe=G-T,fe=0,he=0;he<w;he+=p){var xe=(ee+he)/a;if(!(xe<0||xe>=o.outDepth||Math.floor(xe)!==xe))for(var we=0;we<E;we+=m){var me=(J+we)/c;if(!(me<0||me>=o.outHeight||Math.floor(me)!==me))for(var Ie=0;Ie<A;Ie+=y){var De=(pe+Ie)/f;if(!(De<0||De>=o.outWidth||Math.floor(De)!==De)){var je=w*E*A-1-R.get(B,xe,me,De,Y)===he*E*A+we*A+Ie?1:0;0!==je&&(fe+=P.get(B,xe,me,De,Y)*je)}}}}M.set(fe,B,X,z,G,Y)}return M.toTensor()},e.prototype.cast=function(t,r){return bv(t,r,this)},e.prototype.reshape=function(t,r){return Hp(t,r)},e.prototype.avgPool=function(t,r){return Ce(t,"avgPool"),this.pool(t,r,"avg").toFloat()},e.prototype.resizeBilinear=function(t,r,i,o){Ce(t,"resizeBilinear");for(var s=t.shape,a=s[0],c=s[1],f=s[2],p=s[3],m=this.readSync(t.dataId),y=new Float32Array($e([a,r,i,p])),w=[o&&r>1?c-1:c,o&&i>1?f-1:f],E=[o&&r>1?r-1:r,o&&i>1?i-1:i],A=0,_=w[0]/E[0],T=w[1]/E[1],N=0;N<a;N++)for(var M=0;M<r;M++)for(var R=_*M,P=Math.floor(R),B=R-P,Y=Math.min(c-1,Math.ceil(R)),X=N*t.strides[0]+P*t.strides[1],z=N*t.strides[0]+Y*t.strides[1],G=0;G<i;G++)for(var ee=T*G,J=Math.floor(ee),pe=ee-J,fe=Math.min(f-1,Math.ceil(ee)),he=X+J*t.strides[2],xe=z+J*t.strides[2],we=X+fe*t.strides[2],me=z+fe*t.strides[2],Ie=0;Ie<p;Ie++){var De=m[he+Ie],je=m[xe+Ie],rt=De+(m[we+Ie]-De)*pe;y[A++]=rt+(je+(m[me+Ie]-je)*pe-rt)*B}return fi(y,[a,r,i,p])},e.prototype.resizeBilinearBackprop=function(t,r,i){Ce([t,r],"resizeBilinearBackprop");for(var o=r.shape,s=o[0],a=o[1],c=o[2],f=o[3],p=t.shape,m=p[1],y=p[2],w=new Float32Array(s*a*c*f),E=[i&&m>1?a-1:a,i&&y>1?c-1:c],A=[i&&m>1?m-1:m,i&&y>1?y-1:y],_=E[0]/A[0],T=E[1]/A[1],N=this.readSync(t.dataId),M=0,R=0;R<s;R++)for(var P=R*r.strides[0],B=0;B<m;B++)for(var Y=B*_,X=Math.floor(Y),z=Math.min(Math.ceil(Y),a-1),G=P+X*r.strides[1],ee=P+z*r.strides[1],J=Y-X,pe=1-J,fe=0;fe<y;fe++)for(var he=fe*T,xe=Math.floor(he),we=Math.min(Math.ceil(he),c-1),me=he-xe,Ie=1-me,De=G+xe*r.strides[2],je=G+we*r.strides[2],rt=ee+xe*r.strides[2],lt=ee+we*r.strides[2],Ut=pe*Ie,jt=pe*me,$t=J*Ie,hn=J*me,tn=0;tn<f;tn++){var pn=N[M++];w[De+tn]+=pn*Ut,w[je+tn]+=pn*jt,w[rt+tn]+=pn*$t,w[lt+tn]+=pn*hn}return ro(w,[s,c,a,f],r.dtype)},e.prototype.resizeNearestNeighbor=function(t,r,i,o){Ce(t,"resizeNearestNeighbor");for(var s=t.shape,a=s[0],c=s[1],f=s[2],p=s[3],m=this.readSync(t.dataId),y=new Float32Array(a*r*i*p),w=[o&&r>1?c-1:c,o&&i>1?f-1:f],E=[o&&r>1?r-1:r,o&&i>1?i-1:i],A=w[0]/E[0],_=w[1]/E[1],T=0,N=0;N<a;N++)for(var M=N*t.strides[0],R=0;R<r;R++)for(var P=A*R,B=M+Math.min(c-1,o?Math.round(P):Math.floor(P))*t.strides[1],Y=0;Y<i;Y++)for(var X=_*Y,z=B+Math.min(f-1,o?Math.round(X):Math.floor(X))*t.strides[2],G=0;G<p;G++)y[T++]=m[z+G];return fi(y,[a,r,i,p],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,r,i){Ce([t,r],"resizeNearestNeighborBackprop");for(var o=r.shape,s=o[0],a=o[1],c=o[2],f=o[3],p=t.shape,m=p[1],y=p[2],w=new Float32Array(s*a*c*f),E=this.readSync(t.dataId),A=[i&&m>1?a-1:a,i&&y>1?c-1:c],_=[i&&m>1?m-1:m,i&&y>1?y-1:y],T=A[0]/_[0],N=A[1]/_[1],M=1/T,R=1/N,P=2*Math.ceil(M)+2,B=2*Math.ceil(R)+2,Y=0;Y<s;Y++)for(var X=Y*r.strides[0],z=0;z<a;z++)for(var G=X+z*r.strides[1],ee=Math.floor(z*M),J=Math.floor(ee-P/2),pe=0;pe<c;pe++)for(var fe=G+pe*r.strides[2],he=Math.floor(pe*R),xe=Math.floor(he-B/2),we=0;we<f;we++){for(var me=0,Ie=0;Ie<P;Ie++){var De=Ie+J;if(!(De<0||De>=m)){var je=X+De*t.strides[1],rt=De*T;if(z===Math.min(a-1,i?Math.round(rt):Math.floor(rt)))for(var lt=0;lt<B;lt++){var Ut=lt+xe;if(!(Ut<0||Ut>=y)){var jt=je+Ut*t.strides[2],$t=Ut*N;pe===Math.min(c-1,i?Math.round($t):Math.floor($t))&&(me+=E[jt+we])}}}}w[fe+we]=me}return ro(w,r.shape,r.dtype)},e.prototype.batchNormalization=function(t,r,i,o,s,a){Ce([t,r,i,s,a],"batchNorm");for(var c=this.readSync(t.dataId),f=this.readSync(r.dataId),p=this.readSync(i.dataId),m=s?this.readSync(s.dataId):new Float32Array([1]),y=a?this.readSync(a.dataId):new Float32Array([0]),w=new Float32Array(c.length),E=y.length,A=m.length,_=p.length,T=f.length,N=0,M=0,R=0,P=0,B=0;B<c.length;++B)w[B]=y[N++]+(c[B]-f[M++])*m[R++]/Math.sqrt(p[P++]+o),N>=E&&(N=0),M>=T&&(M=0),R>=A&&(R=0),P>=_&&(P=0);return ro(w,t.shape)},e.prototype.localResponseNormalization4D=function(t,r,i,o,s){Ce(t,"localResponseNormalization4D");var a=t.shape[3],c=a-1,f=this.readSync(t.dataId),p=t.size,m=new Float32Array(p);function y(_){for(var T=_%a,N=_-T+Math.max(0,T-r),M=_-T+Math.min(T+r,c),R=0;N<=M;N++){var P=f[N];R+=P*P}return R}for(var w=0;w<p;w++){var E=y(w),A=f[w]*Math.pow(i+o*E,-s);m[w]=A}return ro(m,t.shape)},e.prototype.LRNGrad=function(t,r,i,o,s,a,c){Ce(t,"LRNGrad");for(var f=t.shape[3],p=this.readSync(t.dataId),m=this.readSync(r.dataId),y=this.readSync(i.dataId),w=new Float32Array(t.size),E=t.size,A=0;A<E;A++){for(var _=A%f,T=A-_+Math.max(0,_-o),N=A-_+Math.min(f,_+o+1),M=0,R=T;R<N;R++)M+=Math.pow(m[R],2);for(M=a*M+s,R=T;R<N;R++){var P=-2*a*c*m[R]*y[A]/M;A===R&&(P+=Math.pow(M,-c)),w[R]+=P*=p[A]}}return ro(w,t.shape)},e.prototype.multinomial=function(t,r,i,o){Ce(t,"multinomial");for(var s=r?t:Ra(t),a=s.shape[0],c=s.shape[1],f=zn([a,i],"int32"),p=this.readSync(f.dataId),m=this.readSync(s.dataId),y=0;y<a;++y){var w=y*c,E=new Float32Array(c-1);E[0]=m[w];for(var A=1;A<E.length;++A)E[A]=E[A-1]+m[w+A];for(var _=Op(o.toString()),T=y*i,N=0;N<i;++N){var M=_();p[T+N]=E.length;for(var R=0;R<E.length;R++)if(M<E[R]){p[T+N]=R;break}}}return f},e.prototype.oneHot=function(t,r,i,o){Ce(t,"oneHot");var s=new Float32Array(t.size*r);s.fill(o);for(var a=this.readSync(t.dataId),c=0;c<t.size;++c)a[c]>=0&&a[c]<r&&(s[c*r+a[c]]=i);return bu(s,[t.size,r],"int32")},e.prototype.nonMaxSuppression=function(t,r,i,o,s){return Ce(t,"nonMaxSuppression"),_v(this.readSync(t.dataId),this.readSync(r.dataId),i,o,s)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,r){for(var i=t.shape[0],o=t.shape[1],s=Tt(t.shape,"float32"),a=Tt(t.shape,"float32"),c=jo(t).as2D(i,o),f=sa(t).as2D(i,o),p=0;p<i;p++)for(var m=c.slice([p,0],[1,o]),y=f.slice([p,0],[1,o]),w=li(m,y),E=this.readSync(this.fftImpl(w,r).dataId),A=0;A<o;A++){var _=yA(E,A);s.values[p*o+A]=_.real,a.values[p*o+A]=_.imag}return li(s.toTensor(),a.toTensor()).as2D(i,o)},e.prototype.fftImpl=function(t,r){var i=t.as1D(),o=i.size;if(this.isExponentOf2(o)){var s=this.fftRadix2(i,o,r).as2D(t.shape[0],t.shape[1]);return r&&(s=li(jo(s).div(Pe(o)),sa(s).div(Pe(o)))),s}var a=this.readSync(t.dataId),c=function(f){for(var p=new Float32Array(f.length/2),m=new Float32Array(f.length/2),y=0;y<f.length;y+=2)p[y/2]=f[y],m[y/2]=f[y+1];return{real:p,imag:m}}(this.fourierTransformByMatmul(a,o,r));return li(c.real,c.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return 0==(t&t-1)},e.prototype.fftRadix2=function(t,r,i){if(1===r)return t;var o=this.readSync(t.dataId),s=r/2,a=function(T){for(var N=Math.ceil(T.length/4),M=new Float32Array(N),R=new Float32Array(N),P=0;P<T.length;P+=4)M[Math.floor(P/4)]=T[P],R[Math.floor(P/4)]=T[P+1];return{real:M,imag:R}}(o),c=li(a.real,a.imag).as1D(),f=function(T){for(var N=Math.floor(T.length/4),M=new Float32Array(N),R=new Float32Array(N),P=2;P<T.length;P+=4)M[Math.floor(P/4)]=T[P],R[Math.floor(P/4)]=T[P+1];return{real:M,imag:R}}(o),p=li(f.real,f.imag).as1D();c=this.fftRadix2(c,s,i),p=this.fftRadix2(p,s,i);var m=function(T,N){for(var M=new Float32Array(T/2),R=new Float32Array(T/2),P=0;P<Math.ceil(T/2);P++){var B=(N?2:-2)*Math.PI*(P/T);M[P]=Math.cos(B),R[P]=Math.sin(B)}return{real:M,imag:R}}(r,i),y=li(m.real,m.imag).mul(p),w=c.add(y),E=c.sub(y),A=jo(w).concat(jo(E)),_=sa(w).concat(sa(E));return li(A,_).as1D()},e.prototype.fourierTransformByMatmul=function(t,r,i){for(var o=new Float32Array(2*r),s=0;s<r;s++){for(var a=0,c=0,f=0;f<r;f++){var p=S5(s*f,r,i),m=yA(t,f);a+=m.real*p.real-m.imag*p.imag,c+=m.real*p.imag+m.imag*p.real}i&&(a/=r,c/=r),T5(o,a,c,s)}return o},e.prototype.depthToSpace=function(t,r,i){H("NHWC"===i,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+i}),H(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var o=t.shape[0],s=t.shape[1],a=t.shape[2],c=t.shape[3],f=s*r,p=a*r,m=c/(r*r),y=this.readSync(t.dataId),w=new Float32Array(o*f*p*m),E=0,A=0;A<o;++A)for(var _=0;_<f;++_)for(var T=Math.floor(_/r),N=_%r,M=0;M<p;++M)for(var R=Math.floor(M/r),P=(N*r+M%r)*m,B=0;B<m;++B)w[E++]=y[B+P+c*(R+a*(T+s*A))];return ro(w,[o,f,p,m])},e.prototype.broadcastedBinaryOp=function(t,r,i,o){var s=zt(t.shape,r.shape),a=Tt(s,i),c=this.readSync(t.dataId),f=this.readSync(r.dataId),p=Ma(t.shape,s),m=Ma(r.shape,s),y=a.values;if(p.length+m.length===0)for(var w=0;w<y.length;++w)y[w]=o(c[w%c.length],f[w%f.length]);else{var E=this.bufferSync(t),A=this.bufferSync(r),_=function(T){var N=a.indexToLoc(T),M=N.slice(-t.rank);p.forEach(function(Y){return M[Y]=0});var R=E.locToIndex(M),P=N.slice(-r.rank);m.forEach(function(Y){return P[Y]=0});var B=A.locToIndex(P);y[T]=o(c[R],f[B])};for(w=0;w<y.length;++w)_(w)}return a.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,r,i){var o=zt(t.shape,r.shape),s=Tt(o,"float32"),a=Tt(o,"float32"),c=this.readSync(t.dataId),f=this.readSync(r.dataId),p=Ma(t.shape,o),m=Ma(r.shape,o),y=s.values,w=a.values;if(p.length+m.length===0)for(var E=0;E<y.length;E++){var A=E%c.length,_=E%f.length,T=i(c[2*A],c[2*A+1],f[2*_],f[2*_+1]);y[E]=T.real,w[E]=T.imag}else{var N=this.bufferSync(this.data.get(t.dataId).complexTensors.real),M=this.bufferSync(this.data.get(r.dataId).complexTensors.real),R=function(P){var B=s.indexToLoc(P),Y=B.slice(-t.rank);p.forEach(function(J){return Y[J]=0});var X=N.locToIndex(Y),z=B.slice(-r.rank);m.forEach(function(J){return z[J]=0});var G=M.locToIndex(z),ee=i(c[2*X],c[2*X+1],f[2*G],f[2*G+1]);y[P]=ee.real,w[P]=ee.imag};for(E=0;E<y.length;E++)R(E)}return this.complex(s.toTensor(),a.toTensor())},e.prototype.split=function(t,r,i){return bA(t,r,i)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,r,i,o,s,a){for(var c=t.shape,f=c[0],p=c[1],m=c[2],y=c[3],w=r.shape[0],E=o[0],A=o[1],_=Tt([w,E,A,y],"float32"),T=this.readSync(r.dataId),N=this.readSync(i.dataId),M=this.readSync(t.dataId),R=t.strides,P=_.strides,B=0;B<w;B++){var Y=4*B,X=T[Y],z=T[Y+1],G=T[Y+2],ee=T[Y+3],J=N[B];if(!(J>=f))for(var pe=E>1?(G-X)*(p-1)/(E-1):0,fe=A>1?(ee-z)*(m-1)/(A-1):0,he=0;he<E;he++){var xe=E>1?X*(p-1)+he*pe:.5*(X+G)*(p-1);if(xe<0||xe>p-1)for(var we=0;we<A;we++)for(var me=0;me<y;me++){var Ie=me+we*P[2]+he*P[1]+B*P[0];_.values[Ie]=a}else if("bilinear"===s){var De=Math.floor(xe),je=Math.ceil(xe),rt=xe-De;for(we=0;we<A;we++)if((nn=A>1?z*(m-1)+we*fe:.5*(z+ee)*(m-1))<0||nn>m-1)for(me=0;me<y;me++)_.values[Ie=me+we*P[2]+he*P[1]+B*P[0]]=a;else{var lt=Math.floor(nn),Ut=Math.ceil(nn),jt=nn-lt;for(me=0;me<y;me++){var $t=M[Ie=me+lt*R[2]+De*R[1]+J*R[0]],hn=M[Ie=me+Ut*R[2]+De*R[1]+J*R[0]],tn=M[Ie=me+lt*R[2]+je*R[1]+J*R[0]],pn=$t+(hn-$t)*jt,_r=tn+(M[Ie=me+Ut*R[2]+je*R[1]+J*R[0]]-tn)*jt;_.values[Ie=me+we*P[2]+he*P[1]+B*P[0]]=pn+(_r-pn)*rt}}}else for(we=0;we<A;++we){var nn;if((nn=A>1?z*(m-1)+we*fe:.5*(z+ee)*(m-1))<0||nn>m-1)for(me=0;me<y;me++)_.values[Ie=me+we*P[2]+he*P[1]+B*P[0]]=a;else{var Rn=Math.round(nn),xn=Math.round(xe);for(me=0;me<y;me++)_.values[me+we*P[2]+he*P[1]+B*P[0]]=M[me+Rn*R[2]+xn*R[1]+J*R[0]]}}}}return _.toTensor()},e.prototype.sparseToDense=function(t,r,i,o){var s=Cd(0,t,i);return this.scatter(t,r,i,s.outputSize,s.sliceSize,s.numUpdates,s.sliceRank,s.strides,o,!1)},e.prototype.gatherND=function(t,r){var i=r.shape,o=i[i.length-1],s=pv(t,r),a=s[0],c=s[1],f=s[2],p=s[3];if(0===c)return fi([],a,t.dtype);for(var m=new dd([c,f],t.dtype),y=this.readSync(r.dataId),w=this.readSync(t.dataId),E=0;E<c;E++){for(var A=[],_=0,T=0;T<o;T++){var N=y[E*o+T];_+=N*p[T],A.push(N)}if(_<0||_>=t.size/f)throw new Error("Invalid indices: "+A+" does not index into "+t.shape);for(var M=0;M<f;M++)m.values[E*f+M]=w[_*f+M]}return m.toTensor().reshape(a)},e.prototype.scatterND=function(t,r,i){var o=Cd(0,t,i),s=o.sliceRank,a=o.numUpdates,c=o.sliceSize,f=o.strides,p=o.outputSize,m=Pe(0);return this.scatter(t,r,i,p,c,a,s,f,m,!0)},e.prototype.fill=function(t,r,i){var o=ad(i=i||Il(r),$e(t));return o.fill(r),Q.makeTensor(o,t,i,this)},e.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var r=ad(t.dtype,$e(t.shape));return this.makeOutput(r,t.shape,t.dtype)},e.prototype.linspace=function(t,r,i){return Cv(t,r,i)},e.prototype.scatter=function(t,r,i,o,s,a,c,f,p,m){var y=[o/s,s],w=this.readSync(t.dataId),E=this.readSync(r.dataId);if(0===o)return fi([],i,r.dtype);var A=new dd(y,r.dtype);A.values.fill(this.readSync(p.dataId)[0]);for(var _=0;_<a;_++){for(var T=[],N=0,M=0;M<c;M++){var R=w[_*c+M];T.push(R),N+=R*f[M]}if(N<0||N>=o/s)throw new Error("Invalid indices: "+T+" does not index into "+i);for(var P=0;P<s;P++)m?A.values[N*s+P]+=E[_*s+P]:A.values[N*s+P]=0===r.rank?E[0]:E[_*s+P]}return A.toTensor().reshape(i)},e}(vA);Q.registerBackend("cpu",function(){return new MU},1);for(var Jv=0,$D=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,r=n.attrs,o=e.boxes,s=e.scores,c=r.maxOutputSize,f=r.iouThreshold,p=r.scoreThreshold,m=r.softNmsSigma,y=n.backend;Ce(o,"NonMaxSuppressionWithScore");var w=Iv(y.data.get(o.dataId).values,y.data.get(s.dataId).values,c,f,p,m);return[w.selectedIndices,w.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(n){var r=n.inputs.x,i=n.backend;Ce(r,"square");for(var o=i.data.get(r.dataId).values,s=new Float32Array(o.length),a=0;a<o.length;++a){var c=o[a];s[a]=c*c}return{dataId:i.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:Td,backendName:"cpu",kernelFunc:function(n){var e=n.inputs,i=e.a,o=e.b,s=n.backend;Ce([i,o],Td);var a=s.data.get(i.dataId).values,c=s.data.get(o.dataId).values,f=function(y,w,E,A,_,T){var N=zt(y,w),M=N.length,R=bs(N),P=_l(_,$e(N)),B=y.length,Y=w.length,X=bs(y),z=bs(w),G=Ma(y,N),ee=Ma(w,N);if(G.length+ee.length===0)for(var J=0;J<P.length;++J)P[J]=T(E[J%E.length],A[J%A.length]);else{var pe=function(fe){var he=wI(fe,M,R),xe=he.slice(-B);G.forEach(function(De){return xe[De]=0});var we=qm(xe,B,X),me=he.slice(-Y);ee.forEach(function(De){return me[De]=0});var Ie=qm(me,Y,z);P[fe]=T(E[we],A[Ie])};for(J=0;J<P.length;++J)pe(J)}return[P,N]}(i.shape,o.shape,a,c,i.dtype,function(y,w){var E=y-w;return E*E}),m=f[1];return{dataId:s.write(f[0],m,i.dtype),shape:m,dtype:i.dtype}}}];Jv<$D.length;Jv++)uI($D[Jv]);for(var kl,OU=function(n){this.variableNames=["A"];var e=_i(),t=n[0],r=n[1];this.outputShape=n,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+t+".0);\n\n        vec4 values = "+e.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},FU=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=_i(),t=n[0],r=n[1];this.outputShape=n,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+t+".0);\n            vec4 values = "+e.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+e.output+" = result;\n      }\n    "},ey=0,ZD=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(n){var t=n.backend,i=n.inputs.pixels,s="undefined"!=typeof HTMLVideoElement&&i instanceof HTMLVideoElement,a="undefined"!=typeof HTMLImageElement&&i instanceof HTMLImageElement,c=s?[i.videoWidth,i.videoHeight]:[i.width,i.height],f=c[0],p=c[1],m=[p,f],y=[p,f,n.attrs.numChannels];(a||s)&&(null==kl&&(kl=document.createElement("canvas").getContext("2d")),kl.canvas.width=f,kl.canvas.height=p,kl.drawImage(i,0,0,f,p),i=kl.canvas);var w=t.makeTensorInfo(m,"int32");t.texData.get(w.dataId).usage=bo.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(w.dataId),i);var E=le().getBool("WEBGL_PACK")?new FU(y):new OU(y),A=t.runWebGLProgram(E,[w],"int32");return t.disposeData(w.dataId),A}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs;Np("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var s=e.scores,c=r.maxOutputSize,f=r.iouThreshold,p=r.scoreThreshold,m=r.softNmsSigma,y=t,w=Iv(y.readSync(e.boxes.dataId),y.readSync(s.dataId),c,f,p,m);return[w.selectedIndices,w.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(n){var r=n.inputs.x,i=n.backend,o=new Ft(r.shape,"return x * x;");return i.runWebGLProgram(o,[r],r.dtype)}},{kernelName:Td,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,i=e.a,o=e.b,s=n.backend,a=le().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Oa("return (a - b) * (a - b);",i.shape,o.shape):new vr("return (a - b) * (a - b);",i.shape,o.shape);return s.compileAndRun(a,[i,o])}}];ey<ZD.length;ey++)uI(ZD[ey]);for(var ty=0,JD=[{kernelName:"Square",gradFunc:function(n,e){var t=e[0];return{x:function(){return n.mul(t.toFloat().mul(2))}}}},{kernelName:Td,gradFunc:function(n,e){var t=e[0],r=e[1],i=Pe(2);return{a:function(){return Ii(n,Ii(i,Yr(t,r)))},b:function(){return Ii(n,Ii(i,Yr(r,t)))}}}}];ty<JD.length;ty++)LB(JD[ty]);var PU=function(){function n(){}return n.prototype.fetch=function(e,t){return fetch(e,t)},n.prototype.now=function(){return performance.now()},n.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},n}();le().get("IS_BROWSER")&&le().setPlatform("browser",new PU);var ny,LU=function(){function n(){this.util=ve(118),this.textEncoder=new this.util.TextEncoder}return n.prototype.fetch=function(e,t){return null!=le().global.fetch?le().global.fetch(e,t):(null==ny&&(ny=ve(655)),ny(e,t))},n.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},n.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)},n}();le().get("IS_NODE")&&le().setPlatform("node",new LU);var ry={float32:4,int32:4,uint16:2,uint8:1,bool:1};function eT(n,e){for(var t={},r=0,i=function(a){var c=a.name,f=a.dtype,p=a.shape,m=$e(p),y=void 0;if("quantization"in a){var w=a.quantization;if("uint8"!==w.dtype&&"uint16"!==w.dtype)throw new Error("Weight "+a.name+" has unknown quantization dtype "+w.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var E=ry[w.dtype],A=n.slice(r,r+m*E),_="uint8"===w.dtype?new Uint8Array(A):new Uint16Array(A);if("float32"===f)y=Float32Array.from(_,function(B){return B*w.scale+w.min});else{if("int32"!==f)throw new Error("Unsupported dtype in weight '"+c+"': "+f);y=Int32Array.from(_,function(B){return Math.round(B*w.scale+w.min)})}r+=m*E}else if("string"===f){var T=$e(a.shape);y=[];for(var N=0;N<T;N++){var M=new Uint32Array(n.slice(r,r+4))[0];r+=4;var R=new Uint8Array(n.slice(r,r+M));y.push(R),r+=M}}else{var P=ry[f];if(A=n.slice(r,r+m*P),"float32"===f)y=new Float32Array(A);else if("int32"===f)y=new Int32Array(A);else{if("bool"!==f)throw new Error("Unsupported dtype in weight '"+c+"': "+f);y=new Uint8Array(A)}r+=m*P}t[c]=fi(y,p,f)},o=0,s=e;o<s.length;o++)i(s[o]);return t}function BU(n){if(null===n)throw new Error("Invalid input value: "+JSON.stringify(n));var e=0,t=[];n.forEach(function(o){if(e+=o.byteLength,t.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+o.constructor.name)});var r=new Uint8Array(e),i=0;return t.forEach(function(o){r.set(new Uint8Array(o.buffer),i),i+=o.byteLength}),r.buffer}var iy="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function tT(n){return iy?Buffer.byteLength(n):new Blob([n]).size}function oy(n){var e=0;n.forEach(function(i){e+=i.byteLength});var t=new Uint8Array(e),r=0;return n.forEach(function(i){t.set(new Uint8Array(i),r),r+=i.byteLength}),t.buffer}function nT(n){for(n=n.trim();n.endsWith("/");)n=n.slice(0,n.length-1);var e=n.split("/");return e[e.length-1]}function Md(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==n.modelTopology?0:tT(JSON.stringify(n.modelTopology)),weightSpecsBytes:null==n.weightSpecs?0:tT(JSON.stringify(n.weightSpecs)),weightDataBytes:null==n.weightData?0:n.weightData.byteLength}}var Io=function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return null==n.instance&&(n.instance=new n),n.instance},n.registerSaveRouter=function(e){n.getInstance().saveRouters.push(e)},n.registerLoadRouter=function(e){n.getInstance().loadRouters.push(e)},n.getSaveHandlers=function(e){return n.getHandlers(e,"save")},n.getLoadHandlers=function(e,t){return n.getHandlers(e,"load",t)},n.getHandlers=function(e,t,r){var i=[];return("load"===t?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach(function(o){var s=o(e,r);null!==s&&i.push(s)}),i},n}(),Ll="://",_u=function(){function n(){this.managers={}}return n.getInstance=function(){return null==n.instance&&(n.instance=new n),n.instance},n.registerManager=function(e,t){H(null!=e,function(){return"scheme must not be undefined or null."}),e.endsWith(Ll)&&(e=e.slice(0,e.indexOf(Ll))),H(e.length>0,function(){return"scheme must not be an empty string."});var r=n.getInstance();H(null==r.managers[e],function(){return"A model store manager is already registered for scheme '"+e+"'."}),r.managers[e]=t},n.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n}();function o0(n){if(-1===n.indexOf(Ll))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+_u.getSchemes().join(","));return{scheme:n.split(Ll)[0],path:n.split(Ll)[1]}}function rT(n,e,t){return void 0===t&&(t=!1),qe(this,void 0,void 0,function(){var r,i,o,s,a,c,f,p,m;return Ke(this,function(y){switch(y.label){case 0:return H(n!==e,function(){return"Old path and new path are the same: '"+n+"'"}),H((r=Io.getLoadHandlers(n)).length>0,function(){return"Copying failed because no load handler is found for source URL "+n+"."}),H(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+n+"."}),i=r[0],H((o=Io.getSaveHandlers(e)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),H(o.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."}),s=o[0],a=o0(n).scheme,c=o0(n).path,f=a===o0(n).scheme,[4,i.load()];case 1:return p=y.sent(),t&&f?[4,_u.getManager(a).removeModel(c)]:[3,3];case 2:y.sent(),y.label=3;case 3:return[4,s.save(p)];case 4:return m=y.sent(),!t||f?[3,6]:[4,_u.getManager(a).removeModel(c)];case 5:y.sent(),y.label=6;case 6:return[2,m.modelArtifactsInfo]}})})}var dc="models_store",Iu="model_info_store";function iT(){if(!le().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window||self,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function sy(n){var e=n.result;e.createObjectStore(dc,{keyPath:"modelPath"}),e.createObjectStore(Iu,{keyPath:"modelPath"})}var Bl=function(){function n(e){if(this.indexedDB=iT(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return n.prototype.save=function(e){return qe(this,void 0,void 0,function(){return Ke(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},n.prototype.load=function(){return qe(this,void 0,void 0,function(){return Ke(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},n.prototype.databaseAction=function(e,t){var r=this;return new Promise(function(i,o){var s=r.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return sy(s)},s.onsuccess=function(){var a=s.result;if(null==t){var c=a.transaction(dc,"readonly"),f=c.objectStore(dc).get(r.modelPath);f.onsuccess=function(){if(null==f.result)return a.close(),o(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));i(f.result.modelArtifacts)},f.onerror=function(A){return a.close(),o(f.error)},c.oncomplete=function(){return a.close()}}else{var p,m=Md(t),y=a.transaction(Iu,"readwrite"),w=y.objectStore(Iu),E=w.put({modelPath:r.modelPath,modelArtifactsInfo:m});E.onsuccess=function(){var A=(p=a.transaction(dc,"readwrite")).objectStore(dc).put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:m});A.onsuccess=function(){return i({modelArtifactsInfo:m})},A.onerror=function(_){var T=(w=y.objectStore(Iu)).delete(r.modelPath);T.onsuccess=function(){return a.close(),o(A.error)},T.onerror=function(N){return a.close(),o(A.error)}}},E.onerror=function(A){return a.close(),o(E.error)},y.oncomplete=function(){null==p?a.close():p.oncomplete=function(){return a.close()}}}},s.onerror=function(a){return o(s.error)}})},n.URL_SCHEME="indexeddb://",n}(),oT=function(n){return le().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Bl.URL_SCHEME)?(e=n.slice(Bl.URL_SCHEME.length),new Bl(e)):null;var e};Io.registerSaveRouter(oT),Io.registerLoadRouter(oT);var VU=function(){function n(){this.indexedDB=iT()}return n.prototype.listModels=function(){return qe(this,void 0,void 0,function(){var e=this;return Ke(this,function(t){return[2,new Promise(function(r,i){var o=e.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return sy(o)},o.onsuccess=function(){var s=o.result,a=s.transaction(Iu,"readonly"),c=a.objectStore(Iu).getAll();c.onsuccess=function(){for(var f={},p=0,m=c.result;p<m.length;p++){var y=m[p];f[y.modelPath]=y.modelArtifactsInfo}r(f)},c.onerror=function(f){return s.close(),i(c.error)},a.oncomplete=function(){return s.close()}},o.onerror=function(s){return i(o.error)}})]})})},n.prototype.removeModel=function(e){return qe(this,void 0,void 0,function(){var t=this;return Ke(this,function(r){var i;return e=(i=e).startsWith(Bl.URL_SCHEME)?i.slice(Bl.URL_SCHEME.length):i,[2,new Promise(function(o,s){var a=t.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return sy(a)},a.onsuccess=function(){var c,f=a.result,p=f.transaction(Iu,"readwrite"),m=p.objectStore(Iu),y=m.get(e);y.onsuccess=function(){if(null==y.result)return f.close(),s(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var w=m.delete(e),E=function(){var A=(c=f.transaction(dc,"readwrite")).objectStore(dc).delete(e);A.onsuccess=function(){return o(y.result.modelArtifactsInfo)},A.onerror=function(_){return s(y.error)}};w.onsuccess=E,w.onerror=function(A){return E(),f.close(),s(y.error)}},y.onerror=function(w){return f.close(),s(y.error)},p.oncomplete=function(){null==c?f.close():c.oncomplete=function(){return f.close()}}},a.onerror=function(c){return s(a.error)}})]})})},n}();if(le().getBool("IS_BROWSER"))try{_u.registerManager(Bl.URL_SCHEME,new VU)}catch(n){}var Pa="/",Vl="tensorflowjs_models",sT="info",UU="model_topology",jU="weight_specs",WU="weight_data",HU="model_metadata";function aT(n){return{info:[Vl,n,sT].join(Pa),topology:[Vl,n,UU].join(Pa),weightSpecs:[Vl,n,jU].join(Pa),weightData:[Vl,n,WU].join(Pa),modelMetadata:[Vl,n,HU].join(Pa)}}function zU(n){var e=n.split(Pa);if(e.length<3)throw new Error("Invalid key format: "+n);return e.slice(1,e.length-1).join(Pa)}var Ul=function(){function n(e){if(!le().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=aT(this.modelPath)}return n.prototype.save=function(e){return qe(this,void 0,void 0,function(){var t,r,i;return Ke(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),i=Md(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(s){if(iy)return Buffer.from(s).toString("base64");for(var a=new Uint8Array(s),c="",f=0,p=a.length;f<p;f++)c+=String.fromCharCode(a[f]);return btoa(c)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:i}]}catch(s){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}return[2]})})},n.prototype.load=function(){return qe(this,void 0,void 0,function(){var e,t,r,i,o,s,a;return Ke(this,function(c){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(r=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=r,null==(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=i,null!=(o=this.LS.getItem(this.keys.modelMetadata))&&(s=JSON.parse(o),t.format=s.format,t.generatedBy=s.generatedBy,t.convertedBy=s.convertedBy,t.userDefinedMetadata=s.userDefinedMetadata),null==(a=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(f){if(iy){var p=Buffer.from(f,"base64");return p.buffer.slice(p.byteOffset,p.byteOffset+p.byteLength)}for(var m=atob(f),y=new Uint8Array(m.length),w=0;w<m.length;++w)y.set([m.charCodeAt(w)],w);return y.buffer}(a),[2,t]})})},n.URL_SCHEME="localstorage://",n}(),uT=function(n){return le().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Ul.URL_SCHEME)?(e=n.slice(Ul.URL_SCHEME.length),new Ul(e)):null;var e};Io.registerSaveRouter(uT),Io.registerLoadRouter(uT);var GU=function(){function n(){H(le().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),H("undefined"==typeof window||void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return n.prototype.listModels=function(){return qe(this,void 0,void 0,function(){var e,t,r,i,o,s;return Ke(this,function(a){for(e={},t=Vl+Pa,r=Pa+sT,i=0;i<this.LS.length;++i)(o=this.LS.key(i)).startsWith(t)&&o.endsWith(r)&&(s=zU(o),e[s]=JSON.parse(this.LS.getItem(o)));return[2,e]})})},n.prototype.removeModel=function(e){return qe(this,void 0,void 0,function(){var t,r;return Ke(this,function(i){var o;if(e=(o=e).startsWith(Ul.URL_SCHEME)?o.slice(Ul.URL_SCHEME.length):o,t=aT(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return r=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,r]})})},n}();if(le().getBool("IS_BROWSER"))try{_u.registerManager(Ul.URL_SCHEME,new GU)}catch(n){}function cT(n){return new Promise(function(e){return setTimeout(e)}).then(n)}var ay=function(){function n(e){if(!le().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),null!=e&&0!==e.length||(e="model"),this.modelTopologyFileName=e+".json",this.weightDataFileName=e+".weights.bin"}return n.prototype.save=function(e){return qe(this,void 0,void 0,function(){var t,o,s,a;return Ke(this,function(c){switch(c.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return o=window.URL.createObjectURL(new Blob([JSON.stringify({modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}]})],{type:"application/json"})),(s=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,s.href=o,[4,cT(function(){return s.dispatchEvent(new MouseEvent("click"))})];case 2:return c.sent(),null==e.weightData?[3,4]:((a=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,a.href=t,[4,cT(function(){return a.dispatchEvent(new MouseEvent("click"))})]);case 3:c.sent(),c.label=4;case 4:return[2,{modelArtifactsInfo:Md(e)}]}})})},n.URL_SCHEME="downloads://",n}(),KU=function(){function n(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return n.prototype.load=function(){return qe(this,void 0,void 0,function(){var e,t,r=this;return Ke(this,function(i){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(o,s){var a=new FileReader;a.onload=function(c){var f=JSON.parse(c.target.result),p=f.modelTopology;if(null!=p){0===t.length&&o({modelTopology:p});var m=f.weightsManifest;if(null!=m){var y;try{y=r.checkManifestAndWeightFiles(m,t)}catch(_){return void s(_)}var w=[],E=[],A=[];m.forEach(function(_){_.paths.forEach(function(T){E.push(T),A.push(null)}),w.push.apply(w,_.weights)}),m.forEach(function(_){_.paths.forEach(function(T){var N=new FileReader;N.onload=function(M){var R=M.target.result,P=E.indexOf(T);A[P]=R,-1===A.indexOf(null)&&o({modelTopology:p,weightSpecs:w,weightData:oy(A),format:f.format,generatedBy:f.generatedBy,convertedBy:f.convertedBy,userDefinedMetadata:f.userDefinedMetadata})},N.onerror=function(M){return s("Failed to weights data from file of path '"+T+"'.")},N.readAsArrayBuffer(y[T])})})}else s(new Error("weightManifest field is missing from file "+e.name))}else s(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(c){return s("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)})]})})},n.prototype.checkManifestAndWeightFiles=function(e,t){for(var r=[],i=t.map(function(c){return nT(c.name)}),o={},s=0,a=e;s<a.length;s++)a[s].paths.forEach(function(c){var f=nT(c);if(-1!==r.indexOf(f))throw new Error("Duplicate file basename found in weights manifest: '"+f+"'");if(r.push(f),-1===i.indexOf(f))throw new Error("Weight file with basename '"+f+"' is not provided.");o[c]=t[i.indexOf(f)]});if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+t.length+").");return o},n}();function lT(n,e,t,r){var o;H(null!=(o=n)&&Array.isArray(o)&&o.length>0,function(){return"promises must be a none empty array"}),function(o,s){H(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+o}),H(s>=0&&s<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+s}),H(s>=o,function(){return"startFraction must be no more than endFraction, but got startFraction "+o+" and endFraction "+s})}(t=null==t?0:t,r=null==r?1:r);var i=0;return Promise.all(n.map(function(o){return o.then(function(s){var a=t+ ++i/n.length*(r-t);return e(a),s}),o}))}function fT(n,e){return qe(this,void 0,void 0,function(){var t,r,i,o,s,a,c,f,p;return Ke(this,function(m){switch(m.label){case 0:return null==e&&(e={}),t=null==e.fetchFunc?le().platform.fetch:e.fetchFunc,r=n.map(function(y){return t(y,e.requestInit,{isBinary:!0})}),i=0,o=.5,null!=e.onProgress?[3,2]:[4,Promise.all(r)];case 1:return s=m.sent(),[3,4];case 2:return[4,lT(r,e.onProgress,i,o)];case 3:s=m.sent(),m.label=4;case 4:return a=s.map(function(y){return y.arrayBuffer()}),c=.5,f=1,null!=e.onProgress?[3,6]:[4,Promise.all(a)];case 5:return p=m.sent(),[3,8];case 6:return[4,lT(a,e.onProgress,c,f)];case 7:p=m.sent(),m.label=8;case 8:return[2,p]}})})}function dT(n){var e=this;return function(t,r,i){return void 0===r&&(r=""),qe(e,void 0,void 0,function(){var o,s,a,c,f,p,m,y,w,E;return Ke(this,function(A){switch(A.label){case 0:if(o=t.map(function(){return!1}),s={},a=null!=i?i.map(function(){return!1}):[],c=[],t.forEach(function(_,T){var N=0;_.weights.forEach(function(M){var P=ry["quantization"in M?M.quantization.dtype:M.dtype]*$e(M.shape),B=function(){o[T]=!0,null==s[T]&&(s[T]=[]),s[T].push({manifestEntry:M,groupOffset:N,sizeBytes:P})};null!=i?i.forEach(function(Y,X){Y===M.name&&(B(),a[X]=!0)}):B(),c.push(M.name),N+=P})}),!a.every(function(_){return _}))throw f=i.filter(function(_,T){return!a[T]}),new Error("Could not find weights in manifest with names: "+f.join(", ")+". \nManifest JSON has weights with names: "+c.join(", ")+".");return p=o.reduce(function(_,T,N){return T&&_.push(N),_},[]),m=[],p.forEach(function(_){t[_].paths.forEach(function(T){var N=r+(r.endsWith("/")?"":"/")+T;m.push(N)})}),[4,n(m)];case 1:return y=A.sent(),w={},E=0,p.forEach(function(_){for(var T=t[_].paths.length,N=0,M=0;M<T;M++)N+=y[E+M].byteLength;for(var R=new ArrayBuffer(N),P=new Uint8Array(R),B=0,Y=0;Y<T;Y++){var X=new Uint8Array(y[E+Y]);P.set(X,B),B+=X.byteLength}s[_].forEach(function(z){var G=eT(R.slice(z.groupOffset,z.groupOffset+z.sizeBytes),[z.manifestEntry]);for(var ee in G)w[ee]=G[ee]}),E+=T}),[2,w]}})})}}Io.registerSaveRouter(function(n){return le().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(ay.URL_SCHEME)?(void 0===(e=n.slice(ay.URL_SCHEME.length))&&(e="model"),new ay(e)):null;var e});var hT=function(){function n(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null!=t.fetchFunc?(H("function"==typeof t.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=le().platform.fetch,H(null!=e&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&H(2===e.length,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(e){return qe(this,void 0,void 0,function(){var t,o;return Ke(this,function(s){switch(s.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,t.body.append("model.json",new Blob([JSON.stringify({modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:[{paths:["./model.weights.bin"],weights:e.weightSpecs}]})],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((o=s.sent()).ok)return[2,{modelArtifactsInfo:Md(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},n.prototype.load=function(){return qe(this,void 0,void 0,function(){var e,t,r,i,o,s,a,c,f,p,m,y;return Ke(this,function(w){switch(w.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=w.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");w.label=2;case 2:return w.trys.push([2,4,,5]),[4,e.json()];case 3:return t=w.sent(),[3,5];case 4:throw w.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(o=t.weightsManifest,s=t.generatedBy,a=t.convertedBy,c=t.format,f=t.userDefinedMetadata,null==(i=t.modelTopology)&&null==o)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==o?[3,7]:[4,this.loadWeights(o)];case 6:y=w.sent(),p=y[0],m=y[1],w.label=7;case 7:return[2,{modelTopology:i,weightSpecs:p,weightData:m,userDefinedMetadata:f,generatedBy:s,convertedBy:a,format:c}]}})})},n.prototype.loadWeights=function(e){return qe(this,void 0,void 0,function(){var r,i,o,s,a,c,f,m,y;return Ke(this,function(w){switch(w.label){case 0:for(void 0,void 0,A=(E=Array.isArray(this.path)?this.path[1]:this.path).lastIndexOf("/"),_=E.lastIndexOf("?"),r=[E.substring(0,A)+"/",_>A?E.substring(_):""],i=r[0],o=r[1],s=this.weightPathPrefix||i,a=[],c=0,f=e;c<f.length;c++)a.push.apply(a,f[c].weights);return m=[],e.forEach(function(E){E.paths.forEach(function(A){m.push(s+A+o)})}),[4,fT(m,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return y=w.sent(),[2,[a,oy(y)]]}var E,A,_})})},n.URL_SCHEME_REGEX=/^https?:\/\//,n}();function uy(n){return null!=n.match(hT.URL_SCHEME_REGEX)}var pT=function(n,e){return"undefined"==typeof fetch?null:(Array.isArray(n)?n.every(function(t){return uy(t)}):uy(n))?cy(n,{onProgress:e}):null};function cy(n,e){return new hT(n,e)}Io.registerSaveRouter(pT),Io.registerLoadRouter(pT);var jl,ly=function(){function n(e){this.modelArtifacts=e}return n.prototype.load=function(){return qe(this,void 0,void 0,function(){return Ke(this,function(e){return[2,this.modelArtifacts]})})},n}(),QU=function(){function n(e){this.saveHandler=e}return n.prototype.save=function(e){return qe(this,void 0,void 0,function(){return Ke(this,function(t){return[2,this.saveHandler(e)]})})},n}(),gT=Object.freeze({browserFiles:function(n){return new KU(n)},browserHTTPRequest:function(n,e){return cy(n,e)},concatenateArrayBuffers:oy,decodeWeights:eT,encodeWeights:function(n,e){return qe(this,void 0,void 0,function(){var t,r,i,o,s,a=this;return Ke(this,function(c){switch(c.label){case 0:for(t=[],r=[],i=Array.isArray(n)?n.map(function(f){return f.name}):Object.keys(n),o=function(f){var p=i[f],m=Array.isArray(n)?n[f].tensor:n[p];if("float32"!==m.dtype&&"int32"!==m.dtype&&"bool"!==m.dtype&&"string"!==m.dtype)throw new Error("Unsupported dtype in weight '"+p+"': "+m.dtype);var y={name:p,shape:m.shape,dtype:m.dtype};if("string"===m.dtype){var w=new Promise(function(E){return qe(a,void 0,void 0,function(){var A,_,T,N,M,R,P;return Ke(this,function(B){switch(B.label){case 0:return[4,m.bytes()];case 1:for(A=B.sent(),_=A.reduce(function(Y,X){return Y+X.length},0)+4*A.length,T=new Uint8Array(_),N=0,M=0;M<A.length;M++)R=A[M],P=new Uint8Array(new Uint32Array([R.length]).buffer),T.set(P,N),T.set(R,N+=4),N+=R.length;return E(T),[2]}})})});r.push(w)}else r.push(m.data());null!=e&&(y.group=e),t.push(y)},s=0;s<i.length;++s)o(s);return[4,Promise.all(r)];case 1:return[2,{data:BU(c.sent()),specs:t}]}})})},fromMemory:function(n,e,t,r){return 1===arguments.length?null!=n.modelTopology||null!=n.weightSpecs?new ly(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new ly({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new ly({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:r}))},getLoadHandlers:function(n,e){return Io.getLoadHandlers(n,e)},getModelArtifactsInfoForJSON:Md,getSaveHandlers:function(n){return Io.getSaveHandlers(n)},http:cy,isHTTPScheme:uy,loadWeights:function(n,e,t,r){return void 0===e&&(e=""),qe(this,void 0,void 0,function(){return Ke(this,function(i){return[2,dT(function(o){return fT(o,{requestInit:r})})(n,e,t)]})})},registerLoadRouter:function(n){return Io.registerLoadRouter(n)},registerSaveRouter:function(n){return Io.registerSaveRouter(n)},weightsLoaderFactory:dT,withSaveHandler:function(n){return new QU(n)},copyModel:function(n,e){return qe(this,void 0,void 0,function(){return Ke(this,function(t){return[2,rT(n,e,!1)]})})},listModels:function(){return qe(this,void 0,void 0,function(){var n,e,t,r,i,o,s;return Ke(this,function(a){switch(a.label){case 0:n=_u.getSchemes(),e={},t=0,r=n,a.label=1;case 1:return t<r.length?[4,_u.getManager(i=r[t]).listModels()]:[3,4];case 2:for(s in o=a.sent())e[i+Ll+s]=o[s];a.label=3;case 3:return t++,[3,1];case 4:return[2,e]}})})},moveModel:function(n,e){return qe(this,void 0,void 0,function(){return Ke(this,function(t){return[2,rT(n,e,!0)]})})},removeModel:function(n){return qe(this,void 0,void 0,function(){var e;return Ke(this,function(t){return e=o0(n),[2,_u.getManager(e.scheme).removeModel(e.path)]})})}}),$U=$({confusionMatrix_:function(n,e,t){var r=U(n,"labels","confusionMatrix"),i=U(e,"predictions","confusionMatrix");H(null==t||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, but got "+t}),H(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),H(1===i.rank,function(){return"Expected the rank of predictions to be 1, but got "+i.rank}),H(r.shape[0]===i.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."}),H(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+t});var o=hv(r.asType("int32"),t),s=hv(i.asType("int32"),t);return o.transpose().matMul(s).asType("int32")}}),ZU=(Object.freeze({confusionMatrix:$U}),$({fromPixels_:function(n,e){if(void 0===e&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==n)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,r=!1,i=!1,o=!1,s=!1;if(n.data instanceof Uint8Array)t=!0;else if("undefined"!=typeof ImageData&&n instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&n instanceof HTMLVideoElement)i=!0;else if("undefined"!=typeof HTMLImageElement&&n instanceof HTMLImageElement)o=!0;else{if(null==n.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+n.constructor.name);s=!0}if(i&&i&&n.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=sI("FromPixels",Q.backendName))return Q.runKernel("FromPixels",{pixels:n},{numChannels:e});var a,c,f=i?[n.videoWidth,n.videoHeight]:[n.width,n.height],p=f[0],m=f[1];if(s?a=n.getContext("2d").getImageData(0,0,p,m).data:r||t?a=n.data:(o||i)&&(null==jl&&(jl=document.createElement("canvas").getContext("2d")),jl.canvas.width=p,jl.canvas.height=m,jl.drawImage(n,0,0,p,m),a=jl.getImageData(0,0,p,m).data),4===e)c=new Int32Array(a);else{var y=p*m;c=new Int32Array(y*e);for(var w=0;w<y;w++)for(var E=0;E<e;++E)c[w*e+E]=a[4*w+E]}return lv(c,[m,p,e],"int32")}})),fy=Object.freeze({toPixels:function(n,e){return qe(this,void 0,void 0,function(){var t,r,i,o,s,a,c,f,p,w,E,A,_,T,N,M,R,P,B,Y,X;return Ke(this,function(z){switch(z.label){case 0:if(t=U(n,"img","toPixels"),n instanceof Fn||(t=t.toInt()),2!==t.rank&&3!==t.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(r=t.shape.slice(0,2),i=r[0],o=r[1],(s=2===t.rank?1:t.shape[2])>4||2===s)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+s);return[4,t.data()];case 1:return a=z.sent(),c=t.min(),f=t.max(),[4,Promise.all([c.data(),f.data()])];case 2:if(p=z.sent(),w=p[0][0],E=p[1][0],c.dispose(),f.dispose(),"float32"===t.dtype){if(w<0||E>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+w+" - "+E+"].")}else{if("int32"!==t.dtype)throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(w<0||E>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+w+" - "+E+"].")}for(A="float32"===t.dtype?255:1,_=new Uint8ClampedArray(o*i*4),T=0;T<i*o;++T)N=void 0,M=void 0,R=void 0,P=void 0,1===s?(N=a[T]*A,M=a[T]*A,R=a[T]*A,P=255):3===s?(N=a[3*T]*A,M=a[3*T+1]*A,R=a[3*T+2]*A,P=255):4===s&&(N=a[4*T]*A,M=a[4*T+1]*A,R=a[4*T+2]*A,P=a[4*T+3]*A),_[0+(B=4*T)]=Math.round(N),_[B+1]=Math.round(M),_[B+2]=Math.round(R),_[B+3]=Math.round(P);return null!=e&&(e.width=o,e.height=i,Y=e.getContext("2d"),X=new ImageData(_,o,i),Y.putImageData(X,0,0)),t!==n&&t.dispose(),[2,_]}})})},fromPixels:ZU}),mT=function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(e,t){return new e(t)},n}(),vT=function(){function n(){this.classNameMap={}}return n.getMap=function(){return null==n.instance&&(n.instance=new n),n.instance},n.register=function(e){n.getMap().classNameMap[e.className]=[e,e.fromConfig]},n}();function Au(n){H(null!=n.className,function(){return"Class being registered does not have the static className property defined."}),H("string"==typeof n.className,function(){return"className is required to be a string, but got type "+typeof n.className}),H(n.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),vT.register(n)}function dy(){return 32===Q.backend.floatPrecision()?.001:.1}function hy(n,e,t){var r=!0;if((ui(n)||ui(e))&&(r=!1),ui(n)&&ui(e)&&(r=!0),r){var i=n.constructor.name,o=e.constructor.name;if(i!==o)throw new Error("Arrays are of different type. Actual: "+i+". Expected: "+o)}if(Array.isArray(n)&&Array.isArray(e)){var s=oa(n),a=oa(e);if(!Rr(s,a))throw new Error("Arrays have different shapes. Actual: ["+s+"]. Expected: ["+a+"]")}var c=ui(n)?n:Ta(n),f=ui(e)?e:Ta(e);if(c.length!==f.length)throw new Error("Arrays have different lengths actual: "+c.length+" vs expected: "+f.length+".\nActual:   "+c+".\nExpected: "+f+".");for(var p=0;p<f.length;++p){var m=c[p],y=f[p];if(!t(m,y))throw new Error("Arrays differ: actual["+p+"] = "+m+", expected["+p+"] = "+y+".\nActual:   "+c+".\nExpected: "+f+".")}}function py(n,e,t){return!isFinite(n)&&!isFinite(e)||!(isNaN(n)||isNaN(e)||Math.abs(n-e)>t)}Object.freeze({Serializable:mT,SerializationMap:vT,registerClass:Au}),Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(n,e,t){return null==t&&(t=dy()),hy(n,e,function(r,i){return py(r,i,t)})},testEpsilon:dy,expectPromiseToFail:function(n,e){n().then(function(){return e.fail()},function(){return e()})},expectArraysEqual:function(n,e){var t="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return yu(n)||yu(n[0])||yu(e)||yu(e[0])?hy(n,t,function(r,i){return r==i}):hy(n,e,function(r,i){return py(r,i,0)})},expectNumbersClose:function(n,e,t){if(null==t&&(t=dy()),!py(n,e,t))throw new Error("Numbers differ: actual === "+n+", expected === "+e)},expectValuesInRange:function(n,e,t){for(var r=0;r<n.length;r++)if(n[r]<e||n[r]>t)throw new Error("Value out of range:"+n[r]+" low: "+e+", high: "+t)},expectArrayBuffersEqual:function(n,e){expect(new Float32Array(n)).toEqual(new Float32Array(e))}}),Object.freeze({gpgpu_util:C7,webgl_util:YB,forceHalfFloat:function(){le().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:gD,setWebGLContext:TI,GPGPUContext:ZA});var hc=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return ws(e,n),e.prototype.minimize=function(t,r,i){void 0===r&&(r=!1);var o=this.computeGradients(t,i),s=o.value,a=o.grads;if(null!=i){var c=i.map(function(f){return{name:f.name,tensor:a[f.name]}});this.applyGradients(c)}else this.applyGradients(a);return to(a),r?s:(s.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,r){return function(n,e){H(xu(n),function(){return"The f passed in variableGrads(f) must be a function"}),H(null==e||Array.isArray(e)&&e.every(function(p){return p instanceof Dl}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=null!=e;if(!t)for(var r in e=[],Q.registeredVariables)e.push(Q.registeredVariables[r]);var i=t?e.filter(function(p){return!p.trainable}):null,o=e.length;H((e=e.filter(function(p){return p.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."});var s=Q.gradients(n,e,null,!0),a=s.value,c=s.grads;H(c.some(function(p){return null!=p}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),H(0===a.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+a.rank+" tensor"});var f={};return e.forEach(function(p,m){null!=c[m]&&(f[p.name]=c[m])}),null!=i&&i.forEach(function(p){return f[p.name]=null}),{value:a,grads:f}}(t,r)},e.prototype.dispose=function(){null!=this.iterations_&&to(this.iterations_)},e.prototype.saveIterations=function(){return qe(this,void 0,void 0,function(){return Ke(this,function(t){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:Pe(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return qe(this,void 0,void 0,function(){return Ke(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return qe(this,void 0,void 0,function(){return Ke(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(t){return qe(this,void 0,void 0,function(){var r;return Ke(this,function(i){switch(i.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=i.sent()[0],[2,t.slice(1)]}})})},e}(mT);Object.defineProperty(hc,Symbol.hasInstance,{value:function(n){return null!=n.minimize&&null!=n.computeGradients&&null!=n.applyGradients}});var xT=function(n){function e(t,r,i){void 0===i&&(i=null);var o=n.call(this)||this;return o.learningRate=t,o.rho=r,o.epsilon=i,o.accumulatedGrads=[],o.accumulatedUpdates=[],null==i&&(o.epsilon=Q.backend.epsilon()),o}return ws(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var s=Q.registeredVariables[i];null==r.accumulatedGrads[o]&&(r.accumulatedGrads[o]={originalName:i+"/accum_grad",variable:We(function(){return dn(s).variable(!1)})}),null==r.accumulatedUpdates[o]&&(r.accumulatedUpdates[o]={originalName:i+"/accum_var",variable:We(function(){return dn(s).variable(!1)})});var a=Array.isArray(t)?t[o].tensor:t[i];if(null!=a){var c=r.accumulatedGrads[o].variable,f=r.accumulatedUpdates[o].variable;We(function(){var p=c.mul(r.rho).add(a.square().mul(1-r.rho)),m=f.add(r.epsilon).sqrt().div(c.add(r.epsilon).sqrt()).mul(a),y=f.mul(r.rho).add(m.square().mul(1-r.rho));c.assign(p),f.assign(y);var w=m.mul(-r.learningRate).add(s);s.assign(w)})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedUpdates&&(to(this.accumulatedGrads.map(function(t){return t.variable})),to(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return qe(this,void 0,void 0,function(){var t;return Ke(this,function(r){switch(r.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return qe(this,void 0,void 0,function(){var r;return Ke(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),this.accumulatedGrads=t.slice(0,r=t.length/2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedUpdates=t.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},e.className="Adadelta",e}(hc);Au(xT);var wT=function(n){function e(t,r){void 0===r&&(r=.1);var i=n.call(this)||this;return i.learningRate=t,i.initialAccumulatorValue=r,i.accumulatedGrads=[],i}return ws(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var s=Q.registeredVariables[i];null==r.accumulatedGrads[o]&&(r.accumulatedGrads[o]={originalName:i+"/accumulator",variable:We(function(){return aa(s.shape,r.initialAccumulatorValue).variable(!1)})});var a=Array.isArray(t)?t[o].tensor:t[i];if(null!=a){var c=r.accumulatedGrads[o].variable;We(function(){var f=c.add(a.square());c.assign(f);var p=a.div(f.add(Q.backend.epsilon()).sqrt()).mul(-r.learningRate).add(s);s.assign(p)})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedGrads&&to(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return qe(this,void 0,void 0,function(){return Ke(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return qe(this,void 0,void 0,function(){return Ke(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},e.className="Adagrad",e}(hc);Au(wT);var bT=function(n){function e(t,r,i,o){void 0===o&&(o=null);var s=n.call(this)||this;return s.learningRate=t,s.beta1=r,s.beta2=i,s.epsilon=o,s.accumulatedFirstMoment=[],s.accumulatedSecondMoment=[],We(function(){s.accBeta1=Pe(r).variable(),s.accBeta2=Pe(i).variable()}),null==o&&(s.epsilon=Q.backend.epsilon()),s}return ws(e,n),e.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t);We(function(){var o=Yr(1,r.accBeta1),s=Yr(1,r.accBeta2);i.forEach(function(a,c){var f=Q.registeredVariables[a];null==r.accumulatedFirstMoment[c]&&(r.accumulatedFirstMoment[c]={originalName:a+"/m",variable:We(function(){return dn(f).variable(!1)})}),null==r.accumulatedSecondMoment[c]&&(r.accumulatedSecondMoment[c]={originalName:a+"/v",variable:We(function(){return dn(f).variable(!1)})});var p=Array.isArray(t)?t[c].tensor:t[a];if(null!=p){var m=r.accumulatedFirstMoment[c].variable,y=r.accumulatedSecondMoment[c].variable,w=m.mul(r.beta1).add(p.mul(1-r.beta1)),E=y.mul(r.beta2).add(p.square().mul(1-r.beta2)),A=w.div(o),_=E.div(s);m.assign(w),y.assign(E);var T=A.div(_.sqrt().add(r.epsilon)).mul(-r.learningRate).add(f);f.assign(T)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&to(this.accumulatedFirstMoment.map(function(t){return t.variable})),null!=this.accumulatedSecondMoment&&to(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return qe(this,void 0,void 0,function(){var t;return Ke(this,function(r){switch(r.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return qe(this,void 0,void 0,function(){var r,i=this;return Ke(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),We(function(){i.accBeta1.assign(Zp(i.beta1,i.iterations_+1)),i.accBeta2.assign(Zp(i.beta2,i.iterations_+1))}),this.accumulatedFirstMoment=t.slice(0,r=t.length/2).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),this.accumulatedSecondMoment=t.slice(r,2*r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},e.className="Adam",e}(hc);Au(bT);var CT=function(n){function e(t,r,i,o,s){void 0===o&&(o=null),void 0===s&&(s=0);var a=n.call(this)||this;return a.learningRate=t,a.beta1=r,a.beta2=i,a.epsilon=o,a.decay=s,a.accumulatedFirstMoment=[],a.accumulatedWeightedInfNorm=[],We(function(){a.iteration=Pe(0).variable(),a.accBeta1=Pe(r).variable()}),null==o&&(a.epsilon=Q.backend.epsilon()),a}return ws(e,n),e.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t);We(function(){var o=Yr(1,r.accBeta1),s=Ds(-r.learningRate,r.iteration.mul(r.decay).add(1));i.forEach(function(a,c){var f=Q.registeredVariables[a];null==r.accumulatedFirstMoment[c]&&(r.accumulatedFirstMoment[c]={originalName:a+"/m",variable:dn(f).variable(!1)}),null==r.accumulatedWeightedInfNorm[c]&&(r.accumulatedWeightedInfNorm[c]={originalName:a+"/v",variable:dn(f).variable(!1)});var p=Array.isArray(t)?t[c].tensor:t[a];if(null!=p){var m=r.accumulatedFirstMoment[c].variable,y=r.accumulatedWeightedInfNorm[c].variable,w=m.mul(r.beta1).add(p.mul(1-r.beta1)),E=y.mul(r.beta2),A=p.abs(),_=E.maximum(A);m.assign(w),y.assign(_);var T=s.div(o).mul(w.div(_.add(r.epsilon))).add(f);f.assign(T)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&to(this.accumulatedFirstMoment.map(function(t){return t.variable})),null!=this.accumulatedWeightedInfNorm&&to(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return qe(this,void 0,void 0,function(){return Ke(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return qe(this,void 0,void 0,function(){return Ke(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e.className="Adamax",e}(hc);Au(CT);var gy=function(n){function e(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return ws(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var s=Array.isArray(t)?t[o].tensor:t[i];if(null!=s){var a=Q.registeredVariables[i];We(function(){var c=r.c.mul(s).add(a);a.assign(c)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=function(n){return Q.keep(n)}(Pe(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return qe(this,void 0,void 0,function(){return Ke(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return qe(this,void 0,void 0,function(){return Ke(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if(0!==(t=r.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,r){return new t(r.learningRate)},e.className="SGD",e}(hc);Au(gy);var ET=function(n){function e(t,r,i){void 0===i&&(i=!1);var o=n.call(this,t)||this;return o.learningRate=t,o.momentum=r,o.useNesterov=i,o.accumulations=[],o.m=Pe(o.momentum),o}return ws(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var s=Q.registeredVariables[i];null==r.accumulations[o]&&(r.accumulations[o]={originalName:i+"/momentum",variable:We(function(){return dn(s).variable(!1)})});var a=r.accumulations[o].variable,c=Array.isArray(t)?t[o].tensor:t[i];null!=c&&We(function(){var f,p=r.m.mul(a).add(c);f=r.useNesterov?r.c.mul(c.add(p.mul(r.m))).add(s):r.c.mul(p).add(s),a.assign(p),s.assign(f)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&to(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return qe(this,void 0,void 0,function(){return Ke(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return qe(this,void 0,void 0,function(){return Ke(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},e.className="Momentum",e}(gy);Au(ET);var _T=function(n){function e(t,r,i,o,s){void 0===r&&(r=.9),void 0===i&&(i=0),void 0===o&&(o=null),void 0===s&&(s=!1);var a=n.call(this)||this;if(a.learningRate=t,a.decay=r,a.momentum=i,a.epsilon=o,a.accumulatedMeanSquares=[],a.accumulatedMoments=[],a.accumulatedMeanGrads=[],a.centered=s,null==o&&(a.epsilon=Q.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.");return a}return ws(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var s=Q.registeredVariables[i];null==r.accumulatedMeanSquares[o]&&(r.accumulatedMeanSquares[o]={originalName:i+"/rms",variable:We(function(){return dn(s).variable(!1)})}),null==r.accumulatedMoments[o]&&(r.accumulatedMoments[o]={originalName:i+"/momentum",variable:We(function(){return dn(s).variable(!1)})}),null==r.accumulatedMeanGrads[o]&&r.centered&&(r.accumulatedMeanGrads[o]={originalName:i+"/mg",variable:We(function(){return dn(s).variable(!1)})});var a=Array.isArray(t)?t[o].tensor:t[i];if(null!=a){var c=r.accumulatedMeanSquares[o].variable,f=r.accumulatedMoments[o].variable;We(function(){var p=c.mul(r.decay).add(a.square().mul(1-r.decay));if(r.centered){var m=r.accumulatedMeanGrads[o].variable,y=m.mul(r.decay).add(a.mul(1-r.decay)),w=f.mul(r.momentum).add(a.mul(r.learningRate).div(p.sub(y.square().add(r.epsilon)).sqrt()));c.assign(p),m.assign(y),f.assign(w);var E=s.sub(w);s.assign(E)}else{var A=c.mul(r.decay).add(a.square().mul(1-r.decay));w=f.mul(r.momentum).add(a.mul(r.learningRate).div(A.add(r.epsilon).sqrt())),c.assign(A),f.assign(w),E=s.sub(w),s.assign(E)}})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&to(this.accumulatedMeanSquares.map(function(t){return t.variable})),null!=this.accumulatedMeanGrads&&this.centered&&to(this.accumulatedMeanGrads.map(function(t){return t.variable})),null!=this.accumulatedMoments&&to(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return qe(this,void 0,void 0,function(){var t;return Ke(this,function(r){switch(r.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return qe(this,void 0,void 0,function(){var r;return Ke(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),this.accumulatedMeanSquares=t.slice(0,r=this.centered?t.length/3:t.length/2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedMoments=t.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(2*r,3*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e.className="RMSProp",e}(hc);Au(_T),function(){function n(){}n.sgd=function(e){return new gy(e)},n.momentum=function(e,t,r){return void 0===r&&(r=!1),new ET(e,t,r)},n.rmsprop=function(e,t,r,i,o){return void 0===t&&(t=.9),void 0===r&&(r=0),void 0===i&&(i=null),void 0===o&&(o=!1),new _T(e,t,r,i,o)},n.adam=function(e,t,r,i){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===r&&(r=.999),void 0===i&&(i=null),new bT(e,t,r,i)},n.adadelta=function(e,t,r){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===r&&(r=null),new xT(e,t,r)},n.adamax=function(e,t,r,i,o){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===r&&(r=.999),void 0===i&&(i=null),void 0===o&&(o=0),new CT(e,t,r,i,o)},n.adagrad=function(e,t){return void 0===t&&(t=.1),new wT(e,t)}}(),"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate&&setImmediate,Fn.prototype.squaredDifference=function(n){return mD(this,n)},ue=RU;var my=function(n,e){return(my=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])})(n,e)};function At(n,e){function t(){this.constructor=n}my(n,e),n.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}var Di=function(){return(Di=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function et(n,e,t,r){return new(t||(t=Promise))(function(o,s){function a(p){try{f(r.next(p))}catch(m){s(m)}}function c(p){try{f(r.throw(p))}catch(m){s(m)}}function f(p){p.done?o(p.value):function(o){return o instanceof t?o:new t(function(s){s(o)})}(p.value).then(a,c)}f((r=r.apply(n,e||[])).next())})}function tt(n,e){var r,i,o,s,t={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(f){return function(p){return function(f){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=2&f[0]?i.return:f[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,f[1])).done)return o;switch(i=0,o&&(f=[2&f[0],o.value]),f[0]){case 0:case 1:o=f;break;case 4:return t.label++,{value:f[1],done:!1};case 5:t.label++,i=f[1],f=[0];continue;case 7:f=t.ops.pop(),t.trys.pop();continue;default:if(!(o=(o=t.trys).length>0&&o[o.length-1])&&(6===f[0]||2===f[0])){t=0;continue}if(3===f[0]&&(!o||f[1]>o[0]&&f[1]<o[3])){t.label=f[1];break}if(6===f[0]&&t.label<o[1]){t.label=o[1],o=f;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(f);break}o[2]&&t.ops.pop(),t.trys.pop();continue}f=e.call(n,t)}catch(p){f=[6,p],i=0}finally{r=o=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}([f,p])}}}function Od(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;var r=Array(n),i=0;for(e=0;e<t;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}var Wl=function(){function n(e,t){if(!gc(e)||!gc(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),n.prototype.reverse=function(){return new n(1/this.width,1/this.height)},n}();function Fd(n,e){return n instanceof Fn&&n.shape.length===e}function a0(n){return Fd(n,3)}function Du(n){return Fd(n,4)}function AT(n){return n%2==0}function DT(n){return n&&n.width&&n.height}function vy(n){return n.reduce(function(e,t){return e.add(t)},new yn(0,0)).div(new yn(n.length,n.length))}function Pd(n,e,t){return Array(n).fill(0).map(function(r,i){return e+i*t})}function gc(n){return!!n&&n!==1/0&&n!==-1/0&&!isNaN(n)||0===n}function TT(n){return gc(n)&&0<=n&&n<=1}var yn=function(){function n(e,t){this._x=e,this._y=t}return Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),n.prototype.add=function(e){return new n(this.x+e.x,this.y+e.y)},n.prototype.sub=function(e){return new n(this.x-e.x,this.y-e.y)},n.prototype.mul=function(e){return new n(this.x*e.x,this.y*e.y)},n.prototype.div=function(e){return new n(this.x/e.x,this.y/e.y)},n.prototype.abs=function(){return new n(Math.abs(this.x),Math.abs(this.y))},n.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},n.prototype.floor=function(){return new n(Math.floor(this.x),Math.floor(this.y))},n}(),ka=function(){function n(e,t){void 0===t&&(t=!0);var r=e||{},i=[r.left,r.top,r.right,r.bottom].every(gc),o=[r.x,r.y,r.width,r.height].every(gc);if(!o&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var s=o?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],a=s[0],c=s[1],f=s[2],p=s[3];n.assertIsValidBox({x:a,y:c,width:f,height:p},"Box.constructor",t),this._x=a,this._y=c,this._width=f,this._height=p}return n.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(gc)},n.assertIsValidBox=function(e,t,r){if(void 0===r&&(r=!1),!n.isRect(e))throw new Error(t+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw new Error(t+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topLeft",{get:function(){return new yn(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topRight",{get:function(){return new yn(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomLeft",{get:function(){return new yn(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomRight",{get:function(){return new yn(this.right,this.bottom)},enumerable:!0,configurable:!0}),n.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(s){return Math.round(s)});return new n({x:e[0],y:e[1],width:e[2],height:e[3]})},n.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(s){return Math.floor(s)});return new n({x:e[0],y:e[1],width:e[2],height:e[3]})},n.prototype.toSquare=function(){var e=this,t=e.x,r=e.y,i=e.width,o=e.height,s=Math.abs(i-o);return i<o&&(t-=s/2,i+=s),o<i&&(r-=s/2,o+=s),new n({x:t,y:r,width:i,height:o})},n.prototype.rescale=function(e){var t=DT(e)?e.width:e,r=DT(e)?e.height:e;return new n({x:this.x*t,y:this.y*r,width:this.width*t,height:this.height*r})},n.prototype.pad=function(e,t){var r=[this.x-e/2,this.y-t/2,this.width+e,this.height+t];return new n({x:r[0],y:r[1],width:r[2],height:r[3]})},n.prototype.clipAtImageBorders=function(e,t){var r=this,o=r.y,s=r.right,a=r.bottom,c=Math.max(r.x,0),f=Math.max(o,0),m=a-f;return new n({x:c,y:f,width:Math.min(s-c,e-c),height:Math.min(m,t-f)}).floor()},n.prototype.shift=function(e,t){return new n({x:this.x+e,y:this.y+t,width:this.width,height:this.height})},n.prototype.padAtBorders=function(e,t){var r=this.width+1,i=this.height+1,a=r,c=i,f=this.left,p=this.top,m=this.right,y=this.bottom;return m>t&&(a=-m+t+r,m=t),y>e&&(c=-y+e+i,y=e),f<1&&(c=2-f,f=1),p<1&&(c=2-p,p=1),{dy:1,edy:c,dx:1,edx:a,y:p,ey:y,x:f,ex:m,w:r,h:i}},n.prototype.calibrate=function(e){return new n({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},n}(),u0=function(n){function e(t,r,i,o,s){return void 0===s&&(s=!1),n.call(this,{left:t,top:r,right:i,bottom:o},s)||this}return At(e,n),e}(ka),ST=function(){function n(e,t,r,i,o){this._imageDims=new Wl(o.width,o.height),this._score=e,this._classScore=t,this._className=r,this._box=new ka(i).rescale(this._imageDims)}return Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativeBox",{get:function(){return new ka(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new n(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:t})},n}(),ca=function(n){function e(t,r,i){return n.call(this,t,t,"",r,i)||this}return At(e,n),e.prototype.forSize=function(t,r){var i=n.prototype.forSize.call(this,t,r);return new e(i.score,i.relativeBox,i.imageDims)},e}(ST);function aj(n,e,t){void 0===t&&(t=!0);var o=Math.max(0,Math.min(n.right,e.right)-Math.max(n.left,e.left))*Math.max(0,Math.min(n.bottom,e.bottom)-Math.max(n.top,e.top));return t?o/(n.area+e.area-o):o/Math.min(n.area,e.area)}function kd(n,e,t,r){void 0===r&&(r=!0);for(var i=e.map(function(a,c){return{score:a,boxIndex:c}}).sort(function(a,c){return a.score-c.score}).map(function(a){return a.boxIndex}),o=[],s=function(){var a=i.pop();o.push(a);for(var c=i,f=[],p=0;p<c.length;p++)f.push(aj(n[a],n[c[p]],r));i=i.filter(function(E,A){return f[A]<=t})};i.length>0;)s();return o}function Ld(n,e){return We(function(){var t=e[0],r=e[1],i=e[2],o=aa(Od(n.shape.slice(0,3),[1]),t),s=aa(Od(n.shape.slice(0,3),[1]),r),a=aa(Od(n.shape.slice(0,3),[1]),i),c=zr([o,s,a],3);return Yr(n,c)})}function yy(n){return 1/(1+Math.exp(-n))}var Xr,xy=function(n){function e(t,r,i,o,s){return void 0===s&&(s=!1),n.call(this,{x:t,y:r,width:i,height:o},s)||this}return At(e,n),e}(ka),c0=function(){function n(e,t,r){void 0===r&&(r=new yn(0,0));var i=t.width,o=t.height;this._imgDims=new Wl(i,o),this._shift=r,this._positions=e.map(function(s){return s.mul(new yn(i,o)).add(r)})}return Object.defineProperty(n.prototype,"shift",{get:function(){return new yn(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new yn(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},n.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new yn(e,t))},n.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},n.prototype.align=function(e,t){if(void 0===t&&(t={}),e){var r=e instanceof ca?e.box.floor():new ka(e);return this.shiftBy(r.x,r.y).align(null,t)}var i=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),s=i.minBoxPadding;return i.useDlibAlignment?this.alignDlib():this.alignMinBbox(s)},n.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),r=e[1],i=e[2],o=function(m){return i.sub(m).magnitude()},s=(o(e[0])+o(r))/2,a=Math.floor(s/.45),c=vy(e),f=Math.floor(Math.max(0,c.x-.5*a)),p=Math.floor(Math.max(0,c.y-.43*a));return new xy(f,p,Math.min(a,this.imageWidth+f),Math.min(a,this.imageHeight+p))},n.prototype.alignMinBbox=function(e){var t=function(n){var e=n.map(function(a){return a.x}),t=n.map(function(a){return a.y}),r=e.reduce(function(a,c){return c<a?c:a},1/0),i=t.reduce(function(a,c){return c<a?c:a},1/0),o=e.reduce(function(a,c){return a<c?c:a},0),s=t.reduce(function(a,c){return a<c?c:a},0);return new u0(r,i,o,s)}(this.positions);return t.pad(t.width*e,t.height*e)},n.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},n}(),dj=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return At(e,n),e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],vy([t[3],t[4]])]},e}(c0),NT=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return At(e,n),e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(vy)},e}(c0),RT=function(){function n(e,t){this._label=e,this._distance=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),n.prototype.toString=function(e){return void 0===e&&(e=!0),this.label+(e?" ("+function(n,e){void 0===e&&(e=2);var t=Math.pow(10,e);return Math.floor(n*t)/t}(this.distance)+")":"")},n}(),MT=function(n){function e(t,r){var i=n.call(this,t)||this;return i._label=r,i}return At(e,n),e.assertIsValidLabeledBox=function(t,r){if(ka.assertIsValidBox(t,r),!gc(t.label))throw new Error(r+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e}(ka),l0=function(){function n(e,t){if("string"!=typeof e)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),n.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(e){return Array.from(e)})}},n.fromJSON=function(e){var t=e.descriptors.map(function(r){return new Float32Array(r)});return new n(e.label,t)},n}();function wy(n,e){return Object.assign({},n,{detection:e})}function OT(){var n=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:n,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function FT(n){var e="";if(!n)try{n=ve(730)}catch(r){e=r.toString()}return{readFile:n?function(r){return new Promise(function(i,o){n.readFile(r,function(s,a){return s?o(s):i(a)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)}}}function PT(){var n=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,i=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=FT();return Di({Canvas:n||function(){},CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){},Image:e||function(){},ImageData:global.ImageData||function(){},Video:global.HTMLVideoElement||function(){},createCanvasElement:function(){if(n)return new n;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:i},o)}function kT(){return"object"==typeof window&&"undefined"!=typeof document&&"undefined"!=typeof HTMLImageElement&&"undefined"!=typeof HTMLCanvasElement&&"undefined"!=typeof HTMLVideoElement&&"undefined"!=typeof ImageData&&"undefined"!=typeof CanvasRenderingContext2D}function LT(){return"object"==typeof global&&"undefined"!=typeof process&&!!process.version}function by(n){Xr=n}function Cy(){kT()&&by(OT()),LT()&&by(PT())}!function(n){function e(t,r,i,o){var s=n.call(this,t,r)||this;return s._score=i,s._classScore=o,s}At(e,n),e.assertIsValidPredictedBox=function(t,r){if(MT.assertIsValidLabeledBox(t,r),!TT(t.score)||!TT(t.classScore))throw new Error(r+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(MT);var Ti={getEnv:function(){if(!Xr)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return Xr},setEnv:by,initialize:Cy,createBrowserEnv:OT,createFileSystem:FT,createNodejsEnv:PT,monkeyPatch:function(n){if(Xr||Cy(),!Xr)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=n.Canvas,t=void 0===e?Xr.Canvas:e,r=n.Image,i=void 0===r?Xr.Image:r;Xr.Canvas=t,Xr.Image=i,Xr.createCanvasElement=n.createCanvasElement||function(){return new t},Xr.createImageElement=n.createImageElement||function(){return new i},Xr.ImageData=n.ImageData||Xr.ImageData,Xr.Video=n.Video||Xr.Video,Xr.fetch=n.fetch||Xr.fetch,Xr.readFile=n.readFile||Xr.readFile},isBrowser:kT,isNodejs:LT};function Ey(n){return Ti.isNodejs()||"string"!=typeof n?n:document.getElementById(n)}function la(n){var e=Ti.getEnv(),t=e.Canvas;if(n instanceof e.CanvasRenderingContext2D)return n;var i=Ey(n);if(!(i instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=i.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}Cy();var La=(()=>(function(n){n.TOP_LEFT="TOP_LEFT",n.TOP_RIGHT="TOP_RIGHT",n.BOTTOM_LEFT="BOTTOM_LEFT",n.BOTTOM_RIGHT="BOTTOM_RIGHT"}(La||(La={})),La))(),BT=function(e){void 0===e&&(e={});var r=e.backgroundColor,i=e.fontColor,o=e.fontSize,s=e.fontStyle,a=e.padding;this.anchorPosition=e.anchorPosition||La.TOP_LEFT,this.backgroundColor=r||"rgba(0, 0, 0, 0.5)",this.fontColor=i||"rgba(255, 255, 255, 1)",this.fontSize=o||14,this.fontStyle=s||"Georgia",this.padding=a||4};!function(){function n(e,t,r){void 0===r&&(r={}),this.text="string"==typeof e?[e]:e instanceof n?e.text:e,this.anchor=t,this.options=new BT(r)}n.prototype.measureWidth=function(e){var t=this.options.padding;return this.text.map(function(r){return e.measureText(r).width}).reduce(function(r,i){return r<i?i:r},0)+2*t},n.prototype.measureHeight=function(){var e=this.options;return this.text.length*e.fontSize+2*e.padding},n.prototype.getUpperLeft=function(e,t){var r=this.options.anchorPosition,i=r===La.BOTTOM_RIGHT||r===La.TOP_RIGHT,o=r===La.BOTTOM_LEFT||r===La.BOTTOM_RIGHT,s=this.measureWidth(e),a=this.measureHeight(),c=i?this.anchor.x-s:this.anchor.x,f=o?this.anchor.y-a:this.anchor.y;if(t){var m=t.height;return{x:Math.max(Math.min(c,t.width-s),0),y:Math.max(Math.min(f,m-a),0)}}return{x:c,y:f}},n.prototype.draw=function(e){var t=Ey(e),r=la(t),i=this.options,o=i.backgroundColor,s=i.fontColor,a=i.fontSize,f=i.padding;r.font=a+"px "+i.fontStyle;var p=this.measureWidth(r),m=this.measureHeight();r.fillStyle=o;var y=this.getUpperLeft(r,t);r.fillRect(y.x,y.y,p,m),r.fillStyle=s,this.text.forEach(function(w,E){r.fillText(w,f+y.x,f+y.y+(E+1)*a)})}}();function VT(n){var e=Ti.getEnv();return n instanceof e.Image&&n.complete||n instanceof e.Video&&n.readyState>=3}function UT(n){var e=Ti.getEnv(),r=e.Video;return n instanceof e.Image?new Wl(n.naturalWidth,n.naturalHeight):n instanceof r?new Wl(n.videoWidth,n.videoHeight):new Wl(n.width,n.height)}function f0(n){var e=n.width,t=n.height,i=(0,Ti.getEnv().createCanvasElement)();return i.width=e,i.height=t,i}function _y(n,e){var t=Ti.getEnv().ImageData;if(!(n instanceof t||VT(n)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=e||UT(n),i=r.width,o=r.height,s=f0({width:i,height:o});return n instanceof t?la(s).putImageData(n,0,0):la(s).drawImage(n,0,0,i,o),s}function xj(n,e){return et(this,void 0,void 0,function(){var t,r,i,o,s,a;return tt(this,function(c){switch(c.label){case 0:return t=e||Ti.getEnv().createCanvasElement(),r=n.shape.slice(Du(n)?1:0),i=r[0],o=r[1],s=r[2],a=We(function(){return n.as3D(i,o,s).toInt()}),[4,fy.toPixels(a,t)];case 1:return c.sent(),a.dispose(),[2,t]}})})}function jT(n){var e=Ti.getEnv();return n instanceof e.Image||n instanceof e.Canvas||n instanceof e.Video}var d0=function(){function n(e,t){var r=this;if(void 0===t&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(i,o){if(a0(i))return r._imageTensors[o]=i,void(r._inputDimensions[o]=i.shape);if(Du(i)){var s=i.shape[0];if(1!==s)throw new Error("NetInput - tf.Tensor4D with batchSize "+s+" passed, but not supported in input array");return r._imageTensors[o]=i,void(r._inputDimensions[o]=i.shape.slice(1))}var a=i instanceof Ti.getEnv().Canvas?i:_y(i);r._canvases[o]=a,r._inputDimensions[o]=[a.height,a.width,3]})}return Object.defineProperty(n.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"reshapedInputDimensions",{get:function(){var e=this;return Pd(this.batchSize,0,1).map(function(t,r){return e.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),n.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},n.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},n.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},n.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},n.prototype.getReshapedInputDimensions=function(e){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function(n,e){var t=n.width,r=n.height,i=e/Math.max(r,t);return new Wl(Math.round(t*i),Math.round(r*i))}({width:this.getInputWidth(e),height:this.getInputHeight(e)},this.inputSize)},n.prototype.toBatchTensor=function(e,t){var r=this;return void 0===t&&(t=!0),this._inputSize=e,We(function(){var i=Pd(r.batchSize,0,1).map(function(s){var a=r.getInput(s);if(a instanceof Fn){var c=Du(a)?a:a.expandDims();return((c=function(n,e){return void 0===e&&(e=!1),We(function(){var t=n.shape.slice(1),r=t[0],i=t[1];if(r===i)return n;var o=Math.abs(r-i),s=Math.round(o*(e?.5:1)),a=r>i?2:1,c=function(w){var E=n.shape.slice();return E[a]=w,aa(E,0)},f=c(s),p=o-f.shape[a],y=[e&&p?c(p):null,n,f].filter(function(w){return!!w}).map(function(w){return w.toFloat()});return zr(y,a)})}(c,t)).shape[1]!==e||c.shape[2]!==e)&&(c=Xv.resizeBilinear(c,[e,e])),c.as3D(e,e,3)}if(a instanceof Ti.getEnv().Canvas)return fy.fromPixels(function(n,e,t){void 0===t&&(t=!1);var r=Ti.getEnv(),o=r.Canvas;if(!(n instanceof r.Image||n instanceof o))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var s=UT(n),a=e/Math.max(s.height,s.width),c=a*s.width,f=a*s.height,p=f0({width:e,height:e}),m=n instanceof o?n:_y(n),y=Math.abs(c-f)/2,w=t&&c<f?y:0,E=t&&f<c?y:0;return la(p).drawImage(m,w,E,c,f),p}(a,e,t));throw new Error("toBatchTensor - at batchIdx "+s+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+a)});return _o(i.map(function(s){return s.toFloat()})).as4D(r.batchSize,e,e,3)})},n}();function ii(n){return et(this,void 0,void 0,function(){var e,t,r;return tt(this,function(i){switch(i.label){case 0:if(n instanceof d0)return[2,n];if(!(e=Array.isArray(n)?n:[n]).length)throw new Error("toNetInput - empty array passed as input");return t=function(o){return Array.isArray(n)?" at input index "+o+":":""},(r=e.map(Ey)).forEach(function(o,s){if(!jT(o)&&!a0(o)&&!Du(o))throw"string"==typeof e[s]?new Error("toNetInput -"+t(s)+" string passed, but could not resolve HTMLElement for element id "+e[s]):new Error("toNetInput -"+t(s)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(Du(o)){var a=o.shape[0];if(1!==a)throw new Error("toNetInput -"+t(s)+" tf.Tensor4D with batchSize "+a+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(o){return jT(o)&&function(n){return new Promise(function(e,t){if(n instanceof Ti.getEnv().Canvas||VT(n))return e();function r(o){!o.currentTarget||(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),e(o))}function i(o){!o.currentTarget||(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),t(o))}n.addEventListener("load",r),n.addEventListener("error",i)})}(o)}))];case 1:return i.sent(),[2,new d0(r,Array.isArray(n))]}})})}function Iy(n,e){return et(this,void 0,void 0,function(){var t,r,i,o,s,a;return tt(this,function(f){switch(f.label){case 0:return t=Ti.getEnv().Canvas,r=n,n instanceof t?[3,5]:[4,ii(n)];case 1:if((i=f.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(o=i.getInput(0))instanceof t?(s=o,[3,4]):[3,2];case 2:return[4,xj(o)];case 3:s=f.sent(),f.label=4;case 4:r=s,f.label=5;case 5:return a=la(r),[2,e.map(function(p){return p instanceof ca?p.forSize(r.width,r.height).box.floor():p}).map(function(p){return p.clipAtImageBorders(r.width,r.height)}).map(function(p){var m=p.x,y=p.y,w=p.width,E=p.height,A=f0({width:w,height:E});return la(A).putImageData(a.getImageData(m,y,w,E),0,0),A})]}})})}function Ay(n,e){return et(this,void 0,void 0,function(){return tt(this,function(t){if(!a0(n)&&!Du(n))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Du(n)&&n.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,We(function(){var r=n.shape.slice(Du(n)?1:0),i=r[0],o=r[1],s=r[2];return e.map(function(f){return f instanceof ca?f.forSize(o,i).box:f}).map(function(f){return f.clipAtImageBorders(o,i)}).map(function(f){var p=f.x,m=f.y,y=f.width,w=f.height;return VD(n.as3D(i,o,s),[m,p,0],[w,y,s])})})]})})}function bj(n,e){return et(this,void 0,void 0,function(){var r;return tt(this,function(i){switch(i.label){case 0:return[4,(0,Ti.getEnv().fetch)(n,e)];case 1:if(!((r=i.sent()).status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function Cj(n){return et(this,void 0,void 0,function(){return tt(this,function(e){switch(e.label){case 0:return[4,bj(n)];case 1:return[2,e.sent().json()]}})})}function WT(n,e){var t=e+"-weights_manifest.json";if(!n)return{modelBaseUri:"",manifestUri:t};if("/"===n)return{modelBaseUri:"/",manifestUri:"/"+t};var r=n.startsWith("http://")?"http://":n.startsWith("https://")?"https://":"",i=(n=n.replace(r,"")).split("/").filter(function(a){return a}),o=n.endsWith(".json")?i[i.length-1]:t,s=r+(n.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return{modelBaseUri:s=n.startsWith("/")?"/"+s:s,manifestUri:"/"===s?"/"+o:s+"/"+o}}function Ej(n,e){return et(this,void 0,void 0,function(){var t,i,o;return tt(this,function(s){switch(s.label){case 0:return t=WT(n,e),i=t.modelBaseUri,[4,Cj(t.manifestUri)];case 1:return o=s.sent(),[2,gT.loadWeights(o,i)]}})})}var Ba=function(){function n(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(n.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),n.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e);return t.obj[t.objProp]},n.prototype.reassignParamFromPath=function(e,t){var r=this.traversePropertyPath(e),i=r.obj,o=r.objProp;i[o].dispose(),i[o]=t},n.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var r=t.paramPath;return{path:r,tensor:e.getParamFromPath(r)}})},n.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof Dl})},n.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof Dl)})},n.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){e.reassignParamFromPath(t.path,t.tensor.variable())})},n.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var r=t.path,i=t.tensor,o=fi(i.dataSync());i.dispose(),e.reassignParamFromPath(r,o)})},n.prototype.dispose=function(e){void 0===e&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},n.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){return Array.from(e.tensor.dataSync())}).reduce(function(e,t){return e.concat(t)}))},n.prototype.load=function(e){return et(this,void 0,void 0,function(){return tt(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},n.prototype.loadFromUri=function(e){return et(this,void 0,void 0,function(){var t;return tt(this,function(r){switch(r.label){case 0:if(e&&"string"!=typeof e)throw new Error(this._name+".loadFromUri - expected model uri");return[4,Ej(e,this.getDefaultModelName())];case 1:return t=r.sent(),this.loadFromWeightMap(t),[2]}})})},n.prototype.loadFromDisk=function(e){return et(this,void 0,void 0,function(){var t,r,i,o,a,c,f,p,m;return tt(this,function(y){switch(y.label){case 0:if(e&&"string"!=typeof e)throw new Error(this._name+".loadFromDisk - expected model file path");return t=Ti.getEnv().readFile,r=WT(e,this.getDefaultModelName()),i=r.manifestUri,o=r.modelBaseUri,a=gT.weightsLoaderFactory(function(w){return Promise.all(w.map(function(E){return t(E).then(function(A){return A.buffer})}))}),p=(f=JSON).parse,[4,t(i)];case 1:return c=p.apply(f,[y.sent().toString()]),[4,a(c,o)];case 2:return m=y.sent(),this.loadFromWeightMap(m),[2]}})})},n.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),i=t.params;this._paramMappings=t.paramMappings,this._params=i},n.prototype.extractWeights=function(e){var t=this.extractParams(e),i=t.params;this._paramMappings=t.paramMappings,this._params=i},n.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(o,s){if(!o.nextObj.hasOwnProperty(s))throw new Error("traversePropertyPath - object does not have property "+s+", for path "+e);return{obj:o.nextObj,objProp:s,nextObj:o.nextObj[s]}},{nextObj:this.params}),r=t.obj,i=t.objProp;if(!(r&&i&&r[i]instanceof Fn))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:r,objProp:i}},n}();function Ao(n,e,t){return We(function(){var r=Wv(n,e.depthwise_filter,e.pointwise_filter,t,"same");return Gt(r,e.bias)})}function Dy(n,e,t){return void 0===t&&(t=!1),We(function(){var r=or(t?Gt(Ho(n,e.conv0.filters,[2,2],"same"),e.conv0.bias):Ao(n,e.conv0,[2,2])),i=Ao(r,e.conv1,[1,1]),s=Ao(or(Gt(r,i)),e.conv2,[1,1]);return or(Gt(r,Gt(i,s)))})}function h0(n,e,t,r){return void 0===t&&(t=!1),void 0===r&&(r=!0),We(function(){var i=or(t?Gt(Ho(n,e.conv0.filters,r?[2,2]:[1,1],"same"),e.conv0.bias):Ao(n,e.conv0,r?[2,2]:[1,1])),o=Ao(i,e.conv1,[1,1]),a=Ao(or(Gt(i,o)),e.conv2,[1,1]),f=Ao(or(Gt(i,Gt(o,a))),e.conv3,[1,1]);return or(Gt(i,Gt(o,Gt(a,f))))})}function Ts(n,e,t,r){return void 0===t&&(t="same"),void 0===r&&(r=!1),We(function(){var i=Gt(Ho(n,e.filters,[1,1],t),e.bias);return r?or(i):i})}function Va(n,e){Object.keys(n).forEach(function(t){e.some(function(r){return r.originalPath===t})||n[t].dispose()})}function p0(n,e){return function(t,r,i,o){var s=ro(n(t*r*i*i),[i,i,t,r]),a=Or(n(r));return e.push({paramPath:o+"/filters"},{paramPath:o+"/bias"}),{filters:s,bias:a}}}function Ty(n,e){return function(t,r,i){var o=bu(n(t*r),[t,r]),s=Or(n(r));return e.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:o,bias:s}}}var HT=function(e,t,r){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=r};function Sy(n,e){return function(t,r,i){var o=ro(n(9*t),[3,3,t,1]),s=ro(n(t*r),[1,1,t,r]),a=Or(n(r));return e.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new HT(o,s,a)}}function Ny(n){return function(e){var t=n(e+"/depthwise_filter",4),r=n(e+"/pointwise_filter",4),i=n(e+"/bias",1);return new HT(t,r,i)}}function Tu(n,e){return function(t,r,i){var o=n[t];if(!Fd(o,r))throw new Error("expected weightMap["+t+"] to be a Tensor"+r+"D, instead have "+o);return e.push({originalPath:t,paramPath:i||t}),o}}function Ua(n){var e=n;return{extractWeights:function(i){var o=e.slice(0,i);return e=e.slice(i),o},getRemainingWeights:function(){return e}}}function zT(n,e){var t=p0(n,e),r=Sy(n,e);function i(s,a,c,f){return void 0===f&&(f=!1),{conv0:f?t(s,a,3,c+"/conv0"):r(s,a,c+"/conv0"),conv1:r(a,a,c+"/conv1"),conv2:r(a,a,c+"/conv2")}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:function(s,a,c,f){void 0===f&&(f=!1);var p=i(s,a,c,f);return{conv0:p.conv0,conv1:p.conv1,conv2:p.conv2,conv3:r(a,a,c+"/conv3")}}}}function GT(n){return function(e){return{filters:n(e+"/filters",4),bias:n(e+"/bias",1)}}}function YT(n,e){var t=Tu(n,e),r=GT(t),i=Ny(t);return{extractDenseBlock3Params:function(a,c){return void 0===c&&(c=!1),{conv0:c?r(a+"/conv0"):i(a+"/conv0"),conv1:i(a+"/conv1"),conv2:i(a+"/conv2")}},extractDenseBlock4Params:function(a,c){return void 0===c&&(c=!1),{conv0:c?r(a+"/conv0"):i(a+"/conv0"),conv1:i(a+"/conv1"),conv2:i(a+"/conv2"),conv3:i(a+"/conv3")}}}}var XT=function(n){function e(){return n.call(this,"FaceFeatureExtractor")||this}return At(e,n),e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return We(function(){var a=h0(Ld(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Pe(255)),r.dense0,!0);return a=h0(a,r.dense1),a=h0(a,r.dense2),a=h0(a,r.dense3),Rd(a,[7,7],[2,2],"valid")})},e.prototype.forward=function(t){return et(this,void 0,void 0,function(){var r;return tt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,ii(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(n){var e=[],t=YT(n,e).extractDenseBlock4Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2"),dense3:t("dense3")};return Va(n,e),{params:r,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(n){var e=[],t=Ua(n),i=t.getRemainingWeights,o=zT(t.extractWeights,e).extractDenseBlock4Params,s=o(3,32,"dense0",!0),a=o(32,64,"dense1"),c=o(64,128,"dense2"),f=o(128,256,"dense3");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:s,dense1:a,dense2:c,dense3:f}}}(t)},e}(Ba);function fa(n,e){return We(function(){return Gt(e0(n,e.weights),e.bias)})}function qT(n){var e={},t={};return Object.keys(n).forEach(function(r){(r.startsWith("fc")?t:e)[r]=n[r]}),{featureExtractorMap:e,classifierMap:t}}var KT=function(n){function e(t,r){var i=n.call(this,t)||this;return i._faceFeatureExtractor=r,i}return At(e,n),Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return We(function(){var o=t instanceof d0?r.faceFeatureExtractor.forwardInput(t):t;return fa(o.as2D(o.shape[0],-1),i.fc)})},e.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),o=r.paramMappings;this._params=r.params,this._paramMappings=o},e.prototype.extractClassifierParams=function(t){return function(n,e,t){var r=[],i=Ua(n),s=i.getRemainingWeights,c=Ty(i.extractWeights,r)(e,t,"fc");if(0!==s().length)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:r,params:{fc:c}}}(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var r=qT(t),o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(r.featureExtractorMap),function(n){var e=[],t=Tu(n,e),i={fc:("fc",{weights:t("fc/weights",2),bias:t("fc/bias",1)})};return Va(n,e),{params:i,paramMappings:e}}(o)},e.prototype.extractParams=function(t){var r=this.getClassifierChannelsIn(),i=this.getClassifierChannelsOut(),o=i*r+i,s=t.slice(0,t.length-o),a=t.slice(t.length-o);return this.faceFeatureExtractor.extractWeights(s),this.extractClassifierParams(a)},e}(Ba),QT=["neutral","happy","sad","angry","fearful","disgusted","surprised"],Tj=function(){function n(e){var t=this;if(7!==e.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);QT.forEach(function(r,i){t[r]=e[i]})}return n.prototype.asSortedArray=function(){var e=this;return QT.map(function(t){return{expression:t,probability:e[t]}}).sort(function(t,r){return r.probability-t.probability})},n}(),Sj=function(n){function e(t){return void 0===t&&(t=new XT),n.call(this,"FaceExpressionNet",t)||this}return At(e,n),e.prototype.forwardInput=function(t){var r=this;return We(function(){return Ra(r.runNet(t))})},e.prototype.forward=function(t){return et(this,void 0,void 0,function(){var r;return tt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,ii(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictExpressions=function(t){return et(this,void 0,void 0,function(){var r,i,o,s,a=this;return tt(this,function(c){switch(c.label){case 0:return[4,ii(t)];case 1:return r=c.sent(),[4,this.forwardInput(r)];case 2:return i=c.sent(),[4,Promise.all(Gr(i).map(function(f){return et(a,void 0,void 0,function(){var p;return tt(this,function(m){switch(m.label){case 0:return[4,f.data()];case 1:return p=m.sent(),f.dispose(),[2,p]}})})}))];case 3:return o=c.sent(),i.dispose(),s=o.map(function(f){return new Tj(f)}),[2,r.isBatchInput?s:s[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(KT);function $T(n,e){return Object.assign({},n,{expressions:e})}function Ry(n,e){var t=n.detection.box,r=e.shiftBy(t.x,t.y),i=r.align(),o=n.detection.imageDims,s=new ca(n.detection.score,i.rescale(o.reverse()),o);return Object.assign({},n,{landmarks:r,unshiftedLandmarks:e,alignedRect:s})}function ZT(n,e,t){return Gt(Ho(n,e.filters,t,"same"),e.bias)}function My(n,e,t){void 0===t&&(t=!0);var r=t?or(n):n;return r=Ao(r,e.separable_conv0,[1,1]),r=Ao(or(r),e.separable_conv1,[1,1]),r=ri(r,[3,3],[2,2],"same"),Gt(r,ZT(n,e.expansion_conv,[2,2]))}var Bj=function(n){function e(t){var r=n.call(this,"TinyXception")||this;return r._numMainBlocks=t,r}return At(e,n),e.prototype.forwardInput=function(t){var r=this,i=this.params;if(!i)throw new Error("TinyXception - load model before inference");return We(function(){var a=Ld(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Pe(256)),c=or(ZT(a,i.entry_flow.conv_in,[2,2]));return c=My(c,i.entry_flow.reduction_block_0,!1),c=My(c,i.entry_flow.reduction_block_1),Pd(r._numMainBlocks,0,1).forEach(function(f){c=function(n,e){var t=Ao(or(n),e.separable_conv0,[1,1]);return t=Ao(or(t),e.separable_conv1,[1,1]),t=Ao(or(t),e.separable_conv2,[1,1]),Gt(t,n)}(c,i.middle_flow["main_block_"+f])}),c=My(c,i.exit_flow.reduction_block),c=or(Ao(c,i.exit_flow.separable_conv,[1,1]))})},e.prototype.forward=function(t){return et(this,void 0,void 0,function(){var r;return tt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,ii(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(n,e){var t=[],r=function(n,e){var t=Tu(n,e),r=GT(t),i=Ny(t);return{extractConvParams:r,extractSeparableConvParams:i,extractReductionBlockParams:function(a){return{separable_conv0:i(a+"/separable_conv0"),separable_conv1:i(a+"/separable_conv1"),expansion_conv:r(a+"/expansion_conv")}},extractMainBlockParams:function(a){return{separable_conv0:i(a+"/separable_conv0"),separable_conv1:i(a+"/separable_conv1"),separable_conv2:i(a+"/separable_conv2")}}}}(n,t),o=r.extractSeparableConvParams,s=r.extractReductionBlockParams,a=r.extractMainBlockParams,m={conv_in:(0,r.extractConvParams)("entry_flow/conv_in"),reduction_block_0:s("entry_flow/reduction_block_0"),reduction_block_1:s("entry_flow/reduction_block_1")},y={};Pd(e,0,1).forEach(function(_){y["main_block_"+_]=a("middle_flow/main_block_"+_)});var A={reduction_block:s("exit_flow/reduction_block"),separable_conv:o("exit_flow/separable_conv")};return Va(n,t),{params:{entry_flow:m,middle_flow:y,exit_flow:A},paramMappings:t}}(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return function(n,e){var t=[],r=Ua(n),o=r.getRemainingWeights,s=function(n,e){var t=p0(n,e),r=Sy(n,e);return{extractConvParams:t,extractSeparableConvParams:r,extractReductionBlockParams:function(s,a,c){return{separable_conv0:r(s,a,c+"/separable_conv0"),separable_conv1:r(a,a,c+"/separable_conv1"),expansion_conv:t(s,a,1,c+"/expansion_conv")}},extractMainBlockParams:function(s,a){return{separable_conv0:r(s,s,a+"/separable_conv0"),separable_conv1:r(s,s,a+"/separable_conv1"),separable_conv2:r(s,s,a+"/separable_conv2")}}}}(r.extractWeights,t),c=s.extractSeparableConvParams,f=s.extractReductionBlockParams,p=s.extractMainBlockParams,E={conv_in:(0,s.extractConvParams)(3,32,3,"entry_flow/conv_in"),reduction_block_0:f(32,64,"entry_flow/reduction_block_0"),reduction_block_1:f(64,128,"entry_flow/reduction_block_1")},A={};Pd(e,0,1).forEach(function(M){A["main_block_"+M]=p(128,"middle_flow/main_block_"+M)});var N={reduction_block:f(128,256,"exit_flow/reduction_block"),separable_conv:c(256,512,"exit_flow/separable_conv")};if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{entry_flow:E,middle_flow:A,exit_flow:N}}}(t,this._numMainBlocks)},e}(Ba),Bd=(()=>(function(n){n.FEMALE="female",n.MALE="male"}(Bd||(Bd={})),Bd))(),jj=function(n){function e(t){void 0===t&&(t=new Bj(2));var r=n.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=t,r}return At(e,n),Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return We(function(){var o=t instanceof d0?r.faceFeatureExtractor.forwardInput(t):t,s=Rd(o,[7,7],[2,2],"valid").as2D(o.shape[0],-1);return{age:fa(s,i.fc.age).as1D(),gender:fa(s,i.fc.gender)}})},e.prototype.forwardInput=function(t){var r=this;return We(function(){var i=r.runNet(t);return{age:i.age,gender:Ra(i.gender)}})},e.prototype.forward=function(t){return et(this,void 0,void 0,function(){var r;return tt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,ii(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return et(this,void 0,void 0,function(){var r,i,o,s,a,c,f=this;return tt(this,function(p){switch(p.label){case 0:return[4,ii(t)];case 1:return r=p.sent(),[4,this.forwardInput(r)];case 2:return i=p.sent(),o=Gr(i.age),s=Gr(i.gender),a=o.map(function(m,y){return{ageTensor:m,genderTensor:s[y]}}),[4,Promise.all(a.map(function(m){var y=m.ageTensor,w=m.genderTensor;return et(f,void 0,void 0,function(){var E,A,_,T,N;return tt(this,function(M){switch(M.label){case 0:return[4,y.data()];case 1:return E=M.sent()[0],[4,w.data()];case 2:return A=M.sent()[0],T=(_=A>.5)?Bd.MALE:Bd.FEMALE,N=_?A:1-A,y.dispose(),w.dispose(),[2,{age:E,gender:T,genderProbability:N}]}})})}))];case 3:return c=p.sent(),i.age.dispose(),i.gender.dispose(),[2,r.isBatchInput?c:c[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),o=r.paramMappings;this._params=r.params,this._paramMappings=o},e.prototype.extractClassifierParams=function(t){return function(n){var e=[],t=Ua(n),i=t.getRemainingWeights,o=Ty(t.extractWeights,e),s=o(512,1,"fc/age"),a=o(512,2,"fc/gender");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{fc:{age:s,gender:a}}}}(t)},e.prototype.extractParamsFromWeigthMap=function(t){var r=qT(t),o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(r.featureExtractorMap),function(n){var e=[],t=Tu(n,e);function r(o){return{weights:t(o+"/weights",2),bias:t(o+"/bias",1)}}var i={fc:{age:r("fc/age"),gender:r("fc/gender")}};return Va(n,e),{params:i,paramMappings:e}}(o)},e.prototype.extractParams=function(t){var i=t.slice(0,t.length-1539),o=t.slice(t.length-1539);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(o)},e}(Ba),JT=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return At(e,n),e.prototype.postProcess=function(t,r,i){var o=i.map(function(a){var c=a.width,f=a.height,p=r/Math.max(f,c);return{width:c*p,height:f*p}}),s=o.length;return We(function(){var a=function(y,w){return _o([aa([68],y),aa([68],w)],1).as2D(1,136).as1D()},c=function(y,w){var E=o[y],A=E.width,_=E.height;return w(A,_)?Math.abs(A-_)/2:0};return t.mul(aa([s,136],r)).sub(_o(Array.from(Array(s),function(y,w){return a(function(y){return c(y,function(w,E){return w<E})}(w),function(y){return c(y,function(w,E){return E<w})}(w))}))).div(_o(Array.from(Array(s),function(y,w){return a(o[w].width,o[w].height)})))})},e.prototype.forwardInput=function(t){var r=this;return We(function(){var i=r.runNet(t);return r.postProcess(i,t.inputSize,t.inputDimensions.map(function(o){return{height:o[0],width:o[1]}}))})},e.prototype.forward=function(t){return et(this,void 0,void 0,function(){var r;return tt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,ii(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.detectLandmarks=function(t){return et(this,void 0,void 0,function(){var r,i,o,s=this;return tt(this,function(a){switch(a.label){case 0:return[4,ii(t)];case 1:return r=a.sent(),i=We(function(){return Gr(s.forwardInput(r))}),[4,Promise.all(i.map(function(c,f){return et(s,void 0,void 0,function(){var p,m,y,w,E;return tt(this,function(A){switch(A.label){case 0:return y=(m=Array).from,[4,c.data()];case 1:return p=y.apply(m,[A.sent()]),w=p.filter(function(_,T){return AT(T)}),E=p.filter(function(_,T){return!AT(T)}),[2,new NT(Array(68).fill(0).map(function(_,T){return new yn(w[T],E[T])}),{height:r.getInputHeight(f),width:r.getInputWidth(f)})]}})})}))];case 2:return o=a.sent(),i.forEach(function(c){return c.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e}(KT),eS=function(n){function e(t){return void 0===t&&(t=new XT),n.call(this,"FaceLandmark68Net",t)||this}return At(e,n),e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(JT),zj=function(n){function e(){return n.call(this,"TinyFaceFeatureExtractor")||this}return At(e,n),e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return We(function(){var a=Dy(Ld(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Pe(255)),r.dense0,!0);return a=Dy(a,r.dense1),a=Dy(a,r.dense2),Rd(a,[14,14],[2,2],"valid")})},e.prototype.forward=function(t){return et(this,void 0,void 0,function(){var r;return tt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,ii(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(n){var e=[],t=YT(n,e).extractDenseBlock3Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2")};return Va(n,e),{params:r,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(n){var e=[],t=Ua(n),i=t.getRemainingWeights,o=zT(t.extractWeights,e).extractDenseBlock3Params,s=o(3,32,"dense0",!0),a=o(32,64,"dense1"),c=o(64,128,"dense2");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:s,dense1:a,dense2:c}}}(t)},e}(Ba),Gj=function(n){function e(t){return void 0===t&&(t=new zj),n.call(this,"FaceLandmark68TinyNet",t)||this}return At(e,n),e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(JT);function Oy(n,e,t,r,i){void 0===i&&(i="same");var o=e.conv,a=o.bias,c=Ho(n,o.filters,t,i);return c=function(n,e){return Gt(Ii(n,e.weights),e.biases)}(c=Gt(c,a),e.scale),r?or(c):c}function tS(n,e){return Oy(n,e,[1,1],!1)}function nS(n,e){return Oy(n,e,[2,2],!0,"valid")}function $j(n){var e=[],t=function(n,e){var t=Tu(n,e);function i(s){return{conv:{filters:t(s+"/conv/filters",4),bias:t(s+"/conv/bias",1)},scale:function(s){return{weights:t(s+"/scale/weights",1),biases:t(s+"/scale/biases",1)}}(s)}}return{extractConvLayerParams:i,extractResidualLayerParams:function(s){return{conv1:i(s+"/conv1"),conv2:i(s+"/conv2")}}}}(n,e),i=t.extractResidualLayerParams,o=(0,t.extractConvLayerParams)("conv32_down"),s=i("conv32_1"),a=i("conv32_2"),c=i("conv32_3"),f=i("conv64_down"),p=i("conv64_1"),m=i("conv64_2"),y=i("conv64_3"),w=i("conv128_down"),E=i("conv128_1"),A=i("conv128_2"),_=i("conv256_down"),T=i("conv256_1"),N=i("conv256_2"),M=i("conv256_down_out"),R=n.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!function(n){return Fd(n,2)}(R))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+R);var P={conv32_down:o,conv32_1:s,conv32_2:a,conv32_3:c,conv64_down:f,conv64_1:p,conv64_2:m,conv64_3:y,conv128_down:w,conv128_1:E,conv128_2:A,conv256_down:_,conv256_1:T,conv256_2:N,conv256_down_out:M,fc:R};return Va(n,e),{params:P,paramMappings:e}}function da(n,e){var t=function(n,e){return Oy(n,e,[1,1],!0)}(n,e.conv1);return t=tS(t,e.conv2),t=Gt(t,n),or(t)}function g0(n,e){var t=nS(n,e.conv1);t=tS(t,e.conv2);var r=Rd(n,2,2,"valid"),i=zn(r.shape),o=r.shape[3]!==t.shape[3];if(r.shape[1]!==t.shape[1]||r.shape[2]!==t.shape[2]){var a=Od(t.shape);a[1]=1;var c=zn(a),f=Od((t=zr([t,c],1)).shape);f[2]=1;var p=zn(f);t=zr([t,p],2)}return r=o?zr([r,i],3):r,t=Gt(r,t),or(t)}!function(n){At(function(){return null!==n&&n.apply(this,arguments)||this},n)}(eS);var Zj=function(n){function e(){return n.call(this,"FaceRecognitionNet")||this}return At(e,n),e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return We(function(){var a=nS(Ld(t.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(Pe(256)),r.conv32_down);a=da(a=ri(a,3,2,"valid"),r.conv32_1),a=da(a,r.conv32_2),a=da(a,r.conv32_3),a=da(a=g0(a,r.conv64_down),r.conv64_1),a=da(a,r.conv64_2),a=da(a,r.conv64_3),a=da(a=g0(a,r.conv128_down),r.conv128_1),a=da(a,r.conv128_2),a=da(a=g0(a,r.conv256_down),r.conv256_1);var c=(a=g0(a=da(a,r.conv256_2),r.conv256_down_out)).mean([1,2]);return e0(c,r.fc)})},e.prototype.forward=function(t){return et(this,void 0,void 0,function(){var r;return tt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,ii(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return et(this,void 0,void 0,function(){var r,i,o,s=this;return tt(this,function(a){switch(a.label){case 0:return[4,ii(t)];case 1:return r=a.sent(),i=We(function(){return Gr(s.forwardInput(r))}),[4,Promise.all(i.map(function(c){return c.data()}))];case 2:return o=a.sent(),i.forEach(function(c){return c.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return $j(t)},e.prototype.extractParams=function(t){return function(n){var e=Ua(n),t=e.extractWeights,r=e.getRemainingWeights,i=[],o=function(n,e){function r(a,c,f,p){var m=function(a,c,f){var p=n(a),m=p.length/(c*f*f);if(function(n){return n%1!=0}(m))throw new Error("depth has to be an integer: "+m+", weights.length: "+p.length+", numFilters: "+c+", filterSize: "+f);return We(function(){return Eu(ro(p,[c,m,f,f]),[2,3,1,0])})}(a,c,f),y=Or(n(c));return e.push({paramPath:p+"/filters"},{paramPath:p+"/bias"}),{filters:m,bias:y}}function o(a,c,f,p){return{conv:r(a,c,f,p+"/conv"),scale:function(a,c){var f=Or(n(a)),p=Or(n(a));return e.push({paramPath:c+"/weights"},{paramPath:c+"/biases"}),{weights:f,biases:p}}(c,p+"/scale")}}return{extractConvLayerParams:o,extractResidualLayerParams:function(a,c,f,p,m){return void 0===m&&(m=!1),{conv1:o((m?.5:1)*a,c,f,p+"/conv1"),conv2:o(a,c,f,p+"/conv2")}}}}(t,i),a=o.extractResidualLayerParams,c=(0,o.extractConvLayerParams)(4704,32,7,"conv32_down"),f=a(9216,32,3,"conv32_1"),p=a(9216,32,3,"conv32_2"),m=a(9216,32,3,"conv32_3"),y=a(36864,64,3,"conv64_down",!0),w=a(36864,64,3,"conv64_1"),E=a(36864,64,3,"conv64_2"),A=a(36864,64,3,"conv64_3"),_=a(147456,128,3,"conv128_down",!0),T=a(147456,128,3,"conv128_1"),N=a(147456,128,3,"conv128_2"),M=a(589824,256,3,"conv256_down",!0),R=a(589824,256,3,"conv256_1"),P=a(589824,256,3,"conv256_2"),B=a(589824,256,3,"conv256_down_out"),Y=We(function(){return Eu(bu(t(32768),[128,256]),[1,0])});if(i.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:c,conv32_1:f,conv32_2:p,conv32_3:m,conv64_down:y,conv64_1:w,conv64_2:E,conv64_3:A,conv128_down:_,conv128_1:T,conv128_2:N,conv256_down:M,conv256_1:R,conv256_2:P,conv256_down_out:B,fc:Y},paramMappings:i}}(t)},e}(Ba);function rS(n,e,t){return Object.assign({},n,{gender:e,genderProbability:t})}var iS=function(){function n(e){var t=void 0===e?{}:e,r=t.minFaceSize,i=t.scaleFactor,o=t.maxNumScales,s=t.scoreThresholds,a=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=i||.709,this._maxNumScales=o||10,this._scoreThresholds=s||[.6,.7,.7],this._scaleSteps=a,"number"!=typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(c){return"number"!=typeof c}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(c){return"number"!=typeof c})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(n.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),n}();function ha(n,e,t){return We(function(){var r=Ho(n,e.filters,t,"same");return r=Gt(r,e.batch_norm_offset),kv(r,0,6)})}function uW(n,e,t){var r=n.arraySync(),i=Math.min(r[e][0],r[e][2]),o=Math.min(r[e][1],r[e][3]),s=Math.max(r[e][0],r[e][2]),a=Math.max(r[e][1],r[e][3]),c=Math.min(r[t][0],r[t][2]),f=Math.min(r[t][1],r[t][3]),p=Math.max(r[t][0],r[t][2]),m=Math.max(r[t][1],r[t][3]),y=(s-i)*(a-o),w=(p-c)*(m-f);if(y<=0||w<=0)return 0;var E=Math.max(i,c),A=Math.max(o,f),_=Math.min(s,p),T=Math.min(a,m),N=Math.max(_-E,0)*Math.max(T-A,0);return N/(y+w-N)}function Hl(n,e){return We(function(){var t=n.shape[0];return{boxPredictionEncoding:Is(Ts(n,e.box_encoding_predictor),[t,-1,1,4]),classPrediction:Is(Ts(n,e.class_predictor),[t,-1,3])}})}var m0=function(){function n(e){var t=void 0===e?{}:e,r=t.minConfidence,i=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=i||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(n.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),n}(),oS=function(n){function e(){return n.call(this,"SsdMobilenetv1")||this}return At(e,n),e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return We(function(){var i=t.toBatchTensor(512,!1).toFloat(),s=function(n,e){return We(function(){var t=null,r=ha(n,e.conv_0,[2,2]);if([e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13].forEach(function(o,s){var a=s+1,c=function(n){return[2,4,6,12].some(function(e){return e===n})?[2,2]:[1,1]}(a);r=ha(r=function(n,e,t){return We(function(){var r=Jp(n,e.filters,t,"same");return r=CD(r,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,.0010000000474974513),kv(r,0,6)})}(r,o.depthwise_conv,c),o.pointwise_conv,[1,1]),11===a&&(t=r)}),null===t)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:t}})}(Yr(Ii(i,Pe(.007843137718737125)),Pe(1)),r.mobilenetv1),a=function(n,e,t){return We(function(){var r=ha(n,t.conv_0,[1,1]),i=ha(r,t.conv_1,[2,2]),o=ha(i,t.conv_2,[1,1]),s=ha(o,t.conv_3,[2,2]),a=ha(s,t.conv_4,[1,1]),c=ha(a,t.conv_5,[2,2]),f=ha(c,t.conv_6,[1,1]),p=ha(f,t.conv_7,[2,2]),m=Hl(e,t.box_predictor_0),y=Hl(n,t.box_predictor_1),w=Hl(i,t.box_predictor_2),E=Hl(s,t.box_predictor_3),A=Hl(c,t.box_predictor_4),_=Hl(p,t.box_predictor_5);return{boxPredictions:zr([m.boxPredictionEncoding,y.boxPredictionEncoding,w.boxPredictionEncoding,E.boxPredictionEncoding,A.boxPredictionEncoding,_.boxPredictionEncoding],1),classPredictions:zr([m.classPrediction,y.classPrediction,w.classPrediction,E.classPrediction,A.classPrediction,_.classPrediction],1)}})}(s.out,s.conv11,r.prediction_layer);return function(n,e,t){return We(function(){var r=n.shape[0],i=function(n,e){var t=function(n){var e=Gr(Eu(n,[1,0])),t=[Yr(e[2],e[0]),Yr(e[3],e[1])];return{sizes:t,centers:[Gt(e[0],Ds(t[0],Pe(2))),Gt(e[1],Ds(t[1],Pe(2)))]}}(n),r=t.sizes,i=t.centers,o=Gr(Eu(e,[1,0])),s=Ds(Ii(Lv(Ds(o[2],Pe(5))),r[0]),Pe(2)),a=Gt(Ii(Ds(o[0],Pe(10)),r[0]),i[0]),c=Ds(Ii(Lv(Ds(o[3],Pe(5))),r[1]),Pe(2)),f=Gt(Ii(Ds(o[1],Pe(10)),r[1]),i[1]);return Eu(_o([Yr(a,s),Yr(f,c),Gt(a,s),Gt(f,c)]),[1,0])}(Is(Sl(t.extra_dim,[r,1,1]),[-1,4]),Is(n,[-1,4]));i=Is(i,[r,i.shape[0]/r,4]);var o=yD(ua(e,[0,0,1],[-1,-1,-1])),s=ua(o,[0,0,0],[-1,-1,1]);return s=Is(s,[r,s.shape[1]]),{boxes:Gr(i),scores:Gr(s)}})}(a.boxPredictions,a.classPredictions,r.output_layer)})},e.prototype.forward=function(t){return et(this,void 0,void 0,function(){var r;return tt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,ii(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.locateFaces=function(t,r){return void 0===r&&(r={}),et(this,void 0,void 0,function(){var i,o,s,a,c,f,p,m,y,w,E,A,_,N,M,R,P,B,Y,X;return tt(this,function(z){switch(z.label){case 0:return i=new m0(r),o=i.maxResults,s=i.minConfidence,[4,ii(t)];case 1:for(a=z.sent(),c=this.forwardInput(a),m=(f=c.boxes)[0],y=(p=c.scores)[0],w=1;w<f.length;w++)f[w].dispose(),p[w].dispose();return _=(A=Array).from,[4,y.data()];case 2:return E=_.apply(A,[z.sent()]),N=function(n,e,t,r,i){var s=Math.min(t,n.shape[0]),a=e.map(function(p,m){return{score:p,boxIndex:m}}).filter(function(p){return p.score>i}).sort(function(p,m){return m.score-p.score}),c=function(p){return p<=.5?1:0},f=[];return a.forEach(function(p){if(!(f.length>=s)){for(var m=p.score,y=f.length-1;y>=0;--y){var w=uW(n,p.boxIndex,f[y]);if(0!==w&&(p.score*=c(w),p.score<=i))break}m===p.score&&f.push(p.boxIndex)}}),f}(m,E,o,0,s),M=a.getReshapedInputDimensions(0),P=(R=a.inputSize)/M.width,B=R/M.height,Y=m.arraySync(),X=N.map(function(G){var ee=[Math.max(0,Y[G][0]),Math.min(1,Y[G][2])].map(function(we){return we*B}),J=ee[0],pe=ee[1],fe=[Math.max(0,Y[G][1]),Math.min(1,Y[G][3])].map(function(we){return we*P}),he=fe[0];return new ca(E[G],new xy(he,J,fe[1]-he,pe-J),{height:a.getInputHeight(0),width:a.getInputWidth(0)})}),m.dispose(),y.dispose(),[2,X]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(n){var e=[],t=function(n,e){var t=Tu(n,e);function r(f,p,m){return{filters:t(f+"/Conv2d_"+p+"_pointwise/weights",4,m+"/filters"),batch_norm_offset:t(f+"/Conv2d_"+p+"_pointwise/convolution_bn_offset",1,m+"/batch_norm_offset")}}function i(f){var p="mobilenetv1/conv_"+f,m="MobilenetV1/Conv2d_"+f+"_depthwise",y=p+"/depthwise_conv",w=p+"/pointwise_conv";return{depthwise_conv:{filters:t(m+"/depthwise_weights",4,y+"/filters"),batch_norm_scale:t(m+"/BatchNorm/gamma",1,y+"/batch_norm_scale"),batch_norm_offset:t(m+"/BatchNorm/beta",1,y+"/batch_norm_offset"),batch_norm_mean:t(m+"/BatchNorm/moving_mean",1,y+"/batch_norm_mean"),batch_norm_variance:t(m+"/BatchNorm/moving_variance",1,y+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",f,w)}}function s(f,p){return{filters:t(f+"/weights",4,p+"/filters"),bias:t(f+"/biases",1,p+"/bias")}}function a(f){return{box_encoding_predictor:s("Prediction/BoxPredictor_"+f+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+f+"/box_encoding_predictor"),class_predictor:s("Prediction/BoxPredictor_"+f+"/ClassPredictor","prediction_layer/box_predictor_"+f+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:a(0),box_predictor_1:a(1),box_predictor_2:a(2),box_predictor_3:a(3),box_predictor_4:a(4),box_predictor_5:a(5)}}}}(n,e),r=t.extractMobilenetV1Params,i=t.extractPredictionLayerParams,o=n["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!a0(o))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+o);var s={mobilenetv1:r(),prediction_layer:i(),output_layer:{extra_dim:o}};return Va(n,e),{params:s,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(n){var e=[],t=Ua(n),r=t.extractWeights,i=t.getRemainingWeights,o=function(n,e){function r(c,f,p,m,y){var w=ro(n(c*f*p*p),[p,p,c,f]),E=Or(n(f));return e.push({paramPath:m+"/filters"},{paramPath:m+"/"+(y?"batch_norm_offset":"bias")}),{filters:w,bias:E}}function i(c,f,p,m){var y=r(c,f,p,m,!0);return{filters:y.filters,batch_norm_offset:y.bias}}function o(c,f,p){return{depthwise_conv:function(c,f){var p=ro(n(9*c),[3,3,c,1]),m=Or(n(c)),y=Or(n(c)),w=Or(n(c)),E=Or(n(c));return e.push({paramPath:f+"/filters"},{paramPath:f+"/batch_norm_scale"},{paramPath:f+"/batch_norm_offset"},{paramPath:f+"/batch_norm_mean"},{paramPath:f+"/batch_norm_variance"}),{filters:p,batch_norm_scale:m,batch_norm_offset:y,batch_norm_mean:w,batch_norm_variance:E}}(c,p+"/depthwise_conv"),pointwise_conv:i(c,f,1,p+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:i(3,32,3,"mobilenetv1/conv_0"),conv_1:o(32,64,"mobilenetv1/conv_1"),conv_2:o(64,128,"mobilenetv1/conv_2"),conv_3:o(128,128,"mobilenetv1/conv_3"),conv_4:o(128,256,"mobilenetv1/conv_4"),conv_5:o(256,256,"mobilenetv1/conv_5"),conv_6:o(256,512,"mobilenetv1/conv_6"),conv_7:o(512,512,"mobilenetv1/conv_7"),conv_8:o(512,512,"mobilenetv1/conv_8"),conv_9:o(512,512,"mobilenetv1/conv_9"),conv_10:o(512,512,"mobilenetv1/conv_10"),conv_11:o(512,512,"mobilenetv1/conv_11"),conv_12:o(512,1024,"mobilenetv1/conv_12"),conv_13:o(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:i(1024,256,1,"prediction_layer/conv_0"),conv_1:i(256,512,3,"prediction_layer/conv_1"),conv_2:i(512,128,1,"prediction_layer/conv_2"),conv_3:i(128,256,3,"prediction_layer/conv_3"),conv_4:i(256,128,1,"prediction_layer/conv_4"),conv_5:i(128,256,3,"prediction_layer/conv_5"),conv_6:i(256,64,1,"prediction_layer/conv_6"),conv_7:i(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:r(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:r(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:r(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:r(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:r(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}(r,e),a=o.extractPredictionLayerParams,c=(0,o.extractMobilenetV1Params)(),f=a(),m={extra_dim:lv(r(20472),[1,5118,4])};if(e.push({paramPath:"output_layer/extra_dim"}),0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:c,prediction_layer:f,output_layer:m},paramMappings:e}}(t)},e}(Ba);!function(n){At(function(){return null!==n&&n.apply(this,arguments)||this},n)}(oS);var gW=[new yn(.738768,.874946),new yn(2.42204,2.65704),new yn(4.30971,7.04493),new yn(10.246,4.59428),new yn(12.6868,11.8741)],mW=[new yn(1.603231,2.094468),new yn(6.041143,7.080126),new yn(2.882459,3.518061),new yn(4.266906,5.178857),new yn(9.041765,10.66308)],vW=[117.001,114.697,97.404],v0=function(n){return"number"==typeof n};function Fy(n){return We(function(){var e=Ii(n,Pe(.10000000149011612));return Gt(or(Yr(n,e)),e)})}function Su(n,e){return We(function(){var t=ac(n,[[0,0],[1,1],[1,1],[0,0]]);return t=Ho(t,e.conv.filters,[1,1],"valid"),t=Yr(t,e.bn.sub),t=Ii(t,e.bn.truediv),Fy(t=Gt(t,e.conv.bias))})}function Nu(n,e){return We(function(){var t=ac(n,[[0,0],[1,1],[1,1],[0,0]]);return t=Wv(t,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),Fy(t=Gt(t,e.bias))})}var Py=function(){function n(e){var t=void 0===e?{}:e,r=t.inputSize,i=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=i||.5,"number"!=typeof this._inputSize||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),n}(),sS=function(n){function e(t){var r=n.call(this,"TinyYolov2")||this;return function(n){if(!n)throw new Error("invalid config: "+n);if("boolean"!=typeof n.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+n.withSeparableConvs);if(!v0(n.iouThreshold)||n.iouThreshold<0||n.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+n.iouThreshold);if(!Array.isArray(n.classes)||!n.classes.length||!n.classes.every(function(e){return"string"==typeof e}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(n.classes));if(!Array.isArray(n.anchors)||!n.anchors.length||!n.anchors.map(function(e){return e||{}}).every(function(e){return v0(e.x)&&v0(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(n.anchors));if(n.meanRgb&&(!Array.isArray(n.meanRgb)||3!==n.meanRgb.length||!n.meanRgb.every(v0)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(n.meanRgb))}(t),r._config=t,r}return At(e,n),Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,r){var i=Su(t,r.conv0);return i=Su(i=ri(i,[2,2],[2,2],"same"),r.conv1),i=Su(i=ri(i,[2,2],[2,2],"same"),r.conv2),i=Su(i=ri(i,[2,2],[2,2],"same"),r.conv3),i=Su(i=ri(i,[2,2],[2,2],"same"),r.conv4),i=Su(i=ri(i,[2,2],[2,2],"same"),r.conv5),i=Su(i=ri(i,[2,2],[1,1],"same"),r.conv6),Ts(i=Su(i,r.conv7),r.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,r){var i=this.config.isFirstLayerConv2d?Fy(Ts(t,r.conv0,"valid",!1)):Nu(t,r.conv0);return i=Nu(i=ri(i,[2,2],[2,2],"same"),r.conv1),i=Nu(i=ri(i,[2,2],[2,2],"same"),r.conv2),i=Nu(i=ri(i,[2,2],[2,2],"same"),r.conv3),i=Nu(i=ri(i,[2,2],[2,2],"same"),r.conv4),i=Nu(i=ri(i,[2,2],[2,2],"same"),r.conv5),i=ri(i,[2,2],[1,1],"same"),i=r.conv6?Nu(i,r.conv6):i,Ts(i=r.conv7?Nu(i,r.conv7):i,r.conv8,"valid",!1)},e.prototype.forwardInput=function(t,r){var i=this,o=this.params;if(!o)throw new Error("TinyYolov2 - load model before inference");return We(function(){var s=t.toBatchTensor(r,!1).toFloat();return s=(s=i.config.meanRgb?Ld(s,i.config.meanRgb):s).div(Pe(256)),i.config.withSeparableConvs?i.runMobilenet(s,o):i.runTinyYolov2(s,o)})},e.prototype.forward=function(t,r){return et(this,void 0,void 0,function(){var i;return tt(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,ii(t)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent()]}})})},e.prototype.detect=function(t,r){return void 0===r&&(r={}),et(this,void 0,void 0,function(){var i,o,s,a,c,f,p,m,y,w,E,A,N=this;return tt(this,function(M){switch(M.label){case 0:return i=new Py(r),o=i.inputSize,s=i.scoreThreshold,[4,ii(t)];case 1:return a=M.sent(),[4,this.forwardInput(a,o)];case 2:return c=M.sent(),f=We(function(){return Gr(c)[0].expandDims()}),p={width:a.getInputWidth(0),height:a.getInputHeight(0)},[4,this.extractBoxes(f,a.getReshapedInputDimensions(0),s)];case 3:return m=M.sent(),c.dispose(),f.dispose(),y=m.map(function(R){return R.box}),w=m.map(function(R){return R.score}),E=m.map(function(R){return R.classScore}),A=m.map(function(R){return N.config.classes[R.label]}),[2,kd(y.map(function(R){return R.rescale(o)}),w,this.config.iouThreshold,!0).map(function(R){return new ST(w[R],E[R],A[R],y[R],p)})]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return function(n,e){var a,t=[],r=function(n,e){var t=Tu(n,e);function i(a){return{filters:t(a+"/filters",4),bias:t(a+"/bias",1)}}return{extractConvParams:i,extractConvWithBatchNormParams:function(a){return{conv:i(a+"/conv"),bn:function(a){return{sub:t(a+"/sub",1),truediv:t(a+"/truediv",1)}}(a+"/bn")}},extractSeparableConvParams:Ny(t)}}(n,t),i=r.extractConvParams,o=r.extractConvWithBatchNormParams,s=r.extractSeparableConvParams;if(e.withSeparableConvs){var c=e.filterSizes&&e.filterSizes.length||9;a={conv0:e.isFirstLayerConv2d?i("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:c>7?s("conv6"):void 0,conv7:c>8?s("conv7"):void 0,conv8:i("conv8")}}else a={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:i("conv8")};return Va(n,t),{params:a,paramMappings:t}}(t,this.config)},e.prototype.extractParams=function(t){var r=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,i=r?r.length:void 0;if(7!==i&&8!==i&&9!==i)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+i+" filterSizes in config");return function(n,e,t,r){var y,i=Ua(n),s=i.getRemainingWeights,a=[],c=function(n,e){var t=p0(n,e),o=Sy(n,e);return{extractConvParams:t,extractConvWithBatchNormParams:function(s,a,c){return{conv:t(s,a,3,c+"/conv"),bn:function(s,a){var c=Or(n(s)),f=Or(n(s));return e.push({paramPath:a+"/sub"},{paramPath:a+"/truediv"}),{sub:c,truediv:f}}(a,c+"/bn")}},extractSeparableConvParams:o}}(i.extractWeights,a),f=c.extractConvParams,p=c.extractConvWithBatchNormParams,m=c.extractSeparableConvParams;if(e.withSeparableConvs){var w=r[0],E=r[1],A=r[2],_=r[3],T=r[4],N=r[5],M=r[6],R=r[7],P=r[8];y={conv0:e.isFirstLayerConv2d?f(w,E,3,"conv0"):m(w,E,"conv0"),conv1:m(E,A,"conv1"),conv2:m(A,_,"conv2"),conv3:m(_,T,"conv3"),conv4:m(T,N,"conv4"),conv5:m(N,M,"conv5"),conv6:R?m(M,R,"conv6"):void 0,conv7:P?m(R,P,"conv7"):void 0,conv8:f(P||R||M,5*t,1,"conv8")}}else A=r[2],_=r[3],T=r[4],N=r[5],M=r[6],R=r[7],P=r[8],y={conv0:p(w=r[0],E=r[1],"conv0"),conv1:p(E,A,"conv1"),conv2:p(A,_,"conv2"),conv3:p(_,T,"conv3"),conv4:p(T,N,"conv4"),conv5:p(N,M,"conv5"),conv6:p(M,R,"conv6"),conv7:p(R,P,"conv7"),conv8:f(P,5*t,1,"conv8")};if(0!==s().length)throw new Error("weights remaing after extract: "+s().length);return{params:y,paramMappings:a}}(t,this.config,this.boxEncodingSize,r)},e.prototype.extractBoxes=function(t,r,i){return et(this,void 0,void 0,function(){var o,s,a,c,f,p,m,y,w,E,A,_,T,N,M,R,P,B,Y,X,z,G,ee,J,pe,fe,he,xe,we,me=this;return tt(this,function(Ie){switch(Ie.label){case 0:return o=r.width,s=r.height,a=Math.max(o,s),c=a/o,f=a/s,p=t.shape[1],m=this.config.anchors.length,y=We(function(){var De=t.reshape([p,p,m,me.boxEncodingSize]);return[De.slice([0,0,0,0],[p,p,m,4]),De.slice([0,0,0,4],[p,p,m,1]),me.withClassScores?Ra(De.slice([0,0,0,5],[p,p,m,me.config.classes.length]),3):Pe(0)]}),w=y[0],A=y[2],_=[],[4,(E=y[1]).array()];case 1:return T=Ie.sent(),[4,w.array()];case 2:N=Ie.sent(),M=0,Ie.label=3;case 3:if(!(M<p))return[3,12];R=0,Ie.label=4;case 4:if(!(R<p))return[3,11];P=0,Ie.label=5;case 5:return P<m?(B=yy(T[M][R][P][0]),!i||B>i?(Y=(R+yy(N[M][R][P][0]))/p*c,X=(M+yy(N[M][R][P][1]))/p*f,z=Math.exp(N[M][R][P][2])*this.config.anchors[P].x/p*c,G=Math.exp(N[M][R][P][3])*this.config.anchors[P].y/p*f,ee=Y-z/2,J=X-G/2,pe={row:M,col:R,anchor:P},this.withClassScores?[4,this.extractPredictedClass(A,pe)]:[3,7]):[3,9]):[3,10];case 6:return we=Ie.sent(),[3,8];case 7:we={classScore:1,label:0},Ie.label=8;case 8:he=(fe=we).classScore,xe=fe.label,_.push(Di({box:new u0(ee,J,ee+z,J+G),score:B,classScore:B*he,label:xe},pe)),Ie.label=9;case 9:return P++,[3,5];case 10:return R++,[3,4];case 11:return M++,[3,3];case 12:return w.dispose(),E.dispose(),A.dispose(),[2,_]}})})},e.prototype.extractPredictedClass=function(t,r){return et(this,void 0,void 0,function(){var i,o,s,a;return tt(this,function(c){switch(c.label){case 0:return i=r.row,o=r.col,s=r.anchor,[4,t.array()];case 1:return a=c.sent(),[2,Array(this.config.classes.length).fill(0).map(function(f,p){return a[i][o][s][p]}).map(function(f,p){return{classScore:f,label:p}}).reduce(function(f,p){return f.classScore>p.classScore?f:p})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(Ba),IW=function(n){function e(t){void 0===t&&(t=!0);var i=Object.assign({},{withSeparableConvs:t,iouThreshold:.4,classes:["face"]},t?{anchors:mW,meanRgb:vW}:{anchors:gW,withClassScores:!0});return n.call(this,i)||this}return At(e,n),Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return et(this,void 0,void 0,function(){return tt(this,function(o){switch(o.label){case 0:return[4,this.detect(t,r)];case 1:return[2,o.sent().map(function(s){return new ca(s.score,s.relativeBox,{width:s.imageWidth,height:s.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e}(sS),AW=function(n){function e(){var t=null!==n&&n.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return At(e,n),e}(Py),Vd=function(){function n(){}return n.prototype.then=function(e){return et(this,void 0,void 0,function(){var t;return tt(this,function(r){switch(r.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[r.sent()])]}})})},n.prototype.run=function(){return et(this,void 0,void 0,function(){return tt(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},n}();function aS(n,e){return Object.assign({},n,{descriptor:e})}function y0(n,e,t,r,i){return void 0===i&&(i=function(o){return o.alignedRect}),et(this,void 0,void 0,function(){var o,s,a,c,f;return tt(this,function(p){switch(p.label){case 0:return o=n.map(function(m){return function(n){return function(n){return n.detection instanceof ca}(n)&&n.landmarks instanceof c0&&n.unshiftedLandmarks instanceof c0&&n.alignedRect instanceof ca}(m)?i(m):m.detection}),(a=r)?[3,5]:e instanceof Fn?[4,Ay(e,o)]:[3,2];case 1:return c=p.sent(),[3,4];case 2:return[4,Iy(e,o)];case 3:c=p.sent(),p.label=4;case 4:a=c,p.label=5;case 5:return[4,t(s=a)];case 6:return f=p.sent(),s.forEach(function(m){return m instanceof Fn&&m.dispose()}),[2,f]}})})}function ky(n,e,t,r,i){return et(this,void 0,void 0,function(){var o=this;return tt(this,function(s){return[2,y0([n],e,function(a){return et(o,void 0,void 0,function(){return tt(this,function(c){return[2,t(a[0])]})})},r,i)]})})}function Ly(n,e){var r=e[1];return{height:Math.floor(e[0]*n),width:Math.floor(r*n)}}var By=function(n){function e(t,r,i,o){return n.call(this,{left:t,top:r,right:i,bottom:o},!0)||this}return At(e,n),e}(ka);function uS(n){return We(function(){return Ii(Yr(n,Pe(127.5)),Pe(.0078125))})}function zl(n,e){return We(function(){return Gt(or(n),Ii(e,qp(or(qp(n)))))})}function Vy(n,e,t){return void 0===t&&(t=!1),We(function(){var r=Ts(n,e.conv1,"valid");return r=zl(r,e.prelu1_alpha),r=zl(r=Ts(r=ri(r,t?[2,2]:[3,3],[2,2],"same"),e.conv2,"valid"),e.prelu2_alpha),zl(r=Ts(r=t?r:ri(r,[3,3],[2,2],"valid"),e.conv3,"valid"),e.prelu3_alpha)})}function kW(n,e,t,r,i){i.stage1=[];var a=e.map(function(y){return We(function(){var w={scale:y},E=function(n,e){return We(function(){var t=Ly(e,n.shape.slice(1)),s=uS(Xv.resizeBilinear(n,[t.height,t.width]));return Eu(s,[0,2,1,3])})}(n,y),A=Date.now(),_=function(n,e){return We(function(){var t=Vy(n,e,!0),r=Ts(t,e.conv4_1,"valid"),i=Wo(t0(r,3),3);return{prob:Ra(Yr(r,i),3),regions:Ts(t,e.conv4_2,"valid")}})}(E,r),T=_.prob,N=_.regions;return w.pnet=Date.now()-A,{scoresTensor:Gr(Gr(T,3)[1])[0],regionsTensor:Gr(N)[0],scale:y,statsForScale:w}})}).map(function(y){var w=y.scoresTensor,E=y.regionsTensor,_=y.statsForScale,T=function(n,e,t,r){for(var i=[],o=n.arraySync(),s=0;s<n.shape[0];s++)for(var a=0;a<n.shape[1];a++)o[s][a]>=r&&i.push(new yn(a,s));return i.map(function(f){var p=new u0(Math.round((2*f.y+1)/t),Math.round((2*f.x+1)/t),Math.round((2*f.y+12)/t),Math.round((2*f.x+12)/t)),m=o[f.y][f.x],y=e.arraySync();return{cell:p,score:m,region:new By(y[f.y][f.x][0],y[f.y][f.x][1],y[f.y][f.x][2],y[f.y][f.x][3])}})}(w,E,y.scale,t);if(w.dispose(),E.dispose(),!T.length)return i.stage1.push(_),[];var N=Date.now(),M=kd(T.map(function(R){return R.cell}),T.map(function(R){return R.score}),.5);return _.nms=Date.now()-N,_.numBoxes=M.length,i.stage1.push(_),M.map(function(R){return T[R]})}).reduce(function(y,w){return y.concat(w)},[]),c=[],f=[];if(a.length>0){var p=Date.now(),m=kd(a.map(function(y){return y.cell}),a.map(function(y){return y.score}),.7);i.stage1_nms=Date.now()-p,f=m.map(function(y){return a[y].score}),c=m.map(function(y){return a[y]}).map(function(y){var w=y.cell,E=y.region;return new u0(w.left+E.left*w.width,w.top+E.top*w.height,w.right+E.right*w.width,w.bottom+E.bottom*w.height).toSquare().round()})}return{boxes:c,scores:f}}function cS(n,e,t){var r=t.width,i=t.height;return et(this,void 0,void 0,function(){var o,s,a,c=this;return tt(this,function(f){switch(f.label){case 0:return o=la(n),[4,Promise.all(e.map(function(p){return et(c,void 0,void 0,function(){var m,_,T,N;return tt(this,function(M){return m=p.padAtBorders(n.height,n.width),N=o.getImageData(_=m.x-1,T=m.y-1,m.ex-_,m.ey-T),[2,Ti.isNodejs()?_y(N):createImageBitmap(N)]})})}))];case 1:return s=f.sent(),a=[],s.forEach(function(p){var y=la(f0({width:r,height:i}));y.drawImage(p,0,0,r,i);for(var w=y.getImageData(0,0,r,i).data,E=[],A=0;A<w.length;A+=4)E.push(w[A+2]),E.push(w[A+1]),E.push(w[A]);a.push(E)}),[2,a.map(function(p){return We(function(){return uS(Eu(ro(p,[1,r,i,3]),[0,2,1,3]).toFloat())})})]}})})}function BW(n,e,t,r,i){return et(this,void 0,void 0,function(){var o,s,a,c,f,p,m,y,w,E,A,_,T,N;return tt(this,function(M){switch(M.label){case 0:return o=Date.now(),[4,cS(n,e,{width:24,height:24})];case 1:return s=M.sent(),i.stage2_extractImagePatches=Date.now()-o,o=Date.now(),a=s.map(function(R){var P=function(n,e){return We(function(){var t=Vy(n,e),o=zl(fa(Is(t,[t.shape[0],e.fc1.weights.shape[0]]),e.fc1),e.prelu4_alpha),s=fa(o,e.fc2_1),a=Wo(t0(s,1),1),c=Ra(Yr(s,a),1),f=fa(o,e.fc2_2);return{scores:Gr(c,1)[1],regions:f}})}(R,r);return R.dispose(),P}),i.stage2_rnet=Date.now()-o,c=a.length>1?zr(a.map(function(R){return R.scores})):a[0].scores,m=(p=Array).from,[4,c.data()];case 2:return f=m.apply(p,[M.sent()]),c.dispose(),y=f.map(function(R,P){return{score:R,idx:P}}).filter(function(R){return R.score>t}).map(function(R){return R.idx}),w=y.map(function(R){return e[R]}),E=y.map(function(R){return f[R]}),A=[],_=[],w.length>0&&(o=Date.now(),T=kd(w,E,.7),i.stage2_nms=Date.now()-o,N=T.map(function(R){var P=a[y[R]].regions.arraySync();return new By(P[0][0],P[0][1],P[0][2],P[0][3])}),_=T.map(function(R){return E[R]}),A=T.map(function(R,P){return w[R].calibrate(N[P])})),a.forEach(function(R){R.regions.dispose(),R.scores.dispose()}),[2,{boxes:A,scores:_}]}})})}function UW(n,e,t,r,i){return et(this,void 0,void 0,function(){var o,s,a,c,f,p,m,y,w,E,A,_,T,N,M;return tt(this,function(R){switch(R.label){case 0:return o=Date.now(),[4,cS(n,e,{width:48,height:48})];case 1:return s=R.sent(),i.stage3_extractImagePatches=Date.now()-o,o=Date.now(),a=s.map(function(P){var B=function(n,e){return We(function(){var t=Vy(n,e);t=zl(t=Ts(t=ri(t,[2,2],[2,2],"same"),e.conv4,"valid"),e.prelu4_alpha);var o=zl(fa(Is(t,[t.shape[0],e.fc1.weights.shape[0]]),e.fc1),e.prelu5_alpha),s=fa(o,e.fc2_1),a=Wo(t0(s,1),1),c=Ra(Yr(s,a),1),f=fa(o,e.fc2_2),p=fa(o,e.fc2_3);return{scores:Gr(c,1)[1],regions:f,points:p}})}(P,r);return P.dispose(),B}),i.stage3_onet=Date.now()-o,c=a.length>1?zr(a.map(function(P){return P.scores})):a[0].scores,m=(p=Array).from,[4,c.data()];case 2:return f=m.apply(p,[R.sent()]),c.dispose(),y=f.map(function(P,B){return{score:P,idx:B}}).filter(function(P){return P.score>t}).map(function(P){return P.idx}),w=y.map(function(P){var B=a[P].regions.arraySync();return new By(B[0][0],B[0][1],B[0][2],B[0][3])}),E=y.map(function(P,B){return e[P].calibrate(w[B])}),A=y.map(function(P){return f[P]}),_=[],T=[],N=[],E.length>0&&(o=Date.now(),M=kd(E,A,.7,!1),i.stage3_nms=Date.now()-o,_=M.map(function(P){return E[P]}),T=M.map(function(P){return A[P]}),N=M.map(function(P,B){return Array(5).fill(0).map(function(Y,X){var z=a[P].points.arraySync();return new yn(z[0][X]*(_[B].width+1)+_[B].left,z[0][X+5]*(_[B].height+1)+_[B].top)})})),a.forEach(function(P){P.regions.dispose(),P.scores.dispose(),P.points.dispose()}),[2,{boxes:_,scores:T,points:N}]}})})}var jW=function(n){function e(){return n.call(this,"Mtcnn")||this}return At(e,n),e.prototype.load=function(t){return et(this,void 0,void 0,function(){return tt(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.load.call(this,t)]})})},e.prototype.loadFromDisk=function(t){return et(this,void 0,void 0,function(){return tt(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.loadFromDisk.call(this,t)]})})},e.prototype.forwardInput=function(t,r){return void 0===r&&(r={}),et(this,void 0,void 0,function(){var i,o,s,a,c,f,p,m,y,w,E,A,_,T,M,R,P,B,Y,X;return tt(this,function(z){switch(z.label){case 0:if(!(i=this.params))throw new Error("Mtcnn - load model before inference");if(!(o=t.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return s={},a=Date.now(),c=We(function(){return function(n){return We(function(){return _o(Gr(n,3).reverse(),3)})}(Wo(fy.fromPixels(o)).toFloat())}),f=function(G){return c.dispose(),s.total=Date.now()-a,G},p=c.shape.slice(1),m=p[0],y=p[1],w=new iS(r),E=w.minFaceSize,A=w.scaleFactor,_=w.maxNumScales,T=w.scoreThresholds,M=(w.scaleSteps||function(n,e,t){for(var o=12/n,s=[],a=Math.min(t[0],t[1])*o,c=0;a>=12;)s.push(o*Math.pow(e,c)),a*=e,c+=1;return s}(E,A,[m,y])).filter(function(G){var ee=Ly(G,[m,y]);return Math.min(ee.width,ee.height)>12}).slice(0,_),s.scales=M,s.pyramid=M.map(function(G){return Ly(G,[m,y])}),R=Date.now(),[4,kW(c,M,T[0],i.pnet,s)];case 1:return P=z.sent(),s.total_stage1=Date.now()-R,P.boxes.length?(s.stage2_numInputBoxes=P.boxes.length,R=Date.now(),[4,BW(o,P.boxes,T[1],i.rnet,s)]):[2,f({results:[],stats:s})];case 2:return B=z.sent(),s.total_stage2=Date.now()-R,B.boxes.length?(s.stage3_numInputBoxes=B.boxes.length,R=Date.now(),[4,UW(o,B.boxes,T[2],i.onet,s)]):[2,f({results:[],stats:s})];case 3:return Y=z.sent(),s.total_stage3=Date.now()-R,X=Y.boxes.map(function(G,ee){return Ry(wy({},new ca(Y.scores[ee],new xy(G.left/y,G.top/m,G.width/y,G.height/m),{height:m,width:y})),new dj(Y.points[ee].map(function(J){return J.sub(new yn(G.left,G.top)).div(new yn(G.width,G.height))}),{width:G.width,height:G.height}))}),[2,f({results:X,stats:s})]}})})},e.prototype.forward=function(t,r){return void 0===r&&(r={}),et(this,void 0,void 0,function(){var i;return tt(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,ii(t)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent().results]}})})},e.prototype.forwardWithStats=function(t,r){return void 0===r&&(r={}),et(this,void 0,void 0,function(){var i;return tt(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,ii(t)];case 1:return[2,i.apply(this,[o.sent(),r])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(n){var e=[],t=function(n,e){var t=Tu(n,e);function r(p){return{filters:t(p+"/weights",4,p+"/filters"),bias:t(p+"/bias",1)}}function i(p){return{weights:t(p+"/weights",2),bias:t(p+"/bias",1)}}function o(p){return t(p,1)}function s(p){return{conv1:r(p+"/conv1"),prelu1_alpha:o(p+"/prelu1_alpha"),conv2:r(p+"/conv2"),prelu2_alpha:o(p+"/prelu2_alpha"),conv3:r(p+"/conv3"),prelu3_alpha:o(p+"/prelu3_alpha")}}return{extractPNetParams:function(){var p=s("pnet"),m=r("pnet/conv4_1"),y=r("pnet/conv4_2");return Di(Di({},p),{conv4_1:m,conv4_2:y})},extractRNetParams:function(){var p=s("rnet"),m=i("rnet/fc1"),y=o("rnet/prelu4_alpha"),w=i("rnet/fc2_1"),E=i("rnet/fc2_2");return Di(Di({},p),{fc1:m,prelu4_alpha:y,fc2_1:w,fc2_2:E})},extractONetParams:function(){var p=s("onet"),m=r("onet/conv4"),y=o("onet/prelu4_alpha"),w=i("onet/fc1"),E=o("onet/prelu5_alpha"),A=i("onet/fc2_1"),_=i("onet/fc2_2"),T=i("onet/fc2_3");return Di(Di({},p),{conv4:m,prelu4_alpha:y,fc1:w,prelu5_alpha:E,fc2_1:A,fc2_2:_,fc2_3:T})}}}(n,e),i=t.extractRNetParams,o=t.extractONetParams,s=(0,t.extractPNetParams)(),a=i(),c=o();return Va(n,e),{params:{pnet:s,rnet:a,onet:c},paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(n){var e=Ua(n),r=e.getRemainingWeights,i=[],o=function(n,e){var t=p0(n,e),r=Ty(n,e);function i(f,p){var m=Or(n(f));return e.push({paramPath:p}),m}function o(f,p,m){return void 0===m&&(m=!1),{conv1:t(f[0],f[1],3,p+"/conv1"),prelu1_alpha:i(f[1],p+"/prelu1_alpha"),conv2:t(f[1],f[2],3,p+"/conv2"),prelu2_alpha:i(f[2],p+"/prelu2_alpha"),conv3:t(f[2],f[3],m?2:3,p+"/conv3"),prelu3_alpha:i(f[3],p+"/prelu3_alpha")}}return{extractPNetParams:function(){var f=o([3,10,16,32],"pnet"),p=t(32,2,1,"pnet/conv4_1"),m=t(32,4,1,"pnet/conv4_2");return Di(Di({},f),{conv4_1:p,conv4_2:m})},extractRNetParams:function(){var f=o([3,28,48,64],"rnet",!0),p=r(576,128,"rnet/fc1"),m=i(128,"rnet/prelu4_alpha"),y=r(128,2,"rnet/fc2_1"),w=r(128,4,"rnet/fc2_2");return Di(Di({},f),{fc1:p,prelu4_alpha:m,fc2_1:y,fc2_2:w})},extractONetParams:function(){var f=o([3,32,64,64],"onet"),p=t(64,128,2,"onet/conv4"),m=i(128,"onet/prelu4_alpha"),y=r(1152,256,"onet/fc1"),w=i(256,"onet/prelu5_alpha"),E=r(256,2,"onet/fc2_1"),A=r(256,4,"onet/fc2_2"),_=r(256,10,"onet/fc2_3");return Di(Di({},f),{conv4:p,prelu4_alpha:m,fc1:y,prelu5_alpha:w,fc2_1:E,fc2_2:A,fc2_3:_})}}}(e.extractWeights,i),a=o.extractRNetParams,c=o.extractONetParams,f=(0,o.extractPNetParams)(),p=a(),m=c();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:f,rnet:p,onet:m},paramMappings:i}}(t)},e}(Ba),HW=[new yn(1.603231,2.094468),new yn(6.041143,7.080126),new yn(2.882459,3.518061),new yn(4.266906,5.178857),new yn(9.041765,10.66308)],zW=[117.001,114.697,97.404],GW=function(n){function e(){return n.call(this,{withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:HW,meanRgb:zW,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]})||this}return At(e,n),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return et(this,void 0,void 0,function(){return tt(this,function(o){switch(o.label){case 0:return[4,this.detect(t,r)];case 1:return[2,o.sent().map(function(s){return new ca(s.score,s.relativeBox,{width:s.imageWidth,height:s.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e}(sS),mn={ssdMobilenetv1:new oS,tinyFaceDetector:new GW,tinyYolov2:new IW,mtcnn:new jW,faceLandmark68Net:new eS,faceLandmark68TinyNet:new Gj,faceRecognitionNet:new Zj,faceExpressionNet:new Sj,ageGenderNet:new jj};function lS(n,e){return Object.assign({},n,{age:e})}var fS=function(n){function e(t,r,i){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o.extractedFaces=i,o}return At(e,n),e}(Vd),Uy=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return At(e,n),e.prototype.run=function(){return et(this,void 0,void 0,function(){var t,r,i=this;return tt(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return[4,y0(t=o.sent(),this.input,function(s){return et(i,void 0,void 0,function(){return tt(this,function(a){switch(a.label){case 0:return[4,Promise.all(s.map(function(c){return mn.faceExpressionNet.predictExpressions(c)}))];case 1:return[2,a.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,t.map(function(s,a){return $T(s,r[a])})]}})})},e.prototype.withAgeAndGender=function(){return new zy(this,this.input)},e}(fS),jy=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return At(e,n),e.prototype.run=function(){return et(this,void 0,void 0,function(){var t,r;return tt(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return(t=i.sent())?[4,ky(t,this.input,function(o){return mn.faceExpressionNet.predictExpressions(o)},this.extractedFaces)]:[2];case 2:return r=i.sent(),[2,$T(t,r)]}})})},e.prototype.withAgeAndGender=function(){return new Gy(this,this.input)},e}(fS),Wy=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return At(e,n),e.prototype.withAgeAndGender=function(){return new Yy(this,this.input)},e.prototype.withFaceDescriptors=function(){return new qy(this,this.input)},e}(Uy),Hy=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return At(e,n),e.prototype.withAgeAndGender=function(){return new Xy(this,this.input)},e.prototype.withFaceDescriptor=function(){return new Ky(this,this.input)},e}(jy),dS=function(n){function e(t,r,i){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o.extractedFaces=i,o}return At(e,n),e}(Vd),zy=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return At(e,n),e.prototype.run=function(){return et(this,void 0,void 0,function(){var t,r,i=this;return tt(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return[4,y0(t=o.sent(),this.input,function(s){return et(i,void 0,void 0,function(){return tt(this,function(a){switch(a.label){case 0:return[4,Promise.all(s.map(function(c){return mn.ageGenderNet.predictAgeAndGender(c)}))];case 1:return[2,a.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,t.map(function(s,a){var c=r[a],f=c.age;return lS(rS(s,c.gender,c.genderProbability),f)})]}})})},e.prototype.withFaceExpressions=function(){return new Uy(this,this.input)},e}(dS),Gy=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return At(e,n),e.prototype.run=function(){return et(this,void 0,void 0,function(){var t,r,i;return tt(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return(t=a.sent())?[4,ky(t,this.input,function(c){return mn.ageGenderNet.predictAgeAndGender(c)},this.extractedFaces)]:[2];case 2:return r=a.sent(),i=r.age,[2,lS(rS(t,r.gender,r.genderProbability),i)]}})})},e.prototype.withFaceExpressions=function(){return new jy(this,this.input)},e}(dS),Yy=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return At(e,n),e.prototype.withFaceExpressions=function(){return new Wy(this,this.input)},e.prototype.withFaceDescriptors=function(){return new qy(this,this.input)},e}(zy),Xy=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return At(e,n),e.prototype.withFaceExpressions=function(){return new Hy(this,this.input)},e.prototype.withFaceDescriptor=function(){return new Ky(this,this.input)},e}(Gy),hS=function(n){function e(t,r){var i=n.call(this)||this;return i.parentTask=t,i.input=r,i}return At(e,n),e}(Vd),qy=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return At(e,n),e.prototype.run=function(){return et(this,void 0,void 0,function(){var t;return tt(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return[4,y0(t=i.sent(),this.input,function(o){return Promise.all(o.map(function(s){return mn.faceRecognitionNet.computeFaceDescriptor(s)}))},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,i.sent().map(function(o,s){return aS(t[s],o)})]}})})},e.prototype.withFaceExpressions=function(){return new Wy(this,this.input)},e.prototype.withAgeAndGender=function(){return new Yy(this,this.input)},e}(hS),Ky=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return At(e,n),e.prototype.run=function(){return et(this,void 0,void 0,function(){var t,r;return tt(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return(t=i.sent())?[4,ky(t,this.input,function(o){return mn.faceRecognitionNet.computeFaceDescriptor(o)},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=i.sent(),[2,aS(t,r)]}})})},e.prototype.withFaceExpressions=function(){return new Hy(this,this.input)},e.prototype.withAgeAndGender=function(){return new Xy(this,this.input)},e}(hS),pS=function(n){function e(t,r,i){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o.useTinyLandmarkNet=i,o}return At(e,n),Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?mn.faceLandmark68TinyNet:mn.faceLandmark68Net},enumerable:!0,configurable:!0}),e}(Vd),YW=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return At(e,n),e.prototype.run=function(){return et(this,void 0,void 0,function(){var t,r,i,o,s,a=this;return tt(this,function(c){switch(c.label){case 0:return[4,this.parentTask];case 1:return t=c.sent(),r=t.map(function(f){return f.detection}),this.input instanceof Fn?[4,Ay(this.input,r)]:[3,3];case 2:return o=c.sent(),[3,5];case 3:return[4,Iy(this.input,r)];case 4:o=c.sent(),c.label=5;case 5:return i=o,[4,Promise.all(i.map(function(f){return a.landmarkNet.detectLandmarks(f)}))];case 6:return s=c.sent(),i.forEach(function(f){return f instanceof Fn&&f.dispose()}),[2,t.map(function(f,p){return Ry(f,s[p])})]}})})},e.prototype.withFaceExpressions=function(){return new Wy(this,this.input)},e.prototype.withAgeAndGender=function(){return new Yy(this,this.input)},e.prototype.withFaceDescriptors=function(){return new qy(this,this.input)},e}(pS),XW=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return At(e,n),e.prototype.run=function(){return et(this,void 0,void 0,function(){var t,r,i,o,s;return tt(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return(t=a.sent())?(r=t.detection,this.input instanceof Fn?[4,Ay(this.input,[r])]:[3,3]):[2];case 2:return o=a.sent(),[3,5];case 3:return[4,Iy(this.input,[r])];case 4:o=a.sent(),a.label=5;case 5:return[4,this.landmarkNet.detectLandmarks((i=o)[0])];case 6:return s=a.sent(),i.forEach(function(c){return c instanceof Fn&&c.dispose()}),[2,Ry(t,s)]}})})},e.prototype.withFaceExpressions=function(){return new Hy(this,this.input)},e.prototype.withAgeAndGender=function(){return new Xy(this,this.input)},e.prototype.withFaceDescriptor=function(){return new Ky(this,this.input)},e}(pS),gS=function(n){function e(t,r){void 0===r&&(r=new m0);var i=n.call(this)||this;return i.input=t,i.options=r,i}return At(e,n),e}(Vd),qW=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return At(e,n),e.prototype.run=function(){return et(this,void 0,void 0,function(){var t,r,i,o;return tt(this,function(s){switch(s.label){case 0:return r=(t=this).input,(i=t.options)instanceof iS?[4,mn.mtcnn.forward(r,i)]:[3,2];case 1:return[2,s.sent().map(function(a){return a.detection})];case 2:if(!(o=i instanceof AW?function(a){return mn.tinyFaceDetector.locateFaces(a,i)}:i instanceof m0?function(a){return mn.ssdMobilenetv1.locateFaces(a,i)}:i instanceof Py?function(a){return mn.tinyYolov2.locateFaces(a,i)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,o(r)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(r){return et(t,void 0,void 0,function(){var i;return tt(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i.map(function(s){return wy({},s)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new YW(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new Uy(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new zy(this.runAndExtendWithFaceDetections(),this.input)},e}(gS),KW=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return At(e,n),e.prototype.run=function(){return et(this,void 0,void 0,function(){var t,r;return tt(this,function(i){switch(i.label){case 0:return[4,new qW(this.input,this.options)];case 1:return t=i.sent(),r=t[0],t.forEach(function(o){o.score>r.score&&(r=o)}),[2,r]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(r){return et(t,void 0,void 0,function(){var i;return tt(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i?wy({},i):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new XW(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new jy(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new Gy(this.runAndExtendWithFaceDetection(),this.input)},e}(gS);!function(){function n(e,t){void 0===t&&(t=.6),this._distanceThreshold=t;var r=Array.isArray(e)?e:[e];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var i=1,o=function(){return"person "+i++};this._labeledDescriptors=r.map(function(s){if(s instanceof l0)return s;if(s instanceof Float32Array)return new l0(o(),[s]);if(s.descriptor&&s.descriptor instanceof Float32Array)return new l0(o(),[s.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}Object.defineProperty(n.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),n.prototype.computeMeanDistance=function(e,t){return t.map(function(r){return function(n,e){if(n.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var t=Array.from(n),r=Array.from(e);return Math.sqrt(t.map(function(i,o){return i-r[o]}).reduce(function(i,o){return i+Math.pow(o,2)},0))}(r,e)}).reduce(function(r,i){return r+i},0)/(t.length||1)},n.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(r){return new RT(r.label,t.computeMeanDistance(e,r.descriptors))}).reduce(function(r,i){return r.distance<i.distance?r:i})},n.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new RT("unknown",t.distance)},n.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(e){return e.toJSON()})}},n.fromJSON=function(e){return new n(e.labeledDescriptors.map(function(r){return l0.fromJSON(r)}),e.distanceThreshold)}}();let JW=(()=>{class n{constructor(){mn.ssdMobilenetv1.loadFromUri(xs_faceApiSourceUrl),mn.faceLandmark68Net.loadFromUri(xs_faceApiSourceUrl),mn.faceRecognitionNet.loadFromUri(xs_faceApiSourceUrl)}getSingleFaceDescriptor(t){var r=this;return Nr(function*(){const i=yield r.getSingleFace(t);return null==i?void 0:i.descriptor})()}getSingleFace(t){return Nr(function*(){return yield function(n,e){return void 0===e&&(e=new m0),new KW(n,e)}(t).withFaceLandmarks().withFaceDescriptor()})()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Xe({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class eH extends Dt{constructor(e,t){super()}schedule(e,t=0){return this}}class mS extends eH{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){if(this.closed)return this;this.state=e;const r=this.id,i=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(i,r,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(i,this.id,t),this}requestAsyncId(e,t,r=0){return setInterval(e.flush.bind(e,this),r)}recycleAsyncId(e,t,r=0){if(null!==r&&this.delay===r&&!1===this.pending)return t;clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(e,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let i,r=!1;try{this.work(e)}catch(o){r=!0,i=!!o&&o||new Error(o)}if(r)return this.unsubscribe(),i}_unsubscribe(){const e=this.id,t=this.scheduler,r=t.actions,i=r.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==i&&r.splice(i,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null}}let vS=(()=>{class n{constructor(t,r=n.now){this.SchedulerAction=t,this.now=r}schedule(t,r=0,i){return new this.SchedulerAction(this,t).schedule(i,r)}}return n.now=()=>Date.now(),n})();class ja extends vS{constructor(e,t=vS.now){super(e,()=>ja.delegate&&ja.delegate!==this?ja.delegate.now():t()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(e,t=0,r){return ja.delegate&&ja.delegate!==this?ja.delegate.schedule(e,t,r):super.schedule(e,t,r)}flush(e){const{actions:t}=this;if(this.active)return void t.push(e);let r;this.active=!0;do{if(r=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,r){for(;e=t.shift();)e.unsubscribe();throw r}}}const rH=new class extends ja{}(class extends mS{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}schedule(e,t=0){return t>0?super.schedule(e,t):(this.delay=t,this.state=e,this.scheduler.flush(this),this)}execute(e,t){return t>0||this.closed?super.execute(e,t):this._execute(e,t)}requestAsyncId(e,t,r=0){return null!==r&&r>0||null===r&&this.delay>0?super.requestAsyncId(e,t,r):e.flush(this)}}),iH=new Ee(n=>n.complete());class zo{constructor(e,t,r){this.kind=e,this.value=t,this.error=r,this.hasValue="N"===e}observe(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}}do(e,t,r){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return r&&r()}}accept(e,t,r){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,r)}toObservable(){switch(this.kind){case"N":return function(...n){let e=n[n.length-1];return ht(e)?(n.pop(),Pt(n,e)):br(n)}(this.value);case"E":return function(n,e){return new Ee(t=>t.error(n))}(this.error);case"C":return function(n){return n?function(n){return new Ee(e=>n.schedule(()=>e.complete()))}(n):iH}()}throw new Error("unexpected notification kind value")}static createNext(e){return void 0!==e?new zo("N",e):zo.undefinedValueNotification}static createError(e){return new zo("E",void 0,e)}static createComplete(){return zo.completeNotification}}zo.completeNotification=new zo("C"),zo.undefinedValueNotification=new zo("N",void 0);class b0 extends wr{constructor(e,t,r=0){super(e),this.scheduler=t,this.delay=r}static dispatch(e){const{notification:t,destination:r}=e;t.observe(r),this.unsubscribe()}scheduleMessage(e){this.destination.add(this.scheduler.schedule(b0.dispatch,this.delay,new fH(e,this.destination)))}_next(e){this.scheduleMessage(zo.createNext(e))}_error(e){this.scheduleMessage(zo.createError(e)),this.unsubscribe()}_complete(){this.scheduleMessage(zo.createComplete()),this.unsubscribe()}}class fH{constructor(e,t){this.notification=e,this.destination=t}}class dH extends ce{constructor(e=Number.POSITIVE_INFINITY,t=Number.POSITIVE_INFINITY,r){super(),this.scheduler=r,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=e<1?1:e,this._windowTime=t<1?1:t,t===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(e){if(!this.isStopped){const t=this._events;t.push(e),t.length>this._bufferSize&&t.shift()}super.next(e)}nextTimeWindow(e){this.isStopped||(this._events.push(new hH(this._getNow(),e)),this._trimBufferThenGetEvents()),super.next(e)}_subscribe(e){const t=this._infiniteTimeWindow,r=t?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,o=r.length;let s;if(this.closed)throw new at;if(this.isStopped||this.hasError?s=Dt.EMPTY:(this.observers.push(e),s=new rn(this,e)),i&&e.add(e=new b0(e,i)),t)for(let a=0;a<o&&!e.closed;a++)e.next(r[a]);else for(let a=0;a<o&&!e.closed;a++)e.next(r[a].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),s}_getNow(){return(this.scheduler||rH).now()}_trimBufferThenGetEvents(){const e=this._getNow(),t=this._bufferSize,r=this._windowTime,i=this._events,o=i.length;let s=0;for(;s<o&&!(e-i[s].time<r);)s++;return o>t&&(s=Math.max(s,o-t)),s>0&&i.splice(0,s),i}}class hH{constructor(e,t){this.time=e,this.value=t}}function yS(n,e){return"function"==typeof e?t=>t.pipe(yS((r,i)=>Ni(n(r,i)).pipe(No((o,s)=>e(r,o,i,s))))):t=>t.lift(new pH(n))}class pH{constructor(e){this.project=e}call(e,t){return t.subscribe(new gH(e,this.project))}}class gH extends Ue{constructor(e,t){super(e),this.project=t,this.index=0}_next(e){let t;const r=this.index++;try{t=this.project(e,r)}catch(i){return void this.destination.error(i)}this._innerSub(t)}_innerSub(e){const t=this.innerSubscription;t&&t.unsubscribe();const r=new Vt(this),i=this.destination;i.add(r),this.innerSubscription=Oo(e,r),this.innerSubscription!==r&&i.add(this.innerSubscription)}_complete(){const{innerSubscription:e}=this;(!e||e.closed)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(e){this.destination.next(e)}}const C0={schedule(n,e){const t=setTimeout(n,e);return()=>clearTimeout(t)},scheduleBeforeRender(n){if("undefined"==typeof window)return C0.schedule(n,0);if(void 0===window.requestAnimationFrame)return C0.schedule(n,16);const e=window.requestAnimationFrame(n);return()=>window.cancelAnimationFrame(e)}};let Qy;function IH(n,e,t){let r=t;return function(n){return!!n&&n.nodeType===Node.ELEMENT_NODE}(n)&&e.some((i,o)=>!("*"===i||!function(n,e){if(!Qy){const t=Element.prototype;Qy=t.matches||t.matchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector||t.webkitMatchesSelector}return n.nodeType===Node.ELEMENT_NODE&&Qy.call(n,e)}(n,i)||(r=o,0))),r}class DH{constructor(e,t){this.componentFactory=t.get(du).resolveComponentFactory(e)}create(e){return new TH(this.componentFactory,e)}}class TH{constructor(e,t){this.componentFactory=e,this.injector=t,this.eventEmitters=new dH(1),this.events=this.eventEmitters.pipe(yS(r=>qo(...r))),this.componentRef=null,this.viewChangeDetectorRef=null,this.inputChanges=null,this.hasInputChanges=!1,this.implementsOnChanges=!1,this.scheduledChangeDetectionFn=null,this.scheduledDestroyFn=null,this.initialInputValues=new Map,this.unchangedInputs=new Set(this.componentFactory.inputs.map(({propName:r})=>r)),this.ngZone=this.injector.get(Jr),this.elementZone="undefined"==typeof Zone?null:this.ngZone.run(()=>Zone.current)}connect(e){this.runInZone(()=>{if(null!==this.scheduledDestroyFn)return this.scheduledDestroyFn(),void(this.scheduledDestroyFn=null);null===this.componentRef&&this.initializeComponent(e)})}disconnect(){this.runInZone(()=>{null===this.componentRef||null!==this.scheduledDestroyFn||(this.scheduledDestroyFn=C0.schedule(()=>{null!==this.componentRef&&(this.componentRef.destroy(),this.componentRef=null,this.viewChangeDetectorRef=null)},10))})}getInputValue(e){return this.runInZone(()=>null===this.componentRef?this.initialInputValues.get(e):this.componentRef.instance[e])}setInputValue(e,t){this.runInZone(()=>{null!==this.componentRef?function(n,e){return n===e||n!=n&&e!=e}(t,this.getInputValue(e))&&(void 0!==t||!this.unchangedInputs.has(e))||(this.recordInputChange(e,t),this.unchangedInputs.delete(e),this.hasInputChanges=!0,this.componentRef.instance[e]=t,this.scheduleDetectChanges()):this.initialInputValues.set(e,t)})}initializeComponent(e){const t=kn.create({providers:[],parent:this.injector}),r=function(n,e){const t=n.childNodes,r=e.map(()=>[]);let i=-1;e.some((o,s)=>"*"===o&&(i=s,!0));for(let o=0,s=t.length;o<s;++o){const a=t[o],c=IH(a,e,i);-1!==c&&r[c].push(a)}return r}(e,this.componentFactory.ngContentSelectors);this.componentRef=this.componentFactory.create(t,r,e),this.viewChangeDetectorRef=this.componentRef.injector.get(y1),this.implementsOnChanges=function(n){return"function"==typeof n}(this.componentRef.instance.ngOnChanges),this.initializeInputs(),this.initializeOutputs(this.componentRef),this.detectChanges(),this.injector.get(xl).attachView(this.componentRef.hostView)}initializeInputs(){this.componentFactory.inputs.forEach(({propName:e})=>{this.initialInputValues.has(e)&&this.setInputValue(e,this.initialInputValues.get(e))}),this.initialInputValues.clear()}initializeOutputs(e){const t=this.componentFactory.outputs.map(({propName:r,templateName:i})=>e.instance[r].pipe(No(s=>({name:i,value:s}))));this.eventEmitters.next(t)}callNgOnChanges(e){if(!this.implementsOnChanges||null===this.inputChanges)return;const t=this.inputChanges;this.inputChanges=null,e.instance.ngOnChanges(t)}markViewForCheck(e){this.hasInputChanges&&(this.hasInputChanges=!1,e.markForCheck())}scheduleDetectChanges(){this.scheduledChangeDetectionFn||(this.scheduledChangeDetectionFn=C0.scheduleBeforeRender(()=>{this.scheduledChangeDetectionFn=null,this.detectChanges()}))}recordInputChange(e,t){if(!this.implementsOnChanges)return;null===this.inputChanges&&(this.inputChanges={});const r=this.inputChanges[e];if(r)return void(r.currentValue=t);const i=this.unchangedInputs.has(e),o=i?void 0:this.getInputValue(e);this.inputChanges[e]=new x(o,t,i)}detectChanges(){null!==this.componentRef&&(this.callNgOnChanges(this.componentRef),this.markViewForCheck(this.viewChangeDetectorRef),this.componentRef.changeDetectorRef.detectChanges())}runInZone(e){return this.elementZone&&Zone.current!==this.elementZone?this.ngZone.run(e):e()}}class SH extends HTMLElement{constructor(){super(...arguments),this.ngElementEventsSubscription=null}}const xS=new ja(mS);function OH(n){const{subscriber:e,counter:t,period:r}=n;e.next(t),this.schedule({subscriber:e,counter:t+1,period:r},r)}class PH{constructor(e){this.notifier=e}call(e,t){const r=new kH(e),i=Oo(this.notifier,new Vt(r));return i&&!r.seenValue?(r.add(i),t.subscribe(r)):r}}class kH extends Ue{constructor(e){super(e),this.seenValue=!1}notifyNext(){this.seenValue=!0,this.complete()}notifyComplete(){}}const wS={pitch:20,yaw:20,roll:10};function E0(n){const{leftEyeInner:e,rightEyeInner:r,leftEar:o,rightEar:s}=function(n){const[e,t,r,i,o,s,a,c,f,p,m,...y]=n;return{nose:e,leftEyeInner:t,leftEyeCenter:r,leftEyeOuter:i,rightEyeInner:o,rightEyeCenter:s,rightEyeOuter:a,leftEar:c,rightEar:f,mouthLeft:p,mouthRight:m}}(n.poseLandmarks);return function(n,e,t){const[r,i,o]=[e.x-n.x,e.y-n.y,e.z-n.z],s=r*r,a=o*o,c=i*i,p=(Math.sqrt(s+c+a),Math.atan2(o,Math.sqrt(s+c))),m=Math.atan2(i,Math.sqrt(s+a)),y={z:t.z-n.z,x:t.x-n.x,y:t.y-n.y},w=Object.assign(Object.assign({},y),{x:Math.sin(-p)*y.z+Math.cos(-p)*y.x,z:Math.cos(-p)*y.z-Math.sin(-p)*y.x}),E=Object.assign(Object.assign({},w),{x:Math.cos(-m)*w.x-Math.sin(-m)*w.y,y:Math.sin(-m)*w.x+Math.cos(-m)*w.y}),_=180*Math.atan2(E.y,E.z)/Math.PI%180;return{yaw:180*p/Math.PI,roll:180*m/Math.PI,pitch:(180-Math.abs(_))*(_>0?-1:1)}}(o,s,{x:(e.x+r.x)/2,y:(e.y+r.y)/2,z:(e.z+r.z)/2})}const BH=["videoRef"],VH=["overlayRef"];function UH(n,e){1&n&&(An(0,"span"),ai(1,"Webcam Input: "),Dn())}function jH(n,e){if(1&n){const t=wi();An(0,"app-webcam-list",9),Zr("selectCamera",function(i){return vi(t),si().cameraId=i}),Dn()}}function WH(n,e){if(1&n){const t=wi();An(0,"button",10),Zr("click",function(){return vi(t),si().startStream()}),ai(1,"Start"),Dn()}2&n&&In("disabled",!si().cameraId)}function HH(n,e){if(1&n){const t=wi();An(0,"button",11),Zr("click",function(){return vi(t),si().stopStream()}),ai(1,"Stop"),Dn()}}function zH(n,e){if(1&n){const t=wi();An(0,"button",11),Zr("click",function(){return vi(t),si().onCapture()}),ai(1,"Capture"),Dn()}}function GH(n,e){if(1&n&&(An(0,"option",3),ai(1),Dn()),2&n){const t=si().$implicit;In("value",t.deviceId),Hn(1),a1(t.label)}}function YH(n,e){if(1&n&&(function(n,e,t){const r=_e(),i=ln(),o=n+20,s=i.firstCreatePass?function(n,e,t,r,i){const o=e.consts,s=su(o,r),a=zc(e,n,8,"ng-container",s);return null!==s&&Eh(a,s,!0),Fg(e,t,a,su(o,i)),null!==e.queries&&e.queries.elementStart(e,a),a}(o,i,r,e,t):i.data[o];zs(s,!0);const a=r[o]=r[11].createComment("");mh(i,r,a,s),yi(a,r),iu(s)&&(Mg(i,r,s),$2(i,s,r)),null!=t&&Og(r,s)}(0),Dr(1,GH,2,2,"option",2),function(){let n=Ur();const e=ln();O0()?F0():(n=n.parent,zs(n,!1)),e.firstCreatePass&&(Qd(e,n),tf(n)&&e.queries.elementEnd(n))}()),2&n){const t=e.$implicit;Hn(1),In("ngIf",t.deviceId)}}const _0={facingMode:"user",width:{ideal:1280,min:640},height:{ideal:780,min:480}};let I0=(()=>{class n{constructor(t){this.host=t,this.fps=20,this.shouldPlay=!1,this.capture=new Ei,this.error=new Ei,this.width=_0.width,this.height=_0.height}ngOnInit(){this.shouldPlay&&this.startStream()}ngOnChanges(t){t.shouldPlay.previousValue!==this.shouldPlay&&this.shouldPlay&&this.startStream()}ngAfterViewInit(){return Nr(function*(){})()}ngOnDestroy(){this.shouldPlay=!1,this.stopStream()}startStream(){var t=this;return Nr(function*(){yield t.startStreamInstance(),t.updateStartStreamAttribute()})()}stopStream(){var t=this;return Nr(function*(){var r;t.hideElements(),yield t.stopStreamInstance(),null===(r=t.videoRef)||void 0===r||r.nativeElement.pause()})()}onCapture(){var t=this;return Nr(function*(){if(!t.videoRef)return;const r=t.getImgFromCanvas();t.capture.emit(r)})()}stopStreamInstance(){var t=this;return Nr(function*(){var r;null===(r=t.stream)||void 0===r||r.getTracks().forEach(i=>i.stop())})()}startStreamInstance(){var t=this;return Nr(function*(){const r=Object.assign({},_0);t.cameraId&&(r.deviceId=t.cameraId),t.stream=yield navigator.mediaDevices.getUserMedia({video:r});const{width:i,height:o}=t.stream.getVideoTracks()[0].getSettings();i&&(t.width=i),o&&(t.height=o)})()}updateStartStreamAttribute(){this.host.nativeElement.classList.add("popup"),this.shouldPlay=!0}getImgFromCanvas(t=0,r=0,i,o){var s,a;if(!this.videoRef)return;const c=document.createElement("canvas"),f=null===(s=this.videoRef)||void 0===s?void 0:s.nativeElement;c.width=null!=i?i:f.videoWidth,c.height=null!=o?o:f.videoHeight,null===(a=c.getContext("2d"))||void 0===a||a.drawImage(f,t,r,c.width,c.height,0,0,c.width,c.height);const p=document.createElement("img");return p.src=c.toDataURL(),p.width=c.width,p.height=c.height,p}onPlay(t){this.shouldPlay&&setTimeout(()=>this.onPlay(t),1e3/this.fps)}selectCamera(t){var r;this.cameraId=null===(r=t.target)||void 0===r?void 0:r.value}hideElements(){this.host.nativeElement.classList.remove("popup"),this.shouldPlay=!1}}return n.\u0275fac=function(t){return new(t||n)(Mt(Ui))},n.\u0275cmp=ye({type:n,selectors:[["app-webcam-input"]],viewQuery:function(t,r){if(1&t&&(U1(BH,5,Ui),U1(VH,5,Ui)),2&t){let i;V1(i=j1())&&(r.videoRef=i.first),V1(i=j1())&&(r.overlayRef=i.first)}},inputs:{fps:"fps",shouldPlay:"shouldPlay"},outputs:{capture:"capture",error:"error"},features:[b],decls:10,vars:12,consts:[["id","videoRef","autoplay","","muted","",3,"srcObject","width","height","play"],["videoRef",""],["id","overlayRef"],["overlayRef",""],[1,"buttons"],[4,"ngIf"],[3,"selectCamera",4,"ngIf"],["type","button",3,"disabled","click",4,"ngIf"],["type","button",3,"click",4,"ngIf"],[3,"selectCamera"],["type","button",3,"disabled","click"],["type","button",3,"click"]],template:function(t,r){if(1&t){const i=wi();An(0,"video",0,1),Zr("play",function(){vi(i);const s=Ah(1);return r.onPlay(s)}),Dn(),Th(2,"canvas",2,3),An(4,"div",4),Dr(5,UH,2,0,"span",5),Dr(6,jH,1,0,"app-webcam-list",6),Dr(7,WH,2,1,"button",7),Dr(8,HH,2,0,"button",8),Dr(9,zH,2,0,"button",8),Dn()}2&t&&(Js("hidden",!r.shouldPlay),In("srcObject",r.stream)("width",r.width)("height",r.height),Hn(4),Js("absolute",r.shouldPlay),Hn(1),In("ngIf",!r.shouldPlay),Hn(1),In("ngIf",!r.shouldPlay),Hn(1),In("ngIf",!r.shouldPlay),Hn(1),In("ngIf",r.shouldPlay),Hn(1),In("ngIf",r.shouldPlay))},directives:function(){return[Cl,Ud]},styles:["[_nghost-%COMP%]{position:relative;text-align:center}.popup[_nghost-%COMP%]{position:absolute;z-index:999;top:10vh;left:50%;transform:translate(-50%);box-shadow:1px 1px 14px #000000bf;max-height:90vh;width:95vw;min-height:10vh;min-width:30vw;background-color:#fff}video[_ngcontent-%COMP%]{transform:rotateY(180deg);min-height:inherit;min-width:inherit;max-height:100%;max-width:100%}canvas[_ngcontent-%COMP%]{display:none}.buttons[_ngcontent-%COMP%]{display:flex;align-items:center}.buttons[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{white-space:nowrap}.buttons.absolute[_ngcontent-%COMP%]{position:absolute;bottom:0;left:50%;transform:translate(-50%)}.hidden[_ngcontent-%COMP%]{display:none}"]}),n})(),Ud=(()=>{class n{constructor(){this.cameraList$=this.getCameraList(),this.selectCamera=new Ei}ngOnInit(){var t=this;return Nr(function*(){const r=(yield t.cameraList$).find(i=>i.deviceId);r&&t.selectCamera.emit(null==r?void 0:r.deviceId)})()}getCameraList(){return navigator.mediaDevices.enumerateDevices()}onSelectCamera(t){var r;this.selectCamera.emit(null===(r=t.target)||void 0===r?void 0:r.value)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=ye({type:n,selectors:[["app-webcam-list"]],outputs:{selectCamera:"selectCamera"},decls:3,vars:3,consts:[[3,"change"],[4,"ngFor","ngForOf"],[3,"value",4,"ngIf"],[3,"value"]],template:function(t,r){1&t&&(An(0,"select",0),Zr("change",function(o){return r.onSelectCamera(o)}),Dr(1,YH,2,1,"ng-container",1),function(n,e){const t=ln();let r;const i=n+20;t.firstCreatePass?(r=function(n,e){if(e)for(let t=e.length-1;t>=0;t--){const r=e[t];if(n===r.name)return r}throw new Zt("302",`The pipe '${n}' could not be found!`)}(e,t.pipeRegistry),t.data[i]=r,r.onDestroy&&(t.destroyHooks||(t.destroyHooks=[])).push(i,r.onDestroy)):r=t.data[i];const o=r.factory||(r.factory=v(r.type)),s=j(Mt);try{const a=th(!1),c=o();th(a),function(n,e,t,r){t>=n.data.length&&(n.data[t]=null,n.blueprint[t]=null),e[t]=r}(t,_e(),i,c)}finally{j(s)}}(2,"async"),Dn()),2&t&&(Hn(1),In("ngForOf",vE(2,1,r.cameraList$)))},directives:[L_,Cl],pipes:[j_],encapsulation:2}),n})();function XH(n,e){1&n&&(An(0,"span"),ai(1,"Webcam Face Input with validation: "),Dn())}function qH(n,e){if(1&n){const t=wi();An(0,"app-webcam-list",9),Zr("selectCamera",function(i){return vi(t),si().cameraId=i}),Dn()}}function KH(n,e){if(1&n){const t=wi();An(0,"button",10),Zr("click",function(){return vi(t),si().startStream()}),ai(1,"Start"),Dn()}}function QH(n,e){if(1&n){const t=wi();An(0,"button",10),Zr("click",function(){return vi(t),si().stopStream()}),ai(1,"Stop"),Dn()}}function $H(n,e){if(1&n){const t=wi();An(0,"button",11),Zr("click",function(){return vi(t),si().onCapture()}),ai(1,"Capture"),Dn()}2&n&&In("disabled",!si().isCaptureEnabled)}function ZH(n,e){1&n&&(An(0,"span"),ai(1,"Mohon wajah untuk lurus menghadap ke kamera"),Dn())}function JH(n,e){1&n&&(An(0,"span"),ai(1,"Mohon tunggu, sedang meload library"),Dn())}let $y=(()=>{class n extends I0{constructor(t,r,i,o){super(t),this.host=t,this.cdr=r,this.faceService=i,this.poseService=o,this.isCaptureEnabled=!1,this.fps=3,this.isLibraryInitialized=!1,this.captureFaceRotation=new Ei,this.captureFaceDescriptor=new Ei,this.captureFaceImage=new Ei}startStream(){var t=()=>super.startStream,r=this;return Nr(function*(){yield t().call(r),yield r.initPoseInstance()})()}initPoseInstance(){var t=this;return Nr(function*(){t.pose=yield t.poseService.getPoseInstance(t.onPoseResult.bind(t)),t.isLibraryInitialized=!0,t.cdr.detectChanges()})()}onPlay(t){var r=()=>super.onPlay,i=this;return Nr(function*(){var o;r().call(i,t),i.shouldPlay&&(yield t)&&(null==i?void 0:i.stream)&&(null===(o=i.pose)||void 0===o||o.send({image:i.videoRef.nativeElement}))})()}onCapture(){var t=()=>super.onCapture,r=this;return Nr(function*(){var i,o;null===(i=r.videoRef)||void 0===i||i.nativeElement.pause(),t().call(r);const s=r.getImgFromCanvas();if(s){const a=yield r.faceService.getSingleFace(s);if(null==a?void 0:a.detection){const{left:c,top:f,width:p,height:m}=a.detection.box,y=.1,w=1+2*y,E=r.getImgFromCanvas(Math.max(c-p*y,0),Math.max(f-m*y,0),p*w,m*w);r.captureFaceImage.emit(E),r.captureFaceDescriptor.emit(null==a?void 0:a.descriptor)}}null===(o=r.videoRef)||void 0===o||o.nativeElement.play()})()}onPoseResult(t){if(this.isLibraryInitialized=!0,!(null==t?void 0:t.poseLandmarks))return void(this.isCaptureEnabled=!1);const r=E0(t),i=function(n,e=wS){return Math.abs(n.roll)<e.roll&&Math.abs(n.yaw)<e.yaw&&Math.abs(n.pitch)<e.pitch}(r);this.axesRotation=r,this.captureFaceRotation.emit(r),this.isCaptureEnabled!==i&&(this.isCaptureEnabled=i,this.cdr.detectChanges())}}return n.\u0275fac=function(t){return new(t||n)(Mt(Ui),Mt(y1),Mt(JW),Mt(OB))},n.\u0275cmp=ye({type:n,selectors:[["app-webcam-face-input"]],outputs:{captureFaceRotation:"captureFaceRotation",captureFaceDescriptor:"captureFaceDescriptor",captureFaceImage:"captureFaceImage"},features:[Tf],decls:12,vars:12,consts:[["crossorigin","anonymous","playsinline","true","id","videoRef","autoplay","","muted","",3,"srcObject","play"],["videoRef",""],["id","overlayRef"],["overlayRef",""],[1,"buttons"],[4,"ngIf"],[3,"selectCamera",4,"ngIf"],["type","button",3,"click",4,"ngIf"],["type","button",3,"disabled","click",4,"ngIf"],[3,"selectCamera"],["type","button",3,"click"],["type","button",3,"disabled","click"]],template:function(t,r){if(1&t){const i=wi();An(0,"video",0,1),Zr("play",function(){vi(i);const s=Ah(1);return r.onPlay(s)}),Dn(),Th(2,"canvas",2,3),An(4,"div",4),Dr(5,XH,2,0,"span",5),Dr(6,qH,1,0,"app-webcam-list",6),Dr(7,KH,2,0,"button",7),Dr(8,QH,2,0,"button",7),Dr(9,$H,2,1,"button",8),Dr(10,ZH,2,0,"span",5),Dr(11,JH,2,0,"span",5),Dn()}2&t&&(Js("hidden",!r.shouldPlay),In("srcObject",r.stream),Hn(4),Js("absolute",r.shouldPlay),Hn(1),In("ngIf",!r.shouldPlay),Hn(1),In("ngIf",!r.shouldPlay),Hn(1),In("ngIf",!r.shouldPlay),Hn(1),In("ngIf",r.shouldPlay),Hn(1),In("ngIf",r.shouldPlay),Hn(1),In("ngIf",r.shouldPlay&&!r.isCaptureEnabled&&r.isLibraryInitialized),Hn(1),In("ngIf",!r.isLibraryInitialized&&r.shouldPlay))},directives:[Cl,Ud],styles:["[_nghost-%COMP%]{position:relative;text-align:center}.popup[_nghost-%COMP%]{position:absolute;z-index:999;top:10vh;left:50%;transform:translate(-50%);box-shadow:1px 1px 14px #000000bf;max-height:90vh;width:95vw;min-height:10vh;min-width:30vw;background-color:#fff}video[_ngcontent-%COMP%]{transform:rotateY(180deg);min-height:inherit;min-width:inherit;max-height:100%;max-width:100%}canvas[_ngcontent-%COMP%]{display:none}.buttons[_ngcontent-%COMP%]{display:flex;align-items:center}.buttons[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{white-space:nowrap}.buttons.absolute[_ngcontent-%COMP%]{position:absolute;bottom:0;left:50%;transform:translate(-50%)}.hidden[_ngcontent-%COMP%]{display:none}.buttons[_ngcontent-%COMP%]{background-color:#fff}"],changeDetection:0}),n})();function ez(n,e){if(1&n){const t=wi();An(0,"app-webcam-list",5),Zr("selectCamera",function(i){return vi(t),si().cameraId=i}),Dn()}}let AS=(()=>{class n extends $y{constructor(){super(...arguments),this.isYawingToSide=!1,this.minimumYawDuration=5e3,this.isPopUpShown=!1,this._onYawStop$=new ce}ngOnInit(){this.startStream()}onPoseResult(t){if(!(null==t?void 0:t.poseLandmarks))return void(this.isCaptureEnabled=!1);const r=E0(t);this.axesRotation=r;const i=function(n,e=30){return Math.abs(n.yaw)>e}(r);i?(!this._yawTimerInstance$||this._yawTimerInstance$.closed)&&(this.createTimerInstance(),console.log("start counting",new Date)):(this._onYawStop$.next(),this._yawTimerInstance$&&this._yawTimerInstance$.unsubscribe(),this.isPopUpShown=!1),this.isYawingToSide!==i&&(this.isYawingToSide=i,this.cdr.detectChanges())}createTimerInstance(){this._yawTimerInstance$=function(n=0,e=xS){return(!function(n){return!xr(n)&&n-parseFloat(n)+1>=0}(n)||n<0)&&(n=0),(!e||"function"!=typeof e.schedule)&&(e=xS),new Ee(t=>(t.add(e.schedule(OH,n,{subscriber:t,counter:0,period:n})),t))}(this.minimumYawDuration).pipe(function(n){return e=>e.lift(new PH(n))}(this._onYawStop$)).subscribe(()=>{this.followUpYaw()})}followUpYaw(){this.capture.emit(this.getImgFromCanvas()),this.isPopUpShown=!0}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=z0(n)))(r||n)}}(),n.\u0275cmp=ye({type:n,selectors:[["app-peek-to-side-detector"]],inputs:{minimumYawDuration:"minimumYawDuration"},features:[Tf],decls:7,vars:6,consts:[[3,"selectCamera",4,"ngIf"],["crossorigin","anonymous","playsinline","true","id","videoRef","autoplay","","muted","",3,"srcObject","play"],["videoRef",""],[1,"pin"],[1,"popup"],[3,"selectCamera"]],template:function(t,r){if(1&t){const i=wi();Dr(0,ez,1,0,"app-webcam-list",0),An(1,"video",1,2),Zr("play",function(){vi(i);const s=Ah(2);return r.onPlay(s)}),Dn(),An(3,"div",3),ai(4," Photo pengawas\n"),Dn(),An(5,"div",4),ai(6," Ada yang bisa kami bantu\n"),Dn()}2&t&&(In("ngIf",!r.shouldPlay),Hn(1),Js("hidden",!r.shouldPlay),In("srcObject",r.stream),Hn(4),Js("show",r.isPopUpShown))},directives:[Cl,Ud],styles:[".pin[_ngcontent-%COMP%]{position:fixed;right:30px;bottom:30px;display:flex;align-items:center;justify-content:center;background-color:#ececec;border-radius:50%;white-space:normal;width:150px;height:150px}.popup[_ngcontent-%COMP%]{display:none;position:fixed;right:30px;bottom:60px;min-width:100px;background-color:red;color:#fff;font-size:3em;padding:10px}.popup.show[_ngcontent-%COMP%]{display:block}video[_ngcontent-%COMP%]{display:none}app-webcam-list[_ngcontent-%COMP%]{display:none}"]}),n})();var He=(()=>(function(n){n[n.QR_CODE=0]="QR_CODE",n[n.AZTEC=1]="AZTEC",n[n.CODABAR=2]="CODABAR",n[n.CODE_39=3]="CODE_39",n[n.CODE_93=4]="CODE_93",n[n.CODE_128=5]="CODE_128",n[n.DATA_MATRIX=6]="DATA_MATRIX",n[n.MAXICODE=7]="MAXICODE",n[n.ITF=8]="ITF",n[n.EAN_13=9]="EAN_13",n[n.EAN_8=10]="EAN_8",n[n.PDF_417=11]="PDF_417",n[n.RSS_14=12]="RSS_14",n[n.RSS_EXPANDED=13]="RSS_EXPANDED",n[n.UPC_A=14]="UPC_A",n[n.UPC_E=15]="UPC_E",n[n.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"}(He||(He={})),He))(),DS=new Map([[He.QR_CODE,"QR_CODE"],[He.AZTEC,"AZTEC"],[He.CODABAR,"CODABAR"],[He.CODE_39,"CODE_39"],[He.CODE_93,"CODE_93"],[He.CODE_128,"CODE_128"],[He.DATA_MATRIX,"DATA_MATRIX"],[He.MAXICODE,"MAXICODE"],[He.ITF,"ITF"],[He.EAN_13,"EAN_13"],[He.EAN_8,"EAN_8"],[He.PDF_417,"PDF_417"],[He.RSS_14,"RSS_14"],[He.RSS_EXPANDED,"RSS_EXPANDED"],[He.UPC_A,"UPC_A"],[He.UPC_E,"UPC_E"],[He.UPC_EAN_EXTENSION,"UPC_EAN_EXTENSION"]]);function tz(n){return Object.values(He).includes(n)}var Go=(()=>(function(n){n[n.SCAN_TYPE_CAMERA=0]="SCAN_TYPE_CAMERA",n[n.SCAN_TYPE_FILE=1]="SCAN_TYPE_FILE"}(Go||(Go={})),Go))(),Gl=function(){function n(){}return n.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",n.SCAN_DEFAULT_FPS=2,n.DEFAULT_DISABLE_FLIP=!1,n.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,n}(),TS=function(){function n(e,t){this.format=e,this.formatName=t}return n.prototype.toString=function(){return this.formatName},n.create=function(e){if(!DS.has(e))throw e+" not in html5QrcodeSupportedFormatsTextMap";return new n(e,DS.get(e))},n}(),SS=function(){function n(){}return n.createFromText=function(e){return{decodedText:e,result:{text:e}}},n.createFromQrcodeResult=function(e){return{decodedText:e.text,result:e}},n}(),A0=(()=>(function(n){n[n.UNKWOWN_ERROR=0]="UNKWOWN_ERROR",n[n.IMPLEMENTATION_ERROR=1]="IMPLEMENTATION_ERROR",n[n.NO_CODE_FOUND_ERROR=2]="NO_CODE_FOUND_ERROR"}(A0||(A0={})),A0))(),NS=function(){function n(){}return n.createFrom=function(e){return{errorMessage:e,type:A0.UNKWOWN_ERROR}},n}(),RS=function(){function n(e){this.verbose=e}return n.prototype.log=function(e){this.verbose&&console.log(e)},n.prototype.warn=function(e){this.verbose&&console.warn(e)},n.prototype.logError=function(e,t){(this.verbose||!0===t)&&console.error(e)},n.prototype.logErrors=function(e){if(0===e.length)throw"Logger#logError called without arguments";this.verbose&&console.error(e)},n}();function Yl(n){return null==n}var jd=function(){function n(){}return n.codeParseError=function(e){return"QR code parse error, error = "+e},n.errorGettingUserMedia=function(e){return"Error getting userMedia, error = "+e},n.onlyDeviceSupportedError=function(){return"The device doesn't support navigator.mediaDevices , only supported cameraIdOrConfig in this case is deviceId parameter (string)."},n.cameraStreamingNotSupported=function(){return"Camera streaming not supported by the browser."},n.unableToQuerySupportedDevices=function(){return"Unable to query supported devices, unknown error."},n.insecureContextCameraQueryError=function(){return"Camera access is only supported in secure context like https or localhost."},n}(),Ss=function(){function n(){}return n.scanningStatus=function(){return"Scanning"},n.idleStatus=function(){return"Idle"},n.errorStatus=function(){return"Error"},n.permissionStatus=function(){return"Permission"},n.noCameraFoundErrorStatus=function(){return"No Cameras"},n.lastMatch=function(e){return"Last Match: "+e},n.codeScannerTitle=function(){return"Code Scanner"},n.cameraPermissionTitle=function(){return"Request Camera Permissions"},n.cameraPermissionRequesting=function(){return"Requesting camera permissions..."},n.noCameraFound=function(){return"No camera found"},n.scanButtonStopScanningText=function(){return"Stop Scanning"},n.scanButtonStartScanningText=function(){return"Start Scanning"},n.scanButtonScanningStarting=function(){return"Launching Camera..."},n.textIfCameraScanSelected=function(){return"Scan an Image File"},n.textIfFileScanSelected=function(){return"Scan using camera directly"},n.selectCamera=function(){return"Select Camera"},n}(),MS=function(){function n(){}return n.builtUsing=function(){return"Built using "},n.reportIssues=function(){return"Report issues"},n}(),OS=function(){function n(){}return n.isMediaStreamConstraintsValid=function(e,t){if("object"!=typeof e)return t.logError("videoConstraints should be of type object, the object passed is of type "+typeof e+".",!0),!1;for(var o=new Set(["autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","volume"]),a=0,c=Object.keys(e);a<c.length;a++){var f=c[a];if(o.has(f))return t.logError(f+" is not supported videoConstaints.",!0),!1}return!0},n}(),sr=ve(65),nz=function(){function n(e,t,r){if(this.formatMap=new Map([[He.QR_CODE,sr.BarcodeFormat.QR_CODE],[He.AZTEC,sr.BarcodeFormat.AZTEC],[He.CODABAR,sr.BarcodeFormat.CODABAR],[He.CODE_39,sr.BarcodeFormat.CODE_39],[He.CODE_93,sr.BarcodeFormat.CODE_93],[He.CODE_128,sr.BarcodeFormat.CODE_128],[He.DATA_MATRIX,sr.BarcodeFormat.DATA_MATRIX],[He.MAXICODE,sr.BarcodeFormat.MAXICODE],[He.ITF,sr.BarcodeFormat.ITF],[He.EAN_13,sr.BarcodeFormat.EAN_13],[He.EAN_8,sr.BarcodeFormat.EAN_8],[He.PDF_417,sr.BarcodeFormat.PDF_417],[He.RSS_14,sr.BarcodeFormat.RSS_14],[He.RSS_EXPANDED,sr.BarcodeFormat.RSS_EXPANDED],[He.UPC_A,sr.BarcodeFormat.UPC_A],[He.UPC_E,sr.BarcodeFormat.UPC_E],[He.UPC_EAN_EXTENSION,sr.BarcodeFormat.UPC_EAN_EXTENSION]]),this.reverseFormatMap=this.createReverseFormatMap(),!sr)throw"Use html5qrcode.min.js without edit, ZXing not found.";this.verbose=t,this.logger=r;var i=this.createZXingFormats(e),o=new Map;o.set(sr.DecodeHintType.POSSIBLE_FORMATS,i),this.hints=o}return n.prototype.decodeAsync=function(e){var t=this;return new Promise(function(r,i){try{r(t.decode(e))}catch(o){i(o)}})},n.prototype.decode=function(e){var t=new sr.MultiFormatReader(this.verbose,this.hints),r=new sr.HTMLCanvasElementLuminanceSource(e),i=new sr.BinaryBitmap(new sr.HybridBinarizer(r)),o=t.decode(i);return{text:o.text,format:TS.create(this.toHtml5QrcodeSupportedFormats(o.format))}},n.prototype.createReverseFormatMap=function(){var e=new Map;return this.formatMap.forEach(function(t,r,i){e.set(t,r)}),e},n.prototype.toHtml5QrcodeSupportedFormats=function(e){if(!this.reverseFormatMap.has(e))throw"reverseFormatMap doesn't have "+e;return this.reverseFormatMap.get(e)},n.prototype.createZXingFormats=function(e){for(var t=[],r=0,i=e;r<i.length;r++){var o=i[r];this.formatMap.has(o)?t.push(this.formatMap.get(o)):this.logger.logError(o+" is not supported byZXingHtml5QrcodeShim")}return t},n}(),FS=function(){function n(e,t,r){if(this.formatMap=new Map([[He.QR_CODE,"qr_code"],[He.AZTEC,"aztec"],[He.CODABAR,"codabar"],[He.CODE_39,"code_39"],[He.CODE_93,"code_93"],[He.CODE_128,"code_128"],[He.DATA_MATRIX,"data_matrix"],[He.ITF,"itf"],[He.EAN_13,"ean_13"],[He.EAN_8,"ean_8"],[He.PDF_417,"pdf417"],[He.UPC_A,"upc_a"],[He.UPC_E,"upc_e"]]),this.reverseFormatMap=this.createReverseFormatMap(),!n.isSupported())throw"Use html5qrcode.min.js without edit, Use BarcodeDetectorDelegate only if it isSupported();";this.verbose=t,this.logger=r;var i=this.createBarcodeDetectorFormats(e);if(this.detector=new BarcodeDetector(i),!this.detector)throw"BarcodeDetector detector not supported"}return n.isSupported=function(){return"BarcodeDetector"in window&&void 0!==new BarcodeDetector({formats:["qr_code"]})},n.prototype.decodeAsync=function(e){return function(n,e,t,r){return new(t||(t=Promise))(function(o,s){function a(p){try{f(r.next(p))}catch(m){s(m)}}function c(p){try{f(r.throw(p))}catch(m){s(m)}}function f(p){p.done?o(p.value):function(o){return o instanceof t?o:new t(function(s){s(o)})}(p.value).then(a,c)}f((r=r.apply(n,e||[])).next())})}(this,void 0,void 0,function(){var t,r;return function(n,e){var r,i,o,s,t={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(f){return function(p){return function(f){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=2&f[0]?i.return:f[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,f[1])).done)return o;switch(i=0,o&&(f=[2&f[0],o.value]),f[0]){case 0:case 1:o=f;break;case 4:return t.label++,{value:f[1],done:!1};case 5:t.label++,i=f[1],f=[0];continue;case 7:f=t.ops.pop(),t.trys.pop();continue;default:if(!(o=(o=t.trys).length>0&&o[o.length-1])&&(6===f[0]||2===f[0])){t=0;continue}if(3===f[0]&&(!o||f[1]>o[0]&&f[1]<o[3])){t.label=f[1];break}if(6===f[0]&&t.label<o[1]){t.label=o[1],o=f;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(f);break}o[2]&&t.ops.pop(),t.trys.pop();continue}f=e.call(n,t)}catch(p){f=[6,p],i=0}finally{r=o=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}([f,p])}}}(this,function(i){switch(i.label){case 0:return[4,this.detector.detect(e)];case 1:if(!(t=i.sent())||0===t.length)throw"No barcode or QR code detected.";return[2,{text:(r=this.selectLargestBarcode(t)).rawValue,format:TS.create(this.toHtml5QrcodeSupportedFormats(r.format))}]}})})},n.prototype.selectLargestBarcode=function(e){for(var t=null,r=0,i=0,o=e;i<o.length;i++){var s=o[i],a=s.boundingBox.width*s.boundingBox.height;a>r&&(r=a,t=s)}if(!t)throw"No largest barcode found";return t},n.prototype.createBarcodeDetectorFormats=function(e){for(var t=[],r=0,i=e;r<i.length;r++){var o=i[r];this.formatMap.has(o)?t.push(this.formatMap.get(o)):this.logger.warn(o+" is not supported byBarcodeDetectorDelegate")}return{formats:t}},n.prototype.toHtml5QrcodeSupportedFormats=function(e){if(!this.reverseFormatMap.has(e))throw"reverseFormatMap doesn't have "+e;return this.reverseFormatMap.get(e)},n.prototype.createReverseFormatMap=function(){var e=new Map;return this.formatMap.forEach(function(t,r,i){e.set(t,r)}),e},n}(),oz=function(){function n(e,t,r,i){this.EXECUTIONS_TO_REPORT_PERFORMANCE=100,this.executions=0,this.executionResults=[],this.verbose=t,this.decoder=!0===i.useBarCodeDetectorIfSupported&&FS.isSupported()?new FS(e,t,r):new nz(e,t,r)}return n.prototype.decodeAsync=function(e){var t=this,r=performance.now();return this.decoder.decodeAsync(e).finally(function(){if(t.verbose){var i=performance.now()-r;t.executionResults.push(i),t.executions++,t.possiblyFlushPerformanceReport()}})},n.prototype.possiblyFlushPerformanceReport=function(){if(!(this.executions<this.EXECUTIONS_TO_REPORT_PERFORMANCE)){for(var e=0,t=0,r=this.executionResults;t<r.length;t++)e+=r[t];console.log(e/this.executionResults.length+" ms for "+this.executionResults.length+" last runs."),this.executions=0,this.executionResults=[]}},n}(),sz=function(){function n(){}return n.createExperimentalFeaturesConfig=function(e){return e?(!0!==e.useBarCodeDetectorIfSupported&&(e.useBarCodeDetectorIfSupported=!1),e):{useBarCodeDetectorIfSupported:!1}},n}(),ar=(()=>(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.NOT_STARTED=1]="NOT_STARTED",n[n.SCANNING=2]="SCANNING",n[n.PAUSED=3]="PAUSED"}(ar||(ar={})),ar))(),az=function(){function n(){this.state=ar.NOT_STARTED,this.onGoingTransactionNewState=ar.UNKNOWN}return n.prototype.directTransition=function(e){this.failIfTransitionOngoing(),this.validateTransition(e),this.state=e},n.prototype.startTransition=function(e){return this.failIfTransitionOngoing(),this.validateTransition(e),this.onGoingTransactionNewState=e,this},n.prototype.execute=function(){if(this.onGoingTransactionNewState===ar.UNKNOWN)throw"Transaction is already cancelled, cannot execute().";var e=this.onGoingTransactionNewState;this.onGoingTransactionNewState=ar.UNKNOWN,this.directTransition(e)},n.prototype.cancel=function(){if(this.onGoingTransactionNewState===ar.UNKNOWN)throw"Transaction is already cancelled, cannot cancel().";this.onGoingTransactionNewState=ar.UNKNOWN},n.prototype.getState=function(){return this.state},n.prototype.failIfTransitionOngoing=function(){if(this.onGoingTransactionNewState!==ar.UNKNOWN)throw"Cannnot transition to a new state, already under transition"},n.prototype.validateTransition=function(e){switch(this.state){case ar.UNKNOWN:throw"Transition from unknown is not allowed";case ar.NOT_STARTED:this.failIfNewStateIs(e,[ar.PAUSED])}},n.prototype.failIfNewStateIs=function(e,t){for(var r=0,i=t;r<i.length;r++)if(e===i[r])throw"Cannot transition from "+this.state+" to "+e},n}(),uz=function(){function n(e){this.stateManager=e}return n.prototype.startTransition=function(e){return this.stateManager.startTransition(e)},n.prototype.directTransition=function(e){this.stateManager.directTransition(e)},n.prototype.getState=function(){return this.stateManager.getState()},n.prototype.canScanFile=function(){return this.stateManager.getState()===ar.NOT_STARTED},n.prototype.isScanning=function(){return this.stateManager.getState()!==ar.NOT_STARTED},n.prototype.isStrictlyScanning=function(){return this.stateManager.getState()===ar.SCANNING},n.prototype.isPaused=function(){return this.stateManager.getState()===ar.PAUSED},n}(),cz=function(){function n(){}return n.create=function(){return new uz(new az)},n}(),lz=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])})(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Yo=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return lz(e,n),e.DEFAULT_WIDTH=300,e.DEFAULT_WIDTH_OFFSET=2,e.FILE_SCAN_MIN_HEIGHT=300,e.MIN_QR_BOX_SIZE=50,e.SHADED_LEFT=1,e.SHADED_RIGHT=2,e.SHADED_TOP=3,e.SHADED_BOTTOM=4,e.SHADED_REGION_ELEMENT_ID="qr-shaded-region",e.VERBOSE=!1,e.BORDER_SHADER_DEFAULT_COLOR="#ffffff",e.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",e}(Gl),fz=function(){function n(e,t){this.logger=t,this.fps=Yo.SCAN_DEFAULT_FPS,e?(e.fps&&(this.fps=e.fps),this.disableFlip=!0===e.disableFlip,this.qrbox=e.qrbox,this.aspectRatio=e.aspectRatio,this.videoConstraints=e.videoConstraints):this.disableFlip=Yo.DEFAULT_DISABLE_FLIP}return n.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?OS.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},n.prototype.isShadedBoxEnabled=function(){return!Yl(this.qrbox)},n.create=function(e,t){return new n(e,t)},n}(),Zy=function(){function n(e,t){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.videoElement=null,this.localMediaStream=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(e))throw"HTML Element with id="+e+" not found";var r;this.elementId=e,this.verbose=!1,"boolean"==typeof t?this.verbose=!0===t:t&&(this.verbose=!0===t.verbose,r=t.experimentalFeatures),this.logger=new RS(this.verbose),this.qrcode=new oz(this.getSupportedFormats(t),this.verbose,this.logger,sz.createExperimentalFeaturesConfig(r)),this.shouldScan=!0,this.stateManagerProxy=cz.create()}return n.prototype.start=function(e,t,r,i){if(!e)throw"cameraIdOrConfig is required";if(!r||"function"!=typeof r)throw"qrCodeSuccessCallback is required and should be a function.";i||(i=this.verbose?this.logger.log:function(){});var o=fz.create(t,this.logger);this.clearElement();var s=!1;o.videoConstraints&&(o.isMediaStreamConstraintsValid()?s=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var a=s,c=o.isShadedBoxEnabled(),f=document.getElementById(this.elementId),p=f.clientWidth?f.clientWidth:Yo.DEFAULT_WIDTH;f.style.position="relative",this.shouldScan=!0,this.element=f,c&&this.validateQrboxSize(o,p);var m=this,y=this.stateManagerProxy.startTransition(ar.SCANNING);return new Promise(function(w,E){var A=a?o.videoConstraints:m.createVideoConstraints(e);if(!A)return y.cancel(),void E("videoConstraints should be defined");navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!1,video:A}).then(function(_){m.onMediaStreamReceived(_,o,a,p,r,i).then(function(T){y.execute(),m.isScanning=!0,w(null)}).catch(function(T){y.cancel(),E(T)})}).catch(function(_){y.cancel(),E(jd.errorGettingUserMedia(_))}):(y.cancel(),E(jd.cameraStreamingNotSupported()))})},n.prototype.pause=function(e){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(ar.PAUSED),this.showPausedState(),(Yl(e)||!0!==e)&&(e=!1),e&&this.videoElement&&this.videoElement.pause()},n.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.videoElement)throw"VideoElement doesn't exist while trying resume()";var e=this,t=function(){e.stateManagerProxy.directTransition(ar.SCANNING),e.hidePausedState()};if(this.videoElement.paused){var i=function(){var o;setTimeout(t,200),null===(o=e.videoElement)||void 0===o||o.removeEventListener("playing",i)};this.videoElement.addEventListener("playing",i),this.videoElement.play()}else t()},n.prototype.getState=function(){return this.stateManagerProxy.getState()},n.prototype.stop=function(){var e=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var t=this.stateManagerProxy.startTransition(ar.NOT_STARTED);return this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout),new Promise(function(i,o){var s=function(){e.localMediaStream=null,e.element&&(e.element.removeChild(e.videoElement),e.element.removeChild(e.canvasElement)),function(){if(e.element){var i=document.getElementById(Yo.SHADED_REGION_ELEMENT_ID);i&&e.element.removeChild(i)}}(),e.qrRegion&&(e.qrRegion=null),e.context&&(e.context=null),t.execute(),e.hidePausedState(),e.isScanning=!1,i()};e.localMediaStream||s();var a=e.localMediaStream.getVideoTracks().length,c=0;e.localMediaStream.getVideoTracks().forEach(function(f){e.localMediaStream.removeTrack(f),f.stop(),++c>=a&&s()})})},n.prototype.scanFile=function(e,t){return this.scanFileV2(e,t).then(function(r){return r.decodedText})},n.prototype.scanFileV2=function(e,t){var r=this;if(!(e&&e instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(Yl(t)&&(t=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise(function(i,o){r.possiblyCloseLastScanImageFile(),r.clearElement(),r.lastScanImageFile=URL.createObjectURL(e);var s=new Image;s.onload=function(){var a=s.width,c=s.height,f=document.getElementById(r.elementId),p=f.clientWidth?f.clientWidth:Yo.DEFAULT_WIDTH,m=Math.max(f.clientHeight?f.clientHeight:c,Yo.FILE_SCAN_MIN_HEIGHT),y=r.computeCanvasDrawConfig(a,c,p,m);if(t){var w=r.createCanvasElement(p,m,"qr-canvas-visible");w.style.display="inline-block",f.appendChild(w);var E=w.getContext("2d");if(!E)throw"Unable to get 2d context from canvas";E.canvas.width=p,E.canvas.height=m,E.drawImage(s,0,0,a,c,y.x,y.y,y.width,y.height)}var A=r.createCanvasElement(y.width,y.height);f.appendChild(A);var _=A.getContext("2d");if(!_)throw"Unable to get 2d context from canvas";_.canvas.width=y.width,_.canvas.height=y.height,_.drawImage(s,0,0,a,c,0,0,y.width,y.height);try{r.qrcode.decodeAsync(A).then(function(T){i(SS.createFromQrcodeResult(T))}).catch(o)}catch(T){o("QR code parse error, error = "+T)}},s.onerror=o,s.onabort=o,s.onstalled=o,s.onsuspend=o,s.src=URL.createObjectURL(e)})},n.prototype.clear=function(){this.clearElement()},n.getCameras=function(){if(navigator.mediaDevices)return n.getCamerasFromMediaDevices();var e=MediaStreamTrack;if(MediaStreamTrack&&e.getSources)return n.getCamerasFromMediaStreamTrack();var r=jd.unableToQuerySupportedDevices();return function(){if("https:"===location.protocol)return!0;var i=location.host.split(":")[0];return"127.0.0.1"===i||"localhost"===i}()||(r=jd.insecureContextCameraQueryError()),Promise.reject(r)},n.prototype.getRunningTrackCapabilities=function(){if(null==this.localMediaStream)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";if(0===this.localMediaStream.getVideoTracks().length)throw"No video tracks found";return this.localMediaStream.getVideoTracks()[0].getCapabilities()},n.prototype.applyVideoConstraints=function(e){var t=this;if(!e)throw"videoConstaints is required argument.";if(!OS.isMediaStreamConstraintsValid(e,this.logger))throw"invalid videoConstaints passed, check logs for more details";if(null===this.localMediaStream)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";if(0===this.localMediaStream.getVideoTracks().length)throw"No video tracks found";return new Promise(function(r,i){"aspectRatio"in e?i("Chaning 'aspectRatio' in run-time is not yet supported."):t.localMediaStream.getVideoTracks()[0].applyConstraints(e).then(function(s){r(s)}).catch(function(s){i(s)})})},n.getCamerasFromMediaDevices=function(){return new Promise(function(e,t){navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then(function(r){navigator.mediaDevices.enumerateDevices().then(function(o){for(var s=[],a=0,c=o;a<c.length;a++){var f=c[a];"videoinput"===f.kind&&s.push({id:f.deviceId,label:f.label})}(function(o){for(var a=0,c=o.getVideoTracks();a<c.length;a++){var f=c[a];f.enabled=!1,f.stop(),o.removeTrack(f)}})(r),e(s)}).catch(function(o){t(o.name+" : "+o.message)})}).catch(function(r){t(r.name+" : "+r.message)})})},n.getCamerasFromMediaStreamTrack=function(){return new Promise(function(e,t){MediaStreamTrack.getSources(function(o){for(var s=[],a=0,c=o;a<c.length;a++){var f=c[a];"video"===f.kind&&s.push({id:f.id,label:f.label})}e(s)})})},n.prototype.getSupportedFormats=function(e){if(!e||"boolean"==typeof e||!e.formatsToSupport)return[He.QR_CODE,He.AZTEC,He.CODABAR,He.CODE_39,He.CODE_93,He.CODE_128,He.DATA_MATRIX,He.MAXICODE,He.ITF,He.EAN_13,He.EAN_8,He.PDF_417,He.RSS_14,He.RSS_EXPANDED,He.UPC_A,He.UPC_E,He.UPC_EAN_EXTENSION];if(!Array.isArray(e.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(0===e.formatsToSupport.length)throw"Atleast 1 formatsToSupport is needed.";for(var r=[],i=0,o=e.formatsToSupport;i<o.length;i++){var s=o[i];tz(s)?r.push(s):this.logger.warn("Invalid format: "+s+" passed in config, ignoring.")}if(0===r.length)throw"None of formatsToSupport match supported values.";return r},n.prototype.validateQrboxSize=function(e,t){var i=e.qrbox;this.validateQrboxConfig(i);var c,o=this.toQrdimensions(i),s=function(c){if(c<Yo.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is "+Yo.MIN_QR_BOX_SIZE+"px."};s(o.width),s(o.height),o.width=((c=o.width)>t&&(this.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),c=t),c)},n.prototype.validateQrboxConfig=function(e){if("number"!=typeof e&&(void 0===e.width||void 0===e.height))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},n.prototype.toQrdimensions=function(e){return"number"==typeof e?{width:e,height:e}:e},n.prototype.setupUi=function(e,t,r){var i=Yl(r.qrbox)?{width:e,height:t}:r.qrbox;this.validateQrboxConfig(i);var o=this.toQrdimensions(i);o.height>t&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var s=r.isShadedBoxEnabled()&&o.height<=t,a={x:0,y:0,width:e,height:t},c=s?this.getShadedRegionBounds(e,t,o):a,f=this.createCanvasElement(c.width,c.height),p=f.getContext("2d");p.canvas.width=c.width,p.canvas.height=c.height,this.element.append(f),s&&this.possiblyInsertShadingElement(this.element,e,t,o),this.createScannerPausedUiElement(this.element),this.qrRegion=c,this.context=p,this.canvasElement=f},n.prototype.createScannerPausedUiElement=function(e){var t=document.createElement("div");t.innerText="Scanner paused",t.style.display="none",t.style.position="absolute",t.style.top="0px",t.style.zIndex="1",t.style.background="yellow",t.style.textAlign="center",t.style.width="100%",e.appendChild(t),this.scannerPausedUiElement=t},n.prototype.scanContext=function(e,t){var r=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then(function(i){return e(i.text,SS.createFromQrcodeResult(i)),r.possiblyUpdateShaders(!0),!0}).catch(function(i){r.possiblyUpdateShaders(!1);var o=jd.codeParseError(i);return t(o,NS.createFrom(o)),!1})},n.prototype.foreverScan=function(e,t,r){var i=this;if(this.shouldScan&&this.localMediaStream){var o=this.videoElement,s=o.videoWidth/o.clientWidth,a=o.videoHeight/o.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";this.context.drawImage(o,this.qrRegion.x*s,this.qrRegion.y*a,this.qrRegion.width*s,this.qrRegion.height*a,0,0,this.qrRegion.width,this.qrRegion.height);var y=function(){i.foreverScanTimeout=setTimeout(function(){i.foreverScan(e,t,r)},i.getTimeoutFps(e.fps))};this.scanContext(t,r).then(function(w){w||!0===e.disableFlip?y():(i.context.translate(i.context.canvas.width,0),i.context.scale(-1,1),i.scanContext(t,r).finally(function(){y()}))}).catch(function(w){i.logger.logError("Error happend while scanning context",w),y()})}},n.prototype.onMediaStreamReceived=function(e,t,r,i,o,s){var a=this,c=this;return new Promise(function(f,p){var m=function(){var E=a.createVideoElement(i);c.element.append(E),E.onabort=p,E.onerror=p;var A=function(){c.setupUi(E.clientWidth,E.clientHeight,t),c.foreverScan(t,o,s),E.removeEventListener("playing",A),f(null)};E.addEventListener("playing",A),E.srcObject=e,E.play(),c.videoElement=E};if(c.localMediaStream=e,r||!t.aspectRatio)m();else{var y={aspectRatio:t.aspectRatio};e.getVideoTracks()[0].applyConstraints(y).then(function(E){return m()}).catch(function(E){c.logger.logErrors(["[Html5Qrcode] Constriants could not be satisfied, ignoring constraints",E]),m()})}})},n.prototype.createVideoConstraints=function(e){if("string"==typeof e)return{deviceId:{exact:e}};if("object"==typeof e){var t="facingMode",r="deviceId",i={user:!0,environment:!0},o="exact",s=function(E){if(E in i)return!0;throw"config has invalid 'facingMode' value = '"+E+"'"},a=Object.keys(e);if(1!==a.length)throw"'cameraIdOrConfig' object should have exactly 1 key, if passed as an object, found "+a.length+" keys";var c=Object.keys(e)[0];if(c!==t&&c!==r)throw"Only '"+t+"' and '"+r+"'  are supported for 'cameraIdOrConfig'";if(c!==t){var m=e.deviceId;if("string"==typeof m)return{deviceId:m};if("object"==typeof m){if(o in m)return{deviceId:{exact:m.exact}};throw"'deviceId' should be string or object with exact as key."}throw"Invalid type of 'deviceId' = "+typeof m}var f=e.facingMode;if("string"==typeof f){if(s(f))return{facingMode:f}}else{if("object"!=typeof f)throw"Invalid type of 'facingMode' = "+typeof f;if(!(o in f))throw"'facingMode' should be string or object with exact as key.";if(s(f.exact))return{facingMode:{exact:f.exact}}}}throw"Invalid type of 'cameraIdOrConfig' = "+typeof e},n.prototype.computeCanvasDrawConfig=function(e,t,r,i){if(e<=r&&t<=i)return{x:(r-e)/2,y:(i-t)/2,width:e,height:t};var a=e,c=t;return e>r&&(t*=r/e,e=r),t>i&&(e*=i/t,t=i),this.logger.log("Image downsampled from "+a+"X"+c+" to "+e+"X"+t+"."),this.computeCanvasDrawConfig(e,t,r,i)},n.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var e=document.getElementById(this.elementId);e&&(e.innerHTML="")},n.prototype.createVideoElement=function(e){var t=document.createElement("video");return t.style.width=e+"px",t.muted=!0,t.setAttribute("muted","true"),t.playsInline=!0,t},n.prototype.possiblyUpdateShaders=function(e){this.qrMatch!==e&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach(function(t){t.style.backgroundColor=e?Yo.BORDER_SHADER_MATCH_COLOR:Yo.BORDER_SHADER_DEFAULT_COLOR}),this.qrMatch=e)},n.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},n.prototype.createCanvasElement=function(e,t,r){var i=e,o=t,s=document.createElement("canvas");return s.style.width=i+"px",s.style.height=o+"px",s.style.display="none",s.id=Yl(r)?"qr-canvas":r,s},n.prototype.getShadedRegionBounds=function(e,t,r){if(r.width>e||r.height>t)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(e-r.width)/2,y:(t-r.height)/2,width:r.width,height:r.height}},n.prototype.possiblyInsertShadingElement=function(e,t,r,i){if(!(t-i.width<1||r-i.height<1)){var o=document.createElement("div");o.style.position="absolute";var s=(t-i.width)/2,a=(r-i.height)/2;if(o.style.borderLeft=s+"px solid #0000007a",o.style.borderRight=s+"px solid #0000007a",o.style.borderTop=a+"px solid #0000007a",o.style.borderBottom=a+"px solid #0000007a",o.style.boxSizing="border-box",o.style.top="0px",o.style.bottom="0px",o.style.left="0px",o.style.right="0px",o.id=""+Yo.SHADED_REGION_ELEMENT_ID,t-i.width<11||r-i.height<11)this.hasBorderShaders=!1;else{var f=40;this.insertShaderBorders(o,f,5,-5,0,!0),this.insertShaderBorders(o,f,5,-5,0,!1),this.insertShaderBorders(o,f,5,i.height+5,0,!0),this.insertShaderBorders(o,f,5,i.height+5,0,!1),this.insertShaderBorders(o,5,45,-5,-5,!0),this.insertShaderBorders(o,5,45,i.height+5-f,-5,!0),this.insertShaderBorders(o,5,45,-5,-5,!1),this.insertShaderBorders(o,5,45,i.height+5-f,-5,!1),this.hasBorderShaders=!0}e.append(o)}},n.prototype.insertShaderBorders=function(e,t,r,i,o,s){var a=document.createElement("div");a.style.position="absolute",a.style.backgroundColor=Yo.BORDER_SHADER_DEFAULT_COLOR,a.style.width=t+"px",a.style.height=r+"px",a.style.top=i+"px",s?a.style.left=o+"px":a.style.right=o+"px",this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(a),e.appendChild(a)},n.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},n.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},n.prototype.getTimeoutFps=function(e){return 1e3/e},n}(),PS="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NjAgNDYwIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NjAgNDYwIiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJNMjMwIDBDMTAyLjk3NSAwIDAgMTAyLjk3NSAwIDIzMHMxMDIuOTc1IDIzMCAyMzAgMjMwIDIzMC0xMDIuOTc0IDIzMC0yMzBTMzU3LjAyNSAwIDIzMCAwem0zOC4zMzMgMzc3LjM2YzAgOC42NzYtNy4wMzQgMTUuNzEtMTUuNzEgMTUuNzFoLTQzLjEwMWMtOC42NzYgMC0xNS43MS03LjAzNC0xNS43MS0xNS43MVYyMDIuNDc3YzAtOC42NzYgNy4wMzMtMTUuNzEgMTUuNzEtMTUuNzFoNDMuMTAxYzguNjc2IDAgMTUuNzEgNy4wMzMgMTUuNzEgMTUuNzFWMzc3LjM2ek0yMzAgMTU3Yy0yMS41MzkgMC0zOS0xNy40NjEtMzktMzlzMTcuNDYxLTM5IDM5LTM5IDM5IDE3LjQ2MSAzOSAzOS0xNy40NjEgMzktMzkgMzl6Ii8+PC9zdmc+",kS=function(){function n(){}return n.createDefault=function(){return{hasPermission:!1,lastUsedCameraId:null}},n}(),gz=function(){function n(){this.data=kS.createDefault();var e=localStorage.getItem(n.LOCAL_STORAGE_KEY);e?this.data=JSON.parse(e):this.reset()}return n.prototype.hasCameraPermissions=function(){return this.data.hasPermission},n.prototype.getLastUsedCameraId=function(){return this.data.lastUsedCameraId},n.prototype.setHasPermission=function(e){this.data.hasPermission=e,this.flush()},n.prototype.setLastUsedCameraId=function(e){this.data.lastUsedCameraId=e,this.flush()},n.prototype.resetLastUsedCameraId=function(){this.data.lastUsedCameraId=null,this.flush()},n.prototype.reset=function(){this.data=kS.createDefault(),this.flush()},n.prototype.flush=function(){localStorage.setItem(n.LOCAL_STORAGE_KEY,JSON.stringify(this.data))},n.LOCAL_STORAGE_KEY="HTML5_QRCODE_DATA",n}(),mz=function(){function n(){this.infoDiv=document.createElement("div")}return n.prototype.renderInto=function(e){this.infoDiv.style.position="absolute",this.infoDiv.style.top="10px",this.infoDiv.style.right="10px",this.infoDiv.style.zIndex="2",this.infoDiv.style.display="none",this.infoDiv.style.padding="5pt",this.infoDiv.style.border="1px solid silver",this.infoDiv.style.fontSize="10pt",this.infoDiv.style.background="rgb(248 248 248)",this.infoDiv.innerText=MS.builtUsing();var t=document.createElement("a");t.innerText="html5-qrcode",t.href="https://github.com/mebjas/html5-qrcode",t.target="new",this.infoDiv.appendChild(t);var r=document.createElement("br"),i=document.createElement("br");this.infoDiv.appendChild(r),this.infoDiv.appendChild(i);var o=document.createElement("a");o.innerText=MS.reportIssues(),o.href="https://github.com/mebjas/html5-qrcode/issues",o.target="new",this.infoDiv.appendChild(o),e.appendChild(this.infoDiv)},n.prototype.show=function(){this.infoDiv.style.display="block"},n.prototype.hide=function(){this.infoDiv.style.display="none"},n}(),vz=function(){function n(e,t){this.isShowingInfoIcon=!0,this.onTapIn=e,this.onTapOut=t,this.infoIcon=document.createElement("img")}return n.prototype.renderInto=function(e){var t=this;this.infoIcon.alt="Info icon",this.infoIcon.src=PS,this.infoIcon.style.position="absolute",this.infoIcon.style.top="4px",this.infoIcon.style.right="4px",this.infoIcon.style.opacity="0.6",this.infoIcon.style.cursor="pointer",this.infoIcon.style.zIndex="2",this.infoIcon.style.width="16px",this.infoIcon.style.height="16px",this.infoIcon.onmouseover=function(r){return t.onHoverIn()},this.infoIcon.onmouseout=function(r){return t.onHoverOut()},this.infoIcon.onclick=function(r){return t.onClick()},e.appendChild(this.infoIcon)},n.prototype.onHoverIn=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="1")},n.prototype.onHoverOut=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="0.6")},n.prototype.onClick=function(){this.isShowingInfoIcon?(this.isShowingInfoIcon=!1,this.onTapIn(),this.infoIcon.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAQgAAAEIBarqQRAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAE1SURBVDiNfdI7S0NBEAXgLya1otFgpbYSbISAgpXYi6CmiH9KCAiChaVga6OiWPgfRDQ+0itaGVNosXtluWwcuMzePfM4M3sq8lbHBubwg1dc4m1E/J/N4ghDPOIsfk/4xiEao5KX0McFljN4C9d4QTPXuY99jP3DsIoDPGM6BY5i5yI5R7O4q+ImFkJY2DCh3cAH2klyB+9J1xUMMAG7eCh1a+Mr+k48b5diXrFVwwLuS+BJ9MfR7+G0FHOHhTHhnXNWS87VDF4pcnfQK4Ep7XScNLmPTZgURNKKYENYWDpzW1BhscS1WHS8CDgURFJQrWcoF3c13KKbgg1BYQfy8xZWEzTTw1QZbAoKu8FqJnktdu5hcVSHmchiILzzuaDQvjBzV2m8yohCE1jHfPx/xhU+y4G/D75ELlRJsSYAAAAASUVORK5CYII=",this.infoIcon.style.opacity="1"):(this.isShowingInfoIcon=!0,this.onTapOut(),this.infoIcon.src=PS,this.infoIcon.style.opacity="0.6")},n}(),yz=function(){function n(){var e=this;this.infoDiv=new mz,this.infoIcon=new vz(function(){e.infoDiv.show()},function(){e.infoDiv.hide()})}return n.prototype.renderInto=function(e){this.infoDiv.renderInto(e),this.infoIcon.renderInto(e)},n}(),xz=function(){function n(){}return n.hasCameraPermissions=function(){return new Promise(function(e,t){navigator.mediaDevices.enumerateDevices().then(function(r){r.forEach(function(i){"videoinput"===i.kind&&i.label&&e(!0)}),e(!1)})})},n}(),Do=(()=>(function(n){n[n.STATUS_DEFAULT=0]="STATUS_DEFAULT",n[n.STATUS_SUCCESS=1]="STATUS_SUCCESS",n[n.STATUS_WARNING=2]="STATUS_WARNING",n[n.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION"}(Do||(Do={})),Do))();function Cz(n,e){1&n&&(An(0,"span"),ai(1,"Qr Input: "),Dn())}function Ez(n,e){if(1&n){const t=wi();An(0,"app-webcam-list",7),Zr("selectCamera",function(i){return vi(t),si().cameraId=i}),Dn()}}function _z(n,e){if(1&n){const t=wi();An(0,"button",8),Zr("click",function(){return vi(t),si().startStream()}),ai(1,"Start"),Dn()}2&n&&In("disabled",!si().cameraId)}function Iz(n,e){if(1&n){const t=wi();An(0,"button",9),Zr("click",function(){return vi(t),si().stopStream()}),ai(1,"Stop"),Dn()}}!function(){function n(e,t,r){if(this.lastMatchFound=null,this.cameraScanImage=null,this.fileScanImage=null,this.elementId=e,this.config=this.createConfig(t),this.verbose=!0===r,!document.getElementById(e))throw"HTML Element with id="+e+" not found";this.currentScanType=Go.SCAN_TYPE_CAMERA,this.sectionSwapAllowed=!0,this.logger=new RS(this.verbose),this.persistedDataManager=new gz,!0!==t.rememberLastUsedCamera&&this.persistedDataManager.reset()}n.prototype.render=function(e,t){var r=this;this.lastMatchFound=null,this.qrCodeSuccessCallback=function(o,s){if(e)e(o,s);else{if(r.lastMatchFound===o)return;r.lastMatchFound=o,r.setHeaderMessage(Ss.lastMatch(o),Do.STATUS_SUCCESS)}},this.qrCodeErrorCallback=function(o,s){t&&t(o,s)};var i=document.getElementById(this.elementId);if(!i)throw"HTML Element with id="+this.elementId+" not found";i.innerHTML="",this.createBasicLayout(i),this.html5Qrcode=new Zy(this.getScanRegionId(),function(n,e){return{formatsToSupport:n.formatsToSupport,experimentalFeatures:n.experimentalFeatures,verbose:e}}(this.config,this.verbose))},n.prototype.pause=function(e){if(!this.html5Qrcode)throw"Code scanner not initialized.";(Yl(e)||!0!==e)&&(e=!1),this.html5Qrcode.pause(e)},n.prototype.resume=function(){if(!this.html5Qrcode)throw"Code scanner not initialized.";this.html5Qrcode.resume()},n.prototype.getState=function(){if(!this.html5Qrcode)throw"Code scanner not initialized.";return this.html5Qrcode.getState()},n.prototype.clear=function(){var e=this,t=function(){var r=document.getElementById(e.elementId);r&&(r.innerHTML="",e.resetBasicLayout(r))};return this.html5Qrcode?new Promise(function(r,i){e.html5Qrcode?e.html5Qrcode.isScanning?e.html5Qrcode.stop().then(function(o){e.html5Qrcode?(e.html5Qrcode.clear(),t(),r()):r()}).catch(function(o){e.verbose&&e.logger.logError("Unable to stop qrcode scanner",o),i(o)}):(e.html5Qrcode.clear(),t()):r()}):Promise.resolve()},n.prototype.getRunningTrackCapabilities=function(){if(!this.html5Qrcode)throw"Code scanner not initialized.";return this.html5Qrcode.getRunningTrackCapabilities()},n.prototype.applyVideoConstraints=function(e){if(!this.html5Qrcode)throw"Code scanner not initialized.";return this.html5Qrcode.applyVideoConstraints(e)},n.prototype.createConfig=function(e){return e?(e.fps||(e.fps=Gl.SCAN_DEFAULT_FPS),e.rememberLastUsedCamera!==!Gl.DEFAULT_REMEMBER_LAST_CAMERA_USED&&(e.rememberLastUsedCamera=Gl.DEFAULT_REMEMBER_LAST_CAMERA_USED),e):{fps:Gl.SCAN_DEFAULT_FPS,rememberLastUsedCamera:Gl.DEFAULT_REMEMBER_LAST_CAMERA_USED}},n.prototype.createBasicLayout=function(e){e.style.position="relative",e.style.padding="0px",e.style.border="1px solid silver",this.createHeader(e);var t=document.createElement("div"),r=this.getScanRegionId();t.id=r,t.style.width="100%",t.style.minHeight="100px",t.style.textAlign="center",e.appendChild(t),this.insertCameraScanImageToScanRegion();var i=document.createElement("div"),o=this.getDashboardId();i.id=o,i.style.width="100%",e.appendChild(i),this.setupInitialDashboard(i)},n.prototype.resetBasicLayout=function(e){e.style.border="none"},n.prototype.setupInitialDashboard=function(e){this.createSection(e),this.createSectionControlPanel(),this.createSectionSwap()},n.prototype.createHeader=function(e){var t=document.createElement("div");t.style.textAlign="left",t.style.margin="0px",e.appendChild(t),(new yz).renderInto(t);var i=document.createElement("div");i.id=this.getHeaderMessageContainerId(),i.style.display="none",i.style.textAlign="center",i.style.fontSize="14px",i.style.padding="2px 10px",i.style.margin="4px",i.style.borderTop="1px solid #f6f6f6",t.appendChild(i)},n.prototype.createSection=function(e){var t=document.createElement("div");t.id=this.getDashboardSectionId(),t.style.width="100%",t.style.padding="10px 0px 10px 0px",t.style.textAlign="left",e.appendChild(t)},n.prototype.createCameraListUi=function(e,t,r){var i=this;i.setHeaderMessage(Ss.cameraPermissionRequesting());var o=function(){r||i.createPermissionButton(e,t)};Zy.getCameras().then(function(s){i.persistedDataManager.setHasPermission(!0),i.resetHeaderMessage(),s&&s.length>0?(e.removeChild(t),i.renderCameraSelection(s)):(i.setHeaderMessage(Ss.noCameraFound(),Do.STATUS_WARNING),o())}).catch(function(s){i.persistedDataManager.setHasPermission(!1),r?r.disabled=!1:o(),i.setHeaderMessage(s,Do.STATUS_WARNING)})},n.prototype.createPermissionButton=function(e,t){var r=this,i=document.createElement("button");i.innerText=Ss.cameraPermissionTitle(),i.addEventListener("click",function(){i.disabled=!0,r.createCameraListUi(e,t,i)}),t.appendChild(i)},n.prototype.createPermissionsUi=function(e,t){var r=this;this.persistedDataManager.hasCameraPermissions()?xz.hasCameraPermissions().then(function(i){i?r.createCameraListUi(e,t):(r.persistedDataManager.setHasPermission(!1),r.createPermissionButton(e,t))}).catch(function(i){r.persistedDataManager.setHasPermission(!1),r.createPermissionButton(e,t)}):this.createPermissionButton(e,t)},n.prototype.createSectionControlPanel=function(){var e=this,t=document.getElementById(this.getDashboardSectionId()),r=document.createElement("div");t.appendChild(r);var i=document.createElement("div");i.id=this.getDashboardSectionCameraScanRegionId(),i.style.display=this.currentScanType===Go.SCAN_TYPE_CAMERA?"block":"none",r.appendChild(i);var o=document.createElement("div");o.style.textAlign="center",i.appendChild(o),this.createPermissionsUi(i,o);var s=document.createElement("div");s.id=this.getDashboardSectionFileScanRegionId(),s.style.textAlign="center",s.style.display=this.currentScanType===Go.SCAN_TYPE_CAMERA?"none":"block",r.appendChild(s);var a=document.createElement("input");a.id=this.getFileScanInputId(),a.accept="image/*",a.type="file",a.style.width="200px",a.disabled=this.currentScanType===Go.SCAN_TYPE_CAMERA;var c=document.createElement("span");c.innerText=" Select Image",s.appendChild(a),s.appendChild(c),a.addEventListener("change",function(f){if(!e.html5Qrcode)throw"html5Qrcode not defined";null!=f&&null!=f.target&&e.currentScanType===Go.SCAN_TYPE_FILE&&0!==f.target.files.length&&e.html5Qrcode.scanFileV2(f.target.files[0],!0).then(function(m){e.resetHeaderMessage(),e.qrCodeSuccessCallback(m.decodedText,m)}).catch(function(m){e.setHeaderMessage(m,Do.STATUS_WARNING),e.qrCodeErrorCallback(m,NS.createFrom(m))})})},n.prototype.renderCameraSelection=function(e){var t=this,r=document.getElementById(this.getDashboardSectionCameraScanRegionId());r.style.textAlign="center";var i=document.createElement("span");i.style.marginRight="10px";var o=e.length,s=document.createElement("select");if(1===o)s.style.display="none";else{var a=Ss.selectCamera();i.innerText=a+" ("+e.length+")  "}s.id=this.getCameraSelectionId();for(var c=[],f=0,p=e;f<p.length;f++){var m=p[f],y=m.id,w=null==m.label?y:m.label;(E=document.createElement("option")).value=y,E.innerText=w,c.push(E),s.appendChild(E)}i.appendChild(s),r.appendChild(i);var A=document.createElement("span"),_=document.createElement("button");_.innerText=Ss.scanButtonStartScanningText(),A.appendChild(_);var T=document.createElement("button");T.innerText=Ss.scanButtonStopScanningText(),T.style.display="none",T.disabled=!0,A.appendChild(T),r.appendChild(A);var N=function(Y){Y||(_.style.display="none"),_.innerText=Ss.scanButtonStartScanningText(),_.style.opacity="1",_.disabled=!1,Y&&(_.style.display="inline-block")};if(_.addEventListener("click",function(Y){_.innerText=Ss.scanButtonScanningStarting(),s.disabled=!0,_.disabled=!0,_.style.opacity="0.5",t.showHideScanTypeSwapLink(!1),t.resetHeaderMessage();var X=s.value;t.persistedDataManager.setLastUsedCameraId(X),t.html5Qrcode.start(X,function(n){return{fps:n.fps,qrbox:n.qrbox,aspectRatio:n.aspectRatio,disableFlip:n.disableFlip,videoConstraints:n.videoConstraints}}(t.config),t.qrCodeSuccessCallback,t.qrCodeErrorCallback).then(function(z){T.disabled=!1,T.style.display="inline-block",N(!1)}).catch(function(z){t.showHideScanTypeSwapLink(!0),s.disabled=!1,N(!0),t.setHeaderMessage(z,Do.STATUS_WARNING)})}),1===o&&_.click(),T.addEventListener("click",function(Y){if(!t.html5Qrcode)throw"html5Qrcode not defined";T.disabled=!0,t.html5Qrcode.stop().then(function(X){t.showHideScanTypeSwapLink(!0),s.disabled=!1,_.disabled=!1,T.style.display="none",_.style.display="inline-block",t.insertCameraScanImageToScanRegion()}).catch(function(X){T.disabled=!1,t.setHeaderMessage(X,Do.STATUS_WARNING)})}),t.persistedDataManager.getLastUsedCameraId()){for(var M=t.persistedDataManager.getLastUsedCameraId(),R=!1,P=0,B=c;P<B.length;P++){var E;if((E=B[P]).value===M){R=!0;break}}R?(s.value=M,_.click()):t.persistedDataManager.resetLastUsedCameraId()}},n.prototype.createSectionSwap=function(){var e=this,t=Ss.textIfCameraScanSelected(),r=Ss.textIfFileScanSelected(),i=document.getElementById(this.getDashboardSectionId()),o=document.createElement("div");o.style.textAlign="center";var s=document.createElement("a");s.style.textDecoration="underline",s.id=this.getDashboardSectionSwapLinkId(),s.innerText=this.currentScanType===Go.SCAN_TYPE_CAMERA?t:r,s.href="#scan-using-file",s.addEventListener("click",function(){e.sectionSwapAllowed?(e.resetHeaderMessage(),e.getFileScanInput().value="",e.sectionSwapAllowed=!1,e.currentScanType===Go.SCAN_TYPE_CAMERA?(e.clearScanRegion(),e.getFileScanInput().disabled=!1,e.getCameraScanRegion().style.display="none",e.getFileScanRegion().style.display="block",s.innerText=r,e.currentScanType=Go.SCAN_TYPE_FILE,e.insertFileScanImageToScanRegion()):(e.clearScanRegion(),e.getFileScanInput().disabled=!0,e.getCameraScanRegion().style.display="block",e.getFileScanRegion().style.display="none",s.innerText=t,e.currentScanType=Go.SCAN_TYPE_CAMERA,e.insertCameraScanImageToScanRegion()),e.sectionSwapAllowed=!0):e.verbose&&e.logger.logError("Section swap called when not allowed")}),o.appendChild(s),i.appendChild(o)},n.prototype.resetHeaderMessage=function(){document.getElementById(this.getHeaderMessageContainerId()).style.display="none"},n.prototype.setHeaderMessage=function(e,t){t||(t=Do.STATUS_DEFAULT);var r=this.getHeaderMessageDiv();switch(r.innerText=e,r.style.display="block",t){case Do.STATUS_SUCCESS:r.style.background="#6aaf5042",r.style.color="#477735";break;case Do.STATUS_WARNING:r.style.background="#cb243124",r.style.color="#cb2431";break;case Do.STATUS_DEFAULT:default:r.style.background="#00000000",r.style.color="rgb(17, 17, 17)"}},n.prototype.showHideScanTypeSwapLink=function(e){!0!==e&&(e=!1),this.sectionSwapAllowed=e,this.getDashboardSectionSwapLink().style.display=e?"inline-block":"none"},n.prototype.insertCameraScanImageToScanRegion=function(){var e=this,t=document.getElementById(this.getScanRegionId());if(this.cameraScanImage)return t.innerHTML="<br>",void t.appendChild(this.cameraScanImage);this.cameraScanImage=new Image,this.cameraScanImage.onload=function(r){t.innerHTML="<br>",t.appendChild(e.cameraScanImage)},this.cameraScanImage.width=64,this.cameraScanImage.style.opacity="0.8",this.cameraScanImage.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzNzEuNjQzIDM3MS42NDMiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDM3MS42NDMgMzcxLjY0MyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PHBhdGggZD0iTTEwNS4wODQgMzguMjcxaDE2My43Njh2MjBIMTA1LjA4NHoiLz48cGF0aCBkPSJNMzExLjU5NiAxOTAuMTg5Yy03LjQ0MS05LjM0Ny0xOC40MDMtMTYuMjA2LTMyLjc0My0yMC41MjJWMzBjMC0xNi41NDItMTMuNDU4LTMwLTMwLTMwSDEyNS4wODRjLTE2LjU0MiAwLTMwIDEzLjQ1OC0zMCAzMHYxMjAuMTQzaC04LjI5NmMtMTYuNTQyIDAtMzAgMTMuNDU4LTMwIDMwdjEuMzMzYTI5LjgwNCAyOS44MDQgMCAwIDAgNC42MDMgMTUuOTM5Yy03LjM0IDUuNDc0LTEyLjEwMyAxNC4yMjEtMTIuMTAzIDI0LjA2MXYxLjMzM2MwIDkuODQgNC43NjMgMTguNTg3IDEyLjEwMyAyNC4wNjJhMjkuODEgMjkuODEgMCAwIDAtNC42MDMgMTUuOTM4djEuMzMzYzAgMTYuNTQyIDEzLjQ1OCAzMCAzMCAzMGg4LjMyNGMuNDI3IDExLjYzMSA3LjUwMyAyMS41ODcgMTcuNTM0IDI2LjE3Ny45MzEgMTAuNTAzIDQuMDg0IDMwLjE4NyAxNC43NjggNDUuNTM3YTkuOTg4IDkuOTg4IDAgMCAwIDguMjE2IDQuMjg4IDkuOTU4IDkuOTU4IDAgMCAwIDUuNzA0LTEuNzkzYzQuNTMzLTMuMTU1IDUuNjUtOS4zODggMi40OTUtMTMuOTIxLTYuNzk4LTkuNzY3LTkuNjAyLTIyLjYwOC0xMC43Ni0zMS40aDgyLjY4NWMuMjcyLjQxNC41NDUuODE4LjgxNSAxLjIxIDMuMTQyIDQuNTQxIDkuMzcyIDUuNjc5IDEzLjkxMyAyLjUzNCA0LjU0Mi0zLjE0MiA1LjY3Ny05LjM3MSAyLjUzNS0xMy45MTMtMTEuOTE5LTE3LjIyOS04Ljc4Ny0zNS44ODQgOS41ODEtNTcuMDEyIDMuMDY3LTIuNjUyIDEyLjMwNy0xMS43MzIgMTEuMjE3LTI0LjAzMy0uODI4LTkuMzQzLTcuMTA5LTE3LjE5NC0xOC42NjktMjMuMzM3YTkuODU3IDkuODU3IDAgMCAwLTEuMDYxLS40ODZjLS40NjYtLjE4Mi0xMS40MDMtNC41NzktOS43NDEtMTUuNzA2IDEuMDA3LTYuNzM3IDE0Ljc2OC04LjI3MyAyMy43NjYtNy42NjYgMjMuMTU2IDEuNTY5IDM5LjY5OCA3LjgwMyA0Ny44MzYgMTguMDI2IDUuNzUyIDcuMjI1IDcuNjA3IDE2LjYyMyA1LjY3MyAyOC43MzMtLjQxMyAyLjU4NS0uODI0IDUuMjQxLTEuMjQ1IDcuOTU5LTUuNzU2IDM3LjE5NC0xMi45MTkgODMuNDgzLTQ5Ljg3IDExNC42NjEtNC4yMjEgMy41NjEtNC43NTYgOS44Ny0xLjE5NCAxNC4wOTJhOS45OCA5Ljk4IDAgMCAwIDcuNjQ4IDMuNTUxIDkuOTU1IDkuOTU1IDAgMCAwIDYuNDQ0LTIuMzU4YzQyLjY3Mi0zNi4wMDUgNTAuODAyLTg4LjUzMyA1Ni43MzctMTI2Ljg4OC40MTUtMi42ODQuODIxLTUuMzA5IDEuMjI5LTcuODYzIDIuODM0LTE3LjcyMS0uNDU1LTMyLjY0MS05Ljc3Mi00NC4zNDV6bS0yMzIuMzA4IDQyLjYyYy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM2MwLTUuNTE0IDQuNDg2LTEwIDEwLTEwaDE1djIxLjMzM2gtMTV6bS0yLjUtNTIuNjY2YzAtNS41MTQgNC40ODYtMTAgMTAtMTBoNy41djIxLjMzM2gtNy41Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM3ptMTcuNSA5My45OTloLTcuNWMtNS41MTQgMC0xMC00LjQ4Ni0xMC0xMHYtMS4zMzNjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGg3LjV2MjEuMzMzem0zMC43OTYgMjguODg3Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi04LjI3MWg5MS40NTdjLS44NTEgNi42NjgtLjQzNyAxMi43ODcuNzMxIDE4LjI3MWgtODIuMTg4em03OS40ODItMTEzLjY5OGMtMy4xMjQgMjAuOTA2IDEyLjQyNyAzMy4xODQgMjEuNjI1IDM3LjA0IDUuNDQxIDIuOTY4IDcuNTUxIDUuNjQ3IDcuNzAxIDcuMTg4LjIxIDIuMTUtMi41NTMgNS42ODQtNC40NzcgNy4yNTEtLjQ4Mi4zNzgtLjkyOS44LTEuMzM1IDEuMjYxLTYuOTg3IDcuOTM2LTExLjk4MiAxNS41Mi0xNS40MzIgMjIuNjg4aC05Ny41NjRWMzBjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGgxMjMuNzY5YzUuNTE0IDAgMTAgNC40ODYgMTAgMTB2MTM1LjU3OWMtMy4wMzItLjM4MS02LjE1LS42OTQtOS4zODktLjkxNC0yNS4xNTktMS42OTQtNDIuMzcgNy43NDgtNDQuODk4IDI0LjY2NnoiLz48cGF0aCBkPSJNMTc5LjEyOSA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXpNMTcyLjYyOSAxNDIuODZoLTEyLjU2VjEzMC44YTUgNSAwIDEgMC0xMCAwdjE3LjA2MWE1IDUgMCAwIDAgNSA1aDE3LjU2YTUgNSAwIDEgMCAwLTEwLjAwMXpNMjE2LjU2OCA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXptLTUgMjQuMDYxaC0xNC4wNlY5My4xNjdoMTQuMDZ2MTQuMDYxek0yMTEuNjY5IDEyNS45MzZIMTk3LjQxYTUgNSAwIDAgMC01IDV2MTQuMjU3YTUgNSAwIDAgMCA1IDVoMTQuMjU5YTUgNSAwIDAgMCA1LTV2LTE0LjI1N2E1IDUgMCAwIDAtNS01eiIvPjwvc3ZnPg=="},n.prototype.insertFileScanImageToScanRegion=function(){var e=this,t=document.getElementById(this.getScanRegionId());if(this.fileScanImage)return t.innerHTML="<br>",void t.appendChild(this.fileScanImage);this.fileScanImage=new Image,this.fileScanImage.onload=function(r){t.innerHTML="<br>",t.appendChild(e.fileScanImage)},this.fileScanImage.width=64,this.fileScanImage.style.opacity="0.8",this.fileScanImage.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1OS4wMTggNTkuMDE4IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1OS4wMTggNTkuMDE4IiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJtNTguNzQxIDU0LjgwOS01Ljk2OS02LjI0NGExMC43NCAxMC43NCAwIDAgMCAyLjgyLTcuMjVjMC01Ljk1My00Ljg0My0xMC43OTYtMTAuNzk2LTEwLjc5NlMzNCAzNS4zNjEgMzQgNDEuMzE0IDM4Ljg0MyA1Mi4xMSA0NC43OTYgNTIuMTFjMi40NDEgMCA0LjY4OC0uODI0IDYuNDk5LTIuMTk2bDYuMDAxIDYuMjc3YS45OTguOTk4IDAgMCAwIDEuNDE0LjAzMiAxIDEgMCAwIDAgLjAzMS0xLjQxNHpNMzYgNDEuMzE0YzAtNC44NSAzLjk0Ni04Ljc5NiA4Ljc5Ni04Ljc5NnM4Ljc5NiAzLjk0NiA4Ljc5NiA4Ljc5Ni0zLjk0NiA4Ljc5Ni04Ljc5NiA4Ljc5NlMzNiA0Ni4xNjQgMzYgNDEuMzE0ek0xMC40MzEgMTYuMDg4YzAgMy4wNyAyLjQ5OCA1LjU2OCA1LjU2OSA1LjU2OHM1LjU2OS0yLjQ5OCA1LjU2OS01LjU2OGMwLTMuMDcxLTIuNDk4LTUuNTY5LTUuNTY5LTUuNTY5cy01LjU2OSAyLjQ5OC01LjU2OSA1LjU2OXptOS4xMzggMGMwIDEuOTY4LTEuNjAyIDMuNTY4LTMuNTY5IDMuNTY4cy0zLjU2OS0xLjYwMS0zLjU2OS0zLjU2OCAxLjYwMi0zLjU2OSAzLjU2OS0zLjU2OSAzLjU2OSAxLjYwMSAzLjU2OSAzLjU2OXoiLz48cGF0aCBkPSJtMzAuODgyIDI4Ljk4NyA5LjE4LTEwLjA1NCAxMS4yNjIgMTAuMzIzYTEgMSAwIDAgMCAxLjM1MS0xLjQ3NWwtMTItMTFhMSAxIDAgMCAwLTEuNDE0LjA2M2wtOS43OTQgMTAuNzI3LTQuNzQzLTQuNzQzYTEuMDAzIDEuMDAzIDAgMCAwLTEuMzY4LS4wNDRMNi4zMzkgMzcuNzY4YTEgMSAwIDEgMCAxLjMyMiAxLjUwMWwxNi4zMTMtMTQuMzYyIDcuMzE5IDcuMzE4YS45OTkuOTk5IDAgMSAwIDEuNDE0LTEuNDE0bC0xLjgyNS0xLjgyNHoiLz48cGF0aCBkPSJNMzAgNDYuNTE4SDJ2LTQyaDU0djI4YTEgMSAwIDEgMCAyIDB2LTI5YTEgMSAwIDAgMC0xLTFIMWExIDEgMCAwIDAtMSAxdjQ0YTEgMSAwIDAgMCAxIDFoMjlhMSAxIDAgMSAwIDAtMnoiLz48L3N2Zz4="},n.prototype.clearScanRegion=function(){document.getElementById(this.getScanRegionId()).innerHTML=""},n.prototype.getDashboardSectionId=function(){return this.elementId+"__dashboard_section"},n.prototype.getDashboardSectionCameraScanRegionId=function(){return this.elementId+"__dashboard_section_csr"},n.prototype.getDashboardSectionFileScanRegionId=function(){return this.elementId+"__dashboard_section_fsr"},n.prototype.getDashboardSectionSwapLinkId=function(){return this.elementId+"__dashboard_section_swaplink"},n.prototype.getScanRegionId=function(){return this.elementId+"__scan_region"},n.prototype.getDashboardId=function(){return this.elementId+"__dashboard"},n.prototype.getFileScanInputId=function(){return this.elementId+"__filescan_input"},n.prototype.getStatusSpanId=function(){return this.elementId+"__status_span"},n.prototype.getHeaderMessageContainerId=function(){return this.elementId+"__header_message"},n.prototype.getCameraSelectionId=function(){return this.elementId+"__camera_selection"},n.prototype.getCameraScanRegion=function(){return document.getElementById(this.getDashboardSectionCameraScanRegionId())},n.prototype.getFileScanRegion=function(){return document.getElementById(this.getDashboardSectionFileScanRegionId())},n.prototype.getFileScanInput=function(){return document.getElementById(this.getFileScanInputId())},n.prototype.getDashboardSectionSwapLink=function(){return document.getElementById(this.getDashboardSectionSwapLinkId())},n.prototype.getHeaderMessageDiv=function(){return document.getElementById(this.getHeaderMessageContainerId())}}();const Az={"webcam-face-input":$y,"webcam-input":I0,"webcam-qr-input":(()=>{class n extends I0{constructor(){super(...arguments),this.videoRefId=`videoRef-${(new Date).getTime()}`,this.captureText=new Ei}ngAfterViewInit(){var t=()=>super.ngAfterViewInit,r=this;return Nr(function*(){t().call(r),r.html5QrCode=new Zy(r.videoRefId)})()}startStream(){var t=this;return Nr(function*(){t.html5QrCode&&t.cameraId&&(t.html5QrCode.start(t.cameraId,{fps:t.fps,qrbox:{width:500,height:500},videoConstraints:_0},(r,i)=>{r&&(t.captureText.emit(r),t.stopStream())},r=>{t.error.emit(r)}).catch(r=>{t.error.emit(r)}),t.updateStartStreamAttribute())})()}stopStream(){var t=this;return Nr(function*(){var r;null===(r=t.html5QrCode)||void 0===r||r.stop(),t.hideElements()})()}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=z0(n)))(r||n)}}(),n.\u0275cmp=ye({type:n,selectors:[["app-webcam-qr-input"]],outputs:{captureText:"captureText"},features:[Tf],decls:7,vars:9,consts:[[1,"video-div",3,"id"],["videoRef",""],[1,"buttons"],[4,"ngIf"],[3,"selectCamera",4,"ngIf"],["type","button",3,"disabled","click",4,"ngIf"],["type","button",3,"click",4,"ngIf"],[3,"selectCamera"],["type","button",3,"disabled","click"],["type","button",3,"click"]],template:function(t,r){1&t&&(Th(0,"div",0,1),An(2,"div",2),Dr(3,Cz,2,0,"span",3),Dr(4,Ez,1,0,"app-webcam-list",4),Dr(5,_z,2,1,"button",5),Dr(6,Iz,2,0,"button",6),Dn()),2&t&&(Js("hidden",!r.shouldPlay),In("id",r.videoRefId),Hn(2),Js("absolute",r.shouldPlay),Hn(1),In("ngIf",!r.shouldPlay),Hn(1),In("ngIf",!r.shouldPlay),Hn(1),In("ngIf",!r.shouldPlay),Hn(1),In("ngIf",r.shouldPlay))},directives:[Cl,Ud],styles:["[_nghost-%COMP%]{position:relative;text-align:center}.popup[_nghost-%COMP%]{position:absolute;z-index:999;top:10vh;left:50%;transform:translate(-50%);box-shadow:1px 1px 14px #000000bf;max-height:90vh;width:95vw;min-height:10vh;min-width:30vw;background-color:#fff}video[_ngcontent-%COMP%]{transform:rotateY(180deg);min-height:inherit;min-width:inherit;max-height:100%;max-width:100%}canvas[_ngcontent-%COMP%]{display:none}.buttons[_ngcontent-%COMP%]{display:flex;align-items:center}.buttons[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{white-space:nowrap}.buttons.absolute[_ngcontent-%COMP%]{position:absolute;bottom:0;left:50%;transform:translate(-50%)}.hidden[_ngcontent-%COMP%]{display:none}.popup[_nghost-%COMP%]{width:auto}[_nghost-%COMP%]   .video-div[_ngcontent-%COMP%]{min-width:70vw;min-height:20vh}[_nghost-%COMP%]   .video-div[_ngcontent-%COMP%]     video{min-width:inherit;min-height:inherit}"]}),n})(),"peek-detector":AS};let Dz=(()=>{class n{constructor(t){this.injector=t,this.components=Az,Object.keys(this.components).forEach(r=>{const i=function(n,e){const t=function(n,e){return e.get(du).resolveComponentFactory(n).inputs}(n,e.injector),r=e.strategyFactory||new DH(n,e.injector),i=function(n){const e={};return n.forEach(({propName:t,templateName:r})=>{e[function(n){return n.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}(r)]=t}),e}(t);class o extends SH{constructor(a){super(),this.injector=a}get ngElementStrategy(){if(!this._ngElementStrategy){const a=this._ngElementStrategy=r.create(this.injector||e.injector);t.forEach(({propName:c})=>{if(!this.hasOwnProperty(c))return;const f=this[c];delete this[c],a.setInputValue(c,f)})}return this._ngElementStrategy}attributeChangedCallback(a,c,f,p){this.ngElementStrategy.setInputValue(i[a],f)}connectedCallback(){let a=!1;this.ngElementStrategy.events&&(this.subscribeToEvents(),a=!0),this.ngElementStrategy.connect(this),a||this.subscribeToEvents()}disconnectedCallback(){this._ngElementStrategy&&this._ngElementStrategy.disconnect(),this.ngElementEventsSubscription&&(this.ngElementEventsSubscription.unsubscribe(),this.ngElementEventsSubscription=null)}subscribeToEvents(){this.ngElementEventsSubscription=this.ngElementStrategy.events.subscribe(a=>{const c=function(n,e,t){if("function"!=typeof CustomEvent){const o=n.createEvent("CustomEvent");return o.initCustomEvent(e,!1,!1,t),o}return new CustomEvent(e,{bubbles:!1,cancelable:!1,detail:t})}(this.ownerDocument,a.name,a.value);this.dispatchEvent(c)})}}return o.observedAttributes=Object.keys(i),t.forEach(({propName:s})=>{Object.defineProperty(o.prototype,s,{get(){return this.ngElementStrategy.getInputValue(s)},set(a){this.ngElementStrategy.setInputValue(s,a)},configurable:!0,enumerable:!0})}),o}(this.components[r],{injector:t});customElements.define(r,i)})}ngDoBootstrap(){}}return n.\u0275fac=function(t){return new(t||n)(Kt(kn))},n.\u0275mod=ct({type:n}),n.\u0275inj=Qi({imports:[[EB]]}),n})();(function(){if(XE)throw new Error("Cannot enable prod mode after platform setup.");YE=!1})(),bB().bootstrapModule(Dz).catch(n=>console.error(n))},730:()=>{},369:()=>{},655:()=>{},118:()=>{}},Zn=>{Zn(Zn.s=127)}]);