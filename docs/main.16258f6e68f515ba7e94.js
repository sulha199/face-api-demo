var bse=Object.defineProperty,wse=Object.defineProperties,_se=Object.getOwnPropertyDescriptors,HP=Object.getOwnPropertySymbols,Cse=Object.prototype.hasOwnProperty,Ese=Object.prototype.propertyIsEnumerable,zP=(tn,$n,me)=>$n in tn?bse(tn,$n,{enumerable:!0,configurable:!0,writable:!0,value:me}):tn[$n]=me,z_=(tn,$n)=>{for(var me in $n||($n={}))Cse.call($n,me)&&zP(tn,me,$n[me]);if(HP)for(var me of HP($n))Ese.call($n,me)&&zP(tn,me,$n[me]);return tn},G_=(tn,$n)=>wse(tn,_se($n));(self.webpackChunkface_match_demo=self.webpackChunkface_match_demo||[]).push([[179],{255:tn=>{function $n(me){return Promise.resolve().then(()=>{var ar=new Error("Cannot find module '"+me+"'");throw ar.code="MODULE_NOT_FOUND",ar})}$n.keys=()=>[],$n.resolve=$n,$n.id=255,tn.exports=$n},394:function(){(function(){"use strict";var tn;function $n(I){var k=0;return function(){return k<I.length?{done:!1,value:I[k++]}:{done:!0}}}var me="function"==typeof Object.defineProperties?Object.defineProperty:function(I,k,P){return I==Array.prototype||I==Object.prototype||(I[k]=P.value),I},fr=function(I){I=["object"==typeof globalThis&&globalThis,I,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var k=0;k<I.length;++k){var P=I[k];if(P&&P.Math==Math)return P}throw Error("Cannot find global object")}(this);function Bn(I,k){if(k)e:{var P=fr;I=I.split(".");for(var W=0;W<I.length-1;W++){var Q=I[W];if(!(Q in P))break e;P=P[Q]}(k=k(W=P[I=I[I.length-1]]))!=W&&null!=k&&me(P,I,{configurable:!0,writable:!0,value:k})}}function Bo(I){return(I={next:I})[Symbol.iterator]=function(){return this},I}function Lr(I){var k="undefined"!=typeof Symbol&&Symbol.iterator&&I[Symbol.iterator];return k?k.call(I):{next:$n(I)}}function br(I){if(!(I instanceof Array)){I=Lr(I);for(var k,P=[];!(k=I.next()).done;)P.push(k.value);I=P}return I}Bn("Symbol",function(I){function P(ce,ne){this.g=ce,me(this,"description",{configurable:!0,writable:!0,value:ne})}if(I)return I;P.prototype.toString=function(){return this.g};var W="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Q=0;return function k(ce){if(this instanceof k)throw new TypeError("Symbol is not a constructor");return new P(W+(ce||"")+"_"+Q++,ce)}}),Bn("Symbol.iterator",function(I){if(I)return I;I=Symbol("Symbol.iterator");for(var k="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),P=0;P<k.length;P++){var W=fr[k[P]];"function"==typeof W&&"function"!=typeof W.prototype[I]&&me(W.prototype,I,{configurable:!0,writable:!0,value:function(){return Bo($n(this))}})}return I});var Ke,hi="function"==typeof Object.create?Object.create:function(I){function k(){}return k.prototype=I,new k};if("function"==typeof Object.setPrototypeOf)Ke=Object.setPrototypeOf;else{var Bi;e:{var va={};try{va.__proto__={a:!0},Bi=va.a;break e}catch(I){}Bi=!1}Ke=Bi?function(I,k){if(I.__proto__=k,I.__proto__!==k)throw new TypeError(I+" is not extensible");return I}:null}var $t=Ke;function Vi(I,k){if(I.prototype=hi(k.prototype),I.prototype.constructor=I,$t)$t(I,k);else for(var P in k)if("prototype"!=P)if(Object.defineProperties){var W=Object.getOwnPropertyDescriptor(k,P);W&&Object.defineProperty(I,P,W)}else I[P]=k[P];I.ea=k.prototype}function Pn(){this.l=!1,this.i=null,this.h=void 0,this.g=1,this.s=this.m=0,this.j=null}function Cn(I){if(I.l)throw new TypeError("Generator is already running");I.l=!0}function Dt(I,k){I.j={U:k,V:!0},I.g=I.m||I.s}function xt(I,k,P){return I.g=P,{value:k}}function lo(I){this.g=new Pn,this.h=I}function Re(I,k,P,W){try{var Q=k.call(I.g.i,P);if(!(Q instanceof Object))throw new TypeError("Iterator result "+Q+" is not an object");if(!Q.done)return I.g.l=!1,Q;var ce=Q.value}catch(ne){return I.g.i=null,Dt(I.g,ne),Yt(I)}return I.g.i=null,W.call(I.g,ce),Yt(I)}function Yt(I){for(;I.g.g;)try{var k=I.h(I.g);if(k)return I.g.l=!1,{value:k.value,done:!1}}catch(P){I.g.h=void 0,Dt(I.g,P)}if(I.g.l=!1,I.g.j){if(k=I.g.j,I.g.j=null,k.V)throw k.U;return{value:k.return,done:!0}}return{value:void 0,done:!0}}function ee(I){this.next=function(k){return Cn(I.g),I.g.i?k=Re(I,I.g.i.next,k,I.g.o):(I.g.o(k),k=Yt(I)),k},this.throw=function(k){return Cn(I.g),I.g.i?k=Re(I,I.g.i.throw,k,I.g.o):(Dt(I.g,k),k=Yt(I)),k},this.return=function(k){return function(I,k){Cn(I.g);var P=I.g.i;return P?Re(I,"return"in P?P.return:function(W){return{value:W,done:!0}},k,I.g.return):(I.g.return(k),Yt(I))}(I,k)},this[Symbol.iterator]=function(){return this}}function Ae(I){return function(I){function k(W){return I.next(W)}function P(W){return I.throw(W)}return new Promise(function(W,Q){!function ce(ne){ne.done?W(ne.value):Promise.resolve(ne.value).then(k,P).then(ce,Q)}(I.next())})}(new ee(new lo(I)))}Pn.prototype.o=function(I){this.h=I},Pn.prototype.return=function(I){this.j={return:I},this.g=this.s},Bn("Promise",function(I){function k(ne){this.h=0,this.i=void 0,this.g=[],this.o=!1;var xe=this.j();try{ne(xe.resolve,xe.reject)}catch(be){xe.reject(be)}}function P(){this.g=null}function W(ne){return ne instanceof k?ne:new k(function(xe){xe(ne)})}if(I)return I;P.prototype.h=function(ne){if(null==this.g){this.g=[];var xe=this;this.i(function(){xe.l()})}this.g.push(ne)};var Q=fr.setTimeout;P.prototype.i=function(ne){Q(ne,0)},P.prototype.l=function(){for(;this.g&&this.g.length;){var ne=this.g;this.g=[];for(var xe=0;xe<ne.length;++xe){var be=ne[xe];ne[xe]=null;try{be()}catch(ke){this.j(ke)}}}this.g=null},P.prototype.j=function(ne){this.i(function(){throw ne})},k.prototype.j=function(){function ne(ke){return function(vt){be||(be=!0,ke.call(xe,vt))}}var xe=this,be=!1;return{resolve:ne(this.C),reject:ne(this.l)}},k.prototype.C=function(ne){if(ne===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(ne instanceof k)this.F(ne);else{e:switch(typeof ne){case"object":var xe=null!=ne;break e;case"function":xe=!0;break e;default:xe=!1}xe?this.v(ne):this.m(ne)}},k.prototype.v=function(ne){var xe=void 0;try{xe=ne.then}catch(be){return void this.l(be)}"function"==typeof xe?this.G(xe,ne):this.m(ne)},k.prototype.l=function(ne){this.s(2,ne)},k.prototype.m=function(ne){this.s(1,ne)},k.prototype.s=function(ne,xe){if(0!=this.h)throw Error("Cannot settle("+ne+", "+xe+"): Promise already settled in state"+this.h);this.h=ne,this.i=xe,2===this.h&&this.D(),this.A()},k.prototype.D=function(){var ne=this;Q(function(){if(ne.B()){var xe=fr.console;void 0!==xe&&xe.error(ne.i)}},1)},k.prototype.B=function(){if(this.o)return!1;var ne=fr.CustomEvent,xe=fr.Event,be=fr.dispatchEvent;return void 0===be||("function"==typeof ne?ne=new ne("unhandledrejection",{cancelable:!0}):"function"==typeof xe?ne=new xe("unhandledrejection",{cancelable:!0}):(ne=fr.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,ne),ne.promise=this,ne.reason=this.i,be(ne))},k.prototype.A=function(){if(null!=this.g){for(var ne=0;ne<this.g.length;++ne)ce.h(this.g[ne]);this.g=null}};var ce=new P;return k.prototype.F=function(ne){var xe=this.j();ne.J(xe.resolve,xe.reject)},k.prototype.G=function(ne,xe){var be=this.j();try{ne.call(xe,be.resolve,be.reject)}catch(ke){be.reject(ke)}},k.prototype.then=function(ne,xe){function be(gt,Qe){return"function"==typeof gt?function(Mt){try{ke(gt(Mt))}catch(Je){vt(Je)}}:Qe}var ke,vt,Tt=new k(function(gt,Qe){ke=gt,vt=Qe});return this.J(be(ne,ke),be(xe,vt)),Tt},k.prototype.catch=function(ne){return this.then(void 0,ne)},k.prototype.J=function(ne,xe){function be(){switch(ke.h){case 1:ne(ke.i);break;case 2:xe(ke.i);break;default:throw Error("Unexpected state: "+ke.h)}}var ke=this;null==this.g?ce.h(be):this.g.push(be),this.o=!0},k.resolve=W,k.reject=function(ne){return new k(function(xe,be){be(ne)})},k.race=function(ne){return new k(function(xe,be){for(var ke=Lr(ne),vt=ke.next();!vt.done;vt=ke.next())W(vt.value).J(xe,be)})},k.all=function(ne){var xe=Lr(ne),be=xe.next();return be.done?W([]):new k(function(ke,vt){function Tt(Mt){return function(Je){gt[Mt]=Je,0==--Qe&&ke(gt)}}var gt=[],Qe=0;do{gt.push(void 0),Qe++,W(be.value).J(Tt(gt.length-1),vt),be=xe.next()}while(!be.done)})},k});var Oe="function"==typeof Object.assign?Object.assign:function(I,k){for(var P=1;P<arguments.length;P++){var W=arguments[P];if(W)for(var Q in W)Object.prototype.hasOwnProperty.call(W,Q)&&(I[Q]=W[Q])}return I};Bn("Object.assign",function(I){return I||Oe}),Bn("Object.is",function(I){return I||function(k,P){return k===P?0!==k||1/k==1/P:k!=k&&P!=P}}),Bn("Array.prototype.includes",function(I){return I||function(k,P){var W=this;W instanceof String&&(W=String(W));var Q=W.length;for(0>(P=P||0)&&(P=Math.max(P+Q,0));P<Q;P++){var ce=W[P];if(ce===k||Object.is(ce,k))return!0}return!1}}),Bn("String.prototype.includes",function(I){return I||function(k,P){if(null==this)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(k instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return-1!==this.indexOf(k,P||0)}}),Bn("Array.prototype.keys",function(I){return I||function(){return function(I,k){I instanceof String&&(I+="");var P=0,W=!1,Q={next:function(){if(!W&&P<I.length){var ce=P++;return{value:ce,done:!1}}return W=!0,{done:!0,value:void 0}}};return Q[Symbol.iterator]=function(){return Q},Q}(this)}});var bt=this||self;function ie(I,k){I=I.split(".");var W,P=bt;I[0]in P||void 0===P.execScript||P.execScript("var "+I[0]);for(;I.length&&(W=I.shift());)I.length||void 0===k?P=P[W]&&P[W]!==Object.prototype[W]?P[W]:P[W]={}:P[W]=k}function ft(I){!function(I){bt.setTimeout(function(){throw I},0)}(I)}function kt(I,k){ft(Error("Invalid wire type: "+I+" (at position "+k+")"))}function Br(){ft(Error("Failed to read varint, encoding is invalid."))}function $r(I,k){return k=String.fromCharCode.apply(null,k),null==I?k:I+k}var ya,as,di="undefined"!=typeof TextDecoder,Vr="undefined"!=typeof TextEncoder;function zu(I){if(Vr)I=(as||(as=new TextEncoder)).encode(I);else{var k=void 0;k=void 0!==k&&k;for(var P=0,W=new Uint8Array(3*I.length),Q=0;Q<I.length;Q++){var ce=I.charCodeAt(Q);if(128>ce)W[P++]=ce;else{if(2048>ce)W[P++]=ce>>6|192;else{if(55296<=ce&&57343>=ce){if(56319>=ce&&Q<I.length){var ne=I.charCodeAt(++Q);if(56320<=ne&&57343>=ne){W[P++]=(ce=1024*(ce-55296)+ne-56320+65536)>>18|240,W[P++]=ce>>12&63|128,W[P++]=ce>>6&63|128,W[P++]=63&ce|128;continue}Q--}if(k)throw Error("Found an unpaired surrogate");ce=65533}W[P++]=ce>>12|224,W[P++]=ce>>6&63|128}W[P++]=63&ce|128}}I=W.subarray(0,P)}return I}var pt={},us=null;function wr(I){var k;void 0===k&&(k=0),fi(),k=pt[k];for(var P=Array(Math.floor(I.length/3)),W=k[64]||"",Q=0,ce=0;Q<I.length-2;Q+=3){var ne=I[Q],xe=I[Q+1],be=I[Q+2],ke=k[ne>>2];P[ce++]=ke+(ne=k[(3&ne)<<4|xe>>4])+(xe=k[(15&xe)<<2|be>>6])+(be=k[63&be])}switch(ke=0,be=W,I.length-Q){case 2:be=k[(15&(ke=I[Q+1]))<<2]||W;case 1:P[ce]=k[(I=I[Q])>>2]+k[(3&I)<<4|ke>>4]+be+W}return P.join("")}function Ds(I){var k=I.length,P=3*k/4;P%3?P=Math.floor(P):-1!="=.".indexOf(I[k-1])&&(P=-1!="=.".indexOf(I[k-2])?P-2:P-1);var W=new Uint8Array(P),Q=0;return function(I,k){function P(be){for(;W<I.length;){var ke=I.charAt(W++),vt=us[ke];if(null!=vt)return vt;if(!/^[\s\xa0]*$/.test(ke))throw Error("Unknown base64 encoding at char: "+ke)}return be}fi();for(var W=0;;){var Q=P(-1),ce=P(0),ne=P(64),xe=P(64);if(64===xe&&-1===Q)break;k(Q<<2|ce>>4),64!=ne&&(k(ce<<4&240|ne>>2),64!=xe&&k(ne<<6&192|xe))}}(I,function(ce){W[Q++]=ce}),W.subarray(0,Q)}function fi(){if(!us){us={};for(var I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),k=["+/=","+/","-_=","-_.","-_"],P=0;5>P;P++){var W=I.concat(k[P].split(""));pt[P]=W;for(var Q=0;Q<W.length;Q++){var ce=W[Q];void 0===us[ce]&&(us[ce]=Q)}}}}var Kt,ru="function"==typeof Uint8Array;function xa(I){if(this.g=I,null!==I&&0===I.length)throw Error("ByteString should be constructed with non-empty values")}xa.prototype.toJSON=function(){if(null==this.g)var I="";else I=this.g=null==(I=this.g)||"string"==typeof I?I:ru&&I instanceof Uint8Array?wr(I):null;return I};var Vo="function"==typeof Uint8Array.prototype.slice;function ba(I,k,P){return k===P?Kt||(Kt=new Uint8Array(0)):Vo?I.slice(k,P):new Uint8Array(I.subarray(k,P))}var zn=0;function Gu(I,k){k=void 0!==(k=void 0===k?{}:k).u&&k.u,this.h=null,this.g=this.i=this.l=0,this.j=!1,this.u=k,I&&Xe(this,I)}function Xe(I,k){I.h=function(I){if(I.constructor===Uint8Array)return I;if(I.constructor===ArrayBuffer)return new Uint8Array(I);if(I.constructor===Array)return new Uint8Array(I);if(I.constructor===String)return Ds(I);if(I.constructor===xa){if(null==I.g)var k=Kt||(Kt=new Uint8Array(0));else{k=Uint8Array;var P=I.g;P=null==P||ru&&null!=P&&P instanceof Uint8Array?P:"string"==typeof P?Ds(P):null,k=new k(I=I.g=P)}return k}if(I instanceof Uint8Array)return new Uint8Array(I.buffer,I.byteOffset,I.byteLength);throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, or Array of numbers")}(k),I.l=0,I.i=I.h.length,I.g=I.l}function Di(I){I.g>I.i&&(I.j=!0,ft(Error("Tried to read past the end of the data "+I.g+" > "+I.i)))}function Uo(I){var k=I.h,P=k[I.g],W=127&P;return 128>P?(I.g+=1,Di(I),W):(W|=(127&(P=k[I.g+1]))<<7,128>P?(I.g+=2,Di(I),W):(W|=(127&(P=k[I.g+2]))<<14,128>P?(I.g+=3,Di(I),W):(W|=(127&(P=k[I.g+3]))<<21,128>P?(I.g+=4,Di(I),W):(W|=(15&(P=k[I.g+4]))<<28,128>P?(I.g+=5,Di(I),W>>>0):(I.g+=5,128<=k[I.g++]&&128<=k[I.g++]&&128<=k[I.g++]&&128<=k[I.g++]&&128<=k[I.g++]?(I.j=!0,Br(),W):(Di(I),W))))))}Gu.prototype.reset=function(){this.g=this.l};var pr=[];function iu(){this.g=new Uint8Array(64),this.h=0}function _r(I,k){if(!(I.h+1<I.g.length)){var P=I.g;I.g=new Uint8Array(Math.ceil(1+2*I.g.length)),I.g.set(P)}I.g[I.h++]=k}function wa(I,k){for(;127<k;)_r(I,127&k|128),k>>>=7;_r(I,k)}function Ui(I){var k={},P=void 0!==k.N&&k.N;this.m={u:void 0!==k.u&&k.u},this.N=P,k=this.m,pr.length?(P=pr.pop(),k&&(P.u=k.u),I&&Xe(P,I),I=P):I=new Gu(I,k),this.g=I,this.l=this.g.g,this.h=this.i=-1,this.j=!1}function Ur(I){var k=I.g;if((k=k.g==k.i)||(k=I.j)||(k=(k=I.g).j||0>k.g||k.g>k.i),k)return!1;I.l=I.g.g;var P=Uo(I.g);return k=P>>>3,0<=(P&=7)&&5>=P?(I.i=k,I.h=P,!0):(I.j=!0,kt(P,I.l),!1)}function Ts(I){switch(I.h){case 0:if(0!=I.h)Ts(I);else e:{for(var k=(I=I.g).g,P=0;10>P;P++){if(0==(128&I.h[k])){I.g=k+1,Di(I);break e}k++}I.j=!0,Br()}break;case 1:(I=I.g).g+=8,Di(I);break;case 2:2!=I.h?Ts(I):(k=Uo(I.g),(I=I.g).g+=k,Di(I));break;case 5:(I=I.g).g+=4,Di(I);break;case 3:for(k=I.i;;){if(!Ur(I)){I.j=!0,ft(Error("Unmatched start-group tag: stream EOF"));break}if(4==I.h){I.i!=k&&(I.j=!0,ft(Error("Unmatched end-group tag")));break}Ts(I)}break;default:I.j=!0,kt(I.h,I.l)}}function Ms(I,k,P){I.N||(I=ba(I.g.h,P,I.g.g),(P=k.m)?P.push(I):k.m=[I])}iu.prototype.length=function(){return this.h},iu.prototype.end=function(){var I=this.g,k=this.h;return this.h=0,ba(I,0,k)},Ui.prototype.reset=function(){this.g.reset(),this.h=this.i=-1};var Yu=[];function Cr(){this.h=[],this.i=0,this.g=new iu}function Me(I,k){0!==k.length&&(I.h.push(k),I.i+=k.length)}function Xu(I,k,P){wa(I.g,8*k+2),wa(I.g,P.length),Me(I,I.g.end()),Me(I,P)}var yt,En="function"==typeof Symbol&&"symbol"==typeof Symbol()?Symbol(void 0):void 0;function ur(I,k){Object.isFrozen(I)||(En?I[En]|=k:void 0!==I.g?I.g|=k:Object.defineProperties(I,{g:{value:k,configurable:!0,writable:!0,enumerable:!1}}))}function Rs(I){return I?null==(k=En?I[En]:I.g)?0:k:0;var k}function Ns(I){return Array.isArray(I)&&ur(I,1),I}function Bc(I){if(!Array.isArray(I))throw Error("cannot mark non-array as immutable");ur(I,2)}function un(I){return null!==I&&"object"==typeof I&&I.constructor===Object}function qu(I){switch(typeof I){case"number":return isFinite(I)?I:String(I);case"object":return ru&&null!=I&&I instanceof Uint8Array?wr(I):I;default:return I}}function cn(I,k){if(null!=I)return Array.isArray(I)||un(I)?$u(I,k):k(I)}function $u(I,k){if(Array.isArray(I)){for(var P=Array(I.length),W=0;W<I.length;W++)P[W]=cn(I[W],k);return 1&Rs(I)&&Ns(P),P}for(W in P={},I)P[W]=cn(I[W],k);return P}function ri(I,k,P){var W=yt;if(yt=null,I||(I=W),W=this.constructor.ca,I||(I=W?[W]:[]),this.j=(W?0:-1)-(this.constructor.aa||0),this.i=null,this.g=I,I=(W=this.g.length)-1,W&&un(W=this.g[I])?(this.l=I-this.j,this.h=W):void 0!==k&&-1<k?(this.l=Math.max(k,I+1-this.j),this.h=null):this.l=Number.MAX_VALUE,P)for(k=0;k<P.length;k++)(I=P[k])<this.l?(W=this.g[I+=this.j])?Ns(W):this.g[I]=Ao:(jo(this),(W=this.h[I])?Ns(W):this.h[I]=Ao)}var jl,Mi,Ao=Object.freeze(Ns([]));function jo(I){var k=I.l+I.j;I.g[k]||(I.h=I.g[k]={})}function He(I,k,P){return-1===k?null:void 0!==P&&P||k>=I.l?I.h?I.h[k]:void 0:I.g[k+I.j]}function $i(I,k,P){P=void 0===P||P;var W=void 0!==W&&W,Q=He(I,k,W);return null==Q&&(Q=Ao),Q===Ao?fn(I,k,Q=Ns([]),W):P&&Array.isArray(Q)&&2&Rs(Q)&&fn(I,k,Q=Q.slice(),W),Q}function Wo(I,k,P){return null==(I=null==(I=He(I,k))?I:+I)?void 0===P?0:P:I}function fn(I,k,P,W){void 0!==W&&W||k>=I.l?(jo(I),I.h[k]=P):I.g[k+I.j]=P}function Ku(I,k,P){I.i||(I.i={});var W=I.i[P];if(!W){var Q=$i(I,P,!1);W=[];for(var ce=!!Array.isArray(Q)&&!!(2&Rs(Q)),ne=0;ne<Q.length;ne++)W[ne]=new k(Q[ne]),ce&&Bc(W[ne].g);ce&&(Bc(W),Object.freeze(W)),I.i[P]=W}return W}function Si(I,k,P,W,Q){var ce=Ku(I,W,k);P=P||new W,I=$i(I,k),null!=Q?(ce.splice(Q,0,P),I.splice(Q,0,ht(P))):(ce.push(P),I.push(ht(P)))}function ht(I){if(I.i)for(var k in I.i){var P=I.i[k];if(Array.isArray(P))for(var W=0;W<P.length;W++)P[W]&&ht(P[W]);else P&&ht(P)}return I.g}function gr(I,k){return null==(I=He(I,k))?0:I}function ze(I,k){return null==(I=He(I,k))?"":I}function Os(I,k){if(I=I.m){Me(k,k.g.end());for(var P=0;P<I.length;P++)Me(k,I[P])}}function kd(I){var k=I[0];switch(I.length){case 2:var P=I[1];return function(be,ke,vt){return k(be,ke,vt,P)};case 3:var W=I[1],Q=I[2];return function(be,ke,vt){return k(be,ke,vt,W,Q)};case 4:var ce=I[1],ne=I[2],xe=I[3];return function(be,ke,vt){return k(be,ke,vt,ce,ne,xe)};default:throw Error("unsupported number of parameters, expected [2-4], got "+I.length)}}function jr(I,k,P){for(;Ur(k)&&4!=k.h;){var W=k.i,Q=P[W];if(Q){if(Array.isArray(Q)&&(Q=P[W]=kd(Q)),!Q(k,I,W)){Q=I;var ce=(W=k).l;Ts(W),Ms(W,Q,ce)}}else Q=I,ce=(W=k).l,Ts(W),Ms(W,Q,ce)}return I}function pi(I,k){var P=new Cr;if(k(I,P),0===(I=P.i+P.g.length()))P=new Uint8Array(0);else{I=new Uint8Array(I);for(var W=P.h,Q=W.length,ce=k=0;ce<Q;ce++){var ne=W[ce];0!==ne.length&&(I.set(ne,k),k+=ne.length)}0!==(Q=(W=P.g).h)&&(I.set(W.g.subarray(0,Q),k),W.h=0),P.h=[I],P=I}return P}function Ul(I,k,P){if(Yu.length){var W=Yu.pop();I&&(Xe(W.g,I),W.i=-1,W.h=-1),I=W}else I=new Ui(I);try{return P(new k,I)}finally{(k=I.g).h=null,k.l=0,k.i=0,k.g=0,k.j=!1,k.u=!1,I.i=-1,I.h=-1,I.j=!1,100>Yu.length&&Yu.push(I)}}function Ti(I,k,P){if(null!=(k=He(k,P))){wa(I.g,8*P+5),I=I.g;var W=k;0===(W=(P=0>W?1:0)?-W:W)?zn=0<1/W?0:2147483648:isNaN(W)?zn=2147483647:34028234663852886e22<W?zn=(P<<31|2139095040)>>>0:11754943508222875e-54>W?(W=Math.round(W/Math.pow(2,-149)),zn=(P<<31|W)>>>0):(k=Math.floor(Math.log(W)/Math.LN2),W*=Math.pow(2,-k),16777216<=(W=Math.round(8388608*W))&&++k,zn=(P<<31|k+127<<23|8388607&W)>>>0),_r(I,(P=zn)>>>0&255),_r(I,P>>>8&255),_r(I,P>>>16&255),_r(I,P>>>24&255)}}function ho(I,k,P){if(5!==I.h)return!1;var W=(I=I.g).h[I.g],Q=I.h[I.g+1],ce=I.h[I.g+2],ne=I.h[I.g+3];return I.g+=4,Di(I),I=2*((Q=(W<<0|Q<<8|ce<<16|ne<<24)>>>0)>>31)+1,W=Q>>>23&255,Q&=8388607,fn(k,P,255==W?Q?NaN:1/0*I:0==W?I*Math.pow(2,-149)*Q:I*Math.pow(2,W-150)*(Q+Math.pow(2,23))),!0}function Ho(I,k,P){if(0!==I.h)return!1;for(var W=I.g,Q=128,ce=0,ne=I=0;4>ne&&128<=Q;ne++)ce|=(127&(Q=W.h[W.g++]))<<7*ne;if(128<=Q&&(ce|=(127&(Q=W.h[W.g++]))<<28,I|=(127&Q)>>4),128<=Q)for(ne=0;5>ne&&128<=Q;ne++)I|=(127&(Q=W.h[W.g++]))<<7*ne+3;return 128>Q?(W=ce>>>0,(I=2147483648&(Q=I>>>0))&&(Q=~Q>>>0,0==(W=1+~W>>>0)&&(Q=Q+1>>>0)),W=4294967296*Q+(W>>>0),I=I?-W:W):(W.j=!0,Br(),I=void 0),fn(k,P,I),!0}function dg(I,k,P){return 0===I.h&&(fn(k,P,Uo(I.g)),!0)}function Pd(I,k,P){if(2!==I.h)return!1;var ce,W=Uo(I.g),Q=(I=I.g).g;if(I.g+=W,Di(I),I=I.h,di)(ce=ya)||(ce=ya=new TextDecoder("utf-8",{fatal:!1})),ce=ce.decode(I.subarray(Q,Q+W));else{W=Q+W;for(var be,ke,vt,ne=[],xe=null;Q<W;)128>(be=I[Q++])?ne.push(be):224>be?Q>=W?ne.push(65533):(ke=I[Q++],194>be||128!=(192&ke)?(Q--,ne.push(65533)):ne.push((31&be)<<6|63&ke)):240>be?Q>=W-1?ne.push(65533):128!=(192&(ke=I[Q++]))||224===be&&160>ke||237===be&&160<=ke||128!=(192&(ce=I[Q++]))?(Q--,ne.push(65533)):ne.push((15&be)<<12|(63&ke)<<6|63&ce):244>=be?Q>=W-2?ne.push(65533):128!=(192&(ke=I[Q++]))||ke-144+(be<<28)>>30!=0||128!=(192&(ce=I[Q++]))||128!=(192&(vt=I[Q++]))?(Q--,ne.push(65533)):(be=(7&be)<<18|(63&ke)<<12|(63&ce)<<6|63&vt,ne.push(55296+((be-=65536)>>10&1023),56320+(1023&be))):ne.push(65533),8192<=ne.length&&(xe=$r(xe,ne),ne.length=0);ce=$r(xe,ne)}return fn(k,P,ce),!0}function Fd(I,k,P,W,Q){if(2!==I.h)return!1;var ce=new W,ne=I.g.i,xe=Uo(I.g),be=I.g.g+xe;if(I.g.i=be,Q(ce,I),0!=(Q=be-I.g.g))throw Error("Message parsing ended unexpectedly. Expected to read "+xe+" bytes, instead read "+(xe-Q)+" bytes, either the data ended unexpectedly or the message misreported its own length");return I.g.g=be,I.g.i=ne,Si(k,P,ce,W,void 0),!0}function fo(I){ri.call(this,I)}function ks(I,k){var P=He(I,1);if(null!=P&&null!=P){wa(k.g,8);var W=k.g;if(0<=P)wa(W,P);else{for(var Q=0;9>Q;Q++)_r(W,127&P|128),P>>=7;_r(W,1)}}Ti(k,I,2),null!=(W=He(I,3))&&Xu(k,3,zu(W)),null!=(W=He(I,4))&&Xu(k,4,zu(W)),Os(I,k)}function Vc(I,k){return jr(I,k,jl||(jl={1:dg,2:ho,3:Pd,4:Pd}))}function Ce(I){ri.call(this,I,-1,ou)}function Et(I,k){return jr(I,k,Mi||(Mi={1:[Fd,fo,Vc]}))}ri.prototype.toJSON=function(){return $u(ht(this),qu)},ri.prototype.toString=function(){return ht(this).toString()},Vi(fo,ri),Vi(Ce,ri),Ce.prototype.addClassification=function(I,k){return Si(this,1,I,fo,k),this};var In,Ki,ou=[1];function Uc(I){ri.call(this,I)}function Ve(I,k){Ti(k,I,1),Ti(k,I,2),Ti(k,I,3),Ti(k,I,4),Ti(k,I,5),Os(I,k)}function nn(I,k){return jr(I,k,In||(In={1:ho,2:ho,3:ho,4:ho,5:ho}))}function ji(I){ri.call(this,I,-1,Er)}function Qu(I,k){return jr(I,k,Ki||(Ki={1:[Fd,Uc,nn]}))}Vi(Uc,ri),Vi(ji,ri);var jc,Er=[1];function Do(I){ri.call(this,I)}function er(I,k){Ti(k,I,1),Ti(k,I,2),Ti(k,I,3),Ti(k,I,4),Ti(k,I,5);var P=He(I,6);if(null!=P&&null!=P){wa(k.g,48);var W=k.g,Q=P;P=0>Q;var ce=(Q=Math.abs(Q))>>>0;for(Q=Math.floor((Q-ce)/4294967296),Q>>>=0,P&&(Q=~Q>>>0,4294967295<(ce=1+(~ce>>>0))&&(ce=0,4294967295<++Q&&(Q=0))),P=zn=ce,ce=Q;0<ce||127<P;)_r(W,127&P|128),P=(P>>>7|ce<<25)>>>0,ce>>>=7;_r(W,P)}Os(I,k)}function _a(I,k){return jr(I,k,jc||(jc={1:ho,2:ho,3:ho,4:ho,5:ho,6:Ho}))}function Wc(I,k,P){if(P=I.createShader(0===P?I.VERTEX_SHADER:I.FRAGMENT_SHADER),I.shaderSource(P,k),I.compileShader(P),!I.getShaderParameter(P,I.COMPILE_STATUS))throw Error("Could not compile WebGL shader.\n\n"+I.getShaderInfoLog(P));return P}function Ps(I){return Ku(I,fo,1).map(function(k){return{index:gr(k,1),X:Wo(k,2),label:null!=He(k,3)?ze(k,3):void 0,displayName:null!=He(k,4)?ze(k,4):void 0}})}function Pe(I){return{x:Wo(I,1),y:Wo(I,2),z:Wo(I,3),visibility:null!=He(I,4)?Wo(I,4):void 0}}function Ir(I){return Ku(Ul(I,ji,Qu),Uc,1).map(Pe)}function oe(I,k){this.h=I,this.g=k,this.l=0}function z(I,k,P){return function(I,k){var P=I.g;if(void 0===I.m){var W=Wc(P,"\n  attribute vec2 aVertex;\n  attribute vec2 aTex;\n  varying vec2 vTex;\n  void main(void) {\n    gl_Position = vec4(aVertex, 0.0, 1.0);\n    vTex = aTex;\n  }",0),Q=Wc(P,"\n  precision mediump float;\n  varying vec2 vTex;\n  uniform sampler2D sampler0;\n  void main(){\n    gl_FragColor = texture2D(sampler0, vTex);\n  }",1),ce=P.createProgram();if(P.attachShader(ce,W),P.attachShader(ce,Q),P.linkProgram(ce),!P.getProgramParameter(ce,P.LINK_STATUS))throw Error("Could not compile WebGL program.\n\n"+P.getProgramInfoLog(ce));W=I.m=ce,P.useProgram(W),Q=P.getUniformLocation(W,"sampler0"),I.j={I:P.getAttribLocation(W,"aVertex"),H:P.getAttribLocation(W,"aTex"),da:Q},I.s=P.createBuffer(),P.bindBuffer(P.ARRAY_BUFFER,I.s),P.enableVertexAttribArray(I.j.I),P.vertexAttribPointer(I.j.I,2,P.FLOAT,!1,0,0),P.bufferData(P.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),P.STATIC_DRAW),P.bindBuffer(P.ARRAY_BUFFER,null),I.o=P.createBuffer(),P.bindBuffer(P.ARRAY_BUFFER,I.o),P.enableVertexAttribArray(I.j.H),P.vertexAttribPointer(I.j.H,2,P.FLOAT,!1,0,0),P.bufferData(P.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),P.STATIC_DRAW),P.bindBuffer(P.ARRAY_BUFFER,null),P.uniform1i(Q,0)}W=I.j,P.useProgram(I.m),P.canvas.width=k.width,P.canvas.height=k.height,P.viewport(0,0,k.width,k.height),P.activeTexture(P.TEXTURE0),I.h.bindTexture2d(k.glName),P.enableVertexAttribArray(W.I),P.bindBuffer(P.ARRAY_BUFFER,I.s),P.vertexAttribPointer(W.I,2,P.FLOAT,!1,0,0),P.enableVertexAttribArray(W.H),P.bindBuffer(P.ARRAY_BUFFER,I.o),P.vertexAttribPointer(W.H,2,P.FLOAT,!1,0,0),P.bindFramebuffer(P.DRAW_FRAMEBUFFER?P.DRAW_FRAMEBUFFER:P.FRAMEBUFFER,null),P.clearColor(0,0,0,0),P.clear(P.COLOR_BUFFER_BIT),P.colorMask(!0,!0,!0,!0),P.drawArrays(P.TRIANGLE_FAN,0,4),P.disableVertexAttribArray(W.I),P.disableVertexAttribArray(W.H),P.bindBuffer(P.ARRAY_BUFFER,null),I.h.bindTexture2d(0)}(I,k),"function"==typeof I.g.canvas.transferToImageBitmap?Promise.resolve(I.g.canvas.transferToImageBitmap()):P?Promise.resolve(I.g.canvas):"function"==typeof createImageBitmap?createImageBitmap(I.g.canvas):(void 0===I.i&&(I.i=document.createElement("canvas")),new Promise(function(W){I.i.height=I.g.canvas.height,I.i.width=I.g.canvas.width,I.i.getContext("2d",{}).drawImage(I.g.canvas,0,0,I.g.canvas.width,I.g.canvas.height),W(I.i)}))}function Wr(I){this.g=I}Vi(Do,ri);var Dr=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function Qi(I,k){return k+I}function Hc(I,k){window[I]=k}function Zu(I){if(this.g=I,this.listeners={},this.j={},this.F={},this.m={},this.s={},this.G=this.o=this.R=!0,this.C=Promise.resolve(),this.P="",this.B={},this.locateFile=I&&I.locateFile||Qi,"object"==typeof window)var k=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else{if("undefined"==typeof location)throw Error("solutions can only be loaded on a web page or in a web worker");k=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/"}if(this.S=k,I.options)for(var P=(k=Lr(Object.keys(I.options))).next();!P.done;P=k.next()){var W=I.options[P=P.value].default;void 0!==W&&(this.j[P]="function"==typeof W?W():W)}}function Zt(I,k){var P,W;return Ae(function(Q){return k in I.F?Q.return(I.F[k]):(P=I.locateFile(k,""),W=fetch(P).then(function(ce){return ce.arrayBuffer()}),I.F[k]=W,Q.return(W))})}function Ca(I,k){for(var P=k.name||"$",W=[].concat(br(k.wants)),Q=new I.h.StringList,ce=Lr(k.wants),ne=ce.next();!ne.done;ne=ce.next())Q.push_back(ne.value);ce=I.h.PacketListener.implement({onResults:function(xe){for(var be={},ke=0;ke<k.wants.length;++ke)be[W[ke]]=xe.get(ke);var vt=I.listeners[P];vt&&(I.C=function(I,k,P){var W,Q,ce,ne,be,ke,vt,Tt,gt,Qe,Je,Ut;return Ae(function(Pt){switch(Pt.g){case 1:if(!P)return Pt.return(k);for(W={},Q=0,ce=Lr(Object.keys(P)),ne=ce.next();!ne.done;ne=ce.next())"string"!=typeof(be=P[ne.value])&&"texture"===be.type&&void 0!==k[be.stream]&&++Q;1<Q&&(I.G=!1),ke=Lr(Object.keys(P)),ne=ke.next();case 2:if(ne.done){Pt.g=4;break}if("string"==typeof(Tt=P[vt=ne.value]))return Je=W,Ut=vt,xt(Pt,function(I,k,P){var W;return Ae(function(Q){return"number"==typeof P||P instanceof Uint8Array||P instanceof I.h.Uint8BlobList?Q.return(P):P instanceof I.h.Texture2dDataOut?((W=I.s[k])||(W=new oe(I.h,I.D),I.s[k]=W),Q.return(z(W,P,I.G))):Q.return(void 0)})}(I,vt,k[Tt]),14);if(gt=k[Tt.stream],"detection_list"===Tt.type){if(gt){for(var tr=gt.getRectList(),Hr=gt.getLandmarksList(),Kn=gt.getClassificationsList(),pn=[],ot=0;ot<tr.size();++ot){var Ne=Ul(tr.get(ot),Do,_a);Ne={T:{Y:Wo(Ne,1),Z:Wo(Ne,2),height:Wo(Ne,3),width:Wo(Ne,4),rotation:Wo(Ne,5,0),W:gr(Ne,6)},O:Ir(Hr.get(ot)),M:Ps(Ul(Kn.get(ot),Ce,Et))},pn.push(Ne)}tr=pn}else tr=[];W[vt]=tr,Pt.g=7;break}if("proto_list"===Tt.type){if(gt){for(tr=Array(gt.size()),Hr=0;Hr<gt.size();Hr++)tr[Hr]=gt.get(Hr);gt.delete()}else tr=[];W[vt]=tr,Pt.g=7;break}if(void 0===gt){Pt.g=3;break}if("float_list"===Tt.type){W[vt]=gt,Pt.g=7;break}if("proto"===Tt.type){W[vt]=gt,Pt.g=7;break}if("texture"!==Tt.type)throw Error("Unknown output config type: '"+Tt.type+"'");return(Qe=I.s[vt])||(Qe=new oe(I.h,I.D),I.s[vt]=Qe),xt(Pt,z(Qe,gt,I.G),13);case 13:W[vt]=Pt.h;case 7:Tt.transform&&W[vt]&&(W[vt]=Tt.transform(W[vt])),Pt.g=3;break;case 14:Je[Ut]=Pt.h;case 3:ne=ke.next(),Pt.g=2;break;case 4:return Pt.return(W)}})}(I,be,k.outs).then(function(Tt){Tt=vt(Tt);for(var gt=0;gt<k.wants.length;++gt){var Qe=be[W[gt]];"object"==typeof Qe&&Qe.hasOwnProperty&&Qe.hasOwnProperty("delete")&&Qe.delete()}Tt&&(I.C=Tt)}))}}),I.i.attachMultiListener(Q,ce),Q.delete()}function ln(I){switch(void 0===I&&(I=0),I){case 1:return"pose_landmark_full.tflite";case 2:return"pose_landmark_heavy.tflite";default:return"pose_landmark_lite.tflite"}}function Ji(I){var k=this;this.g=new Zu({locateFile:(I=I||{}).locateFile,files:function(P){return[{url:"pose_solution_packed_assets_loader.js"},{simd:!1,url:"pose_solution_wasm_bin.js"},{simd:!0,url:"pose_solution_simd_wasm_bin.js"},{data:!0,url:ln(P.modelComplexity)}]},graph:{url:"pose_web.binarypb"},listeners:[{wants:["pose_landmarks","world_landmarks","segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},poseLandmarks:{type:"proto",stream:"pose_landmarks",transform:Ir},poseWorldLandmarks:{type:"proto",stream:"world_landmarks",transform:Ir},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelComplexity:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelComplexity",fieldName:"int_value"},onChange:function(P){var W,Q;return Ae(function(ne){return 1==ne.g?(W=ln(P),Q="third_party/mediapipe/modules/pose_landmark/"+W,xt(ne,Zt(k.g,W),2)):(k.g.overrideFile(Q,ne.h),ne.return(!0))})}},smoothLandmarks:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothLandmarks",fieldName:"bool_value"}},enableSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorEnableSegmentation",fieldName:"bool_value"}},smoothSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothSegmentation",fieldName:"bool_value"}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"poselandmarkgpu__posedetectiongpu__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"poselandmarkgpu__poselandmarkbyroigpu__tensorstoposelandmarksandsegmentation__ThresholdingCalculator",fieldName:"threshold"}}}})}(tn=Zu.prototype).close=function(){return this.i&&this.i.delete(),Promise.resolve()},tn.reset=function(){var I=this;return Ae(function(k){I.i&&(I.i.reset(),I.m={},I.s={}),k.g=0})},tn.setOptions=function(I,k){var P=this;if(k=k||this.g.options){for(var W=[],Q=[],ce={},ne=Lr(Object.keys(I)),xe=ne.next();!xe.done;ce={K:ce.K,L:ce.L},xe=ne.next()){var be=xe.value;be in this.j&&this.j[be]===I[be]||(this.j[be]=I[be],void 0!==(xe=k[be])&&(xe.onChange&&(ce.K=xe.onChange,ce.L=I[be],W.push(function(ke){return function(){return Ae(function(Tt){if(1==Tt.g)return xt(Tt,ke.K(ke.L),2);!0===Tt.h&&(P.o=!0),Tt.g=0})}}(ce))),xe.graphOptionXref&&(be={valueNumber:1===xe.type?I[be]:0,valueBoolean:0===xe.type&&I[be],valueString:2===xe.type?I[be]:""},xe=Object.assign(Object.assign(Object.assign({},{calculatorName:"",calculatorIndex:0}),xe.graphOptionXref),be),Q.push(xe))))}(0!==W.length||0!==Q.length)&&(this.o=!0,this.A=(void 0===this.A?[]:this.A).concat(Q),this.v=(void 0===this.v?[]:this.v).concat(W))}},tn.initialize=function(){var I=this;return Ae(function(k){return 1==k.g?xt(k,function(I){var k,P,W,Q,ce,ne,xe,be,ke,vt,Tt;return Ae(function(gt){switch(gt.g){case 1:return I.R?(k=void 0===I.g.files?[]:"function"==typeof I.g.files?I.g.files(I.j):I.g.files,xt(gt,Ae(function(I){switch(I.g){case 1:return I.m=2,xt(I,WebAssembly.instantiate(Dr),4);case 4:I.g=3,I.m=0;break;case 2:return I.m=0,I.j=null,I.return(!1);case 3:return I.return(!0)}}),2)):gt.return();case 2:if(P=gt.h,"object"==typeof window)return Hc("createMediapipeSolutionsWasm",{locateFile:I.locateFile}),Hc("createMediapipeSolutionsPackedAssets",{locateFile:I.locateFile}),ne=k.filter(function(Qe){return void 0!==Qe.data}),xe=k.filter(function(Qe){return void 0===Qe.data}),be=Promise.all(ne.map(function(Qe){var Mt=Zt(I,Qe.url);if(void 0!==Qe.path){var Je=Qe.path;Mt=Mt.then(function(Ut){return I.overrideFile(Je,Ut),Promise.resolve(Ut)})}return Mt})),ke=Promise.all(xe.map(function(Qe){return void 0===Qe.simd||Qe.simd&&P||!Qe.simd&&!P?function(I){var k=document.createElement("script");return k.setAttribute("src",I),k.setAttribute("crossorigin","anonymous"),new Promise(function(P){k.addEventListener("load",function(){P()},!1),k.addEventListener("error",function(){P()},!1),document.body.appendChild(k)})}(I.locateFile(Qe.url,I.S)):Promise.resolve()})).then(function(){var Qe,Mt,Je;return Ae(function(Ut){if(1==Ut.g)return Qe=window.createMediapipeSolutionsWasm,Mt=window.createMediapipeSolutionsPackedAssets,Je=I,xt(Ut,Qe(Mt),2);Je.h=Ut.h,Ut.g=0})}),vt=Ae(function(Qe){return I.g.graph&&I.g.graph.url?Qe=xt(Qe,Zt(I,I.g.graph.url),0):(Qe.g=0,Qe=void 0),Qe}),xt(gt,Promise.all([ke,be,vt]),7);if("function"!=typeof importScripts)throw Error("solutions can only be loaded on a web page or in a web worker");return W=k.filter(function(Qe){return void 0===Qe.simd||Qe.simd&&P||!Qe.simd&&!P}).map(function(Qe){return I.locateFile(Qe.url,I.S)}),importScripts.apply(null,br(W)),Q=I,xt(gt,createMediapipeSolutionsWasm(Module),6);case 6:Q.h=gt.h,I.l=new OffscreenCanvas(1,1),I.h.canvas=I.l,ce=I.h.GL.createContext(I.l,{antialias:!1,alpha:!1,ba:"undefined"!=typeof WebGL2RenderingContext?2:1}),I.h.GL.makeContextCurrent(ce),gt.g=4;break;case 7:if(I.l=document.createElement("canvas"),!(Tt=I.l.getContext("webgl2",{}))&&!(Tt=I.l.getContext("webgl",{})))return alert("Failed to create WebGL canvas context when passing video frame."),gt.return();I.D=Tt,I.h.canvas=I.l,I.h.createContext(I.l,!0,!0,{});case 4:I.i=new I.h.SolutionWasm,I.R=!1,gt.g=0}})}(I),2):3!=k.g?xt(k,function(I){var P,W,Q,ce,ne,be;return Ae(function(ke){if(1==ke.g)return I.g.graph&&I.g.graph.url&&I.P===I.g.graph.url?ke.return():(I.o=!0,I.g.graph&&I.g.graph.url?(I.P=I.g.graph.url,xt(ke,Zt(I,I.g.graph.url),3)):void(ke.g=2));for(2!=ke.g&&I.i.loadGraph(ke.h),P=Lr(Object.keys(I.B)),W=P.next();!W.done;W=P.next())I.i.overrideFile(Q=W.value,I.B[Q]);if(I.B={},I.g.listeners)for(ce=Lr(I.g.listeners),ne=ce.next();!ne.done;ne=ce.next())Ca(I,ne.value);be=I.j,I.j={},I.setOptions(be),ke.g=0})}(I),3):xt(k,function(I){var k,P,Q,ce,ne;return Ae(function(be){switch(be.g){case 1:if(!I.o)return be.return();if(!I.v){be.g=2;break}k=Lr(I.v),P=k.next();case 3:if(P.done){be.g=5;break}return xt(be,(0,P.value)(),4);case 4:P=k.next(),be.g=3;break;case 5:I.v=void 0;case 2:if(I.A){for(Q=new I.h.GraphOptionChangeRequestList,ce=Lr(I.A),ne=ce.next();!ne.done;ne=ce.next())Q.push_back(ne.value);I.i.changeOptions(Q),Q.delete(),I.A=void 0}I.o=!1,be.g=0}})}(I),0)})},tn.overrideFile=function(I,k){this.i?this.i.overrideFile(I,k):this.B[I]=k},tn.clearOverriddenFiles=function(){this.B={},this.i&&this.i.clearOverriddenFiles()},tn.send=function(I,k){var W,Q,ce,ne,xe,be,ke,vt,Tt,P=this;return Ae(function(gt){switch(gt.g){case 1:return P.g.inputs?(W=1e3*(null==k?performance.now():k),xt(gt,P.C,2)):gt.return();case 2:return xt(gt,P.initialize(),3);case 3:for(Q=new P.h.PacketDataList,ce=Lr(Object.keys(I)),ne=ce.next();!ne.done;ne=ce.next())if(be=P.g.inputs[xe=ne.value]){e:{var Qe=I[xe];switch(be.type){case"video":var Mt=P.m[be.stream];if(Mt||(Mt=new oe(P.h,P.D),P.m[be.stream]=Mt),0===Mt.l&&(Mt.l=Mt.h.createTexture()),"undefined"!=typeof HTMLVideoElement&&Qe instanceof HTMLVideoElement)var Je=Qe.videoWidth,Ut=Qe.videoHeight;else"undefined"!=typeof HTMLImageElement&&Qe instanceof HTMLImageElement?(Je=Qe.naturalWidth,Ut=Qe.naturalHeight):(Je=Qe.width,Ut=Qe.height);Ut={glName:Mt.l,width:Je,height:Ut},(Je=Mt.g).canvas.width=Ut.width,Je.canvas.height=Ut.height,Je.activeTexture(Je.TEXTURE0),Mt.h.bindTexture2d(Mt.l),Je.texImage2D(Je.TEXTURE_2D,0,Je.RGBA,Je.RGBA,Je.UNSIGNED_BYTE,Qe),Mt.h.bindTexture2d(0),Mt=Ut;break e;case"detections":for((Mt=P.m[be.stream])||(Mt=new Wr(P.h),P.m[be.stream]=Mt),Mt.data||(Mt.data=new Mt.g.DetectionListData),Mt.data.reset(Qe.length),Ut=0;Ut<Qe.length;++Ut){var Pt=Mt.data,tr=Pt.setBoundingBox,Hr=Ut,Kn=(Je=Qe[Ut]).T,pn=new Do;if(fn(pn,1,Kn.Y),fn(pn,2,Kn.Z),fn(pn,3,Kn.height),fn(pn,4,Kn.width),fn(pn,5,Kn.rotation),fn(pn,6,Kn.W),Kn=pi(pn,er),tr.call(Pt,Hr,Kn),Je.O)for(Pt=0;Pt<Je.O.length;++Pt){var ot=!!(pn=Je.O[Pt]).visibility;Hr=(tr=Mt.data).addNormalizedLandmark,Kn=Ut,pn=Object.assign(Object.assign({},pn),{visibility:ot?pn.visibility:0}),fn(ot=new Uc,1,pn.x),fn(ot,2,pn.y),fn(ot,3,pn.z),pn.visibility&&fn(ot,4,pn.visibility),pn=pi(ot,Ve),Hr.call(tr,Kn,pn)}if(Je.M)for(Pt=0;Pt<Je.M.length;++Pt)Hr=(tr=Mt.data).addClassification,Kn=Ut,pn=Je.M[Pt],fn(ot=new fo,2,pn.X),pn.index&&fn(ot,1,pn.index),pn.label&&fn(ot,3,pn.label),pn.displayName&&fn(ot,4,pn.displayName),pn=pi(ot,ks),Hr.call(tr,Kn,pn)}Mt=Mt.data;break e;default:Mt={}}}switch(ke=Mt,vt=be.stream,be.type){case"video":Q.pushTexture2d(Object.assign(Object.assign({},ke),{stream:vt,timestamp:W}));break;case"detections":(Tt=ke).stream=vt,Tt.timestamp=W,Q.pushDetectionList(Tt);break;default:throw Error("Unknown input config type: '"+be.type+"'")}}return P.i.send(Q),xt(gt,P.C,4);case 4:Q.delete(),gt.g=0}})},tn.onResults=function(I,k){this.listeners[k||"$"]=I},ie("Solution",Zu),ie("OptionType",{BOOL:0,NUMBER:1,$:2,0:"BOOL",1:"NUMBER",2:"STRING"}),(tn=Ji.prototype).reset=function(){this.g.reset()},tn.close=function(){return this.g.close(),Promise.resolve()},tn.onResults=function(I){this.g.onResults(I)},tn.initialize=function(){var I=this;return Ae(function(k){return xt(k,I.g.initialize(),0)})},tn.send=function(I,k){var P=this;return Ae(function(W){return xt(W,P.g.send(I,k),0)})},tn.setOptions=function(I){this.g.setOptions(I)},ie("Pose",Ji),ie("POSE_CONNECTIONS",[[0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]]),ie("POSE_LANDMARKS",{NOSE:0,LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,LEFT_EAR:7,RIGHT_EAR:8,LEFT_RIGHT:9,RIGHT_LEFT:10,LEFT_SHOULDER:11,RIGHT_SHOULDER:12,LEFT_ELBOW:13,RIGHT_ELBOW:14,LEFT_WRIST:15,RIGHT_WRIST:16,LEFT_PINKY:17,RIGHT_PINKY:18,LEFT_INDEX:19,RIGHT_INDEX:20,LEFT_THUMB:21,RIGHT_THUMB:22,LEFT_HIP:23,RIGHT_HIP:24,LEFT_KNEE:25,RIGHT_KNEE:26,LEFT_ANKLE:27,RIGHT_ANKLE:28,LEFT_HEEL:29,RIGHT_HEEL:30,LEFT_FOOT_INDEX:31,RIGHT_FOOT_INDEX:32}),ie("POSE_LANDMARKS_LEFT",{LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,LEFT_EAR:7,LEFT_RIGHT:9,LEFT_SHOULDER:11,LEFT_ELBOW:13,LEFT_WRIST:15,LEFT_PINKY:17,LEFT_INDEX:19,LEFT_THUMB:21,LEFT_HIP:23,LEFT_KNEE:25,LEFT_ANKLE:27,LEFT_HEEL:29,LEFT_FOOT_INDEX:31}),ie("POSE_LANDMARKS_RIGHT",{RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,RIGHT_EAR:8,RIGHT_LEFT:10,RIGHT_SHOULDER:12,RIGHT_ELBOW:14,RIGHT_WRIST:16,RIGHT_PINKY:18,RIGHT_INDEX:20,RIGHT_THUMB:22,RIGHT_HIP:24,RIGHT_KNEE:26,RIGHT_ANKLE:28,RIGHT_HEEL:30,RIGHT_FOOT_INDEX:32}),ie("POSE_LANDMARKS_NEUTRAL",{NOSE:0}),ie("VERSION","0.5.1635988162")}).call(this)},65:function(tn,$n){!function(me){"use strict";var ar=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,l){S.__proto__=l}||function(S,l){for(var h in l)l.hasOwnProperty(h)&&(S[h]=l[h])};var Lr=function(S){function l(h){var f=this.constructor,g=S.call(this,h)||this;return Object.defineProperty(g,"name",{value:f.name,enumerable:!1}),function(S,l){var h=Object.setPrototypeOf;h?h(S,l):S.__proto__=l}(g,f.prototype),function(S,l){void 0===l&&(l=S.constructor);var h=Error.captureStackTrace;h&&h(S,l)}(g),g}return function(S,l){function h(){this.constructor=S}ar(S,l),S.prototype=null===l?Object.create(l):(h.prototype=l.prototype,new h)}(l,S),l}(Error);let br=(()=>{class S extends Lr{constructor(h){super(h),this.message=h}getKind(){return this.constructor.kind}}return S.kind="Exception",S})(),hi=(()=>{class S extends br{}return S.kind="ArgumentException",S})(),Ke=(()=>{class S extends br{}return S.kind="IllegalArgumentException",S})();class Bi{constructor(l){if(this.binarizer=l,null===l)throw new Ke("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(l,h){return this.binarizer.getBlackRow(l,h)}getBlackMatrix(){return null==this.matrix&&(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(l,h,f,g){const v=this.binarizer.getLuminanceSource().crop(l,h,f,g);return new Bi(this.binarizer.createBinarizer(v))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const l=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new Bi(this.binarizer.createBinarizer(l))}rotateCounterClockwise45(){const l=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new Bi(this.binarizer.createBinarizer(l))}toString(){try{return this.getBlackMatrix().toString()}catch(l){return""}}}let At=(()=>{class S extends br{static getChecksumInstance(){return new S}}return S.kind="ChecksumException",S})();class va{constructor(l){this.source=l}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class $t{static arraycopy(l,h,f,g,v){for(;v--;)f[g++]=l[h++]}static currentTimeMillis(){return Date.now()}}let Vi=(()=>{class S extends br{}return S.kind="IndexOutOfBoundsException",S})(),Pn=(()=>{class S extends Vi{constructor(h,f){super(f),this.index=h,this.message=f}}return S.kind="ArrayIndexOutOfBoundsException",S})();class Cn{static fill(l,h){for(let f=0,g=l.length;f<g;f++)l[f]=h}static fillWithin(l,h,f,g){Cn.rangeCheck(l.length,h,f);for(let v=h;v<f;v++)l[v]=g}static rangeCheck(l,h,f){if(h>f)throw new Ke("fromIndex("+h+") > toIndex("+f+")");if(h<0)throw new Pn(h);if(f>l)throw new Pn(f)}static asList(...l){return l}static create(l,h,f){return Array.from({length:l}).map(v=>Array.from({length:h}).fill(f))}static createInt32Array(l,h,f){return Array.from({length:l}).map(v=>Int32Array.from({length:h}).fill(f))}static equals(l,h){if(!(l&&h&&l.length&&h.length&&l.length===h.length))return!1;for(let f=0,g=l.length;f<g;f++)if(l[f]!==h[f])return!1;return!0}static hashCode(l){if(null===l)return 0;let h=1;for(const f of l)h=31*h+f;return h}static fillUint8Array(l,h){for(let f=0;f!==l.length;f++)l[f]=h}static copyOf(l,h){return l.slice(0,h)}static copyOfUint8Array(l,h){if(l.length<=h){const f=new Uint8Array(h);return f.set(l),f}return l.slice(0,h)}static copyOfRange(l,h,f){const g=f-h,v=new Int32Array(g);return $t.arraycopy(l,h,v,0,g),v}static binarySearch(l,h,f){void 0===f&&(f=Cn.numberComparator);let g=0,v=l.length-1;for(;g<=v;){const x=v+g>>1,b=f(h,l[x]);if(b>0)g=x+1;else{if(!(b<0))return x;v=x-1}}return-g-1}static numberComparator(l,h){return l-h}}class Dt{static numberOfTrailingZeros(l){let h;if(0===l)return 32;let f=31;return h=l<<16,0!==h&&(f-=16,l=h),h=l<<8,0!==h&&(f-=8,l=h),h=l<<4,0!==h&&(f-=4,l=h),h=l<<2,0!==h&&(f-=2,l=h),f-(l<<1>>>31)}static numberOfLeadingZeros(l){if(0===l)return 32;let h=1;return l>>>16==0&&(h+=16,l<<=16),l>>>24==0&&(h+=8,l<<=8),l>>>28==0&&(h+=4,l<<=4),l>>>30==0&&(h+=2,l<<=2),h-=l>>>31,h}static toHexString(l){return l.toString(16)}static toBinaryString(l){return String(parseInt(String(l),2))}static bitCount(l){return l=(l=(858993459&(l-=l>>>1&1431655765))+(l>>>2&858993459))+(l>>>4)&252645135,63&(l+=l>>>8)+(l>>>16)}static truncDivision(l,h){return Math.trunc(l/h)}static parseInt(l,h){return parseInt(l,h)}}Dt.MIN_VALUE_32_BITS=-2147483648,Dt.MAX_VALUE=Number.MAX_SAFE_INTEGER;class xt{constructor(l,h){void 0===l?(this.size=0,this.bits=new Int32Array(1)):(this.size=l,this.bits=null==h?xt.makeArray(l):h)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(l){if(l>32*this.bits.length){const h=xt.makeArray(l);$t.arraycopy(this.bits,0,h,0,this.bits.length),this.bits=h}}get(l){return 0!=(this.bits[Math.floor(l/32)]&1<<(31&l))}set(l){this.bits[Math.floor(l/32)]|=1<<(31&l)}flip(l){this.bits[Math.floor(l/32)]^=1<<(31&l)}getNextSet(l){const h=this.size;if(l>=h)return h;const f=this.bits;let g=Math.floor(l/32),v=f[g];v&=~((1<<(31&l))-1);const x=f.length;for(;0===v;){if(++g===x)return h;v=f[g]}const b=32*g+Dt.numberOfTrailingZeros(v);return b>h?h:b}getNextUnset(l){const h=this.size;if(l>=h)return h;const f=this.bits;let g=Math.floor(l/32),v=~f[g];v&=~((1<<(31&l))-1);const x=f.length;for(;0===v;){if(++g===x)return h;v=~f[g]}const b=32*g+Dt.numberOfTrailingZeros(v);return b>h?h:b}setBulk(l,h){this.bits[Math.floor(l/32)]=h}setRange(l,h){if(h<l||l<0||h>this.size)throw new Ke;if(h===l)return;h--;const f=Math.floor(l/32),g=Math.floor(h/32),v=this.bits;for(let x=f;x<=g;x++)v[x]|=(2<<(x<g?31:31&h))-(1<<(x>f?0:31&l))}clear(){const l=this.bits.length,h=this.bits;for(let f=0;f<l;f++)h[f]=0}isRange(l,h,f){if(h<l||l<0||h>this.size)throw new Ke;if(h===l)return!0;h--;const g=Math.floor(l/32),v=Math.floor(h/32),x=this.bits;for(let b=g;b<=v;b++){const R=(2<<(b<v?31:31&h))-(1<<(b>g?0:31&l))&4294967295;if((x[b]&R)!==(f?R:0))return!1}return!0}appendBit(l){this.ensureCapacity(this.size+1),l&&(this.bits[Math.floor(this.size/32)]|=1<<(31&this.size)),this.size++}appendBits(l,h){if(h<0||h>32)throw new Ke("Num bits must be between 0 and 32");this.ensureCapacity(this.size+h);for(let f=h;f>0;f--)this.appendBit(1==(l>>f-1&1))}appendBitArray(l){const h=l.size;this.ensureCapacity(this.size+h);for(let f=0;f<h;f++)this.appendBit(l.get(f))}xor(l){if(this.size!==l.size)throw new Ke("Sizes don't match");const h=this.bits;for(let f=0,g=h.length;f<g;f++)h[f]^=l.bits[f]}toBytes(l,h,f,g){for(let v=0;v<g;v++){let x=0;for(let b=0;b<8;b++)this.get(l)&&(x|=1<<7-b),l++;h[f+v]=x}}getBitArray(){return this.bits}reverse(){const l=new Int32Array(this.bits.length),h=Math.floor((this.size-1)/32),f=h+1,g=this.bits;for(let v=0;v<f;v++){let x=g[v];x=x>>1&1431655765|(1431655765&x)<<1,x=x>>2&858993459|(858993459&x)<<2,x=x>>4&252645135|(252645135&x)<<4,x=x>>8&16711935|(16711935&x)<<8,x=x>>16&65535|(65535&x)<<16,l[h-v]=x}if(this.size!==32*f){const v=32*f-this.size;let x=l[0]>>>v;for(let b=1;b<f;b++){const E=l[b];x|=E<<32-v,l[b-1]=x,x=E>>>v}l[f-1]=x}this.bits=l}static makeArray(l){return new Int32Array(Math.floor((l+31)/32))}equals(l){return l instanceof xt&&this.size===l.size&&Cn.equals(this.bits,l.bits)}hashCode(){return 31*this.size+Cn.hashCode(this.bits)}toString(){let l="";for(let h=0,f=this.size;h<f;h++)0==(7&h)&&(l+=" "),l+=this.get(h)?"X":".";return l}clone(){return new xt(this.size,this.bits.slice())}}var lo=(()=>{return(S=lo||(lo={}))[S.OTHER=0]="OTHER",S[S.PURE_BARCODE=1]="PURE_BARCODE",S[S.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",S[S.TRY_HARDER=3]="TRY_HARDER",S[S.CHARACTER_SET=4]="CHARACTER_SET",S[S.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",S[S.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",S[S.ASSUME_GS1=7]="ASSUME_GS1",S[S.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",S[S.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",S[S.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS",lo;var S})(),yn=lo;let Re=(()=>{class S extends br{static getFormatInstance(){return new S}}return S.kind="FormatException",S})();var Yt=(()=>{return(S=Yt||(Yt={}))[S.Cp437=0]="Cp437",S[S.ISO8859_1=1]="ISO8859_1",S[S.ISO8859_2=2]="ISO8859_2",S[S.ISO8859_3=3]="ISO8859_3",S[S.ISO8859_4=4]="ISO8859_4",S[S.ISO8859_5=5]="ISO8859_5",S[S.ISO8859_6=6]="ISO8859_6",S[S.ISO8859_7=7]="ISO8859_7",S[S.ISO8859_8=8]="ISO8859_8",S[S.ISO8859_9=9]="ISO8859_9",S[S.ISO8859_10=10]="ISO8859_10",S[S.ISO8859_11=11]="ISO8859_11",S[S.ISO8859_13=12]="ISO8859_13",S[S.ISO8859_14=13]="ISO8859_14",S[S.ISO8859_15=14]="ISO8859_15",S[S.ISO8859_16=15]="ISO8859_16",S[S.SJIS=16]="SJIS",S[S.Cp1250=17]="Cp1250",S[S.Cp1251=18]="Cp1251",S[S.Cp1252=19]="Cp1252",S[S.Cp1256=20]="Cp1256",S[S.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",S[S.UTF8=22]="UTF8",S[S.ASCII=23]="ASCII",S[S.Big5=24]="Big5",S[S.GB18030=25]="GB18030",S[S.EUC_KR=26]="EUC_KR",Yt;var S})();class ee{constructor(l,h,f,...g){this.valueIdentifier=l,this.name=f,this.values="number"==typeof h?Int32Array.from([h]):h,this.otherEncodingNames=g,ee.VALUE_IDENTIFIER_TO_ECI.set(l,this),ee.NAME_TO_ECI.set(f,this);const v=this.values;for(let x=0,b=v.length;x!==b;x++)ee.VALUES_TO_ECI.set(v[x],this);for(const x of g)ee.NAME_TO_ECI.set(x,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(l){if(l<0||l>=900)throw new Re("incorect value");const h=ee.VALUES_TO_ECI.get(l);if(void 0===h)throw new Re("incorect value");return h}static getCharacterSetECIByName(l){const h=ee.NAME_TO_ECI.get(l);if(void 0===h)throw new Re("incorect value");return h}equals(l){if(!(l instanceof ee))return!1;const h=l;return this.getName()===h.getName()}}ee.VALUE_IDENTIFIER_TO_ECI=new Map,ee.VALUES_TO_ECI=new Map,ee.NAME_TO_ECI=new Map,ee.Cp437=new ee(Yt.Cp437,Int32Array.from([0,2]),"Cp437"),ee.ISO8859_1=new ee(Yt.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),ee.ISO8859_2=new ee(Yt.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),ee.ISO8859_3=new ee(Yt.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),ee.ISO8859_4=new ee(Yt.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),ee.ISO8859_5=new ee(Yt.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),ee.ISO8859_6=new ee(Yt.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),ee.ISO8859_7=new ee(Yt.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),ee.ISO8859_8=new ee(Yt.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),ee.ISO8859_9=new ee(Yt.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),ee.ISO8859_10=new ee(Yt.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),ee.ISO8859_11=new ee(Yt.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),ee.ISO8859_13=new ee(Yt.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),ee.ISO8859_14=new ee(Yt.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),ee.ISO8859_15=new ee(Yt.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),ee.ISO8859_16=new ee(Yt.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),ee.SJIS=new ee(Yt.SJIS,20,"SJIS","Shift_JIS"),ee.Cp1250=new ee(Yt.Cp1250,21,"Cp1250","windows-1250"),ee.Cp1251=new ee(Yt.Cp1251,22,"Cp1251","windows-1251"),ee.Cp1252=new ee(Yt.Cp1252,23,"Cp1252","windows-1252"),ee.Cp1256=new ee(Yt.Cp1256,24,"Cp1256","windows-1256"),ee.UnicodeBigUnmarked=new ee(Yt.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),ee.UTF8=new ee(Yt.UTF8,26,"UTF8","UTF-8"),ee.ASCII=new ee(Yt.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),ee.Big5=new ee(Yt.Big5,28,"Big5"),ee.GB18030=new ee(Yt.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),ee.EUC_KR=new ee(Yt.EUC_KR,30,"EUC_KR","EUC-KR");let Fe=(()=>{class S extends br{}return S.kind="UnsupportedOperationException",S})();class Ae{static decode(l,h){const f=this.encodingName(h);return this.customDecoder?this.customDecoder(l,f):"undefined"==typeof TextDecoder||this.shouldDecodeOnFallback(f)?this.decodeFallback(l,f):new TextDecoder(f).decode(l)}static shouldDecodeOnFallback(l){return!Ae.isBrowser()&&"ISO-8859-1"===l}static encode(l,h){const f=this.encodingName(h);return this.customEncoder?this.customEncoder(l,f):"undefined"==typeof TextEncoder?this.encodeFallback(l):(new TextEncoder).encode(l)}static isBrowser(){return"undefined"!=typeof window&&"[object Window]"==={}.toString.call(window)}static encodingName(l){return"string"==typeof l?l:l.getName()}static encodingCharacterSet(l){return l instanceof ee?l:ee.getCharacterSetECIByName(l)}static decodeFallback(l,h){const f=this.encodingCharacterSet(h);if(Ae.isDecodeFallbackSupported(f)){let g="";for(let v=0,x=l.length;v<x;v++){let b=l[v].toString(16);b.length<2&&(b="0"+b),g+="%"+b}return decodeURIComponent(g)}if(f.equals(ee.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(l.buffer));throw new Fe(`Encoding ${this.encodingName(h)} not supported by fallback.`)}static isDecodeFallbackSupported(l){return l.equals(ee.UTF8)||l.equals(ee.ISO8859_1)||l.equals(ee.ASCII)}static encodeFallback(l){const f=btoa(unescape(encodeURIComponent(l))).split(""),g=[];for(let v=0;v<f.length;v++)g.push(f[v].charCodeAt(0));return new Uint8Array(g)}}class _e{static castAsNonUtf8Char(l,h=null){const f=h?h.getName():this.ISO88591;return Ae.decode(new Uint8Array([l]),f)}static guessEncoding(l,h){if(null!=h&&void 0!==h.get(yn.CHARACTER_SET))return h.get(yn.CHARACTER_SET).toString();const f=l.length;let g=!0,v=!0,x=!0,b=0,E=0,D=0,R=0,F=0,B=0,Y=0,q=0,te=0,re=0,ae=0;const Te=l.length>3&&239===l[0]&&187===l[1]&&191===l[2];for(let Le=0;Le<f&&(g||v||x);Le++){const ve=255&l[Le];x&&(b>0?0==(128&ve)?x=!1:b--:0!=(128&ve)&&(0==(64&ve)?x=!1:(b++,0==(32&ve)?E++:(b++,0==(16&ve)?D++:(b++,0==(8&ve)?R++:x=!1))))),g&&(ve>127&&ve<160?g=!1:ve>159&&(ve<192||215===ve||247===ve)&&ae++),v&&(F>0?ve<64||127===ve||ve>252?v=!1:F--:128===ve||160===ve||ve>239?v=!1:ve>160&&ve<224?(B++,q=0,Y++,Y>te&&(te=Y)):ve>127?(F++,Y=0,q++,q>re&&(re=q)):(Y=0,q=0))}return x&&b>0&&(x=!1),v&&F>0&&(v=!1),x&&(Te||E+D+R>0)?_e.UTF8:v&&(_e.ASSUME_SHIFT_JIS||te>=3||re>=3)?_e.SHIFT_JIS:g&&v?2===te&&2===B||10*ae>=f?_e.SHIFT_JIS:_e.ISO88591:g?_e.ISO88591:v?_e.SHIFT_JIS:x?_e.UTF8:_e.PLATFORM_DEFAULT_ENCODING}static format(l,...h){let f=-1;return l.replace(/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g,function(x,b,E,D,R,F){if("%%"===x)return"%";if(void 0===h[++f])return;x=D?parseInt(D.substr(1)):void 0;let Y,B=R?parseInt(R.substr(1)):void 0;switch(F){case"s":Y=h[f];break;case"c":Y=h[f][0];break;case"f":Y=parseFloat(h[f]).toFixed(x);break;case"p":Y=parseFloat(h[f]).toPrecision(x);break;case"e":Y=parseFloat(h[f]).toExponential(x);break;case"x":Y=parseInt(h[f]).toString(B||16);break;case"d":Y=parseFloat(parseInt(h[f],B||10).toPrecision(x)).toFixed(0)}Y="object"==typeof Y?JSON.stringify(Y):(+Y).toString(B);let q=parseInt(E),te=E&&E[0]+""=="0"?"0":" ";for(;Y.length<q;)Y=void 0!==b?Y+te:te+Y;return Y})}static getBytes(l,h){return Ae.encode(l,h)}static getCharCode(l,h=0){return l.charCodeAt(h)}static getCharAt(l){return String.fromCharCode(l)}}_e.SHIFT_JIS=ee.SJIS.getName(),_e.GB2312="GB2312",_e.ISO88591=ee.ISO8859_1.getName(),_e.EUC_JP="EUC_JP",_e.UTF8=ee.UTF8.getName(),_e.PLATFORM_DEFAULT_ENCODING=_e.UTF8,_e.ASSUME_SHIFT_JIS=!1;class Oe{constructor(l=""){this.value=l}enableDecoding(l){return this.encoding=l,this}append(l){return this.value+="string"==typeof l?l.toString():this.encoding?_e.castAsNonUtf8Char(l,this.encoding):String.fromCharCode(l),this}appendChars(l,h,f){for(let g=h;h<h+f;g++)this.append(l[g]);return this}length(){return this.value.length}charAt(l){return this.value.charAt(l)}deleteCharAt(l){this.value=this.value.substr(0,l)+this.value.substring(l+1)}setCharAt(l,h){this.value=this.value.substr(0,l)+h+this.value.substr(l+1)}substring(l,h){return this.value.substring(l,h)}setLengthToZero(){this.value=""}toString(){return this.value}insert(l,h){this.value=this.value.substr(0,l)+h+this.value.substr(l+h.length)}}class bt{constructor(l,h,f,g){if(this.width=l,this.height=h,this.rowSize=f,this.bits=g,null==h&&(h=l),this.height=h,l<1||h<1)throw new Ke("Both dimensions must be greater than 0");null==f&&(f=Math.floor((l+31)/32)),this.rowSize=f,null==g&&(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(l){const h=l.length,f=l[0].length,g=new bt(f,h);for(let v=0;v<h;v++){const x=l[v];for(let b=0;b<f;b++)x[b]&&g.set(b,v)}return g}static parseFromString(l,h,f){if(null===l)throw new Ke("stringRepresentation cannot be null");const g=new Array(l.length);let v=0,x=0,b=-1,E=0,D=0;for(;D<l.length;)if("\n"===l.charAt(D)||"\r"===l.charAt(D)){if(v>x){if(-1===b)b=v-x;else if(v-x!==b)throw new Ke("row lengths do not match");x=v,E++}D++}else if(l.substring(D,D+h.length)===h)D+=h.length,g[v]=!0,v++;else{if(l.substring(D,D+f.length)!==f)throw new Ke("illegal character encountered: "+l.substring(D));D+=f.length,g[v]=!1,v++}if(v>x){if(-1===b)b=v-x;else if(v-x!==b)throw new Ke("row lengths do not match");E++}const R=new bt(b,E);for(let F=0;F<v;F++)g[F]&&R.set(Math.floor(F%b),Math.floor(F/b));return R}get(l,h){const f=h*this.rowSize+Math.floor(l/32);return 0!=(this.bits[f]>>>(31&l)&1)}set(l,h){const f=h*this.rowSize+Math.floor(l/32);this.bits[f]|=1<<(31&l)&4294967295}unset(l,h){const f=h*this.rowSize+Math.floor(l/32);this.bits[f]&=~(1<<(31&l)&4294967295)}flip(l,h){const f=h*this.rowSize+Math.floor(l/32);this.bits[f]^=1<<(31&l)&4294967295}xor(l){if(this.width!==l.getWidth()||this.height!==l.getHeight()||this.rowSize!==l.getRowSize())throw new Ke("input matrix dimensions do not match");const h=new xt(Math.floor(this.width/32)+1),f=this.rowSize,g=this.bits;for(let v=0,x=this.height;v<x;v++){const b=v*f,E=l.getRow(v,h).getBitArray();for(let D=0;D<f;D++)g[b+D]^=E[D]}}clear(){const l=this.bits,h=l.length;for(let f=0;f<h;f++)l[f]=0}setRegion(l,h,f,g){if(h<0||l<0)throw new Ke("Left and top must be nonnegative");if(g<1||f<1)throw new Ke("Height and width must be at least 1");const v=l+f,x=h+g;if(x>this.height||v>this.width)throw new Ke("The region must fit inside the matrix");const b=this.rowSize,E=this.bits;for(let D=h;D<x;D++){const R=D*b;for(let F=l;F<v;F++)E[R+Math.floor(F/32)]|=1<<(31&F)&4294967295}}getRow(l,h){null==h||h.getSize()<this.width?h=new xt(this.width):h.clear();const f=this.rowSize,g=this.bits,v=l*f;for(let x=0;x<f;x++)h.setBulk(32*x,g[v+x]);return h}setRow(l,h){$t.arraycopy(h.getBitArray(),0,this.bits,l*this.rowSize,this.rowSize)}rotate180(){const l=this.getWidth(),h=this.getHeight();let f=new xt(l),g=new xt(l);for(let v=0,x=Math.floor((h+1)/2);v<x;v++)f=this.getRow(v,f),g=this.getRow(h-1-v,g),f.reverse(),g.reverse(),this.setRow(v,g),this.setRow(h-1-v,f)}getEnclosingRectangle(){const h=this.height,f=this.rowSize,g=this.bits;let v=this.width,x=h,b=-1,E=-1;for(let D=0;D<h;D++)for(let R=0;R<f;R++){const F=g[D*f+R];if(0!==F){if(D<x&&(x=D),D>E&&(E=D),32*R<v){let B=0;for(;0==(F<<31-B&4294967295);)B++;32*R+B<v&&(v=32*R+B)}if(32*R+31>b){let B=31;for(;F>>>B==0;)B--;32*R+B>b&&(b=32*R+B)}}}return b<v||E<x?null:Int32Array.from([v,x,b-v+1,E-x+1])}getTopLeftOnBit(){const l=this.rowSize,h=this.bits;let f=0;for(;f<h.length&&0===h[f];)f++;if(f===h.length)return null;const g=f/l;let v=f%l*32;const x=h[f];let b=0;for(;0==(x<<31-b&4294967295);)b++;return v+=b,Int32Array.from([v,g])}getBottomRightOnBit(){const l=this.rowSize,h=this.bits;let f=h.length-1;for(;f>=0&&0===h[f];)f--;if(f<0)return null;const g=Math.floor(f/l);let v=32*Math.floor(f%l);const x=h[f];let b=31;for(;x>>>b==0;)b--;return v+=b,Int32Array.from([v,g])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(l){return l instanceof bt&&this.width===l.width&&this.height===l.height&&this.rowSize===l.rowSize&&Cn.equals(this.bits,l.bits)}hashCode(){let l=this.width;return l=31*l+this.width,l=31*l+this.height,l=31*l+this.rowSize,l=31*l+Cn.hashCode(this.bits),l}toString(l="X ",h="  ",f="\n"){return this.buildToString(l,h,f)}buildToString(l,h,f){let g=new Oe;for(let v=0,x=this.height;v<x;v++){for(let b=0,E=this.width;b<E;b++)g.append(this.get(b,v)?l:h);g.append(f)}return g.toString()}clone(){return new bt(this.width,this.height,this.rowSize,this.bits.slice())}}let ie=(()=>{class S extends br{static getNotFoundInstance(){return new S}}return S.kind="NotFoundException",S})();class jn extends va{constructor(l){super(l),this.luminances=jn.EMPTY,this.buckets=new Int32Array(jn.LUMINANCE_BUCKETS)}getBlackRow(l,h){const f=this.getLuminanceSource(),g=f.getWidth();null==h||h.getSize()<g?h=new xt(g):h.clear(),this.initArrays(g);const v=f.getRow(l,this.luminances),x=this.buckets;for(let E=0;E<g;E++)x[(255&v[E])>>jn.LUMINANCE_SHIFT]++;const b=jn.estimateBlackPoint(x);if(g<3)for(let E=0;E<g;E++)(255&v[E])<b&&h.set(E);else{let E=255&v[0],D=255&v[1];for(let R=1;R<g-1;R++){const F=255&v[R+1];(4*D-E-F)/2<b&&h.set(R),E=D,D=F}}return h}getBlackMatrix(){const l=this.getLuminanceSource(),h=l.getWidth(),f=l.getHeight(),g=new bt(h,f);this.initArrays(h);const v=this.buckets;for(let E=1;E<5;E++){const D=Math.floor(f*E/5),R=l.getRow(D,this.luminances),F=Math.floor(4*h/5);for(let B=Math.floor(h/5);B<F;B++)v[(255&R[B])>>jn.LUMINANCE_SHIFT]++}const x=jn.estimateBlackPoint(v),b=l.getMatrix();for(let E=0;E<f;E++){const D=E*h;for(let R=0;R<h;R++)(255&b[D+R])<x&&g.set(R,E)}return g}createBinarizer(l){return new jn(l)}initArrays(l){this.luminances.length<l&&(this.luminances=new Uint8ClampedArray(l));const h=this.buckets;for(let f=0;f<jn.LUMINANCE_BUCKETS;f++)h[f]=0}static estimateBlackPoint(l){const h=l.length;let f=0,g=0,v=0;for(let R=0;R<h;R++)l[R]>v&&(g=R,v=l[R]),l[R]>f&&(f=l[R]);let x=0,b=0;for(let R=0;R<h;R++){const F=R-g,B=l[R]*F*F;B>b&&(x=R,b=B)}if(g>x){const R=g;g=x,x=R}if(x-g<=h/16)throw new ie;let E=x-1,D=-1;for(let R=x-1;R>g;R--){const F=R-g,B=F*F*(x-R)*(f-l[R]);B>D&&(E=R,D=B)}return E<<jn.LUMINANCE_SHIFT}}jn.LUMINANCE_BITS=5,jn.LUMINANCE_SHIFT=8-jn.LUMINANCE_BITS,jn.LUMINANCE_BUCKETS=1<<jn.LUMINANCE_BITS,jn.EMPTY=Uint8ClampedArray.from([0]);class ft extends jn{constructor(l){super(l),this.matrix=null}getBlackMatrix(){if(null!==this.matrix)return this.matrix;const l=this.getLuminanceSource(),h=l.getWidth(),f=l.getHeight();if(h>=ft.MINIMUM_DIMENSION&&f>=ft.MINIMUM_DIMENSION){const g=l.getMatrix();let v=h>>ft.BLOCK_SIZE_POWER;0!=(h&ft.BLOCK_SIZE_MASK)&&v++;let x=f>>ft.BLOCK_SIZE_POWER;0!=(f&ft.BLOCK_SIZE_MASK)&&x++;const b=ft.calculateBlackPoints(g,v,x,h,f),E=new bt(h,f);ft.calculateThresholdForBlock(g,v,x,h,f,b,E),this.matrix=E}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(l){return new ft(l)}static calculateThresholdForBlock(l,h,f,g,v,x,b){const E=v-ft.BLOCK_SIZE,D=g-ft.BLOCK_SIZE;for(let R=0;R<f;R++){let F=R<<ft.BLOCK_SIZE_POWER;F>E&&(F=E);const B=ft.cap(R,2,f-3);for(let Y=0;Y<h;Y++){let q=Y<<ft.BLOCK_SIZE_POWER;q>D&&(q=D);const te=ft.cap(Y,2,h-3);let re=0;for(let Te=-2;Te<=2;Te++){const Le=x[B+Te];re+=Le[te-2]+Le[te-1]+Le[te]+Le[te+1]+Le[te+2]}ft.thresholdBlock(l,q,F,re/25,g,b)}}}static cap(l,h,f){return l<h?h:l>f?f:l}static thresholdBlock(l,h,f,g,v,x){for(let b=0,E=f*v+h;b<ft.BLOCK_SIZE;b++,E+=v)for(let D=0;D<ft.BLOCK_SIZE;D++)(255&l[E+D])<=g&&x.set(h+D,f+b)}static calculateBlackPoints(l,h,f,g,v){const x=v-ft.BLOCK_SIZE,b=g-ft.BLOCK_SIZE,E=new Array(f);for(let D=0;D<f;D++){E[D]=new Int32Array(h);let R=D<<ft.BLOCK_SIZE_POWER;R>x&&(R=x);for(let F=0;F<h;F++){let B=F<<ft.BLOCK_SIZE_POWER;B>b&&(B=b);let Y=0,q=255,te=0;for(let ae=0,Te=R*g+B;ae<ft.BLOCK_SIZE;ae++,Te+=g){for(let Le=0;Le<ft.BLOCK_SIZE;Le++){const ve=255&l[Te+Le];Y+=ve,ve<q&&(q=ve),ve>te&&(te=ve)}if(te-q>ft.MIN_DYNAMIC_RANGE)for(ae++,Te+=g;ae<ft.BLOCK_SIZE;ae++,Te+=g)for(let Le=0;Le<ft.BLOCK_SIZE;Le++)Y+=255&l[Te+Le]}let re=Y>>2*ft.BLOCK_SIZE_POWER;if(te-q<=ft.MIN_DYNAMIC_RANGE&&(re=q/2,D>0&&F>0)){const ae=(E[D-1][F]+2*E[D][F-1]+E[D-1][F-1])/4;q<ae&&(re=ae)}E[D][F]=re}}return E}}ft.BLOCK_SIZE_POWER=3,ft.BLOCK_SIZE=1<<ft.BLOCK_SIZE_POWER,ft.BLOCK_SIZE_MASK=ft.BLOCK_SIZE-1,ft.MINIMUM_DIMENSION=5*ft.BLOCK_SIZE,ft.MIN_DYNAMIC_RANGE=24;class kt{constructor(l,h){this.width=l,this.height=h}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(l,h,f,g){throw new Fe("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new Fe("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new Fe("This luminance source does not support rotation by 45 degrees.")}toString(){const l=new Uint8ClampedArray(this.width);let h=new Oe;for(let f=0;f<this.height;f++){const g=this.getRow(f,l);for(let v=0;v<this.width;v++){const x=255&g[v];let b;b=x<64?"#":x<128?"+":x<192?".":" ",h.append(b)}h.append("\n")}return h.toString()}}class Br extends kt{constructor(l){super(l.getWidth(),l.getHeight()),this.delegate=l}getRow(l,h){const f=this.delegate.getRow(l,h),g=this.getWidth();for(let v=0;v<g;v++)f[v]=255-(255&f[v]);return f}getMatrix(){const l=this.delegate.getMatrix(),h=this.getWidth()*this.getHeight(),f=new Uint8ClampedArray(h);for(let g=0;g<h;g++)f[g]=255-(255&l[g]);return f}isCropSupported(){return this.delegate.isCropSupported()}crop(l,h,f,g){return new Br(this.delegate.crop(l,h,f,g))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new Br(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new Br(this.delegate.rotateCounterClockwise45())}}class $r extends kt{constructor(l){super(l.width,l.height),this.canvas=l,this.tempCanvasElement=null,this.buffer=$r.makeBufferFromCanvasImageData(l)}static makeBufferFromCanvasImageData(l){const h=l.getContext("2d").getImageData(0,0,l.width,l.height);return $r.toGrayscaleBuffer(h.data,l.width,l.height)}static toGrayscaleBuffer(l,h,f){const g=new Uint8ClampedArray(h*f);for(let v=0,x=0,b=l.length;v<b;v+=4,x++){let E;E=0===l[v+3]?255:306*l[v]+601*l[v+1]+117*l[v+2]+512>>10,g[x]=E}return g}getRow(l,h){if(l<0||l>=this.getHeight())throw new Ke("Requested row is outside the image: "+l);const f=this.getWidth(),g=l*f;return null===h?h=this.buffer.slice(g,g+f):(h.length<f&&(h=new Uint8ClampedArray(f)),h.set(this.buffer.slice(g,g+f))),h}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(l,h,f,g){return super.crop(l,h,f,g),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(null===this.tempCanvasElement){const l=this.canvas.ownerDocument.createElement("canvas");l.width=this.canvas.width,l.height=this.canvas.height,this.tempCanvasElement=l}return this.tempCanvasElement}rotate(l){const h=this.getTempCanvasElement(),f=h.getContext("2d"),g=l*$r.DEGREE_TO_RADIANS,v=this.canvas.width,x=this.canvas.height,b=Math.ceil(Math.abs(Math.cos(g))*v+Math.abs(Math.sin(g))*x),E=Math.ceil(Math.abs(Math.sin(g))*v+Math.abs(Math.cos(g))*x);return h.width=b,h.height=E,f.translate(b/2,E/2),f.rotate(g),f.drawImage(this.canvas,v/-2,x/-2),this.buffer=$r.makeBufferFromCanvasImageData(h),this}invert(){return new Br(this)}}$r.DEGREE_TO_RADIANS=Math.PI/180;class ya{constructor(l,h,f){this.deviceId=l,this.label=h,this.kind="videoinput",this.groupId=f||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var di=(globalThis||global||self||window?(globalThis||global||self||window||void 0).__awaiter:void 0)||function(S,l,h,f){return new(h||(h=Promise))(function(v,x){function b(R){try{D(f.next(R))}catch(F){x(F)}}function E(R){try{D(f.throw(R))}catch(F){x(F)}}function D(R){R.done?v(R.value):function(v){return v instanceof h?v:new h(function(x){x(v)})}(R.value).then(b,E)}D((f=f.apply(S,l||[])).next())})};class as{constructor(l,h=500,f){this.reader=l,this.timeBetweenScansMillis=h,this._hints=f,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return"undefined"!=typeof navigator}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!(!this.isMediaDevicesSuported||!navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(l){this._timeBetweenDecodingAttempts=l<0?0:l}set hints(l){this._hints=l||null}get hints(){return this._hints}listVideoInputDevices(){return di(this,void 0,void 0,function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const l=yield navigator.mediaDevices.enumerateDevices(),h=[];for(const f of l){const g="video"===f.kind?"videoinput":f.kind;"videoinput"===g&&h.push({deviceId:f.deviceId||f.id,label:f.label||`Video device ${h.length+1}`,kind:g,groupId:f.groupId})}return h})}getVideoInputDevices(){return di(this,void 0,void 0,function*(){return(yield this.listVideoInputDevices()).map(h=>new ya(h.deviceId,h.label))})}findDeviceById(l){return di(this,void 0,void 0,function*(){const h=yield this.listVideoInputDevices();return h?h.find(f=>f.deviceId===l):null})}decodeFromInputVideoDevice(l,h){return di(this,void 0,void 0,function*(){return yield this.decodeOnceFromVideoDevice(l,h)})}decodeOnceFromVideoDevice(l,h){return di(this,void 0,void 0,function*(){let f;this.reset(),f=l?{deviceId:{exact:l}}:{facingMode:"environment"};const g={video:f};return yield this.decodeOnceFromConstraints(g,h)})}decodeOnceFromConstraints(l,h){return di(this,void 0,void 0,function*(){const f=yield navigator.mediaDevices.getUserMedia(l);return yield this.decodeOnceFromStream(f,h)})}decodeOnceFromStream(l,h){return di(this,void 0,void 0,function*(){this.reset();const f=yield this.attachStreamToVideo(l,h);return yield this.decodeOnce(f)})}decodeFromInputVideoDeviceContinuously(l,h,f){return di(this,void 0,void 0,function*(){return yield this.decodeFromVideoDevice(l,h,f)})}decodeFromVideoDevice(l,h,f){return di(this,void 0,void 0,function*(){let g;g=l?{deviceId:{exact:l}}:{facingMode:"environment"};const v={video:g};return yield this.decodeFromConstraints(v,h,f)})}decodeFromConstraints(l,h,f){return di(this,void 0,void 0,function*(){const g=yield navigator.mediaDevices.getUserMedia(l);return yield this.decodeFromStream(g,h,f)})}decodeFromStream(l,h,f){return di(this,void 0,void 0,function*(){this.reset();const g=yield this.attachStreamToVideo(l,h);return yield this.decodeContinuously(g,f)})}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(l,h){return di(this,void 0,void 0,function*(){const f=this.prepareVideoElement(h);return this.addVideoSource(f,l),this.videoElement=f,this.stream=l,yield this.playVideoOnLoadAsync(f),f})}playVideoOnLoadAsync(l){return new Promise((h,f)=>this.playVideoOnLoad(l,()=>h()))}playVideoOnLoad(l,h){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(l),l.addEventListener("ended",this.videoEndedListener),l.addEventListener("canplay",this.videoCanPlayListener),l.addEventListener("playing",h),this.tryPlayVideo(l)}isVideoPlaying(l){return l.currentTime>0&&!l.paused&&!l.ended&&l.readyState>2}tryPlayVideo(l){return di(this,void 0,void 0,function*(){if(this.isVideoPlaying(l))console.warn("Trying to play video that is already playing.");else try{yield l.play()}catch(h){console.warn("It was not possible to play the video.")}})}getMediaElement(l,h){const f=document.getElementById(l);if(!f)throw new hi(`element with id '${l}' not found`);if(f.nodeName.toLowerCase()!==h.toLowerCase())throw new hi(`element with id '${l}' must be an ${h} element`);return f}decodeFromImage(l,h){if(!l&&!h)throw new hi("either imageElement with a src set or an url must be provided");return h&&!l?this.decodeFromImageUrl(h):this.decodeFromImageElement(l)}decodeFromVideo(l,h){if(!l&&!h)throw new hi("Either an element with a src set or an URL must be provided");return h&&!l?this.decodeFromVideoUrl(h):this.decodeFromVideoElement(l)}decodeFromVideoContinuously(l,h,f){if(void 0===l&&void 0===h)throw new hi("Either an element with a src set or an URL must be provided");return h&&!l?this.decodeFromVideoUrlContinuously(h,f):this.decodeFromVideoElementContinuously(l,f)}decodeFromImageElement(l){if(!l)throw new hi("An image element must be provided.");this.reset();const h=this.prepareImageElement(l);let f;return this.imageElement=h,f=this.isImageLoaded(h)?this.decodeOnce(h,!1,!0):this._decodeOnLoadImage(h),f}decodeFromVideoElement(l){const h=this._decodeFromVideoElementSetup(l);return this._decodeOnLoadVideo(h)}decodeFromVideoElementContinuously(l,h){const f=this._decodeFromVideoElementSetup(l);return this._decodeOnLoadVideoContinuously(f,h)}_decodeFromVideoElementSetup(l){if(!l)throw new hi("A video element must be provided.");this.reset();const h=this.prepareVideoElement(l);return this.videoElement=h,h}decodeFromImageUrl(l){if(!l)throw new hi("An URL must be provided.");this.reset();const h=this.prepareImageElement();this.imageElement=h;const f=this._decodeOnLoadImage(h);return h.src=l,f}decodeFromVideoUrl(l){if(!l)throw new hi("An URL must be provided.");this.reset();const h=this.prepareVideoElement(),f=this.decodeFromVideoElement(h);return h.src=l,f}decodeFromVideoUrlContinuously(l,h){if(!l)throw new hi("An URL must be provided.");this.reset();const f=this.prepareVideoElement(),g=this.decodeFromVideoElementContinuously(f,h);return f.src=l,g}_decodeOnLoadImage(l){return new Promise((h,f)=>{this.imageLoadedListener=()=>this.decodeOnce(l,!1,!0).then(h,f),l.addEventListener("load",this.imageLoadedListener)})}_decodeOnLoadVideo(l){return di(this,void 0,void 0,function*(){return yield this.playVideoOnLoadAsync(l),yield this.decodeOnce(l)})}_decodeOnLoadVideoContinuously(l,h){return di(this,void 0,void 0,function*(){yield this.playVideoOnLoadAsync(l),this.decodeContinuously(l,h)})}isImageLoaded(l){return!(!l.complete||0===l.naturalWidth)}prepareImageElement(l){let h;return void 0===l&&(h=document.createElement("img"),h.width=200,h.height=200),"string"==typeof l&&(h=this.getMediaElement(l,"img")),l instanceof HTMLImageElement&&(h=l),h}prepareVideoElement(l){let h;return!l&&"undefined"!=typeof document&&(h=document.createElement("video"),h.width=200,h.height=200),"string"==typeof l&&(h=this.getMediaElement(l,"video")),l instanceof HTMLVideoElement&&(h=l),h.setAttribute("autoplay","true"),h.setAttribute("muted","true"),h.setAttribute("playsinline","true"),h}decodeOnce(l,h=!0,f=!0){this._stopAsyncDecode=!1;const g=(v,x)=>{if(this._stopAsyncDecode)return x(new ie("Video stream has ended before any code could be detected.")),void(this._stopAsyncDecode=void 0);try{v(this.decode(l))}catch(b){const R=(b instanceof At||b instanceof Re)&&f;if(h&&b instanceof ie||R)return setTimeout(g,this._timeBetweenDecodingAttempts,v,x);x(b)}};return new Promise((v,x)=>g(v,x))}decodeContinuously(l,h){this._stopContinuousDecode=!1;const f=()=>{if(this._stopContinuousDecode)this._stopContinuousDecode=void 0;else try{const g=this.decode(l);h(g,null),setTimeout(f,this.timeBetweenScansMillis)}catch(g){h(null,g);const x=g instanceof ie;(g instanceof At||g instanceof Re||x)&&setTimeout(f,this._timeBetweenDecodingAttempts)}};f()}decode(l){const h=this.createBinaryBitmap(l);return this.decodeBitmap(h)}createBinaryBitmap(l){const h=this.getCaptureCanvasContext(l);this.drawImageOnCanvas(h,l);const f=this.getCaptureCanvas(l),g=new $r(f),v=new ft(g);return new Bi(v)}getCaptureCanvasContext(l){if(!this.captureCanvasContext){const f=this.getCaptureCanvas(l).getContext("2d");this.captureCanvasContext=f}return this.captureCanvasContext}getCaptureCanvas(l){if(!this.captureCanvas){const h=this.createCaptureCanvas(l);this.captureCanvas=h}return this.captureCanvas}drawImageOnCanvas(l,h){l.drawImage(h,0,0)}decodeBitmap(l){return this.reader.decode(l,this._hints)}createCaptureCanvas(l){if("undefined"==typeof document)return this._destroyCaptureCanvas(),null;const h=document.createElement("canvas");let f,g;return void 0!==l&&(l instanceof HTMLVideoElement?(f=l.videoWidth,g=l.videoHeight):l instanceof HTMLImageElement&&(f=l.naturalWidth||l.width,g=l.naturalHeight||l.height)),h.style.width=f+"px",h.style.height=g+"px",h.width=f,h.height=g,h}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach(l=>l.stop()),this.stream=void 0),!1===this._stopAsyncDecode&&this.stopAsyncDecode(),!1===this._stopContinuousDecode&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){!this.videoElement||(void 0!==this.videoEndedListener&&this.videoElement.removeEventListener("ended",this.videoEndedListener),void 0!==this.videoPlayingEventListener&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),void 0!==this.videoCanPlayListener&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){!this.imageElement||(void 0!==this.imageLoadedListener&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(l,h){try{l.srcObject=h}catch(f){l.src=URL.createObjectURL(h)}}cleanVideoSource(l){try{l.srcObject=null}catch(h){l.src=""}this.videoElement.removeAttribute("src")}}class Vr{constructor(l,h,f=(null==h?0:8*h.length),g,v,x=$t.currentTimeMillis()){this.text=l,this.rawBytes=h,this.numBits=f,this.resultPoints=g,this.format=v,this.timestamp=x,this.text=l,this.rawBytes=h,this.numBits=null==f?null==h?0:8*h.length:f,this.resultPoints=g,this.format=v,this.resultMetadata=null,this.timestamp=null==x?$t.currentTimeMillis():x}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(l,h){null===this.resultMetadata&&(this.resultMetadata=new Map),this.resultMetadata.set(l,h)}putAllMetadata(l){null!==l&&(this.resultMetadata=null===this.resultMetadata?l:new Map(l))}addResultPoints(l){const h=this.resultPoints;if(null===h)this.resultPoints=l;else if(null!==l&&l.length>0){const f=new Array(h.length+l.length);$t.arraycopy(h,0,f,0,h.length),$t.arraycopy(l,0,f,h.length,l.length),this.resultPoints=f}}getTimestamp(){return this.timestamp}toString(){return this.text}}var zu=(()=>{return(S=zu||(zu={}))[S.AZTEC=0]="AZTEC",S[S.CODABAR=1]="CODABAR",S[S.CODE_39=2]="CODE_39",S[S.CODE_93=3]="CODE_93",S[S.CODE_128=4]="CODE_128",S[S.DATA_MATRIX=5]="DATA_MATRIX",S[S.EAN_8=6]="EAN_8",S[S.EAN_13=7]="EAN_13",S[S.ITF=8]="ITF",S[S.MAXICODE=9]="MAXICODE",S[S.PDF_417=10]="PDF_417",S[S.QR_CODE=11]="QR_CODE",S[S.RSS_14=12]="RSS_14",S[S.RSS_EXPANDED=13]="RSS_EXPANDED",S[S.UPC_A=14]="UPC_A",S[S.UPC_E=15]="UPC_E",S[S.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION",zu;var S})(),pt=zu,us=(()=>{return(S=us||(us={}))[S.OTHER=0]="OTHER",S[S.ORIENTATION=1]="ORIENTATION",S[S.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",S[S.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",S[S.ISSUE_NUMBER=4]="ISSUE_NUMBER",S[S.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",S[S.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",S[S.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",S[S.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",S[S.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",S[S.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY",us;var S})(),wr=us;class Ds{constructor(l,h,f,g,v=-1,x=-1){this.rawBytes=l,this.text=h,this.byteSegments=f,this.ecLevel=g,this.structuredAppendSequenceNumber=v,this.structuredAppendParity=x,this.numBits=null==l?0:8*l.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(l){this.numBits=l}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(l){this.errorsCorrected=l}getErasures(){return this.erasures}setErasures(l){this.erasures=l}getOther(){return this.other}setOther(l){this.other=l}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class Ss{exp(l){return this.expTable[l]}log(l){if(0===l)throw new Ke;return this.logTable[l]}static addOrSubtract(l,h){return l^h}}class fi{constructor(l,h){if(0===h.length)throw new Ke;this.field=l;const f=h.length;if(f>1&&0===h[0]){let g=1;for(;g<f&&0===h[g];)g++;g===f?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(f-g),$t.arraycopy(h,g,this.coefficients,0,this.coefficients.length))}else this.coefficients=h}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return 0===this.coefficients[0]}getCoefficient(l){return this.coefficients[this.coefficients.length-1-l]}evaluateAt(l){if(0===l)return this.getCoefficient(0);const h=this.coefficients;let f;if(1===l){f=0;for(let x=0,b=h.length;x!==b;x++)f=Ss.addOrSubtract(f,h[x]);return f}f=h[0];const g=h.length,v=this.field;for(let x=1;x<g;x++)f=Ss.addOrSubtract(v.multiply(l,f),h[x]);return f}addOrSubtract(l){if(!this.field.equals(l.field))throw new Ke("GenericGFPolys do not have same GenericGF field");if(this.isZero())return l;if(l.isZero())return this;let h=this.coefficients,f=l.coefficients;if(h.length>f.length){const x=h;h=f,f=x}let g=new Int32Array(f.length);const v=f.length-h.length;$t.arraycopy(f,0,g,0,v);for(let x=v;x<f.length;x++)g[x]=Ss.addOrSubtract(h[x-v],f[x]);return new fi(this.field,g)}multiply(l){if(!this.field.equals(l.field))throw new Ke("GenericGFPolys do not have same GenericGF field");if(this.isZero()||l.isZero())return this.field.getZero();const h=this.coefficients,f=h.length,g=l.coefficients,v=g.length,x=new Int32Array(f+v-1),b=this.field;for(let E=0;E<f;E++){const D=h[E];for(let R=0;R<v;R++)x[E+R]=Ss.addOrSubtract(x[E+R],b.multiply(D,g[R]))}return new fi(b,x)}multiplyScalar(l){if(0===l)return this.field.getZero();if(1===l)return this;const h=this.coefficients.length,f=this.field,g=new Int32Array(h),v=this.coefficients;for(let x=0;x<h;x++)g[x]=f.multiply(v[x],l);return new fi(f,g)}multiplyByMonomial(l,h){if(l<0)throw new Ke;if(0===h)return this.field.getZero();const f=this.coefficients,g=f.length,v=new Int32Array(g+l),x=this.field;for(let b=0;b<g;b++)v[b]=x.multiply(f[b],h);return new fi(x,v)}divide(l){if(!this.field.equals(l.field))throw new Ke("GenericGFPolys do not have same GenericGF field");if(l.isZero())throw new Ke("Divide by 0");const h=this.field;let f=h.getZero(),g=this;const v=l.getCoefficient(l.getDegree()),x=h.inverse(v);for(;g.getDegree()>=l.getDegree()&&!g.isZero();){const b=g.getDegree()-l.getDegree(),E=h.multiply(g.getCoefficient(g.getDegree()),x),D=l.multiplyByMonomial(b,E),R=h.buildMonomial(b,E);f=f.addOrSubtract(R),g=g.addOrSubtract(D)}return[f,g]}toString(){let l="";for(let h=this.getDegree();h>=0;h--){let f=this.getCoefficient(h);if(0!==f){if(f<0?(l+=" - ",f=-f):l.length>0&&(l+=" + "),0===h||1!==f){const g=this.field.log(f);0===g?l+="1":1===g?l+="a":(l+="a^",l+=g)}0!==h&&(1===h?l+="x":(l+="x^",l+=h))}}return l}}let ru=(()=>{class S extends br{}return S.kind="ArithmeticException",S})();class Kt extends Ss{constructor(l,h,f){super(),this.primitive=l,this.size=h,this.generatorBase=f;const g=new Int32Array(h);let v=1;for(let b=0;b<h;b++)g[b]=v,v*=2,v>=h&&(v^=l,v&=h-1);this.expTable=g;const x=new Int32Array(h);for(let b=0;b<h-1;b++)x[g[b]]=b;this.logTable=x,this.zero=new fi(this,Int32Array.from([0])),this.one=new fi(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(l,h){if(l<0)throw new Ke;if(0===h)return this.zero;const f=new Int32Array(l+1);return f[0]=h,new fi(this,f)}inverse(l){if(0===l)throw new ru;return this.expTable[this.size-this.logTable[l]-1]}multiply(l,h){return 0===l||0===h?0:this.expTable[(this.logTable[l]+this.logTable[h])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+Dt.toHexString(this.primitive)+","+this.size+")"}equals(l){return l===this}}Kt.AZTEC_DATA_12=new Kt(4201,4096,1),Kt.AZTEC_DATA_10=new Kt(1033,1024,1),Kt.AZTEC_DATA_6=new Kt(67,64,1),Kt.AZTEC_PARAM=new Kt(19,16,1),Kt.QR_CODE_FIELD_256=new Kt(285,256,0),Kt.DATA_MATRIX_FIELD_256=new Kt(301,256,1),Kt.AZTEC_DATA_8=Kt.DATA_MATRIX_FIELD_256,Kt.MAXICODE_FIELD_64=Kt.AZTEC_DATA_6;let xa=(()=>{class S extends br{}return S.kind="ReedSolomonException",S})(),Vo=(()=>{class S extends br{}return S.kind="IllegalStateException",S})();class ba{constructor(l){this.field=l}decode(l,h){const f=this.field,g=new fi(f,l),v=new Int32Array(h);let x=!0;for(let Y=0;Y<h;Y++){const q=g.evaluateAt(f.exp(Y+f.getGeneratorBase()));v[v.length-1-Y]=q,0!==q&&(x=!1)}if(x)return;const b=new fi(f,v),E=this.runEuclideanAlgorithm(f.buildMonomial(h,1),b,h),R=E[1],F=this.findErrorLocations(E[0]),B=this.findErrorMagnitudes(R,F);for(let Y=0;Y<F.length;Y++){const q=l.length-1-f.log(F[Y]);if(q<0)throw new xa("Bad error location");l[q]=Kt.addOrSubtract(l[q],B[Y])}}runEuclideanAlgorithm(l,h,f){if(l.getDegree()<h.getDegree()){const Y=l;l=h,h=Y}const g=this.field;let v=l,x=h,b=g.getZero(),E=g.getOne();for(;x.getDegree()>=(f/2|0);){let Y=v,q=b;if(v=x,b=E,v.isZero())throw new xa("r_{i-1} was zero");x=Y;let te=g.getZero();const re=v.getCoefficient(v.getDegree()),ae=g.inverse(re);for(;x.getDegree()>=v.getDegree()&&!x.isZero();){const Te=x.getDegree()-v.getDegree(),Le=g.multiply(x.getCoefficient(x.getDegree()),ae);te=te.addOrSubtract(g.buildMonomial(Te,Le)),x=x.addOrSubtract(v.multiplyByMonomial(Te,Le))}if(E=te.multiply(b).addOrSubtract(q),x.getDegree()>=v.getDegree())throw new Vo("Division algorithm failed to reduce polynomial?")}const D=E.getCoefficient(0);if(0===D)throw new xa("sigmaTilde(0) was zero");const R=g.inverse(D);return[E.multiplyScalar(R),x.multiplyScalar(R)]}findErrorLocations(l){const h=l.getDegree();if(1===h)return Int32Array.from([l.getCoefficient(1)]);const f=new Int32Array(h);let g=0;const v=this.field;for(let x=1;x<v.getSize()&&g<h;x++)0===l.evaluateAt(x)&&(f[g]=v.inverse(x),g++);if(g!==h)throw new xa("Error locator degree does not match number of roots");return f}findErrorMagnitudes(l,h){const f=h.length,g=new Int32Array(f),v=this.field;for(let x=0;x<f;x++){const b=v.inverse(h[x]);let E=1;for(let D=0;D<f;D++)if(x!==D){const R=v.multiply(h[D],b);E=v.multiply(E,0==(1&R)?1|R:-2&R)}g[x]=v.multiply(l.evaluateAt(b),v.inverse(E)),0!==v.getGeneratorBase()&&(g[x]=v.multiply(g[x],b))}return g}}var zn=(()=>{return(S=zn||(zn={}))[S.UPPER=0]="UPPER",S[S.LOWER=1]="LOWER",S[S.MIXED=2]="MIXED",S[S.DIGIT=3]="DIGIT",S[S.PUNCT=4]="PUNCT",S[S.BINARY=5]="BINARY",zn;var S})();let Jn=(()=>{class S{decode(h){this.ddata=h;let f=h.getBits(),g=this.extractBits(f),v=this.correctBits(g),x=S.convertBoolArrayToByteArray(v),b=S.getEncodedData(v),E=new Ds(x,b,null,null);return E.setNumBits(v.length),E}static highLevelDecode(h){return this.getEncodedData(h)}static getEncodedData(h){let f=h.length,g=zn.UPPER,v=zn.UPPER,x="",b=0;for(;b<f;)if(v===zn.BINARY){if(f-b<5)break;let E=S.readCode(h,b,5);if(b+=5,0===E){if(f-b<11)break;E=S.readCode(h,b,11)+31,b+=11}for(let D=0;D<E;D++){if(f-b<8){b=f;break}const R=S.readCode(h,b,8);x+=_e.castAsNonUtf8Char(R),b+=8}v=g}else{let E=v===zn.DIGIT?4:5;if(f-b<E)break;let D=S.readCode(h,b,E);b+=E;let R=S.getCharacter(v,D);R.startsWith("CTRL_")?(g=v,v=S.getTable(R.charAt(5)),"L"===R.charAt(6)&&(g=v)):(x+=R,v=g)}return x}static getTable(h){switch(h){case"L":return zn.LOWER;case"P":return zn.PUNCT;case"M":return zn.MIXED;case"D":return zn.DIGIT;case"B":return zn.BINARY;case"U":default:return zn.UPPER}}static getCharacter(h,f){switch(h){case zn.UPPER:return S.UPPER_TABLE[f];case zn.LOWER:return S.LOWER_TABLE[f];case zn.MIXED:return S.MIXED_TABLE[f];case zn.PUNCT:return S.PUNCT_TABLE[f];case zn.DIGIT:return S.DIGIT_TABLE[f];default:throw new Vo("Bad table")}}correctBits(h){let f,g;this.ddata.getNbLayers()<=2?(g=6,f=Kt.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(g=8,f=Kt.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(g=10,f=Kt.AZTEC_DATA_10):(g=12,f=Kt.AZTEC_DATA_12);let v=this.ddata.getNbDatablocks(),x=h.length/g;if(x<v)throw new Re;let b=h.length%g,E=new Int32Array(x);for(let Y=0;Y<x;Y++,b+=g)E[Y]=S.readCode(h,b,g);try{new ba(f).decode(E,x-v)}catch(Y){throw new Re(Y)}let D=(1<<g)-1,R=0;for(let Y=0;Y<v;Y++){let q=E[Y];if(0===q||q===D)throw new Re;(1===q||q===D-1)&&R++}let F=new Array(v*g-R),B=0;for(let Y=0;Y<v;Y++){let q=E[Y];if(1===q||q===D-1)F.fill(q>1,B,B+g-1),B+=g-1;else for(let te=g-1;te>=0;--te)F[B++]=0!=(q&1<<te)}return F}extractBits(h){let f=this.ddata.isCompact(),g=this.ddata.getNbLayers(),v=(f?11:14)+4*g,x=new Int32Array(v),b=new Array(this.totalBitsInLayer(g,f));if(f)for(let E=0;E<x.length;E++)x[E]=E;else{let E=v+1+2*Dt.truncDivision(Dt.truncDivision(v,2)-1,15),D=v/2,R=Dt.truncDivision(E,2);for(let F=0;F<D;F++){let B=F+Dt.truncDivision(F,15);x[D-F-1]=R-B-1,x[D+F]=R+B+1}}for(let E=0,D=0;E<g;E++){let R=4*(g-E)+(f?9:12),F=2*E,B=v-1-F;for(let Y=0;Y<R;Y++){let q=2*Y;for(let te=0;te<2;te++)b[D+q+te]=h.get(x[F+te],x[F+Y]),b[D+2*R+q+te]=h.get(x[F+Y],x[B-te]),b[D+4*R+q+te]=h.get(x[B-te],x[B-Y]),b[D+6*R+q+te]=h.get(x[B-Y],x[F+te])}D+=8*R}return b}static readCode(h,f,g){let v=0;for(let x=f;x<f+g;x++)v<<=1,h[x]&&(v|=1);return v}static readByte(h,f){let g=h.length-f;return g>=8?S.readCode(h,f,8):S.readCode(h,f,g)<<8-g}static convertBoolArrayToByteArray(h){let f=new Uint8Array((h.length+7)/8);for(let g=0;g<f.length;g++)f[g]=S.readByte(h,8*g);return f}totalBitsInLayer(h,f){return((f?88:112)+16*h)*h}}return S.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],S.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],S.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","\t","\n","\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],S.PUNCT_TABLE=["","\r","\r\n",". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],S.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"],S})();class Qt{constructor(){}static round(l){return NaN===l?0:l<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:l>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:l+(l<0?-.5:.5)|0}static distance(l,h,f,g){const v=l-f,x=h-g;return Math.sqrt(v*v+x*x)}static sum(l){let h=0;for(let f=0,g=l.length;f!==g;f++)h+=l[f];return h}}class Gu{static floatToIntBits(l){return l}}Gu.MAX_VALUE=Number.MAX_SAFE_INTEGER;class Xe{constructor(l,h){this.x=l,this.y=h}getX(){return this.x}getY(){return this.y}equals(l){if(l instanceof Xe){const h=l;return this.x===h.x&&this.y===h.y}return!1}hashCode(){return 31*Gu.floatToIntBits(this.x)+Gu.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(l){const h=this.distance(l[0],l[1]),f=this.distance(l[1],l[2]),g=this.distance(l[0],l[2]);let v,x,b;if(f>=h&&f>=g?(x=l[0],v=l[1],b=l[2]):g>=f&&g>=h?(x=l[1],v=l[0],b=l[2]):(x=l[2],v=l[0],b=l[1]),this.crossProductZ(v,x,b)<0){const E=v;v=b,b=E}l[0]=v,l[1]=x,l[2]=b}static distance(l,h){return Qt.distance(l.x,l.y,h.x,h.y)}static crossProductZ(l,h,f){const g=h.x,v=h.y;return(f.x-g)*(l.y-v)-(f.y-v)*(l.x-g)}}class Di{constructor(l,h){this.bits=l,this.points=h}getBits(){return this.bits}getPoints(){return this.points}}class Uo extends Di{constructor(l,h,f,g,v){super(l,h),this.compact=f,this.nbDatablocks=g,this.nbLayers=v}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}let pr=(()=>{class S{constructor(h,f,g,v){this.image=h,this.height=h.getHeight(),this.width=h.getWidth(),null==f&&(f=S.INIT_SIZE),null==g&&(g=h.getWidth()/2|0),null==v&&(v=h.getHeight()/2|0);const x=f/2|0;if(this.leftInit=g-x,this.rightInit=g+x,this.upInit=v-x,this.downInit=v+x,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new ie}detect(){let h=this.leftInit,f=this.rightInit,g=this.upInit,v=this.downInit,x=!1,b=!0,E=!1,D=!1,R=!1,F=!1,B=!1;const Y=this.width,q=this.height;for(;b;){b=!1;let te=!0;for(;(te||!D)&&f<Y;)te=this.containsBlackPoint(g,v,f,!1),te?(f++,b=!0,D=!0):D||f++;if(f>=Y){x=!0;break}let re=!0;for(;(re||!R)&&v<q;)re=this.containsBlackPoint(h,f,v,!0),re?(v++,b=!0,R=!0):R||v++;if(v>=q){x=!0;break}let ae=!0;for(;(ae||!F)&&h>=0;)ae=this.containsBlackPoint(g,v,h,!1),ae?(h--,b=!0,F=!0):F||h--;if(h<0){x=!0;break}let Te=!0;for(;(Te||!B)&&g>=0;)Te=this.containsBlackPoint(h,f,g,!0),Te?(g--,b=!0,B=!0):B||g--;if(g<0){x=!0;break}b&&(E=!0)}if(!x&&E){const te=f-h;let re=null;for(let ve=1;null===re&&ve<te;ve++)re=this.getBlackPointOnSegment(h,v-ve,h+ve,v);if(null==re)throw new ie;let ae=null;for(let ve=1;null===ae&&ve<te;ve++)ae=this.getBlackPointOnSegment(h,g+ve,h+ve,g);if(null==ae)throw new ie;let Te=null;for(let ve=1;null===Te&&ve<te;ve++)Te=this.getBlackPointOnSegment(f,g+ve,f-ve,g);if(null==Te)throw new ie;let Le=null;for(let ve=1;null===Le&&ve<te;ve++)Le=this.getBlackPointOnSegment(f,v-ve,f-ve,v);if(null==Le)throw new ie;return this.centerEdges(Le,re,Te,ae)}throw new ie}getBlackPointOnSegment(h,f,g,v){const x=Qt.round(Qt.distance(h,f,g,v)),b=(g-h)/x,E=(v-f)/x,D=this.image;for(let R=0;R<x;R++){const F=Qt.round(h+R*b),B=Qt.round(f+R*E);if(D.get(F,B))return new Xe(F,B)}return null}centerEdges(h,f,g,v){const x=h.getX(),b=h.getY(),E=f.getX(),D=f.getY(),R=g.getX(),F=g.getY(),B=v.getX(),Y=v.getY(),q=S.CORR;return x<this.width/2?[new Xe(B-q,Y+q),new Xe(E+q,D+q),new Xe(R-q,F-q),new Xe(x+q,b-q)]:[new Xe(B+q,Y+q),new Xe(E+q,D-q),new Xe(R-q,F+q),new Xe(x-q,b-q)]}containsBlackPoint(h,f,g,v){const x=this.image;if(v){for(let b=h;b<=f;b++)if(x.get(b,g))return!0}else for(let b=h;b<=f;b++)if(x.get(g,b))return!0;return!1}}return S.INIT_SIZE=10,S.CORR=1,S})();class iu{static checkAndNudgePoints(l,h){const f=l.getWidth(),g=l.getHeight();let v=!0;for(let x=0;x<h.length&&v;x+=2){const b=Math.floor(h[x]),E=Math.floor(h[x+1]);if(b<-1||b>f||E<-1||E>g)throw new ie;v=!1,-1===b?(h[x]=0,v=!0):b===f&&(h[x]=f-1,v=!0),-1===E?(h[x+1]=0,v=!0):E===g&&(h[x+1]=g-1,v=!0)}v=!0;for(let x=h.length-2;x>=0&&v;x-=2){const b=Math.floor(h[x]),E=Math.floor(h[x+1]);if(b<-1||b>f||E<-1||E>g)throw new ie;v=!1,-1===b?(h[x]=0,v=!0):b===f&&(h[x]=f-1,v=!0),-1===E?(h[x+1]=0,v=!0):E===g&&(h[x+1]=g-1,v=!0)}}}class _r{constructor(l,h,f,g,v,x,b,E,D){this.a11=l,this.a21=h,this.a31=f,this.a12=g,this.a22=v,this.a32=x,this.a13=b,this.a23=E,this.a33=D}static quadrilateralToQuadrilateral(l,h,f,g,v,x,b,E,D,R,F,B,Y,q,te,re){const ae=_r.quadrilateralToSquare(l,h,f,g,v,x,b,E);return _r.squareToQuadrilateral(D,R,F,B,Y,q,te,re).times(ae)}transformPoints(l){const h=l.length,f=this.a11,g=this.a12,v=this.a13,x=this.a21,b=this.a22,E=this.a23,D=this.a31,R=this.a32,F=this.a33;for(let B=0;B<h;B+=2){const Y=l[B],q=l[B+1],te=v*Y+E*q+F;l[B]=(f*Y+x*q+D)/te,l[B+1]=(g*Y+b*q+R)/te}}transformPointsWithValues(l,h){const f=this.a11,g=this.a12,v=this.a13,x=this.a21,b=this.a22,E=this.a23,D=this.a31,R=this.a32,F=this.a33,B=l.length;for(let Y=0;Y<B;Y++){const q=l[Y],te=h[Y],re=v*q+E*te+F;l[Y]=(f*q+x*te+D)/re,h[Y]=(g*q+b*te+R)/re}}static squareToQuadrilateral(l,h,f,g,v,x,b,E){const D=l-f+v-b,R=h-g+x-E;if(0===D&&0===R)return new _r(f-l,v-f,l,g-h,x-g,h,0,0,1);{const F=f-v,B=b-v,Y=g-x,q=E-x,te=F*q-B*Y,re=(D*q-B*R)/te,ae=(F*R-D*Y)/te;return new _r(f-l+re*f,b-l+ae*b,l,g-h+re*g,E-h+ae*E,h,re,ae,1)}}static quadrilateralToSquare(l,h,f,g,v,x,b,E){return _r.squareToQuadrilateral(l,h,f,g,v,x,b,E).buildAdjoint()}buildAdjoint(){return new _r(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(l){return new _r(this.a11*l.a11+this.a21*l.a12+this.a31*l.a13,this.a11*l.a21+this.a21*l.a22+this.a31*l.a23,this.a11*l.a31+this.a21*l.a32+this.a31*l.a33,this.a12*l.a11+this.a22*l.a12+this.a32*l.a13,this.a12*l.a21+this.a22*l.a22+this.a32*l.a23,this.a12*l.a31+this.a22*l.a32+this.a32*l.a33,this.a13*l.a11+this.a23*l.a12+this.a33*l.a13,this.a13*l.a21+this.a23*l.a22+this.a33*l.a23,this.a13*l.a31+this.a23*l.a32+this.a33*l.a33)}}class wa extends iu{sampleGrid(l,h,f,g,v,x,b,E,D,R,F,B,Y,q,te,re,ae,Te,Le){const ve=_r.quadrilateralToQuadrilateral(g,v,x,b,E,D,R,F,B,Y,q,te,re,ae,Te,Le);return this.sampleGridWithTransform(l,h,f,ve)}sampleGridWithTransform(l,h,f,g){if(h<=0||f<=0)throw new ie;const v=new bt(h,f),x=new Float32Array(2*h);for(let b=0;b<f;b++){const E=x.length,D=b+.5;for(let R=0;R<E;R+=2)x[R]=R/2+.5,x[R+1]=D;g.transformPoints(x),iu.checkAndNudgePoints(l,x);try{for(let R=0;R<E;R+=2)l.get(Math.floor(x[R]),Math.floor(x[R+1]))&&v.set(R/2,b)}catch(R){throw new ie}}return v}}class Ui{static setGridSampler(l){Ui.gridSampler=l}static getInstance(){return Ui.gridSampler}}Ui.gridSampler=new wa;class Ur{constructor(l,h){this.x=l,this.y=h}toResultPoint(){return new Xe(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class Ts{constructor(l){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=l}detect(){return this.detectMirror(!1)}detectMirror(l){let h=this.getMatrixCenter(),f=this.getBullsEyeCorners(h);if(l){let x=f[0];f[0]=f[2],f[2]=x}this.extractParameters(f);let g=this.sampleGrid(this.image,f[this.shift%4],f[(this.shift+1)%4],f[(this.shift+2)%4],f[(this.shift+3)%4]),v=this.getMatrixCornerPoints(f);return new Uo(g,v,this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(l){if(!(this.isValidPoint(l[0])&&this.isValidPoint(l[1])&&this.isValidPoint(l[2])&&this.isValidPoint(l[3])))throw new ie;let h=2*this.nbCenterLayers,f=new Int32Array([this.sampleLine(l[0],l[1],h),this.sampleLine(l[1],l[2],h),this.sampleLine(l[2],l[3],h),this.sampleLine(l[3],l[0],h)]);this.shift=this.getRotation(f,h);let g=0;for(let x=0;x<4;x++){let b=f[(this.shift+x)%4];this.compact?(g<<=7,g+=b>>1&127):(g<<=10,g+=(b>>2&992)+(b>>1&31))}let v=this.getCorrectedParameterData(g,this.compact);this.compact?(this.nbLayers=1+(v>>6),this.nbDataBlocks=1+(63&v)):(this.nbLayers=1+(v>>11),this.nbDataBlocks=1+(2047&v))}getRotation(l,h){let f=0;l.forEach((g,v,x)=>{f=(g>>h-2<<1)+(1&g)+(f<<3)}),f=((1&f)<<11)+(f>>1);for(let g=0;g<4;g++)if(Dt.bitCount(f^this.EXPECTED_CORNER_BITS[g])<=2)return g;throw new ie}getCorrectedParameterData(l,h){let f,g;h?(f=7,g=2):(f=10,g=4);let v=f-g,x=new Int32Array(f);for(let E=f-1;E>=0;--E)x[E]=15&l,l>>=4;try{new ba(Kt.AZTEC_PARAM).decode(x,v)}catch(E){throw new ie}let b=0;for(let E=0;E<g;E++)b=(b<<4)+x[E];return b}getBullsEyeCorners(l){let h=l,f=l,g=l,v=l,x=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let F=this.getFirstDifferent(h,x,1,-1),B=this.getFirstDifferent(f,x,1,1),Y=this.getFirstDifferent(g,x,-1,1),q=this.getFirstDifferent(v,x,-1,-1);if(this.nbCenterLayers>2){let te=this.distancePoint(q,F)*this.nbCenterLayers/(this.distancePoint(v,h)*(this.nbCenterLayers+2));if(te<.75||te>1.25||!this.isWhiteOrBlackRectangle(F,B,Y,q))break}h=F,f=B,g=Y,v=q,x=!x}if(5!==this.nbCenterLayers&&7!==this.nbCenterLayers)throw new ie;this.compact=5===this.nbCenterLayers;let b=new Xe(h.getX()+.5,h.getY()-.5),E=new Xe(f.getX()+.5,f.getY()+.5),D=new Xe(g.getX()-.5,g.getY()+.5),R=new Xe(v.getX()-.5,v.getY()-.5);return this.expandSquare([b,E,D,R],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let l,h,f,g;try{let b=new pr(this.image).detect();l=b[0],h=b[1],f=b[2],g=b[3]}catch(b){let E=this.image.getWidth()/2,D=this.image.getHeight()/2;l=this.getFirstDifferent(new Ur(E+7,D-7),!1,1,-1).toResultPoint(),h=this.getFirstDifferent(new Ur(E+7,D+7),!1,1,1).toResultPoint(),f=this.getFirstDifferent(new Ur(E-7,D+7),!1,-1,1).toResultPoint(),g=this.getFirstDifferent(new Ur(E-7,D-7),!1,-1,-1).toResultPoint()}let v=Qt.round((l.getX()+g.getX()+h.getX()+f.getX())/4),x=Qt.round((l.getY()+g.getY()+h.getY()+f.getY())/4);try{let b=new pr(this.image,15,v,x).detect();l=b[0],h=b[1],f=b[2],g=b[3]}catch(b){l=this.getFirstDifferent(new Ur(v+7,x-7),!1,1,-1).toResultPoint(),h=this.getFirstDifferent(new Ur(v+7,x+7),!1,1,1).toResultPoint(),f=this.getFirstDifferent(new Ur(v-7,x+7),!1,-1,1).toResultPoint(),g=this.getFirstDifferent(new Ur(v-7,x-7),!1,-1,-1).toResultPoint()}return v=Qt.round((l.getX()+g.getX()+h.getX()+f.getX())/4),x=Qt.round((l.getY()+g.getY()+h.getY()+f.getY())/4),new Ur(v,x)}getMatrixCornerPoints(l){return this.expandSquare(l,2*this.nbCenterLayers,this.getDimension())}sampleGrid(l,h,f,g,v){let x=Ui.getInstance(),b=this.getDimension(),E=b/2-this.nbCenterLayers,D=b/2+this.nbCenterLayers;return x.sampleGrid(l,b,b,E,E,D,E,D,D,E,D,h.getX(),h.getY(),f.getX(),f.getY(),g.getX(),g.getY(),v.getX(),v.getY())}sampleLine(l,h,f){let g=0,v=this.distanceResultPoint(l,h),x=v/f,b=l.getX(),E=l.getY(),D=x*(h.getX()-l.getX())/v,R=x*(h.getY()-l.getY())/v;for(let F=0;F<f;F++)this.image.get(Qt.round(b+F*D),Qt.round(E+F*R))&&(g|=1<<f-F-1);return g}isWhiteOrBlackRectangle(l,h,f,g){l=new Ur(l.getX()-3,l.getY()+3),h=new Ur(h.getX()-3,h.getY()-3),f=new Ur(f.getX()+3,f.getY()-3),g=new Ur(g.getX()+3,g.getY()+3);let x=this.getColor(g,l);if(0===x)return!1;let b=this.getColor(l,h);return b===x&&(b=this.getColor(h,f),b===x)&&(b=this.getColor(f,g),b===x)}getColor(l,h){let f=this.distancePoint(l,h),g=(h.getX()-l.getX())/f,v=(h.getY()-l.getY())/f,x=0,b=l.getX(),E=l.getY(),D=this.image.get(l.getX(),l.getY()),R=Math.ceil(f);for(let B=0;B<R;B++)b+=g,E+=v,this.image.get(Qt.round(b),Qt.round(E))!==D&&x++;let F=x/f;return F>.1&&F<.9?0:F<=.1===D?1:-1}getFirstDifferent(l,h,f,g){let v=l.getX()+f,x=l.getY()+g;for(;this.isValid(v,x)&&this.image.get(v,x)===h;)v+=f,x+=g;for(v-=f,x-=g;this.isValid(v,x)&&this.image.get(v,x)===h;)v+=f;for(v-=f;this.isValid(v,x)&&this.image.get(v,x)===h;)x+=g;return x-=g,new Ur(v,x)}expandSquare(l,h,f){let g=f/(2*h),v=l[0].getX()-l[2].getX(),x=l[0].getY()-l[2].getY(),b=(l[0].getX()+l[2].getX())/2,E=(l[0].getY()+l[2].getY())/2,D=new Xe(b+g*v,E+g*x),R=new Xe(b-g*v,E-g*x);return v=l[1].getX()-l[3].getX(),x=l[1].getY()-l[3].getY(),b=(l[1].getX()+l[3].getX())/2,E=(l[1].getY()+l[3].getY())/2,[D,new Xe(b+g*v,E+g*x),R,new Xe(b-g*v,E-g*x)]}isValid(l,h){return l>=0&&l<this.image.getWidth()&&h>0&&h<this.image.getHeight()}isValidPoint(l){let h=Qt.round(l.getX()),f=Qt.round(l.getY());return this.isValid(h,f)}distancePoint(l,h){return Qt.distance(l.getX(),l.getY(),h.getX(),h.getY())}distanceResultPoint(l,h){return Qt.distance(l.getX(),l.getY(),h.getX(),h.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(Dt.truncDivision(this.nbLayers-4,8)+1)+15}}class Ms{decode(l,h=null){let f=null,g=new Ts(l.getBlackMatrix()),v=null,x=null;try{let R=g.detectMirror(!1);v=R.getPoints(),this.reportFoundResultPoints(h,v),x=(new Jn).decode(R)}catch(R){f=R}if(null==x)try{let R=g.detectMirror(!0);v=R.getPoints(),this.reportFoundResultPoints(h,v),x=(new Jn).decode(R)}catch(R){throw null!=f?f:R}let b=new Vr(x.getText(),x.getRawBytes(),x.getNumBits(),v,pt.AZTEC,$t.currentTimeMillis()),E=x.getByteSegments();null!=E&&b.putMetadata(wr.BYTE_SEGMENTS,E);let D=x.getECLevel();return null!=D&&b.putMetadata(wr.ERROR_CORRECTION_LEVEL,D),b}reportFoundResultPoints(l,h){if(null!=l){let f=l.get(yn.NEED_RESULT_POINT_CALLBACK);null!=f&&h.forEach((g,v,x)=>{f.foundPossibleResultPoint(g)})}}reset(){}}class Cr{decode(l,h){try{return this.doDecode(l,h)}catch(f){if(h&&!0===h.get(yn.TRY_HARDER)&&l.isRotateSupported()){const v=l.rotateCounterClockwise(),x=this.doDecode(v,h),b=x.getResultMetadata();let E=270;null!==b&&!0===b.get(wr.ORIENTATION)&&(E+=b.get(wr.ORIENTATION)%360),x.putMetadata(wr.ORIENTATION,E);const D=x.getResultPoints();if(null!==D){const R=v.getHeight();for(let F=0;F<D.length;F++)D[F]=new Xe(R-D[F].getY()-1,D[F].getX())}return x}throw new ie}}reset(){}doDecode(l,h){const f=l.getWidth(),g=l.getHeight();let v=new xt(f);const x=h&&!0===h.get(yn.TRY_HARDER),b=Math.max(1,g>>(x?8:5));let E;E=x?g:15;const D=Math.trunc(g/2);for(let R=0;R<E;R++){const F=Math.trunc((R+1)/2),Y=D+b*(0==(1&R)?F:-F);if(Y<0||Y>=g)break;try{v=l.getBlackRow(Y,v)}catch(q){continue}for(let q=0;q<2;q++){if(1===q&&(v.reverse(),h&&!0===h.get(yn.NEED_RESULT_POINT_CALLBACK))){const te=new Map;h.forEach((re,ae)=>te.set(ae,re)),te.delete(yn.NEED_RESULT_POINT_CALLBACK),h=te}try{const te=this.decodeRow(Y,v,h);if(1===q){te.putMetadata(wr.ORIENTATION,180);const re=te.getResultPoints();null!==re&&(re[0]=new Xe(f-re[0].getX()-1,re[0].getY()),re[1]=new Xe(f-re[1].getX()-1,re[1].getY()))}return te}catch(te){}}}throw new ie}static recordPattern(l,h,f){const g=f.length;for(let D=0;D<g;D++)f[D]=0;const v=l.getSize();if(h>=v)throw new ie;let x=!l.get(h),b=0,E=h;for(;E<v;){if(l.get(E)!==x)f[b]++;else{if(++b===g)break;f[b]=1,x=!x}E++}if(b!==g&&(b!==g-1||E!==v))throw new ie}static recordPatternInReverse(l,h,f){let g=f.length,v=l.get(h);for(;h>0&&g>=0;)l.get(--h)!==v&&(g--,v=!v);if(g>=0)throw new ie;Cr.recordPattern(l,h+1,f)}static patternMatchVariance(l,h,f){const g=l.length;let v=0,x=0;for(let D=0;D<g;D++)v+=l[D],x+=h[D];if(v<x)return Number.POSITIVE_INFINITY;const b=v/x;f*=b;let E=0;for(let D=0;D<g;D++){const R=l[D],F=h[D]*b,B=R>F?R-F:F-R;if(B>f)return Number.POSITIVE_INFINITY;E+=B}return E/v}}class Me extends Cr{static findStartPattern(l){const h=l.getSize(),f=l.getNextSet(0);let g=0,v=Int32Array.from([0,0,0,0,0,0]),x=f,b=!1;for(let D=f;D<h;D++)if(l.get(D)!==b)v[g]++;else{if(5===g){let R=Me.MAX_AVG_VARIANCE,F=-1;for(let B=Me.CODE_START_A;B<=Me.CODE_START_C;B++){const Y=Cr.patternMatchVariance(v,Me.CODE_PATTERNS[B],Me.MAX_INDIVIDUAL_VARIANCE);Y<R&&(R=Y,F=B)}if(F>=0&&l.isRange(Math.max(0,x-(D-x)/2),x,!1))return Int32Array.from([x,D,F]);x+=v[0]+v[1],v=v.slice(2,v.length-1),v[g-1]=0,v[g]=0,g--}else g++;v[g]=1,b=!b}throw new ie}static decodeCode(l,h,f){Cr.recordPattern(l,f,h);let g=Me.MAX_AVG_VARIANCE,v=-1;for(let x=0;x<Me.CODE_PATTERNS.length;x++){const E=this.patternMatchVariance(h,Me.CODE_PATTERNS[x],Me.MAX_INDIVIDUAL_VARIANCE);E<g&&(g=E,v=x)}if(v>=0)return v;throw new ie}decodeRow(l,h,f){const g=f&&!0===f.get(yn.ASSUME_GS1),v=Me.findStartPattern(h),x=v[2];let b=0;const E=new Uint8Array(20);let D;switch(E[b++]=x,x){case Me.CODE_START_A:D=Me.CODE_CODE_A;break;case Me.CODE_START_B:D=Me.CODE_CODE_B;break;case Me.CODE_START_C:D=Me.CODE_CODE_C;break;default:throw new Re}let R=!1,F=!1,B="",Y=v[0],q=v[1];const te=Int32Array.from([0,0,0,0,0,0]);let re=0,ae=0,Te=x,Le=0,ve=!0,Jt=!1,Rt=!1;for(;!R;){const Yc=F;switch(F=!1,re=ae,ae=Me.decodeCode(h,te,q),E[b++]=ae,ae!==Me.CODE_STOP&&(ve=!0),ae!==Me.CODE_STOP&&(Le++,Te+=Le*ae),Y=q,q+=te.reduce((Ql,To)=>Ql+To,0),ae){case Me.CODE_START_A:case Me.CODE_START_B:case Me.CODE_START_C:throw new Re}switch(D){case Me.CODE_CODE_A:if(ae<64)B+=String.fromCharCode(Rt===Jt?" ".charCodeAt(0)+ae:" ".charCodeAt(0)+ae+128),Rt=!1;else if(ae<96)B+=String.fromCharCode(Rt===Jt?ae-64:ae+64),Rt=!1;else switch(ae!==Me.CODE_STOP&&(ve=!1),ae){case Me.CODE_FNC_1:g&&(B+=0===B.length?"]C1":String.fromCharCode(29));break;case Me.CODE_FNC_2:case Me.CODE_FNC_3:break;case Me.CODE_FNC_4_A:!Jt&&Rt?(Jt=!0,Rt=!1):Jt&&Rt?(Jt=!1,Rt=!1):Rt=!0;break;case Me.CODE_SHIFT:F=!0,D=Me.CODE_CODE_B;break;case Me.CODE_CODE_B:D=Me.CODE_CODE_B;break;case Me.CODE_CODE_C:D=Me.CODE_CODE_C;break;case Me.CODE_STOP:R=!0}break;case Me.CODE_CODE_B:if(ae<96)B+=String.fromCharCode(Rt===Jt?" ".charCodeAt(0)+ae:" ".charCodeAt(0)+ae+128),Rt=!1;else switch(ae!==Me.CODE_STOP&&(ve=!1),ae){case Me.CODE_FNC_1:g&&(B+=0===B.length?"]C1":String.fromCharCode(29));break;case Me.CODE_FNC_2:case Me.CODE_FNC_3:break;case Me.CODE_FNC_4_B:!Jt&&Rt?(Jt=!0,Rt=!1):Jt&&Rt?(Jt=!1,Rt=!1):Rt=!0;break;case Me.CODE_SHIFT:F=!0,D=Me.CODE_CODE_A;break;case Me.CODE_CODE_A:D=Me.CODE_CODE_A;break;case Me.CODE_CODE_C:D=Me.CODE_CODE_C;break;case Me.CODE_STOP:R=!0}break;case Me.CODE_CODE_C:if(ae<100)ae<10&&(B+="0"),B+=ae;else switch(ae!==Me.CODE_STOP&&(ve=!1),ae){case Me.CODE_FNC_1:g&&(B+=0===B.length?"]C1":String.fromCharCode(29));break;case Me.CODE_CODE_A:D=Me.CODE_CODE_A;break;case Me.CODE_CODE_B:D=Me.CODE_CODE_B;break;case Me.CODE_STOP:R=!0}}Yc&&(D=D===Me.CODE_CODE_A?Me.CODE_CODE_B:Me.CODE_CODE_A)}const go=q-Y;if(q=h.getNextUnset(q),!h.isRange(q,Math.min(h.getSize(),q+(q-Y)/2),!1))throw new ie;if(Te-=Le*re,Te%103!==re)throw new At;const Dn=B.length;if(0===Dn)throw new ie;Dn>0&&ve&&(B=B.substring(0,D===Me.CODE_CODE_C?Dn-2:Dn-1));const mo=(v[1]+v[0])/2,Gn=Y+go/2,mi=E.length,Sn=new Uint8Array(mi);for(let Yc=0;Yc<mi;Yc++)Sn[Yc]=E[Yc];const nc=[new Xe(mo,l),new Xe(Gn,l)];return new Vr(B,Sn,0,nc,pt.CODE_128,(new Date).getTime())}}Me.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],Me.MAX_AVG_VARIANCE=.25,Me.MAX_INDIVIDUAL_VARIANCE=.7,Me.CODE_SHIFT=98,Me.CODE_CODE_C=99,Me.CODE_CODE_B=100,Me.CODE_CODE_A=101,Me.CODE_FNC_1=102,Me.CODE_FNC_2=97,Me.CODE_FNC_3=96,Me.CODE_FNC_4_A=101,Me.CODE_FNC_4_B=100,Me.CODE_START_A=103,Me.CODE_START_B=104,Me.CODE_START_C=105,Me.CODE_STOP=106;let Xu=(()=>{class S extends Cr{constructor(h=!1,f=!1){super(),this.usingCheckDigit=h,this.extendedMode=f,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(h,f,g){let v=this.counters;v.fill(0),this.decodeRowResult="";let D,R,x=S.findAsteriskPattern(f,v),b=f.getNextSet(x[1]),E=f.getSize();do{S.recordPattern(f,b,v);let re=S.toNarrowWidePattern(v);if(re<0)throw new ie;D=S.patternToChar(re),this.decodeRowResult+=D,R=b;for(let ae of v)b+=ae;b=f.getNextSet(b)}while("*"!==D);this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let Y,F=0;for(let re of v)F+=re;if(b!==E&&2*(b-R-F)<F)throw new ie;if(this.usingCheckDigit){let re=this.decodeRowResult.length-1,ae=0;for(let Te=0;Te<re;Te++)ae+=S.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(Te));if(this.decodeRowResult.charAt(re)!==S.ALPHABET_STRING.charAt(ae%43))throw new At;this.decodeRowResult=this.decodeRowResult.substring(0,re)}if(0===this.decodeRowResult.length)throw new ie;Y=this.extendedMode?S.decodeExtended(this.decodeRowResult):this.decodeRowResult;let te=R+F/2;return new Vr(Y,null,0,[new Xe((x[1]+x[0])/2,h),new Xe(te,h)],pt.CODE_39,(new Date).getTime())}static findAsteriskPattern(h,f){let g=h.getSize(),v=h.getNextSet(0),x=0,b=v,E=!1,D=f.length;for(let R=v;R<g;R++)if(h.get(R)!==E)f[x]++;else{if(x===D-1){if(this.toNarrowWidePattern(f)===S.ASTERISK_ENCODING&&h.isRange(Math.max(0,b-Math.floor((R-b)/2)),b,!1))return[b,R];b+=f[0]+f[1],f.copyWithin(0,2,2+x-1),f[x-1]=0,f[x]=0,x--}else x++;f[x]=1,E=!E}throw new ie}static toNarrowWidePattern(h){let v,f=h.length,g=0;do{let x=2147483647;for(let D of h)D<x&&D>g&&(x=D);g=x,v=0;let b=0,E=0;for(let D=0;D<f;D++){let R=h[D];R>g&&(E|=1<<f-1-D,v++,b+=R)}if(3===v){for(let D=0;D<f&&v>0;D++){let R=h[D];if(R>g&&(v--,2*R>=b))return-1}return E}}while(v>3);return-1}static patternToChar(h){for(let f=0;f<S.CHARACTER_ENCODINGS.length;f++)if(S.CHARACTER_ENCODINGS[f]===h)return S.ALPHABET_STRING.charAt(f);if(h===S.ASTERISK_ENCODING)return"*";throw new ie}static decodeExtended(h){let f=h.length,g="";for(let v=0;v<f;v++){let x=h.charAt(v);if("+"===x||"$"===x||"%"===x||"/"===x){let b=h.charAt(v+1),E="\0";switch(x){case"+":if(!(b>="A"&&b<="Z"))throw new Re;E=String.fromCharCode(b.charCodeAt(0)+32);break;case"$":if(!(b>="A"&&b<="Z"))throw new Re;E=String.fromCharCode(b.charCodeAt(0)-64);break;case"%":if(b>="A"&&b<="E")E=String.fromCharCode(b.charCodeAt(0)-38);else if(b>="F"&&b<="J")E=String.fromCharCode(b.charCodeAt(0)-11);else if(b>="K"&&b<="O")E=String.fromCharCode(b.charCodeAt(0)+16);else if(b>="P"&&b<="T")E=String.fromCharCode(b.charCodeAt(0)+43);else if("U"===b)E="\0";else if("V"===b)E="@";else if("W"===b)E="`";else{if("X"!==b&&"Y"!==b&&"Z"!==b)throw new Re;E="\x7f"}break;case"/":if(b>="A"&&b<="O")E=String.fromCharCode(b.charCodeAt(0)-32);else{if("Z"!==b)throw new Re;E=":"}}g+=E,v++}else g+=x}return g}}return S.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",S.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],S.ASTERISK_ENCODING=148,S})();class En extends Cr{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(l,h,f){let g=this.decodeStart(h),v=this.decodeEnd(h),x=new Oe;En.decodeMiddle(h,g[1],v[0],x);let b=x.toString(),E=null;null!=f&&(E=f.get(yn.ALLOWED_LENGTHS)),null==E&&(E=En.DEFAULT_ALLOWED_LENGTHS);let D=b.length,R=!1,F=0;for(let q of E){if(D===q){R=!0;break}q>F&&(F=q)}if(!R&&D>F&&(R=!0),!R)throw new Re;const B=[new Xe(g[1],l),new Xe(v[0],l)];return new Vr(b,null,0,B,pt.ITF,(new Date).getTime())}static decodeMiddle(l,h,f,g){let v=new Int32Array(10),x=new Int32Array(5),b=new Int32Array(5);for(v.fill(0),x.fill(0),b.fill(0);h<f;){Cr.recordPattern(l,h,v);for(let D=0;D<5;D++){let R=2*D;x[D]=v[R],b[D]=v[R+1]}let E=En.decodeDigit(x);g.append(E.toString()),E=this.decodeDigit(b),g.append(E.toString()),v.forEach(function(D){h+=D})}}decodeStart(l){let h=En.skipWhiteSpace(l),f=En.findGuardPattern(l,h,En.START_PATTERN);return this.narrowLineWidth=(f[1]-f[0])/4,this.validateQuietZone(l,f[0]),f}validateQuietZone(l,h){let f=10*this.narrowLineWidth;f=f<h?f:h;for(let g=h-1;f>0&&g>=0&&!l.get(g);g--)f--;if(0!==f)throw new ie}static skipWhiteSpace(l){const h=l.getSize(),f=l.getNextSet(0);if(f===h)throw new ie;return f}decodeEnd(l){l.reverse();try{let f,h=En.skipWhiteSpace(l);try{f=En.findGuardPattern(l,h,En.END_PATTERN_REVERSED[0])}catch(v){v instanceof ie&&(f=En.findGuardPattern(l,h,En.END_PATTERN_REVERSED[1]))}this.validateQuietZone(l,f[0]);let g=f[0];return f[0]=l.getSize()-f[1],f[1]=l.getSize()-g,f}finally{l.reverse()}}static findGuardPattern(l,h,f){let g=f.length,v=new Int32Array(g),x=l.getSize(),b=!1,E=0,D=h;v.fill(0);for(let R=h;R<x;R++)if(l.get(R)!==b)v[E]++;else{if(E===g-1){if(Cr.patternMatchVariance(v,f,En.MAX_INDIVIDUAL_VARIANCE)<En.MAX_AVG_VARIANCE)return[D,R];D+=v[0]+v[1],$t.arraycopy(v,2,v,0,E-1),v[E-1]=0,v[E]=0,E--}else E++;v[E]=1,b=!b}throw new ie}static decodeDigit(l){let h=En.MAX_AVG_VARIANCE,f=-1,g=En.PATTERNS.length;for(let v=0;v<g;v++){let b=Cr.patternMatchVariance(l,En.PATTERNS[v],En.MAX_INDIVIDUAL_VARIANCE);b<h?(h=b,f=v):b===h&&(f=-1)}if(f>=0)return f%10;throw new ie}}En.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],En.MAX_AVG_VARIANCE=.38,En.MAX_INDIVIDUAL_VARIANCE=.5,En.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],En.START_PATTERN=Int32Array.from([1,1,1,1]),En.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class ur extends Cr{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(l){let f,h=!1,g=0,v=Int32Array.from([0,0,0]);for(;!h;){v=Int32Array.from([0,0,0]),f=ur.findGuardPattern(l,g,!1,this.START_END_PATTERN,v);let x=f[0];g=f[1];let b=x-(g-x);b>=0&&(h=l.isRange(b,x,!1))}return f}static checkChecksum(l){return ur.checkStandardUPCEANChecksum(l)}static checkStandardUPCEANChecksum(l){let h=l.length;if(0===h)return!1;let f=parseInt(l.charAt(h-1),10);return ur.getStandardUPCEANChecksum(l.substring(0,h-1))===f}static getStandardUPCEANChecksum(l){let h=l.length,f=0;for(let g=h-1;g>=0;g-=2){let v=l.charAt(g).charCodeAt(0)-"0".charCodeAt(0);if(v<0||v>9)throw new Re;f+=v}f*=3;for(let g=h-2;g>=0;g-=2){let v=l.charAt(g).charCodeAt(0)-"0".charCodeAt(0);if(v<0||v>9)throw new Re;f+=v}return(1e3-f)%10}static decodeEnd(l,h){return ur.findGuardPattern(l,h,!1,ur.START_END_PATTERN,new Int32Array(ur.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(l,h,f,g){return this.findGuardPattern(l,h,f,g,new Int32Array(g.length))}static findGuardPattern(l,h,f,g,v){let x=l.getSize(),b=0,E=h=f?l.getNextUnset(h):l.getNextSet(h),D=g.length,R=f;for(let F=h;F<x;F++)if(l.get(F)!==R)v[b]++;else{if(b===D-1){if(Cr.patternMatchVariance(v,g,ur.MAX_INDIVIDUAL_VARIANCE)<ur.MAX_AVG_VARIANCE)return Int32Array.from([E,F]);E+=v[0]+v[1];let B=v.slice(2,v.length-1);for(let Y=0;Y<b-1;Y++)v[Y]=B[Y];v[b-1]=0,v[b]=0,b--}else b++;v[b]=1,R=!R}throw new ie}static decodeDigit(l,h,f,g){this.recordPattern(l,f,h);let v=this.MAX_AVG_VARIANCE,x=-1,b=g.length;for(let E=0;E<b;E++){let R=Cr.patternMatchVariance(h,g[E],ur.MAX_INDIVIDUAL_VARIANCE);R<v&&(v=R,x=E)}if(x>=0)return x;throw new ie}}ur.MAX_AVG_VARIANCE=.48,ur.MAX_INDIVIDUAL_VARIANCE=.7,ur.START_END_PATTERN=Int32Array.from([1,1,1]),ur.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),ur.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),ur.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class Rs{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(l,h,f){let g=this.decodeRowStringBuffer,v=this.decodeMiddle(h,f,g),x=g.toString(),b=Rs.parseExtensionString(x),E=[new Xe((f[0]+f[1])/2,l),new Xe(v,l)],D=new Vr(x,null,0,E,pt.UPC_EAN_EXTENSION,(new Date).getTime());return null!=b&&D.putAllMetadata(b),D}decodeMiddle(l,h,f){let g=this.decodeMiddleCounters;g[0]=0,g[1]=0,g[2]=0,g[3]=0;let v=l.getSize(),x=h[1],b=0;for(let D=0;D<5&&x<v;D++){let R=ur.decodeDigit(l,g,x,ur.L_AND_G_PATTERNS);f+=String.fromCharCode("0".charCodeAt(0)+R%10);for(let F of g)x+=F;R>=10&&(b|=1<<4-D),4!==D&&(x=l.getNextSet(x),x=l.getNextUnset(x))}if(5!==f.length)throw new ie;let E=this.determineCheckDigit(b);if(Rs.extensionChecksum(f.toString())!==E)throw new ie;return x}static extensionChecksum(l){let h=l.length,f=0;for(let g=h-2;g>=0;g-=2)f+=l.charAt(g).charCodeAt(0)-"0".charCodeAt(0);f*=3;for(let g=h-1;g>=0;g-=2)f+=l.charAt(g).charCodeAt(0)-"0".charCodeAt(0);return f*=3,f%10}determineCheckDigit(l){for(let h=0;h<10;h++)if(l===this.CHECK_DIGIT_ENCODINGS[h])return h;throw new ie}static parseExtensionString(l){if(5!==l.length)return null;let h=Rs.parseExtension5String(l);return null==h?null:new Map([[wr.SUGGESTED_PRICE,h]])}static parseExtension5String(l){let h;switch(l.charAt(0)){case"0":h="\xa3";break;case"5":h="$";break;case"9":switch(l){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}h="";break;default:h=""}let f=parseInt(l.substring(1)),v=f%100;return h+(f/100).toString()+"."+(v<10?"0"+v:v.toString())}}class Ns{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(l,h,f){let g=this.decodeRowStringBuffer,v=this.decodeMiddle(h,f,g),x=g.toString(),b=Ns.parseExtensionString(x),E=[new Xe((f[0]+f[1])/2,l),new Xe(v,l)],D=new Vr(x,null,0,E,pt.UPC_EAN_EXTENSION,(new Date).getTime());return null!=b&&D.putAllMetadata(b),D}decodeMiddle(l,h,f){let g=this.decodeMiddleCounters;g[0]=0,g[1]=0,g[2]=0,g[3]=0;let v=l.getSize(),x=h[1],b=0;for(let E=0;E<2&&x<v;E++){let D=ur.decodeDigit(l,g,x,ur.L_AND_G_PATTERNS);f+=String.fromCharCode("0".charCodeAt(0)+D%10);for(let R of g)x+=R;D>=10&&(b|=1<<1-E),1!==E&&(x=l.getNextSet(x),x=l.getNextUnset(x))}if(2!==f.length)throw new ie;if(parseInt(f.toString())%4!==b)throw new ie;return x}static parseExtensionString(l){return 2!==l.length?null:new Map([[wr.ISSUE_NUMBER,parseInt(l)]])}}class Bc{static decodeRow(l,h,f){let g=ur.findGuardPattern(h,f,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return(new Rs).decodeRow(l,h,g)}catch(v){return(new Ns).decodeRow(l,h,g)}}}Bc.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class un extends ur{constructor(){super(),this.decodeRowStringBuffer="",un.L_AND_G_PATTERNS=un.L_PATTERNS.map(l=>Int32Array.from(l));for(let l=10;l<20;l++){let h=un.L_PATTERNS[l-10],f=new Int32Array(h.length);for(let g=0;g<h.length;g++)f[g]=h[h.length-g-1];un.L_AND_G_PATTERNS[l]=f}}decodeRow(l,h,f){let g=un.findStartGuardPattern(h),v=null==f?null:f.get(yn.NEED_RESULT_POINT_CALLBACK);if(null!=v){const ve=new Xe((g[0]+g[1])/2,l);v.foundPossibleResultPoint(ve)}let x=this.decodeMiddle(h,g,this.decodeRowStringBuffer),b=x.rowOffset,E=x.resultString;if(null!=v){const ve=new Xe(b,l);v.foundPossibleResultPoint(ve)}let D=un.decodeEnd(h,b);if(null!=v){const ve=new Xe((D[0]+D[1])/2,l);v.foundPossibleResultPoint(ve)}let R=D[1],F=R+(R-D[0]);if(F>=h.getSize()||!h.isRange(R,F,!1))throw new ie;let B=E.toString();if(B.length<8)throw new Re;if(!un.checkChecksum(B))throw new At;let Y=(g[1]+g[0])/2,q=(D[1]+D[0])/2,te=this.getBarcodeFormat(),re=[new Xe(Y,l),new Xe(q,l)],ae=new Vr(B,null,0,re,te,(new Date).getTime()),Te=0;try{let ve=Bc.decodeRow(l,h,D[1]);ae.putMetadata(wr.UPC_EAN_EXTENSION,ve.getText()),ae.putAllMetadata(ve.getResultMetadata()),ae.addResultPoints(ve.getResultPoints()),Te=ve.getText().length}catch(ve){}let Le=null==f?null:f.get(yn.ALLOWED_EAN_EXTENSIONS);if(null!=Le){let ve=!1;for(let Jt in Le)if(Te.toString()===Jt){ve=!0;break}if(!ve)throw new ie}return ae}static checkChecksum(l){return un.checkStandardUPCEANChecksum(l)}static checkStandardUPCEANChecksum(l){let h=l.length;if(0===h)return!1;let f=parseInt(l.charAt(h-1),10);return un.getStandardUPCEANChecksum(l.substring(0,h-1))===f}static getStandardUPCEANChecksum(l){let h=l.length,f=0;for(let g=h-1;g>=0;g-=2){let v=l.charAt(g).charCodeAt(0)-"0".charCodeAt(0);if(v<0||v>9)throw new Re;f+=v}f*=3;for(let g=h-2;g>=0;g-=2){let v=l.charAt(g).charCodeAt(0)-"0".charCodeAt(0);if(v<0||v>9)throw new Re;f+=v}return(1e3-f)%10}static decodeEnd(l,h){return un.findGuardPattern(l,h,!1,un.START_END_PATTERN,new Int32Array(un.START_END_PATTERN.length).fill(0))}}let qu=(()=>{class S extends un{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(h,f,g){let v=this.decodeMiddleCounters;v[0]=0,v[1]=0,v[2]=0,v[3]=0;let x=h.getSize(),b=f[1],E=0;for(let R=0;R<6&&b<x;R++){let F=un.decodeDigit(h,v,b,un.L_AND_G_PATTERNS);g+=String.fromCharCode("0".charCodeAt(0)+F%10);for(let B of v)b+=B;F>=10&&(E|=1<<5-R)}g=S.determineFirstDigit(g,E),b=un.findGuardPattern(h,b,!0,un.MIDDLE_PATTERN,new Int32Array(un.MIDDLE_PATTERN.length).fill(0))[1];for(let R=0;R<6&&b<x;R++){let F=un.decodeDigit(h,v,b,un.L_PATTERNS);g+=String.fromCharCode("0".charCodeAt(0)+F);for(let B of v)b+=B}return{rowOffset:b,resultString:g}}getBarcodeFormat(){return pt.EAN_13}static determineFirstDigit(h,f){for(let g=0;g<10;g++)if(f===this.FIRST_DIGIT_ENCODINGS[g])return String.fromCharCode("0".charCodeAt(0)+g)+h;throw new ie}}return S.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26],S})();class cn extends un{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(l,h,f){const g=this.decodeMiddleCounters;g[0]=0,g[1]=0,g[2]=0,g[3]=0;let v=l.getSize(),x=h[1];for(let E=0;E<4&&x<v;E++){let D=un.decodeDigit(l,g,x,un.L_PATTERNS);f+=String.fromCharCode("0".charCodeAt(0)+D);for(let R of g)x+=R}x=un.findGuardPattern(l,x,!0,un.MIDDLE_PATTERN,new Int32Array(un.MIDDLE_PATTERN.length).fill(0))[1];for(let E=0;E<4&&x<v;E++){let D=un.decodeDigit(l,g,x,un.L_PATTERNS);f+=String.fromCharCode("0".charCodeAt(0)+D);for(let R of g)x+=R}return{rowOffset:x,resultString:f}}getBarcodeFormat(){return pt.EAN_8}}class $u extends un{constructor(){super(...arguments),this.ean13Reader=new qu}getBarcodeFormat(){return pt.UPC_A}decode(l,h){return this.maybeReturnResult(this.ean13Reader.decode(l))}decodeRow(l,h,f){return this.maybeReturnResult(this.ean13Reader.decodeRow(l,h,f))}decodeMiddle(l,h,f){return this.ean13Reader.decodeMiddle(l,h,f)}maybeReturnResult(l){let h=l.getText();if("0"===h.charAt(0)){let f=new Vr(h.substring(1),null,null,l.getResultPoints(),pt.UPC_A);return null!=l.getResultMetadata()&&f.putAllMetadata(l.getResultMetadata()),f}throw new ie}reset(){this.ean13Reader.reset()}}class yt extends un{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(l,h,f){const g=this.decodeMiddleCounters.map(E=>E);g[0]=0,g[1]=0,g[2]=0,g[3]=0;const v=l.getSize();let x=h[1],b=0;for(let E=0;E<6&&x<v;E++){const D=yt.decodeDigit(l,g,x,yt.L_AND_G_PATTERNS);f+=String.fromCharCode("0".charCodeAt(0)+D%10);for(let R of g)x+=R;D>=10&&(b|=1<<5-E)}return yt.determineNumSysAndCheckDigit(new Oe(f),b),x}decodeEnd(l,h){return yt.findGuardPatternWithoutCounters(l,h,!0,yt.MIDDLE_END_PATTERN)}checkChecksum(l){return un.checkChecksum(yt.convertUPCEtoUPCA(l))}static determineNumSysAndCheckDigit(l,h){for(let f=0;f<=1;f++)for(let g=0;g<10;g++)if(h===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[f][g])return l.insert(0,"0"+f),void l.append("0"+g);throw ie.getNotFoundInstance()}getBarcodeFormat(){return pt.UPC_E}static convertUPCEtoUPCA(l){const h=l.slice(1,7).split("").map(v=>v.charCodeAt(0)),f=new Oe;f.append(l.charAt(0));let g=h[5];switch(g){case 0:case 1:case 2:f.appendChars(h,0,2),f.append(g),f.append("0000"),f.appendChars(h,2,3);break;case 3:f.appendChars(h,0,3),f.append("00000"),f.appendChars(h,3,2);break;case 4:f.appendChars(h,0,4),f.append("00000"),f.append(h[4]);break;default:f.appendChars(h,0,5),f.append("0000"),f.append(g)}return l.length>=8&&f.append(l.charAt(7)),f.toString()}}yt.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),yt.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,1])];class ri extends Cr{constructor(l){super();let h=null==l?null:l.get(yn.POSSIBLE_FORMATS),f=[];null!=h&&(h.indexOf(pt.EAN_13)>-1?f.push(new qu):h.indexOf(pt.UPC_A)>-1&&f.push(new $u),h.indexOf(pt.EAN_8)>-1&&f.push(new cn),h.indexOf(pt.UPC_E)>-1&&f.push(new yt)),0===f.length&&(f.push(new qu),f.push(new cn),f.push(new yt)),this.readers=f}decodeRow(l,h,f){for(let g of this.readers)try{const v=g.decodeRow(l,h,f),x=v.getBarcodeFormat()===pt.EAN_13&&"0"===v.getText().charAt(0),b=null==f?null:f.get(yn.POSSIBLE_FORMATS),E=null==b||b.includes(pt.UPC_A);if(x&&E){const D=v.getRawBytes(),R=new Vr(v.getText().substring(1),D,D.length,v.getResultPoints(),pt.UPC_A);return R.putAllMetadata(v.getResultMetadata()),R}return v}catch(v){}throw new ie}reset(){for(let l of this.readers)l.reset()}}let Ao=(()=>{class S extends Cr{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=new Array(4),this.evenRoundingErrors=new Array(4),this.oddCounts=new Array(this.dataCharacterCounters.length/2),this.evenCounts=new Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(h,f){for(let g=0;g<f.length;g++)if(Cr.patternMatchVariance(h,f[g],S.MAX_INDIVIDUAL_VARIANCE)<S.MAX_AVG_VARIANCE)return g;throw new ie}static count(h){return Qt.sum(new Int32Array(h))}static increment(h,f){let g=0,v=f[0];for(let x=1;x<h.length;x++)f[x]>v&&(v=f[x],g=x);h[g]++}static decrement(h,f){let g=0,v=f[0];for(let x=1;x<h.length;x++)f[x]<v&&(v=f[x],g=x);h[g]--}static isFinderPattern(h){let f=h[0]+h[1],v=f/(f+h[2]+h[3]);if(v>=S.MIN_FINDER_PATTERN_RATIO&&v<=S.MAX_FINDER_PATTERN_RATIO){let x=Number.MAX_SAFE_INTEGER,b=Number.MIN_SAFE_INTEGER;for(let E of h)E>b&&(b=E),E<x&&(x=E);return b<10*x}return!1}}return S.MAX_AVG_VARIANCE=.2,S.MAX_INDIVIDUAL_VARIANCE=.45,S.MIN_FINDER_PATTERN_RATIO=9.5/12,S.MAX_FINDER_PATTERN_RATIO=12.5/14,S})();class jo{constructor(l,h){this.value=l,this.checksumPortion=h}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(l){return l instanceof jo&&this.value===l.value&&this.checksumPortion===l.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class He{constructor(l,h,f,g,v){this.value=l,this.startEnd=h,this.value=l,this.startEnd=h,this.resultPoints=new Array,this.resultPoints.push(new Xe(f,v)),this.resultPoints.push(new Xe(g,v))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(l){return l instanceof He&&this.value===l.value}hashCode(){return this.value}}class $i{constructor(){}static getRSSvalue(l,h,f){let g=0;for(let E of l)g+=E;let v=0,x=0,b=l.length;for(let E=0;E<b-1;E++){let D;for(D=1,x|=1<<E;D<l[E];D++,x&=~(1<<E)){let R=$i.combins(g-D-1,b-E-2);if(f&&0===x&&g-D-(b-E-1)>=b-E-1&&(R-=$i.combins(g-D-(b-E),b-E-2)),b-E-1>1){let F=0;for(let B=g-D-(b-E-2);B>h;B--)F+=$i.combins(g-D-B-1,b-E-3);R-=F*(b-1-E)}else g-D>h&&R--;v+=R}g-=D}return v}static combins(l,h){let f,g;l-h>h?(g=h,f=l-h):(g=l-h,f=h);let v=1,x=1;for(let b=l;b>f;b--)v*=b,x<=g&&(v/=x,x++);for(;x<=g;)v/=x,x++;return v}}class fn{constructor(l,h){h?this.decodedInformation=null:(this.finished=l,this.decodedInformation=h)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class Ku{constructor(l){this.newPosition=l}getNewPosition(){return this.newPosition}}let Si=(()=>{class S extends Ku{constructor(h,f){super(h),this.value=f}getValue(){return this.value}isFNC1(){return this.value===S.FNC1}}return S.FNC1="$",S})();class ht extends Ku{constructor(l,h,f){super(l),f?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=h}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}let gr=(()=>{class S extends Ku{constructor(h,f,g){if(super(h),f<0||f>10||g<0||g>10)throw new Re;this.firstDigit=f,this.secondDigit=g}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return 10*this.firstDigit+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===S.FNC1}isSecondDigitFNC1(){return this.secondDigit===S.FNC1}isAnyFNC1(){return this.firstDigit===S.FNC1||this.secondDigit===S.FNC1}}return S.FNC1=10,S})();class ze{constructor(){}static parseFieldsInGeneralPurpose(l){if(!l)return null;if(l.length<2)throw new ie;let h=l.substring(0,2);for(let v of ze.TWO_DIGIT_DATA_LENGTH)if(v[0]===h)return v[1]===ze.VARIABLE_LENGTH?ze.processVariableAI(2,v[2],l):ze.processFixedAI(2,v[1],l);if(l.length<3)throw new ie;let f=l.substring(0,3);for(let v of ze.THREE_DIGIT_DATA_LENGTH)if(v[0]===f)return v[1]===ze.VARIABLE_LENGTH?ze.processVariableAI(3,v[2],l):ze.processFixedAI(3,v[1],l);for(let v of ze.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(v[0]===f)return v[1]===ze.VARIABLE_LENGTH?ze.processVariableAI(4,v[2],l):ze.processFixedAI(4,v[1],l);if(l.length<4)throw new ie;let g=l.substring(0,4);for(let v of ze.FOUR_DIGIT_DATA_LENGTH)if(v[0]===g)return v[1]===ze.VARIABLE_LENGTH?ze.processVariableAI(4,v[2],l):ze.processFixedAI(4,v[1],l);throw new ie}static processFixedAI(l,h,f){if(f.length<l)throw new ie;let g=f.substring(0,l);if(f.length<l+h)throw new ie;let v=f.substring(l,l+h),x=f.substring(l+h),b="("+g+")"+v,E=ze.parseFieldsInGeneralPurpose(x);return null==E?b:b+E}static processVariableAI(l,h,f){let v,g=f.substring(0,l);v=f.length<l+h?f.length:l+h;let x=f.substring(l,v),b=f.substring(v),E="("+g+")"+x,D=ze.parseFieldsInGeneralPurpose(b);return null==D?E:E+D}}ze.VARIABLE_LENGTH=[],ze.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",ze.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",ze.VARIABLE_LENGTH,20],["22",ze.VARIABLE_LENGTH,29],["30",ze.VARIABLE_LENGTH,8],["37",ze.VARIABLE_LENGTH,8],["90",ze.VARIABLE_LENGTH,30],["91",ze.VARIABLE_LENGTH,30],["92",ze.VARIABLE_LENGTH,30],["93",ze.VARIABLE_LENGTH,30],["94",ze.VARIABLE_LENGTH,30],["95",ze.VARIABLE_LENGTH,30],["96",ze.VARIABLE_LENGTH,30],["97",ze.VARIABLE_LENGTH,3],["98",ze.VARIABLE_LENGTH,30],["99",ze.VARIABLE_LENGTH,30]],ze.THREE_DIGIT_DATA_LENGTH=[["240",ze.VARIABLE_LENGTH,30],["241",ze.VARIABLE_LENGTH,30],["242",ze.VARIABLE_LENGTH,6],["250",ze.VARIABLE_LENGTH,30],["251",ze.VARIABLE_LENGTH,30],["253",ze.VARIABLE_LENGTH,17],["254",ze.VARIABLE_LENGTH,20],["400",ze.VARIABLE_LENGTH,30],["401",ze.VARIABLE_LENGTH,30],["402",17],["403",ze.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",ze.VARIABLE_LENGTH,20],["421",ze.VARIABLE_LENGTH,15],["422",3],["423",ze.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],ze.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",ze.VARIABLE_LENGTH,15],["391",ze.VARIABLE_LENGTH,18],["392",ze.VARIABLE_LENGTH,15],["393",ze.VARIABLE_LENGTH,18],["703",ze.VARIABLE_LENGTH,30]],ze.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",ze.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",ze.VARIABLE_LENGTH,20],["8003",ze.VARIABLE_LENGTH,30],["8004",ze.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",ze.VARIABLE_LENGTH,30],["8008",ze.VARIABLE_LENGTH,12],["8018",18],["8020",ze.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",ze.VARIABLE_LENGTH,70],["8200",ze.VARIABLE_LENGTH,70]];class Os{constructor(l){this.buffer=new Oe,this.information=l}decodeAllCodes(l,h){let f=h,g=null;for(;;){let v=this.decodeGeneralPurposeField(f,g),x=ze.parseFieldsInGeneralPurpose(v.getNewString());if(null!=x&&l.append(x),g=v.isRemaining()?""+v.getRemainingValue():null,f===v.getNewPosition())break;f=v.getNewPosition()}return l.toString()}isStillNumeric(l){if(l+7>this.information.getSize())return l+4<=this.information.getSize();for(let h=l;h<l+3;++h)if(this.information.get(h))return!0;return this.information.get(l+3)}decodeNumeric(l){if(l+7>this.information.getSize()){let v=this.extractNumericValueFromBitArray(l,4);return new gr(this.information.getSize(),0===v?gr.FNC1:v-1,gr.FNC1)}let h=this.extractNumericValueFromBitArray(l,7);return new gr(l+7,(h-8)/11,(h-8)%11)}extractNumericValueFromBitArray(l,h){return Os.extractNumericValueFromBitArray(this.information,l,h)}static extractNumericValueFromBitArray(l,h,f){let g=0;for(let v=0;v<f;++v)l.get(h+v)&&(g|=1<<f-v-1);return g}decodeGeneralPurposeField(l,h){this.buffer.setLengthToZero(),null!=h&&this.buffer.append(h),this.current.setPosition(l);let f=this.parseBlocks();return null!=f&&f.isRemaining()?new ht(this.current.getPosition(),this.buffer.toString(),f.getRemainingValue()):new ht(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let l,h;do{let f=this.current.getPosition();if(this.current.isAlpha()?(h=this.parseAlphaBlock(),l=h.isFinished()):this.current.isIsoIec646()?(h=this.parseIsoIec646Block(),l=h.isFinished()):(h=this.parseNumericBlock(),l=h.isFinished()),f===this.current.getPosition()&&!l)break}while(!l);return h.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let l=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(l.getNewPosition()),l.isFirstDigitFNC1()){let h;return h=l.isSecondDigitFNC1()?new ht(this.current.getPosition(),this.buffer.toString()):new ht(this.current.getPosition(),this.buffer.toString(),l.getSecondDigit()),new fn(!0,h)}if(this.buffer.append(l.getFirstDigit()),l.isSecondDigitFNC1()){let h=new ht(this.current.getPosition(),this.buffer.toString());return new fn(!0,h)}this.buffer.append(l.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new fn(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let l=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(l.getNewPosition()),l.isFNC1()){let h=new ht(this.current.getPosition(),this.buffer.toString());return new fn(!0,h)}this.buffer.append(l.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new fn(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let l=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(l.getNewPosition()),l.isFNC1()){let h=new ht(this.current.getPosition(),this.buffer.toString());return new fn(!0,h)}this.buffer.append(l.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new fn(!1)}isStillIsoIec646(l){if(l+5>this.information.getSize())return!1;let h=this.extractNumericValueFromBitArray(l,5);if(h>=5&&h<16)return!0;if(l+7>this.information.getSize())return!1;let f=this.extractNumericValueFromBitArray(l,7);if(f>=64&&f<116)return!0;if(l+8>this.information.getSize())return!1;let g=this.extractNumericValueFromBitArray(l,8);return g>=232&&g<253}decodeIsoIec646(l){let h=this.extractNumericValueFromBitArray(l,5);if(15===h)return new Si(l+5,Si.FNC1);if(h>=5&&h<15)return new Si(l+5,"0"+(h-5));let v,f=this.extractNumericValueFromBitArray(l,7);if(f>=64&&f<90)return new Si(l+7,""+(f+1));if(f>=90&&f<116)return new Si(l+7,""+(f+7));switch(this.extractNumericValueFromBitArray(l,8)){case 232:v="!";break;case 233:v='"';break;case 234:v="%";break;case 235:v="&";break;case 236:v="'";break;case 237:v="(";break;case 238:v=")";break;case 239:v="*";break;case 240:v="+";break;case 241:v=",";break;case 242:v="-";break;case 243:v=".";break;case 244:v="/";break;case 245:v=":";break;case 246:v=";";break;case 247:v="<";break;case 248:v="=";break;case 249:v=">";break;case 250:v="?";break;case 251:v="_";break;case 252:v=" ";break;default:throw new Re}return new Si(l+8,v)}isStillAlpha(l){if(l+5>this.information.getSize())return!1;let h=this.extractNumericValueFromBitArray(l,5);if(h>=5&&h<16)return!0;if(l+6>this.information.getSize())return!1;let f=this.extractNumericValueFromBitArray(l,6);return f>=16&&f<63}decodeAlphanumeric(l){let h=this.extractNumericValueFromBitArray(l,5);if(15===h)return new Si(l+5,Si.FNC1);if(h>=5&&h<15)return new Si(l+5,"0"+(h-5));let g,f=this.extractNumericValueFromBitArray(l,6);if(f>=32&&f<58)return new Si(l+6,""+(f+33));switch(f){case 58:g="*";break;case 59:g=",";break;case 60:g="-";break;case 61:g=".";break;case 62:g="/";break;default:throw new Vo("Decoding invalid alphanumeric value: "+f)}return new Si(l+6,g)}isAlphaTo646ToAlphaLatch(l){if(l+1>this.information.getSize())return!1;for(let h=0;h<5&&h+l<this.information.getSize();++h)if(2===h){if(!this.information.get(l+2))return!1}else if(this.information.get(l+h))return!1;return!0}isAlphaOr646ToNumericLatch(l){if(l+3>this.information.getSize())return!1;for(let h=l;h<l+3;++h)if(this.information.get(h))return!1;return!0}isNumericToAlphaNumericLatch(l){if(l+1>this.information.getSize())return!1;for(let h=0;h<4&&h+l<this.information.getSize();++h)if(this.information.get(l+h))return!1;return!0}}class kd{constructor(l){this.information=l,this.generalDecoder=new Os(l)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}let jr=(()=>{class S extends kd{constructor(h){super(h)}encodeCompressedGtin(h,f){h.append("(01)");let g=h.length();h.append("9"),this.encodeCompressedGtinWithoutAI(h,f,g)}encodeCompressedGtinWithoutAI(h,f,g){for(let v=0;v<4;++v){let x=this.getGeneralDecoder().extractNumericValueFromBitArray(f+10*v,10);x/100==0&&h.append("0"),x/10==0&&h.append("0"),h.append(x)}S.appendCheckDigit(h,g)}static appendCheckDigit(h,f){let g=0;for(let v=0;v<13;v++){let x=h.charAt(v+f).charCodeAt(0)-"0".charCodeAt(0);g+=0==(1&v)?3*x:x}g=10-g%10,10===g&&(g=0),h.append(g)}}return S.GTIN_SIZE=40,S})(),pi=(()=>{class S extends jr{constructor(h){super(h)}parseInformation(){let h=new Oe;h.append("(01)");let f=h.length(),g=this.getGeneralDecoder().extractNumericValueFromBitArray(S.HEADER_SIZE,4);return h.append(g),this.encodeCompressedGtinWithoutAI(h,S.HEADER_SIZE+4,f),this.getGeneralDecoder().decodeAllCodes(h,S.HEADER_SIZE+44)}}return S.HEADER_SIZE=4,S})(),Ul=(()=>{class S extends kd{constructor(h){super(h)}parseInformation(){let h=new Oe;return this.getGeneralDecoder().decodeAllCodes(h,S.HEADER_SIZE)}}return S.HEADER_SIZE=5,S})();class Ti extends jr{constructor(l){super(l)}encodeCompressedWeight(l,h,f){let g=this.getGeneralDecoder().extractNumericValueFromBitArray(h,f);this.addWeightCode(l,g);let v=this.checkWeight(g),x=1e5;for(let b=0;b<5;++b)v/x==0&&l.append("0"),x/=10;l.append(v)}}let ho=(()=>{class S extends Ti{constructor(h){super(h)}parseInformation(){if(this.getInformation().getSize()!=S.HEADER_SIZE+Ti.GTIN_SIZE+S.WEIGHT_SIZE)throw new ie;let h=new Oe;return this.encodeCompressedGtin(h,S.HEADER_SIZE),this.encodeCompressedWeight(h,S.HEADER_SIZE+Ti.GTIN_SIZE,S.WEIGHT_SIZE),h.toString()}}return S.HEADER_SIZE=5,S.WEIGHT_SIZE=15,S})();class Ho extends ho{constructor(l){super(l)}addWeightCode(l,h){l.append("(3103)")}checkWeight(l){return l}}class dg extends ho{constructor(l){super(l)}addWeightCode(l,h){l.append(h<1e4?"(3202)":"(3203)")}checkWeight(l){return l<1e4?l:l-1e4}}let Pd=(()=>{class S extends jr{constructor(h){super(h)}parseInformation(){if(this.getInformation().getSize()<S.HEADER_SIZE+jr.GTIN_SIZE)throw new ie;let h=new Oe;this.encodeCompressedGtin(h,S.HEADER_SIZE);let f=this.getGeneralDecoder().extractNumericValueFromBitArray(S.HEADER_SIZE+jr.GTIN_SIZE,S.LAST_DIGIT_SIZE);h.append("(392"),h.append(f),h.append(")");let g=this.getGeneralDecoder().decodeGeneralPurposeField(S.HEADER_SIZE+jr.GTIN_SIZE+S.LAST_DIGIT_SIZE,null);return h.append(g.getNewString()),h.toString()}}return S.HEADER_SIZE=8,S.LAST_DIGIT_SIZE=2,S})(),Fd=(()=>{class S extends jr{constructor(h){super(h)}parseInformation(){if(this.getInformation().getSize()<S.HEADER_SIZE+jr.GTIN_SIZE)throw new ie;let h=new Oe;this.encodeCompressedGtin(h,S.HEADER_SIZE);let f=this.getGeneralDecoder().extractNumericValueFromBitArray(S.HEADER_SIZE+jr.GTIN_SIZE,S.LAST_DIGIT_SIZE);h.append("(393"),h.append(f),h.append(")");let g=this.getGeneralDecoder().extractNumericValueFromBitArray(S.HEADER_SIZE+jr.GTIN_SIZE+S.LAST_DIGIT_SIZE,S.FIRST_THREE_DIGITS_SIZE);g/100==0&&h.append("0"),g/10==0&&h.append("0"),h.append(g);let v=this.getGeneralDecoder().decodeGeneralPurposeField(S.HEADER_SIZE+jr.GTIN_SIZE+S.LAST_DIGIT_SIZE+S.FIRST_THREE_DIGITS_SIZE,null);return h.append(v.getNewString()),h.toString()}}return S.HEADER_SIZE=8,S.LAST_DIGIT_SIZE=2,S.FIRST_THREE_DIGITS_SIZE=10,S})(),fo=(()=>{class S extends Ti{constructor(h,f,g){super(h),this.dateCode=g,this.firstAIdigits=f}parseInformation(){if(this.getInformation().getSize()!=S.HEADER_SIZE+S.GTIN_SIZE+S.WEIGHT_SIZE+S.DATE_SIZE)throw new ie;let h=new Oe;return this.encodeCompressedGtin(h,S.HEADER_SIZE),this.encodeCompressedWeight(h,S.HEADER_SIZE+S.GTIN_SIZE,S.WEIGHT_SIZE),this.encodeCompressedDate(h,S.HEADER_SIZE+S.GTIN_SIZE+S.WEIGHT_SIZE),h.toString()}encodeCompressedDate(h,f){let g=this.getGeneralDecoder().extractNumericValueFromBitArray(f,S.DATE_SIZE);if(38400==g)return;h.append("("),h.append(this.dateCode),h.append(")");let v=g%32;g/=32;let x=g%12+1;g/=12;let b=g;b/10==0&&h.append("0"),h.append(b),x/10==0&&h.append("0"),h.append(x),v/10==0&&h.append("0"),h.append(v)}addWeightCode(h,f){h.append("("),h.append(this.firstAIdigits),h.append(f/1e5),h.append(")")}checkWeight(h){return h%1e5}}return S.HEADER_SIZE=8,S.WEIGHT_SIZE=20,S.DATE_SIZE=16,S})();class ks{constructor(l,h,f,g){this.leftchar=l,this.rightchar=h,this.finderpattern=f,this.maybeLast=g}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return null==this.rightchar}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(null==this.finderpattern?"null":this.finderpattern.getValue())+" ]"}static equals(l,h){return l instanceof ks&&ks.equalsOrNull(l.leftchar,h.leftchar)&&ks.equalsOrNull(l.rightchar,h.rightchar)&&ks.equalsOrNull(l.finderpattern,h.finderpattern)}static equalsOrNull(l,h){return null===l?null===h:ks.equals(l,h)}hashCode(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()}}class Vc{constructor(l,h,f){this.pairs=l,this.rowNumber=h,this.wasReversed=f}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(l){return this.checkEqualitity(this,l)}toString(){return"{ "+this.pairs+" }"}equals(l,h){return l instanceof Vc&&this.checkEqualitity(l,h)&&l.wasReversed===h.wasReversed}checkEqualitity(l,h){if(!l||!h)return;let f;return l.forEach((g,v)=>{h.forEach(x=>{g.getLeftChar().getValue()===x.getLeftChar().getValue()&&g.getRightChar().getValue()===x.getRightChar().getValue()&&g.getFinderPatter().getValue()===x.getFinderPatter().getValue()&&(f=!0)})}),f}}class Ce extends Ao{constructor(l){super(...arguments),this.pairs=new Array(Ce.MAX_PAIRS),this.rows=new Array,this.startEnd=[2],this.verbose=!0===l}decodeRow(l,h,f){this.pairs.length=0,this.startFromEven=!1;try{return Ce.constructResult(this.decodeRow2pairs(l,h))}catch(g){this.verbose&&console.log(g)}return this.pairs.length=0,this.startFromEven=!0,Ce.constructResult(this.decodeRow2pairs(l,h))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(l,h){let g,f=!1;for(;!f;)try{this.pairs.push(this.retrieveNextPair(h,this.pairs,l))}catch(v){if(v instanceof ie){if(!this.pairs.length)throw new ie;f=!0}}if(this.checkChecksum())return this.pairs;if(g=!!this.rows.length,this.storeRow(l,!1),g){let v=this.checkRowsBoolean(!1);if(null!=v||(v=this.checkRowsBoolean(!0),null!=v))return v}throw new ie}checkRowsBoolean(l){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,l&&(this.rows=this.rows.reverse());let h=null;try{h=this.checkRows(new Array,0)}catch(f){this.verbose&&console.log(f)}return l&&(this.rows=this.rows.reverse()),h}checkRows(l,h){for(let f=h;f<this.rows.length;f++){let g=this.rows[f];this.pairs.length=0;for(let x of l)this.pairs.push(x.getPairs());if(this.pairs.push(g.getPairs()),!Ce.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let v=new Array(l);v.push(g);try{return this.checkRows(v,f+1)}catch(x){this.verbose&&console.log(x)}}throw new ie}static isValidSequence(l){for(let h of Ce.FINDER_PATTERN_SEQUENCES){if(l.length>h.length)continue;let f=!0;for(let g=0;g<l.length;g++)if(l[g].getFinderPattern().getValue()!=h[g]){f=!1;break}if(f)return!0}return!1}storeRow(l,h){let f=0,g=!1,v=!1;for(;f<this.rows.length;){let x=this.rows[f];if(x.getRowNumber()>l){v=x.isEquivalent(this.pairs);break}g=x.isEquivalent(this.pairs),f++}v||g||Ce.isPartialRow(this.pairs,this.rows)||(this.rows.push(f,new Vc(this.pairs,l,h)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(l,h){for(let f of h)if(f.getPairs().length!==l.length)for(let g of f.getPairs())for(let v of l)if(ks.equals(g,v))break}static isPartialRow(l,h){for(let f of h){let g=!0;for(let v of l){let x=!1;for(let b of f.getPairs())if(v.equals(b)){x=!0;break}if(!x){g=!1;break}}if(g)return!0}return!1}getRows(){return this.rows}static constructResult(l){let g=function(S){try{if(S.get(1))return new pi(S);if(!S.get(2))return new Ul(S);switch(Os.extractNumericValueFromBitArray(S,1,4)){case 4:return new Ho(S);case 5:return new dg(S)}switch(Os.extractNumericValueFromBitArray(S,1,5)){case 12:return new Pd(S);case 13:return new Fd(S)}switch(Os.extractNumericValueFromBitArray(S,1,7)){case 56:return new fo(S,"310","11");case 57:return new fo(S,"320","11");case 58:return new fo(S,"310","13");case 59:return new fo(S,"320","13");case 60:return new fo(S,"310","15");case 61:return new fo(S,"320","15");case 62:return new fo(S,"310","17");case 63:return new fo(S,"320","17")}}catch(l){throw console.log(l),new Vo("unknown decoder: "+S)}}(class{static buildBitArray(l){let h=2*l.length-1;null==l[l.length-1].getRightChar()&&(h-=1);let g=new xt(12*h),v=0,b=l[0].getRightChar().getValue();for(let E=11;E>=0;--E)0!=(b&1<<E)&&g.set(v),v++;for(let E=1;E<l.length;++E){let D=l[E],R=D.getLeftChar().getValue();for(let F=11;F>=0;--F)0!=(R&1<<F)&&g.set(v),v++;if(null!=D.getRightChar()){let F=D.getRightChar().getValue();for(let B=11;B>=0;--B)0!=(F&1<<B)&&g.set(v),v++}}return g}}.buildBitArray(l)).parseInformation(),v=l[0].getFinderPattern().getResultPoints(),x=l[l.length-1].getFinderPattern().getResultPoints();return new Vr(g,null,null,[v[0],v[1],x[0],x[1]],pt.RSS_EXPANDED,null)}checkChecksum(){let l=this.pairs.get(0),h=l.getLeftChar(),f=l.getRightChar();if(null==f)return!1;let g=f.getChecksumPortion(),v=2;for(let b=1;b<this.pairs.size();++b){let E=this.pairs.get(b);g+=E.getLeftChar().getChecksumPortion(),v++;let D=E.getRightChar();null!=D&&(g+=D.getChecksumPortion(),v++)}return g%=211,211*(v-4)+g==h.getValue()}static getNextSecondBar(l,h){let f;return l.get(h)?(f=l.getNextUnset(h),f=l.getNextSet(f)):(f=l.getNextSet(h),f=l.getNextUnset(f)),f}retrieveNextPair(l,h,f){let g=h.length%2==0;this.startFromEven&&(g=!g);let v,x=!0,b=-1;do{this.findNextPair(l,h,b),v=this.parseFoundFinderPattern(l,f,g),null==v?b=Ce.getNextSecondBar(l,this.startEnd[0]):x=!1}while(x);let D,E=this.decodeDataCharacter(l,v,g,!0);if(!this.isEmptyPair(h)&&h[h.length-1].mustBeLast())throw new ie;try{D=this.decodeDataCharacter(l,v,g,!1)}catch(R){D=null,this.verbose&&console.log(R)}return new ks(E,D,v,!0)}isEmptyPair(l){return 0===l.length}findNextPair(l,h,f){let g=this.getDecodeFinderCounters();g[0]=0,g[1]=0,g[2]=0,g[3]=0;let x,v=l.getSize();x=f>=0?f:this.isEmptyPair(h)?0:h[h.length-1].getFinderPattern().getStartEnd()[1];let b=h.length%2!=0;this.startFromEven&&(b=!b);let E=!1;for(;x<v&&(E=!l.get(x),E);)x++;let D=0,R=x;for(let F=x;F<v;F++)if(l.get(F)!=E)g[D]++;else{if(3==D){if(b&&Ce.reverseCounters(g),Ce.isFinderPattern(g))return this.startEnd[0]=R,void(this.startEnd[1]=F);b&&Ce.reverseCounters(g),R+=g[0]+g[1],g[0]=g[2],g[1]=g[3],g[2]=0,g[3]=0,D--}else D++;g[D]=1,E=!E}throw new ie}static reverseCounters(l){let h=l.length;for(let f=0;f<h/2;++f){let g=l[f];l[f]=l[h-f-1],l[h-f-1]=g}}parseFoundFinderPattern(l,h,f){let g,v,x;if(f){let D=this.startEnd[0]-1;for(;D>=0&&!l.get(D);)D--;D++,g=this.startEnd[0]-D,v=D,x=this.startEnd[1]}else v=this.startEnd[0],x=l.getNextUnset(this.startEnd[1]+1),g=x-this.startEnd[1];let E,b=this.getDecodeFinderCounters();$t.arraycopy(b,0,b,1,b.length-1),b[0]=g;try{E=this.parseFinderValue(b,Ce.FINDER_PATTERNS)}catch(D){return null}return new He(E,[v,x],v,x,h)}decodeDataCharacter(l,h,f,g){let v=this.getDataCharacterCounters();for(let Gn=0;Gn<v.length;Gn++)v[Gn]=0;if(g)Ce.recordPatternInReverse(l,h.getStartEnd()[0],v);else{Ce.recordPattern(l,h.getStartEnd()[1],v);for(let Gn=0,mi=v.length-1;Gn<mi;Gn++,mi--){let Sn=v[Gn];v[Gn]=v[mi],v[mi]=Sn}}let b=Qt.sum(new Int32Array(v))/17,E=(h.getStartEnd()[1]-h.getStartEnd()[0])/15;if(Math.abs(b-E)/E>.3)throw new ie;let D=this.getOddCounts(),R=this.getEvenCounts(),F=this.getOddRoundingErrors(),B=this.getEvenRoundingErrors();for(let Gn=0;Gn<v.length;Gn++){let mi=1*v[Gn]/b,Sn=mi+.5;if(Sn<1){if(mi<.3)throw new ie;Sn=1}else if(Sn>8){if(mi>8.7)throw new ie;Sn=8}let nc=Gn/2;0==(1&Gn)?(D[nc]=Sn,F[nc]=mi-Sn):(R[nc]=Sn,B[nc]=mi-Sn)}this.adjustOddEvenCounts(17);let Y=4*h.getValue()+(f?0:2)+(g?0:1)-1,q=0,te=0;for(let Gn=D.length-1;Gn>=0;Gn--)Ce.isNotA1left(h,f,g)&&(te+=D[Gn]*Ce.WEIGHTS[Y][2*Gn]),q+=D[Gn];let re=0;for(let Gn=R.length-1;Gn>=0;Gn--)Ce.isNotA1left(h,f,g)&&(re+=R[Gn]*Ce.WEIGHTS[Y][2*Gn+1]);let ae=te+re;if(0!=(1&q)||q>13||q<4)throw new ie;let Te=(13-q)/2,Le=Ce.SYMBOL_WIDEST[Te],ve=9-Le,Jt=$i.getRSSvalue(D,Le,!0),Rt=$i.getRSSvalue(R,ve,!1);return new jo(Jt*Ce.EVEN_TOTAL_SUBSET[Te]+Rt+Ce.GSUM[Te],ae)}static isNotA1left(l,h,f){return!(0==l.getValue()&&h&&f)}adjustOddEvenCounts(l){let h=Qt.sum(new Int32Array(this.getOddCounts())),f=Qt.sum(new Int32Array(this.getEvenCounts())),g=!1,v=!1;h>13?v=!0:h<4&&(g=!0);let x=!1,b=!1;f>13?b=!0:f<4&&(x=!0);let E=h+f-l,D=1==(1&h),R=0==(1&f);if(1==E)if(D){if(R)throw new ie;v=!0}else{if(!R)throw new ie;b=!0}else if(-1==E)if(D){if(R)throw new ie;g=!0}else{if(!R)throw new ie;x=!0}else{if(0!=E)throw new ie;if(D){if(!R)throw new ie;h<f?(g=!0,b=!0):(v=!0,x=!0)}else if(R)throw new ie}if(g){if(v)throw new ie;Ce.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(v&&Ce.decrement(this.getOddCounts(),this.getOddRoundingErrors()),x){if(b)throw new ie;Ce.increment(this.getEvenCounts(),this.getOddRoundingErrors())}b&&Ce.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}Ce.SYMBOL_WIDEST=[7,5,4,3,1],Ce.EVEN_TOTAL_SUBSET=[4,20,52,104,204],Ce.GSUM=[0,348,1388,2948,3988],Ce.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],Ce.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],Ce.FINDER_PAT_A=0,Ce.FINDER_PAT_B=1,Ce.FINDER_PAT_C=2,Ce.FINDER_PAT_D=3,Ce.FINDER_PAT_E=4,Ce.FINDER_PAT_F=5,Ce.FINDER_PATTERN_SEQUENCES=[[Ce.FINDER_PAT_A,Ce.FINDER_PAT_A],[Ce.FINDER_PAT_A,Ce.FINDER_PAT_B,Ce.FINDER_PAT_B],[Ce.FINDER_PAT_A,Ce.FINDER_PAT_C,Ce.FINDER_PAT_B,Ce.FINDER_PAT_D],[Ce.FINDER_PAT_A,Ce.FINDER_PAT_E,Ce.FINDER_PAT_B,Ce.FINDER_PAT_D,Ce.FINDER_PAT_C],[Ce.FINDER_PAT_A,Ce.FINDER_PAT_E,Ce.FINDER_PAT_B,Ce.FINDER_PAT_D,Ce.FINDER_PAT_D,Ce.FINDER_PAT_F],[Ce.FINDER_PAT_A,Ce.FINDER_PAT_E,Ce.FINDER_PAT_B,Ce.FINDER_PAT_D,Ce.FINDER_PAT_E,Ce.FINDER_PAT_F,Ce.FINDER_PAT_F],[Ce.FINDER_PAT_A,Ce.FINDER_PAT_A,Ce.FINDER_PAT_B,Ce.FINDER_PAT_B,Ce.FINDER_PAT_C,Ce.FINDER_PAT_C,Ce.FINDER_PAT_D,Ce.FINDER_PAT_D],[Ce.FINDER_PAT_A,Ce.FINDER_PAT_A,Ce.FINDER_PAT_B,Ce.FINDER_PAT_B,Ce.FINDER_PAT_C,Ce.FINDER_PAT_C,Ce.FINDER_PAT_D,Ce.FINDER_PAT_E,Ce.FINDER_PAT_E],[Ce.FINDER_PAT_A,Ce.FINDER_PAT_A,Ce.FINDER_PAT_B,Ce.FINDER_PAT_B,Ce.FINDER_PAT_C,Ce.FINDER_PAT_C,Ce.FINDER_PAT_D,Ce.FINDER_PAT_E,Ce.FINDER_PAT_F,Ce.FINDER_PAT_F],[Ce.FINDER_PAT_A,Ce.FINDER_PAT_A,Ce.FINDER_PAT_B,Ce.FINDER_PAT_B,Ce.FINDER_PAT_C,Ce.FINDER_PAT_D,Ce.FINDER_PAT_D,Ce.FINDER_PAT_E,Ce.FINDER_PAT_E,Ce.FINDER_PAT_F,Ce.FINDER_PAT_F]],Ce.MAX_PAIRS=11;class Mi extends jo{constructor(l,h,f){super(l,h),this.count=0,this.finderPattern=f}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class Et extends Ao{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(l,h,f){const g=this.decodePair(h,!1,l,f);Et.addOrTally(this.possibleLeftPairs,g),h.reverse();let v=this.decodePair(h,!0,l,f);Et.addOrTally(this.possibleRightPairs,v),h.reverse();for(let x of this.possibleLeftPairs)if(x.getCount()>1)for(let b of this.possibleRightPairs)if(b.getCount()>1&&Et.checkChecksum(x,b))return Et.constructResult(x,b);throw new ie}static addOrTally(l,h){if(null==h)return;let f=!1;for(let g of l)if(g.getValue()===h.getValue()){g.incrementCount(),f=!0;break}f||l.push(h)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(l,h){let f=4537077*l.getValue()+h.getValue(),g=new String(f).toString(),v=new Oe;for(let D=13-g.length;D>0;D--)v.append("0");v.append(g);let x=0;for(let D=0;D<13;D++){let R=v.charAt(D).charCodeAt(0)-"0".charCodeAt(0);x+=0==(1&D)?3*R:R}x=10-x%10,10===x&&(x=0),v.append(x.toString());let b=l.getFinderPattern().getResultPoints(),E=h.getFinderPattern().getResultPoints();return new Vr(v.toString(),null,0,[b[0],b[1],E[0],E[1]],pt.RSS_14,(new Date).getTime())}static checkChecksum(l,h){let f=(l.getChecksumPortion()+16*h.getChecksumPortion())%79,g=9*l.getFinderPattern().getValue()+h.getFinderPattern().getValue();return g>72&&g--,g>8&&g--,f===g}decodePair(l,h,f,g){try{let v=this.findFinderPattern(l,h),x=this.parseFoundFinderPattern(l,f,h,v),b=null==g?null:g.get(yn.NEED_RESULT_POINT_CALLBACK);if(null!=b){let R=(v[0]+v[1])/2;h&&(R=l.getSize()-1-R),b.foundPossibleResultPoint(new Xe(R,f))}let E=this.decodeDataCharacter(l,x,!0),D=this.decodeDataCharacter(l,x,!1);return new Mi(1597*E.getValue()+D.getValue(),E.getChecksumPortion()+4*D.getChecksumPortion(),x)}catch(v){return null}}decodeDataCharacter(l,h,f){let g=this.getDataCharacterCounters();for(let re=0;re<g.length;re++)g[re]=0;if(f)Cr.recordPatternInReverse(l,h.getStartEnd()[0],g);else{Cr.recordPattern(l,h.getStartEnd()[1]+1,g);for(let re=0,ae=g.length-1;re<ae;re++,ae--){let Te=g[re];g[re]=g[ae],g[ae]=Te}}let v=f?16:15,x=Qt.sum(new Int32Array(g))/v,b=this.getOddCounts(),E=this.getEvenCounts(),D=this.getOddRoundingErrors(),R=this.getEvenRoundingErrors();for(let re=0;re<g.length;re++){let ae=g[re]/x,Te=Math.floor(ae+.5);Te<1?Te=1:Te>8&&(Te=8);let Le=Math.floor(re/2);0==(1&re)?(b[Le]=Te,D[Le]=ae-Te):(E[Le]=Te,R[Le]=ae-Te)}this.adjustOddEvenCounts(f,v);let F=0,B=0;for(let re=b.length-1;re>=0;re--)B*=9,B+=b[re],F+=b[re];let Y=0,q=0;for(let re=E.length-1;re>=0;re--)Y*=9,Y+=E[re],q+=E[re];let te=B+3*Y;if(f){if(0!=(1&F)||F>12||F<4)throw new ie;let re=(12-F)/2,ae=Et.OUTSIDE_ODD_WIDEST[re],Te=9-ae,Le=$i.getRSSvalue(b,ae,!1),ve=$i.getRSSvalue(E,Te,!0);return new jo(Le*Et.OUTSIDE_EVEN_TOTAL_SUBSET[re]+ve+Et.OUTSIDE_GSUM[re],te)}{if(0!=(1&q)||q>10||q<4)throw new ie;let re=(10-q)/2,ae=Et.INSIDE_ODD_WIDEST[re],Te=9-ae,Le=$i.getRSSvalue(b,ae,!0),ve=$i.getRSSvalue(E,Te,!1);return new jo(ve*Et.INSIDE_ODD_TOTAL_SUBSET[re]+Le+Et.INSIDE_GSUM[re],te)}}findFinderPattern(l,h){let f=this.getDecodeFinderCounters();f[0]=0,f[1]=0,f[2]=0,f[3]=0;let g=l.getSize(),v=!1,x=0;for(;x<g&&(v=!l.get(x),h!==v);)x++;let b=0,E=x;for(let D=x;D<g;D++)if(l.get(D)!==v)f[b]++;else{if(3===b){if(Ao.isFinderPattern(f))return[E,D];E+=f[0]+f[1],f[0]=f[2],f[1]=f[3],f[2]=0,f[3]=0,b--}else b++;f[b]=1,v=!v}throw new ie}parseFoundFinderPattern(l,h,f,g){let v=l.get(g[0]),x=g[0]-1;for(;x>=0&&v!==l.get(x);)x--;x++;const b=g[0]-x,E=this.getDecodeFinderCounters(),D=new Int32Array(E.length);$t.arraycopy(E,0,D,1,E.length-1),D[0]=b;const R=this.parseFinderValue(D,Et.FINDER_PATTERNS);let F=x,B=g[1];return f&&(F=l.getSize()-1-F,B=l.getSize()-1-B),new He(R,[x,g[1]],F,B,h)}adjustOddEvenCounts(l,h){let f=Qt.sum(new Int32Array(this.getOddCounts())),g=Qt.sum(new Int32Array(this.getEvenCounts())),v=!1,x=!1,b=!1,E=!1;l?(f>12?x=!0:f<4&&(v=!0),g>12?E=!0:g<4&&(b=!0)):(f>11?x=!0:f<5&&(v=!0),g>10?E=!0:g<4&&(b=!0));let D=f+g-h,R=(1&f)==(l?1:0),F=1==(1&g);if(1===D)if(R){if(F)throw new ie;x=!0}else{if(!F)throw new ie;E=!0}else if(-1===D)if(R){if(F)throw new ie;v=!0}else{if(!F)throw new ie;b=!0}else{if(0!==D)throw new ie;if(R){if(!F)throw new ie;f<g?(v=!0,E=!0):(x=!0,b=!0)}else if(F)throw new ie}if(v){if(x)throw new ie;Ao.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(x&&Ao.decrement(this.getOddCounts(),this.getOddRoundingErrors()),b){if(E)throw new ie;Ao.increment(this.getEvenCounts(),this.getOddRoundingErrors())}E&&Ao.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}Et.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],Et.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],Et.OUTSIDE_GSUM=[0,161,961,2015,2715],Et.INSIDE_GSUM=[0,336,1036,1516],Et.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],Et.INSIDE_ODD_WIDEST=[2,4,6,8],Et.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class ou extends Cr{constructor(l,h){super(),this.readers=[],this.verbose=!0===h;const f=l?l.get(yn.POSSIBLE_FORMATS):null,g=l&&void 0!==l.get(yn.ASSUME_CODE_39_CHECK_DIGIT);f&&((f.includes(pt.EAN_13)||f.includes(pt.UPC_A)||f.includes(pt.EAN_8)||f.includes(pt.UPC_E))&&this.readers.push(new ri(l)),f.includes(pt.CODE_39)&&this.readers.push(new Xu(g)),f.includes(pt.CODE_128)&&this.readers.push(new Me),f.includes(pt.ITF)&&this.readers.push(new En),f.includes(pt.RSS_14)&&this.readers.push(new Et),f.includes(pt.RSS_EXPANDED)&&this.readers.push(new Ce(this.verbose))),0===this.readers.length&&(this.readers.push(new ri(l)),this.readers.push(new Xu),this.readers.push(new ri(l)),this.readers.push(new Me),this.readers.push(new En),this.readers.push(new Et),this.readers.push(new Ce(this.verbose)))}decodeRow(l,h,f){for(let g=0;g<this.readers.length;g++)try{return this.readers[g].decodeRow(l,h,f)}catch(v){}throw new ie}reset(){this.readers.forEach(l=>l.reset())}}class In{constructor(l,h,f){this.ecCodewords=l,this.ecBlocks=[h],f&&this.ecBlocks.push(f)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class Ve{constructor(l,h){this.count=l,this.dataCodewords=h}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class nn{constructor(l,h,f,g,v,x){this.versionNumber=l,this.symbolSizeRows=h,this.symbolSizeColumns=f,this.dataRegionSizeRows=g,this.dataRegionSizeColumns=v,this.ecBlocks=x;let b=0;const E=x.getECCodewords(),D=x.getECBlocks();for(let R of D)b+=R.getCount()*(R.getDataCodewords()+E);this.totalCodewords=b}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(l,h){if(0!=(1&l)||0!=(1&h))throw new Re;for(let f of nn.VERSIONS)if(f.symbolSizeRows===l&&f.symbolSizeColumns===h)return f;throw new Re}toString(){return""+this.versionNumber}static buildVersions(){return[new nn(1,10,10,8,8,new In(5,new Ve(1,3))),new nn(2,12,12,10,10,new In(7,new Ve(1,5))),new nn(3,14,14,12,12,new In(10,new Ve(1,8))),new nn(4,16,16,14,14,new In(12,new Ve(1,12))),new nn(5,18,18,16,16,new In(14,new Ve(1,18))),new nn(6,20,20,18,18,new In(18,new Ve(1,22))),new nn(7,22,22,20,20,new In(20,new Ve(1,30))),new nn(8,24,24,22,22,new In(24,new Ve(1,36))),new nn(9,26,26,24,24,new In(28,new Ve(1,44))),new nn(10,32,32,14,14,new In(36,new Ve(1,62))),new nn(11,36,36,16,16,new In(42,new Ve(1,86))),new nn(12,40,40,18,18,new In(48,new Ve(1,114))),new nn(13,44,44,20,20,new In(56,new Ve(1,144))),new nn(14,48,48,22,22,new In(68,new Ve(1,174))),new nn(15,52,52,24,24,new In(42,new Ve(2,102))),new nn(16,64,64,14,14,new In(56,new Ve(2,140))),new nn(17,72,72,16,16,new In(36,new Ve(4,92))),new nn(18,80,80,18,18,new In(48,new Ve(4,114))),new nn(19,88,88,20,20,new In(56,new Ve(4,144))),new nn(20,96,96,22,22,new In(68,new Ve(4,174))),new nn(21,104,104,24,24,new In(56,new Ve(6,136))),new nn(22,120,120,18,18,new In(68,new Ve(6,175))),new nn(23,132,132,20,20,new In(62,new Ve(8,163))),new nn(24,144,144,22,22,new In(62,new Ve(8,156),new Ve(2,155))),new nn(25,8,18,6,16,new In(7,new Ve(1,5))),new nn(26,8,32,6,14,new In(11,new Ve(1,10))),new nn(27,12,26,10,24,new In(14,new Ve(1,16))),new nn(28,12,36,10,16,new In(18,new Ve(1,22))),new nn(29,16,36,14,16,new In(24,new Ve(1,32))),new nn(30,16,48,14,22,new In(28,new Ve(1,49)))]}}nn.VERSIONS=nn.buildVersions();class ji{constructor(l){const h=l.getHeight();if(h<8||h>144||0!=(1&h))throw new Re;this.version=ji.readVersion(l),this.mappingBitMatrix=this.extractDataRegion(l),this.readMappingMatrix=new bt(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(l){const h=l.getHeight(),f=l.getWidth();return nn.getVersionForDimensions(h,f)}readCodewords(){const l=new Int8Array(this.version.getTotalCodewords());let h=0,f=4,g=0;const v=this.mappingBitMatrix.getHeight(),x=this.mappingBitMatrix.getWidth();let b=!1,E=!1,D=!1,R=!1;do{if(f!==v||0!==g||b)if(f!==v-2||0!==g||0==(3&x)||E)if(f!==v+4||2!==g||0!=(7&x)||D)if(f!==v-2||0!==g||4!=(7&x)||R){do{f<v&&g>=0&&!this.readMappingMatrix.get(g,f)&&(l[h++]=255&this.readUtah(f,g,v,x)),f-=2,g+=2}while(f>=0&&g<x);f+=1,g+=3;do{f>=0&&g<x&&!this.readMappingMatrix.get(g,f)&&(l[h++]=255&this.readUtah(f,g,v,x)),f+=2,g-=2}while(f<v&&g>=0);f+=3,g+=1}else l[h++]=255&this.readCorner4(v,x),f-=2,g+=2,R=!0;else l[h++]=255&this.readCorner3(v,x),f-=2,g+=2,D=!0;else l[h++]=255&this.readCorner2(v,x),f-=2,g+=2,E=!0;else l[h++]=255&this.readCorner1(v,x),f-=2,g+=2,b=!0}while(f<v||g<x);if(h!==this.version.getTotalCodewords())throw new Re;return l}readModule(l,h,f,g){return l<0&&(l+=f,h+=4-(f+4&7)),h<0&&(h+=g,l+=4-(g+4&7)),this.readMappingMatrix.set(h,l),this.mappingBitMatrix.get(h,l)}readUtah(l,h,f,g){let v=0;return this.readModule(l-2,h-2,f,g)&&(v|=1),v<<=1,this.readModule(l-2,h-1,f,g)&&(v|=1),v<<=1,this.readModule(l-1,h-2,f,g)&&(v|=1),v<<=1,this.readModule(l-1,h-1,f,g)&&(v|=1),v<<=1,this.readModule(l-1,h,f,g)&&(v|=1),v<<=1,this.readModule(l,h-2,f,g)&&(v|=1),v<<=1,this.readModule(l,h-1,f,g)&&(v|=1),v<<=1,this.readModule(l,h,f,g)&&(v|=1),v}readCorner1(l,h){let f=0;return this.readModule(l-1,0,l,h)&&(f|=1),f<<=1,this.readModule(l-1,1,l,h)&&(f|=1),f<<=1,this.readModule(l-1,2,l,h)&&(f|=1),f<<=1,this.readModule(0,h-2,l,h)&&(f|=1),f<<=1,this.readModule(0,h-1,l,h)&&(f|=1),f<<=1,this.readModule(1,h-1,l,h)&&(f|=1),f<<=1,this.readModule(2,h-1,l,h)&&(f|=1),f<<=1,this.readModule(3,h-1,l,h)&&(f|=1),f}readCorner2(l,h){let f=0;return this.readModule(l-3,0,l,h)&&(f|=1),f<<=1,this.readModule(l-2,0,l,h)&&(f|=1),f<<=1,this.readModule(l-1,0,l,h)&&(f|=1),f<<=1,this.readModule(0,h-4,l,h)&&(f|=1),f<<=1,this.readModule(0,h-3,l,h)&&(f|=1),f<<=1,this.readModule(0,h-2,l,h)&&(f|=1),f<<=1,this.readModule(0,h-1,l,h)&&(f|=1),f<<=1,this.readModule(1,h-1,l,h)&&(f|=1),f}readCorner3(l,h){let f=0;return this.readModule(l-1,0,l,h)&&(f|=1),f<<=1,this.readModule(l-1,h-1,l,h)&&(f|=1),f<<=1,this.readModule(0,h-3,l,h)&&(f|=1),f<<=1,this.readModule(0,h-2,l,h)&&(f|=1),f<<=1,this.readModule(0,h-1,l,h)&&(f|=1),f<<=1,this.readModule(1,h-3,l,h)&&(f|=1),f<<=1,this.readModule(1,h-2,l,h)&&(f|=1),f<<=1,this.readModule(1,h-1,l,h)&&(f|=1),f}readCorner4(l,h){let f=0;return this.readModule(l-3,0,l,h)&&(f|=1),f<<=1,this.readModule(l-2,0,l,h)&&(f|=1),f<<=1,this.readModule(l-1,0,l,h)&&(f|=1),f<<=1,this.readModule(0,h-2,l,h)&&(f|=1),f<<=1,this.readModule(0,h-1,l,h)&&(f|=1),f<<=1,this.readModule(1,h-1,l,h)&&(f|=1),f<<=1,this.readModule(2,h-1,l,h)&&(f|=1),f<<=1,this.readModule(3,h-1,l,h)&&(f|=1),f}extractDataRegion(l){const h=this.version.getSymbolSizeRows(),f=this.version.getSymbolSizeColumns();if(l.getHeight()!==h)throw new Ke("Dimension of bitMatrix must match the version size");const g=this.version.getDataRegionSizeRows(),v=this.version.getDataRegionSizeColumns(),x=h/g|0,b=f/v|0,R=new bt(b*v,x*g);for(let F=0;F<x;++F){const B=F*g;for(let Y=0;Y<b;++Y){const q=Y*v;for(let te=0;te<g;++te){const re=F*(g+2)+1+te,ae=B+te;for(let Te=0;Te<v;++Te)l.get(Y*(v+2)+1+Te,re)&&R.set(q+Te,ae)}}}return R}}class Ki{constructor(l,h){this.numDataCodewords=l,this.codewords=h}static getDataBlocks(l,h){const f=h.getECBlocks();let g=0;const v=f.getECBlocks();for(let te of v)g+=te.getCount();const x=new Array(g);let b=0;for(let te of v)for(let re=0;re<te.getCount();re++){const ae=te.getDataCodewords(),Te=f.getECCodewords()+ae;x[b++]=new Ki(ae,new Uint8Array(Te))}const D=x[0].codewords.length-f.getECCodewords(),R=D-1;let F=0;for(let te=0;te<R;te++)for(let re=0;re<b;re++)x[re].codewords[te]=l[F++];const B=24===h.getVersionNumber(),Y=B?8:b;for(let te=0;te<Y;te++)x[te].codewords[D-1]=l[F++];const q=x[0].codewords.length;for(let te=D;te<q;te++)for(let re=0;re<b;re++){const ae=B?(re+8)%b:re;x[ae].codewords[B&&ae>7?te-1:te]=l[F++]}if(F!==l.length)throw new Ke;return x}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class Qu{constructor(l){this.bytes=l,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(l){if(l<1||l>32||l>this.available())throw new Ke(""+l);let h=0,f=this.bitOffset,g=this.byteOffset;const v=this.bytes;if(f>0){const x=8-f,b=l<x?l:x,E=x-b;h=(v[g]&255>>8-b<<E)>>E,l-=b,f+=b,8===f&&(f=0,g++)}if(l>0){for(;l>=8;)h=h<<8|255&v[g],g++,l-=8;if(l>0){const x=8-l;h=h<<l|(v[g]&255>>x<<x)>>x,f+=l}}return this.bitOffset=f,this.byteOffset=g,h}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}var Er=(()=>{return(S=Er||(Er={}))[S.PAD_ENCODE=0]="PAD_ENCODE",S[S.ASCII_ENCODE=1]="ASCII_ENCODE",S[S.C40_ENCODE=2]="C40_ENCODE",S[S.TEXT_ENCODE=3]="TEXT_ENCODE",S[S.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",S[S.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",S[S.BASE256_ENCODE=6]="BASE256_ENCODE",Er;var S})();class Do{static decode(l){const h=new Qu(l),f=new Oe,g=new Oe,v=new Array;let x=Er.ASCII_ENCODE;do{if(x===Er.ASCII_ENCODE)x=this.decodeAsciiSegment(h,f,g);else{switch(x){case Er.C40_ENCODE:this.decodeC40Segment(h,f);break;case Er.TEXT_ENCODE:this.decodeTextSegment(h,f);break;case Er.ANSIX12_ENCODE:this.decodeAnsiX12Segment(h,f);break;case Er.EDIFACT_ENCODE:this.decodeEdifactSegment(h,f);break;case Er.BASE256_ENCODE:this.decodeBase256Segment(h,f,v);break;default:throw new Re}x=Er.ASCII_ENCODE}}while(x!==Er.PAD_ENCODE&&h.available()>0);return g.length()>0&&f.append(g.toString()),new Ds(l,f.toString(),0===v.length?null:v,null)}static decodeAsciiSegment(l,h,f){let g=!1;do{let v=l.readBits(8);if(0===v)throw new Re;if(v<=128)return g&&(v+=128),h.append(String.fromCharCode(v-1)),Er.ASCII_ENCODE;if(129===v)return Er.PAD_ENCODE;if(v<=229){const x=v-130;x<10&&h.append("0"),h.append(""+x)}else switch(v){case 230:return Er.C40_ENCODE;case 231:return Er.BASE256_ENCODE;case 232:h.append(String.fromCharCode(29));break;case 233:case 234:break;case 235:g=!0;break;case 236:h.append("[)>\x1e05\x1d"),f.insert(0,"\x1e\x04");break;case 237:h.append("[)>\x1e06\x1d"),f.insert(0,"\x1e\x04");break;case 238:return Er.ANSIX12_ENCODE;case 239:return Er.TEXT_ENCODE;case 240:return Er.EDIFACT_ENCODE;case 241:break;default:if(254!==v||0!==l.available())throw new Re}}while(l.available()>0);return Er.ASCII_ENCODE}static decodeC40Segment(l,h){let f=!1;const g=[];let v=0;do{if(8===l.available())return;const x=l.readBits(8);if(254===x)return;this.parseTwoBytes(x,l.readBits(8),g);for(let b=0;b<3;b++){const E=g[b];switch(v){case 0:if(E<3)v=E+1;else{if(!(E<this.C40_BASIC_SET_CHARS.length))throw new Re;{const D=this.C40_BASIC_SET_CHARS[E];f?(h.append(String.fromCharCode(D.charCodeAt(0)+128)),f=!1):h.append(D)}}break;case 1:f?(h.append(String.fromCharCode(E+128)),f=!1):h.append(String.fromCharCode(E)),v=0;break;case 2:if(E<this.C40_SHIFT2_SET_CHARS.length){const D=this.C40_SHIFT2_SET_CHARS[E];f?(h.append(String.fromCharCode(D.charCodeAt(0)+128)),f=!1):h.append(D)}else switch(E){case 27:h.append(String.fromCharCode(29));break;case 30:f=!0;break;default:throw new Re}v=0;break;case 3:f?(h.append(String.fromCharCode(E+224)),f=!1):h.append(String.fromCharCode(E+96)),v=0;break;default:throw new Re}}}while(l.available()>0)}static decodeTextSegment(l,h){let f=!1,g=[],v=0;do{if(8===l.available())return;const x=l.readBits(8);if(254===x)return;this.parseTwoBytes(x,l.readBits(8),g);for(let b=0;b<3;b++){const E=g[b];switch(v){case 0:if(E<3)v=E+1;else{if(!(E<this.TEXT_BASIC_SET_CHARS.length))throw new Re;{const D=this.TEXT_BASIC_SET_CHARS[E];f?(h.append(String.fromCharCode(D.charCodeAt(0)+128)),f=!1):h.append(D)}}break;case 1:f?(h.append(String.fromCharCode(E+128)),f=!1):h.append(String.fromCharCode(E)),v=0;break;case 2:if(E<this.TEXT_SHIFT2_SET_CHARS.length){const D=this.TEXT_SHIFT2_SET_CHARS[E];f?(h.append(String.fromCharCode(D.charCodeAt(0)+128)),f=!1):h.append(D)}else switch(E){case 27:h.append(String.fromCharCode(29));break;case 30:f=!0;break;default:throw new Re}v=0;break;case 3:if(!(E<this.TEXT_SHIFT3_SET_CHARS.length))throw new Re;{const D=this.TEXT_SHIFT3_SET_CHARS[E];f?(h.append(String.fromCharCode(D.charCodeAt(0)+128)),f=!1):h.append(D),v=0}break;default:throw new Re}}}while(l.available()>0)}static decodeAnsiX12Segment(l,h){const f=[];do{if(8===l.available())return;const g=l.readBits(8);if(254===g)return;this.parseTwoBytes(g,l.readBits(8),f);for(let v=0;v<3;v++){const x=f[v];switch(x){case 0:h.append("\r");break;case 1:h.append("*");break;case 2:h.append(">");break;case 3:h.append(" ");break;default:if(x<14)h.append(String.fromCharCode(x+44));else{if(!(x<40))throw new Re;h.append(String.fromCharCode(x+51))}}}}while(l.available()>0)}static parseTwoBytes(l,h,f){let g=(l<<8)+h-1,v=Math.floor(g/1600);f[0]=v,g-=1600*v,v=Math.floor(g/40),f[1]=v,f[2]=g-40*v}static decodeEdifactSegment(l,h){do{if(l.available()<=16)return;for(let f=0;f<4;f++){let g=l.readBits(6);if(31===g){const v=8-l.getBitOffset();return void(8!==v&&l.readBits(v))}0==(32&g)&&(g|=64),h.append(String.fromCharCode(g))}}while(l.available()>0)}static decodeBase256Segment(l,h,f){let g=1+l.getByteOffset();const v=this.unrandomize255State(l.readBits(8),g++);let x;if(x=0===v?l.available()/8|0:v<250?v:250*(v-249)+this.unrandomize255State(l.readBits(8),g++),x<0)throw new Re;const b=new Uint8Array(x);for(let E=0;E<x;E++){if(l.available()<8)throw new Re;b[E]=this.unrandomize255State(l.readBits(8),g++)}f.push(b);try{h.append(Ae.decode(b,_e.ISO88591))}catch(E){throw new Vo("Platform does not support required encoding: "+E.message)}}static unrandomize255State(l,h){const g=l-(149*h%255+1);return g>=0?g:g+256}}Do.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],Do.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],Do.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],Do.TEXT_SHIFT2_SET_CHARS=Do.C40_SHIFT2_SET_CHARS,Do.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",String.fromCharCode(127)];class jc{constructor(){this.rsDecoder=new ba(Kt.DATA_MATRIX_FIELD_256)}decode(l){const h=new ji(l),f=h.getVersion(),g=h.readCodewords(),v=Ki.getDataBlocks(g,f);let x=0;for(let D of v)x+=D.getNumDataCodewords();const b=new Uint8Array(x),E=v.length;for(let D=0;D<E;D++){const R=v[D],F=R.getCodewords(),B=R.getNumDataCodewords();this.correctErrors(F,B);for(let Y=0;Y<B;Y++)b[Y*E+D]=F[Y]}return Do.decode(b)}correctErrors(l,h){const f=new Int32Array(l);try{this.rsDecoder.decode(f,l.length-h)}catch(g){throw new At}for(let g=0;g<h;g++)l[g]=f[g]}}class er{constructor(l){this.image=l,this.rectangleDetector=new pr(this.image)}detect(){const l=this.rectangleDetector.detect();let h=this.detectSolid1(l);if(h=this.detectSolid2(h),h[3]=this.correctTopRight(h),!h[3])throw new ie;h=this.shiftToModuleCenter(h);const f=h[0],g=h[1],v=h[2],x=h[3];let b=this.transitionsBetween(f,x)+1,E=this.transitionsBetween(v,x)+1;1==(1&b)&&(b+=1),1==(1&E)&&(E+=1),4*b<7*E&&4*E<7*b&&(b=E=Math.max(b,E));let D=er.sampleGrid(this.image,f,g,v,x,b,E);return new Di(D,[f,g,v,x])}static shiftPoint(l,h,f){let g=(h.getX()-l.getX())/(f+1),v=(h.getY()-l.getY())/(f+1);return new Xe(l.getX()+g,l.getY()+v)}static moveAway(l,h,f){let g=l.getX(),v=l.getY();return g<h?g-=1:g+=1,v<f?v-=1:v+=1,new Xe(g,v)}detectSolid1(l){let h=l[0],f=l[1],g=l[3],v=l[2],x=this.transitionsBetween(h,f),b=this.transitionsBetween(f,g),E=this.transitionsBetween(g,v),D=this.transitionsBetween(v,h),R=x,F=[v,h,f,g];return R>b&&(R=b,F[0]=h,F[1]=f,F[2]=g,F[3]=v),R>E&&(R=E,F[0]=f,F[1]=g,F[2]=v,F[3]=h),R>D&&(F[0]=g,F[1]=v,F[2]=h,F[3]=f),F}detectSolid2(l){let h=l[0],f=l[1],g=l[2],v=l[3],x=this.transitionsBetween(h,v),b=er.shiftPoint(f,g,4*(x+1)),E=er.shiftPoint(g,f,4*(x+1));return this.transitionsBetween(b,h)<this.transitionsBetween(E,v)?(l[0]=h,l[1]=f,l[2]=g,l[3]=v):(l[0]=f,l[1]=g,l[2]=v,l[3]=h),l}correctTopRight(l){let h=l[0],f=l[1],g=l[2],v=l[3],x=this.transitionsBetween(h,v),b=this.transitionsBetween(f,v),E=er.shiftPoint(h,f,4*(b+1)),D=er.shiftPoint(g,f,4*(x+1));x=this.transitionsBetween(E,v),b=this.transitionsBetween(D,v);let R=new Xe(v.getX()+(g.getX()-f.getX())/(x+1),v.getY()+(g.getY()-f.getY())/(x+1)),F=new Xe(v.getX()+(h.getX()-f.getX())/(b+1),v.getY()+(h.getY()-f.getY())/(b+1));return this.isValid(R)?this.isValid(F)?this.transitionsBetween(E,R)+this.transitionsBetween(D,R)>this.transitionsBetween(E,F)+this.transitionsBetween(D,F)?R:F:R:this.isValid(F)?F:null}shiftToModuleCenter(l){let h=l[0],f=l[1],g=l[2],v=l[3],x=this.transitionsBetween(h,v)+1,b=this.transitionsBetween(g,v)+1,E=er.shiftPoint(h,f,4*b),D=er.shiftPoint(g,f,4*x);x=this.transitionsBetween(E,v)+1,b=this.transitionsBetween(D,v)+1,1==(1&x)&&(x+=1),1==(1&b)&&(b+=1);let B,Y,R=(h.getX()+f.getX()+g.getX()+v.getX())/4,F=(h.getY()+f.getY()+g.getY()+v.getY())/4;return h=er.moveAway(h,R,F),f=er.moveAway(f,R,F),g=er.moveAway(g,R,F),v=er.moveAway(v,R,F),E=er.shiftPoint(h,f,4*b),E=er.shiftPoint(E,v,4*x),B=er.shiftPoint(f,h,4*b),B=er.shiftPoint(B,g,4*x),D=er.shiftPoint(g,v,4*b),D=er.shiftPoint(D,f,4*x),Y=er.shiftPoint(v,g,4*b),Y=er.shiftPoint(Y,h,4*x),[E,B,D,Y]}isValid(l){return l.getX()>=0&&l.getX()<this.image.getWidth()&&l.getY()>0&&l.getY()<this.image.getHeight()}static sampleGrid(l,h,f,g,v,x,b){return Ui.getInstance().sampleGrid(l,x,b,.5,.5,x-.5,.5,x-.5,b-.5,.5,b-.5,h.getX(),h.getY(),v.getX(),v.getY(),g.getX(),g.getY(),f.getX(),f.getY())}transitionsBetween(l,h){let f=Math.trunc(l.getX()),g=Math.trunc(l.getY()),v=Math.trunc(h.getX()),x=Math.trunc(h.getY()),b=Math.abs(x-g)>Math.abs(v-f);if(b){let te=f;f=g,g=te,te=v,v=x,x=te}let E=Math.abs(v-f),D=Math.abs(x-g),R=-E/2,F=g<x?1:-1,B=f<v?1:-1,Y=0,q=this.image.get(b?g:f,b?f:g);for(let te=f,re=g;te!==v;te+=B){let ae=this.image.get(b?re:te,b?te:re);if(ae!==q&&(Y++,q=ae),R+=D,R>0){if(re===x)break;re+=F,R-=E}}return Y}}let _a=(()=>{class S{constructor(){this.decoder=new jc}decode(h,f=null){let g,v;if(null!=f&&f.has(yn.PURE_BARCODE)){const R=S.extractPureBits(h.getBlackMatrix());g=this.decoder.decode(R),v=S.NO_POINTS}else{const R=new er(h.getBlackMatrix()).detect();g=this.decoder.decode(R.getBits()),v=R.getPoints()}const x=g.getRawBytes(),b=new Vr(g.getText(),x,8*x.length,v,pt.DATA_MATRIX,$t.currentTimeMillis()),E=g.getByteSegments();null!=E&&b.putMetadata(wr.BYTE_SEGMENTS,E);const D=g.getECLevel();return null!=D&&b.putMetadata(wr.ERROR_CORRECTION_LEVEL,D),b}reset(){}static extractPureBits(h){const f=h.getTopLeftOnBit(),g=h.getBottomRightOnBit();if(null==f||null==g)throw new ie;const v=this.moduleSize(f,h);let x=f[1],E=f[0];const R=(g[0]-E+1)/v,F=(g[1]-x+1)/v;if(R<=0||F<=0)throw new ie;const B=v/2;x+=B,E+=B;const Y=new bt(R,F);for(let q=0;q<F;q++){const te=x+q*v;for(let re=0;re<R;re++)h.get(E+re*v,te)&&Y.set(re,q)}return Y}static moduleSize(h,f){const g=f.getWidth();let v=h[0];const x=h[1];for(;v<g&&f.get(v,x);)v++;if(v===g)throw new ie;const b=v-h[0];if(0===b)throw new ie;return b}}return S.NO_POINTS=[],S})();var Ps=(()=>{return(S=Ps||(Ps={}))[S.L=0]="L",S[S.M=1]="M",S[S.Q=2]="Q",S[S.H=3]="H",Ps;var S})();class Pe{constructor(l,h,f){this.value=l,this.stringValue=h,this.bits=f,Pe.FOR_BITS.set(f,this),Pe.FOR_VALUE.set(l,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(l){switch(l){case"L":return Pe.L;case"M":return Pe.M;case"Q":return Pe.Q;case"H":return Pe.H;default:throw new hi(l+"not available")}}toString(){return this.stringValue}equals(l){return l instanceof Pe&&this.value===l.value}static forBits(l){if(l<0||l>=Pe.FOR_BITS.size)throw new Ke;return Pe.FOR_BITS.get(l)}}Pe.FOR_BITS=new Map,Pe.FOR_VALUE=new Map,Pe.L=new Pe(Ps.L,"L",1),Pe.M=new Pe(Ps.M,"M",0),Pe.Q=new Pe(Ps.Q,"Q",3),Pe.H=new Pe(Ps.H,"H",2);class Ir{constructor(l){this.errorCorrectionLevel=Pe.forBits(l>>3&3),this.dataMask=7&l}static numBitsDiffering(l,h){return Dt.bitCount(l^h)}static decodeFormatInformation(l,h){const f=Ir.doDecodeFormatInformation(l,h);return null!==f?f:Ir.doDecodeFormatInformation(l^Ir.FORMAT_INFO_MASK_QR,h^Ir.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(l,h){let f=Number.MAX_SAFE_INTEGER,g=0;for(const v of Ir.FORMAT_INFO_DECODE_LOOKUP){const x=v[0];if(x===l||x===h)return new Ir(v[1]);let b=Ir.numBitsDiffering(l,x);b<f&&(g=v[1],f=b),l!==h&&(b=Ir.numBitsDiffering(h,x),b<f&&(g=v[1],f=b))}return f<=3?new Ir(g):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(l){return l instanceof Ir&&this.errorCorrectionLevel===l.errorCorrectionLevel&&this.dataMask===l.dataMask}}Ir.FORMAT_INFO_MASK_QR=21522,Ir.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class oe{constructor(l,...h){this.ecCodewordsPerBlock=l,this.ecBlocks=h}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let l=0;const h=this.ecBlocks;for(const f of h)l+=f.getCount();return l}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class z{constructor(l,h){this.count=l,this.dataCodewords=h}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class at{constructor(l,h,...f){this.versionNumber=l,this.alignmentPatternCenters=h,this.ecBlocks=f;let g=0;const v=f[0].getECCodewordsPerBlock(),x=f[0].getECBlocks();for(const b of x)g+=b.getCount()*(b.getDataCodewords()+v);this.totalCodewords=g}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(l){return this.ecBlocks[l.getValue()]}static getProvisionalVersionForDimension(l){if(l%4!=1)throw new Re;try{return this.getVersionForNumber((l-17)/4)}catch(h){throw new Re}}static getVersionForNumber(l){if(l<1||l>40)throw new Ke;return at.VERSIONS[l-1]}static decodeVersionInformation(l){let h=Number.MAX_SAFE_INTEGER,f=0;for(let g=0;g<at.VERSION_DECODE_INFO.length;g++){const v=at.VERSION_DECODE_INFO[g];if(v===l)return at.getVersionForNumber(g+7);const x=Ir.numBitsDiffering(l,v);x<h&&(f=g+7,h=x)}return h<=3?at.getVersionForNumber(f):null}buildFunctionPattern(){const l=this.getDimensionForVersion(),h=new bt(l);h.setRegion(0,0,9,9),h.setRegion(l-8,0,8,9),h.setRegion(0,l-8,9,8);const f=this.alignmentPatternCenters.length;for(let g=0;g<f;g++){const v=this.alignmentPatternCenters[g]-2;for(let x=0;x<f;x++)0===g&&(0===x||x===f-1)||g===f-1&&0===x||h.setRegion(this.alignmentPatternCenters[x]-2,v,5,5)}return h.setRegion(6,9,1,l-17),h.setRegion(9,6,l-17,1),this.versionNumber>6&&(h.setRegion(l-11,0,3,6),h.setRegion(0,l-11,6,3)),h}toString(){return""+this.versionNumber}}at.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),at.VERSIONS=[new at(1,new Int32Array(0),new oe(7,new z(1,19)),new oe(10,new z(1,16)),new oe(13,new z(1,13)),new oe(17,new z(1,9))),new at(2,Int32Array.from([6,18]),new oe(10,new z(1,34)),new oe(16,new z(1,28)),new oe(22,new z(1,22)),new oe(28,new z(1,16))),new at(3,Int32Array.from([6,22]),new oe(15,new z(1,55)),new oe(26,new z(1,44)),new oe(18,new z(2,17)),new oe(22,new z(2,13))),new at(4,Int32Array.from([6,26]),new oe(20,new z(1,80)),new oe(18,new z(2,32)),new oe(26,new z(2,24)),new oe(16,new z(4,9))),new at(5,Int32Array.from([6,30]),new oe(26,new z(1,108)),new oe(24,new z(2,43)),new oe(18,new z(2,15),new z(2,16)),new oe(22,new z(2,11),new z(2,12))),new at(6,Int32Array.from([6,34]),new oe(18,new z(2,68)),new oe(16,new z(4,27)),new oe(24,new z(4,19)),new oe(28,new z(4,15))),new at(7,Int32Array.from([6,22,38]),new oe(20,new z(2,78)),new oe(18,new z(4,31)),new oe(18,new z(2,14),new z(4,15)),new oe(26,new z(4,13),new z(1,14))),new at(8,Int32Array.from([6,24,42]),new oe(24,new z(2,97)),new oe(22,new z(2,38),new z(2,39)),new oe(22,new z(4,18),new z(2,19)),new oe(26,new z(4,14),new z(2,15))),new at(9,Int32Array.from([6,26,46]),new oe(30,new z(2,116)),new oe(22,new z(3,36),new z(2,37)),new oe(20,new z(4,16),new z(4,17)),new oe(24,new z(4,12),new z(4,13))),new at(10,Int32Array.from([6,28,50]),new oe(18,new z(2,68),new z(2,69)),new oe(26,new z(4,43),new z(1,44)),new oe(24,new z(6,19),new z(2,20)),new oe(28,new z(6,15),new z(2,16))),new at(11,Int32Array.from([6,30,54]),new oe(20,new z(4,81)),new oe(30,new z(1,50),new z(4,51)),new oe(28,new z(4,22),new z(4,23)),new oe(24,new z(3,12),new z(8,13))),new at(12,Int32Array.from([6,32,58]),new oe(24,new z(2,92),new z(2,93)),new oe(22,new z(6,36),new z(2,37)),new oe(26,new z(4,20),new z(6,21)),new oe(28,new z(7,14),new z(4,15))),new at(13,Int32Array.from([6,34,62]),new oe(26,new z(4,107)),new oe(22,new z(8,37),new z(1,38)),new oe(24,new z(8,20),new z(4,21)),new oe(22,new z(12,11),new z(4,12))),new at(14,Int32Array.from([6,26,46,66]),new oe(30,new z(3,115),new z(1,116)),new oe(24,new z(4,40),new z(5,41)),new oe(20,new z(11,16),new z(5,17)),new oe(24,new z(11,12),new z(5,13))),new at(15,Int32Array.from([6,26,48,70]),new oe(22,new z(5,87),new z(1,88)),new oe(24,new z(5,41),new z(5,42)),new oe(30,new z(5,24),new z(7,25)),new oe(24,new z(11,12),new z(7,13))),new at(16,Int32Array.from([6,26,50,74]),new oe(24,new z(5,98),new z(1,99)),new oe(28,new z(7,45),new z(3,46)),new oe(24,new z(15,19),new z(2,20)),new oe(30,new z(3,15),new z(13,16))),new at(17,Int32Array.from([6,30,54,78]),new oe(28,new z(1,107),new z(5,108)),new oe(28,new z(10,46),new z(1,47)),new oe(28,new z(1,22),new z(15,23)),new oe(28,new z(2,14),new z(17,15))),new at(18,Int32Array.from([6,30,56,82]),new oe(30,new z(5,120),new z(1,121)),new oe(26,new z(9,43),new z(4,44)),new oe(28,new z(17,22),new z(1,23)),new oe(28,new z(2,14),new z(19,15))),new at(19,Int32Array.from([6,30,58,86]),new oe(28,new z(3,113),new z(4,114)),new oe(26,new z(3,44),new z(11,45)),new oe(26,new z(17,21),new z(4,22)),new oe(26,new z(9,13),new z(16,14))),new at(20,Int32Array.from([6,34,62,90]),new oe(28,new z(3,107),new z(5,108)),new oe(26,new z(3,41),new z(13,42)),new oe(30,new z(15,24),new z(5,25)),new oe(28,new z(15,15),new z(10,16))),new at(21,Int32Array.from([6,28,50,72,94]),new oe(28,new z(4,116),new z(4,117)),new oe(26,new z(17,42)),new oe(28,new z(17,22),new z(6,23)),new oe(30,new z(19,16),new z(6,17))),new at(22,Int32Array.from([6,26,50,74,98]),new oe(28,new z(2,111),new z(7,112)),new oe(28,new z(17,46)),new oe(30,new z(7,24),new z(16,25)),new oe(24,new z(34,13))),new at(23,Int32Array.from([6,30,54,78,102]),new oe(30,new z(4,121),new z(5,122)),new oe(28,new z(4,47),new z(14,48)),new oe(30,new z(11,24),new z(14,25)),new oe(30,new z(16,15),new z(14,16))),new at(24,Int32Array.from([6,28,54,80,106]),new oe(30,new z(6,117),new z(4,118)),new oe(28,new z(6,45),new z(14,46)),new oe(30,new z(11,24),new z(16,25)),new oe(30,new z(30,16),new z(2,17))),new at(25,Int32Array.from([6,32,58,84,110]),new oe(26,new z(8,106),new z(4,107)),new oe(28,new z(8,47),new z(13,48)),new oe(30,new z(7,24),new z(22,25)),new oe(30,new z(22,15),new z(13,16))),new at(26,Int32Array.from([6,30,58,86,114]),new oe(28,new z(10,114),new z(2,115)),new oe(28,new z(19,46),new z(4,47)),new oe(28,new z(28,22),new z(6,23)),new oe(30,new z(33,16),new z(4,17))),new at(27,Int32Array.from([6,34,62,90,118]),new oe(30,new z(8,122),new z(4,123)),new oe(28,new z(22,45),new z(3,46)),new oe(30,new z(8,23),new z(26,24)),new oe(30,new z(12,15),new z(28,16))),new at(28,Int32Array.from([6,26,50,74,98,122]),new oe(30,new z(3,117),new z(10,118)),new oe(28,new z(3,45),new z(23,46)),new oe(30,new z(4,24),new z(31,25)),new oe(30,new z(11,15),new z(31,16))),new at(29,Int32Array.from([6,30,54,78,102,126]),new oe(30,new z(7,116),new z(7,117)),new oe(28,new z(21,45),new z(7,46)),new oe(30,new z(1,23),new z(37,24)),new oe(30,new z(19,15),new z(26,16))),new at(30,Int32Array.from([6,26,52,78,104,130]),new oe(30,new z(5,115),new z(10,116)),new oe(28,new z(19,47),new z(10,48)),new oe(30,new z(15,24),new z(25,25)),new oe(30,new z(23,15),new z(25,16))),new at(31,Int32Array.from([6,30,56,82,108,134]),new oe(30,new z(13,115),new z(3,116)),new oe(28,new z(2,46),new z(29,47)),new oe(30,new z(42,24),new z(1,25)),new oe(30,new z(23,15),new z(28,16))),new at(32,Int32Array.from([6,34,60,86,112,138]),new oe(30,new z(17,115)),new oe(28,new z(10,46),new z(23,47)),new oe(30,new z(10,24),new z(35,25)),new oe(30,new z(19,15),new z(35,16))),new at(33,Int32Array.from([6,30,58,86,114,142]),new oe(30,new z(17,115),new z(1,116)),new oe(28,new z(14,46),new z(21,47)),new oe(30,new z(29,24),new z(19,25)),new oe(30,new z(11,15),new z(46,16))),new at(34,Int32Array.from([6,34,62,90,118,146]),new oe(30,new z(13,115),new z(6,116)),new oe(28,new z(14,46),new z(23,47)),new oe(30,new z(44,24),new z(7,25)),new oe(30,new z(59,16),new z(1,17))),new at(35,Int32Array.from([6,30,54,78,102,126,150]),new oe(30,new z(12,121),new z(7,122)),new oe(28,new z(12,47),new z(26,48)),new oe(30,new z(39,24),new z(14,25)),new oe(30,new z(22,15),new z(41,16))),new at(36,Int32Array.from([6,24,50,76,102,128,154]),new oe(30,new z(6,121),new z(14,122)),new oe(28,new z(6,47),new z(34,48)),new oe(30,new z(46,24),new z(10,25)),new oe(30,new z(2,15),new z(64,16))),new at(37,Int32Array.from([6,28,54,80,106,132,158]),new oe(30,new z(17,122),new z(4,123)),new oe(28,new z(29,46),new z(14,47)),new oe(30,new z(49,24),new z(10,25)),new oe(30,new z(24,15),new z(46,16))),new at(38,Int32Array.from([6,32,58,84,110,136,162]),new oe(30,new z(4,122),new z(18,123)),new oe(28,new z(13,46),new z(32,47)),new oe(30,new z(48,24),new z(14,25)),new oe(30,new z(42,15),new z(32,16))),new at(39,Int32Array.from([6,26,54,82,110,138,166]),new oe(30,new z(20,117),new z(4,118)),new oe(28,new z(40,47),new z(7,48)),new oe(30,new z(43,24),new z(22,25)),new oe(30,new z(10,15),new z(67,16))),new at(40,Int32Array.from([6,30,58,86,114,142,170]),new oe(30,new z(19,118),new z(6,119)),new oe(28,new z(18,47),new z(31,48)),new oe(30,new z(34,24),new z(34,25)),new oe(30,new z(20,15),new z(61,16)))];var Wr=(()=>{return(S=Wr||(Wr={}))[S.DATA_MASK_000=0]="DATA_MASK_000",S[S.DATA_MASK_001=1]="DATA_MASK_001",S[S.DATA_MASK_010=2]="DATA_MASK_010",S[S.DATA_MASK_011=3]="DATA_MASK_011",S[S.DATA_MASK_100=4]="DATA_MASK_100",S[S.DATA_MASK_101=5]="DATA_MASK_101",S[S.DATA_MASK_110=6]="DATA_MASK_110",S[S.DATA_MASK_111=7]="DATA_MASK_111",Wr;var S})();class Dr{constructor(l,h){this.value=l,this.isMasked=h}unmaskBitMatrix(l,h){for(let f=0;f<h;f++)for(let g=0;g<h;g++)this.isMasked(f,g)&&l.flip(g,f)}}Dr.values=new Map([[Wr.DATA_MASK_000,new Dr(Wr.DATA_MASK_000,(S,l)=>0==(S+l&1))],[Wr.DATA_MASK_001,new Dr(Wr.DATA_MASK_001,(S,l)=>0==(1&S))],[Wr.DATA_MASK_010,new Dr(Wr.DATA_MASK_010,(S,l)=>l%3==0)],[Wr.DATA_MASK_011,new Dr(Wr.DATA_MASK_011,(S,l)=>(S+l)%3==0)],[Wr.DATA_MASK_100,new Dr(Wr.DATA_MASK_100,(S,l)=>0==(Math.floor(S/2)+Math.floor(l/3)&1))],[Wr.DATA_MASK_101,new Dr(Wr.DATA_MASK_101,(S,l)=>S*l%6==0)],[Wr.DATA_MASK_110,new Dr(Wr.DATA_MASK_110,(S,l)=>S*l%6<3)],[Wr.DATA_MASK_111,new Dr(Wr.DATA_MASK_111,(S,l)=>0==(S+l+S*l%3&1))]]);class Qi{constructor(l){const h=l.getHeight();if(h<21||1!=(3&h))throw new Re;this.bitMatrix=l}readFormatInformation(){if(null!=this.parsedFormatInfo)return this.parsedFormatInfo;let l=0;for(let v=0;v<6;v++)l=this.copyBit(v,8,l);l=this.copyBit(7,8,l),l=this.copyBit(8,8,l),l=this.copyBit(8,7,l);for(let v=5;v>=0;v--)l=this.copyBit(8,v,l);const h=this.bitMatrix.getHeight();let f=0;const g=h-7;for(let v=h-1;v>=g;v--)f=this.copyBit(8,v,f);for(let v=h-8;v<h;v++)f=this.copyBit(v,8,f);if(this.parsedFormatInfo=Ir.decodeFormatInformation(l,f),null!==this.parsedFormatInfo)return this.parsedFormatInfo;throw new Re}readVersion(){if(null!=this.parsedVersion)return this.parsedVersion;const l=this.bitMatrix.getHeight(),h=Math.floor((l-17)/4);if(h<=6)return at.getVersionForNumber(h);let f=0;const g=l-11;for(let x=5;x>=0;x--)for(let b=l-9;b>=g;b--)f=this.copyBit(b,x,f);let v=at.decodeVersionInformation(f);if(null!==v&&v.getDimensionForVersion()===l)return this.parsedVersion=v,v;f=0;for(let x=5;x>=0;x--)for(let b=l-9;b>=g;b--)f=this.copyBit(x,b,f);if(v=at.decodeVersionInformation(f),null!==v&&v.getDimensionForVersion()===l)return this.parsedVersion=v,v;throw new Re}copyBit(l,h,f){return(this.isMirror?this.bitMatrix.get(h,l):this.bitMatrix.get(l,h))?f<<1|1:f<<1}readCodewords(){const l=this.readFormatInformation(),h=this.readVersion(),f=Dr.values.get(l.getDataMask()),g=this.bitMatrix.getHeight();f.unmaskBitMatrix(this.bitMatrix,g);const v=h.buildFunctionPattern();let x=!0;const b=new Uint8Array(h.getTotalCodewords());let E=0,D=0,R=0;for(let F=g-1;F>0;F-=2){6===F&&F--;for(let B=0;B<g;B++){const Y=x?g-1-B:B;for(let q=0;q<2;q++)v.get(F-q,Y)||(R++,D<<=1,this.bitMatrix.get(F-q,Y)&&(D|=1),8===R&&(b[E++]=D,R=0,D=0))}x=!x}if(E!==h.getTotalCodewords())throw new Re;return b}remask(){if(null===this.parsedFormatInfo)return;const l=Dr.values[this.parsedFormatInfo.getDataMask()],h=this.bitMatrix.getHeight();l.unmaskBitMatrix(this.bitMatrix,h)}setMirror(l){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=l}mirror(){const l=this.bitMatrix;for(let h=0,f=l.getWidth();h<f;h++)for(let g=h+1,v=l.getHeight();g<v;g++)l.get(h,g)!==l.get(g,h)&&(l.flip(g,h),l.flip(h,g))}}class Hc{constructor(l,h){this.numDataCodewords=l,this.codewords=h}static getDataBlocks(l,h,f){if(l.length!==h.getTotalCodewords())throw new Ke;const g=h.getECBlocksForLevel(f);let v=0;const x=g.getECBlocks();for(const q of x)v+=q.getCount();const b=new Array(v);let E=0;for(const q of x)for(let te=0;te<q.getCount();te++){const re=q.getDataCodewords(),ae=g.getECCodewordsPerBlock()+re;b[E++]=new Hc(re,new Uint8Array(ae))}const D=b[0].codewords.length;let R=b.length-1;for(;R>=0&&b[R].codewords.length!==D;)R--;R++;const F=D-g.getECCodewordsPerBlock();let B=0;for(let q=0;q<F;q++)for(let te=0;te<E;te++)b[te].codewords[q]=l[B++];for(let q=R;q<E;q++)b[q].codewords[F]=l[B++];const Y=b[0].codewords.length;for(let q=F;q<Y;q++)for(let te=0;te<E;te++)b[te].codewords[te<R?q:q+1]=l[B++];return b}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}var Zi=(()=>{return(S=Zi||(Zi={}))[S.TERMINATOR=0]="TERMINATOR",S[S.NUMERIC=1]="NUMERIC",S[S.ALPHANUMERIC=2]="ALPHANUMERIC",S[S.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",S[S.BYTE=4]="BYTE",S[S.ECI=5]="ECI",S[S.KANJI=6]="KANJI",S[S.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",S[S.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",S[S.HANZI=9]="HANZI",Zi;var S})();class We{constructor(l,h,f,g){this.value=l,this.stringValue=h,this.characterCountBitsForVersions=f,this.bits=g,We.FOR_BITS.set(g,this),We.FOR_VALUE.set(l,this)}static forBits(l){const h=We.FOR_BITS.get(l);if(void 0===h)throw new Ke;return h}getCharacterCountBits(l){const h=l.getVersionNumber();let f;return f=h<=9?0:h<=26?1:2,this.characterCountBitsForVersions[f]}getValue(){return this.value}getBits(){return this.bits}equals(l){return l instanceof We&&this.value===l.value}toString(){return this.stringValue}}We.FOR_BITS=new Map,We.FOR_VALUE=new Map,We.TERMINATOR=new We(Zi.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),We.NUMERIC=new We(Zi.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),We.ALPHANUMERIC=new We(Zi.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),We.STRUCTURED_APPEND=new We(Zi.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),We.BYTE=new We(Zi.BYTE,"BYTE",Int32Array.from([8,16,16]),4),We.ECI=new We(Zi.ECI,"ECI",Int32Array.from([0,0,0]),7),We.KANJI=new We(Zi.KANJI,"KANJI",Int32Array.from([8,10,12]),8),We.FNC1_FIRST_POSITION=new We(Zi.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),We.FNC1_SECOND_POSITION=new We(Zi.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),We.HANZI=new We(Zi.HANZI,"HANZI",Int32Array.from([8,10,12]),13);let Zu=(()=>{class S{static decode(h,f,g,v){const x=new Qu(h);let b=new Oe;const E=new Array;let D=-1,R=-1;try{let Y,F=null,B=!1;do{if(x.available()<4)Y=We.TERMINATOR;else{const q=x.readBits(4);Y=We.forBits(q)}switch(Y){case We.TERMINATOR:break;case We.FNC1_FIRST_POSITION:case We.FNC1_SECOND_POSITION:B=!0;break;case We.STRUCTURED_APPEND:if(x.available()<16)throw new Re;D=x.readBits(8),R=x.readBits(8);break;case We.ECI:const q=S.parseECIValue(x);if(F=ee.getCharacterSetECIByValue(q),null===F)throw new Re;break;case We.HANZI:const te=x.readBits(4),re=x.readBits(Y.getCharacterCountBits(f));te===S.GB2312_SUBSET&&S.decodeHanziSegment(x,b,re);break;default:const ae=x.readBits(Y.getCharacterCountBits(f));switch(Y){case We.NUMERIC:S.decodeNumericSegment(x,b,ae);break;case We.ALPHANUMERIC:S.decodeAlphanumericSegment(x,b,ae,B);break;case We.BYTE:S.decodeByteSegment(x,b,ae,F,E,v);break;case We.KANJI:S.decodeKanjiSegment(x,b,ae);break;default:throw new Re}}}while(Y!==We.TERMINATOR)}catch(F){throw new Re}return new Ds(h,b.toString(),0===E.length?null:E,null===g?null:g.toString(),D,R)}static decodeHanziSegment(h,f,g){if(13*g>h.available())throw new Re;const v=new Uint8Array(2*g);let x=0;for(;g>0;){const b=h.readBits(13);let E=b/96<<8&4294967295|b%96;E+=E<959?41377:42657,v[x]=E>>8&255,v[x+1]=255&E,x+=2,g--}try{f.append(Ae.decode(v,_e.GB2312))}catch(b){throw new Re(b)}}static decodeKanjiSegment(h,f,g){if(13*g>h.available())throw new Re;const v=new Uint8Array(2*g);let x=0;for(;g>0;){const b=h.readBits(13);let E=b/192<<8&4294967295|b%192;E+=E<7936?33088:49472,v[x]=E>>8,v[x+1]=E,x+=2,g--}try{f.append(Ae.decode(v,_e.SHIFT_JIS))}catch(b){throw new Re(b)}}static decodeByteSegment(h,f,g,v,x,b){if(8*g>h.available())throw new Re;const E=new Uint8Array(g);for(let R=0;R<g;R++)E[R]=h.readBits(8);let D;D=null===v?_e.guessEncoding(E,b):v.getName();try{f.append(Ae.decode(E,D))}catch(R){throw new Re(R)}x.push(E)}static toAlphaNumericChar(h){if(h>=S.ALPHANUMERIC_CHARS.length)throw new Re;return S.ALPHANUMERIC_CHARS[h]}static decodeAlphanumericSegment(h,f,g,v){const x=f.length();for(;g>1;){if(h.available()<11)throw new Re;const b=h.readBits(11);f.append(S.toAlphaNumericChar(Math.floor(b/45))),f.append(S.toAlphaNumericChar(b%45)),g-=2}if(1===g){if(h.available()<6)throw new Re;f.append(S.toAlphaNumericChar(h.readBits(6)))}if(v)for(let b=x;b<f.length();b++)"%"===f.charAt(b)&&(b<f.length()-1&&"%"===f.charAt(b+1)?f.deleteCharAt(b+1):f.setCharAt(b,String.fromCharCode(29)))}static decodeNumericSegment(h,f,g){for(;g>=3;){if(h.available()<10)throw new Re;const v=h.readBits(10);if(v>=1e3)throw new Re;f.append(S.toAlphaNumericChar(Math.floor(v/100))),f.append(S.toAlphaNumericChar(Math.floor(v/10)%10)),f.append(S.toAlphaNumericChar(v%10)),g-=3}if(2===g){if(h.available()<7)throw new Re;const v=h.readBits(7);if(v>=100)throw new Re;f.append(S.toAlphaNumericChar(Math.floor(v/10))),f.append(S.toAlphaNumericChar(v%10))}else if(1===g){if(h.available()<4)throw new Re;const v=h.readBits(4);if(v>=10)throw new Re;f.append(S.toAlphaNumericChar(v))}}static parseECIValue(h){const f=h.readBits(8);if(0==(128&f))return 127&f;if(128==(192&f))return(63&f)<<8&4294967295|h.readBits(8);if(192==(224&f))return(31&f)<<16&4294967295|h.readBits(16);throw new Re}}return S.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",S.GB2312_SUBSET=1,S})();class Wl{constructor(l){this.mirrored=l}isMirrored(){return this.mirrored}applyMirroredCorrection(l){if(!this.mirrored||null===l||l.length<3)return;const h=l[0];l[0]=l[2],l[2]=h}}class Ld{constructor(){this.rsDecoder=new ba(Kt.QR_CODE_FIELD_256)}decodeBooleanArray(l,h){return this.decodeBitMatrix(bt.parseFromBooleanArray(l),h)}decodeBitMatrix(l,h){const f=new Qi(l);let g=null;try{return this.decodeBitMatrixParser(f,h)}catch(v){g=v}try{f.remask(),f.setMirror(!0),f.readVersion(),f.readFormatInformation(),f.mirror();const v=this.decodeBitMatrixParser(f,h);return v.setOther(new Wl(!0)),v}catch(v){throw null!==g?g:v}}decodeBitMatrixParser(l,h){const f=l.readVersion(),g=l.readFormatInformation().getErrorCorrectionLevel(),v=l.readCodewords(),x=Hc.getDataBlocks(v,f,g);let b=0;for(const R of x)b+=R.getNumDataCodewords();const E=new Uint8Array(b);let D=0;for(const R of x){const F=R.getCodewords(),B=R.getNumDataCodewords();this.correctErrors(F,B);for(let Y=0;Y<B;Y++)E[D++]=F[Y]}return Zu.decode(E,f,g,h)}correctErrors(l,h){const f=new Int32Array(l);try{this.rsDecoder.decode(f,l.length-h)}catch(g){throw new At}for(let g=0;g<h;g++)l[g]=f[g]}}class Hl extends Xe{constructor(l,h,f){super(l,h),this.estimatedModuleSize=f}aboutEquals(l,h,f){if(Math.abs(h-this.getY())<=l&&Math.abs(f-this.getX())<=l){const g=Math.abs(l-this.estimatedModuleSize);return g<=1||g<=this.estimatedModuleSize}return!1}combineEstimate(l,h,f){const g=(this.getX()+h)/2,v=(this.getY()+l)/2;return new Hl(g,v,(this.estimatedModuleSize+f)/2)}}class Zt{constructor(l,h,f,g,v,x,b){this.image=l,this.startX=h,this.startY=f,this.width=g,this.height=v,this.moduleSize=x,this.resultPointCallback=b,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const l=this.startX,h=this.height,g=l+this.width,v=this.startY+h/2,x=new Int32Array(3),b=this.image;for(let E=0;E<h;E++){const D=v+(0==(1&E)?Math.floor((E+1)/2):-Math.floor((E+1)/2));x[0]=0,x[1]=0,x[2]=0;let R=l;for(;R<g&&!b.get(R,D);)R++;let F=0;for(;R<g;){if(b.get(R,D))if(1===F)x[1]++;else if(2===F){if(this.foundPatternCross(x)){const B=this.handlePossibleCenter(x,D,R);if(null!==B)return B}x[0]=x[2],x[1]=1,x[2]=0,F=1}else x[++F]++;else 1===F&&F++,x[F]++;R++}if(this.foundPatternCross(x)){const B=this.handlePossibleCenter(x,D,g);if(null!==B)return B}}if(0!==this.possibleCenters.length)return this.possibleCenters[0];throw new ie}static centerFromEnd(l,h){return h-l[2]-l[1]/2}foundPatternCross(l){const h=this.moduleSize,f=h/2;for(let g=0;g<3;g++)if(Math.abs(h-l[g])>=f)return!1;return!0}crossCheckVertical(l,h,f,g){const v=this.image,x=v.getHeight(),b=this.crossCheckStateCount;b[0]=0,b[1]=0,b[2]=0;let E=l;for(;E>=0&&v.get(h,E)&&b[1]<=f;)b[1]++,E--;if(E<0||b[1]>f)return NaN;for(;E>=0&&!v.get(h,E)&&b[0]<=f;)b[0]++,E--;if(b[0]>f)return NaN;for(E=l+1;E<x&&v.get(h,E)&&b[1]<=f;)b[1]++,E++;if(E===x||b[1]>f)return NaN;for(;E<x&&!v.get(h,E)&&b[2]<=f;)b[2]++,E++;return b[2]>f||5*Math.abs(b[0]+b[1]+b[2]-g)>=2*g?NaN:this.foundPatternCross(b)?Zt.centerFromEnd(b,E):NaN}handlePossibleCenter(l,h,f){const g=l[0]+l[1]+l[2],v=Zt.centerFromEnd(l,f),x=this.crossCheckVertical(h,v,2*l[1],g);if(!isNaN(x)){const b=(l[0]+l[1]+l[2])/3;for(const D of this.possibleCenters)if(D.aboutEquals(b,x,v))return D.combineEstimate(x,v,b);const E=new Hl(v,x,b);this.possibleCenters.push(E),null!=this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(E)}return null}}class zl extends Xe{constructor(l,h,f,g){super(l,h),this.estimatedModuleSize=f,this.count=g,void 0===g&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(l,h,f){if(Math.abs(h-this.getY())<=l&&Math.abs(f-this.getX())<=l){const g=Math.abs(l-this.estimatedModuleSize);return g<=1||g<=this.estimatedModuleSize}return!1}combineEstimate(l,h,f){const g=this.count+1,v=(this.count*this.getX()+h)/g,x=(this.count*this.getY()+l)/g;return new zl(v,x,(this.count*this.estimatedModuleSize+f)/g,g)}}class fg{constructor(l){this.bottomLeft=l[0],this.topLeft=l[1],this.topRight=l[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}let Ca=(()=>{class S{constructor(h,f){this.image=h,this.resultPointCallback=f,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=f}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(h){const f=null!=h&&void 0!==h.get(yn.TRY_HARDER),g=null!=h&&void 0!==h.get(yn.PURE_BARCODE),v=this.image,x=v.getHeight(),b=v.getWidth();let E=Math.floor(3*x/(4*S.MAX_MODULES));(E<S.MIN_SKIP||f)&&(E=S.MIN_SKIP);let D=!1;const R=new Int32Array(5);for(let B=E-1;B<x&&!D;B+=E){R[0]=0,R[1]=0,R[2]=0,R[3]=0,R[4]=0;let Y=0;for(let q=0;q<b;q++)if(v.get(q,B))1==(1&Y)&&Y++,R[Y]++;else if(0==(1&Y))if(4===Y)if(S.foundPatternCross(R)){if(!0!==this.handlePossibleCenter(R,B,q,g)){R[0]=R[2],R[1]=R[3],R[2]=R[4],R[3]=1,R[4]=0,Y=3;continue}if(E=2,!0===this.hasSkipped)D=this.haveMultiplyConfirmedCenters();else{const re=this.findRowSkip();re>R[2]&&(B+=re-R[2]-E,q=b-1)}Y=0,R[0]=0,R[1]=0,R[2]=0,R[3]=0,R[4]=0}else R[0]=R[2],R[1]=R[3],R[2]=R[4],R[3]=1,R[4]=0,Y=3;else R[++Y]++;else R[Y]++;S.foundPatternCross(R)&&!0===this.handlePossibleCenter(R,B,b,g)&&(E=R[0],this.hasSkipped&&(D=this.haveMultiplyConfirmedCenters()))}const F=this.selectBestPatterns();return Xe.orderBestPatterns(F),new fg(F)}static centerFromEnd(h,f){return f-h[4]-h[3]-h[2]/2}static foundPatternCross(h){let f=0;for(let x=0;x<5;x++){const b=h[x];if(0===b)return!1;f+=b}if(f<7)return!1;const g=f/7,v=g/2;return Math.abs(g-h[0])<v&&Math.abs(g-h[1])<v&&Math.abs(3*g-h[2])<3*v&&Math.abs(g-h[3])<v&&Math.abs(g-h[4])<v}getCrossCheckStateCount(){const h=this.crossCheckStateCount;return h[0]=0,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h}crossCheckDiagonal(h,f,g,v){const x=this.getCrossCheckStateCount();let b=0;const E=this.image;for(;h>=b&&f>=b&&E.get(f-b,h-b);)x[2]++,b++;if(h<b||f<b)return!1;for(;h>=b&&f>=b&&!E.get(f-b,h-b)&&x[1]<=g;)x[1]++,b++;if(h<b||f<b||x[1]>g)return!1;for(;h>=b&&f>=b&&E.get(f-b,h-b)&&x[0]<=g;)x[0]++,b++;if(x[0]>g)return!1;const D=E.getHeight(),R=E.getWidth();for(b=1;h+b<D&&f+b<R&&E.get(f+b,h+b);)x[2]++,b++;if(h+b>=D||f+b>=R)return!1;for(;h+b<D&&f+b<R&&!E.get(f+b,h+b)&&x[3]<g;)x[3]++,b++;if(h+b>=D||f+b>=R||x[3]>=g)return!1;for(;h+b<D&&f+b<R&&E.get(f+b,h+b)&&x[4]<g;)x[4]++,b++;return!(x[4]>=g)&&Math.abs(x[0]+x[1]+x[2]+x[3]+x[4]-v)<2*v&&S.foundPatternCross(x)}crossCheckVertical(h,f,g,v){const x=this.image,b=x.getHeight(),E=this.getCrossCheckStateCount();let D=h;for(;D>=0&&x.get(f,D);)E[2]++,D--;if(D<0)return NaN;for(;D>=0&&!x.get(f,D)&&E[1]<=g;)E[1]++,D--;if(D<0||E[1]>g)return NaN;for(;D>=0&&x.get(f,D)&&E[0]<=g;)E[0]++,D--;if(E[0]>g)return NaN;for(D=h+1;D<b&&x.get(f,D);)E[2]++,D++;if(D===b)return NaN;for(;D<b&&!x.get(f,D)&&E[3]<g;)E[3]++,D++;if(D===b||E[3]>=g)return NaN;for(;D<b&&x.get(f,D)&&E[4]<g;)E[4]++,D++;return E[4]>=g||5*Math.abs(E[0]+E[1]+E[2]+E[3]+E[4]-v)>=2*v?NaN:S.foundPatternCross(E)?S.centerFromEnd(E,D):NaN}crossCheckHorizontal(h,f,g,v){const x=this.image,b=x.getWidth(),E=this.getCrossCheckStateCount();let D=h;for(;D>=0&&x.get(D,f);)E[2]++,D--;if(D<0)return NaN;for(;D>=0&&!x.get(D,f)&&E[1]<=g;)E[1]++,D--;if(D<0||E[1]>g)return NaN;for(;D>=0&&x.get(D,f)&&E[0]<=g;)E[0]++,D--;if(E[0]>g)return NaN;for(D=h+1;D<b&&x.get(D,f);)E[2]++,D++;if(D===b)return NaN;for(;D<b&&!x.get(D,f)&&E[3]<g;)E[3]++,D++;if(D===b||E[3]>=g)return NaN;for(;D<b&&x.get(D,f)&&E[4]<g;)E[4]++,D++;return E[4]>=g||5*Math.abs(E[0]+E[1]+E[2]+E[3]+E[4]-v)>=v?NaN:S.foundPatternCross(E)?S.centerFromEnd(E,D):NaN}handlePossibleCenter(h,f,g,v){const x=h[0]+h[1]+h[2]+h[3]+h[4];let b=S.centerFromEnd(h,g),E=this.crossCheckVertical(f,Math.floor(b),h[2],x);if(!isNaN(E)&&(b=this.crossCheckHorizontal(Math.floor(b),Math.floor(E),h[2],x),!isNaN(b)&&(!v||this.crossCheckDiagonal(Math.floor(E),Math.floor(b),h[2],x)))){const D=x/7;let R=!1;const F=this.possibleCenters;for(let B=0,Y=F.length;B<Y;B++){const q=F[B];if(q.aboutEquals(D,E,b)){F[B]=q.combineEstimate(E,b,D),R=!0;break}}if(!R){const B=new zl(b,E,D);F.push(B),null!=this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(B)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let f=null;for(const g of this.possibleCenters)if(g.getCount()>=S.CENTER_QUORUM){if(null!=f)return this.hasSkipped=!0,Math.floor((Math.abs(f.getX()-g.getX())-Math.abs(f.getY()-g.getY()))/2);f=g}return 0}haveMultiplyConfirmedCenters(){let h=0,f=0;const g=this.possibleCenters.length;for(const b of this.possibleCenters)b.getCount()>=S.CENTER_QUORUM&&(h++,f+=b.getEstimatedModuleSize());if(h<3)return!1;const v=f/g;let x=0;for(const b of this.possibleCenters)x+=Math.abs(b.getEstimatedModuleSize()-v);return x<=.05*f}selectBestPatterns(){const h=this.possibleCenters.length;if(h<3)throw new ie;const f=this.possibleCenters;let g;if(h>3){let v=0,x=0;for(const D of this.possibleCenters){const R=D.getEstimatedModuleSize();v+=R,x+=R*R}g=v/h;let b=Math.sqrt(x/h-g*g);f.sort((D,R)=>{const F=Math.abs(R.getEstimatedModuleSize()-g),B=Math.abs(D.getEstimatedModuleSize()-g);return F<B?-1:F>B?1:0});const E=Math.max(.2*g,b);for(let D=0;D<f.length&&f.length>3;D++)Math.abs(f[D].getEstimatedModuleSize()-g)>E&&(f.splice(D,1),D--)}if(f.length>3){let v=0;for(const x of f)v+=x.getEstimatedModuleSize();g=v/f.length,f.sort((x,b)=>{if(b.getCount()===x.getCount()){const E=Math.abs(b.getEstimatedModuleSize()-g),D=Math.abs(x.getEstimatedModuleSize()-g);return E<D?1:E>D?-1:0}return b.getCount()-x.getCount()}),f.splice(3)}return[f[0],f[1],f[2]]}}return S.CENTER_QUORUM=2,S.MIN_SKIP=3,S.MAX_MODULES=57,S})();class ln{constructor(l){this.image=l}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(l){this.resultPointCallback=null==l?null:l.get(yn.NEED_RESULT_POINT_CALLBACK);const f=new Ca(this.image,this.resultPointCallback).find(l);return this.processFinderPatternInfo(f)}processFinderPatternInfo(l){const h=l.getTopLeft(),f=l.getTopRight(),g=l.getBottomLeft(),v=this.calculateModuleSize(h,f,g);if(v<1)throw new ie("No pattern found in proccess finder.");const x=ln.computeDimension(h,f,g,v),b=at.getProvisionalVersionForDimension(x),E=b.getDimensionForVersion()-7;let D=null;if(b.getAlignmentPatternCenters().length>0){const Y=f.getX()-h.getX()+g.getX(),q=f.getY()-h.getY()+g.getY(),te=1-3/E,re=Math.floor(h.getX()+te*(Y-h.getX())),ae=Math.floor(h.getY()+te*(q-h.getY()));for(let Te=4;Te<=16;Te<<=1)try{D=this.findAlignmentInRegion(v,re,ae,Te);break}catch(Le){if(!(Le instanceof ie))throw Le}}const R=ln.createTransform(h,f,g,D,x),F=ln.sampleGrid(this.image,R,x);let B;return B=null===D?[g,h,f]:[g,h,f,D],new Di(F,B)}static createTransform(l,h,f,g,v){const x=v-3.5;let b,E,D,R;return null!==g?(b=g.getX(),E=g.getY(),D=x-3,R=D):(b=h.getX()-l.getX()+f.getX(),E=h.getY()-l.getY()+f.getY(),D=x,R=x),_r.quadrilateralToQuadrilateral(3.5,3.5,x,3.5,D,R,3.5,x,l.getX(),l.getY(),h.getX(),h.getY(),b,E,f.getX(),f.getY())}static sampleGrid(l,h,f){return Ui.getInstance().sampleGridWithTransform(l,f,f,h)}static computeDimension(l,h,f,g){const v=Qt.round(Xe.distance(l,h)/g),x=Qt.round(Xe.distance(l,f)/g);let b=Math.floor((v+x)/2)+7;switch(3&b){case 0:b++;break;case 2:b--;break;case 3:throw new ie("Dimensions could be not found.")}return b}calculateModuleSize(l,h,f){return(this.calculateModuleSizeOneWay(l,h)+this.calculateModuleSizeOneWay(l,f))/2}calculateModuleSizeOneWay(l,h){const f=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(l.getX()),Math.floor(l.getY()),Math.floor(h.getX()),Math.floor(h.getY())),g=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(h.getX()),Math.floor(h.getY()),Math.floor(l.getX()),Math.floor(l.getY()));return isNaN(f)?g/7:isNaN(g)?f/7:(f+g)/14}sizeOfBlackWhiteBlackRunBothWays(l,h,f,g){let v=this.sizeOfBlackWhiteBlackRun(l,h,f,g),x=1,b=l-(f-l);b<0?(x=l/(l-b),b=0):b>=this.image.getWidth()&&(x=(this.image.getWidth()-1-l)/(b-l),b=this.image.getWidth()-1);let E=Math.floor(h-(g-h)*x);return x=1,E<0?(x=h/(h-E),E=0):E>=this.image.getHeight()&&(x=(this.image.getHeight()-1-h)/(E-h),E=this.image.getHeight()-1),b=Math.floor(l+(b-l)*x),v+=this.sizeOfBlackWhiteBlackRun(l,h,b,E),v-1}sizeOfBlackWhiteBlackRun(l,h,f,g){const v=Math.abs(g-h)>Math.abs(f-l);if(v){let Y=l;l=h,h=Y,Y=f,f=g,g=Y}const x=Math.abs(f-l),b=Math.abs(g-h);let E=-x/2;const D=l<f?1:-1,R=h<g?1:-1;let F=0;const B=f+D;for(let Y=l,q=h;Y!==B;Y+=D){if(1===F===this.image.get(v?q:Y,v?Y:q)){if(2===F)return Qt.distance(Y,q,l,h);F++}if(E+=b,E>0){if(q===g)break;q+=R,E-=x}}return 2===F?Qt.distance(f+D,g,l,h):NaN}findAlignmentInRegion(l,h,f,g){const v=Math.floor(g*l),x=Math.max(0,h-v),b=Math.min(this.image.getWidth()-1,h+v);if(b-x<3*l)throw new ie("Alignment top exceeds estimated module size.");const E=Math.max(0,f-v),D=Math.min(this.image.getHeight()-1,f+v);if(D-E<3*l)throw new ie("Alignment bottom exceeds estimated module size.");return new Zt(this.image,x,E,b-x,D-E,l,this.resultPointCallback).find()}}class Ji{constructor(){this.decoder=new Ld}getDecoder(){return this.decoder}decode(l,h){let f,g;if(null!=h&&void 0!==h.get(yn.PURE_BARCODE)){const E=Ji.extractPureBits(l.getBlackMatrix());f=this.decoder.decodeBitMatrix(E,h),g=Ji.NO_POINTS}else{const E=new ln(l.getBlackMatrix()).detect(h);f=this.decoder.decodeBitMatrix(E.getBits(),h),g=E.getPoints()}f.getOther()instanceof Wl&&f.getOther().applyMirroredCorrection(g);const v=new Vr(f.getText(),f.getRawBytes(),void 0,g,pt.QR_CODE,void 0),x=f.getByteSegments();null!==x&&v.putMetadata(wr.BYTE_SEGMENTS,x);const b=f.getECLevel();return null!==b&&v.putMetadata(wr.ERROR_CORRECTION_LEVEL,b),f.hasStructuredAppend()&&(v.putMetadata(wr.STRUCTURED_APPEND_SEQUENCE,f.getStructuredAppendSequenceNumber()),v.putMetadata(wr.STRUCTURED_APPEND_PARITY,f.getStructuredAppendParity())),v}reset(){}static extractPureBits(l){const h=l.getTopLeftOnBit(),f=l.getBottomRightOnBit();if(null===h||null===f)throw new ie;const g=this.moduleSize(h,l);let v=h[1],x=f[1],b=h[0],E=f[0];if(b>=E||v>=x)throw new ie;if(x-v!=E-b&&(E=b+(x-v),E>=l.getWidth()))throw new ie;const D=Math.round((E-b+1)/g),R=Math.round((x-v+1)/g);if(D<=0||R<=0)throw new ie;if(R!==D)throw new ie;const F=Math.floor(g/2);v+=F,b+=F;const B=b+Math.floor((D-1)*g)-E;if(B>0){if(B>F)throw new ie;b-=B}const Y=v+Math.floor((R-1)*g)-x;if(Y>0){if(Y>F)throw new ie;v-=Y}const q=new bt(D,R);for(let te=0;te<R;te++){const re=v+Math.floor(te*g);for(let ae=0;ae<D;ae++)l.get(b+Math.floor(ae*g),re)&&q.set(ae,te)}return q}static moduleSize(l,h){const f=h.getHeight(),g=h.getWidth();let v=l[0],x=l[1],b=!0,E=0;for(;v<g&&x<f;){if(b!==h.get(v,x)){if(5==++E)break;b=!b}v++,x++}if(v===g||x===f)throw new ie;return(v-l[0])/7}}Ji.NO_POINTS=new Array;class I{PDF417Common(){}static getBitCountSum(l){return Qt.sum(l)}static toIntArray(l){if(null==l||!l.length)return I.EMPTY_INT_ARRAY;const h=new Int32Array(l.length);let f=0;for(const g of l)h[f++]=g;return h}static getCodeword(l){const h=Cn.binarySearch(I.SYMBOL_TABLE,262143&l);return h<0?-1:(I.CODEWORD_TABLE[h]-1)%I.NUMBER_OF_CODEWORDS}}I.NUMBER_OF_CODEWORDS=929,I.MAX_CODEWORDS_IN_BARCODE=I.NUMBER_OF_CODEWORDS-1,I.MIN_ROWS_IN_BARCODE=3,I.MAX_ROWS_IN_BARCODE=90,I.MODULES_IN_CODEWORD=17,I.MODULES_IN_STOP_PATTERN=18,I.BARS_IN_MODULE=8,I.EMPTY_INT_ARRAY=new Int32Array([]),I.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),I.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class k{constructor(l,h){this.bits=l,this.points=h}getBits(){return this.bits}getPoints(){return this.points}}class P{static detectMultiple(l,h,f){let g=l.getBlackMatrix(),v=P.detect(f,g);return v.length||(g=g.clone(),g.rotate180(),v=P.detect(f,g)),new k(g,v)}static detect(l,h){const f=new Array;let g=0,v=0,x=!1;for(;g<h.getHeight();){const b=P.findVertices(h,g,v);if(null!=b[0]||null!=b[3]){if(x=!0,f.push(b),!l)break;null!=b[2]?(v=Math.trunc(b[2].getX()),g=Math.trunc(b[2].getY())):(v=Math.trunc(b[4].getX()),g=Math.trunc(b[4].getY()))}else{if(!x)break;x=!1,v=0;for(const E of f)null!=E[1]&&(g=Math.trunc(Math.max(g,E[1].getY()))),null!=E[3]&&(g=Math.max(g,Math.trunc(E[3].getY())));g+=P.ROW_STEP}}return f}static findVertices(l,h,f){const g=l.getHeight(),v=l.getWidth(),x=new Array(8);return P.copyToResult(x,P.findRowsWithPattern(l,g,v,h,f,P.START_PATTERN),P.INDEXES_START_PATTERN),null!=x[4]&&(f=Math.trunc(x[4].getX()),h=Math.trunc(x[4].getY())),P.copyToResult(x,P.findRowsWithPattern(l,g,v,h,f,P.STOP_PATTERN),P.INDEXES_STOP_PATTERN),x}static copyToResult(l,h,f){for(let g=0;g<f.length;g++)l[f[g]]=h[g]}static findRowsWithPattern(l,h,f,g,v,x){const b=new Array(4);let E=!1;const D=new Int32Array(x.length);for(;g<h;g+=P.ROW_STEP){let F=P.findGuardPattern(l,v,g,f,!1,x,D);if(null!=F){for(;g>0;){const B=P.findGuardPattern(l,v,--g,f,!1,x,D);if(null==B){g++;break}F=B}b[0]=new Xe(F[0],g),b[1]=new Xe(F[1],g),E=!0;break}}let R=g+1;if(E){let F=0,B=Int32Array.from([Math.trunc(b[0].getX()),Math.trunc(b[1].getX())]);for(;R<h;R++){const Y=P.findGuardPattern(l,B[0],R,f,!1,x,D);if(null!=Y&&Math.abs(B[0]-Y[0])<P.MAX_PATTERN_DRIFT&&Math.abs(B[1]-Y[1])<P.MAX_PATTERN_DRIFT)B=Y,F=0;else{if(F>P.SKIPPED_ROW_COUNT_MAX)break;F++}}R-=F+1,b[2]=new Xe(B[0],R),b[3]=new Xe(B[1],R)}return R-g<P.BARCODE_MIN_HEIGHT&&Cn.fill(b,null),b}static findGuardPattern(l,h,f,g,v,x,b){Cn.fillWithin(b,0,b.length,0);let E=h,D=0;for(;l.get(E,f)&&E>0&&D++<P.MAX_PIXEL_DRIFT;)E--;let R=E,F=0,B=x.length;for(let Y=v;R<g;R++)if(l.get(R,f)!==Y)b[F]++;else{if(F===B-1){if(P.patternMatchVariance(b,x,P.MAX_INDIVIDUAL_VARIANCE)<P.MAX_AVG_VARIANCE)return new Int32Array([E,R]);E+=b[0]+b[1],$t.arraycopy(b,2,b,0,F-1),b[F-1]=0,b[F]=0,F--}else F++;b[F]=1,Y=!Y}return F===B-1&&P.patternMatchVariance(b,x,P.MAX_INDIVIDUAL_VARIANCE)<P.MAX_AVG_VARIANCE?new Int32Array([E,R-1]):null}static patternMatchVariance(l,h,f){let g=l.length,v=0,x=0;for(let D=0;D<g;D++)v+=l[D],x+=h[D];if(v<x)return 1/0;let b=v/x;f*=b;let E=0;for(let D=0;D<g;D++){let R=l[D],F=h[D]*b,B=R>F?R-F:F-R;if(B>f)return 1/0;E+=B}return E/v}}P.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),P.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),P.MAX_AVG_VARIANCE=.42,P.MAX_INDIVIDUAL_VARIANCE=.8,P.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),P.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),P.MAX_PIXEL_DRIFT=3,P.MAX_PATTERN_DRIFT=5,P.SKIPPED_ROW_COUNT_MAX=25,P.ROW_STEP=5,P.BARCODE_MIN_HEIGHT=10;class W{constructor(l,h){if(0===h.length)throw new Ke;this.field=l;let f=h.length;if(f>1&&0===h[0]){let g=1;for(;g<f&&0===h[g];)g++;g===f?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(f-g),$t.arraycopy(h,g,this.coefficients,0,this.coefficients.length))}else this.coefficients=h}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return 0===this.coefficients[0]}getCoefficient(l){return this.coefficients[this.coefficients.length-1-l]}evaluateAt(l){if(0===l)return this.getCoefficient(0);if(1===l){let g=0;for(let v of this.coefficients)g=this.field.add(g,v);return g}let h=this.coefficients[0],f=this.coefficients.length;for(let g=1;g<f;g++)h=this.field.add(this.field.multiply(l,h),this.coefficients[g]);return h}add(l){if(!this.field.equals(l.field))throw new Ke("ModulusPolys do not have same ModulusGF field");if(this.isZero())return l;if(l.isZero())return this;let h=this.coefficients,f=l.coefficients;if(h.length>f.length){let x=h;h=f,f=x}let g=new Int32Array(f.length),v=f.length-h.length;$t.arraycopy(f,0,g,0,v);for(let x=v;x<f.length;x++)g[x]=this.field.add(h[x-v],f[x]);return new W(this.field,g)}subtract(l){if(!this.field.equals(l.field))throw new Ke("ModulusPolys do not have same ModulusGF field");return l.isZero()?this:this.add(l.negative())}multiply(l){return l instanceof W?this.multiplyOther(l):this.multiplyScalar(l)}multiplyOther(l){if(!this.field.equals(l.field))throw new Ke("ModulusPolys do not have same ModulusGF field");if(this.isZero()||l.isZero())return new W(this.field,new Int32Array([0]));let h=this.coefficients,f=h.length,g=l.coefficients,v=g.length,x=new Int32Array(f+v-1);for(let b=0;b<f;b++){let E=h[b];for(let D=0;D<v;D++)x[b+D]=this.field.add(x[b+D],this.field.multiply(E,g[D]))}return new W(this.field,x)}negative(){let l=this.coefficients.length,h=new Int32Array(l);for(let f=0;f<l;f++)h[f]=this.field.subtract(0,this.coefficients[f]);return new W(this.field,h)}multiplyScalar(l){if(0===l)return new W(this.field,new Int32Array([0]));if(1===l)return this;let h=this.coefficients.length,f=new Int32Array(h);for(let g=0;g<h;g++)f[g]=this.field.multiply(this.coefficients[g],l);return new W(this.field,f)}multiplyByMonomial(l,h){if(l<0)throw new Ke;if(0===h)return new W(this.field,new Int32Array([0]));let f=this.coefficients.length,g=new Int32Array(f+l);for(let v=0;v<f;v++)g[v]=this.field.multiply(this.coefficients[v],h);return new W(this.field,g)}toString(){let l=new Oe;for(let h=this.getDegree();h>=0;h--){let f=this.getCoefficient(h);0!==f&&(f<0?(l.append(" - "),f=-f):l.length()>0&&l.append(" + "),(0===h||1!==f)&&l.append(f),0!==h&&(1===h?l.append("x"):(l.append("x^"),l.append(h))))}return l.toString()}}class ce extends class{add(l,h){return(l+h)%this.modulus}subtract(l,h){return(this.modulus+l-h)%this.modulus}exp(l){return this.expTable[l]}log(l){if(0===l)throw new Ke;return this.logTable[l]}inverse(l){if(0===l)throw new ru;return this.expTable[this.modulus-this.logTable[l]-1]}multiply(l,h){return 0===l||0===h?0:this.expTable[(this.logTable[l]+this.logTable[h])%(this.modulus-1)]}getSize(){return this.modulus}equals(l){return l===this}}{constructor(l,h){super(),this.modulus=l,this.expTable=new Int32Array(l),this.logTable=new Int32Array(l);let f=1;for(let g=0;g<l;g++)this.expTable[g]=f,f=f*h%l;for(let g=0;g<l-1;g++)this.logTable[this.expTable[g]]=g;this.zero=new W(this,new Int32Array([0])),this.one=new W(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(l,h){if(l<0)throw new Ke;if(0===h)return this.zero;let f=new Int32Array(l+1);return f[0]=h,new W(this,f)}}ce.PDF417_GF=new ce(I.NUMBER_OF_CODEWORDS,3);class ne{constructor(){this.field=ce.PDF417_GF}decode(l,h,f){let g=new W(this.field,l),v=new Int32Array(h),x=!1;for(let q=h;q>0;q--){let te=g.evaluateAt(this.field.exp(q));v[h-q]=te,0!==te&&(x=!0)}if(!x)return 0;let b=this.field.getOne();if(null!=f)for(const q of f){let te=this.field.exp(l.length-1-q),re=new W(this.field,new Int32Array([this.field.subtract(0,te),1]));b=b.multiply(re)}let E=new W(this.field,v),D=this.runEuclideanAlgorithm(this.field.buildMonomial(h,1),E,h),R=D[0],F=D[1],B=this.findErrorLocations(R),Y=this.findErrorMagnitudes(F,R,B);for(let q=0;q<B.length;q++){let te=l.length-1-this.field.log(B[q]);if(te<0)throw At.getChecksumInstance();l[te]=this.field.subtract(l[te],Y[q])}return B.length}runEuclideanAlgorithm(l,h,f){if(l.getDegree()<h.getDegree()){let B=l;l=h,h=B}let g=l,v=h,x=this.field.getZero(),b=this.field.getOne();for(;v.getDegree()>=Math.round(f/2);){let B=g,Y=x;if(g=v,x=b,g.isZero())throw At.getChecksumInstance();v=B;let q=this.field.getZero(),te=g.getCoefficient(g.getDegree()),re=this.field.inverse(te);for(;v.getDegree()>=g.getDegree()&&!v.isZero();){let ae=v.getDegree()-g.getDegree(),Te=this.field.multiply(v.getCoefficient(v.getDegree()),re);q=q.add(this.field.buildMonomial(ae,Te)),v=v.subtract(g.multiplyByMonomial(ae,Te))}b=q.multiply(x).subtract(Y).negative()}let E=b.getCoefficient(0);if(0===E)throw At.getChecksumInstance();let D=this.field.inverse(E);return[b.multiply(D),v.multiply(D)]}findErrorLocations(l){let h=l.getDegree(),f=new Int32Array(h),g=0;for(let v=1;v<this.field.getSize()&&g<h;v++)0===l.evaluateAt(v)&&(f[g]=this.field.inverse(v),g++);if(g!==h)throw At.getChecksumInstance();return f}findErrorMagnitudes(l,h,f){let g=h.getDegree(),v=new Int32Array(g);for(let D=1;D<=g;D++)v[g-D]=this.field.multiply(D,h.getCoefficient(D));let x=new W(this.field,v),b=f.length,E=new Int32Array(b);for(let D=0;D<b;D++){let R=this.field.inverse(f[D]),F=this.field.subtract(0,l.evaluateAt(R)),B=this.field.inverse(x.evaluateAt(R));E[D]=this.field.multiply(F,B)}return E}}class xe{constructor(l,h,f,g,v){l instanceof xe?this.constructor_2(l):this.constructor_1(l,h,f,g,v)}constructor_1(l,h,f,g,v){const x=null==h||null==f,b=null==g||null==v;if(x&&b)throw new ie;x?(h=new Xe(0,g.getY()),f=new Xe(0,v.getY())):b&&(g=new Xe(l.getWidth()-1,h.getY()),v=new Xe(l.getWidth()-1,f.getY())),this.image=l,this.topLeft=h,this.bottomLeft=f,this.topRight=g,this.bottomRight=v,this.minX=Math.trunc(Math.min(h.getX(),f.getX())),this.maxX=Math.trunc(Math.max(g.getX(),v.getX())),this.minY=Math.trunc(Math.min(h.getY(),g.getY())),this.maxY=Math.trunc(Math.max(f.getY(),v.getY()))}constructor_2(l){this.image=l.image,this.topLeft=l.getTopLeft(),this.bottomLeft=l.getBottomLeft(),this.topRight=l.getTopRight(),this.bottomRight=l.getBottomRight(),this.minX=l.getMinX(),this.maxX=l.getMaxX(),this.minY=l.getMinY(),this.maxY=l.getMaxY()}static merge(l,h){return null==l?h:null==h?l:new xe(l.image,l.topLeft,l.bottomLeft,h.topRight,h.bottomRight)}addMissingRows(l,h,f){let g=this.topLeft,v=this.bottomLeft,x=this.topRight,b=this.bottomRight;if(l>0){let E=f?this.topLeft:this.topRight,D=Math.trunc(E.getY()-l);D<0&&(D=0);let R=new Xe(E.getX(),D);f?g=R:x=R}if(h>0){let E=f?this.bottomLeft:this.bottomRight,D=Math.trunc(E.getY()+h);D>=this.image.getHeight()&&(D=this.image.getHeight()-1);let R=new Xe(E.getX(),D);f?v=R:b=R}return new xe(this.image,g,v,x,b)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class be{constructor(l,h,f,g){this.columnCount=l,this.errorCorrectionLevel=g,this.rowCountUpperPart=h,this.rowCountLowerPart=f,this.rowCount=h+f}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class ke{constructor(){this.buffer=""}static form(l,h){let f=-1;return l.replace(/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g,function(x,b,E,D,R,F){if("%%"===x)return"%";if(void 0===h[++f])return;x=D?parseInt(D.substr(1)):void 0;let Y,B=R?parseInt(R.substr(1)):void 0;switch(F){case"s":Y=h[f];break;case"c":Y=h[f][0];break;case"f":Y=parseFloat(h[f]).toFixed(x);break;case"p":Y=parseFloat(h[f]).toPrecision(x);break;case"e":Y=parseFloat(h[f]).toExponential(x);break;case"x":Y=parseInt(h[f]).toString(B||16);break;case"d":Y=parseFloat(parseInt(h[f],B||10).toPrecision(x)).toFixed(0)}Y="object"==typeof Y?JSON.stringify(Y):(+Y).toString(B);let q=parseInt(E),te=E&&E[0]+""=="0"?"0":" ";for(;Y.length<q;)Y=void 0!==b?Y+te:te+Y;return Y})}format(l,...h){this.buffer+=ke.form(l,h)}toString(){return this.buffer}}let vt=(()=>{class S{constructor(h){this.boundingBox=new xe(h),this.codewords=new Array(h.getMaxY()-h.getMinY()+1)}getCodewordNearby(h){let f=this.getCodeword(h);if(null!=f)return f;for(let g=1;g<S.MAX_NEARBY_DISTANCE;g++){let v=this.imageRowToCodewordIndex(h)-g;if(v>=0&&(f=this.codewords[v],null!=f)||(v=this.imageRowToCodewordIndex(h)+g,v<this.codewords.length&&(f=this.codewords[v],null!=f)))return f}return null}imageRowToCodewordIndex(h){return h-this.boundingBox.getMinY()}setCodeword(h,f){this.codewords[this.imageRowToCodewordIndex(h)]=f}getCodeword(h){return this.codewords[this.imageRowToCodewordIndex(h)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){const h=new ke;let f=0;for(const g of this.codewords)null!=g?h.format("%3d: %3d|%3d%n",f++,g.getRowNumber(),g.getValue()):h.format("%3d:    |   %n",f++);return h.toString()}}return S.MAX_NEARBY_DISTANCE=5,S})();class Tt{constructor(){this.values=new Map}setValue(l){l=Math.trunc(l);let h=this.values.get(l);null==h&&(h=0),h++,this.values.set(l,h)}getValue(){let l=-1,h=new Array;for(const[f,g]of this.values.entries()){const v={getKey:()=>f,getValue:()=>g};v.getValue()>l?(l=v.getValue(),h=[],h.push(v.getKey())):v.getValue()===l&&h.push(v.getKey())}return I.toIntArray(h)}getConfidence(l){return this.values.get(l)}}class gt extends vt{constructor(l,h){super(l),this._isLeft=h}setRowNumbers(){for(let l of this.getCodewords())null!=l&&l.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(l){let h=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(h,l);let f=this.getBoundingBox(),g=this._isLeft?f.getTopLeft():f.getTopRight(),v=this._isLeft?f.getBottomLeft():f.getBottomRight(),x=this.imageRowToCodewordIndex(Math.trunc(g.getY())),b=this.imageRowToCodewordIndex(Math.trunc(v.getY())),E=-1,D=1,R=0;for(let F=x;F<b;F++){if(null==h[F])continue;let B=h[F],Y=B.getRowNumber()-E;if(0===Y)R++;else if(1===Y)D=Math.max(D,R),R=1,E=B.getRowNumber();else if(Y<0||B.getRowNumber()>=l.getRowCount()||Y>F)h[F]=null;else{let q;q=D>2?(D-2)*Y:Y;let te=q>=F;for(let re=1;re<=q&&!te;re++)te=null!=h[F-re];te?h[F]=null:(E=B.getRowNumber(),R=1)}}}getRowHeights(){let l=this.getBarcodeMetadata();if(null==l)return null;this.adjustIncompleteIndicatorColumnRowNumbers(l);let h=new Int32Array(l.getRowCount());for(let f of this.getCodewords())if(null!=f){let g=f.getRowNumber();if(g>=h.length)continue;h[g]++}return h}adjustIncompleteIndicatorColumnRowNumbers(l){let h=this.getBoundingBox(),f=this._isLeft?h.getTopLeft():h.getTopRight(),g=this._isLeft?h.getBottomLeft():h.getBottomRight(),v=this.imageRowToCodewordIndex(Math.trunc(f.getY())),x=this.imageRowToCodewordIndex(Math.trunc(g.getY())),b=this.getCodewords(),E=-1;for(let D=v;D<x;D++){if(null==b[D])continue;let R=b[D];R.setRowNumberAsRowIndicatorColumn();let F=R.getRowNumber()-E;0===F||(1===F?E=R.getRowNumber():R.getRowNumber()>=l.getRowCount()?b[D]=null:E=R.getRowNumber())}}getBarcodeMetadata(){let l=this.getCodewords(),h=new Tt,f=new Tt,g=new Tt,v=new Tt;for(let b of l){if(null==b)continue;b.setRowNumberAsRowIndicatorColumn();let E=b.getValue()%30,D=b.getRowNumber();switch(this._isLeft||(D+=2),D%3){case 0:f.setValue(3*E+1);break;case 1:v.setValue(E/3),g.setValue(E%3);break;case 2:h.setValue(E+1)}}if(0===h.getValue().length||0===f.getValue().length||0===g.getValue().length||0===v.getValue().length||h.getValue()[0]<1||f.getValue()[0]+g.getValue()[0]<I.MIN_ROWS_IN_BARCODE||f.getValue()[0]+g.getValue()[0]>I.MAX_ROWS_IN_BARCODE)return null;let x=new be(h.getValue()[0],f.getValue()[0],g.getValue()[0],v.getValue()[0]);return this.removeIncorrectCodewords(l,x),x}removeIncorrectCodewords(l,h){for(let f=0;f<l.length;f++){let g=l[f];if(null==l[f])continue;let v=g.getValue()%30,x=g.getRowNumber();if(x>h.getRowCount())l[f]=null;else switch(this._isLeft||(x+=2),x%3){case 0:3*v+1!==h.getRowCountUpperPart()&&(l[f]=null);break;case 1:(Math.trunc(v/3)!==h.getErrorCorrectionLevel()||v%3!==h.getRowCountLowerPart())&&(l[f]=null);break;case 2:v+1!==h.getColumnCount()&&(l[f]=null)}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+"\n"+super.toString()}}class Qe{constructor(l,h){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=l,this.barcodeColumnCount=l.getColumnCount(),this.boundingBox=h,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let h,l=I.MAX_CODEWORDS_IN_BARCODE;do{h=l,l=this.adjustRowNumbersAndGetCount()}while(l>0&&l<h);return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(l){null!=l&&l.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let l=this.adjustRowNumbersByRow();if(0===l)return 0;for(let h=1;h<this.barcodeColumnCount+1;h++){let f=this.detectionResultColumns[h].getCodewords();for(let g=0;g<f.length;g++)null!=f[g]&&(f[g].hasValidRowNumber()||this.adjustRowNumbers(h,g,f))}return l}adjustRowNumbersByRow(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(null==this.detectionResultColumns[0]||null==this.detectionResultColumns[this.barcodeColumnCount+1])return;let l=this.detectionResultColumns[0].getCodewords(),h=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let f=0;f<l.length;f++)if(null!=l[f]&&null!=h[f]&&l[f].getRowNumber()===h[f].getRowNumber())for(let g=1;g<=this.barcodeColumnCount;g++){let v=this.detectionResultColumns[g].getCodewords()[f];null!=v&&(v.setRowNumber(l[f].getRowNumber()),v.hasValidRowNumber()||(this.detectionResultColumns[g].getCodewords()[f]=null))}}adjustRowNumbersFromRRI(){if(null==this.detectionResultColumns[this.barcodeColumnCount+1])return 0;let l=0,h=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let f=0;f<h.length;f++){if(null==h[f])continue;let g=h[f].getRowNumber(),v=0;for(let x=this.barcodeColumnCount+1;x>0&&v<this.ADJUST_ROW_NUMBER_SKIP;x--){let b=this.detectionResultColumns[x].getCodewords()[f];null!=b&&(v=Qe.adjustRowNumberIfValid(g,v,b),b.hasValidRowNumber()||l++)}}return l}adjustRowNumbersFromLRI(){if(null==this.detectionResultColumns[0])return 0;let l=0,h=this.detectionResultColumns[0].getCodewords();for(let f=0;f<h.length;f++){if(null==h[f])continue;let g=h[f].getRowNumber(),v=0;for(let x=1;x<this.barcodeColumnCount+1&&v<this.ADJUST_ROW_NUMBER_SKIP;x++){let b=this.detectionResultColumns[x].getCodewords()[f];null!=b&&(v=Qe.adjustRowNumberIfValid(g,v,b),b.hasValidRowNumber()||l++)}}return l}static adjustRowNumberIfValid(l,h,f){return null==f||f.hasValidRowNumber()||(f.isValidRowNumber(l)?(f.setRowNumber(l),h=0):++h),h}adjustRowNumbers(l,h,f){let g=f[h],v=this.detectionResultColumns[l-1].getCodewords(),x=v;null!=this.detectionResultColumns[l+1]&&(x=this.detectionResultColumns[l+1].getCodewords());let b=new Array(14);b[2]=v[h],b[3]=x[h],h>0&&(b[0]=f[h-1],b[4]=v[h-1],b[5]=x[h-1]),h>1&&(b[8]=f[h-2],b[10]=v[h-2],b[11]=x[h-2]),h<f.length-1&&(b[1]=f[h+1],b[6]=v[h+1],b[7]=x[h+1]),h<f.length-2&&(b[9]=f[h+2],b[12]=v[h+2],b[13]=x[h+2]);for(let E of b)if(Qe.adjustRowNumber(g,E))return}static adjustRowNumber(l,h){return!(null==h||!h.hasValidRowNumber()||h.getBucket()!==l.getBucket()||(l.setRowNumber(h.getRowNumber()),0))}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(l){this.boundingBox=l}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(l,h){this.detectionResultColumns[l]=h}getDetectionResultColumn(l){return this.detectionResultColumns[l]}toString(){let l=this.detectionResultColumns[0];null==l&&(l=this.detectionResultColumns[this.barcodeColumnCount+1]);let h=new ke;for(let f=0;f<l.getCodewords().length;f++){h.format("CW %3d:",f);for(let g=0;g<this.barcodeColumnCount+2;g++){if(null==this.detectionResultColumns[g]){h.format("    |   ");continue}let v=this.detectionResultColumns[g].getCodewords()[f];null!=v?h.format(" %3d|%3d",v.getRowNumber(),v.getValue()):h.format("    |   ")}h.format("%n")}return h.toString()}}let Mt=(()=>{class S{constructor(h,f,g,v){this.rowNumber=S.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(h),this.endX=Math.trunc(f),this.bucket=Math.trunc(g),this.value=Math.trunc(v)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(h){return h!==S.BARCODE_ROW_UNKNOWN&&this.bucket===h%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(3*Math.trunc(this.value/30)+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(h){this.rowNumber=h}toString(){return this.rowNumber+"|"+this.value}}return S.BARCODE_ROW_UNKNOWN=-1,S})();class Je{static initialize(){for(let l=0;l<I.SYMBOL_TABLE.length;l++){let h=I.SYMBOL_TABLE[l],f=1&h;for(let g=0;g<I.BARS_IN_MODULE;g++){let v=0;for(;(1&h)===f;)v+=1,h>>=1;f=1&h,Je.RATIOS_TABLE[l]||(Je.RATIOS_TABLE[l]=new Array(I.BARS_IN_MODULE)),Je.RATIOS_TABLE[l][I.BARS_IN_MODULE-g-1]=Math.fround(v/I.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(l){let h=Je.getDecodedCodewordValue(Je.sampleBitCounts(l));return-1!==h?h:Je.getClosestDecodedValue(l)}static sampleBitCounts(l){let h=Qt.sum(l),f=new Int32Array(I.BARS_IN_MODULE),g=0,v=0;for(let x=0;x<I.MODULES_IN_CODEWORD;x++)v+l[g]<=h/(2*I.MODULES_IN_CODEWORD)+x*h/I.MODULES_IN_CODEWORD&&(v+=l[g],g++),f[g]++;return f}static getDecodedCodewordValue(l){let h=Je.getBitValue(l);return-1===I.getCodeword(h)?-1:h}static getBitValue(l){let h=0;for(let f=0;f<l.length;f++)for(let g=0;g<l[f];g++)h=h<<1|(f%2==0?1:0);return Math.trunc(h)}static getClosestDecodedValue(l){let h=Qt.sum(l),f=new Array(I.BARS_IN_MODULE);if(h>1)for(let x=0;x<f.length;x++)f[x]=Math.fround(l[x]/h);let g=Gu.MAX_VALUE,v=-1;this.bSymbolTableReady||Je.initialize();for(let x=0;x<Je.RATIOS_TABLE.length;x++){let b=0,E=Je.RATIOS_TABLE[x];for(let D=0;D<I.BARS_IN_MODULE;D++){let R=Math.fround(E[D]-f[D]);if(b+=Math.fround(R*R),b>=g)break}b<g&&(g=b,v=I.SYMBOL_TABLE[x])}return v}}Je.bSymbolTableReady=!1,Je.RATIOS_TABLE=new Array(I.SYMBOL_TABLE.length).map(S=>new Array(I.BARS_IN_MODULE));class Ut{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(l){this.segmentIndex=l}getFileId(){return this.fileId}setFileId(l){this.fileId=l}getOptionalData(){return this.optionalData}setOptionalData(l){this.optionalData=l}isLastSegment(){return this.lastSegment}setLastSegment(l){this.lastSegment=l}getSegmentCount(){return this.segmentCount}setSegmentCount(l){this.segmentCount=l}getSender(){return this.sender||null}setSender(l){this.sender=l}getAddressee(){return this.addressee||null}setAddressee(l){this.addressee=l}getFileName(){return this.fileName}setFileName(l){this.fileName=l}getFileSize(){return this.fileSize}setFileSize(l){this.fileSize=l}getChecksum(){return this.checksum}setChecksum(l){this.checksum=l}getTimestamp(){return this.timestamp}setTimestamp(l){this.timestamp=l}}class Pt{static parseLong(l,h){return parseInt(l,h)}}let tr=(()=>{class S extends br{}return S.kind="NullPointerException",S})();class Kn extends br{}class pn extends class{writeBytes(l){this.writeBytesOffset(l,0,l.length)}writeBytesOffset(l,h,f){if(null==l)throw new tr;if(h<0||h>l.length||f<0||h+f>l.length||h+f<0)throw new Vi;if(0!==f)for(let g=0;g<f;g++)this.write(l[h+g])}flush(){}close(){}}{constructor(l=32){if(super(),this.count=0,l<0)throw new Ke("Negative initial size: "+l);this.buf=new Uint8Array(l)}ensureCapacity(l){l-this.buf.length>0&&this.grow(l)}grow(l){let f=this.buf.length<<1;if(f-l<0&&(f=l),f<0){if(l<0)throw new Kn;f=Dt.MAX_VALUE}this.buf=Cn.copyOfUint8Array(this.buf,f)}write(l){this.ensureCapacity(this.count+1),this.buf[this.count]=l,this.count+=1}writeBytesOffset(l,h,f){if(h<0||h>l.length||f<0||h+f-l.length>0)throw new Vi;this.ensureCapacity(this.count+f),$t.arraycopy(l,h,this.buf,this.count,f),this.count+=f}writeTo(l){l.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return Cn.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(l){return l?"string"==typeof l?this.toString_string(l):this.toString_number(l):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(l){return new String(this.buf).toString()}toString_number(l){return new String(this.buf).toString()}close(){}}var ot=(()=>{return(S=ot||(ot={}))[S.ALPHA=0]="ALPHA",S[S.LOWER=1]="LOWER",S[S.MIXED=2]="MIXED",S[S.PUNCT=3]="PUNCT",S[S.ALPHA_SHIFT=4]="ALPHA_SHIFT",S[S.PUNCT_SHIFT=5]="PUNCT_SHIFT",ot;var S})();function Ne(){if("undefined"!=typeof window)return window.BigInt||null;if("undefined"!=typeof global)return global.BigInt||null;if("undefined"!=typeof self)return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}let jt;function Fn(S){if(void 0===jt&&(jt=Ne()),null===jt)throw new Error("BigInt is not supported!");return jt(S)}class ue{static decode(l,h){let f=new Oe(""),g=ee.ISO8859_1;f.enableDecoding(g);let v=1,x=l[v++],b=new Ut;for(;v<l[0];){switch(x){case ue.TEXT_COMPACTION_MODE_LATCH:v=ue.textCompaction(l,v,f);break;case ue.BYTE_COMPACTION_MODE_LATCH:case ue.BYTE_COMPACTION_MODE_LATCH_6:v=ue.byteCompaction(x,l,g,v,f);break;case ue.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:f.append(l[v++]);break;case ue.NUMERIC_COMPACTION_MODE_LATCH:v=ue.numericCompaction(l,v,f);break;case ue.ECI_CHARSET:ee.getCharacterSetECIByValue(l[v++]);break;case ue.ECI_GENERAL_PURPOSE:v+=2;break;case ue.ECI_USER_DEFINED:v++;break;case ue.BEGIN_MACRO_PDF417_CONTROL_BLOCK:v=ue.decodeMacroBlock(l,v,b);break;case ue.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case ue.MACRO_PDF417_TERMINATOR:throw new Re;default:v--,v=ue.textCompaction(l,v,f)}if(!(v<l.length))throw Re.getFormatInstance();x=l[v++]}if(0===f.length())throw Re.getFormatInstance();let E=new Ds(null,f.toString(),null,h);return E.setOther(b),E}static decodeMacroBlock(l,h,f){if(h+ue.NUMBER_OF_SEQUENCE_CODEWORDS>l[0])throw Re.getFormatInstance();let g=new Int32Array(ue.NUMBER_OF_SEQUENCE_CODEWORDS);for(let b=0;b<ue.NUMBER_OF_SEQUENCE_CODEWORDS;b++,h++)g[b]=l[h];f.setSegmentIndex(Dt.parseInt(ue.decodeBase900toBase10(g,ue.NUMBER_OF_SEQUENCE_CODEWORDS)));let v=new Oe;h=ue.textCompaction(l,h,v),f.setFileId(v.toString());let x=-1;for(l[h]===ue.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(x=h+1);h<l[0];)switch(l[h]){case ue.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(l[++h]){case ue.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let b=new Oe;h=ue.textCompaction(l,h+1,b),f.setFileName(b.toString());break;case ue.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let E=new Oe;h=ue.textCompaction(l,h+1,E),f.setSender(E.toString());break;case ue.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let D=new Oe;h=ue.textCompaction(l,h+1,D),f.setAddressee(D.toString());break;case ue.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let R=new Oe;h=ue.numericCompaction(l,h+1,R),f.setSegmentCount(Dt.parseInt(R.toString()));break;case ue.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let F=new Oe;h=ue.numericCompaction(l,h+1,F),f.setTimestamp(Pt.parseLong(F.toString()));break;case ue.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let B=new Oe;h=ue.numericCompaction(l,h+1,B),f.setChecksum(Dt.parseInt(B.toString()));break;case ue.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let Y=new Oe;h=ue.numericCompaction(l,h+1,Y),f.setFileSize(Pt.parseLong(Y.toString()));break;default:throw Re.getFormatInstance()}break;case ue.MACRO_PDF417_TERMINATOR:h++,f.setLastSegment(!0);break;default:throw Re.getFormatInstance()}if(-1!==x){let b=h-x;f.isLastSegment()&&b--,f.setOptionalData(Cn.copyOfRange(l,x,x+b))}return h}static textCompaction(l,h,f){let g=new Int32Array(2*(l[0]-h)),v=new Int32Array(2*(l[0]-h)),x=0,b=!1;for(;h<l[0]&&!b;){let E=l[h++];if(E<ue.TEXT_COMPACTION_MODE_LATCH)g[x]=E/30,g[x+1]=E%30,x+=2;else switch(E){case ue.TEXT_COMPACTION_MODE_LATCH:g[x++]=ue.TEXT_COMPACTION_MODE_LATCH;break;case ue.BYTE_COMPACTION_MODE_LATCH:case ue.BYTE_COMPACTION_MODE_LATCH_6:case ue.NUMERIC_COMPACTION_MODE_LATCH:case ue.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case ue.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case ue.MACRO_PDF417_TERMINATOR:h--,b=!0;break;case ue.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:g[x]=ue.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,E=l[h++],v[x]=E,x++}}return ue.decodeTextCompaction(g,v,x,f),h}static decodeTextCompaction(l,h,f,g){let v=ot.ALPHA,x=ot.ALPHA,b=0;for(;b<f;){let E=l[b],D="";switch(v){case ot.ALPHA:if(E<26)D=String.fromCharCode(65+E);else switch(E){case 26:D=" ";break;case ue.LL:v=ot.LOWER;break;case ue.ML:v=ot.MIXED;break;case ue.PS:x=v,v=ot.PUNCT_SHIFT;break;case ue.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:g.append(h[b]);break;case ue.TEXT_COMPACTION_MODE_LATCH:v=ot.ALPHA}break;case ot.LOWER:if(E<26)D=String.fromCharCode(97+E);else switch(E){case 26:D=" ";break;case ue.AS:x=v,v=ot.ALPHA_SHIFT;break;case ue.ML:v=ot.MIXED;break;case ue.PS:x=v,v=ot.PUNCT_SHIFT;break;case ue.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:g.append(h[b]);break;case ue.TEXT_COMPACTION_MODE_LATCH:v=ot.ALPHA}break;case ot.MIXED:if(E<ue.PL)D=ue.MIXED_CHARS[E];else switch(E){case ue.PL:v=ot.PUNCT;break;case 26:D=" ";break;case ue.LL:v=ot.LOWER;break;case ue.AL:v=ot.ALPHA;break;case ue.PS:x=v,v=ot.PUNCT_SHIFT;break;case ue.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:g.append(h[b]);break;case ue.TEXT_COMPACTION_MODE_LATCH:v=ot.ALPHA}break;case ot.PUNCT:if(E<ue.PAL)D=ue.PUNCT_CHARS[E];else switch(E){case ue.PAL:v=ot.ALPHA;break;case ue.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:g.append(h[b]);break;case ue.TEXT_COMPACTION_MODE_LATCH:v=ot.ALPHA}break;case ot.ALPHA_SHIFT:if(v=x,E<26)D=String.fromCharCode(65+E);else switch(E){case 26:D=" ";break;case ue.TEXT_COMPACTION_MODE_LATCH:v=ot.ALPHA}break;case ot.PUNCT_SHIFT:if(v=x,E<ue.PAL)D=ue.PUNCT_CHARS[E];else switch(E){case ue.PAL:v=ot.ALPHA;break;case ue.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:g.append(h[b]);break;case ue.TEXT_COMPACTION_MODE_LATCH:v=ot.ALPHA}}""!==D&&g.append(D),b++}}static byteCompaction(l,h,f,g,v){let x=new pn,b=0,E=0,D=!1;switch(l){case ue.BYTE_COMPACTION_MODE_LATCH:let R=new Int32Array(6),F=h[g++];for(;g<h[0]&&!D;)switch(R[b++]=F,E=900*E+F,F=h[g++],F){case ue.TEXT_COMPACTION_MODE_LATCH:case ue.BYTE_COMPACTION_MODE_LATCH:case ue.NUMERIC_COMPACTION_MODE_LATCH:case ue.BYTE_COMPACTION_MODE_LATCH_6:case ue.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case ue.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case ue.MACRO_PDF417_TERMINATOR:g--,D=!0;break;default:if(b%5==0&&b>0){for(let B=0;B<6;++B)x.write(Number(Fn(E)>>Fn(8*(5-B))));E=0,b=0}}g===h[0]&&F<ue.TEXT_COMPACTION_MODE_LATCH&&(R[b++]=F);for(let B=0;B<b;B++)x.write(R[B]);break;case ue.BYTE_COMPACTION_MODE_LATCH_6:for(;g<h[0]&&!D;){let B=h[g++];if(B<ue.TEXT_COMPACTION_MODE_LATCH)b++,E=900*E+B;else switch(B){case ue.TEXT_COMPACTION_MODE_LATCH:case ue.BYTE_COMPACTION_MODE_LATCH:case ue.NUMERIC_COMPACTION_MODE_LATCH:case ue.BYTE_COMPACTION_MODE_LATCH_6:case ue.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case ue.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case ue.MACRO_PDF417_TERMINATOR:g--,D=!0}if(b%5==0&&b>0){for(let Y=0;Y<6;++Y)x.write(Number(Fn(E)>>Fn(8*(5-Y))));E=0,b=0}}}return v.append(Ae.decode(x.toByteArray(),f)),g}static numericCompaction(l,h,f){let g=0,v=!1,x=new Int32Array(ue.MAX_NUMERIC_CODEWORDS);for(;h<l[0]&&!v;){let b=l[h++];if(h===l[0]&&(v=!0),b<ue.TEXT_COMPACTION_MODE_LATCH)x[g]=b,g++;else switch(b){case ue.TEXT_COMPACTION_MODE_LATCH:case ue.BYTE_COMPACTION_MODE_LATCH:case ue.BYTE_COMPACTION_MODE_LATCH_6:case ue.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case ue.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case ue.MACRO_PDF417_TERMINATOR:h--,v=!0}(g%ue.MAX_NUMERIC_CODEWORDS==0||b===ue.NUMERIC_COMPACTION_MODE_LATCH||v)&&g>0&&(f.append(ue.decodeBase900toBase10(x,g)),g=0)}return h}static decodeBase900toBase10(l,h){let f=Fn(0);for(let v=0;v<h;v++)f+=ue.EXP900[h-v-1]*Fn(l[v]);let g=f.toString();if("1"!==g.charAt(0))throw new Re;return g.substring(1)}}ue.TEXT_COMPACTION_MODE_LATCH=900,ue.BYTE_COMPACTION_MODE_LATCH=901,ue.NUMERIC_COMPACTION_MODE_LATCH=902,ue.BYTE_COMPACTION_MODE_LATCH_6=924,ue.ECI_USER_DEFINED=925,ue.ECI_GENERAL_PURPOSE=926,ue.ECI_CHARSET=927,ue.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,ue.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,ue.MACRO_PDF417_TERMINATOR=922,ue.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,ue.MAX_NUMERIC_CODEWORDS=15,ue.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,ue.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,ue.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,ue.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,ue.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,ue.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,ue.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,ue.PL=25,ue.LL=27,ue.AS=27,ue.ML=28,ue.AL=28,ue.PS=29,ue.PAL=29,ue.PUNCT_CHARS=";<>@[\\]_`~!\r\t,:\n-.$/\"|*()?{}'",ue.MIXED_CHARS="0123456789&\r\t,:#-.$/+%*=^",ue.EXP900=Ne()?function(){let S=[];S[0]=Fn(1);let l=Fn(900);S[1]=l;for(let h=2;h<16;h++)S[h]=S[h-1]*l;return S}():[],ue.NUMBER_OF_SEQUENCE_CODEWORDS=2;class mt{constructor(){}static decode(l,h,f,g,v,x,b){let F,E=new xe(l,h,f,g,v),D=null,R=null;for(let q=!0;;q=!1){if(null!=h&&(D=mt.getRowIndicatorColumn(l,E,h,!0,x,b)),null!=g&&(R=mt.getRowIndicatorColumn(l,E,g,!1,x,b)),F=mt.merge(D,R),null==F)throw ie.getNotFoundInstance();let te=F.getBoundingBox();if(!q||null==te||!(te.getMinY()<E.getMinY()||te.getMaxY()>E.getMaxY()))break;E=te}F.setBoundingBox(E);let B=F.getBarcodeColumnCount()+1;F.setDetectionResultColumn(0,D),F.setDetectionResultColumn(B,R);let Y=null!=D;for(let q=1;q<=B;q++){let re,te=Y?q:B-q;if(void 0!==F.getDetectionResultColumn(te))continue;re=0===te||te===B?new gt(E,0===te):new vt(E),F.setDetectionResultColumn(te,re);let ae=-1,Te=ae;for(let Le=E.getMinY();Le<=E.getMaxY();Le++){if(ae=mt.getStartColumn(F,te,Le,Y),ae<0||ae>E.getMaxX()){if(-1===Te)continue;ae=Te}let ve=mt.detectCodeword(l,E.getMinX(),E.getMaxX(),Y,ae,Le,x,b);null!=ve&&(re.setCodeword(Le,ve),Te=ae,x=Math.min(x,ve.getWidth()),b=Math.max(b,ve.getWidth()))}}return mt.createDecoderResult(F)}static merge(l,h){if(null==l&&null==h)return null;let f=mt.getBarcodeMetadata(l,h);if(null==f)return null;let g=xe.merge(mt.adjustBoundingBox(l),mt.adjustBoundingBox(h));return new Qe(f,g)}static adjustBoundingBox(l){if(null==l)return null;let h=l.getRowHeights();if(null==h)return null;let f=mt.getMax(h),g=0;for(let b of h)if(g+=f-b,b>0)break;let v=l.getCodewords();for(let b=0;g>0&&null==v[b];b++)g--;let x=0;for(let b=h.length-1;b>=0&&(x+=f-h[b],!(h[b]>0));b--);for(let b=v.length-1;x>0&&null==v[b];b--)x--;return l.getBoundingBox().addMissingRows(g,x,l.isLeft())}static getMax(l){let h=-1;for(let f of l)h=Math.max(h,f);return h}static getBarcodeMetadata(l,h){let f,g;return null==l||null==(f=l.getBarcodeMetadata())?null==h?null:h.getBarcodeMetadata():null==h||null==(g=h.getBarcodeMetadata())?f:f.getColumnCount()!==g.getColumnCount()&&f.getErrorCorrectionLevel()!==g.getErrorCorrectionLevel()&&f.getRowCount()!==g.getRowCount()?null:f}static getRowIndicatorColumn(l,h,f,g,v,x){let b=new gt(h,g);for(let E=0;E<2;E++){let D=0===E?1:-1,R=Math.trunc(Math.trunc(f.getX()));for(let F=Math.trunc(Math.trunc(f.getY()));F<=h.getMaxY()&&F>=h.getMinY();F+=D){let B=mt.detectCodeword(l,0,l.getWidth(),g,R,F,v,x);null!=B&&(b.setCodeword(F,B),R=g?B.getStartX():B.getEndX())}}return b}static adjustCodewordCount(l,h){let f=h[0][1],g=f.getValue(),v=l.getBarcodeColumnCount()*l.getBarcodeRowCount()-mt.getNumberOfECCodeWords(l.getBarcodeECLevel());if(0===g.length){if(v<1||v>I.MAX_CODEWORDS_IN_BARCODE)throw ie.getNotFoundInstance();f.setValue(v)}else g[0]!==v&&f.setValue(v)}static createDecoderResult(l){let h=mt.createBarcodeMatrix(l);mt.adjustCodewordCount(l,h);let f=new Array,g=new Int32Array(l.getBarcodeRowCount()*l.getBarcodeColumnCount()),v=[],x=new Array;for(let E=0;E<l.getBarcodeRowCount();E++)for(let D=0;D<l.getBarcodeColumnCount();D++){let R=h[E][D+1].getValue(),F=E*l.getBarcodeColumnCount()+D;0===R.length?f.push(F):1===R.length?g[F]=R[0]:(x.push(F),v.push(R))}let b=new Array(v.length);for(let E=0;E<b.length;E++)b[E]=v[E];return mt.createDecoderResultFromAmbiguousValues(l.getBarcodeECLevel(),g,I.toIntArray(f),I.toIntArray(x),b)}static createDecoderResultFromAmbiguousValues(l,h,f,g,v){let x=new Int32Array(g.length),b=100;for(;b-- >0;){for(let E=0;E<x.length;E++)h[g[E]]=v[E][x[E]];try{return mt.decodeCodewords(h,l,f)}catch(E){if(!(E instanceof At))throw E}if(0===x.length)throw At.getChecksumInstance();for(let E=0;E<x.length;E++){if(x[E]<v[E].length-1){x[E]++;break}if(x[E]=0,E===x.length-1)throw At.getChecksumInstance()}}throw At.getChecksumInstance()}static createBarcodeMatrix(l){let h=Array.from({length:l.getBarcodeRowCount()},()=>new Array(l.getBarcodeColumnCount()+2));for(let g=0;g<h.length;g++)for(let v=0;v<h[g].length;v++)h[g][v]=new Tt;let f=0;for(let g of l.getDetectionResultColumns()){if(null!=g)for(let v of g.getCodewords())if(null!=v){let x=v.getRowNumber();if(x>=0){if(x>=h.length)continue;h[x][f].setValue(v.getValue())}}f++}return h}static isValidBarcodeColumn(l,h){return h>=0&&h<=l.getBarcodeColumnCount()+1}static getStartColumn(l,h,f,g){let v=g?1:-1,x=null;if(mt.isValidBarcodeColumn(l,h-v)&&(x=l.getDetectionResultColumn(h-v).getCodeword(f)),null!=x)return g?x.getEndX():x.getStartX();if(x=l.getDetectionResultColumn(h).getCodewordNearby(f),null!=x)return g?x.getStartX():x.getEndX();if(mt.isValidBarcodeColumn(l,h-v)&&(x=l.getDetectionResultColumn(h-v).getCodewordNearby(f)),null!=x)return g?x.getEndX():x.getStartX();let b=0;for(;mt.isValidBarcodeColumn(l,h-v);){h-=v;for(let E of l.getDetectionResultColumn(h).getCodewords())if(null!=E)return(g?E.getEndX():E.getStartX())+v*b*(E.getEndX()-E.getStartX());b++}return g?l.getBoundingBox().getMinX():l.getBoundingBox().getMaxX()}static detectCodeword(l,h,f,g,v,x,b,E){v=mt.adjustCodewordStartColumn(l,h,f,g,v,x);let D=mt.getModuleBitCount(l,h,f,g,v,x);if(null==D)return null;let R,F=Qt.sum(D);if(g)R=v+F;else{for(let q=0;q<D.length/2;q++){let te=D[q];D[q]=D[D.length-1-q],D[D.length-1-q]=te}R=v,v=R-F}if(!mt.checkCodewordSkew(F,b,E))return null;let B=Je.getDecodedValue(D),Y=I.getCodeword(B);return-1===Y?null:new Mt(v,R,mt.getCodewordBucketNumber(B),Y)}static getModuleBitCount(l,h,f,g,v,x){let b=v,E=new Int32Array(8),D=0,R=g?1:-1,F=g;for(;(g?b<f:b>=h)&&D<E.length;)l.get(b,x)===F?(E[D]++,b+=R):(D++,F=!F);return D===E.length||b===(g?f:h)&&D===E.length-1?E:null}static getNumberOfECCodeWords(l){return 2<<l}static adjustCodewordStartColumn(l,h,f,g,v,x){let b=v,E=g?-1:1;for(let D=0;D<2;D++){for(;(g?b>=h:b<f)&&g===l.get(b,x);){if(Math.abs(v-b)>mt.CODEWORD_SKEW_SIZE)return v;b+=E}E=-E,g=!g}return b}static checkCodewordSkew(l,h,f){return h-mt.CODEWORD_SKEW_SIZE<=l&&l<=f+mt.CODEWORD_SKEW_SIZE}static decodeCodewords(l,h,f){if(0===l.length)throw Re.getFormatInstance();let g=1<<h+1,v=mt.correctErrors(l,f,g);mt.verifyCodewordCount(l,g);let x=ue.decode(l,""+h);return x.setErrorsCorrected(v),x.setErasures(f.length),x}static correctErrors(l,h,f){if(null!=h&&h.length>f/2+mt.MAX_ERRORS||f<0||f>mt.MAX_EC_CODEWORDS)throw At.getChecksumInstance();return mt.errorCorrection.decode(l,f,h)}static verifyCodewordCount(l,h){if(l.length<4)throw Re.getFormatInstance();let f=l[0];if(f>l.length)throw Re.getFormatInstance();if(0===f){if(!(h<l.length))throw Re.getFormatInstance();l[0]=l.length-h}}static getBitCountForCodeword(l){let h=new Int32Array(8),f=0,g=h.length-1;for(;!((1&l)!==f&&(f=1&l,g--,g<0));)h[g]++,l>>=1;return h}static getCodewordBucketNumber(l){return l instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(l):this.getCodewordBucketNumber_number(l)}static getCodewordBucketNumber_number(l){return mt.getCodewordBucketNumber(mt.getBitCountForCodeword(l))}static getCodewordBucketNumber_Int32Array(l){return(l[0]-l[2]+l[4]-l[6]+9)%9}static toString(l){let h=new ke;for(let f=0;f<l.length;f++){h.format("Row %2d: ",f);for(let g=0;g<l[f].length;g++){let v=l[f][g];0===v.getValue().length?h.format("        ",null):h.format("%4d(%2d)",v.getValue()[0],v.getConfidence(v.getValue()[0]))}h.format("%n")}return h.toString()}}mt.CODEWORD_SKEW_SIZE=2,mt.MAX_ERRORS=3,mt.MAX_EC_CODEWORDS=512,mt.errorCorrection=new ne;class mr{decode(l,h=null){let f=mr.decode(l,h,!1);if(null==f||0===f.length||null==f[0])throw ie.getNotFoundInstance();return f[0]}decodeMultiple(l,h=null){try{return mr.decode(l,h,!0)}catch(f){throw f instanceof Re||f instanceof At?ie.getNotFoundInstance():f}}static decode(l,h,f){const g=new Array,v=P.detectMultiple(l,h,f);for(const x of v.getPoints()){const b=mt.decode(v.getBits(),x[4],x[5],x[6],x[7],mr.getMinCodewordWidth(x),mr.getMaxCodewordWidth(x)),E=new Vr(b.getText(),b.getRawBytes(),void 0,x,pt.PDF_417);E.putMetadata(wr.ERROR_CORRECTION_LEVEL,b.getECLevel());const D=b.getOther();null!=D&&E.putMetadata(wr.PDF417_EXTRA_METADATA,D),g.push(E)}return g.map(x=>x)}static getMaxWidth(l,h){return null==l||null==h?0:Math.trunc(Math.abs(l.getX()-h.getX()))}static getMinWidth(l,h){return null==l||null==h?Dt.MAX_VALUE:Math.trunc(Math.abs(l.getX()-h.getX()))}static getMaxCodewordWidth(l){return Math.floor(Math.max(Math.max(mr.getMaxWidth(l[0],l[4]),mr.getMaxWidth(l[6],l[2])*I.MODULES_IN_CODEWORD/I.MODULES_IN_STOP_PATTERN),Math.max(mr.getMaxWidth(l[1],l[5]),mr.getMaxWidth(l[7],l[3])*I.MODULES_IN_CODEWORD/I.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(l){return Math.floor(Math.min(Math.min(mr.getMinWidth(l[0],l[4]),mr.getMinWidth(l[6],l[2])*I.MODULES_IN_CODEWORD/I.MODULES_IN_STOP_PATTERN),Math.min(mr.getMinWidth(l[1],l[5]),mr.getMinWidth(l[7],l[3])*I.MODULES_IN_CODEWORD/I.MODULES_IN_STOP_PATTERN)))}reset(){}}let vr=(()=>{class S extends br{}return S.kind="ReaderException",S})();class Ju{constructor(l,h){this.verbose=!0===l,h&&this.setHints(h)}decode(l,h){return h&&this.setHints(h),this.decodeInternal(l)}decodeWithState(l){return null==this.readers&&this.setHints(null),this.decodeInternal(l)}setHints(l){this.hints=l;const h=null!=l&&void 0!==l.get(yn.TRY_HARDER),f=null==l?null:l.get(yn.POSSIBLE_FORMATS),g=new Array;if(null!=f){const v=f.some(x=>x===pt.UPC_A||x===pt.UPC_E||x===pt.EAN_13||x===pt.EAN_8||x===pt.CODABAR||x===pt.CODE_39||x===pt.CODE_93||x===pt.CODE_128||x===pt.ITF||x===pt.RSS_14||x===pt.RSS_EXPANDED);v&&!h&&g.push(new ou(l,this.verbose)),f.includes(pt.QR_CODE)&&g.push(new Ji),f.includes(pt.DATA_MATRIX)&&g.push(new _a),f.includes(pt.AZTEC)&&g.push(new Ms),f.includes(pt.PDF_417)&&g.push(new mr),v&&h&&g.push(new ou(l,this.verbose))}0===g.length&&(h||g.push(new ou(l,this.verbose)),g.push(new Ji),g.push(new _a),g.push(new Ms),g.push(new mr),h&&g.push(new ou(l,this.verbose))),this.readers=g}reset(){if(null!==this.readers)for(const l of this.readers)l.reset()}decodeInternal(l){if(null===this.readers)throw new vr("No readers where selected, nothing can be read.");for(const h of this.readers)try{return h.decode(l,this.hints)}catch(f){if(f instanceof vr)continue}throw new ie("No MultiFormat Readers were able to detect the code.")}}var Fs=(()=>{return(S=Fs||(Fs={}))[S.ERROR_CORRECTION=0]="ERROR_CORRECTION",S[S.CHARACTER_SET=1]="CHARACTER_SET",S[S.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",S[S.MIN_SIZE=3]="MIN_SIZE",S[S.MAX_SIZE=4]="MAX_SIZE",S[S.MARGIN=5]="MARGIN",S[S.PDF417_COMPACT=6]="PDF417_COMPACT",S[S.PDF417_COMPACTION=7]="PDF417_COMPACTION",S[S.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",S[S.AZTEC_LAYERS=9]="AZTEC_LAYERS",S[S.QR_VERSION=10]="QR_VERSION",Fs;var S})(),Sr=Fs;class Ea{constructor(l){this.field=l,this.cachedGenerators=[],this.cachedGenerators.push(new fi(l,Int32Array.from([1])))}buildGenerator(l){const h=this.cachedGenerators;if(l>=h.length){let f=h[h.length-1];const g=this.field;for(let v=h.length;v<=l;v++){const x=f.multiply(new fi(g,Int32Array.from([1,g.exp(v-1+g.getGeneratorBase())])));h.push(x),f=x}}return h[l]}encode(l,h){if(0===h)throw new Ke("No error correction bytes");const f=l.length-h;if(f<=0)throw new Ke("No data bytes provided");const g=this.buildGenerator(h),v=new Int32Array(f);$t.arraycopy(l,0,v,0,f);let x=new fi(this.field,v);x=x.multiplyByMonomial(h,1);const E=x.divide(g)[1].getCoefficients(),D=h-E.length;for(let R=0;R<D;R++)l[f+R]=0;$t.arraycopy(E,0,l,f+D,E.length)}}let Kr=(()=>{class S{constructor(){}static applyMaskPenaltyRule1(h){return S.applyMaskPenaltyRule1Internal(h,!0)+S.applyMaskPenaltyRule1Internal(h,!1)}static applyMaskPenaltyRule2(h){let f=0;const g=h.getArray(),v=h.getWidth(),x=h.getHeight();for(let b=0;b<x-1;b++){const E=g[b];for(let D=0;D<v-1;D++){const R=E[D];R===E[D+1]&&R===g[b+1][D]&&R===g[b+1][D+1]&&f++}}return S.N2*f}static applyMaskPenaltyRule3(h){let f=0;const g=h.getArray(),v=h.getWidth(),x=h.getHeight();for(let b=0;b<x;b++)for(let E=0;E<v;E++){const D=g[b];E+6<v&&1===D[E]&&0===D[E+1]&&1===D[E+2]&&1===D[E+3]&&1===D[E+4]&&0===D[E+5]&&1===D[E+6]&&(S.isWhiteHorizontal(D,E-4,E)||S.isWhiteHorizontal(D,E+7,E+11))&&f++,b+6<x&&1===g[b][E]&&0===g[b+1][E]&&1===g[b+2][E]&&1===g[b+3][E]&&1===g[b+4][E]&&0===g[b+5][E]&&1===g[b+6][E]&&(S.isWhiteVertical(g,E,b-4,b)||S.isWhiteVertical(g,E,b+7,b+11))&&f++}return f*S.N3}static isWhiteHorizontal(h,f,g){f=Math.max(f,0),g=Math.min(g,h.length);for(let v=f;v<g;v++)if(1===h[v])return!1;return!0}static isWhiteVertical(h,f,g,v){g=Math.max(g,0),v=Math.min(v,h.length);for(let x=g;x<v;x++)if(1===h[x][f])return!1;return!0}static applyMaskPenaltyRule4(h){let f=0;const g=h.getArray(),v=h.getWidth(),x=h.getHeight();for(let D=0;D<x;D++){const R=g[D];for(let F=0;F<v;F++)1===R[F]&&f++}const b=h.getHeight()*h.getWidth();return Math.floor(10*Math.abs(2*f-b)/b)*S.N4}static getDataMaskBit(h,f,g){let v,x;switch(h){case 0:v=g+f&1;break;case 1:v=1&g;break;case 2:v=f%3;break;case 3:v=(g+f)%3;break;case 4:v=Math.floor(g/2)+Math.floor(f/3)&1;break;case 5:x=g*f,v=(1&x)+x%3;break;case 6:x=g*f,v=(1&x)+x%3&1;break;case 7:x=g*f,v=x%3+(g+f&1)&1;break;default:throw new Ke("Invalid mask pattern: "+h)}return 0===v}static applyMaskPenaltyRule1Internal(h,f){let g=0;const v=f?h.getHeight():h.getWidth(),x=f?h.getWidth():h.getHeight(),b=h.getArray();for(let E=0;E<v;E++){let D=0,R=-1;for(let F=0;F<x;F++){const B=f?b[E][F]:b[F][E];B===R?D++:(D>=5&&(g+=S.N1+(D-5)),D=1,R=B)}D>=5&&(g+=S.N1+(D-5))}return g}}return S.N1=3,S.N2=3,S.N3=40,S.N4=10,S})();class Ia{constructor(l,h){this.width=l,this.height=h;const f=new Array(h);for(let g=0;g!==h;g++)f[g]=new Uint8Array(l);this.bytes=f}getHeight(){return this.height}getWidth(){return this.width}get(l,h){return this.bytes[h][l]}getArray(){return this.bytes}setNumber(l,h,f){this.bytes[h][l]=f}setBoolean(l,h,f){this.bytes[h][l]=f?1:0}clear(l){for(const h of this.bytes)Cn.fill(h,l)}equals(l){if(!(l instanceof Ia))return!1;const h=l;if(this.width!==h.width||this.height!==h.height)return!1;for(let f=0,g=this.height;f<g;++f){const v=this.bytes[f],x=h.bytes[f];for(let b=0,E=this.width;b<E;++b)if(v[b]!==x[b])return!1}return!0}toString(){const l=new Oe;for(let h=0,f=this.height;h<f;++h){const g=this.bytes[h];for(let v=0,x=this.width;v<x;++v)switch(g[v]){case 0:l.append(" 0");break;case 1:l.append(" 1");break;default:l.append("  ")}l.append("\n")}return l.toString()}}let Ls=(()=>{class S{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const h=new Oe;return h.append("<<\n"),h.append(" mode: "),h.append(this.mode?this.mode.toString():"null"),h.append("\n ecLevel: "),h.append(this.ecLevel?this.ecLevel.toString():"null"),h.append("\n version: "),h.append(this.version?this.version.toString():"null"),h.append("\n maskPattern: "),h.append(this.maskPattern.toString()),this.matrix?(h.append("\n matrix:\n"),h.append(this.matrix.toString())):h.append("\n matrix: null\n"),h.append(">>\n"),h.toString()}setMode(h){this.mode=h}setECLevel(h){this.ecLevel=h}setVersion(h){this.version=h}setMaskPattern(h){this.maskPattern=h}setMatrix(h){this.matrix=h}static isValidMaskPattern(h){return h>=0&&h<S.NUM_MASK_PATTERNS}}return S.NUM_MASK_PATTERNS=8,S})(),rn=(()=>{class S extends br{}return S.kind="WriterException",S})();class Be{constructor(){}static clearMatrix(l){l.clear(255)}static buildMatrix(l,h,f,g,v){Be.clearMatrix(v),Be.embedBasicPatterns(f,v),Be.embedTypeInfo(h,g,v),Be.maybeEmbedVersionInfo(f,v),Be.embedDataBits(l,g,v)}static embedBasicPatterns(l,h){Be.embedPositionDetectionPatternsAndSeparators(h),Be.embedDarkDotAtLeftBottomCorner(h),Be.maybeEmbedPositionAdjustmentPatterns(l,h),Be.embedTimingPatterns(h)}static embedTypeInfo(l,h,f){const g=new xt;Be.makeTypeInfoBits(l,h,g);for(let v=0,x=g.getSize();v<x;++v){const b=g.get(g.getSize()-1-v),E=Be.TYPE_INFO_COORDINATES[v];if(f.setBoolean(E[0],E[1],b),v<8){const F=f.getWidth()-v-1;f.setBoolean(F,8,b)}else{const F=8,B=f.getHeight()-7+(v-8);f.setBoolean(F,B,b)}}}static maybeEmbedVersionInfo(l,h){if(l.getVersionNumber()<7)return;const f=new xt;Be.makeVersionInfoBits(l,f);let g=17;for(let v=0;v<6;++v)for(let x=0;x<3;++x){const b=f.get(g);g--,h.setBoolean(v,h.getHeight()-11+x,b),h.setBoolean(h.getHeight()-11+x,v,b)}}static embedDataBits(l,h,f){let g=0,v=-1,x=f.getWidth()-1,b=f.getHeight()-1;for(;x>0;){for(6===x&&(x-=1);b>=0&&b<f.getHeight();){for(let E=0;E<2;++E){const D=x-E;if(!Be.isEmpty(f.get(D,b)))continue;let R;g<l.getSize()?(R=l.get(g),++g):R=!1,255!==h&&Kr.getDataMaskBit(h,D,b)&&(R=!R),f.setBoolean(D,b,R)}b+=v}v=-v,b+=v,x-=2}if(g!==l.getSize())throw new rn("Not all bits consumed: "+g+"/"+l.getSize())}static findMSBSet(l){return 32-Dt.numberOfLeadingZeros(l)}static calculateBCHCode(l,h){if(0===h)throw new Ke("0 polynomial");const f=Be.findMSBSet(h);for(l<<=f-1;Be.findMSBSet(l)>=f;)l^=h<<Be.findMSBSet(l)-f;return l}static makeTypeInfoBits(l,h,f){if(!Ls.isValidMaskPattern(h))throw new rn("Invalid mask pattern");const g=l.getBits()<<3|h;f.appendBits(g,5);const v=Be.calculateBCHCode(g,Be.TYPE_INFO_POLY);f.appendBits(v,10);const x=new xt;if(x.appendBits(Be.TYPE_INFO_MASK_PATTERN,15),f.xor(x),15!==f.getSize())throw new rn("should not happen but we got: "+f.getSize())}static makeVersionInfoBits(l,h){h.appendBits(l.getVersionNumber(),6);const f=Be.calculateBCHCode(l.getVersionNumber(),Be.VERSION_INFO_POLY);if(h.appendBits(f,12),18!==h.getSize())throw new rn("should not happen but we got: "+h.getSize())}static isEmpty(l){return 255===l}static embedTimingPatterns(l){for(let h=8;h<l.getWidth()-8;++h){const f=(h+1)%2;Be.isEmpty(l.get(h,6))&&l.setNumber(h,6,f),Be.isEmpty(l.get(6,h))&&l.setNumber(6,h,f)}}static embedDarkDotAtLeftBottomCorner(l){if(0===l.get(8,l.getHeight()-8))throw new rn;l.setNumber(8,l.getHeight()-8,1)}static embedHorizontalSeparationPattern(l,h,f){for(let g=0;g<8;++g){if(!Be.isEmpty(f.get(l+g,h)))throw new rn;f.setNumber(l+g,h,0)}}static embedVerticalSeparationPattern(l,h,f){for(let g=0;g<7;++g){if(!Be.isEmpty(f.get(l,h+g)))throw new rn;f.setNumber(l,h+g,0)}}static embedPositionAdjustmentPattern(l,h,f){for(let g=0;g<5;++g){const v=Be.POSITION_ADJUSTMENT_PATTERN[g];for(let x=0;x<5;++x)f.setNumber(l+x,h+g,v[x])}}static embedPositionDetectionPattern(l,h,f){for(let g=0;g<7;++g){const v=Be.POSITION_DETECTION_PATTERN[g];for(let x=0;x<7;++x)f.setNumber(l+x,h+g,v[x])}}static embedPositionDetectionPatternsAndSeparators(l){const h=Be.POSITION_DETECTION_PATTERN[0].length;Be.embedPositionDetectionPattern(0,0,l),Be.embedPositionDetectionPattern(l.getWidth()-h,0,l),Be.embedPositionDetectionPattern(0,l.getWidth()-h,l);Be.embedHorizontalSeparationPattern(0,7,l),Be.embedHorizontalSeparationPattern(l.getWidth()-8,7,l),Be.embedHorizontalSeparationPattern(0,l.getWidth()-8,l);Be.embedVerticalSeparationPattern(7,0,l),Be.embedVerticalSeparationPattern(l.getHeight()-7-1,0,l),Be.embedVerticalSeparationPattern(7,l.getHeight()-7,l)}static maybeEmbedPositionAdjustmentPatterns(l,h){if(l.getVersionNumber()<2)return;const f=l.getVersionNumber()-1,g=Be.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[f];for(let v=0,x=g.length;v!==x;v++){const b=g[v];if(b>=0)for(let E=0;E!==x;E++){const D=g[E];D>=0&&Be.isEmpty(h.get(D,b))&&Be.embedPositionAdjustmentPattern(D-2,b-2,h)}}}}Be.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),Be.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),Be.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),Be.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),Be.VERSION_INFO_POLY=7973,Be.TYPE_INFO_POLY=1335,Be.TYPE_INFO_MASK_PATTERN=21522;class tv{constructor(l,h){this.dataBytes=l,this.errorCorrectionBytes=h}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class rr{constructor(){}static calculateMaskPenalty(l){return Kr.applyMaskPenaltyRule1(l)+Kr.applyMaskPenaltyRule2(l)+Kr.applyMaskPenaltyRule3(l)+Kr.applyMaskPenaltyRule4(l)}static encode(l,h,f=null){let g=rr.DEFAULT_BYTE_MODE_ENCODING;const v=null!==f&&void 0!==f.get(Sr.CHARACTER_SET);v&&(g=f.get(Sr.CHARACTER_SET).toString());const x=this.chooseMode(l,g),b=new xt;if(x===We.BYTE&&(v||rr.DEFAULT_BYTE_MODE_ENCODING!==g)){const Le=ee.getCharacterSetECIByName(g);void 0!==Le&&this.appendECI(Le,b)}this.appendModeInfo(x,b);const E=new xt;let D;if(this.appendBytes(l,x,E,g),null!==f&&void 0!==f.get(Sr.QR_VERSION)){const Le=Number.parseInt(f.get(Sr.QR_VERSION).toString(),10);D=at.getVersionForNumber(Le);const ve=this.calculateBitsNeeded(x,b,E,D);if(!this.willFit(ve,D,h))throw new rn("Data too big for requested version")}else D=this.recommendVersion(h,x,b,E);const R=new xt;R.appendBitArray(b);const F=x===We.BYTE?E.getSizeInBytes():l.length;this.appendLengthInfo(F,D,x,R),R.appendBitArray(E);const B=D.getECBlocksForLevel(h),Y=D.getTotalCodewords()-B.getTotalECCodewords();this.terminateBits(Y,R);const q=this.interleaveWithECBytes(R,D.getTotalCodewords(),Y,B.getNumBlocks()),te=new Ls;te.setECLevel(h),te.setMode(x),te.setVersion(D);const re=D.getDimensionForVersion(),ae=new Ia(re,re),Te=this.chooseMaskPattern(q,h,D,ae);return te.setMaskPattern(Te),Be.buildMatrix(q,h,D,Te,ae),te.setMatrix(ae),te}static recommendVersion(l,h,f,g){const v=this.calculateBitsNeeded(h,f,g,at.getVersionForNumber(1)),x=this.chooseVersion(v,l),b=this.calculateBitsNeeded(h,f,g,x);return this.chooseVersion(b,l)}static calculateBitsNeeded(l,h,f,g){return h.getSize()+l.getCharacterCountBits(g)+f.getSize()}static getAlphanumericCode(l){return l<rr.ALPHANUMERIC_TABLE.length?rr.ALPHANUMERIC_TABLE[l]:-1}static chooseMode(l,h=null){if(ee.SJIS.getName()===h&&this.isOnlyDoubleByteKanji(l))return We.KANJI;let f=!1,g=!1;for(let v=0,x=l.length;v<x;++v){const b=l.charAt(v);if(rr.isDigit(b))f=!0;else{if(-1===this.getAlphanumericCode(b.charCodeAt(0)))return We.BYTE;g=!0}}return g?We.ALPHANUMERIC:f?We.NUMERIC:We.BYTE}static isOnlyDoubleByteKanji(l){let h;try{h=Ae.encode(l,ee.SJIS)}catch(g){return!1}const f=h.length;if(f%2!=0)return!1;for(let g=0;g<f;g+=2){const v=255&h[g];if((v<129||v>159)&&(v<224||v>235))return!1}return!0}static chooseMaskPattern(l,h,f,g){let v=Number.MAX_SAFE_INTEGER,x=-1;for(let b=0;b<Ls.NUM_MASK_PATTERNS;b++){Be.buildMatrix(l,h,f,b,g);let E=this.calculateMaskPenalty(g);E<v&&(v=E,x=b)}return x}static chooseVersion(l,h){for(let f=1;f<=40;f++){const g=at.getVersionForNumber(f);if(rr.willFit(l,g,h))return g}throw new rn("Data too big")}static willFit(l,h,f){return h.getTotalCodewords()-h.getECBlocksForLevel(f).getTotalECCodewords()>=(l+7)/8}static terminateBits(l,h){const f=8*l;if(h.getSize()>f)throw new rn("data bits cannot fit in the QR Code"+h.getSize()+" > "+f);for(let x=0;x<4&&h.getSize()<f;++x)h.appendBit(!1);const g=7&h.getSize();if(g>0)for(let x=g;x<8;x++)h.appendBit(!1);const v=l-h.getSizeInBytes();for(let x=0;x<v;++x)h.appendBits(0==(1&x)?236:17,8);if(h.getSize()!==f)throw new rn("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(l,h,f,g,v,x){if(g>=f)throw new rn("Block ID too large");const b=l%f,E=f-b,D=Math.floor(l/f),R=D+1,F=Math.floor(h/f),B=F+1,Y=D-F,q=R-B;if(Y!==q)throw new rn("EC bytes mismatch");if(f!==E+b)throw new rn("RS blocks mismatch");if(l!==(F+Y)*E+(B+q)*b)throw new rn("Total bytes mismatch");g<E?(v[0]=F,x[0]=Y):(v[0]=B,x[0]=q)}static interleaveWithECBytes(l,h,f,g){if(l.getSizeInBytes()!==f)throw new rn("Number of bits and data bytes does not match");let v=0,x=0,b=0;const E=new Array;for(let R=0;R<g;++R){const F=new Int32Array(1),B=new Int32Array(1);rr.getNumDataBytesAndNumECBytesForBlockID(h,f,g,R,F,B);const Y=F[0],q=new Uint8Array(Y);l.toBytes(8*v,q,0,Y);const te=rr.generateECBytes(q,B[0]);E.push(new tv(q,te)),x=Math.max(x,Y),b=Math.max(b,te.length),v+=F[0]}if(f!==v)throw new rn("Data bytes does not match offset");const D=new xt;for(let R=0;R<x;++R)for(const F of E){const B=F.getDataBytes();R<B.length&&D.appendBits(B[R],8)}for(let R=0;R<b;++R)for(const F of E){const B=F.getErrorCorrectionBytes();R<B.length&&D.appendBits(B[R],8)}if(h!==D.getSizeInBytes())throw new rn("Interleaving error: "+h+" and "+D.getSizeInBytes()+" differ.");return D}static generateECBytes(l,h){const f=l.length,g=new Int32Array(f+h);for(let x=0;x<f;x++)g[x]=255&l[x];new Ea(Kt.QR_CODE_FIELD_256).encode(g,h);const v=new Uint8Array(h);for(let x=0;x<h;x++)v[x]=g[f+x];return v}static appendModeInfo(l,h){h.appendBits(l.getBits(),4)}static appendLengthInfo(l,h,f,g){const v=f.getCharacterCountBits(h);if(l>=1<<v)throw new rn(l+" is bigger than "+((1<<v)-1));g.appendBits(l,v)}static appendBytes(l,h,f,g){switch(h){case We.NUMERIC:rr.appendNumericBytes(l,f);break;case We.ALPHANUMERIC:rr.appendAlphanumericBytes(l,f);break;case We.BYTE:rr.append8BitBytes(l,f,g);break;case We.KANJI:rr.appendKanjiBytes(l,f);break;default:throw new rn("Invalid mode: "+h)}}static getDigit(l){return l.charCodeAt(0)-48}static isDigit(l){const h=rr.getDigit(l);return h>=0&&h<=9}static appendNumericBytes(l,h){const f=l.length;let g=0;for(;g<f;){const v=rr.getDigit(l.charAt(g));if(g+2<f){const x=rr.getDigit(l.charAt(g+1)),b=rr.getDigit(l.charAt(g+2));h.appendBits(100*v+10*x+b,10),g+=3}else if(g+1<f){const x=rr.getDigit(l.charAt(g+1));h.appendBits(10*v+x,7),g+=2}else h.appendBits(v,4),g++}}static appendAlphanumericBytes(l,h){const f=l.length;let g=0;for(;g<f;){const v=rr.getAlphanumericCode(l.charCodeAt(g));if(-1===v)throw new rn;if(g+1<f){const x=rr.getAlphanumericCode(l.charCodeAt(g+1));if(-1===x)throw new rn;h.appendBits(45*v+x,11),g+=2}else h.appendBits(v,6),g++}}static append8BitBytes(l,h,f){let g;try{g=Ae.encode(l,f)}catch(v){throw new rn(v)}for(let v=0,x=g.length;v!==x;v++)h.appendBits(g[v],8)}static appendKanjiBytes(l,h){let f;try{f=Ae.encode(l,ee.SJIS)}catch(v){throw new rn(v)}const g=f.length;for(let v=0;v<g;v+=2){const E=(255&f[v])<<8&4294967295|255&f[v+1];let D=-1;if(E>=33088&&E<=40956?D=E-33088:E>=57408&&E<=60351&&(D=E-49472),-1===D)throw new rn("Invalid byte sequence");h.appendBits(192*(D>>8)+(255&D),13)}}static appendECI(l,h){h.appendBits(We.ECI.getBits(),4),h.appendBits(l.getValue(),8)}}rr.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),rr.DEFAULT_BYTE_MODE_ENCODING=ee.UTF8.getName();let Yl=(()=>{class S{write(h,f,g,v=null){if(0===h.length)throw new Ke("Found empty contents");if(f<0||g<0)throw new Ke("Requested dimensions are too small: "+f+"x"+g);let x=Pe.L,b=S.QUIET_ZONE_SIZE;null!==v&&(void 0!==v.get(Sr.ERROR_CORRECTION)&&(x=Pe.fromString(v.get(Sr.ERROR_CORRECTION).toString())),void 0!==v.get(Sr.MARGIN)&&(b=Number.parseInt(v.get(Sr.MARGIN).toString(),10)));const E=rr.encode(h,x,v);return this.renderResult(E,f,g,b)}writeToDom(h,f,g,v,x=null){"string"==typeof h&&(h=document.querySelector(h));const b=this.write(f,g,v,x);h&&h.appendChild(b)}renderResult(h,f,g,v){const x=h.getMatrix();if(null===x)throw new Vo;const b=x.getWidth(),E=x.getHeight(),D=b+2*v,R=E+2*v,F=Math.max(f,D),B=Math.max(g,R),Y=Math.min(Math.floor(F/D),Math.floor(B/R)),q=Math.floor((F-b*Y)/2),te=Math.floor((B-E*Y)/2),re=this.createSVGElement(F,B);for(let ae=0,Te=te;ae<E;ae++,Te+=Y)for(let Le=0,ve=q;Le<b;Le++,ve+=Y)if(1===x.get(Le,ae)){const Jt=this.createSvgRectElement(ve,Te,Y,Y);re.appendChild(Jt)}return re}createSVGElement(h,f){const g=document.createElementNS(S.SVG_NS,"svg");return g.setAttributeNS(null,"height",h.toString()),g.setAttributeNS(null,"width",f.toString()),g}createSvgRectElement(h,f,g,v){const x=document.createElementNS(S.SVG_NS,"rect");return x.setAttributeNS(null,"x",h.toString()),x.setAttributeNS(null,"y",f.toString()),x.setAttributeNS(null,"height",g.toString()),x.setAttributeNS(null,"width",v.toString()),x.setAttributeNS(null,"fill","#000000"),x}}return S.QUIET_ZONE_SIZE=4,S.SVG_NS="http://www.w3.org/2000/svg",S})(),Xl=(()=>{class S{encode(h,f,g,v,x){if(0===h.length)throw new Ke("Found empty contents");if(f!==pt.QR_CODE)throw new Ke("Can only encode QR_CODE, but got "+f);if(g<0||v<0)throw new Ke(`Requested dimensions are too small: ${g}x${v}`);let b=Pe.L,E=S.QUIET_ZONE_SIZE;null!==x&&(void 0!==x.get(Sr.ERROR_CORRECTION)&&(b=Pe.fromString(x.get(Sr.ERROR_CORRECTION).toString())),void 0!==x.get(Sr.MARGIN)&&(E=Number.parseInt(x.get(Sr.MARGIN).toString(),10)));const D=rr.encode(h,b,x);return S.renderResult(D,g,v,E)}static renderResult(h,f,g,v){const x=h.getMatrix();if(null===x)throw new Vo;const b=x.getWidth(),E=x.getHeight(),D=b+2*v,R=E+2*v,F=Math.max(f,D),B=Math.max(g,R),Y=Math.min(Math.floor(F/D),Math.floor(B/R)),q=Math.floor((F-b*Y)/2),te=Math.floor((B-E*Y)/2),re=new bt(F,B);for(let ae=0,Te=te;ae<E;ae++,Te+=Y)for(let Le=0,ve=q;Le<b;Le++,ve+=Y)1===x.get(Le,ae)&&re.setRegion(ve,Te,Y,Y);return re}}return S.QUIET_ZONE_SIZE=4,S})();let ql=(()=>{class S extends kt{constructor(h,f,g,v,x,b,E,D){if(super(b,E),this.yuvData=h,this.dataWidth=f,this.dataHeight=g,this.left=v,this.top=x,v+b>f||x+E>g)throw new Ke("Crop rectangle does not fit within image data.");D&&this.reverseHorizontal(b,E)}getRow(h,f){if(h<0||h>=this.getHeight())throw new Ke("Requested row is outside the image: "+h);const g=this.getWidth();return(null==f||f.length<g)&&(f=new Uint8ClampedArray(g)),$t.arraycopy(this.yuvData,(h+this.top)*this.dataWidth+this.left,f,0,g),f}getMatrix(){const h=this.getWidth(),f=this.getHeight();if(h===this.dataWidth&&f===this.dataHeight)return this.yuvData;const g=h*f,v=new Uint8ClampedArray(g);let x=this.top*this.dataWidth+this.left;if(h===this.dataWidth)return $t.arraycopy(this.yuvData,x,v,0,g),v;for(let b=0;b<f;b++)$t.arraycopy(this.yuvData,x,v,b*h,h),x+=this.dataWidth;return v}isCropSupported(){return!0}crop(h,f,g,v){return new S(this.yuvData,this.dataWidth,this.dataHeight,this.left+h,this.top+f,g,v,!1)}renderThumbnail(){const h=this.getWidth()/S.THUMBNAIL_SCALE_FACTOR,f=this.getHeight()/S.THUMBNAIL_SCALE_FACTOR,g=new Int32Array(h*f),v=this.yuvData;let x=this.top*this.dataWidth+this.left;for(let b=0;b<f;b++){const E=b*h;for(let D=0;D<h;D++)g[E+D]=4278190080|65793*(255&v[x+D*S.THUMBNAIL_SCALE_FACTOR]);x+=this.dataWidth*S.THUMBNAIL_SCALE_FACTOR}return g}getThumbnailWidth(){return this.getWidth()/S.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/S.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(h,f){const g=this.yuvData;for(let v=0,x=this.top*this.dataWidth+this.left;v<f;v++,x+=this.dataWidth){const b=x+h/2;for(let E=x,D=x+h-1;E<b;E++,D--){const R=g[E];g[E]=g[D],g[D]=R}}}invert(){return new Br(this)}}return S.THUMBNAIL_SCALE_FACTOR=2,S})();class Bs extends kt{constructor(l,h,f,g,v,x,b){if(super(h,f),this.dataWidth=g,this.dataHeight=v,this.left=x,this.top=b,4===l.BYTES_PER_ELEMENT){const E=h*f,D=new Uint8ClampedArray(E);for(let R=0;R<E;R++){const F=l[R];D[R]=((F>>16&255)+(F>>7&510)+(255&F))/4&255}this.luminances=D}else this.luminances=l;if(void 0===g&&(this.dataWidth=h),void 0===v&&(this.dataHeight=f),void 0===x&&(this.left=0),void 0===b&&(this.top=0),this.left+h>this.dataWidth||this.top+f>this.dataHeight)throw new Ke("Crop rectangle does not fit within image data.")}getRow(l,h){if(l<0||l>=this.getHeight())throw new Ke("Requested row is outside the image: "+l);const f=this.getWidth();return(null==h||h.length<f)&&(h=new Uint8ClampedArray(f)),$t.arraycopy(this.luminances,(l+this.top)*this.dataWidth+this.left,h,0,f),h}getMatrix(){const l=this.getWidth(),h=this.getHeight();if(l===this.dataWidth&&h===this.dataHeight)return this.luminances;const f=l*h,g=new Uint8ClampedArray(f);let v=this.top*this.dataWidth+this.left;if(l===this.dataWidth)return $t.arraycopy(this.luminances,v,g,0,f),g;for(let x=0;x<h;x++)$t.arraycopy(this.luminances,v,g,x*l,l),v+=this.dataWidth;return g}isCropSupported(){return!0}crop(l,h,f,g){return new Bs(this.luminances,f,g,this.dataWidth,this.dataHeight,this.left+l,this.top+h)}invert(){return new Br(this)}}class gi extends ee{static forName(l){return this.getCharacterSetECIByName(l)}}class Bd{}Bd.ISO_8859_1=ee.ISO8859_1;class zo{isCompact(){return this.compact}setCompact(l){this.compact=l}getSize(){return this.size}setSize(l){this.size=l}getLayers(){return this.layers}setLayers(l){this.layers=l}getCodeWords(){return this.codeWords}setCodeWords(l){this.codeWords=l}getMatrix(){return this.matrix}setMatrix(l){this.matrix=l}}class So{static singletonList(l){return[l]}static min(l,h){return l.sort(h)[0]}}class Vs extends class{constructor(l){this.previous=l}getPrevious(){return this.previous}}{constructor(l,h,f){super(l),this.value=h,this.bitCount=f}appendTo(l,h){l.appendBits(this.value,this.bitCount)}add(l,h){return new Vs(this,l,h)}addBinaryShift(l,h){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new Vs(this,l,h)}toString(){let l=this.value&(1<<this.bitCount)-1;return l|=1<<this.bitCount,"<"+Dt.toBinaryString(l|1<<this.bitCount).substring(1)+">"}}class tc extends Vs{constructor(l,h,f){super(l,0,0),this.binaryShiftStart=h,this.binaryShiftByteCount=f}appendTo(l,h){for(let f=0;f<this.binaryShiftByteCount;f++)(0===f||31===f&&this.binaryShiftByteCount<=62)&&(l.appendBits(31,5),this.binaryShiftByteCount>62?l.appendBits(this.binaryShiftByteCount-31,16):l.appendBits(0===f?Math.min(this.binaryShiftByteCount,31):this.binaryShiftByteCount-31,5)),l.appendBits(h[this.binaryShiftStart+f],8)}addBinaryShift(l,h){return new tc(this,l,h)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function Gc(S,l,h){return new Vs(S,l,h)}const Y_=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],X_=new Vs(null,0,0),pg=[Int32Array.from([0,327708,327710,327709,656318]),Int32Array.from([590318,0,327710,327709,656318]),Int32Array.from([262158,590300,0,590301,932798]),Int32Array.from([327709,327708,656318,0,327710]),Int32Array.from([327711,656380,656382,656381,0])];const rv=function(S){for(let l of S)Cn.fill(l,-1);return S[0][4]=0,S[1][4]=0,S[1][0]=28,S[3][4]=0,S[2][4]=0,S[2][0]=15,S}(Cn.createInt32Array(6,6));class js{constructor(l,h,f,g){this.token=l,this.mode=h,this.binaryShiftByteCount=f,this.bitCount=g}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(l,h){let f=this.bitCount,g=this.token;if(l!==this.mode){let x=pg[this.mode][l];g=Gc(g,65535&x,x>>16),f+=x>>16}let v=2===l?4:5;return g=Gc(g,h,v),new js(g,l,0,f+v)}shiftAndAppend(l,h){let f=this.token,g=2===this.mode?4:5;return f=Gc(f,rv[this.mode][l],g),f=Gc(f,h,5),new js(f,this.mode,0,this.bitCount+g+5)}addBinaryShiftChar(l){let h=this.token,f=this.mode,g=this.bitCount;if(4===this.mode||2===this.mode){let b=pg[f][0];h=Gc(h,65535&b,b>>16),g+=b>>16,f=0}let x=new js(h,f,this.binaryShiftByteCount+1,g+(0===this.binaryShiftByteCount||31===this.binaryShiftByteCount?18:62===this.binaryShiftByteCount?9:8));return 2078===x.binaryShiftByteCount&&(x=x.endBinaryShift(l+1)),x}endBinaryShift(l){if(0===this.binaryShiftByteCount)return this;let h=this.token;return h=function(S,l,h){return new tc(S,l,h)}(h,l-this.binaryShiftByteCount,this.binaryShiftByteCount),new js(h,this.mode,0,this.bitCount)}isBetterThanOrEqualTo(l){let h=this.bitCount+(pg[this.mode][l.mode]>>16);return this.binaryShiftByteCount<l.binaryShiftByteCount?h+=js.calculateBinaryShiftCost(l)-js.calculateBinaryShiftCost(this):this.binaryShiftByteCount>l.binaryShiftByteCount&&l.binaryShiftByteCount>0&&(h+=10),h<=l.bitCount}toBitArray(l){let h=[];for(let g=this.endBinaryShift(l.length).token;null!==g;g=g.getPrevious())h.unshift(g);let f=new xt;for(const g of h)g.appendTo(f,l);return f}toString(){return _e.format("%s bits=%d bytes=%d",Y_[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(l){return l.binaryShiftByteCount>62?21:l.binaryShiftByteCount>31?20:l.binaryShiftByteCount>0?10:0}}js.INITIAL_STATE=new js(X_,0,0,0);const gg=function(S){const l=_e.getCharCode(" "),h=_e.getCharCode("."),f=_e.getCharCode(",");S[0][l]=1;const g=_e.getCharCode("Z"),v=_e.getCharCode("A");for(let B=v;B<=g;B++)S[0][B]=B-v+2;S[1][l]=1;const x=_e.getCharCode("z"),b=_e.getCharCode("a");for(let B=b;B<=x;B++)S[1][B]=B-b+2;S[2][l]=1;const E=_e.getCharCode("9"),D=_e.getCharCode("0");for(let B=D;B<=E;B++)S[2][B]=B-D+2;S[2][f]=12,S[2][h]=13;const R=["\0"," ","\x01","\x02","\x03","\x04","\x05","\x06","\x07","\b","\t","\n","\v","\f","\r","\x1b","\x1c","\x1d","\x1e","\x1f","@","\\","^","_","`","|","~","\x7f"];for(let B=0;B<R.length;B++)S[3][_e.getCharCode(R[B])]=B;const F=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let B=0;B<F.length;B++)_e.getCharCode(F[B])>0&&(S[4][_e.getCharCode(F[B])]=B);return S}(Cn.createInt32Array(5,256));class Kl{constructor(l){this.text=l}encode(){const l=_e.getCharCode(" "),h=_e.getCharCode("\n");let f=So.singletonList(js.INITIAL_STATE);for(let v=0;v<this.text.length;v++){let x,b=v+1<this.text.length?this.text[v+1]:0;switch(this.text[v]){case _e.getCharCode("\r"):x=b===h?2:0;break;case _e.getCharCode("."):x=b===l?3:0;break;case _e.getCharCode(","):x=b===l?4:0;break;case _e.getCharCode(":"):x=b===l?5:0;break;default:x=0}x>0?(f=Kl.updateStateListForPair(f,v,x),v++):f=this.updateStateListForChar(f,v)}return So.min(f,(v,x)=>v.getBitCount()-x.getBitCount()).toBitArray(this.text)}updateStateListForChar(l,h){const f=[];for(let g of l)this.updateStateForChar(g,h,f);return Kl.simplifyStates(f)}updateStateForChar(l,h,f){let g=255&this.text[h],v=gg[l.getMode()][g]>0,x=null;for(let b=0;b<=4;b++){let E=gg[b][g];if(E>0){if(null==x&&(x=l.endBinaryShift(h)),!v||b===l.getMode()||2===b){const D=x.latchAndAppend(b,E);f.push(D)}if(!v&&rv[l.getMode()][b]>=0){const D=x.shiftAndAppend(b,E);f.push(D)}}}if(l.getBinaryShiftByteCount()>0||0===gg[l.getMode()][g]){let b=l.addBinaryShiftChar(h);f.push(b)}}static updateStateListForPair(l,h,f){const g=[];for(let v of l)this.updateStateForPair(v,h,f,g);return this.simplifyStates(g)}static updateStateForPair(l,h,f,g){let v=l.endBinaryShift(h);if(g.push(v.latchAndAppend(4,f)),4!==l.getMode()&&g.push(v.shiftAndAppend(4,f)),3===f||4===f){let x=v.latchAndAppend(2,16-f).latchAndAppend(2,1);g.push(x)}if(l.getBinaryShiftByteCount()>0){let x=l.addBinaryShiftChar(h).addBinaryShiftChar(h+1);g.push(x)}}static simplifyStates(l){let h=[];for(const f of l){let g=!0;for(const v of h){if(v.isBetterThanOrEqualTo(f)){g=!1;break}f.isBetterThanOrEqualTo(v)&&(h=h.filter(x=>x!==v))}g&&h.push(f)}return h}}class An{constructor(){}static encodeBytes(l){return An.encode(l,An.DEFAULT_EC_PERCENT,An.DEFAULT_AZTEC_LAYERS)}static encode(l,h,f){let b,E,D,R,F,g=new Kl(l).encode(),v=Dt.truncDivision(g.getSize()*h,100)+11,x=g.getSize()+v;if(f!==An.DEFAULT_AZTEC_LAYERS){if(b=f<0,E=Math.abs(f),E>(b?An.MAX_NB_BITS_COMPACT:An.MAX_NB_BITS))throw new Ke(_e.format("Illegal value %s for layers",f));D=An.totalBitsInLayer(E,b),R=An.WORD_SIZE[E];let ve=D-D%R;if(F=An.stuffBits(g,R),F.getSize()+v>ve)throw new Ke("Data to large for user specified layer");if(b&&F.getSize()>64*R)throw new Ke("Data to large for user specified layer")}else{R=0,F=null;for(let ve=0;;ve++){if(ve>An.MAX_NB_BITS)throw new Ke("Data too large for an Aztec code");if(b=ve<=3,E=b?ve+1:ve,D=An.totalBitsInLayer(E,b),x>D)continue;(null==F||R!==An.WORD_SIZE[E])&&(R=An.WORD_SIZE[E],F=An.stuffBits(g,R));let Jt=D-D%R;if(!(b&&F.getSize()>64*R)&&F.getSize()+v<=Jt)break}}let ae,B=An.generateCheckWords(F,D,R),Y=F.getSize()/R,q=An.generateModeMessage(b,E,Y),te=(b?11:14)+4*E,re=new Int32Array(te);if(b){ae=te;for(let ve=0;ve<re.length;ve++)re[ve]=ve}else{ae=te+1+2*Dt.truncDivision(Dt.truncDivision(te,2)-1,15);let ve=Dt.truncDivision(te,2),Jt=Dt.truncDivision(ae,2);for(let Rt=0;Rt<ve;Rt++){let go=Rt+Dt.truncDivision(Rt,15);re[ve-Rt-1]=Jt-go-1,re[ve+Rt]=Jt+go+1}}let Te=new bt(ae);for(let ve=0,Jt=0;ve<E;ve++){let Rt=4*(E-ve)+(b?9:12);for(let go=0;go<Rt;go++){let Dn=2*go;for(let mo=0;mo<2;mo++)B.get(Jt+Dn+mo)&&Te.set(re[2*ve+mo],re[2*ve+go]),B.get(Jt+2*Rt+Dn+mo)&&Te.set(re[2*ve+go],re[te-1-2*ve-mo]),B.get(Jt+4*Rt+Dn+mo)&&Te.set(re[te-1-2*ve-mo],re[te-1-2*ve-go]),B.get(Jt+6*Rt+Dn+mo)&&Te.set(re[te-1-2*ve-go],re[2*ve+mo])}Jt+=8*Rt}if(An.drawModeMessage(Te,b,ae,q),b)An.drawBullsEye(Te,Dt.truncDivision(ae,2),5);else{An.drawBullsEye(Te,Dt.truncDivision(ae,2),7);for(let ve=0,Jt=0;ve<Dt.truncDivision(te,2)-1;ve+=15,Jt+=16)for(let Rt=1&Dt.truncDivision(ae,2);Rt<ae;Rt+=2)Te.set(Dt.truncDivision(ae,2)-Jt,Rt),Te.set(Dt.truncDivision(ae,2)+Jt,Rt),Te.set(Rt,Dt.truncDivision(ae,2)-Jt),Te.set(Rt,Dt.truncDivision(ae,2)+Jt)}let Le=new zo;return Le.setCompact(b),Le.setSize(ae),Le.setLayers(E),Le.setCodeWords(Y),Le.setMatrix(Te),Le}static drawBullsEye(l,h,f){for(let g=0;g<f;g+=2)for(let v=h-g;v<=h+g;v++)l.set(v,h-g),l.set(v,h+g),l.set(h-g,v),l.set(h+g,v);l.set(h-f,h-f),l.set(h-f+1,h-f),l.set(h-f,h-f+1),l.set(h+f,h-f),l.set(h+f,h-f+1),l.set(h+f,h+f-1)}static generateModeMessage(l,h,f){let g=new xt;return l?(g.appendBits(h-1,2),g.appendBits(f-1,6),g=An.generateCheckWords(g,28,4)):(g.appendBits(h-1,5),g.appendBits(f-1,11),g=An.generateCheckWords(g,40,4)),g}static drawModeMessage(l,h,f,g){let v=Dt.truncDivision(f,2);if(h)for(let x=0;x<7;x++){let b=v-3+x;g.get(x)&&l.set(b,v-5),g.get(x+7)&&l.set(v+5,b),g.get(20-x)&&l.set(b,v+5),g.get(27-x)&&l.set(v-5,b)}else for(let x=0;x<10;x++){let b=v-5+x+Dt.truncDivision(x,5);g.get(x)&&l.set(b,v-7),g.get(x+10)&&l.set(v+7,b),g.get(29-x)&&l.set(b,v+7),g.get(39-x)&&l.set(v-7,b)}}static generateCheckWords(l,h,f){let g=l.getSize()/f,v=new Ea(An.getGF(f)),x=Dt.truncDivision(h,f),b=An.bitsToWords(l,f,x);v.encode(b,x-g);let E=h%f,D=new xt;D.appendBits(0,E);for(const R of Array.from(b))D.appendBits(R,f);return D}static bitsToWords(l,h,f){let v,x,g=new Int32Array(f);for(v=0,x=l.getSize()/h;v<x;v++){let b=0;for(let E=0;E<h;E++)b|=l.get(v*h+E)?1<<h-E-1:0;g[v]=b}return g}static getGF(l){switch(l){case 4:return Kt.AZTEC_PARAM;case 6:return Kt.AZTEC_DATA_6;case 8:return Kt.AZTEC_DATA_8;case 10:return Kt.AZTEC_DATA_10;case 12:return Kt.AZTEC_DATA_12;default:throw new Ke("Unsupported word size "+l)}}static stuffBits(l,h){let f=new xt,g=l.getSize(),v=(1<<h)-2;for(let x=0;x<g;x+=h){let b=0;for(let E=0;E<h;E++)(x+E>=g||l.get(x+E))&&(b|=1<<h-1-E);(b&v)===v?(f.appendBits(b&v,h),x--):0==(b&v)?(f.appendBits(1|b,h),x--):f.appendBits(b,h)}return f}static totalBitsInLayer(l,h){return((h?88:112)+16*l)*l}}An.DEFAULT_EC_PERCENT=33,An.DEFAULT_AZTEC_LAYERS=0,An.MAX_NB_BITS=32,An.MAX_NB_BITS_COMPACT=4,An.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class Ud{encode(l,h,f,g){return this.encodeWithHints(l,h,f,g,null)}encodeWithHints(l,h,f,g,v){let x=Bd.ISO_8859_1,b=An.DEFAULT_EC_PERCENT,E=An.DEFAULT_AZTEC_LAYERS;return null!=v&&(v.has(Sr.CHARACTER_SET)&&(x=gi.forName(v.get(Sr.CHARACTER_SET).toString())),v.has(Sr.ERROR_CORRECTION)&&(b=Dt.parseInt(v.get(Sr.ERROR_CORRECTION).toString())),v.has(Sr.AZTEC_LAYERS)&&(E=Dt.parseInt(v.get(Sr.AZTEC_LAYERS).toString()))),Ud.encodeLayers(l,h,f,g,x,b,E)}static encodeLayers(l,h,f,g,v,x,b){if(h!==pt.AZTEC)throw new Ke("Can only encode AZTEC, but got "+h);let E=An.encode(_e.getBytes(l,v),x,b);return Ud.renderResult(E,f,g)}static renderResult(l,h,f){let g=l.getMatrix();if(null==g)throw new Vo;let v=g.getWidth(),x=g.getHeight(),b=Math.max(h,v),E=Math.max(f,x),D=Math.min(b/v,E/x),R=(b-v*D)/2,F=(E-x*D)/2,B=new bt(b,E);for(let Y=0,q=F;Y<x;Y++,q+=D)for(let te=0,re=R;te<v;te++,re+=D)g.get(te,Y)&&B.setRegion(re,q,D,D);return B}}me.ArgumentException=hi,me.ArithmeticException=ru,me.AztecCode=zo,me.AztecCodeReader=Ms,me.AztecCodeWriter=Ud,me.AztecDecoder=Jn,me.AztecDetector=Ts,me.AztecDetectorResult=Uo,me.AztecEncoder=An,me.AztecHighLevelEncoder=Kl,me.AztecPoint=Ur,me.BarcodeFormat=pt,me.Binarizer=va,me.BinaryBitmap=Bi,me.BitArray=xt,me.BitMatrix=bt,me.BitSource=Qu,me.BrowserAztecCodeReader=class extends as{constructor(l=500){super(new Ms,l)}},me.BrowserBarcodeReader=class extends as{constructor(l=500,h){super(new ou(h),l,h)}},me.BrowserCodeReader=as,me.BrowserDatamatrixCodeReader=class extends as{constructor(l=500){super(new _a,l)}},me.BrowserMultiFormatReader=class extends as{constructor(l=null,h=500){const f=new Ju;f.setHints(l),super(f,h)}decodeBitmap(l){return this.reader.decodeWithState(l)}},me.BrowserPDF417Reader=class extends as{constructor(l=500){super(new mr,l)}},me.BrowserQRCodeReader=class extends as{constructor(l=500){super(new Ji,l)}},me.BrowserQRCodeSvgWriter=Yl,me.CharacterSetECI=ee,me.ChecksumException=At,me.Code128Reader=Me,me.Code39Reader=Xu,me.DataMatrixDecodedBitStreamParser=Do,me.DataMatrixReader=_a,me.DecodeHintType=yn,me.DecoderResult=Ds,me.DefaultGridSampler=wa,me.DetectorResult=Di,me.EAN13Reader=qu,me.EncodeHintType=Sr,me.Exception=br,me.FormatException=Re,me.GenericGF=Kt,me.GenericGFPoly=fi,me.GlobalHistogramBinarizer=jn,me.GridSampler=iu,me.GridSamplerInstance=Ui,me.HTMLCanvasElementLuminanceSource=$r,me.HybridBinarizer=ft,me.ITFReader=En,me.IllegalArgumentException=Ke,me.IllegalStateException=Vo,me.InvertedLuminanceSource=Br,me.LuminanceSource=kt,me.MathUtils=Qt,me.MultiFormatOneDReader=ou,me.MultiFormatReader=Ju,me.MultiFormatWriter=class{encode(l,h,f,g,v){let x;switch(h){case pt.QR_CODE:x=new Xl;break;default:throw new Ke("No encoder available for format "+h)}return x.encode(l,h,f,g,v)}},me.NotFoundException=ie,me.OneDReader=Cr,me.PDF417DecodedBitStreamParser=ue,me.PDF417DecoderErrorCorrection=ne,me.PDF417Reader=mr,me.PDF417ResultMetadata=Ut,me.PerspectiveTransform=_r,me.PlanarYUVLuminanceSource=ql,me.QRCodeByteMatrix=Ia,me.QRCodeDataMask=Dr,me.QRCodeDecodedBitStreamParser=Zu,me.QRCodeDecoderErrorCorrectionLevel=Pe,me.QRCodeDecoderFormatInformation=Ir,me.QRCodeEncoder=rr,me.QRCodeEncoderQRCode=Ls,me.QRCodeMaskUtil=Kr,me.QRCodeMatrixUtil=Be,me.QRCodeMode=We,me.QRCodeReader=Ji,me.QRCodeVersion=at,me.QRCodeWriter=Xl,me.RGBLuminanceSource=Bs,me.RSS14Reader=Et,me.RSSExpandedReader=Ce,me.ReaderException=vr,me.ReedSolomonDecoder=ba,me.ReedSolomonEncoder=Ea,me.ReedSolomonException=xa,me.Result=Vr,me.ResultMetadataType=wr,me.ResultPoint=Xe,me.StringUtils=_e,me.UnsupportedOperationException=Fe,me.VideoInputDevice=ya,me.WhiteRectangleDetector=pr,me.WriterException=rn,me.ZXingArrays=Cn,me.ZXingCharset=gi,me.ZXingInteger=Dt,me.ZXingStandardCharsets=Bd,me.ZXingStringBuilder=Oe,me.ZXingStringEncoding=Ae,me.ZXingSystem=$t,Object.defineProperty(me,"__esModule",{value:!0})}($n)},338:function(tn,$n,me){var Bn;tn=me.nmd(tn),Bn=function(){var ar=null,fr={};Cn("monochrome",null,[[0,0],[100,0]]),Cn("red",[-26,18],[[20,100],[30,92],[40,89],[50,85],[60,78],[70,70],[80,60],[90,55],[100,50]]),Cn("orange",[18,46],[[20,100],[30,93],[40,88],[50,86],[60,85],[70,70],[100,70]]),Cn("yellow",[46,62],[[25,100],[40,94],[50,89],[60,86],[70,84],[80,82],[90,80],[100,75]]),Cn("green",[62,178],[[30,100],[40,90],[50,85],[60,81],[70,74],[80,64],[90,50],[100,40]]),Cn("blue",[178,257],[[20,100],[30,86],[40,80],[50,74],[60,60],[70,52],[80,44],[90,39],[100,35]]),Cn("purple",[257,282],[[20,100],[30,87],[40,79],[50,70],[60,65],[70,59],[80,52],[90,45],[100,42]]),Cn("pink",[282,334],[[20,100],[30,90],[40,86],[60,84],[80,80],[90,75],[100,73]]);var Bn=[],Bo=function(ee){if(null!=(ee=ee||{}).seed&&ee.seed===parseInt(ee.seed,10))ar=ee.seed;else if("string"==typeof ee.seed)ar=function(ee){for(var Fe=0,Ae=0;Ae!==ee.length&&!(Fe>=Number.MAX_SAFE_INTEGER);Ae++)Fe+=ee.charCodeAt(Ae);return Fe}(ee.seed);else{if(null!=ee.seed)throw new TypeError("The seed value must be an integer or string");ar=null}var Fe,Ae;if(null!=ee.count){for(var Oe=ee.count,bt=[],ie=0;ie<ee.count;ie++)Bn.push(!1);for(ee.count=null;Oe>bt.length;){var jn=Bo(ee);null!==ar&&(ee.seed=ar),bt.push(jn)}return ee.count=Oe,bt}return function(ee,Fe){switch(Fe.format){case"hsvArray":return ee;case"hslArray":return yn(ee);case"hsl":var Ae=yn(ee);return"hsl("+Ae[0]+", "+Ae[1]+"%, "+Ae[2]+"%)";case"hsla":var _e=yn(ee),Oe=Fe.alpha||Math.random();return"hsla("+_e[0]+", "+_e[1]+"%, "+_e[2]+"%, "+Oe+")";case"rgbArray":return xt(ee);case"rgb":return"rgb("+xt(ee).join(", ")+")";case"rgba":var ie=xt(ee);return Oe=Fe.alpha||Math.random(),"rgba("+ie.join(", ")+", "+Oe+")";default:return function(ee){var Fe=xt(ee);function Ae(Oe){var bt=Oe.toString(16);return 1==bt.length?"0"+bt:bt}return"#"+Ae(Fe[0])+Ae(Fe[1])+Ae(Fe[2])}(ee)}}([Fe=Lr(ee),Ae=br(Fe,ee),hi(Fe,Ae,ee)],ee)};function Lr(ee){if(Bn.length>0){var Ae=Vi(Fe=function(ee){if(isNaN(ee)){if("string"==typeof ee)if(fr[ee]){var Ae=fr[ee];if(Ae.hueRange)return Ae.hueRange}else if(ee.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i))return $t(lo(ee)[0]).hueRange}else{var Fe=parseInt(ee);if(Fe<360&&Fe>0)return $t(ee).hueRange}return[0,360]}(ee.hue)),_e=(Fe[1]-Fe[0])/Bn.length,Oe=parseInt((Ae-Fe[0])/_e);return!0===Bn[Oe]?Oe=(Oe+2)%Bn.length:Bn[Oe]=!0,(Ae=Vi(Fe=[(Fe[0]+Oe*_e)%359,(Fe[0]+(Oe+1)*_e)%359]))<0&&(Ae=360+Ae),Ae}var Fe;return(Ae=Vi(Fe=function(ee){if("number"==typeof parseInt(ee)){var Fe=parseInt(ee);if(Fe<360&&Fe>0)return[Fe,Fe]}if("string"==typeof ee)if(fr[ee]){var Ae=fr[ee];if(Ae.hueRange)return Ae.hueRange}else if(ee.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var _e=lo(ee)[0];return[_e,_e]}return[0,360]}(ee.hue)))<0&&(Ae=360+Ae),Ae}function br(ee,Fe){if("monochrome"===Fe.hue)return 0;if("random"===Fe.luminosity)return Vi([0,100]);var Ae=function(ee){return $t(ee).saturationRange}(ee),_e=Ae[0],Oe=Ae[1];switch(Fe.luminosity){case"bright":_e=55;break;case"dark":_e=Oe-10;break;case"light":Oe=55}return Vi([_e,Oe])}function hi(ee,Fe,Ae){var _e=function(ee,Fe){for(var Ae=$t(ee).lowerBounds,_e=0;_e<Ae.length-1;_e++){var Oe=Ae[_e][0],bt=Ae[_e][1],ie=Ae[_e+1][0];if(Fe>=Oe&&Fe<=ie){var ft=(Ae[_e+1][1]-bt)/(ie-Oe);return ft*Fe+(bt-ft*Oe)}}return 0}(ee,Fe),Oe=100;switch(Ae.luminosity){case"dark":Oe=_e+20;break;case"light":_e=(Oe+_e)/2;break;case"random":_e=0,Oe=100}return Vi([_e,Oe])}function $t(ee){for(var Fe in ee>=334&&ee<=360&&(ee-=360),fr){var Ae=fr[Fe];if(Ae.hueRange&&ee>=Ae.hueRange[0]&&ee<=Ae.hueRange[1])return fr[Fe]}return"Color not found"}function Vi(ee){if(null===ar){var Ae=Math.random();return Ae+=.618033988749895,Ae%=1,Math.floor(ee[0]+Ae*(ee[1]+1-ee[0]))}var Oe=ee[0]||0;return ar=(9301*ar+49297)%233280,Math.floor(Oe+ar/233280*((ee[1]||1)-Oe))}function Cn(ee,Fe,Ae){fr[ee]={hueRange:Fe,lowerBounds:Ae,saturationRange:[Ae[0][0],Ae[Ae.length-1][0]],brightnessRange:[Ae[Ae.length-1][1],Ae[0][1]]}}function xt(ee){var Fe=ee[0];0===Fe&&(Fe=1),360===Fe&&(Fe=359),Fe/=360;var Ae=ee[1]/100,_e=ee[2]/100,Oe=Math.floor(6*Fe),bt=6*Fe-Oe,ie=_e*(1-Ae),jn=_e*(1-bt*Ae),ft=_e*(1-(1-bt)*Ae),kt=256,Br=256,$r=256;switch(Oe){case 0:kt=_e,Br=ft,$r=ie;break;case 1:kt=jn,Br=_e,$r=ie;break;case 2:kt=ie,Br=_e,$r=ft;break;case 3:kt=ie,Br=jn,$r=_e;break;case 4:kt=ft,Br=ie,$r=_e;break;case 5:kt=_e,Br=ie,$r=jn}return[Math.floor(255*kt),Math.floor(255*Br),Math.floor(255*$r)]}function lo(ee){ee=3===(ee=ee.replace(/^#/,"")).length?ee.replace(/(.)/g,"$1$1"):ee;var Fe=parseInt(ee.substr(0,2),16)/255,Ae=parseInt(ee.substr(2,2),16)/255,_e=parseInt(ee.substr(4,2),16)/255,Oe=Math.max(Fe,Ae,_e),bt=Oe-Math.min(Fe,Ae,_e),ie=Oe?bt/Oe:0;switch(Oe){case Fe:return[(Ae-_e)/bt%6*60||0,ie,Oe];case Ae:return[60*((_e-Fe)/bt+2)||0,ie,Oe];case _e:return[60*((Fe-Ae)/bt+4)||0,ie,Oe]}}function yn(ee){var Ae=ee[1]/100,_e=ee[2]/100,Oe=(2-Ae)*_e;return[ee[0],Math.round(Ae*_e/(Oe<1?Oe:2-Oe)*1e4)/100,Oe/2*100]}return Bo}(),tn&&tn.exports&&($n=tn.exports=Bn),$n.randomColor=Bn},421:(tn,$n,me)=>{"use strict";function ar(n){return"function"==typeof n}let fr=!1;const Bn={Promise:void 0,set useDeprecatedSynchronousErrorHandling(n){if(n){const e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else fr&&console.log("RxJS: Back to a better error behavior. Thank you. <3");fr=n},get useDeprecatedSynchronousErrorHandling(){return fr}};function Bo(n){setTimeout(()=>{throw n},0)}const Lr={closed:!0,next(n){},error(n){if(Bn.useDeprecatedSynchronousErrorHandling)throw n;Bo(n)},complete(){}},br=Array.isArray||(n=>n&&"number"==typeof n.length);function hi(n){return null!==n&&"object"==typeof n}const Bi=(()=>{function n(e){return Error.call(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((t,r)=>`${r+1}) ${t.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e,this}return n.prototype=Object.create(Error.prototype),n})();class At{constructor(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}unsubscribe(){let e;if(this.closed)return;let{_parentOrParents:t,_ctorUnsubscribe:r,_unsubscribe:i,_subscriptions:o}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,t instanceof At)t.remove(this);else if(null!==t)for(let s=0;s<t.length;++s)t[s].remove(this);if(ar(i)){r&&(this._unsubscribe=void 0);try{i.call(this)}catch(s){e=s instanceof Bi?va(s.errors):[s]}}if(br(o)){let s=-1,a=o.length;for(;++s<a;){const u=o[s];if(hi(u))try{u.unsubscribe()}catch(c){e=e||[],c instanceof Bi?e=e.concat(va(c.errors)):e.push(c)}}}if(e)throw new Bi(e)}add(e){let t=e;if(!e)return At.EMPTY;switch(typeof e){case"function":t=new At(e);case"object":if(t===this||t.closed||"function"!=typeof t.unsubscribe)return t;if(this.closed)return t.unsubscribe(),t;if(!(t instanceof At)){const o=t;t=new At,t._subscriptions=[o]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}let{_parentOrParents:r}=t;if(null===r)t._parentOrParents=this;else if(r instanceof At){if(r===this)return t;t._parentOrParents=[r,this]}else{if(-1!==r.indexOf(this))return t;r.push(this)}const i=this._subscriptions;return null===i?this._subscriptions=[t]:i.push(t),t}remove(e){const t=this._subscriptions;if(t){const r=t.indexOf(e);-1!==r&&t.splice(r,1)}}}var n;function va(n){return n.reduce((e,t)=>e.concat(t instanceof Bi?t.errors:t),[])}At.EMPTY=((n=new At).closed=!0,n);const $t="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random();class Pn extends At{constructor(e,t,r){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=Lr;break;case 1:if(!e){this.destination=Lr;break}if("object"==typeof e){e instanceof Pn?(this.syncErrorThrowable=e.syncErrorThrowable,this.destination=e,e.add(this)):(this.syncErrorThrowable=!0,this.destination=new Cn(this,e));break}default:this.syncErrorThrowable=!0,this.destination=new Cn(this,e,t,r)}}[$t](){return this}static create(e,t,r){const i=new Pn(e,t,r);return i.syncErrorThrowable=!1,i}next(e){this.isStopped||this._next(e)}error(e){this.isStopped||(this.isStopped=!0,this._error(e))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(e){this.destination.next(e)}_error(e){this.destination.error(e),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:e}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this}}class Cn extends Pn{constructor(e,t,r,i){super(),this._parentSubscriber=e;let o,s=this;ar(t)?o=t:t&&(o=t.next,r=t.error,i=t.complete,t!==Lr&&(s=Object.create(t),ar(s.unsubscribe)&&this.add(s.unsubscribe.bind(s)),s.unsubscribe=this.unsubscribe.bind(this))),this._context=s,this._next=o,this._error=r,this._complete=i}next(e){if(!this.isStopped&&this._next){const{_parentSubscriber:t}=this;Bn.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}error(e){if(!this.isStopped){const{_parentSubscriber:t}=this,{useDeprecatedSynchronousErrorHandling:r}=Bn;if(this._error)r&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)r?(t.syncErrorValue=e,t.syncErrorThrown=!0):Bo(e),this.unsubscribe();else{if(this.unsubscribe(),r)throw e;Bo(e)}}}complete(){if(!this.isStopped){const{_parentSubscriber:e}=this;if(this._complete){const t=()=>this._complete.call(this._context);Bn.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,t),this.unsubscribe()):(this.__tryOrUnsub(t),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(e,t){try{e.call(this._context,t)}catch(r){if(this.unsubscribe(),Bn.useDeprecatedSynchronousErrorHandling)throw r;Bo(r)}}__tryOrSetError(e,t,r){if(!Bn.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,r)}catch(i){return Bn.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=i,e.syncErrorThrown=!0,!0):(Bo(i),!0)}return!1}_unsubscribe(){const{_parentSubscriber:e}=this;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}const lo="function"==typeof Symbol&&Symbol.observable||"@@observable";function yn(n){return n}let ee=(()=>{class n{constructor(t){this._isScalar=!1,t&&(this._subscribe=t)}lift(t){const r=new n;return r.source=this,r.operator=t,r}subscribe(t,r,i){const{operator:o}=this,s=function(n,e,t){if(n){if(n instanceof Pn)return n;if(n[$t])return n[$t]()}return n||e||t?new Pn(n,e,t):new Pn(Lr)}(t,r,i);if(s.add(o?o.call(s,this.source):this.source||Bn.useDeprecatedSynchronousErrorHandling&&!s.syncErrorThrowable?this._subscribe(s):this._trySubscribe(s)),Bn.useDeprecatedSynchronousErrorHandling&&s.syncErrorThrowable&&(s.syncErrorThrowable=!1,s.syncErrorThrown))throw s.syncErrorValue;return s}_trySubscribe(t){try{return this._subscribe(t)}catch(r){Bn.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=r),function(n){for(;n;){const{closed:e,destination:t,isStopped:r}=n;if(e||r)return!1;n=t&&t instanceof Pn?t:null}return!0}(t)?t.error(r):console.warn(r)}}forEach(t,r){return new(r=Fe(r))((i,o)=>{let s;s=this.subscribe(a=>{try{t(a)}catch(u){o(u),s&&s.unsubscribe()}},o,i)})}_subscribe(t){const{source:r}=this;return r&&r.subscribe(t)}[lo](){return this}pipe(...t){return 0===t.length?this:function(n){return 0===n.length?yn:1===n.length?n[0]:function(t){return n.reduce((r,i)=>i(r),t)}}(t)(this)}toPromise(t){return new(t=Fe(t))((r,i)=>{let o;this.subscribe(s=>o=s,s=>i(s),()=>r(o))})}}return n.create=e=>new n(e),n})();function Fe(n){if(n||(n=Bn.Promise||Promise),!n)throw new Error("no Promise impl found");return n}const _e=(()=>{function n(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return n.prototype=Object.create(Error.prototype),n})();class Oe extends At{constructor(e,t){super(),this.subject=e,this.subscriber=t,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const e=this.subject,t=e.observers;if(this.subject=null,!t||0===t.length||e.isStopped||e.closed)return;const r=t.indexOf(this.subscriber);-1!==r&&t.splice(r,1)}}class bt extends Pn{constructor(e){super(e),this.destination=e}}let ie=(()=>{class n extends ee{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[$t](){return new bt(this)}lift(t){const r=new jn(this,this);return r.operator=t,r}next(t){if(this.closed)throw new _e;if(!this.isStopped){const{observers:r}=this,i=r.length,o=r.slice();for(let s=0;s<i;s++)o[s].next(t)}}error(t){if(this.closed)throw new _e;this.hasError=!0,this.thrownError=t,this.isStopped=!0;const{observers:r}=this,i=r.length,o=r.slice();for(let s=0;s<i;s++)o[s].error(t);this.observers.length=0}complete(){if(this.closed)throw new _e;this.isStopped=!0;const{observers:t}=this,r=t.length,i=t.slice();for(let o=0;o<r;o++)i[o].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(t){if(this.closed)throw new _e;return super._trySubscribe(t)}_subscribe(t){if(this.closed)throw new _e;return this.hasError?(t.error(this.thrownError),At.EMPTY):this.isStopped?(t.complete(),At.EMPTY):(this.observers.push(t),new Oe(this,t))}asObservable(){const t=new ee;return t.source=this,t}}return n.create=(e,t)=>new jn(e,t),n})();class jn extends ie{constructor(e,t){super(),this.destination=e,this.source=t}next(e){const{destination:t}=this;t&&t.next&&t.next(e)}error(e){const{destination:t}=this;t&&t.error&&this.destination.error(e)}complete(){const{destination:e}=this;e&&e.complete&&this.destination.complete()}_subscribe(e){const{source:t}=this;return t?this.source.subscribe(e):At.EMPTY}}function ft(n){return n&&"function"==typeof n.schedule}function kt(n,e){return function(r){if("function"!=typeof n)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new Br(n,e))}}class Br{constructor(e,t){this.project=e,this.thisArg=t}call(e,t){return t.subscribe(new $r(e,this.project,this.thisArg))}}class $r extends Pn{constructor(e,t,r){super(e),this.project=t,this.count=0,this.thisArg=r||this}_next(e){let t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(r){return void this.destination.error(r)}this.destination.next(t)}}const ya=n=>e=>{for(let t=0,r=n.length;t<r&&!e.closed;t++)e.next(n[t]);e.complete()},Vr="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",wr=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function Ds(n){return!!n&&"function"!=typeof n.subscribe&&"function"==typeof n.then}const Ss=n=>{if(n&&"function"==typeof n[lo])return(n=>e=>{const t=n[lo]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)})(n);if(wr(n))return ya(n);if(Ds(n))return(n=>e=>(n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,Bo),e))(n);if(n&&"function"==typeof n[Vr])return(n=>e=>{const t=n[Vr]();for(;;){let r;try{r=t.next()}catch(i){return e.error(i),e}if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof t.return&&e.add(()=>{t.return&&t.return()}),e})(n);{const t=`You provided ${hi(n)?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(t)}};function Kt(n,e){return new ee(t=>{const r=new At;let i=0;return r.add(e.schedule(function(){i!==n.length?(t.next(n[i++]),t.closed||r.add(this.schedule())):t.complete()})),r})}function Jn(n,e){return e?function(n,e){if(null!=n){if(function(n){return n&&"function"==typeof n[lo]}(n))return function(n,e){return new ee(t=>{const r=new At;return r.add(e.schedule(()=>{const i=n[lo]();r.add(i.subscribe({next(o){r.add(e.schedule(()=>t.next(o)))},error(o){r.add(e.schedule(()=>t.error(o)))},complete(){r.add(e.schedule(()=>t.complete()))}}))})),r})}(n,e);if(Ds(n))return function(n,e){return new ee(t=>{const r=new At;return r.add(e.schedule(()=>n.then(i=>{r.add(e.schedule(()=>{t.next(i),r.add(e.schedule(()=>t.complete()))}))},i=>{r.add(e.schedule(()=>t.error(i)))}))),r})}(n,e);if(wr(n))return Kt(n,e);if(function(n){return n&&"function"==typeof n[Vr]}(n)||"string"==typeof n)return function(n,e){if(!n)throw new Error("Iterable cannot be null");return new ee(t=>{const r=new At;let i;return r.add(()=>{i&&"function"==typeof i.return&&i.return()}),r.add(e.schedule(()=>{i=n[Vr](),r.add(e.schedule(function(){if(t.closed)return;let o,s;try{const a=i.next();o=a.value,s=a.done}catch(a){return void t.error(a)}s?t.complete():(t.next(o),this.schedule())}))})),r})}(n,e)}throw new TypeError((null!==n&&typeof n||n)+" is not observable")}(n,e):n instanceof ee?n:new ee(Ss(n))}class Qt extends Pn{constructor(e){super(),this.parent=e}_next(e){this.parent.notifyNext(e)}_error(e){this.parent.notifyError(e),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class Xe extends Pn{notifyNext(e){this.destination.next(e)}notifyError(e){this.destination.error(e)}notifyComplete(){this.destination.complete()}}function Uo(n,e){if(e.closed)return;if(n instanceof ee)return n.subscribe(e);let t;try{t=Ss(n)(e)}catch(r){e.error(r)}return t}function pr(n,e,t=Number.POSITIVE_INFINITY){return"function"==typeof e?r=>r.pipe(pr((i,o)=>Jn(n(i,o)).pipe(kt((s,a)=>e(i,s,o,a))),t)):("number"==typeof e&&(t=e),r=>r.lift(new iu(n,t)))}class iu{constructor(e,t=Number.POSITIVE_INFINITY){this.project=e,this.concurrent=t}call(e,t){return t.subscribe(new _r(e,this.project,this.concurrent))}}class _r extends Xe{constructor(e,t,r=Number.POSITIVE_INFINITY){super(e),this.project=t,this.concurrent=r,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}_tryNext(e){let t;const r=this.index++;try{t=this.project(e,r)}catch(i){return void this.destination.error(i)}this.active++,this._innerSub(t)}_innerSub(e){const t=new Qt(this),r=this.destination;r.add(t);const i=Uo(e,t);i!==t&&r.add(i)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(e){this.destination.next(e)}notifyComplete(){const e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function Ui(n=Number.POSITIVE_INFINITY){return pr(yn,n)}function Ur(n,e){return e?Kt(n,e):new ee(ya(n))}function Ts(...n){let e=Number.POSITIVE_INFINITY,t=null,r=n[n.length-1];return ft(r)?(t=n.pop(),n.length>1&&"number"==typeof n[n.length-1]&&(e=n.pop())):"number"==typeof r&&(e=n.pop()),null===t&&1===n.length&&n[0]instanceof ee?n[0]:Ui(e)(Ur(n,t))}function Ms(){return function(e){return e.lift(new Yu(e))}}class Yu{constructor(e){this.connectable=e}call(e,t){const{connectable:r}=this;r._refCount++;const i=new Cr(e,r),o=t.subscribe(i);return i.closed||(i.connection=r.connect()),o}}class Cr extends Pn{constructor(e,t){super(e),this.connectable=t}_unsubscribe(){const{connectable:e}=this;if(!e)return void(this.connection=null);this.connectable=null;const t=e._refCount;if(t<=0)return void(this.connection=null);if(e._refCount=t-1,t>1)return void(this.connection=null);const{connection:r}=this,i=e._connection;this.connection=null,i&&(!r||i===r)&&i.unsubscribe()}}class Me extends ee{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._refCount=0,this._isComplete=!1}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}connect(){let e=this._connection;return e||(this._isComplete=!1,e=this._connection=new At,e.add(this.source.subscribe(new En(this.getSubject(),this))),e.closed&&(this._connection=null,e=At.EMPTY)),e}refCount(){return Ms()(this)}}const Xu=(()=>{const n=Me.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:n._subscribe},_isComplete:{value:n._isComplete,writable:!0},getSubject:{value:n.getSubject},connect:{value:n.connect},refCount:{value:n.refCount}}})();class En extends bt{constructor(e,t){super(e),this.connectable=t}_error(e){this._unsubscribe(),super._error(e)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const e=this.connectable;if(e){this.connectable=null;const t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}}}function un(){return new ie}function cn(n){for(let e in n)if(n[e]===cn)return e;throw Error("Could not find renamed property on target object.")}function $u(n,e){for(const t in e)e.hasOwnProperty(t)&&!n.hasOwnProperty(t)&&(n[t]=e[t])}function yt(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(yt).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const e=n.toString();if(null==e)return""+e;const t=e.indexOf("\n");return-1===t?e:e.substring(0,t)}function ri(n,e){return null==n||""===n?null===e?"":e:null==e||""===e?n:n+" "+e}const Ao=cn({__forward_ref__:cn});function jo(n){return n.__forward_ref__=jo,n.toString=function(){return yt(this())},n}function He(n){return $i(n)?n():n}function $i(n){return"function"==typeof n&&n.hasOwnProperty(Ao)&&n.__forward_ref__===jo}class fn extends Error{constructor(e,t){super(function(n,e){return`${n?`NG0${n}: `:""}${e}`}(e,t)),this.code=e}}function ht(n){return"string"==typeof n?n:null==n?"":String(n)}function gr(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():ht(n)}function jr(n,e){const t=e?` in ${e}`:"";throw new fn("201",`No provider for ${gr(n)} found${t}`)}function Mi(n,e){null==n&&function(n,e,t,r){throw new Error(`ASSERTION ERROR: ${n}`+(null==r?"":` [Expected=> ${t} ${r} ${e} <=Actual]`))}(e,n,null,"!=")}function Ve(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function ji(n){return{providers:n.providers||[],imports:n.imports||[]}}function Ki(n){return Qu(n,er)||Qu(n,Wc)}function Qu(n,e){return n.hasOwnProperty(e)?n[e]:null}function jc(n){return n&&(n.hasOwnProperty(_a)||n.hasOwnProperty(Ps))?n[_a]:null}const er=cn({\u0275prov:cn}),_a=cn({\u0275inj:cn}),Wc=cn({ngInjectableDef:cn}),Ps=cn({ngInjectorDef:cn});var Pe=(()=>((Pe=Pe||{})[Pe.Default=0]="Default",Pe[Pe.Host=1]="Host",Pe[Pe.Self=2]="Self",Pe[Pe.SkipSelf=4]="SkipSelf",Pe[Pe.Optional=8]="Optional",Pe))();let Ir;function z(n){const e=Ir;return Ir=n,e}function at(n,e,t){const r=Ki(n);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:t&Pe.Optional?null:void 0!==e?e:void jr(yt(n),"Injector")}function Dr(n){return{toString:n}.toString()}var Qi=(()=>((Qi=Qi||{})[Qi.OnPush=0]="OnPush",Qi[Qi.Default=1]="Default",Qi))(),We=(()=>((We=We||{})[We.Emulated=0]="Emulated",We[We.None=2]="None",We[We.ShadowDom=3]="ShadowDom",We))();const Zu="undefined"!=typeof globalThis&&globalThis,Wl="undefined"!=typeof window&&window,Ld="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Zt=Zu||"undefined"!=typeof global&&global||Wl||Ld,Ca={},ln=[],Ji=cn({\u0275cmp:cn}),I=cn({\u0275dir:cn}),k=cn({\u0275pipe:cn}),P=cn({\u0275mod:cn}),W=cn({\u0275loc:cn}),Q=cn({\u0275fac:cn}),ce=cn({__NG_ELEMENT_ID__:cn});let ne=0;function xe(n){return Dr(()=>{const t={},r={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:t,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===Qi.OnPush,directiveDefs:null,pipeDefs:null,selectors:n.selectors||ln,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||We.Emulated,id:"c",styles:n.styles||ln,_:null,setInput:null,schemas:n.schemas||null,tView:null},i=n.directives,o=n.features,s=n.pipes;return r.id+=ne++,r.inputs=Mt(n.inputs,t),r.outputs=Mt(n.outputs),o&&o.forEach(a=>a(r)),r.directiveDefs=i?()=>("function"==typeof i?i():i).map(ke):null,r.pipeDefs=s?()=>("function"==typeof s?s():s).map(vt):null,r})}function ke(n){return Pt(n)||function(n){return n[I]||null}(n)}function vt(n){return function(n){return n[k]||null}(n)}const Tt={};function gt(n){return Dr(()=>{const e={type:n.type,bootstrap:n.bootstrap||ln,declarations:n.declarations||ln,imports:n.imports||ln,exports:n.exports||ln,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null};return null!=n.id&&(Tt[n.id]=n.type),e})}function Mt(n,e){if(null==n)return Ca;const t={};for(const r in n)if(n.hasOwnProperty(r)){let i=n[r],o=i;Array.isArray(i)&&(o=i[1],i=i[0]),t[i]=r,e&&(e[i]=o)}return t}const Je=xe;function Ut(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,onDestroy:n.type.prototype.ngOnDestroy||null}}function Pt(n){return n[Ji]||null}function Kn(n,e){const t=n[P]||null;if(!t&&!0===e)throw new Error(`Type ${yt(n)} does not have '\u0275mod' property.`);return t}function zo(n){return Array.isArray(n)&&"object"==typeof n[1]}function So(n){return Array.isArray(n)&&!0===n[1]}function Vd(n){return 0!=(8&n.flags)}function Vs(n){return 2==(2&n.flags)}function tc(n){return 1==(1&n.flags)}function Go(n){return null!==n.template}function Gc(n){return 0!=(512&n[2])}function x(n,e){return n.hasOwnProperty(Q)?n[Q]:null}class b{constructor(e,t,r){this.previousValue=e,this.currentValue=t,this.firstChange=r}isFirstChange(){return this.firstChange}}function E(){return D}function D(n){return n.type.prototype.ngOnChanges&&(n.setInput=F),R}function R(){const n=Y(this),e=null==n?void 0:n.current;if(e){const t=n.previous;if(t===Ca)n.previous=e;else for(let r in e)t[r]=e[r];n.current=null,this.ngOnChanges(e)}}function F(n,e,t,r){const i=Y(n)||function(n,e){return n[B]=e}(n,{previous:Ca,current:null}),o=i.current||(i.current={}),s=i.previous,a=this.declaredInputs[t],u=s[a];o[a]=new b(u&&u.currentValue,e,s===Ca),n[r]=e}E.ngInherit=!0;const B="__ngSimpleChanges__";function Y(n){return n[B]||null}let ve;function Dn(n){return!!n.listen}const Gn={createRenderer:(n,e)=>void 0!==ve?ve:"undefined"!=typeof document?document:void 0};function Sn(n){for(;Array.isArray(n);)n=n[0];return n}function Ql(n,e){return Sn(e[n])}function To(n,e){return Sn(e[n.index])}function iv(n,e){return n.data[e]}function Zl(n,e){return n[e]}function Xo(n,e){const t=e[n];return zo(t)?t:t[0]}function K_(n){return 4==(4&n[2])}function ov(n){return 128==(128&n[2])}function rc(n,e){return null==e?null:n[e]}function Q_(n){n[18]=0}function sv(n,e){n[5]+=e;let t=n,r=n[3];for(;null!==r&&(1===e&&1===t[5]||-1===e&&0===t[5]);)r[5]+=e,t=r,r=r[3]}const Nt={lFrame:oC(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function Z_(){return Nt.bindingsEnabled}function De(){return Nt.lFrame.lView}function Tn(){return Nt.lFrame.tView}function Qr(n){return Nt.lFrame.contextLView=n,n[8]}function vi(){let n=J_();for(;null!==n&&64===n.type;)n=n.parent;return n}function J_(){return Nt.lFrame.currentTNode}function Da(n,e){const t=Nt.lFrame;t.currentTNode=n,t.isParent=e}function av(){return Nt.lFrame.isParent}function uv(){Nt.lFrame.isParent=!1}function mg(){return Nt.isInCheckNoChangesMode}function vg(n){Nt.isInCheckNoChangesMode=n}function vo(){const n=Nt.lFrame;let e=n.bindingRootIndex;return-1===e&&(e=n.bindingRootIndex=n.tView.bindingStartIndex),e}function Sa(){return Nt.lFrame.bindingIndex}function Jl(){return Nt.lFrame.bindingIndex++}function su(n){const e=Nt.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+n,t}function eF(n,e){const t=Nt.lFrame;t.bindingIndex=t.bindingRootIndex=n,cv(e)}function cv(n){Nt.lFrame.currentDirectiveIndex=n}function nC(){return Nt.lFrame.currentQueryIndex}function hv(n){Nt.lFrame.currentQueryIndex=n}function nF(n){const e=n[1];return 2===e.type?e.declTNode:1===e.type?n[6]:null}function rC(n,e,t){if(t&Pe.SkipSelf){let i=e,o=n;for(;!(i=i.parent,null!==i||t&Pe.Host||(i=nF(o),null===i||(o=o[15],10&i.type))););if(null===i)return!1;e=i,n=o}const r=Nt.lFrame=iC();return r.currentTNode=e,r.lView=n,!0}function yg(n){const e=iC(),t=n[1];Nt.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function iC(){const n=Nt.lFrame,e=null===n?null:n.child;return null===e?oC(n):e}function oC(n){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=e),e}function sC(){const n=Nt.lFrame;return Nt.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const aC=sC;function xg(){const n=sC();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function yo(){return Nt.lFrame.selectedIndex}function ic(n){Nt.lFrame.selectedIndex=n}function zr(){const n=Nt.lFrame;return iv(n.tView,n.selectedIndex)}function bg(n,e){for(let t=e.directiveStart,r=e.directiveEnd;t<r;t++){const o=n.data[t].type.prototype,{ngAfterContentInit:s,ngAfterContentChecked:a,ngAfterViewInit:u,ngAfterViewChecked:c,ngOnDestroy:d}=o;s&&(n.contentHooks||(n.contentHooks=[])).push(-t,s),a&&((n.contentHooks||(n.contentHooks=[])).push(t,a),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(t,a)),u&&(n.viewHooks||(n.viewHooks=[])).push(-t,u),c&&((n.viewHooks||(n.viewHooks=[])).push(t,c),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(t,c)),null!=d&&(n.destroyHooks||(n.destroyHooks=[])).push(t,d)}}function wg(n,e,t){uC(n,e,3,t)}function _g(n,e,t,r){(3&n[2])===t&&uC(n,e,t,r)}function dv(n,e){let t=n[2];(3&t)===e&&(t&=2047,t+=1,n[2]=t)}function uC(n,e,t,r){const o=null!=r?r:-1,s=e.length-1;let a=0;for(let u=void 0!==r?65535&n[18]:0;u<s;u++)if("number"==typeof e[u+1]){if(a=e[u],null!=r&&a>=r)break}else e[u]<0&&(n[18]+=65536),(a<o||-1==o)&&(hF(n,t,e,u),n[18]=(4294901760&n[18])+u+2),u++}function hF(n,e,t,r){const i=t[r]<0,o=t[r+1],a=n[i?-t[r]:t[r]];if(i){if(n[2]>>11<n[18]>>16&&(3&n[2])===e){n[2]+=2048;try{o.call(a)}finally{}}}else try{o.call(a)}finally{}}class Wd{constructor(e,t,r){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=r}}function Cg(n,e,t){const r=Dn(n);let i=0;for(;i<t.length;){const o=t[i];if("number"==typeof o){if(0!==o)break;i++;const s=t[i++],a=t[i++],u=t[i++];r?n.setAttribute(e,a,u,s):e.setAttributeNS(s,a,u)}else{const s=o,a=t[++i];pv(s)?r&&n.setProperty(e,s,a):r?n.setAttribute(e,s,a):e.setAttribute(s,a),i++}}return i}function cC(n){return 3===n||4===n||6===n}function pv(n){return 64===n.charCodeAt(0)}function Eg(n,e){if(null!==e&&0!==e.length)if(null===n||0===n.length)n=e.slice();else{let t=-1;for(let r=0;r<e.length;r++){const i=e[r];"number"==typeof i?t=i:0===t||lC(n,t,i,null,-1===t||2===t?e[++r]:null)}}return n}function lC(n,e,t,r,i){let o=0,s=n.length;if(-1===e)s=-1;else for(;o<n.length;){const a=n[o++];if("number"==typeof a){if(a===e){s=-1;break}if(a>e){s=o-1;break}}}for(;o<n.length;){const a=n[o];if("number"==typeof a)break;if(a===t){if(null===r)return void(null!==i&&(n[o+1]=i));if(r===n[o+1])return void(n[o+2]=i)}o++,null!==r&&o++,null!==i&&o++}-1!==s&&(n.splice(s,0,e),o=s+1),n.splice(o++,0,t),null!==r&&n.splice(o++,0,r),null!==i&&n.splice(o++,0,i)}function hC(n){return-1!==n}function eh(n){return 32767&n}function th(n,e){let t=function(n){return n>>16}(n),r=e;for(;t>0;)r=r[15],t--;return r}let gv=!0;function Ig(n){const e=gv;return gv=n,e}let vF=0;function zd(n,e){const t=vv(n,e);if(-1!==t)return t;const r=e[1];r.firstCreatePass&&(n.injectorIndex=e.length,mv(r.data,n),mv(e,null),mv(r.blueprint,null));const i=Ag(n,e),o=n.injectorIndex;if(hC(i)){const s=eh(i),a=th(i,e),u=a[1].data;for(let c=0;c<8;c++)e[o+c]=a[s+c]|u[s+c]}return e[o+8]=i,o}function mv(n,e){n.push(0,0,0,0,0,0,0,0,e)}function vv(n,e){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===e[n.injectorIndex+8]?-1:n.injectorIndex}function Ag(n,e){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let t=0,r=null,i=e;for(;null!==i;){const o=i[1],s=o.type;if(r=2===s?o.declTNode:1===s?i[6]:null,null===r)return-1;if(t++,i=i[15],-1!==r.injectorIndex)return r.injectorIndex|t<<16}return-1}function Dg(n,e,t){!function(n,e,t){let r;"string"==typeof t?r=t.charCodeAt(0)||0:t.hasOwnProperty(ce)&&(r=t[ce]),null==r&&(r=t[ce]=vF++);const i=255&r;e.data[n+(i>>5)]|=1<<i}(n,e,t)}function pC(n,e,t){if(t&Pe.Optional)return n;jr(e,"NodeInjector")}function gC(n,e,t,r){if(t&Pe.Optional&&void 0===r&&(r=null),0==(t&(Pe.Self|Pe.Host))){const i=n[9],o=z(void 0);try{return i?i.get(e,r,t&Pe.Optional):at(e,r,t&Pe.Optional)}finally{z(o)}}return pC(r,e,t)}function mC(n,e,t,r=Pe.Default,i){if(null!==n){const o=function(n){if("string"==typeof n)return n.charCodeAt(0)||0;const e=n.hasOwnProperty(ce)?n[ce]:void 0;return"number"==typeof e?e>=0?255&e:bF:e}(t);if("function"==typeof o){if(!rC(e,n,r))return r&Pe.Host?pC(i,t,r):gC(e,t,r,i);try{const s=o(r);if(null!=s||r&Pe.Optional)return s;jr(t)}finally{aC()}}else if("number"==typeof o){let s=null,a=vv(n,e),u=-1,c=r&Pe.Host?e[16][6]:null;for((-1===a||r&Pe.SkipSelf)&&(u=-1===a?Ag(n,e):e[a+8],-1!==u&&xC(r,!1)?(s=e[1],a=eh(u),e=th(u,e)):a=-1);-1!==a;){const d=e[1];if(yC(o,a,d.data)){const p=wF(a,e,t,s,r,c);if(p!==vC)return p}u=e[a+8],-1!==u&&xC(r,e[1].data[a+8]===c)&&yC(o,a,e)?(s=d,a=eh(u),e=th(u,e)):a=-1}}}return gC(e,t,r,i)}const vC={};function bF(){return new nh(vi(),De())}function wF(n,e,t,r,i,o){const s=e[1],a=s.data[n+8],d=Sg(a,s,t,null==r?Vs(a)&&gv:r!=s&&0!=(3&a.type),i&Pe.Host&&o===a);return null!==d?Gd(e,s,d,a):vC}function Sg(n,e,t,r,i){const o=n.providerIndexes,s=e.data,a=1048575&o,u=n.directiveStart,d=o>>20,m=i?a+d:n.directiveEnd;for(let y=r?a:a+d;y<m;y++){const w=s[y];if(y<u&&t===w||y>=u&&w.type===t)return y}if(i){const y=s[u];if(y&&Go(y)&&y.type===t)return u}return null}function Gd(n,e,t,r){let i=n[t];const o=e.data;if(function(n){return n instanceof Wd}(i)){const s=i;s.resolving&&function(n,e){throw new fn("200",`Circular dependency in DI detected for ${n}`)}(gr(o[t]));const a=Ig(s.canSeeViewProviders);s.resolving=!0;const u=s.injectImpl?z(s.injectImpl):null;rC(n,r,Pe.Default);try{i=n[t]=s.factory(void 0,o,n,r),e.firstCreatePass&&t>=r.directiveStart&&function(n,e,t){const{ngOnChanges:r,ngOnInit:i,ngDoCheck:o}=e.type.prototype;if(r){const s=D(e);(t.preOrderHooks||(t.preOrderHooks=[])).push(n,s),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,s)}i&&(t.preOrderHooks||(t.preOrderHooks=[])).push(0-n,i),o&&((t.preOrderHooks||(t.preOrderHooks=[])).push(n,o),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,o))}(t,o[t],e)}finally{null!==u&&z(u),Ig(a),s.resolving=!1,aC()}}return i}function yC(n,e,t){return!!(t[e+(n>>5)]&1<<n)}function xC(n,e){return!(n&Pe.Self||n&Pe.Host&&e)}class nh{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,r){return mC(this._tNode,this._lView,e,r,t)}}function yv(n){return Dr(()=>{const e=n.prototype.constructor,t=e[Q]||xv(e),r=Object.prototype;let i=Object.getPrototypeOf(n.prototype).constructor;for(;i&&i!==r;){const o=i[Q]||xv(i);if(o&&o!==t)return o;i=Object.getPrototypeOf(i)}return o=>new o})}function xv(n){return $i(n)?()=>{const e=xv(He(n));return e&&e()}:x(n)}const ih="__parameters__";function Xc(n,e,t){return Dr(()=>{const r=function(n){return function(...t){if(n){const r=n(...t);for(const i in r)this[i]=r[i]}}}(e);function i(...o){if(this instanceof i)return r.apply(this,o),this;const s=new i(...o);return a.annotation=s,a;function a(u,c,d){const p=u.hasOwnProperty(ih)?u[ih]:Object.defineProperty(u,ih,{value:[]})[ih];for(;p.length<=d;)p.push(null);return(p[d]=p[d]||[]).push(s),u}}return t&&(i.prototype=Object.create(t.prototype)),i.prototype.ngMetadataName=n,i.annotationCls=i,i})}class Vn{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Ve({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}toString(){return`InjectionToken ${this._desc}`}}const IF=new Vn("AnalyzeForEntryComponents"),Tg=Function;function cs(n,e){void 0===e&&(e=n);for(let t=0;t<n.length;t++){let r=n[t];Array.isArray(r)?(e===n&&(e=n.slice(0,t)),cs(r,e)):e!==n&&e.push(r)}return e}function Ta(n,e){n.forEach(t=>Array.isArray(t)?Ta(t,e):e(t))}function Rg(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function qc(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}function qo(n,e,t){let r=sh(n,e);return r>=0?n[1|r]=t:(r=~r,function(n,e,t,r){let i=n.length;if(i==e)n.push(t,r);else if(1===i)n.push(r,n[0]),n[0]=t;else{for(i--,n.push(n[i-1],n[i]);i>e;)n[i]=n[i-2],i--;n[e]=t,n[e+1]=r}}(n,r,e,t)),r}function wv(n,e){const t=sh(n,e);if(t>=0)return n[1|t]}function sh(n,e){return function(n,e,t){let r=0,i=n.length>>t;for(;i!==r;){const o=r+(i-r>>1),s=n[o<<t];if(e===s)return o<<t;s>e?i=o:r=o+1}return~(i<<t)}(n,e,1)}const Kd={},Cv="__NG_DI_FLAG__",ah="ngTempTokenPath",PF=/\n/gm,Ev="__source",Iv=cn({provide:String,useValue:cn});let Qd;function uh(n){const e=Qd;return Qd=n,e}function LF(n,e=Pe.Default){if(void 0===Qd)throw new Error("inject() must be called from an injection context");return null===Qd?at(n,void 0,e):Qd.get(n,e&Pe.Optional?null:void 0,e)}function Ye(n,e=Pe.Default){return(Ir||LF)(He(n),e)}function $c(n){const e=[];for(let t=0;t<n.length;t++){const r=He(n[t]);if(Array.isArray(r)){if(0===r.length)throw new Error("Arguments array must have arguments.");let i,o=Pe.Default;for(let s=0;s<r.length;s++){const a=r[s],u=BF(a);"number"==typeof u?-1===u?i=a.token:o|=u:i=a}e.push(Ye(i,o))}else e.push(Ye(r))}return e}function Zd(n,e){return n[Cv]=e,n.prototype[Cv]=e,n}function BF(n){return n[Cv]}function IC(n,e,t,r){const i=n[ah];throw e[Ev]&&i.unshift(e[Ev]),n.message=function(n,e,t,r=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.substr(2):n;let i=yt(e);if(Array.isArray(e))i=e.map(yt).join(" -> ");else if("object"==typeof e){let o=[];for(let s in e)if(e.hasOwnProperty(s)){let a=e[s];o.push(s+":"+("string"==typeof a?JSON.stringify(a):yt(a)))}i=`{${o.join(", ")}}`}return`${t}${r?"("+r+")":""}[${i}]: ${n.replace(PF,"\n  ")}`}("\n"+n.message,i,t,r),n.ngTokenPath=i,n[ah]=null,n}const ch=Zd(Xc("Inject",n=>({token:n})),-1),Mo=Zd(Xc("Optional"),8),ac=Zd(Xc("SkipSelf"),4);class Kc{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function $o(n){return n instanceof Kc?n.changingThisBreaksApplicationSecurity:n}function Ma(n,e){const t=function(n){return n instanceof Kc&&n.getTypeName()||null}(n);if(null!=t&&t!==e){if("ResourceURL"===t&&"URL"===e)return!0;throw new Error(`Required a safe ${e}, got a ${t} (see https://g.co/ng/security#xss)`)}return t===e}const uL=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,cL=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;var ir=(()=>((ir=ir||{})[ir.NONE=0]="NONE",ir[ir.HTML=1]="HTML",ir[ir.STYLE=2]="STYLE",ir[ir.SCRIPT=3]="SCRIPT",ir[ir.URL=4]="URL",ir[ir.RESOURCE_URL=5]="RESOURCE_URL",ir))();function Bg(n){const e=function(){const n=De();return n&&n[12]}();return e?e.sanitize(ir.URL,n)||"":Ma(n,"URL")?$o(n):function(n){return(n=String(n)).match(uL)||n.match(cL)?n:"unsafe:"+n}(ht(n))}const zC="__ngContext__";function eo(n,e){n[zC]=e}function kv(n){const e=function(n){return n[zC]||null}(n);return e?Array.isArray(e)?e:e.lView:null}function Vg(n){return n.ngOriginalError}function RL(n,...e){n.error(...e)}class Qc{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e),r=this._findContext(e),i=function(n){return n&&n.ngErrorLogger||RL}(e);i(this._console,"ERROR",e),t&&i(this._console,"ORIGINAL ERROR",t),r&&i(this._console,"ERROR CONTEXT",r)}_findContext(e){return e?function(n){return n.ngDebugContext}(e)||this._findContext(Vg(e)):null}_findOriginalError(e){let t=e&&Vg(e);for(;t&&Vg(t);)t=Vg(t);return t||null}}const JC=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Zt))();function Na(n){return n instanceof Function?n():n}var Ko=(()=>((Ko=Ko||{})[Ko.Important=1]="Important",Ko[Ko.DashCase=2]="DashCase",Ko))();function Lv(n,e){return undefined(n,e)}function of(n){const e=n[3];return So(e)?e[3]:e}function Bv(n){return iE(n[13])}function Vv(n){return iE(n[4])}function iE(n){for(;null!==n&&!So(n);)n=n[4];return n}function fh(n,e,t,r,i){if(null!=r){let o,s=!1;So(r)?o=r:zo(r)&&(s=!0,r=r[0]);const a=Sn(r);0===n&&null!==t?null==i?lE(e,t,a):Zc(e,t,a,i||null,!0):1===n&&null!==t?Zc(e,t,a,i||null,!0):2===n?function(n,e,t){const r=jg(n,e);r&&function(n,e,t,r){Dn(n)?n.removeChild(e,t,r):e.removeChild(t)}(n,r,e,t)}(e,a,s):3===n&&e.destroyNode(a),null!=o&&function(n,e,t,r,i){const o=t[7];o!==Sn(t)&&fh(e,n,r,o,i);for(let a=10;a<t.length;a++){const u=t[a];sf(u[1],u,n,e,r,o)}}(e,n,o,t,i)}}function jv(n,e,t){return Dn(n)?n.createElement(e,t):null===t?n.createElement(e):n.createElementNS(t,e)}function sE(n,e){const t=n[9],r=t.indexOf(e),i=e[3];1024&e[2]&&(e[2]&=-1025,sv(i,-1)),t.splice(r,1)}function Wv(n,e){if(n.length<=10)return;const t=10+e,r=n[t];if(r){const i=r[17];null!==i&&i!==n&&sE(i,r),e>0&&(n[t-1][4]=r[4]);const o=qc(n,10+e);!function(n,e){sf(n,e,e[11],2,null,null),e[0]=null,e[6]=null}(r[1],r);const s=o[19];null!==s&&s.detachView(o[1]),r[3]=null,r[4]=null,r[2]&=-129}return r}function aE(n,e){if(!(256&e[2])){const t=e[11];Dn(t)&&t.destroyNode&&sf(n,e,t,3,null,null),function(n){let e=n[13];if(!e)return Hv(n[1],n);for(;e;){let t=null;if(zo(e))t=e[13];else{const r=e[10];r&&(t=r)}if(!t){for(;e&&!e[4]&&e!==n;)zo(e)&&Hv(e[1],e),e=e[3];null===e&&(e=n),zo(e)&&Hv(e[1],e),t=e&&e[4]}e=t}}(e)}}function Hv(n,e){if(!(256&e[2])){e[2]&=-129,e[2]|=256,function(n,e){let t;if(null!=n&&null!=(t=n.destroyHooks))for(let r=0;r<t.length;r+=2){const i=e[t[r]];if(!(i instanceof Wd)){const o=t[r+1];if(Array.isArray(o))for(let s=0;s<o.length;s+=2){const a=i[o[s]],u=o[s+1];try{u.call(a)}finally{}}else try{o.call(i)}finally{}}}}(n,e),function(n,e){const t=n.cleanup,r=e[7];let i=-1;if(null!==t)for(let o=0;o<t.length-1;o+=2)if("string"==typeof t[o]){const s=t[o+1],a="function"==typeof s?s(e):Sn(e[s]),u=r[i=t[o+2]],c=t[o+3];"boolean"==typeof c?a.removeEventListener(t[o],u,c):c>=0?r[i=c]():r[i=-c].unsubscribe(),o+=2}else{const s=r[i=t[o+1]];t[o].call(s)}if(null!==r){for(let o=i+1;o<r.length;o++)r[o]();e[7]=null}}(n,e),1===e[1].type&&Dn(e[11])&&e[11].destroy();const t=e[17];if(null!==t&&So(e[3])){t!==e[3]&&sE(t,e);const r=e[19];null!==r&&r.detachView(n)}}}function uE(n,e,t){return function(n,e,t){let r=e;for(;null!==r&&40&r.type;)r=(e=r).parent;if(null===r)return t[0];if(2&r.flags){const i=n.data[r.directiveStart].encapsulation;if(i===We.None||i===We.Emulated)return null}return To(r,t)}(n,e.parent,t)}function Zc(n,e,t,r,i){Dn(n)?n.insertBefore(e,t,r,i):e.insertBefore(t,r,i)}function lE(n,e,t){Dn(n)?n.appendChild(e,t):e.appendChild(t)}function hE(n,e,t,r,i){null!==r?Zc(n,e,t,r,i):lE(n,e,t)}function jg(n,e){return Dn(n)?n.parentNode(e):e.parentNode}let pE=function(n,e,t){return 40&n.type?To(n,t):null};function Wg(n,e,t,r){const i=uE(n,r,e),o=e[11],a=function(n,e,t){return pE(n,e,t)}(r.parent||e[6],r,e);if(null!=i)if(Array.isArray(t))for(let u=0;u<t.length;u++)hE(o,i,t[u],a,!1);else hE(o,i,t,a,!1)}function Hg(n,e){if(null!==e){const t=e.type;if(3&t)return To(e,n);if(4&t)return Gv(-1,n[e.index]);if(8&t){const r=e.child;if(null!==r)return Hg(n,r);{const i=n[e.index];return So(i)?Gv(-1,i):Sn(i)}}if(32&t)return Lv(e,n)()||Sn(n[e.index]);{const r=mE(n,e);return null!==r?Array.isArray(r)?r[0]:Hg(of(n[16]),r):Hg(n,e.next)}}return null}function mE(n,e){return null!==e?n[16][6].projection[e.projection]:null}function Gv(n,e){const t=10+n+1;if(t<e.length){const r=e[t],i=r[1].firstChild;if(null!==i)return Hg(r,i)}return e[7]}function Yv(n,e,t,r,i,o,s){for(;null!=t;){const a=r[t.index],u=t.type;if(s&&0===e&&(a&&eo(Sn(a),r),t.flags|=4),64!=(64&t.flags))if(8&u)Yv(n,e,t.child,r,i,o,!1),fh(e,n,i,a,o);else if(32&u){const c=Lv(t,r);let d;for(;d=c();)fh(e,n,i,d,o);fh(e,n,i,a,o)}else 16&u?yE(n,e,r,t,i,o):fh(e,n,i,a,o);t=s?t.projectionNext:t.next}}function sf(n,e,t,r,i,o){Yv(t,r,n.firstChild,e,i,o,!1)}function yE(n,e,t,r,i,o){const s=t[16],u=s[6].projection[r.projection];if(Array.isArray(u))for(let c=0;c<u.length;c++)fh(e,n,i,u[c],o);else Yv(n,e,u,s[3],i,o,!0)}function xE(n,e,t){Dn(n)?n.setAttribute(e,"style",t):e.style.cssText=t}function Xv(n,e,t){Dn(n)?""===t?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t):e.className=t}function bE(n,e,t){let r=n.length;for(;;){const i=n.indexOf(e,t);if(-1===i)return i;if(0===i||n.charCodeAt(i-1)<=32){const o=e.length;if(i+o===r||n.charCodeAt(i+o)<=32)return i}t=i+1}}const wE="ng-template";function r8(n,e,t){let r=0;for(;r<n.length;){let i=n[r++];if(t&&"class"===i){if(i=n[r],-1!==bE(i.toLowerCase(),e,0))return!0}else if(1===i){for(;r<n.length&&"string"==typeof(i=n[r++]);)if(i.toLowerCase()===e)return!0;return!1}}return!1}function _E(n){return 4===n.type&&n.value!==wE}function i8(n,e,t){return e===(4!==n.type||t?n.value:wE)}function o8(n,e,t){let r=4;const i=n.attrs||[],o=function(n){for(let e=0;e<n.length;e++)if(cC(n[e]))return e;return n.length}(i);let s=!1;for(let a=0;a<e.length;a++){const u=e[a];if("number"!=typeof u){if(!s)if(4&r){if(r=2|1&r,""!==u&&!i8(n,u,t)||""===u&&1===e.length){if(Ws(r))return!1;s=!0}}else{const c=8&r?u:e[++a];if(8&r&&null!==n.attrs){if(!r8(n.attrs,c,t)){if(Ws(r))return!1;s=!0}continue}const p=s8(8&r?"class":u,i,_E(n),t);if(-1===p){if(Ws(r))return!1;s=!0;continue}if(""!==c){let m;m=p>o?"":i[p+1].toLowerCase();const y=8&r?m:null;if(y&&-1!==bE(y,c,0)||2&r&&c!==m){if(Ws(r))return!1;s=!0}}}}else{if(!s&&!Ws(r)&&!Ws(u))return!1;if(s&&Ws(u))continue;s=!1,r=u|1&r}}return Ws(r)||s}function Ws(n){return 0==(1&n)}function s8(n,e,t,r){if(null===e)return-1;let i=0;if(r||!t){let o=!1;for(;i<e.length;){const s=e[i];if(s===n)return i;if(3===s||6===s)o=!0;else{if(1===s||2===s){let a=e[++i];for(;"string"==typeof a;)a=e[++i];continue}if(4===s)break;if(0===s){i+=4;continue}}i+=o?1:2}return-1}return function(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){const r=n[t];if("number"==typeof r)return-1;if(r===e)return t;t++}return-1}(e,n)}function CE(n,e,t=!1){for(let r=0;r<e.length;r++)if(o8(n,e[r],t))return!0;return!1}function EE(n,e){return n?":not("+e.trim()+")":e}function h8(n){let e=n[0],t=1,r=2,i="",o=!1;for(;t<n.length;){let s=n[t];if("string"==typeof s)if(2&r){const a=n[++t];i+="["+s+(a.length>0?'="'+a+'"':"")+"]"}else 8&r?i+="."+s:4&r&&(i+=" "+s);else""!==i&&!Ws(s)&&(e+=EE(o,i),i=""),r=s,o=o||!Ws(r);t++}return""!==i&&(e+=EE(o,i)),e}const Ft={};function wt(n){IE(Tn(),De(),yo()+n,mg())}function IE(n,e,t,r){if(!r)if(3==(3&e[2])){const o=n.preOrderCheckHooks;null!==o&&wg(e,o,t)}else{const o=n.preOrderHooks;null!==o&&_g(e,o,0,t)}ic(t)}function zg(n,e){return n<<17|e<<2}function Hs(n){return n>>17&32767}function qv(n){return 2|n}function au(n){return(131068&n)>>2}function $v(n,e){return-131069&n|e<<2}function Kv(n){return 1|n}function PE(n,e){const t=n.contentQueries;if(null!==t)for(let r=0;r<t.length;r+=2){const i=t[r],o=t[r+1];if(-1!==o){const s=n.data[o];hv(i),s.contentQueries(2,e[o],o)}}}function af(n,e,t,r,i,o,s,a,u,c){const d=e.blueprint.slice();return d[0]=i,d[2]=140|r,Q_(d),d[3]=d[15]=n,d[8]=t,d[10]=s||n&&n[10],d[11]=a||n&&n[11],d[12]=u||n&&n[12]||null,d[9]=c||n&&n[9]||null,d[6]=o,d[16]=2==e.type?n[16]:d,d}function ph(n,e,t,r,i){let o=n.data[e];if(null===o)o=function(n,e,t,r,i){const o=J_(),s=av(),u=n.data[e]=function(n,e,t,r,i,o){return{type:t,index:r,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:i,attrs:o,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,s?o:o&&o.parent,t,e,r,i);return null===n.firstChild&&(n.firstChild=u),null!==o&&(s?null==o.child&&null!==u.parent&&(o.child=u):null===o.next&&(o.next=u)),u}(n,e,t,r,i),Nt.lFrame.inI18n&&(o.flags|=64);else if(64&o.type){o.type=t,o.value=r,o.attrs=i;const s=function(){const n=Nt.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}();o.injectorIndex=null===s?-1:s.injectorIndex}return Da(o,!0),o}function gh(n,e,t,r){if(0===t)return-1;const i=e.length;for(let o=0;o<t;o++)e.push(r),n.blueprint.push(r),n.data.push(null);return i}function uf(n,e,t){yg(e);try{const r=n.viewQuery;null!==r&&dy(1,r,t);const i=n.template;null!==i&&FE(n,e,i,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&PE(n,e),n.staticViewQueries&&dy(2,n.viewQuery,t);const o=n.components;null!==o&&function(n,e){for(let t=0;t<e.length;t++)z8(n,e[t])}(e,o)}catch(r){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),r}finally{e[2]&=-5,xg()}}function mh(n,e,t,r){const i=e[2];if(256==(256&i))return;yg(e);const o=mg();try{Q_(e),function(n){Nt.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==t&&FE(n,e,t,2,r);const s=3==(3&i);if(!o)if(s){const c=n.preOrderCheckHooks;null!==c&&wg(e,c,null)}else{const c=n.preOrderHooks;null!==c&&_g(e,c,0,null),dv(e,0)}if(function(n){for(let e=Bv(n);null!==e;e=Vv(e)){if(!e[2])continue;const t=e[9];for(let r=0;r<t.length;r++){const i=t[r],o=i[3];0==(1024&i[2])&&sv(o,1),i[2]|=1024}}}(e),function(n){for(let e=Bv(n);null!==e;e=Vv(e))for(let t=10;t<e.length;t++){const r=e[t],i=r[1];ov(r)&&mh(i,r,i.template,r[8])}}(e),null!==n.contentQueries&&PE(n,e),!o)if(s){const c=n.contentCheckHooks;null!==c&&wg(e,c)}else{const c=n.contentHooks;null!==c&&_g(e,c,1),dv(e,1)}!function(n,e){const t=n.hostBindingOpCodes;if(null!==t)try{for(let r=0;r<t.length;r++){const i=t[r];if(i<0)ic(~i);else{const o=i,s=t[++r],a=t[++r];eF(s,o),a(2,e[o])}}}finally{ic(-1)}}(n,e);const a=n.components;null!==a&&function(n,e){for(let t=0;t<e.length;t++)H8(n,e[t])}(e,a);const u=n.viewQuery;if(null!==u&&dy(2,u,r),!o)if(s){const c=n.viewCheckHooks;null!==c&&wg(e,c)}else{const c=n.viewHooks;null!==c&&_g(e,c,2),dv(e,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),o||(e[2]&=-73),1024&e[2]&&(e[2]&=-1025,sv(e[3],-1))}finally{xg()}}function E8(n,e,t,r){const i=e[10],o=!mg(),s=K_(e);try{o&&!s&&i.begin&&i.begin(),s&&uf(n,e,r),mh(n,e,t,r)}finally{o&&!s&&i.end&&i.end()}}function FE(n,e,t,r,i){const o=yo(),s=2&r;try{ic(-1),s&&e.length>20&&IE(n,e,20,mg()),t(r,i)}finally{ic(o)}}function LE(n,e,t){if(Vd(e)){const i=e.directiveEnd;for(let o=e.directiveStart;o<i;o++){const s=n.data[o];s.contentQueries&&s.contentQueries(1,t[o],o)}}}function iy(n,e,t){!Z_()||(function(n,e,t,r){const i=t.directiveStart,o=t.directiveEnd;n.firstCreatePass||zd(t,e),eo(r,e);const s=t.initialInputs;for(let a=i;a<o;a++){const u=n.data[a],c=Go(u);c&&B8(e,t,u);const d=Gd(e,n,a,t);eo(d,e),null!==s&&V8(0,a-i,d,u,0,s),c&&(Xo(t.index,e)[8]=d)}}(n,e,t,To(t,e)),128==(128&t.flags)&&function(n,e,t){const r=t.directiveStart,i=t.directiveEnd,s=t.index,a=Nt.lFrame.currentDirectiveIndex;try{ic(s);for(let u=r;u<i;u++){const c=n.data[u],d=e[u];cv(u),(null!==c.hostBindings||0!==c.hostVars||null!==c.hostAttrs)&&GE(c,d)}}finally{ic(-1),cv(a)}}(n,e,t))}function oy(n,e,t=To){const r=e.localNames;if(null!==r){let i=e.index+1;for(let o=0;o<r.length;o+=2){const s=r[o+1],a=-1===s?t(e,n):n[s];n[i++]=a}}}function BE(n){const e=n.tView;return null===e||e.incompleteFirstPass?n.tView=Xg(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):e}function Xg(n,e,t,r,i,o,s,a,u,c){const d=20+r,p=d+i,m=function(n,e){const t=[];for(let r=0;r<e;r++)t.push(r<n?null:Ft);return t}(d,p),y="function"==typeof c?c():c;return m[1]={type:n,blueprint:m,template:t,queries:null,viewQuery:a,declTNode:e,data:m.slice().fill(null,d),bindingStartIndex:d,expandoStartIndex:p,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof o?o():o,pipeRegistry:"function"==typeof s?s():s,firstChild:null,schemas:u,consts:y,incompleteFirstPass:!1}}function jE(n,e,t,r){const i=QE(e);null===t?i.push(r):(i.push(t),n.firstCreatePass&&ZE(n).push(r,i.length-1))}function WE(n,e,t){for(let r in n)if(n.hasOwnProperty(r)){const i=n[r];(t=null===t?{}:t).hasOwnProperty(r)?t[r].push(e,i):t[r]=[e,i]}return t}function Qo(n,e,t,r,i,o,s,a){const u=To(e,t);let d,c=e.inputs;!a&&null!=c&&(d=c[r])?(tI(n,t,d,r,i),Vs(e)&&function(n,e){const t=Xo(e,n);16&t[2]||(t[2]|=64)}(t,e.index)):3&e.type&&(r=function(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(r),i=null!=s?s(i,e.value||"",r):i,Dn(o)?o.setProperty(u,r,i):pv(r)||(u.setProperty?u.setProperty(r,i):u[r]=i))}function sy(n,e,t,r){let i=!1;if(Z_()){const o=function(n,e,t){const r=n.directiveRegistry;let i=null;if(r)for(let o=0;o<r.length;o++){const s=r[o];CE(t,s.selectors,!1)&&(i||(i=[]),Dg(zd(t,e),n,s.type),Go(s)?(YE(n,t),i.unshift(s)):i.push(s))}return i}(n,e,t),s=null===r?null:{"":-1};if(null!==o){i=!0,XE(t,n.data.length,o.length);for(let d=0;d<o.length;d++){const p=o[d];p.providersResolver&&p.providersResolver(p)}let a=!1,u=!1,c=gh(n,e,o.length,null);for(let d=0;d<o.length;d++){const p=o[d];t.mergedAttrs=Eg(t.mergedAttrs,p.hostAttrs),qE(n,t,e,c,p),L8(c,p,s),null!==p.contentQueries&&(t.flags|=8),(null!==p.hostBindings||null!==p.hostAttrs||0!==p.hostVars)&&(t.flags|=128);const m=p.type.prototype;!a&&(m.ngOnChanges||m.ngOnInit||m.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(t.index),a=!0),!u&&(m.ngOnChanges||m.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t.index),u=!0),c++}!function(n,e){const r=e.directiveEnd,i=n.data,o=e.attrs,s=[];let a=null,u=null;for(let c=e.directiveStart;c<r;c++){const d=i[c],p=d.inputs,m=null===o||_E(e)?null:U8(p,o);s.push(m),a=WE(p,c,a),u=WE(d.outputs,c,u)}null!==a&&(a.hasOwnProperty("class")&&(e.flags|=16),a.hasOwnProperty("style")&&(e.flags|=32)),e.initialInputs=s,e.inputs=a,e.outputs=u}(n,t)}s&&function(n,e,t){if(e){const r=n.localNames=[];for(let i=0;i<e.length;i+=2){const o=t[e[i+1]];if(null==o)throw new fn("301",`Export of name '${e[i+1]}' not found!`);r.push(e[i],o)}}}(t,r,s)}return t.mergedAttrs=Eg(t.mergedAttrs,t.attrs),i}function zE(n,e,t,r,i,o){const s=o.hostBindings;if(s){let a=n.hostBindingOpCodes;null===a&&(a=n.hostBindingOpCodes=[]);const u=~e.index;(function(n){let e=n.length;for(;e>0;){const t=n[--e];if("number"==typeof t&&t<0)return t}return 0})(a)!=u&&a.push(u),a.push(r,i,s)}}function GE(n,e){null!==n.hostBindings&&n.hostBindings(1,e)}function YE(n,e){e.flags|=2,(n.components||(n.components=[])).push(e.index)}function L8(n,e,t){if(t){if(e.exportAs)for(let r=0;r<e.exportAs.length;r++)t[e.exportAs[r]]=n;Go(e)&&(t[""]=n)}}function XE(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}function qE(n,e,t,r,i){n.data[r]=i;const o=i.factory||(i.factory=x(i.type)),s=new Wd(o,Go(i),null);n.blueprint[r]=s,t[r]=s,zE(n,e,0,r,gh(n,t,i.hostVars,Ft),i)}function B8(n,e,t){const r=To(e,n),i=BE(t),o=n[10],s=qg(n,af(n,i,null,t.onPush?64:16,r,e,o,o.createRenderer(r,t),null,null));n[e.index]=s}function Oa(n,e,t,r,i,o){const s=To(n,e);!function(n,e,t,r,i,o,s){if(null==o)Dn(n)?n.removeAttribute(e,i,t):e.removeAttribute(i);else{const a=null==s?ht(o):s(o,r||"",i);Dn(n)?n.setAttribute(e,i,a,t):t?e.setAttributeNS(t,i,a):e.setAttribute(i,a)}}(e[11],s,o,n.value,t,r,i)}function V8(n,e,t,r,i,o){const s=o[e];if(null!==s){const a=r.setInput;for(let u=0;u<s.length;){const c=s[u++],d=s[u++],p=s[u++];null!==a?r.setInput(t,p,c,d):t[d]=p}}}function U8(n,e){let t=null,r=0;for(;r<e.length;){const i=e[r];if(0!==i)if(5!==i){if("number"==typeof i)break;n.hasOwnProperty(i)&&(null===t&&(t=[]),t.push(i,n[i],e[r+1])),r+=2}else r+=2;else r+=4}return t}function $E(n,e,t,r){return new Array(n,!0,!1,e,null,0,r,t,null,null)}function H8(n,e){const t=Xo(e,n);if(ov(t)){const r=t[1];80&t[2]?mh(r,t,r.template,t[8]):t[5]>0&&uy(t)}}function uy(n){for(let r=Bv(n);null!==r;r=Vv(r))for(let i=10;i<r.length;i++){const o=r[i];if(1024&o[2]){const s=o[1];mh(s,o,s.template,o[8])}else o[5]>0&&uy(o)}const t=n[1].components;if(null!==t)for(let r=0;r<t.length;r++){const i=Xo(t[r],n);ov(i)&&i[5]>0&&uy(i)}}function z8(n,e){const t=Xo(e,n),r=t[1];(function(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])})(r,t),uf(r,t,t[8])}function qg(n,e){return n[13]?n[14][4]=e:n[13]=e,n[14]=e,e}function cy(n){for(;n;){n[2]|=64;const e=of(n);if(Gc(n)&&!e)return n;n=e}return null}function hy(n,e,t){const r=e[10];r.begin&&r.begin();try{mh(n,e,n.template,t)}catch(i){throw eI(e,i),i}finally{r.end&&r.end()}}function KE(n){!function(n){for(let e=0;e<n.components.length;e++){const t=n.components[e],r=kv(t),i=r[1];E8(i,r,i.template,t)}}(n[8])}function dy(n,e,t){hv(0),e(n,t)}const $8=(()=>Promise.resolve(null))();function QE(n){return n[7]||(n[7]=[])}function ZE(n){return n.cleanup||(n.cleanup=[])}function eI(n,e){const t=n[9],r=t?t.get(Qc,null):null;r&&r.handleError(e)}function tI(n,e,t,r,i){for(let o=0;o<t.length;){const s=t[o++],a=t[o++],u=e[s],c=n.data[s];null!==c.setInput?c.setInput(u,i,r,a):u[a]=i}}function cu(n,e,t){const r=Ql(e,n);!function(n,e,t){Dn(n)?n.setValue(e,t):e.textContent=t}(n[11],r,t)}function $g(n,e,t){let r=t?n.styles:null,i=t?n.classes:null,o=0;if(null!==e)for(let s=0;s<e.length;s++){const a=e[s];"number"==typeof a?o=a:1==o?i=ri(i,a):2==o&&(r=ri(r,a+": "+e[++s]+";"))}t?n.styles=r:n.stylesWithoutHost=r,t?n.classes=i:n.classesWithoutHost=i}const vh=new Vn("INJECTOR",-1);class nI{get(e,t=Kd){if(t===Kd){const r=new Error(`NullInjectorError: No provider for ${yt(e)}!`);throw r.name="NullInjectorError",r}return t}}const cf=new Vn("Set Injector scope."),lf={},Z8={};let fy;function rI(){return void 0===fy&&(fy=new nI),fy}function iI(n,e=null,t=null,r){return new e6(n,t,e||rI(),r)}class e6{constructor(e,t,r,i=null){this.parent=r,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const o=[];t&&Ta(t,a=>this.processProvider(a,e,t)),Ta([e],a=>this.processInjectorType(a,[],o)),this.records.set(vh,yh(void 0,this));const s=this.records.get(cf);this.scope=null!=s?s.value:null,this.source=i||("object"==typeof e?null:yt(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,t=Kd,r=Pe.Default){this.assertNotDestroyed();const i=uh(this),o=z(void 0);try{if(!(r&Pe.SkipSelf)){let a=this.records.get(e);if(void 0===a){const u=function(n){return"function"==typeof n||"object"==typeof n&&n instanceof Vn}(e)&&Ki(e);a=u&&this.injectableDefInScope(u)?yh(py(e),lf):null,this.records.set(e,a)}if(null!=a)return this.hydrate(e,a)}return(r&Pe.Self?rI():this.parent).get(e,t=r&Pe.Optional&&t===Kd?null:t)}catch(s){if("NullInjectorError"===s.name){if((s[ah]=s[ah]||[]).unshift(yt(e)),i)throw s;return IC(s,e,"R3InjectorError",this.source)}throw s}finally{z(o),uh(i)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((r,i)=>e.push(yt(i))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(e,t,r){if(!(e=He(e)))return!1;let i=jc(e);const o=null==i&&e.ngModule||void 0,s=void 0===o?e:o,a=-1!==r.indexOf(s);if(void 0!==o&&(i=jc(o)),null==i)return!1;if(null!=i.imports&&!a){let d;r.push(s);try{Ta(i.imports,p=>{this.processInjectorType(p,t,r)&&(void 0===d&&(d=[]),d.push(p))})}finally{}if(void 0!==d)for(let p=0;p<d.length;p++){const{ngModule:m,providers:y}=d[p];Ta(y,w=>this.processProvider(w,m,y||ln))}}this.injectorDefTypes.add(s);const u=x(s)||(()=>new s);this.records.set(s,yh(u,lf));const c=i.providers;if(null!=c&&!a){const d=e;Ta(c,p=>this.processProvider(p,d,c))}return void 0!==o&&void 0!==e.providers}processProvider(e,t,r){let i=xh(e=He(e))?e:He(e&&e.provide);const o=function(n,e,t){return sI(n)?yh(void 0,n.useValue):yh(function(n,e,t){let r;if(xh(n)){const i=He(n);return x(i)||py(i)}if(sI(n))r=()=>He(n.useValue);else if(function(n){return!(!n||!n.useFactory)}(n))r=()=>n.useFactory(...$c(n.deps||[]));else if(function(n){return!(!n||!n.useExisting)}(n))r=()=>Ye(He(n.useExisting));else{const i=He(n&&(n.useClass||n.provide));if(!function(n){return!!n.deps}(n))return x(i)||py(i);r=()=>new i(...$c(n.deps))}return r}(n),lf)}(e);if(xh(e)||!0!==e.multi)this.records.get(i);else{let s=this.records.get(i);s||(s=yh(void 0,lf,!0),s.factory=()=>$c(s.multi),this.records.set(i,s)),i=e,s.multi.push(e)}this.records.set(i,o)}hydrate(e,t){return t.value===lf&&(t.value=Z8,t.value=t.factory()),"object"==typeof t.value&&t.value&&function(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(t.value)&&this.onDestroy.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=He(e.providedIn);return"string"==typeof t?"any"===t||t===this.scope:this.injectorDefTypes.has(t)}}function py(n){const e=Ki(n),t=null!==e?e.factory:x(n);if(null!==t)return t;if(n instanceof Vn)throw new Error(`Token ${yt(n)} is missing a \u0275prov definition.`);if(n instanceof Function)return function(n){const e=n.length;if(e>0){const r=function(n,e){const t=[];for(let r=0;r<n;r++)t.push(e);return t}(e,"?");throw new Error(`Can't resolve all parameters for ${yt(n)}: (${r.join(", ")}).`)}const t=function(n){const e=n&&(n[er]||n[Wc]);if(e){const t=function(n){if(n.hasOwnProperty("name"))return n.name;const e=(""+n).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${t}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${t}" class.`),e}return null}(n);return null!==t?()=>t.factory(n):()=>new n}(n);throw new Error("unreachable")}function yh(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function sI(n){return null!==n&&"object"==typeof n&&Iv in n}function xh(n){return"function"==typeof n}const aI=function(n,e,t){return function(n,e=null,t=null,r){const i=iI(n,e,t,r);return i._resolveInjectorDefTypes(),i}({name:t},e,n,t)};let Yn=(()=>{class n{static create(t,r){return Array.isArray(t)?aI(t,r,""):aI(t.providers,t.parent,t.name||"")}}return n.THROW_IF_NOT_FOUND=Kd,n.NULL=new nI,n.\u0275prov=Ve({token:n,providedIn:"any",factory:()=>Ye(vh)}),n.__NG_ELEMENT_ID__=-1,n})();function w6(n,e){bg(kv(n)[1],vi())}function df(n){let e=function(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),t=!0;const r=[n];for(;e;){let i;if(Go(n))i=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new Error("Directives cannot inherit Components");i=e.\u0275dir}if(i){if(t){r.push(i);const s=n;s.inputs=by(n.inputs),s.declaredInputs=by(n.declaredInputs),s.outputs=by(n.outputs);const a=i.hostBindings;a&&I6(n,a);const u=i.viewQuery,c=i.contentQueries;if(u&&C6(n,u),c&&E6(n,c),$u(n.inputs,i.inputs),$u(n.declaredInputs,i.declaredInputs),$u(n.outputs,i.outputs),Go(i)&&i.data.animation){const d=n.data;d.animation=(d.animation||[]).concat(i.data.animation)}}const o=i.features;if(o)for(let s=0;s<o.length;s++){const a=o[s];a&&a.ngInherit&&a(n),a===df&&(t=!1)}}e=Object.getPrototypeOf(e)}!function(n){let e=0,t=null;for(let r=n.length-1;r>=0;r--){const i=n[r];i.hostVars=e+=i.hostVars,i.hostAttrs=Eg(i.hostAttrs,t=Eg(t,i.hostAttrs))}}(r)}function by(n){return n===Ca?{}:n===ln?[]:n}function C6(n,e){const t=n.viewQuery;n.viewQuery=t?(r,i)=>{e(r,i),t(r,i)}:e}function E6(n,e){const t=n.contentQueries;n.contentQueries=t?(r,i,o)=>{e(r,i,o),t(r,i,o)}:e}function I6(n,e){const t=n.hostBindings;n.hostBindings=t?(r,i)=>{e(r,i),t(r,i)}:e}let Kg=null;function bh(){if(!Kg){const n=Zt.Symbol;if(n&&n.iterator)Kg=n.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const r=e[t];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(Kg=r)}}}return Kg}class Gs{constructor(e){this.wrapped=e}static wrap(e){return new Gs(e)}static unwrap(e){return Gs.isWrapped(e)?e.wrapped:e}static isWrapped(e){return e instanceof Gs}}function ff(n){return!!wy(n)&&(Array.isArray(n)||!(n instanceof Map)&&bh()in n)}function wy(n){return null!==n&&("function"==typeof n||"object"==typeof n)}function ka(n,e,t){return n[e]=t}function to(n,e,t){return!Object.is(n[e],t)&&(n[e]=t,!0)}function Jc(n,e,t,r){const i=to(n,e,t);return to(n,e+1,r)||i}function _y(n,e,t,r){const i=De();return to(i,Jl(),e)&&(Tn(),Oa(zr(),i,n,e,t,r)),_y}function _h(n,e,t,r){return to(n,Jl(),t)?e+ht(t)+r:Ft}function Eh(n,e,t,r,i,o,s,a){const c=function(n,e,t,r,i){const o=Jc(n,e,t,r);return to(n,e+2,i)||o}(n,Sa(),t,i,s);return su(3),c?e+ht(t)+r+ht(i)+o+ht(s)+a:Ft}function Mn(n,e,t,r,i,o,s,a){const u=De(),c=Tn(),d=n+20,p=c.firstCreatePass?function(n,e,t,r,i,o,s,a,u){const c=e.consts,d=ph(e,n,4,s||null,rc(c,a));sy(e,t,d,rc(c,u)),bg(e,d);const p=d.tViews=Xg(2,d,r,i,o,e.directiveRegistry,e.pipeRegistry,null,e.schemas,c);return null!==e.queries&&(e.queries.template(e,d),p.queries=e.queries.embeddedTView(d)),d}(d,c,u,e,t,r,i,o,s):c.data[d];Da(p,!1);const m=u[11].createComment("");Wg(c,u,m,p),eo(m,u),qg(u,u[d]=$E(m,u,m,p)),tc(p)&&iy(c,u,p),null!=s&&oy(u,p,a)}function hu(n){return Zl(Nt.lFrame.contextLView,20+n)}function ut(n,e=Pe.Default){const t=De();return null===t?Ye(n,e):mC(vi(),t,He(n),e)}function _t(n,e,t){const r=De();return to(r,Jl(),e)&&Qo(Tn(),zr(),r,n,e,r[11],t,!1),_t}function Dy(n,e,t,r,i){const s=i?"class":"style";tI(n,t,e.inputs[s],s,r)}function rt(n,e,t,r){const i=De(),o=Tn(),s=20+n,a=i[11],u=i[s]=jv(a,e,Nt.lFrame.currentNamespace),c=o.firstCreatePass?function(n,e,t,r,i,o,s){const a=e.consts,c=ph(e,n,2,i,rc(a,o));return sy(e,t,c,rc(a,s)),null!==c.attrs&&$g(c,c.attrs,!1),null!==c.mergedAttrs&&$g(c,c.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,c),c}(s,o,i,0,e,t,r):o.data[s];Da(c,!0);const d=c.mergedAttrs;null!==d&&Cg(a,u,d);const p=c.classes;null!==p&&Xv(a,u,p);const m=c.styles;null!==m&&xE(a,u,m),64!=(64&c.flags)&&Wg(o,i,u,c),0===Nt.lFrame.elementDepthCount&&eo(u,i),Nt.lFrame.elementDepthCount++,tc(c)&&(iy(o,i,c),LE(o,c,i)),null!==r&&oy(i,c)}function it(){let n=vi();av()?uv():(n=n.parent,Da(n,!1));const e=n;Nt.lFrame.elementDepthCount--;const t=Tn();t.firstCreatePass&&(bg(t,n),Vd(n)&&t.queries.elementEnd(n)),null!=e.classesWithoutHost&&function(n){return 0!=(16&n.flags)}(e)&&Dy(t,e,De(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function(n){return 0!=(32&n.flags)}(e)&&Dy(t,e,De(),e.stylesWithoutHost,!1)}function yr(n,e,t,r){rt(n,e,t,r),it()}function lc(n,e,t){const r=De(),i=Tn(),o=n+20,s=i.firstCreatePass?function(n,e,t,r,i){const o=e.consts,s=rc(o,r),a=ph(e,n,8,"ng-container",s);return null!==s&&$g(a,s,!0),sy(e,t,a,rc(o,i)),null!==e.queries&&e.queries.elementStart(e,a),a}(o,i,r,e,t):i.data[o];Da(s,!0);const a=r[o]=r[11].createComment("");Wg(i,r,a,s),eo(a,r),tc(s)&&(iy(i,r,s),LE(i,s,r)),null!=t&&oy(r,s)}function hc(){let n=vi();const e=Tn();av()?uv():(n=n.parent,Da(n,!1)),e.firstCreatePass&&(bg(e,n),Vd(n)&&e.queries.elementEnd(n))}function Ri(){return De()}function Jg(n){return!!n&&"function"==typeof n.then}function GI(n){return!!n&&"function"==typeof n.subscribe}const Sy=GI;function Qn(n,e,t,r){const i=De(),o=Tn(),s=vi();return function(n,e,t,r,i,o,s,a){const u=tc(r),d=n.firstCreatePass&&ZE(n),p=e[8],m=QE(e);let y=!0;if(3&r.type||a){const _=To(r,e),A=a?a(_):_,T=m.length,N=a?M=>a(Sn(M[r.index])):r.index;if(Dn(t)){let M=null;if(!a&&u&&(M=function(n,e,t,r){const i=n.cleanup;if(null!=i)for(let o=0;o<i.length-1;o+=2){const s=i[o];if(s===t&&i[o+1]===r){const a=e[7],u=i[o+2];return a.length>u?a[u]:null}"string"==typeof s&&(o+=2)}return null}(n,e,i,r.index)),null!==M)(M.__ngLastListenerFn__||M).__ngNextListenerFn__=o,M.__ngLastListenerFn__=o,y=!1;else{o=Ty(r,e,p,o,!1);const O=t.listen(A,i,o);m.push(o,O),d&&d.push(i,N,T,T+1)}}else o=Ty(r,e,p,o,!0),A.addEventListener(i,o,s),m.push(o),d&&d.push(i,N,T,s)}else o=Ty(r,e,p,o,!1);const w=r.outputs;let C;if(y&&null!==w&&(C=w[i])){const _=C.length;if(_)for(let A=0;A<_;A+=2){const L=e[C[A]][C[A+1]].subscribe(o),V=m.length;m.push(o,L),d&&d.push(i,r.index,V,-(V+1))}}}(o,i,i[11],s,n,e,!!t,r),Qn}function qI(n,e,t,r){try{return!1!==t(r)}catch(i){return eI(n,i),!1}}function Ty(n,e,t,r,i){return function o(s){if(s===Function)return r;const a=2&n.flags?Xo(n.index,e):e;0==(32&e[2])&&cy(a);let u=qI(e,0,r,s),c=o.__ngNextListenerFn__;for(;c;)u=qI(e,0,c,s)&&u,c=c.__ngNextListenerFn__;return i&&!1===u&&(s.preventDefault(),s.returnValue=!1),u}}function gn(n=1){return function(n){return(Nt.lFrame.contextLView=function(n,e){for(;n>0;)e=e[15],n--;return e}(n,Nt.lFrame.contextLView))[8]}(n)}function iA(n,e,t,r,i){const o=n[t+1],s=null===e;let a=r?Hs(o):au(o),u=!1;for(;0!==a&&(!1===u||s);){const d=n[a+1];hB(n[a],e)&&(u=!0,n[a+1]=r?Kv(d):qv(d)),a=r?Hs(d):au(d)}u&&(n[t+1]=r?qv(o):Kv(o))}function hB(n,e){return null===n||null==e||(Array.isArray(n)?n[1]:n)===e||!(!Array.isArray(n)||"string"!=typeof e)&&sh(n,e)>=0}const xi={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function oA(n){return n.substring(xi.key,xi.keyEnd)}function dB(n){return n.substring(xi.value,xi.valueEnd)}function aA(n,e){const t=xi.textEnd;let r=xi.key=Rh(n,e,t);return t===r?-1:(r=xi.keyEnd=function(n,e,t){let r;for(;e<t&&(45===(r=n.charCodeAt(e))||95===r||(-33&r)>=65&&(-33&r)<=90||r>=48&&r<=57);)e++;return e}(n,r,t),r=cA(n,r,t),r=xi.value=Rh(n,r,t),r=xi.valueEnd=function(n,e,t){let r=-1,i=-1,o=-1,s=e,a=s;for(;s<t;){const u=n.charCodeAt(s++);if(59===u)return a;34===u||39===u?a=s=lA(n,u,s,t):e===s-4&&85===o&&82===i&&76===r&&40===u?a=s=lA(n,41,s,t):u>32&&(a=s),o=i,i=r,r=-33&u}return a}(n,r,t),cA(n,r,t))}function Rh(n,e,t){for(;e<t&&n.charCodeAt(e)<=32;)e++;return e}function cA(n,e,t,r){return(e=Rh(n,e,t))<t&&e++,e}function lA(n,e,t,r){let i=-1,o=t;for(;o<r;){const s=n.charCodeAt(o++);if(s==e&&92!==i)return o;i=92==s&&92===i?0:s}throw new Error}function Pa(n,e){return function(n,e,t,r){const i=De(),o=Tn(),s=su(2);o.firstUpdatePass&&fA(o,n,s,r),e!==Ft&&to(i,s,e)&&gA(o,o.data[yo()],i,i[11],n,i[s+1]=function(n,e){return null==n||("string"==typeof e?n+=e:"object"==typeof n&&(n=yt($o(n)))),n}(e,t),r,s)}(n,e,null,!0),Pa}function Fa(n){!function(n,e,t,r){const i=Tn(),o=su(2);i.firstUpdatePass&&fA(i,null,o,r);const s=De();if(t!==Ft&&to(s,o,t)){const a=i.data[yo()];if(vA(a,r)&&!dA(i,o)){let u=r?a.classesWithoutHost:a.stylesWithoutHost;null!==u&&(t=ri(u,t||"")),Dy(i,a,s,t,r)}else!function(n,e,t,r,i,o,s,a){i===Ft&&(i=ln);let u=0,c=0,d=0<i.length?i[0]:null,p=0<o.length?o[0]:null;for(;null!==d||null!==p;){const m=u<i.length?i[u+1]:void 0,y=c<o.length?o[c+1]:void 0;let C,w=null;d===p?(u+=2,c+=2,m!==y&&(w=p,C=y)):null===p||null!==d&&d<p?(u+=2,w=d):(c+=2,w=p,C=y),null!==w&&gA(n,e,t,r,w,C,s,a),d=u<i.length?i[u]:null,p=c<o.length?o[c]:null}}(i,a,s,s[11],s[o+1],s[o+1]=function(n,e,t){if(null==t||""===t)return ln;const r=[],i=$o(t);if(Array.isArray(i))for(let o=0;o<i.length;o++)n(r,i[o],!0);else if("object"==typeof i)for(const o in i)i.hasOwnProperty(o)&&n(r,o,i[o]);else"string"==typeof i&&e(r,i);return r}(n,e,t),r,o)}}(pA,yB,n,!1)}function yB(n,e){for(let t=function(n){return function(n){xi.key=0,xi.keyEnd=0,xi.value=0,xi.valueEnd=0,xi.textEnd=n.length}(n),aA(n,Rh(n,0,xi.textEnd))}(e);t>=0;t=aA(e,t))pA(n,oA(e),dB(e))}function dA(n,e){return e>=n.expandoStartIndex}function fA(n,e,t,r){const i=n.data;if(null===i[t+1]){const o=i[yo()],s=dA(n,t);vA(o,r)&&null===e&&!s&&(e=!1),e=function(n,e,t,r){const i=function(n){const e=Nt.lFrame.currentDirectiveIndex;return-1===e?null:n[e]}(n);let o=r?e.residualClasses:e.residualStyles;if(null===i)0===(r?e.classBindings:e.styleBindings)&&(t=gf(t=Ry(null,n,e,t,r),e.attrs,r),o=null);else{const s=e.directiveStylingLast;if(-1===s||n[s]!==i)if(t=Ry(i,n,e,t,r),null===o){let u=function(n,e,t){const r=t?e.classBindings:e.styleBindings;if(0!==au(r))return n[Hs(r)]}(n,e,r);void 0!==u&&Array.isArray(u)&&(u=Ry(null,n,e,u[1],r),u=gf(u,e.attrs,r),function(n,e,t,r){n[Hs(t?e.classBindings:e.styleBindings)]=r}(n,e,r,u))}else o=function(n,e,t){let r;const i=e.directiveEnd;for(let o=1+e.directiveStylingLast;o<i;o++)r=gf(r,n[o].hostAttrs,t);return gf(r,e.attrs,t)}(n,e,r)}return void 0!==o&&(r?e.residualClasses=o:e.residualStyles=o),t}(i,o,e,r),function(n,e,t,r,i,o){let s=o?e.classBindings:e.styleBindings,a=Hs(s),u=au(s);n[r]=t;let d,c=!1;if(Array.isArray(t)){const p=t;d=p[1],(null===d||sh(p,d)>0)&&(c=!0)}else d=t;if(i)if(0!==u){const m=Hs(n[a+1]);n[r+1]=zg(m,a),0!==m&&(n[m+1]=$v(n[m+1],r)),n[a+1]=function(n,e){return 131071&n|e<<17}(n[a+1],r)}else n[r+1]=zg(a,0),0!==a&&(n[a+1]=$v(n[a+1],r)),a=r;else n[r+1]=zg(u,0),0===a?a=r:n[u+1]=$v(n[u+1],r),u=r;c&&(n[r+1]=qv(n[r+1])),iA(n,d,r,!0),iA(n,d,r,!1),function(n,e,t,r,i){const o=i?n.residualClasses:n.residualStyles;null!=o&&"string"==typeof e&&sh(o,e)>=0&&(t[r+1]=Kv(t[r+1]))}(e,d,n,r,o),s=zg(a,u),o?e.classBindings=s:e.styleBindings=s}(i,o,e,t,s,r)}}function Ry(n,e,t,r,i){let o=null;const s=t.directiveEnd;let a=t.directiveStylingLast;for(-1===a?a=t.directiveStart:a++;a<s&&(o=e[a],r=gf(r,o.hostAttrs,i),o!==n);)a++;return null!==n&&(t.directiveStylingLast=a),r}function gf(n,e,t){const r=t?1:2;let i=-1;if(null!==e)for(let o=0;o<e.length;o++){const s=e[o];"number"==typeof s?i=s:i===r&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),qo(n,s,!!t||e[++o]))}return void 0===n?null:n}function pA(n,e,t){qo(n,e,$o(t))}function gA(n,e,t,r,i,o,s,a){if(!(3&e.type))return;const u=n.data,c=u[a+1];e0(function(n){return 1==(1&n)}(c)?mA(u,e,t,i,au(c),s):void 0)||(e0(o)||function(n){return 2==(2&n)}(c)&&(o=mA(u,null,t,i,a,s)),function(n,e,t,r,i){const o=Dn(n);if(e)i?o?n.addClass(t,r):t.classList.add(r):o?n.removeClass(t,r):t.classList.remove(r);else{let s=-1===r.indexOf("-")?void 0:Ko.DashCase;if(null==i)o?n.removeStyle(t,r,s):t.style.removeProperty(r);else{const a="string"==typeof i&&i.endsWith("!important");a&&(i=i.slice(0,-10),s|=Ko.Important),o?n.setStyle(t,r,i,s):t.style.setProperty(r,i,a?"important":"")}}}(r,s,Ql(yo(),t),i,o))}function mA(n,e,t,r,i,o){const s=null===e;let a;for(;i>0;){const u=n[i],c=Array.isArray(u),d=c?u[1]:u,p=null===d;let m=t[i+1];m===Ft&&(m=p?ln:void 0);let y=p?wv(m,r):d===r?m:void 0;if(c&&!e0(y)&&(y=wv(u,r)),e0(y)&&(a=y,s))return a;const w=n[i+1];i=s?Hs(w):au(w)}if(null!==e){let u=o?e.residualClasses:e.residualStyles;null!=u&&(a=wv(u,r))}return a}function e0(n){return void 0!==n}function vA(n,e){return 0!=(n.flags&(e?16:32))}function xn(n,e=""){const t=De(),r=Tn(),i=n+20,o=r.firstCreatePass?ph(r,i,1,e,null):r.data[i],s=t[i]=function(n,e){return Dn(n)?n.createText(e):n.createTextNode(e)}(t[11],e);Wg(r,t,s,o),Da(o,!1)}function mf(n){return Nh("",n,""),mf}function Nh(n,e,t){const r=De(),i=_h(r,n,e,t);return i!==Ft&&cu(r,yo(),i),Nh}function Ny(n,e,t,r,i,o,s){const a=De(),u=Eh(a,n,e,t,r,i,o,s);return u!==Ft&&cu(a,yo(),u),Ny}function t0(n,e,t){Fa(_h(De(),n,e,t))}function Oy(n,e,t){const r=De();return to(r,Jl(),e)&&Qo(Tn(),zr(),r,n,e,r[11],t,!0),Oy}const el=void 0;var GB=["en",[["a","p"],["AM","PM"],el],[["AM","PM"],el,el],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],el,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],el,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",el,"{1} 'at' {0}",el],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(n){const e=Math.floor(Math.abs(n)),t=n.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===t?1:5}];let Oh={};function bo(n){const e=function(n){return n.toLowerCase().replace(/_/g,"-")}(n);let t=FA(e);if(t)return t;const r=e.split("-")[0];if(t=FA(r),t)return t;if("en"===r)return GB;throw new Error(`Missing locale data for the locale "${n}".`)}function FA(n){return n in Oh||(Oh[n]=Zt.ng&&Zt.ng.common&&Zt.ng.common.locales&&Zt.ng.common.locales[n]),Oh[n]}var Ge=(()=>((Ge=Ge||{})[Ge.LocaleId=0]="LocaleId",Ge[Ge.DayPeriodsFormat=1]="DayPeriodsFormat",Ge[Ge.DayPeriodsStandalone=2]="DayPeriodsStandalone",Ge[Ge.DaysFormat=3]="DaysFormat",Ge[Ge.DaysStandalone=4]="DaysStandalone",Ge[Ge.MonthsFormat=5]="MonthsFormat",Ge[Ge.MonthsStandalone=6]="MonthsStandalone",Ge[Ge.Eras=7]="Eras",Ge[Ge.FirstDayOfWeek=8]="FirstDayOfWeek",Ge[Ge.WeekendRange=9]="WeekendRange",Ge[Ge.DateFormat=10]="DateFormat",Ge[Ge.TimeFormat=11]="TimeFormat",Ge[Ge.DateTimeFormat=12]="DateTimeFormat",Ge[Ge.NumberSymbols=13]="NumberSymbols",Ge[Ge.NumberFormats=14]="NumberFormats",Ge[Ge.CurrencyCode=15]="CurrencyCode",Ge[Ge.CurrencySymbol=16]="CurrencySymbol",Ge[Ge.CurrencyName=17]="CurrencyName",Ge[Ge.Currencies=18]="Currencies",Ge[Ge.Directionality=19]="Directionality",Ge[Ge.PluralCase=20]="PluralCase",Ge[Ge.ExtraData=21]="ExtraData",Ge))();const n0="en-US";let LA=n0;function ky(n){Mi(n,"Expected localeId to be defined"),"string"==typeof n&&(LA=n.toLowerCase().replace(/_/g,"-"))}class uD{}const lD="ngComponent";class Y5{resolveComponentFactory(e){throw function(n){const e=Error(`No component factory found for ${yt(n)}. Did you add it to @NgModule.entryComponents?`);return e[lD]=n,e}(e)}}let du=(()=>{class n{}return n.NULL=new Y5,n})();function a0(...n){}function Ph(n,e){return new bi(To(n,e))}const $5=function(){return Ph(vi(),De())};let bi=(()=>{class n{constructor(t){this.nativeElement=t}}return n.__NG_ELEMENT_ID__=$5,n})();function hD(n){return n instanceof bi?n.nativeElement:n}class u0{}let Wy=(()=>{class n{}return n.\u0275prov=Ve({token:n,providedIn:"root",factory:()=>null}),n})();class wf{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const dD=new wf("12.2.13");class fD{constructor(){}supports(e){return ff(e)}create(e){return new t7(e)}}const e7=(n,e)=>e;class t7{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||e7}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,r=this._removalsHead,i=0,o=null;for(;t||r;){const s=!r||t&&t.currentIndex<gD(r,i,o)?t:r,a=gD(s,i,o),u=s.currentIndex;if(s===r)i--,r=r._nextRemoved;else if(t=t._next,null==s.previousIndex)i++;else{o||(o=[]);const c=a-i,d=u-i;if(c!=d){for(let m=0;m<c;m++){const y=m<o.length?o[m]:o[m]=0,w=y+m;d<=w&&w<c&&(o[m]=y+1)}o[s.previousIndex]=d-c}}a!==u&&e(s,a,u)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!ff(e))throw new Error(`Error trying to diff '${yt(e)}'. Only arrays and iterables are allowed`);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let i,o,s,t=this._itHead,r=!1;if(Array.isArray(e)){this.length=e.length;for(let a=0;a<this.length;a++)o=e[a],s=this._trackByFn(a,o),null!==t&&Object.is(t.trackById,s)?(r&&(t=this._verifyReinsertion(t,o,s,a)),Object.is(t.item,o)||this._addIdentityChange(t,o)):(t=this._mismatch(t,o,s,a),r=!0),t=t._next}else i=0,function(n,e){if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else{const t=n[bh()]();let r;for(;!(r=t.next()).done;)e(r.value)}}(e,a=>{s=this._trackByFn(i,a),null!==t&&Object.is(t.trackById,s)?(r&&(t=this._verifyReinsertion(t,a,s,i)),Object.is(t.item,a)||this._addIdentityChange(t,a)):(t=this._mismatch(t,a,s,i),r=!0),t=t._next,i++}),this.length=i;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,r,i){let o;return null===e?o=this._itTail:(o=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,o,i)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(r,i))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,o,i)):e=this._addAfter(new n7(t,r),o,i),e}_verifyReinsertion(e,t,r,i){let o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==o?e=this._reinsertAfter(o,e._prev,i):e.currentIndex!=i&&(e.currentIndex=i,this._addToMoves(e,i)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const i=e._prevRemoved,o=e._nextRemoved;return null===i?this._removalsHead=o:i._nextRemoved=o,null===o?this._removalsTail=i:o._prevRemoved=i,this._insertAfter(e,t,r),this._addToMoves(e,r),e}_moveAfter(e,t,r){return this._unlink(e),this._insertAfter(e,t,r),this._addToMoves(e,r),e}_addAfter(e,t,r){return this._insertAfter(e,t,r),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,r){const i=null===t?this._itHead:t._next;return e._next=i,e._prev=t,null===i?this._itTail=e:i._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new pD),this._linkedRecords.put(e),e.currentIndex=r,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,r=e._next;return null===t?this._itHead=r:t._next=r,null===r?this._itTail=t:r._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new pD),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class n7{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class r7{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===t||t<=r.currentIndex)&&Object.is(r.trackById,e))return r;return null}remove(e){const t=e._prevDup,r=e._nextDup;return null===t?this._head=r:t._nextDup=r,null===r?this._tail=t:r._prevDup=t,null===this._head}}class pD{constructor(){this.map=new Map}put(e){const t=e.trackById;let r=this.map.get(t);r||(r=new r7,this.map.set(t,r)),r.add(e)}get(e,t){const i=this.map.get(e);return i?i.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function gD(n,e,t){const r=n.previousIndex;if(null===r)return r;let i=0;return t&&r<t.length&&(i=t[r]),r+e+i}class mD{constructor(){}supports(e){return e instanceof Map||wy(e)}create(){return new i7}}class i7{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let t;for(t=this._mapHead;null!==t;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}diff(e){if(e){if(!(e instanceof Map||wy(e)))throw new Error(`Error trying to diff '${yt(e)}'. Only maps and objects are allowed`)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(r,i)=>{if(t&&t.key===i)this._maybeAddToChanges(t,r),this._appendAfter=t,t=t._next;else{const o=this._getOrCreateRecordForKey(i,r);t=this._insertBeforeOrAppend(t,o)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let r=t;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){const r=e._prev;return t._next=e,t._prev=r,e._prev=t,r&&(r._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){const i=this._records.get(e);this._maybeAddToChanges(i,t);const o=i._prev,s=i._next;return o&&(o._next=s),s&&(s._prev=o),i._next=null,i._prev=null,i}const r=new o7(e);return this._records.set(e,r),r.currentValue=t,this._addToAdditions(r),r}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(r=>t(e[r],r))}}class o7{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function vD(){return new _f([new fD])}let _f=(()=>{class n{constructor(t){this.factories=t}static create(t,r){if(null!=r){const i=r.factories.slice();t=t.concat(i)}return new n(t)}static extend(t){return{provide:n,useFactory:r=>n.create(t,r||vD()),deps:[[n,new ac,new Mo]]}}find(t){const r=this.factories.find(i=>i.supports(t));if(null!=r)return r;throw new Error(`Cannot find a differ supporting object '${t}' of type '${function(n){return n.name||typeof n}(t)}'`)}}return n.\u0275prov=Ve({token:n,providedIn:"root",factory:vD}),n})();function yD(){return new Fh([new mD])}let Fh=(()=>{class n{constructor(t){this.factories=t}static create(t,r){if(r){const i=r.factories.slice();t=t.concat(i)}return new n(t)}static extend(t){return{provide:n,useFactory:r=>n.create(t,r||yD()),deps:[[n,new ac,new Mo]]}}find(t){const r=this.factories.find(i=>i.supports(t));if(r)return r;throw new Error(`Cannot find a differ supporting object '${t}'`)}}return n.\u0275prov=Ve({token:n,providedIn:"root",factory:yD}),n})();function l0(n,e,t,r,i=!1){for(;null!==t;){const o=e[t.index];if(null!==o&&r.push(Sn(o)),So(o))for(let a=10;a<o.length;a++){const u=o[a],c=u[1].firstChild;null!==c&&l0(u[1],u,c,r)}const s=t.type;if(8&s)l0(n,e,t.child,r);else if(32&s){const a=Lv(t,e);let u;for(;u=a();)r.push(u)}else if(16&s){const a=mE(e,t);if(Array.isArray(a))r.push(...a);else{const u=of(e[16]);l0(u[1],u,a,r,!0)}}t=i?t.projectionNext:t.next}return r}class Cf{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,t=e[1];return l0(t,e,t.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(So(e)){const t=e[8],r=t?t.indexOf(this):-1;r>-1&&(Wv(e,r),qc(t,r))}this._attachedToViewContainer=!1}aE(this._lView[1],this._lView)}onDestroy(e){jE(this._lView[1],this._lView,null,e)}markForCheck(){cy(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){hy(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(n,e,t){vg(!0);try{hy(n,e,t)}finally{vg(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function(n,e){sf(n,e,e[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}}class a7 extends Cf{constructor(e){super(e),this._view=e}detectChanges(){KE(this._view)}checkNoChanges(){!function(n){vg(!0);try{KE(n)}finally{vg(!1)}}(this._view)}get context(){return null}}const c7=function(n){return function(n,e,t){if(Vs(n)&&!t){const r=Xo(n.index,e);return new Cf(r,r)}return 47&n.type?new Cf(e[16],e):null}(vi(),De(),16==(16&n))};let Ef=(()=>{class n{}return n.__NG_ELEMENT_ID__=c7,n})();const d7=[new mD],p7=new _f([new fD]),g7=new Fh(d7),v7=function(){return h0(vi(),De())};let fu=(()=>{class n{}return n.__NG_ELEMENT_ID__=v7,n})();const y7=fu,x7=class extends y7{constructor(e,t,r){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=r}createEmbeddedView(e){const t=this._declarationTContainer.tViews,r=af(this._declarationLView,t,e,16,null,t.declTNode,null,null,null,null);r[17]=this._declarationLView[this._declarationTContainer.index];const o=this._declarationLView[19];return null!==o&&(r[19]=o.createEmbeddedView(t)),uf(t,r,e),new Cf(r)}};function h0(n,e){return 4&n.type?new x7(e,n,Ph(n,e)):null}class Ba{}class xD{}const _7=function(){return _D(vi(),De())};let qs=(()=>{class n{}return n.__NG_ELEMENT_ID__=_7,n})();const E7=qs,bD=class extends E7{constructor(e,t,r){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=r}get element(){return Ph(this._hostTNode,this._hostLView)}get injector(){return new nh(this._hostTNode,this._hostLView)}get parentInjector(){const e=Ag(this._hostTNode,this._hostLView);if(hC(e)){const t=th(e,this._hostLView),r=eh(e);return new nh(t[1].data[r+8],t)}return new nh(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=wD(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,t,r){const i=e.createEmbeddedView(t||{});return this.insert(i,r),i}createComponent(e,t,r,i,o){const s=r||this.parentInjector;if(!o&&null==e.ngModule&&s){const u=s.get(Ba,null);u&&(o=u)}const a=e.create(s,i,void 0,o);return this.insert(a.hostView,t),a}insert(e,t){const r=e._lView,i=r[1];if(function(n){return So(n[3])}(r)){const d=this.indexOf(e);if(-1!==d)this.detach(d);else{const p=r[3],m=new bD(p,p[6],p[3]);m.detach(m.indexOf(e))}}const o=this._adjustIndex(t),s=this._lContainer;!function(n,e,t,r){const i=10+r,o=t.length;r>0&&(t[i-1][4]=e),r<o-10?(e[4]=t[i],Rg(t,10+r,e)):(t.push(e),e[4]=null),e[3]=t;const s=e[17];null!==s&&t!==s&&function(n,e){const t=n[9];e[16]!==e[3][3][16]&&(n[2]=!0),null===t?n[9]=[e]:t.push(e)}(s,e);const a=e[19];null!==a&&a.insertView(n),e[2]|=128}(i,r,s,o);const a=Gv(o,s),u=r[11],c=jg(u,s[7]);return null!==c&&function(n,e,t,r,i,o){r[0]=i,r[6]=e,sf(n,r,t,1,i,o)}(i,s[6],u,r,c,a),e.attachToViewContainerRef(),Rg(Hy(s),o,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=wD(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),r=Wv(this._lContainer,t);r&&(qc(Hy(this._lContainer),t),aE(r[1],r))}detach(e){const t=this._adjustIndex(e,-1),r=Wv(this._lContainer,t);return r&&null!=qc(Hy(this._lContainer),t)?new Cf(r):null}_adjustIndex(e,t=0){return null==e?this.length+t:e}};function wD(n){return n[8]}function Hy(n){return n[8]||(n[8]=[])}function _D(n,e){let t;const r=e[n.index];if(So(r))t=r;else{let i;if(8&n.type)i=Sn(r);else{const o=e[11];i=o.createComment("");const s=To(n,e);Zc(o,jg(o,s),i,function(n,e){return Dn(n)?n.nextSibling(e):e.nextSibling}(o,s),!1)}e[n.index]=t=$E(r,e,i,n),qg(e,t)}return new bD(t,n,e)}const Uh={};class WD extends du{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=Pt(e);return new zD(t,this.ngModule)}}function HD(n){const e=[];for(let t in n)n.hasOwnProperty(t)&&e.push({propName:n[t],templateName:t});return e}const b9=new Vn("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>JC});class zD extends uD{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function(n){return n.map(h8).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return HD(this.componentDef.inputs)}get outputs(){return HD(this.componentDef.outputs)}create(e,t,r,i){const o=(i=i||this.ngModule)?function(n,e){return{get:(t,r,i)=>{const o=n.get(t,Uh,i);return o!==Uh||r===Uh?o:e.get(t,r,i)}}}(e,i.injector):e,s=o.get(u0,Gn),a=o.get(Wy,null),u=s.createRenderer(null,this.componentDef),c=this.componentDef.selectors[0][0]||"div",d=r?function(n,e,t){if(Dn(n))return n.selectRootElement(e,t===We.ShadowDom);let r="string"==typeof e?n.querySelector(e):e;return r.textContent="",r}(u,r,this.componentDef.encapsulation):jv(s.createRenderer(null,this.componentDef),c,function(n){const e=n.toLowerCase();return"svg"===e?"http://www.w3.org/2000/svg":"math"===e?"http://www.w3.org/1998/MathML/":null}(c)),p=this.componentDef.onPush?576:528,m=function(n,e){return{components:[],scheduler:n||JC,clean:$8,playerHandler:e||null,flags:0}}(),y=Xg(0,null,null,1,0,null,null,null,null,null),w=af(null,y,m,p,null,null,s,u,a,o);let C,_;yg(w);try{const A=function(n,e,t,r,i,o){const s=t[1];t[20]=n;const u=ph(s,20,2,"#host",null),c=u.mergedAttrs=e.hostAttrs;null!==c&&($g(u,c,!0),null!==n&&(Cg(i,n,c),null!==u.classes&&Xv(i,n,u.classes),null!==u.styles&&xE(i,n,u.styles)));const d=r.createRenderer(n,e),p=af(t,BE(e),null,e.onPush?64:16,t[20],u,r,d,o||null,null);return s.firstCreatePass&&(Dg(zd(u,t),s,e.type),YE(s,u),XE(u,t.length,1)),qg(t,p),t[20]=p}(d,this.componentDef,w,s,u);if(d)if(r)Cg(u,d,["ng-version",dD.full]);else{const{attrs:T,classes:N}=function(n){const e=[],t=[];let r=1,i=2;for(;r<n.length;){let o=n[r];if("string"==typeof o)2===i?""!==o&&e.push(o,n[++r]):8===i&&t.push(o);else{if(!Ws(i))break;i=o}r++}return{attrs:e,classes:t}}(this.componentDef.selectors[0]);T&&Cg(u,d,T),N&&N.length>0&&Xv(u,d,N.join(" "))}if(_=iv(y,20),void 0!==t){const T=_.projection=[];for(let N=0;N<this.ngContentSelectors.length;N++){const M=t[N];T.push(null!=M?Array.from(M):null)}}C=function(n,e,t,r,i){const o=t[1],s=function(n,e,t){const r=vi();n.firstCreatePass&&(t.providersResolver&&t.providersResolver(t),qE(n,r,e,gh(n,e,1,null),t));const i=Gd(e,n,r.directiveStart,r);eo(i,e);const o=To(r,e);return o&&eo(o,e),i}(o,t,e);if(r.components.push(s),n[8]=s,i&&i.forEach(u=>u(s,e)),e.contentQueries){const u=vi();e.contentQueries(1,s,u.directiveStart)}const a=vi();return!o.firstCreatePass||null===e.hostBindings&&null===e.hostAttrs||(ic(a.index),zE(t[1],a,0,a.directiveStart,a.directiveEnd,e),GE(e,s)),s}(A,this.componentDef,w,m,[w6]),uf(y,w,null)}finally{xg()}return new C9(this.componentType,C,Ph(_,w),w,_)}}class C9 extends class{}{constructor(e,t,r,i,o){super(),this.location=r,this._rootLView=i,this._tNode=o,this.instance=t,this.hostView=this.changeDetectorRef=new a7(i),this.componentType=e}get injector(){return new nh(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}const jh=new Map;class A9 extends Ba{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new WD(this);const r=Kn(e),i=function(n){return n[W]||null}(e);i&&ky(i),this._bootstrapComponents=Na(r.bootstrap),this._r3Injector=iI(e,t,[{provide:Ba,useValue:this},{provide:du,useValue:this.componentFactoryResolver}],yt(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,t=Yn.THROW_IF_NOT_FOUND,r=Pe.Default){return e===Yn||e===Ba||e===vh?this:this._r3Injector.get(e,t,r)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class nx extends xD{constructor(e){super(),this.moduleType=e,null!==Kn(e)&&function(n){const e=new Set;!function t(r){const i=Kn(r,!0),o=i.id;null!==o&&(function(n,e,t){if(e&&e!==t)throw new Error(`Duplicate module registered for ${n} - ${yt(e)} vs ${yt(e.name)}`)}(o,jh.get(o),r),jh.set(o,r));const s=Na(i.imports);for(const a of s)e.has(a)||(e.add(a),t(a))}(n)}(e)}create(e){return new A9(this.moduleType,e)}}function Nf(n,e){const t=n[e];return t===Ft?void 0:t}function Wh(n,e){const t=Tn();let r;const i=n+20;t.firstCreatePass?(r=function(n,e){if(e)for(let t=e.length-1;t>=0;t--){const r=e[t];if(n===r.name)return r}throw new fn("302",`The pipe '${n}' could not be found!`)}(e,t.pipeRegistry),t.data[i]=r,r.onDestroy&&(t.destroyHooks||(t.destroyHooks=[])).push(i,r.onDestroy)):r=t.data[i];const o=r.factory||(r.factory=x(r.type)),s=z(ut);try{const a=Ig(!1),u=o();return Ig(a),function(n,e,t,r){t>=n.data.length&&(n.data[t]=null,n.blueprint[t]=null),e[t]=r}(t,De(),i,u),u}finally{z(s)}}function ZD(n,e,t){const r=n+20,i=De(),o=Zl(i,r);return Pf(i,kf(i,r)?function(n,e,t,r,i,o){const s=e+t;return to(n,s,i)?ka(n,s+1,o?r.call(o,i):r(i)):Nf(n,s+1)}(i,vo(),e,o.transform,t,o):o.transform(t))}function Of(n,e,t,r){const i=n+20,o=De(),s=Zl(o,i);return Pf(o,kf(o,i)?function(n,e,t,r,i,o,s){const a=e+t;return Jc(n,a,i,o)?ka(n,a+2,s?r.call(s,i,o):r(i,o)):Nf(n,a+2)}(o,vo(),e,s.transform,t,r,s):s.transform(t,r))}function kf(n,e){return n[1].data[e].pure}function Pf(n,e){return Gs.isWrapped(e)&&(e=Gs.unwrap(e),n[Sa()]=Ft),e}function rx(n){return e=>{setTimeout(n,void 0,e)}}const ii=class extends ie{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,r){var i,o,s;let a=e,u=t||(()=>null),c=r;if(e&&"object"==typeof e){const p=e;a=null===(i=p.next)||void 0===i?void 0:i.bind(p),u=null===(o=p.error)||void 0===o?void 0:o.bind(p),c=null===(s=p.complete)||void 0===s?void 0:s.bind(p)}this.__isAsync&&(u=rx(u),a&&(a=rx(a)),c&&(c=rx(c)));const d=super.subscribe({next:a,error:u,complete:c});return e instanceof At&&e.add(d),d}};function W9(){return this._results[bh()]()}class m0{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=bh(),r=m0.prototype;r[t]||(r[t]=W9)}get changes(){return this._changes||(this._changes=new ii)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const r=this;r.dirty=!1;const i=cs(e);(this._changesDetected=!function(n,e,t){if(n.length!==e.length)return!1;for(let r=0;r<n.length;r++){let i=n[r],o=e[r];if(t&&(i=t(i),o=t(o)),o!==i)return!1}return!0}(r._results,i,t))&&(r._results=i,r.length=i.length,r.last=i[this.length-1],r.first=i[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;class ix{constructor(e){this.queryList=e,this.matches=null}clone(){return new ix(this.queryList)}setDirty(){this.queryList.setDirty()}}class ox{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const r=null!==e.contentQueries?e.contentQueries[0]:t.length,i=[];for(let o=0;o<r;o++){const s=t.getByIndex(o);i.push(this.queries[s.indexInDeclarationView].clone())}return new ox(i)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==rS(e,t).matches&&this.queries[t].setDirty()}}class JD{constructor(e,t,r=null){this.predicate=e,this.flags=t,this.read=r}}class sx{constructor(e=[]){this.queries=e}elementStart(e,t){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let r=0;r<this.length;r++){const i=null!==t?t.length:0,o=this.getByIndex(r).embeddedTView(e,i);o&&(o.indexInDeclarationView=r,null!==t?t.push(o):t=[o])}return null!==t?new sx(t):null}template(e,t){for(let r=0;r<this.queries.length;r++)this.queries[r].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class ax{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new ax(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let r=e.parent;for(;null!==r&&8&r.type&&r.index!==t;)r=r.parent;return t===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const r=this.metadata.predicate;if(Array.isArray(r))for(let i=0;i<r.length;i++){const o=r[i];this.matchTNodeWithReadOption(e,t,G9(t,o)),this.matchTNodeWithReadOption(e,t,Sg(t,e,o,!1,!1))}else r===fu?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,Sg(t,e,r,!1,!1))}matchTNodeWithReadOption(e,t,r){if(null!==r){const i=this.metadata.read;if(null!==i)if(i===bi||i===qs||i===fu&&4&t.type)this.addMatch(t.index,-2);else{const o=Sg(t,e,i,!1,!1);null!==o&&this.addMatch(t.index,o)}else this.addMatch(t.index,r)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function G9(n,e){const t=n.localNames;if(null!==t)for(let r=0;r<t.length;r+=2)if(t[r]===e)return t[r+1];return null}function X9(n,e,t,r){return-1===t?function(n,e){return 11&n.type?Ph(n,e):4&n.type?h0(n,e):null}(e,n):-2===t?function(n,e,t){return t===bi?Ph(e,n):t===fu?h0(e,n):t===qs?_D(e,n):void 0}(n,e,r):Gd(n,n[1],t,e)}function eS(n,e,t,r){const i=e[19].queries[r];if(null===i.matches){const o=n.data,s=t.matches,a=[];for(let u=0;u<s.length;u+=2){const c=s[u];a.push(c<0?null:X9(e,o[c],s[u+1],t.metadata.read))}i.matches=a}return i.matches}function ux(n,e,t,r){const i=n.queries.getByIndex(t),o=i.matches;if(null!==o){const s=eS(n,e,i,t);for(let a=0;a<o.length;a+=2){const u=o[a];if(u>0)r.push(s[a/2]);else{const c=o[a+1],d=e[-u];for(let p=10;p<d.length;p++){const m=d[p];m[17]===m[3]&&ux(m[1],m,c,r)}if(null!==d[9]){const p=d[9];for(let m=0;m<p.length;m++){const y=p[m];ux(y[1],y,c,r)}}}}}return r}function rl(n){const e=De(),t=Tn(),r=nC();hv(r+1);const i=rS(t,r);if(n.dirty&&K_(e)===(2==(2&i.metadata.flags))){if(null===i.matches)n.reset([]);else{const o=i.crossesNgTemplate?ux(t,e,r,[]):eS(t,e,i,r);n.reset(o,hD),n.notifyOnChanges()}return!0}return!1}function Ff(n,e,t){const r=Tn();r.firstCreatePass&&(function(n,e,t){null===n.queries&&(n.queries=new sx),n.queries.track(new ax(e,t))}(r,new JD(n,e,t),-1),2==(2&e)&&(r.staticViewQueries=!0)),function(n,e,t){const r=new m0(4==(4&t));jE(n,e,r,r.destroy),null===e[19]&&(e[19]=new ox),e[19].queries.push(new ix(r))}(r,De(),e)}function il(){return function(n,e){return n[19].queries[e].queryList}(De(),nC())}function rS(n,e){return n.queries.getByIndex(e)}function lx(n,e){return h0(n,e)}const Bf=new Vn("Application Initializer");let zh=(()=>{class n{constructor(t){this.appInits=t,this.resolve=a0,this.reject=a0,this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,i)=>{this.resolve=r,this.reject=i})}runInitializers(){if(this.initialized)return;const t=[],r=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let i=0;i<this.appInits.length;i++){const o=this.appInits[i]();if(Jg(o))t.push(o);else if(Sy(o)){const s=new Promise((a,u)=>{o.subscribe({complete:a,error:u})});t.push(s)}}Promise.all(t).then(()=>{r()}).catch(i=>{this.reject(i)}),0===t.length&&r(),this.initialized=!0}}return n.\u0275fac=function(t){return new(t||n)(Ye(Bf,8))},n.\u0275prov=Ve({token:n,factory:n.\u0275fac}),n})();const Vf=new Vn("AppId"),CV={provide:Vf,useFactory:function(){return`${mx()}${mx()}${mx()}`},deps:[]};function mx(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const wS=new Vn("Platform Initializer"),vx=new Vn("Platform ID"),_S=new Vn("appBootstrapListener");let x0=(()=>{class n{log(t){console.log(t)}warn(t){console.warn(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ve({token:n,factory:n.\u0275fac}),n})();const fc=new Vn("LocaleId"),CS=new Vn("DefaultCurrencyCode");class IV{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}const yx=function(n){return new nx(n)},AV=yx,DV=function(n){return Promise.resolve(yx(n))},ES=function(n){const e=yx(n),r=Na(Kn(n).declarations).reduce((i,o)=>{const s=Pt(o);return s&&i.push(new zD(s)),i},[]);return new IV(e,r)},SV=ES,TV=function(n){return Promise.resolve(ES(n))};let ol=(()=>{class n{constructor(){this.compileModuleSync=AV,this.compileModuleAsync=DV,this.compileModuleAndAllComponentsSync=SV,this.compileModuleAndAllComponentsAsync=TV}clearCache(){}clearCacheFor(t){}getModuleId(t){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ve({token:n,factory:n.\u0275fac}),n})();const NV=(()=>Promise.resolve(0))();function xx(n){"undefined"==typeof Zone?NV.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class Zr{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new ii(!1),this.onMicrotaskEmpty=new ii(!1),this.onStable=new ii(!1),this.onError=new ii(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const i=this;i._nesting=0,i._outer=i._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(i._inner=i._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(i._inner=i._inner.fork(Zone.longStackTraceZoneSpec)),i.shouldCoalesceEventChangeDetection=!r&&t,i.shouldCoalesceRunChangeDetection=r,i.lastRequestAnimationFrameId=-1,i.nativeRequestAnimationFrame=function(){let n=Zt.requestAnimationFrame,e=Zt.cancelAnimationFrame;if("undefined"!=typeof Zone&&n&&e){const t=n[Zone.__symbol__("OriginalDelegate")];t&&(n=t);const r=e[Zone.__symbol__("OriginalDelegate")];r&&(e=r)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function(n){const e=()=>{!function(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(Zt,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,wx(n),n.isCheckStableRunning=!0,bx(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),wx(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,r,i,o,s,a)=>{try{return IS(n),t.invokeTask(i,o,s,a)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===o.type||n.shouldCoalesceRunChangeDetection)&&e(),AS(n)}},onInvoke:(t,r,i,o,s,a,u)=>{try{return IS(n),t.invoke(i,o,s,a,u)}finally{n.shouldCoalesceRunChangeDetection&&e(),AS(n)}},onHasTask:(t,r,i,o)=>{t.hasTask(i,o),r===i&&("microTask"==o.change?(n._hasPendingMicrotasks=o.microTask,wx(n),bx(n)):"macroTask"==o.change&&(n.hasPendingMacrotasks=o.macroTask))},onHandleError:(t,r,i,o)=>(t.handleError(i,o),n.runOutsideAngular(()=>n.onError.emit(o)),!1)})}(i)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Zr.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Zr.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,t,r){return this._inner.run(e,t,r)}runTask(e,t,r,i){const o=this._inner,s=o.scheduleEventTask("NgZoneEvent: "+i,e,kV,a0,a0);try{return o.runTask(s,t,r)}finally{o.cancelTask(s)}}runGuarded(e,t,r){return this._inner.runGuarded(e,t,r)}runOutsideAngular(e){return this._outer.run(e)}}const kV={};function bx(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function wx(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function IS(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function AS(n){n._nesting--,bx(n)}class LV{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new ii,this.onMicrotaskEmpty=new ii,this.onStable=new ii,this.onError=new ii}run(e,t,r){return e.apply(t,r)}runGuarded(e,t,r){return e.apply(t,r)}runOutsideAngular(e){return e()}runTask(e,t,r,i){return e.apply(t,r)}}let _x=(()=>{class n{constructor(t){this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Zr.assertNotInAngularZone(),xx(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())xx(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(t)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,r,i){let o=-1;r&&r>0&&(o=setTimeout(()=>{this._callbacks=this._callbacks.filter(s=>s.timeoutId!==o),t(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:t,timeoutId:o,updateCb:i})}whenStable(t,r,i){if(i&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,r,i),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(t,r,i){return[]}}return n.\u0275fac=function(t){return new(t||n)(Ye(Zr))},n.\u0275prov=Ve({token:n,factory:n.\u0275fac}),n})(),DS=(()=>{class n{constructor(){this._applications=new Map,Cx.addToWindow(this)}registerApplication(t,r){this._applications.set(t,r)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,r=!0){return Cx.findTestabilityInTree(this,t,r)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ve({token:n,factory:n.\u0275fac}),n})();class BV{addToWindow(e){}findTestabilityInTree(e,t,r){return null}}let Cx=new BV,SS=!0,TS=!1;let Qs;const RS=new Vn("AllowMultipleToken");class Ex{constructor(e,t){this.name=e,this.token=t}}function NS(n,e,t=[]){const r=`Platform: ${e}`,i=new Vn(r);return(o=[])=>{let s=OS();if(!s||s.injector.get(RS,!1))if(n)n(t.concat(o).concat({provide:i,useValue:!0}));else{const a=t.concat(o).concat({provide:i,useValue:!0},{provide:cf,useValue:"platform"});!function(n){if(Qs&&!Qs.destroyed&&!Qs.injector.get(RS,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");Qs=n.get(kS);const e=n.get(wS,null);e&&e.forEach(t=>t())}(Yn.create({providers:a,name:r}))}return function(n){const e=OS();if(!e)throw new Error("No platform exists!");if(!e.injector.get(n,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return e}(i)}}function OS(){return Qs&&!Qs.destroyed?Qs:null}let kS=(()=>{class n{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,r){const a=function(n,e){let t;return t="noop"===n?new LV:("zone.js"===n?void 0:n)||new Zr({enableLongStackTrace:(TS=!0,SS),shouldCoalesceEventChangeDetection:!!(null==e?void 0:e.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==e?void 0:e.ngZoneRunCoalescing)}),t}(r?r.ngZone:void 0,{ngZoneEventCoalescing:r&&r.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:r&&r.ngZoneRunCoalescing||!1}),u=[{provide:Zr,useValue:a}];return a.run(()=>{const c=Yn.create({providers:u,parent:this.injector,name:t.moduleType.name}),d=t.create(c),p=d.injector.get(Qc,null);if(!p)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return a.runOutsideAngular(()=>{const m=a.onError.subscribe({next:y=>{p.handleError(y)}});d.onDestroy(()=>{Ix(this._modules,d),m.unsubscribe()})}),function(n,e,t){try{const r=t();return Jg(r)?r.catch(i=>{throw e.runOutsideAngular(()=>n.handleError(i)),i}):r}catch(r){throw e.runOutsideAngular(()=>n.handleError(r)),r}}(p,a,()=>{const m=d.injector.get(zh);return m.runInitializers(),m.donePromise.then(()=>(ky(d.injector.get(fc,n0)||n0),this._moduleDoBootstrap(d),d))})})}bootstrapModule(t,r=[]){const i=PS({},r);return function(n,e,t){const r=new nx(t);return Promise.resolve(r)}(0,0,t).then(o=>this.bootstrapModuleFactory(o,i))}_moduleDoBootstrap(t){const r=t.injector.get(sl);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(i=>r.bootstrap(i));else{if(!t.instance.ngDoBootstrap)throw new Error(`The module ${yt(t.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);t.instance.ngDoBootstrap(r)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(t=>t.destroy()),this._destroyListeners.forEach(t=>t()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(t){return new(t||n)(Ye(Yn))},n.\u0275prov=Ve({token:n,factory:n.\u0275fac}),n})();function PS(n,e){return Array.isArray(e)?e.reduce(PS,n):Object.assign(Object.assign({},n),e)}let sl=(()=>{class n{constructor(t,r,i,o,s){this._zone=t,this._injector=r,this._exceptionHandler=i,this._componentFactoryResolver=o,this._initStatus=s,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const a=new ee(c=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{c.next(this._stable),c.complete()})}),u=new ee(c=>{let d;this._zone.runOutsideAngular(()=>{d=this._zone.onStable.subscribe(()=>{Zr.assertNotInAngularZone(),xx(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,c.next(!0))})})});const p=this._zone.onUnstable.subscribe(()=>{Zr.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{c.next(!1)}))});return()=>{d.unsubscribe(),p.unsubscribe()}});this.isStable=Ts(a,u.pipe(n=>Ms()(function(n,e){return function(r){let i;i="function"==typeof n?n:function(){return n};const o=Object.create(r,Xu);return o.source=r,o.subjectFactory=i,o}}(un)(n))))}bootstrap(t,r){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let i;i=t instanceof uD?t:this._componentFactoryResolver.resolveComponentFactory(t),this.componentTypes.push(i.componentType);const o=function(n){return n.isBoundToModule}(i)?void 0:this._injector.get(Ba),a=i.create(Yn.NULL,[],r||i.selector,o),u=a.location.nativeElement,c=a.injector.get(_x,null),d=c&&a.injector.get(DS);return c&&d&&d.registerApplication(u,c),a.onDestroy(()=>{this.detachView(a.hostView),Ix(this.components,a),d&&d.unregisterApplication(u)}),this._loadComponent(a),a}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(t))}finally{this._runningTick=!1}}attachView(t){const r=t;this._views.push(r),r.attachToAppRef(this)}detachView(t){const r=t;Ix(this._views,r),r.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(_S,[]).concat(this._bootstrapListeners).forEach(i=>i(t))}ngOnDestroy(){this._views.slice().forEach(t=>t.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return n.\u0275fac=function(t){return new(t||n)(Ye(Zr),Ye(Yn),Ye(Qc),Ye(du),Ye(zh))},n.\u0275prov=Ve({token:n,factory:n.\u0275fac}),n})();function Ix(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}class w0{}class JV{}const eU={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};let tU=(()=>{class n{constructor(t,r){this._compiler=t,this._config=r||eU}load(t){return this.loadAndCompile(t)}loadAndCompile(t){let[r,i]=t.split("#");return void 0===i&&(i="default"),me(255)(r).then(o=>o[i]).then(o=>VS(o,r,i)).then(o=>this._compiler.compileModuleAsync(o))}loadFactory(t){let[r,i]=t.split("#"),o="NgFactory";return void 0===i&&(i="default",o=""),me(255)(this._config.factoryPathPrefix+r+this._config.factoryPathSuffix).then(s=>s[i+o]).then(s=>VS(s,r,i))}}return n.\u0275fac=function(t){return new(t||n)(Ye(ol),Ye(JV,8))},n.\u0275prov=Ve({token:n,factory:n.\u0275fac}),n})();function VS(n,e,t){if(!n)throw new Error(`Cannot find '${t}' in '${e}'`);return n}const hU=NS(null,"core",[{provide:vx,useValue:"unknown"},{provide:kS,deps:[Yn]},{provide:DS,deps:[]},{provide:x0,deps:[]}]),mU=[{provide:sl,useClass:sl,deps:[Zr,Yn,Qc,du,zh]},{provide:b9,deps:[Zr],useFactory:function(n){let e=[];return n.onStable.subscribe(()=>{for(;e.length;)e.pop()()}),function(t){e.push(t)}}},{provide:zh,useClass:zh,deps:[[new Mo,Bf]]},{provide:ol,useClass:ol,deps:[]},CV,{provide:_f,useFactory:function(){return p7},deps:[]},{provide:Fh,useFactory:function(){return g7},deps:[]},{provide:fc,useFactory:function(n){return ky(n=n||"undefined"!=typeof $localize&&$localize.locale||n0),n},deps:[[new ch(fc),new Mo,new ac]]},{provide:CS,useValue:"USD"}];let yU=(()=>{class n{constructor(t){}}return n.\u0275fac=function(t){return new(t||n)(Ye(sl))},n.\u0275mod=gt({type:n}),n.\u0275inj=ji({providers:mU}),n})(),R0=null;function gc(){return R0}const Wi=new Vn("DocumentToken");let cl=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ve({factory:vj,token:n,providedIn:"platform"}),n})();function vj(){return Ye(cT)}const yj=new Vn("Location Initialized");let cT=(()=>{class n extends cl{constructor(t){super(),this._doc=t,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return gc().getBaseHref(this._doc)}onPopState(t){const r=gc().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",t,!1),()=>r.removeEventListener("popstate",t)}onHashChange(t){const r=gc().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",t,!1),()=>r.removeEventListener("hashchange",t)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(t){this.location.pathname=t}pushState(t,r,i){lT()?this._history.pushState(t,r,i):this.location.hash=i}replaceState(t,r,i){lT()?this._history.replaceState(t,r,i):this.location.hash=i}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}}return n.\u0275fac=function(t){return new(t||n)(Ye(Wi))},n.\u0275prov=Ve({factory:xj,token:n,providedIn:"platform"}),n})();function lT(){return!!window.history.pushState}function xj(){return new cT(Ye(Wi))}function Ux(n,e){if(0==n.length)return e;if(0==e.length)return n;let t=0;return n.endsWith("/")&&t++,e.startsWith("/")&&t++,2==t?n+e.substring(1):1==t?n+e:n+"/"+e}function hT(n){const e=n.match(/#|\?|$/),t=e&&e.index||n.length;return n.slice(0,t-("/"===n[t-1]?1:0))+n.slice(t)}function gu(n){return n&&"?"!==n[0]?"?"+n:n}let Xh=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ve({factory:bj,token:n,providedIn:"root"}),n})();function bj(n){const e=Ye(Wi).location;return new dT(Ye(cl),e&&e.origin||"")}const jx=new Vn("appBaseHref");let dT=(()=>{class n extends Xh{constructor(t,r){if(super(),this._platformLocation=t,this._removeListenerFns=[],null==r&&(r=this._platformLocation.getBaseHrefFromDOM()),null==r)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=r}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return Ux(this._baseHref,t)}path(t=!1){const r=this._platformLocation.pathname+gu(this._platformLocation.search),i=this._platformLocation.hash;return i&&t?`${r}${i}`:r}pushState(t,r,i,o){const s=this.prepareExternalUrl(i+gu(o));this._platformLocation.pushState(t,r,s)}replaceState(t,r,i,o){const s=this.prepareExternalUrl(i+gu(o));this._platformLocation.replaceState(t,r,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(t=0){var r,i;null===(i=(r=this._platformLocation).historyGo)||void 0===i||i.call(r,t)}}return n.\u0275fac=function(t){return new(t||n)(Ye(cl),Ye(jx,8))},n.\u0275prov=Ve({token:n,factory:n.\u0275fac}),n})(),wj=(()=>{class n extends Xh{constructor(t,r){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(t){const r=Ux(this._baseHref,t);return r.length>0?"#"+r:r}pushState(t,r,i,o){let s=this.prepareExternalUrl(i+gu(o));0==s.length&&(s=this._platformLocation.pathname),this._platformLocation.pushState(t,r,s)}replaceState(t,r,i,o){let s=this.prepareExternalUrl(i+gu(o));0==s.length&&(s=this._platformLocation.pathname),this._platformLocation.replaceState(t,r,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(t=0){var r,i;null===(i=(r=this._platformLocation).historyGo)||void 0===i||i.call(r,t)}}return n.\u0275fac=function(t){return new(t||n)(Ye(cl),Ye(jx,8))},n.\u0275prov=Ve({token:n,factory:n.\u0275fac}),n})(),N0=(()=>{class n{constructor(t,r){this._subject=new ii,this._urlChangeListeners=[],this._platformStrategy=t;const i=this._platformStrategy.getBaseHref();this._platformLocation=r,this._baseHref=hT(fT(i)),this._platformStrategy.onPopState(o=>{this._subject.emit({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}path(t=!1){return this.normalize(this._platformStrategy.path(t))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(t,r=""){return this.path()==this.normalize(t+gu(r))}normalize(t){return n.stripTrailingSlash(function(n,e){return n&&e.startsWith(n)?e.substring(n.length):e}(this._baseHref,fT(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._platformStrategy.prepareExternalUrl(t)}go(t,r="",i=null){this._platformStrategy.pushState(i,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+gu(r)),i)}replaceState(t,r="",i=null){this._platformStrategy.replaceState(i,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+gu(r)),i)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(t=0){var r,i;null===(i=(r=this._platformStrategy).historyGo)||void 0===i||i.call(r,t)}onUrlChange(t){this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)}))}_notifyUrlChangeListeners(t="",r){this._urlChangeListeners.forEach(i=>i(t,r))}subscribe(t,r,i){return this._subject.subscribe({next:t,error:r,complete:i})}}return n.\u0275fac=function(t){return new(t||n)(Ye(Xh),Ye(cl))},n.normalizeQueryParams=gu,n.joinWithSlash=Ux,n.stripTrailingSlash=hT,n.\u0275prov=Ve({factory:_j,token:n,providedIn:"root"}),n})();function _j(){return new N0(Ye(Xh),Ye(cl))}function fT(n){return n.replace(/\/index.html$/,"")}var Ro=(()=>((Ro=Ro||{})[Ro.Decimal=0]="Decimal",Ro[Ro.Percent=1]="Percent",Ro[Ro.Currency=2]="Currency",Ro[Ro.Scientific=3]="Scientific",Ro))(),oi=(()=>((oi=oi||{})[oi.Zero=0]="Zero",oi[oi.One=1]="One",oi[oi.Two=2]="Two",oi[oi.Few=3]="Few",oi[oi.Many=4]="Many",oi[oi.Other=5]="Other",oi))(),Ct=(()=>((Ct=Ct||{})[Ct.Decimal=0]="Decimal",Ct[Ct.Group=1]="Group",Ct[Ct.List=2]="List",Ct[Ct.PercentSign=3]="PercentSign",Ct[Ct.PlusSign=4]="PlusSign",Ct[Ct.MinusSign=5]="MinusSign",Ct[Ct.Exponential=6]="Exponential",Ct[Ct.SuperscriptingExponent=7]="SuperscriptingExponent",Ct[Ct.PerMille=8]="PerMille",Ct[Ct.Infinity=9]="Infinity",Ct[Ct.NaN=10]="NaN",Ct[Ct.TimeSeparator=11]="TimeSeparator",Ct[Ct.CurrencyDecimal=12]="CurrencyDecimal",Ct[Ct.CurrencyGroup=13]="CurrencyGroup",Ct))();function ps(n,e){const t=bo(n),r=t[Ge.NumberSymbols][e];if(void 0===r){if(e===Ct.CurrencyDecimal)return t[Ge.NumberSymbols][Ct.Decimal];if(e===Ct.CurrencyGroup)return t[Ge.NumberSymbols][Ct.Group]}return r}const Mj=function(n){return bo(n)[Ge.PluralCase]},$j=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function $x(n){const e=parseInt(n);if(isNaN(e))throw new Error("Invalid integer literal when parsing "+n);return e}class W0{}let oW=(()=>{class n extends W0{constructor(t){super(),this.locale=t}getPluralCategory(t,r){switch(Mj(r||this.locale)(t)){case oi.Zero:return"zero";case oi.One:return"one";case oi.Two:return"two";case oi.Few:return"few";case oi.Many:return"many";default:return"other"}}}return n.\u0275fac=function(t){return new(t||n)(Ye(fc))},n.\u0275prov=Ve({token:n,factory:n.\u0275fac}),n})();class cW{constructor(e,t,r,i){this.$implicit=e,this.ngForOf=t,this.index=r,this.count=i}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Yf=(()=>{class n{constructor(t,r,i){this._viewContainer=t,this._template=r,this._differs=i,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;if(!this._differ&&t)try{this._differ=this._differs.find(t).create(this.ngForTrackBy)}catch(r){throw new Error(`Cannot find a differ supporting object '${t}' of type '${function(n){return n.name||typeof n}(t)}'. NgFor only supports binding to Iterables such as Arrays.`)}}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const r=[];t.forEachOperation((i,o,s)=>{if(null==i.previousIndex){const a=this._viewContainer.createEmbeddedView(this._template,new cW(null,this._ngForOf,-1,-1),null===s?void 0:s),u=new _T(i,a);r.push(u)}else if(null==s)this._viewContainer.remove(null===o?void 0:o);else if(null!==o){const a=this._viewContainer.get(o);this._viewContainer.move(a,s);const u=new _T(i,a);r.push(u)}});for(let i=0;i<r.length;i++)this._perViewChange(r[i].view,r[i].record);for(let i=0,o=this._viewContainer.length;i<o;i++){const s=this._viewContainer.get(i);s.context.index=i,s.context.count=o,s.context.ngForOf=this._ngForOf}t.forEachIdentityChange(i=>{this._viewContainer.get(i.currentIndex).context.$implicit=i.item})}_perViewChange(t,r){t.context.$implicit=r.item}static ngTemplateContextGuard(t,r){return!0}}return n.\u0275fac=function(t){return new(t||n)(ut(qs),ut(fu),ut(_f))},n.\u0275dir=Je({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),n})();class _T{constructor(e,t){this.record=e,this.view=t}}let vu=(()=>{class n{constructor(t,r){this._viewContainer=t,this._context=new hW,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){CT("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){CT("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,r){return!0}}return n.\u0275fac=function(t){return new(t||n)(ut(qs),ut(fu))},n.\u0275dir=Je({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),n})();class hW{constructor(){this.$implicit=null,this.ngIf=null}}function CT(n,e){if(e&&!e.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${yt(e)}'.`)}function ta(n,e){return Error(`InvalidPipeArgument: '${e}' for pipe '${yt(n)}'`)}class vW{createSubscription(e,t){return e.subscribe({next:t,error:r=>{throw r}})}dispose(e){e.unsubscribe()}onDestroy(e){e.unsubscribe()}}class yW{createSubscription(e,t){return e.then(t,r=>{throw r})}dispose(e){}onDestroy(e){}}const xW=new yW,bW=new vW;let IT=(()=>{class n{constructor(t){this._ref=t,this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null}ngOnDestroy(){this._subscription&&this._dispose()}transform(t){return this._obj?t!==this._obj?(this._dispose(),this.transform(t)):this._latestValue:(t&&this._subscribe(t),this._latestValue)}_subscribe(t){this._obj=t,this._strategy=this._selectStrategy(t),this._subscription=this._strategy.createSubscription(t,r=>this._updateLatestValue(t,r))}_selectStrategy(t){if(Jg(t))return xW;if(GI(t))return bW;throw ta(n,t)}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(t,r){t===this._obj&&(this._latestValue=r,this._ref.markForCheck())}}return n.\u0275fac=function(t){return new(t||n)(ut(Ef,16))},n.\u0275pipe=Ut({name:"async",type:n,pure:!1}),n})(),Zx=(()=>{class n{constructor(t){this._locale=t}transform(t,r,i){if(!function(n){return!(null==n||""===n||n!=n)}(t))return null;i=i||this._locale;try{return function(n,e,t){return function(n,e,t,r,i,o,s=!1){let a="",u=!1;if(isFinite(n)){let c=function(n){let r,i,o,s,a,e=Math.abs(n)+"",t=0;for((i=e.indexOf("."))>-1&&(e=e.replace(".","")),(o=e.search(/e/i))>0?(i<0&&(i=o),i+=+e.slice(o+1),e=e.substring(0,o)):i<0&&(i=e.length),o=0;"0"===e.charAt(o);o++);if(o===(a=e.length))r=[0],i=1;else{for(a--;"0"===e.charAt(a);)a--;for(i-=o,r=[],s=0;o<=a;o++,s++)r[s]=Number(e.charAt(o))}return i>22&&(r=r.splice(0,21),t=i-1,i=1),{digits:r,exponent:t,integerLen:i}}(n);s&&(c=function(n){if(0===n.digits[0])return n;const e=n.digits.length-n.integerLen;return n.exponent?n.exponent+=2:(0===e?n.digits.push(0,0):1===e&&n.digits.push(0),n.integerLen+=2),n}(c));let d=e.minInt,p=e.minFrac,m=e.maxFrac;if(o){const T=o.match($j);if(null===T)throw new Error(`${o} is not a valid digit info`);const N=T[1],M=T[3],O=T[5];null!=N&&(d=$x(N)),null!=M&&(p=$x(M)),null!=O?m=$x(O):null!=M&&p>m&&(m=p)}!function(n,e,t){if(e>t)throw new Error(`The minimum number of digits after fraction (${e}) is higher than the maximum (${t}).`);let r=n.digits,i=r.length-n.integerLen;const o=Math.min(Math.max(e,i),t);let s=o+n.integerLen,a=r[s];if(s>0){r.splice(Math.max(n.integerLen,s));for(let p=s;p<r.length;p++)r[p]=0}else{i=Math.max(0,i),n.integerLen=1,r.length=Math.max(1,s=o+1),r[0]=0;for(let p=1;p<s;p++)r[p]=0}if(a>=5)if(s-1<0){for(let p=0;p>s;p--)r.unshift(0),n.integerLen++;r.unshift(1),n.integerLen++}else r[s-1]++;for(;i<Math.max(0,o);i++)r.push(0);let u=0!==o;const c=e+n.integerLen,d=r.reduceRight(function(p,m,y,w){return w[y]=(m+=p)<10?m:m-10,u&&(0===w[y]&&y>=c?w.pop():u=!1),m>=10?1:0},0);d&&(r.unshift(d),n.integerLen++)}(c,p,m);let y=c.digits,w=c.integerLen;const C=c.exponent;let _=[];for(u=y.every(T=>!T);w<d;w++)y.unshift(0);for(;w<0;w++)y.unshift(0);w>0?_=y.splice(w,y.length):(_=y,y=[0]);const A=[];for(y.length>=e.lgSize&&A.unshift(y.splice(-e.lgSize,y.length).join(""));y.length>e.gSize;)A.unshift(y.splice(-e.gSize,y.length).join(""));y.length&&A.unshift(y.join("")),a=A.join(ps(t,r)),_.length&&(a+=ps(t,i)+_.join("")),C&&(a+=ps(t,Ct.Exponential)+"+"+C)}else a=ps(t,Ct.Infinity);return a=n<0&&!u?e.negPre+a+e.negSuf:e.posPre+a+e.posSuf,a}(n,function(n,e="-"){const t={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},r=n.split(";"),i=r[0],o=r[1],s=-1!==i.indexOf(".")?i.split("."):[i.substring(0,i.lastIndexOf("0")+1),i.substring(i.lastIndexOf("0")+1)],a=s[0],u=s[1]||"";t.posPre=a.substr(0,a.indexOf("#"));for(let d=0;d<u.length;d++){const p=u.charAt(d);"0"===p?t.minFrac=t.maxFrac=d+1:"#"===p?t.maxFrac=d+1:t.posSuf+=p}const c=a.split(",");if(t.gSize=c[1]?c[1].length:0,t.lgSize=c[2]||c[1]?(c[2]||c[1]).length:0,o){const d=i.length-t.posPre.length-t.posSuf.length,p=o.indexOf("#");t.negPre=o.substr(0,p).replace(/'/g,""),t.negSuf=o.substr(p+d).replace(/'/g,"")}else t.negPre=e+t.posPre,t.negSuf=t.posSuf;return t}(function(n,e){return bo(n)[Ge.NumberFormats][e]}(e,Ro.Decimal),ps(e,Ct.MinusSign)),e,Ct.Group,Ct.Decimal,t)}(function(n){if("string"==typeof n&&!isNaN(Number(n)-parseFloat(n)))return Number(n);if("number"!=typeof n)throw new Error(`${n} is not a number`);return n}(t),i,r)}catch(o){throw ta(n,o.message)}}}return n.\u0275fac=function(t){return new(t||n)(ut(fc,16))},n.\u0275pipe=Ut({name:"number",type:n,pure:!0}),n})();let PW=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=gt({type:n}),n.\u0275inj=ji({providers:[{provide:W0,useClass:oW}]}),n})();let ST=(()=>{class n{}return n.\u0275prov=Ve({token:n,providedIn:"root",factory:()=>new VW(Ye(Wi),window)}),n})();class VW{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const t=function(n,e){const t=n.getElementById(e)||n.getElementsByName(e)[0];if(t)return t;if("function"==typeof n.createTreeWalker&&n.body&&(n.body.createShadowRoot||n.body.attachShadow)){const r=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let i=r.currentNode;for(;i;){const o=i.shadowRoot;if(o){const s=o.getElementById(e)||o.querySelector(`[name="${e}"]`);if(s)return s}i=r.nextNode()}}return null}(this.document,e);t&&(this.scrollToElement(t),this.attemptFocus(t))}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}scrollToElement(e){const t=e.getBoundingClientRect(),r=t.left+this.window.pageXOffset,i=t.top+this.window.pageYOffset,o=this.offset();this.window.scrollTo(r-o[0],i-o[1])}attemptFocus(e){return e.focus(),this.document.activeElement===e}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=TT(this.window.history)||TT(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch(e){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(e){return!1}}}function TT(n){return Object.getOwnPropertyDescriptor(n,"scrollRestoration")}class tb extends class extends class{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function(n){R0||(R0=n)}(new tb)}onAndCancel(e,t,r){return e.addEventListener(t,r,!1),()=>{e.removeEventListener(t,r,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=(Xf=Xf||document.querySelector("base"),Xf?Xf.getAttribute("href"):null);return null==t?null:function(n){H0=H0||document.createElement("a"),H0.setAttribute("href",n);const e=H0.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){Xf=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return function(n,e){e=encodeURIComponent(e);for(const t of n.split(";")){const r=t.indexOf("="),[i,o]=-1==r?[t,""]:[t.slice(0,r),t.slice(r+1)];if(i.trim()===e)return decodeURIComponent(o)}return null}(document.cookie,e)}}let H0,Xf=null;const MT=new Vn("TRANSITION_ID"),YW=[{provide:Bf,useFactory:function(n,e,t){return()=>{t.get(zh).donePromise.then(()=>{const r=gc(),i=e.querySelectorAll(`style[ng-transition="${n}"]`);for(let o=0;o<i.length;o++)r.remove(i[o])})}},deps:[MT,Wi,Yn],multi:!0}];class nb{static init(){!function(n){Cx=n}(new nb)}addToWindow(e){Zt.getAngularTestability=(r,i=!0)=>{const o=e.findTestabilityInTree(r,i);if(null==o)throw new Error("Could not find testability for element.");return o},Zt.getAllAngularTestabilities=()=>e.getAllTestabilities(),Zt.getAllAngularRootElements=()=>e.getAllRootElements(),Zt.frameworkStabilizers||(Zt.frameworkStabilizers=[]),Zt.frameworkStabilizers.push(r=>{const i=Zt.getAllAngularTestabilities();let o=i.length,s=!1;const a=function(u){s=s||u,o--,0==o&&r(s)};i.forEach(function(u){u.whenStable(a)})})}findTestabilityInTree(e,t,r){if(null==t)return null;const i=e.getTestability(t);return null!=i?i:r?gc().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null}}let XW=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ve({token:n,factory:n.\u0275fac}),n})();const qf=new Vn("EventManagerPlugins");let G0=(()=>{class n{constructor(t,r){this._zone=r,this._eventNameToPlugin=new Map,t.forEach(i=>i.manager=this),this._plugins=t.slice().reverse()}addEventListener(t,r,i){return this._findPluginFor(r).addEventListener(t,r,i)}addGlobalEventListener(t,r,i){return this._findPluginFor(r).addGlobalEventListener(t,r,i)}getZone(){return this._zone}_findPluginFor(t){const r=this._eventNameToPlugin.get(t);if(r)return r;const i=this._plugins;for(let o=0;o<i.length;o++){const s=i[o];if(s.supports(t))return this._eventNameToPlugin.set(t,s),s}throw new Error(`No event manager plugin found for event ${t}`)}}return n.\u0275fac=function(t){return new(t||n)(Ye(qf),Ye(Zr))},n.\u0275prov=Ve({token:n,factory:n.\u0275fac}),n})();class rb{constructor(e){this._doc=e}addGlobalEventListener(e,t,r){const i=gc().getGlobalEventTarget(this._doc,e);if(!i)throw new Error(`Unsupported event target ${i} for event ${t}`);return this.addEventListener(i,t,r)}}let NT=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(t){const r=new Set;t.forEach(i=>{this._stylesSet.has(i)||(this._stylesSet.add(i),r.add(i))}),this.onStylesAdded(r)}onStylesAdded(t){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ve({token:n,factory:n.\u0275fac}),n})(),$f=(()=>{class n extends NT{constructor(t){super(),this._doc=t,this._hostNodes=new Map,this._hostNodes.set(t.head,[])}_addStylesToHost(t,r,i){t.forEach(o=>{const s=this._doc.createElement("style");s.textContent=o,i.push(r.appendChild(s))})}addHost(t){const r=[];this._addStylesToHost(this._stylesSet,t,r),this._hostNodes.set(t,r)}removeHost(t){const r=this._hostNodes.get(t);r&&r.forEach(OT),this._hostNodes.delete(t)}onStylesAdded(t){this._hostNodes.forEach((r,i)=>{this._addStylesToHost(t,i,r)})}ngOnDestroy(){this._hostNodes.forEach(t=>t.forEach(OT))}}return n.\u0275fac=function(t){return new(t||n)(Ye(Wi))},n.\u0275prov=Ve({token:n,factory:n.\u0275fac}),n})();function OT(n){gc().remove(n)}const ib={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},ob=/%COMP%/g;function Y0(n,e,t){for(let r=0;r<e.length;r++){let i=e[r];Array.isArray(i)?Y0(n,i,t):(i=i.replace(ob,n),t.push(i))}return t}function FT(n){return e=>{if("__ngUnwrap__"===e)return n;!1===n(e)&&(e.preventDefault(),e.returnValue=!1)}}let sb=(()=>{class n{constructor(t,r,i){this.eventManager=t,this.sharedStylesHost=r,this.appId=i,this.rendererByCompId=new Map,this.defaultRenderer=new ab(t)}createRenderer(t,r){if(!t||!r)return this.defaultRenderer;switch(r.encapsulation){case We.Emulated:{let i=this.rendererByCompId.get(r.id);return i||(i=new uH(this.eventManager,this.sharedStylesHost,r,this.appId),this.rendererByCompId.set(r.id,i)),i.applyToHost(t),i}case 1:case We.ShadowDom:return new cH(this.eventManager,this.sharedStylesHost,t,r);default:if(!this.rendererByCompId.has(r.id)){const i=Y0(r.id,r.styles,[]);this.sharedStylesHost.addStyles(i),this.rendererByCompId.set(r.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(t){return new(t||n)(Ye(G0),Ye($f),Ye(Vf))},n.\u0275prov=Ve({token:n,factory:n.\u0275fac}),n})();class ab{constructor(e){this.eventManager=e,this.data=Object.create(null)}destroy(){}createElement(e,t){return t?document.createElementNS(ib[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){e.appendChild(t)}insertBefore(e,t,r){e&&e.insertBefore(t,r)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let r="string"==typeof e?document.querySelector(e):e;if(!r)throw new Error(`The selector "${e}" did not match any elements`);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,i){if(i){t=i+":"+t;const o=ib[i];o?e.setAttributeNS(o,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){const i=ib[r];i?e.removeAttributeNS(i,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,i){i&(Ko.DashCase|Ko.Important)?e.style.setProperty(t,r,i&Ko.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&Ko.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e[t]=r}setValue(e,t){e.nodeValue=t}listen(e,t,r){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,FT(r)):this.eventManager.addEventListener(e,t,FT(r))}}class uH extends ab{constructor(e,t,r,i){super(e),this.component=r;const o=Y0(i+"-"+r.id,r.styles,[]);t.addStyles(o),this.contentAttr=function(n){return"_ngcontent-%COMP%".replace(ob,n)}(i+"-"+r.id),this.hostAttr=function(n){return"_nghost-%COMP%".replace(ob,n)}(i+"-"+r.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}}class cH extends ab{constructor(e,t,r,i){super(e),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const o=Y0(i.id,i.styles,[]);for(let s=0;s<o.length;s++){const a=document.createElement("style");a.textContent=o[s],this.shadowRoot.appendChild(a)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let lH=(()=>{class n extends rb{constructor(t){super(t)}supports(t){return!0}addEventListener(t,r,i){return t.addEventListener(r,i,!1),()=>this.removeEventListener(t,r,i)}removeEventListener(t,r,i){return t.removeEventListener(r,i)}}return n.\u0275fac=function(t){return new(t||n)(Ye(Wi))},n.\u0275prov=Ve({token:n,factory:n.\u0275fac}),n})();const VT=["alt","control","meta","shift"],vH={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},UT={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},yH={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let xH=(()=>{class n extends rb{constructor(t){super(t)}supports(t){return null!=n.parseEventName(t)}addEventListener(t,r,i){const o=n.parseEventName(r),s=n.eventCallback(o.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>gc().onAndCancel(t,o.domEventName,s))}static parseEventName(t){const r=t.toLowerCase().split("."),i=r.shift();if(0===r.length||"keydown"!==i&&"keyup"!==i)return null;const o=n._normalizeKey(r.pop());let s="";if(VT.forEach(u=>{const c=r.indexOf(u);c>-1&&(r.splice(c,1),s+=u+".")}),s+=o,0!=r.length||0===o.length)return null;const a={};return a.domEventName=i,a.fullKey=s,a}static getEventFullKey(t){let r="",i=function(n){let e=n.key;if(null==e){if(e=n.keyIdentifier,null==e)return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===n.location&&UT.hasOwnProperty(e)&&(e=UT[e]))}return vH[e]||e}(t);return i=i.toLowerCase()," "===i?i="space":"."===i&&(i="dot"),VT.forEach(o=>{o!=i&&yH[o](t)&&(r+=o+".")}),r+=i,r}static eventCallback(t,r,i){return o=>{n.getEventFullKey(o)===t&&i.runGuarded(()=>r(o))}}static _normalizeKey(t){switch(t){case"esc":return"escape";default:return t}}}return n.\u0275fac=function(t){return new(t||n)(Ye(Wi))},n.\u0275prov=Ve({token:n,factory:n.\u0275fac}),n})();const DH=NS(hU,"browser",[{provide:vx,useValue:"browser"},{provide:wS,useValue:function(){tb.makeCurrent(),nb.init()},multi:!0},{provide:Wi,useFactory:function(){return function(n){ve=n}(document),document},deps:[]}]),SH=[[],{provide:cf,useValue:"root"},{provide:Qc,useFactory:function(){return new Qc},deps:[]},{provide:qf,useClass:lH,multi:!0,deps:[Wi,Zr,vx]},{provide:qf,useClass:xH,multi:!0,deps:[Wi]},[],{provide:sb,useClass:sb,deps:[G0,$f,Vf]},{provide:u0,useExisting:sb},{provide:NT,useExisting:$f},{provide:$f,useClass:$f,deps:[Wi]},{provide:_x,useClass:_x,deps:[Zr]},{provide:G0,useClass:G0,deps:[qf,Zr]},{provide:class{},useClass:XW,deps:[]},[]];let jT=(()=>{class n{constructor(t){if(t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(t){return{ngModule:n,providers:[{provide:Vf,useValue:t.appId},{provide:MT,useExisting:Vf},YW]}}}return n.\u0275fac=function(t){return new(t||n)(Ye(n,12))},n.\u0275mod=gt({type:n}),n.\u0275inj=ji({providers:SH,imports:[PW,yU]}),n})();function Ht(...n){let e=n[n.length-1];return ft(e)?(n.pop(),Kt(n,e)):Ur(n)}"undefined"!=typeof window&&window;class na extends ie{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return t&&!t.closed&&e.next(this._value),t}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new _e;return this._value}next(e){super.next(this._value=e)}}class FH extends Pn{notifyNext(e,t,r,i,o){this.destination.next(t)}notifyError(e,t){this.destination.error(e)}notifyComplete(e){this.destination.complete()}}class LH extends Pn{constructor(e,t,r){super(),this.parent=e,this.outerValue=t,this.outerIndex=r,this.index=0}_next(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)}_error(e){this.parent.notifyError(e,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}function BH(n,e,t,r,i=new LH(n,t,r)){if(!i.closed)return e instanceof ee?e.subscribe(i):Ss(e)(i)}const HT={};class UH{constructor(e){this.resultSelector=e}call(e,t){return t.subscribe(new jH(e,this.resultSelector))}}class jH extends FH{constructor(e,t){super(e),this.resultSelector=t,this.active=0,this.values=[],this.observables=[]}_next(e){this.values.push(HT),this.observables.push(e)}_complete(){const e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(let r=0;r<t;r++)this.add(BH(this,e[r],void 0,r))}}notifyComplete(e){0==(this.active-=1)&&this.destination.complete()}notifyNext(e,t,r){const i=this.values,s=this.toRespond?i[r]===HT?--this.toRespond:this.toRespond:0;i[r]=t,0===s&&(this.resultSelector?this._tryResultSelector(i):this.destination.next(i.slice()))}_tryResultSelector(e){let t;try{t=this.resultSelector.apply(this,e)}catch(r){return void this.destination.error(r)}this.destination.next(t)}}const X0=(()=>{function n(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return n.prototype=Object.create(Error.prototype),n})();function db(...n){return Ui(1)(Ht(...n))}const qh=new ee(n=>n.complete());function q0(n){return n?function(n){return new ee(e=>n.schedule(()=>e.complete()))}(n):qh}function zT(n){return new ee(e=>{let t;try{t=n()}catch(i){return void e.error(i)}return(t?Jn(t):q0()).subscribe(e)})}function yu(n,e){return"function"==typeof e?t=>t.pipe(yu((r,i)=>Jn(n(r,i)).pipe(kt((o,s)=>e(r,o,i,s))))):t=>t.lift(new zH(n))}class zH{constructor(e){this.project=e}call(e,t){return t.subscribe(new GH(e,this.project))}}class GH extends Xe{constructor(e,t){super(e),this.project=t,this.index=0}_next(e){let t;const r=this.index++;try{t=this.project(e,r)}catch(i){return void this.destination.error(i)}this._innerSub(t)}_innerSub(e){const t=this.innerSubscription;t&&t.unsubscribe();const r=new Qt(this),i=this.destination;i.add(r),this.innerSubscription=Uo(e,r),this.innerSubscription!==r&&i.add(this.innerSubscription)}_complete(){const{innerSubscription:e}=this;(!e||e.closed)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(e){this.destination.next(e)}}const GT=(()=>{function n(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return n.prototype=Object.create(Error.prototype),n})();function fb(n){return e=>0===n?q0():e.lift(new YH(n))}class YH{constructor(e){if(this.total=e,this.total<0)throw new GT}call(e,t){return t.subscribe(new XH(e,this.total))}}class XH extends Pn{constructor(e,t){super(e),this.total=t,this.count=0}_next(e){const t=this.total,r=++this.count;r<=t&&(this.destination.next(e),r===t&&(this.destination.complete(),this.unsubscribe()))}}function YT(n,e){let t=!1;return arguments.length>=2&&(t=!0),function(i){return i.lift(new $H(n,e,t))}}class $H{constructor(e,t,r=!1){this.accumulator=e,this.seed=t,this.hasSeed=r}call(e,t){return t.subscribe(new KH(e,this.accumulator,this.seed,this.hasSeed))}}class KH extends Pn{constructor(e,t,r,i){super(e),this.accumulator=t,this._seed=r,this.hasSeed=i,this.index=0}get seed(){return this._seed}set seed(e){this.hasSeed=!0,this._seed=e}_next(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)}_tryNext(e){const t=this.index++;let r;try{r=this.accumulator(this.seed,e,t)}catch(i){this.destination.error(i)}this.seed=r,this.destination.next(r)}}function $h(n,e){return function(r){return r.lift(new QH(n,e))}}class QH{constructor(e,t){this.predicate=e,this.thisArg=t}call(e,t){return t.subscribe(new ZH(e,this.predicate,this.thisArg))}}class ZH extends Pn{constructor(e,t,r){super(e),this.predicate=t,this.thisArg=r,this.count=0}_next(e){let t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(r){return void this.destination.error(r)}t&&this.destination.next(e)}}function ll(n){return function(t){const r=new JH(n),i=t.lift(r);return r.caught=i}}class JH{constructor(e){this.selector=e}call(e,t){return t.subscribe(new ez(e,this.selector,this.caught))}}class ez extends Xe{constructor(e,t,r){super(e),this.selector=t,this.caught=r}error(e){if(!this.isStopped){let t;try{t=this.selector(e,this.caught)}catch(o){return void super.error(o)}this._unsubscribeAndRecycle();const r=new Qt(this);this.add(r);const i=Uo(t,r);i!==r&&this.add(i)}}}function Kf(n,e){return pr(n,e,1)}function pb(n){return function(t){return 0===n?q0():t.lift(new tz(n))}}class tz{constructor(e){if(this.total=e,this.total<0)throw new GT}call(e,t){return t.subscribe(new nz(e,this.total))}}class nz extends Pn{constructor(e,t){super(e),this.total=t,this.ring=new Array,this.count=0}_next(e){const t=this.ring,r=this.total,i=this.count++;t.length<r?t.push(e):t[i%r]=e}_complete(){const e=this.destination;let t=this.count;if(t>0){const r=this.count>=this.total?this.total:this.count,i=this.ring;for(let o=0;o<r;o++){const s=t++%r;e.next(i[s])}}e.complete()}}function XT(n=oz){return e=>e.lift(new rz(n))}class rz{constructor(e){this.errorFactory=e}call(e,t){return t.subscribe(new iz(e,this.errorFactory))}}class iz extends Pn{constructor(e,t){super(e),this.errorFactory=t,this.hasValue=!1}_next(e){this.hasValue=!0,this.destination.next(e)}_complete(){if(this.hasValue)return this.destination.complete();{let e;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)}}}function oz(){return new X0}function qT(n=null){return e=>e.lift(new sz(n))}class sz{constructor(e){this.defaultValue=e}call(e,t){return t.subscribe(new az(e,this.defaultValue))}}class az extends Pn{constructor(e,t){super(e),this.defaultValue=t,this.isEmpty=!0}_next(e){this.isEmpty=!1,this.destination.next(e)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}function Kh(n,e){const t=arguments.length>=2;return r=>r.pipe(n?$h((i,o)=>n(i,o,r)):yn,fb(1),t?qT(e):XT(()=>new X0))}function vc(){}function Zo(n,e,t){return function(i){return i.lift(new cz(n,e,t))}}class cz{constructor(e,t,r){this.nextOrObserver=e,this.error=t,this.complete=r}call(e,t){return t.subscribe(new lz(e,this.nextOrObserver,this.error,this.complete))}}class lz extends Pn{constructor(e,t,r,i){super(e),this._tapNext=vc,this._tapError=vc,this._tapComplete=vc,this._tapError=r||vc,this._tapComplete=i||vc,ar(t)?(this._context=this,this._tapNext=t):t&&(this._context=t,this._tapNext=t.next||vc,this._tapError=t.error||vc,this._tapComplete=t.complete||vc)}_next(e){try{this._tapNext.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.next(e)}_error(e){try{this._tapError.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.error(e)}_complete(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()}}class dz{constructor(e){this.callback=e}call(e,t){return t.subscribe(new fz(e,this.callback))}}class fz extends Pn{constructor(e,t){super(e),this.add(new At(t))}}class xu{constructor(e,t){this.id=e,this.url=t}}class gb extends xu{constructor(e,t,r="imperative",i=null){super(e,t),this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Qf extends xu{constructor(e,t,r){super(e,t),this.urlAfterRedirects=r}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class $T extends xu{constructor(e,t,r){super(e,t),this.reason=r}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class pz extends xu{constructor(e,t,r){super(e,t),this.error=r}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class gz extends xu{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class mz extends xu{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class vz extends xu{constructor(e,t,r,i,o){super(e,t),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=o}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class yz extends xu{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class xz extends xu{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class KT{constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class QT{constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class bz{constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class wz{constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class _z{constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Cz{constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ZT{constructor(e,t,r){this.routerEvent=e,this.position=t,this.anchor=r}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const on="primary";class Ez{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function Qh(n){return new Ez(n)}const JT="ngNavigationCancelingError";function mb(n){const e=Error("NavigationCancelingError: "+n);return e[JT]=!0,e}function Az(n,e,t){const r=t.path.split("/");if(r.length>n.length||"full"===t.pathMatch&&(e.hasChildren()||r.length<n.length))return null;const i={};for(let o=0;o<r.length;o++){const s=r[o],a=n[o];if(s.startsWith(":"))i[s.substring(1)]=a;else if(s!==a.path)return null}return{consumed:n.slice(0,r.length),posParams:i}}function Va(n,e){const t=n?Object.keys(n):void 0,r=e?Object.keys(e):void 0;if(!t||!r||t.length!=r.length)return!1;let i;for(let o=0;o<t.length;o++)if(i=t[o],!eM(n[i],e[i]))return!1;return!0}function eM(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;const t=[...n].sort(),r=[...e].sort();return t.every((i,o)=>r[o]===i)}return n===e}function tM(n){return Array.prototype.concat.apply([],n)}function nM(n){return n.length>0?n[n.length-1]:null}function Hi(n,e){for(const t in n)n.hasOwnProperty(t)&&e(n[t],t)}function Ua(n){return Sy(n)?n:Jg(n)?Jn(Promise.resolve(n)):Ht(n)}const Tz={exact:function oM(n,e,t){if(!dl(n.segments,e.segments)||!$0(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(const r in e.children)if(!n.children[r]||!oM(n.children[r],e.children[r],t))return!1;return!0},subset:sM},rM={exact:function(n,e){return Va(n,e)},subset:function(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>eM(n[t],e[t]))},ignored:()=>!0};function iM(n,e,t){return Tz[t.paths](n.root,e.root,t.matrixParams)&&rM[t.queryParams](n.queryParams,e.queryParams)&&!("exact"===t.fragment&&n.fragment!==e.fragment)}function sM(n,e,t){return aM(n,e,e.segments,t)}function aM(n,e,t,r){if(n.segments.length>t.length){const i=n.segments.slice(0,t.length);return!(!dl(i,t)||e.hasChildren()||!$0(i,t,r))}if(n.segments.length===t.length){if(!dl(n.segments,t)||!$0(n.segments,t,r))return!1;for(const i in e.children)if(!n.children[i]||!sM(n.children[i],e.children[i],r))return!1;return!0}{const i=t.slice(0,n.segments.length),o=t.slice(n.segments.length);return!!(dl(n.segments,i)&&$0(n.segments,i,r)&&n.children[on])&&aM(n.children[on],e,o,r)}}function $0(n,e,t){return e.every((r,i)=>rM[t](n[i].parameters,r.parameters))}class hl{constructor(e,t,r){this.root=e,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Qh(this.queryParams)),this._queryParamMap}toString(){return kz.serialize(this)}}class mn{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Hi(t,(r,i)=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return K0(this)}}class Zf{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=Qh(this.parameters)),this._parameterMap}toString(){return hM(this)}}function dl(n,e){return n.length===e.length&&n.every((t,r)=>t.path===e[r].path)}class vb{}class uM{parse(e){const t=new Hz(e);return new hl(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){return`${`/${Jf(e.root,!0)}`}${function(n){const e=Object.keys(n).map(t=>{const r=n[t];return Array.isArray(r)?r.map(i=>`${Q0(t)}=${Q0(i)}`).join("&"):`${Q0(t)}=${Q0(r)}`}).filter(t=>!!t);return e.length?`?${e.join("&")}`:""}(e.queryParams)}${"string"==typeof e.fragment?`#${function(n){return encodeURI(n)}(e.fragment)}`:""}`}}const kz=new uM;function K0(n){return n.segments.map(e=>hM(e)).join("/")}function Jf(n,e){if(!n.hasChildren())return K0(n);if(e){const t=n.children[on]?Jf(n.children[on],!1):"",r=[];return Hi(n.children,(i,o)=>{o!==on&&r.push(`${o}:${Jf(i,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}{const t=function(n,e){let t=[];return Hi(n.children,(r,i)=>{i===on&&(t=t.concat(e(r,i)))}),Hi(n.children,(r,i)=>{i!==on&&(t=t.concat(e(r,i)))}),t}(n,(r,i)=>i===on?[Jf(n.children[on],!1)]:[`${i}:${Jf(r,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[on]?`${K0(n)}/${t[0]}`:`${K0(n)}/(${t.join("//")})`}}function cM(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Q0(n){return cM(n).replace(/%3B/gi,";")}function yb(n){return cM(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Z0(n){return decodeURIComponent(n)}function lM(n){return Z0(n.replace(/\+/g,"%20"))}function hM(n){return`${yb(n.path)}${function(n){return Object.keys(n).map(e=>`;${yb(e)}=${yb(n[e])}`).join("")}(n.parameters)}`}const Bz=/^[^\/()?;=#]+/;function J0(n){const e=n.match(Bz);return e?e[0]:""}const Vz=/^[^=?&#]+/,jz=/^[^?&#]+/;class Hz{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new mn([],{}):new mn([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(r[on]=new mn(e,t)),r}parseSegment(){const e=J0(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(e),new Zf(Z0(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=J0(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const i=J0(this.remaining);i&&(r=i,this.capture(r))}e[Z0(t)]=Z0(r)}parseQueryParam(e){const t=function(n){const e=n.match(Vz);return e?e[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const s=function(n){const e=n.match(jz);return e?e[0]:""}(this.remaining);s&&(r=s,this.capture(r))}const i=lM(t),o=lM(r);if(e.hasOwnProperty(i)){let s=e[i];Array.isArray(s)||(s=[s],e[i]=s),s.push(o)}else e[i]=o}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=J0(this.remaining),i=this.remaining[r.length];if("/"!==i&&")"!==i&&";"!==i)throw new Error(`Cannot parse url '${this.url}'`);let o;r.indexOf(":")>-1?(o=r.substr(0,r.indexOf(":")),this.capture(o),this.capture(":")):e&&(o=on);const s=this.parseChildren();t[o]=1===Object.keys(s).length?s[on]:new mn([],s),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new Error(`Expected "${e}".`)}}class dM{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=xb(e,this._root);return t?t.children.map(r=>r.value):[]}firstChild(e){const t=xb(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=bb(e,this._root);return t.length<2?[]:t[t.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return bb(e,this._root).map(t=>t.value)}}function xb(n,e){if(n===e.value)return e;for(const t of e.children){const r=xb(n,t);if(r)return r}return null}function bb(n,e){if(n===e.value)return[e];for(const t of e.children){const r=bb(n,t);if(r.length)return r.unshift(e),r}return[]}class bu{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function ep(n){const e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}class fM extends dM{constructor(e,t){super(e),this.snapshot=t,wb(this,e)}toString(){return this.snapshot.toString()}}function pM(n,e){const t=function(n,e){const s=new e1([],{},{},"",{},on,e,null,n.root,-1,{});return new mM("",new bu(s,[]))}(n,e),r=new na([new Zf("",{})]),i=new na({}),o=new na({}),s=new na({}),a=new na(""),u=new Zh(r,i,s,a,o,on,e,t.root);return u.snapshot=t.root,new fM(new bu(u,[]),t)}class Zh{constructor(e,t,r,i,o,s,a,u){this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=o,this.outlet=s,this.component=a,this._futureSnapshot=u}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(kt(e=>Qh(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(kt(e=>Qh(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function gM(n,e="emptyOnly"){const t=n.pathFromRoot;let r=0;if("always"!==e)for(r=t.length-1;r>=1;){const i=t[r],o=t[r-1];if(i.routeConfig&&""===i.routeConfig.path)r--;else{if(o.component)break;r--}}return function(n){return n.reduce((e,t)=>({params:Object.assign(Object.assign({},e.params),t.params),data:Object.assign(Object.assign({},e.data),t.data),resolve:Object.assign(Object.assign({},e.resolve),t._resolvedData)}),{params:{},data:{},resolve:{}})}(t.slice(r))}class e1{constructor(e,t,r,i,o,s,a,u,c,d,p){this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=o,this.outlet=s,this.component=a,this.routeConfig=u,this._urlSegment=c,this._lastPathIndex=d,this._resolve=p}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Qh(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Qh(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class mM extends dM{constructor(e,t){super(t),this.url=e,wb(this,t)}toString(){return vM(this._root)}}function wb(n,e){e.value._routerState=n,e.children.forEach(t=>wb(n,t))}function vM(n){const e=n.children.length>0?` { ${n.children.map(vM).join(", ")} } `:"";return`${n.value}${e}`}function _b(n){if(n.snapshot){const e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,Va(e.queryParams,t.queryParams)||n.queryParams.next(t.queryParams),e.fragment!==t.fragment&&n.fragment.next(t.fragment),Va(e.params,t.params)||n.params.next(t.params),function(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!Va(n[t],e[t]))return!1;return!0}(e.url,t.url)||n.url.next(t.url),Va(e.data,t.data)||n.data.next(t.data)}else n.snapshot=n._futureSnapshot,n.data.next(n._futureSnapshot.data)}function Cb(n,e){return Va(n.params,e.params)&&function(n,e){return dl(n,e)&&n.every((t,r)=>Va(t.parameters,e[r].parameters))}(n.url,e.url)&&!(!n.parent!=!e.parent)&&(!n.parent||Cb(n.parent,e.parent))}function t1(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){const r=t.value;r._futureSnapshot=e.value;const i=function(n,e,t){return e.children.map(r=>{for(const i of t.children)if(n.shouldReuseRoute(r.value,i.value.snapshot))return t1(n,r,i);return t1(n,r)})}(n,e,t);return new bu(r,i)}{if(n.shouldAttach(e.value)){const o=n.retrieve(e.value);if(null!==o){const s=o.route;return yM(e,s),s}}const r=function(n){return new Zh(new na(n.url),new na(n.params),new na(n.queryParams),new na(n.fragment),new na(n.data),n.outlet,n.component,n)}(e.value),i=e.children.map(o=>t1(n,o));return new bu(r,i)}}function yM(n,e){if(n.value.routeConfig!==e.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(n.children.length!==e.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");e.value._futureSnapshot=n.value;for(let t=0;t<n.children.length;++t)yM(n.children[t],e.children[t])}function n1(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function tp(n){return"object"==typeof n&&null!=n&&n.outlets}function Eb(n,e,t,r,i){let o={};return r&&Hi(r,(s,a)=>{o[a]=Array.isArray(s)?s.map(u=>`${u}`):`${s}`}),new hl(t.root===n?e:xM(t.root,n,e),o,i)}function xM(n,e,t){const r={};return Hi(n.children,(i,o)=>{r[o]=i===e?t:xM(i,e,t)}),new mn(n.segments,r)}class bM{constructor(e,t,r){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=r,e&&r.length>0&&n1(r[0]))throw new Error("Root segment cannot have matrix parameters");const i=r.find(tp);if(i&&i!==nM(r))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Ib{constructor(e,t,r){this.segmentGroup=e,this.processChildren=t,this.index=r}}function wM(n,e,t){if(n||(n=new mn([],{})),0===n.segments.length&&n.hasChildren())return r1(n,e,t);const r=function(n,e,t){let r=0,i=e;const o={match:!1,pathIndex:0,commandIndex:0};for(;i<n.segments.length;){if(r>=t.length)return o;const s=n.segments[i],a=t[r];if(tp(a))break;const u=`${a}`,c=r<t.length-1?t[r+1]:null;if(i>0&&void 0===u)break;if(u&&c&&"object"==typeof c&&void 0===c.outlets){if(!CM(u,c,s))return o;r+=2}else{if(!CM(u,{},s))return o;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(n,e,t),i=t.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){const o=new mn(n.segments.slice(0,r.pathIndex),{});return o.children[on]=new mn(n.segments.slice(r.pathIndex),n.children),r1(o,0,i)}return r.match&&0===i.length?new mn(n.segments,{}):r.match&&!n.hasChildren()?Ab(n,e,t):r.match?r1(n,0,i):Ab(n,e,t)}function r1(n,e,t){if(0===t.length)return new mn(n.segments,{});{const r=function(n){return tp(n[0])?n[0].outlets:{[on]:n}}(t),i={};return Hi(r,(o,s)=>{"string"==typeof o&&(o=[o]),null!==o&&(i[s]=wM(n.children[s],e,o))}),Hi(n.children,(o,s)=>{void 0===r[s]&&(i[s]=o)}),new mn(n.segments,i)}}function Ab(n,e,t){const r=n.segments.slice(0,e);let i=0;for(;i<t.length;){const o=t[i];if(tp(o)){const u=tG(o.outlets);return new mn(r,u)}if(0===i&&n1(t[0])){r.push(new Zf(n.segments[e].path,_M(t[0]))),i++;continue}const s=tp(o)?o.outlets[on]:`${o}`,a=i<t.length-1?t[i+1]:null;s&&a&&n1(a)?(r.push(new Zf(s,_M(a))),i+=2):(r.push(new Zf(s,{})),i++)}return new mn(r,{})}function tG(n){const e={};return Hi(n,(t,r)=>{"string"==typeof t&&(t=[t]),null!==t&&(e[r]=Ab(new mn([],{}),0,t))}),e}function _M(n){const e={};return Hi(n,(t,r)=>e[r]=`${t}`),e}function CM(n,e,t){return n==t.path&&Va(e,t.parameters)}class rG{constructor(e,t,r,i){this.routeReuseStrategy=e,this.futureState=t,this.currState=r,this.forwardEvent=i}activate(e){const t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,e),_b(this.futureState.root),this.activateChildRoutes(t,r,e)}deactivateChildRoutes(e,t,r){const i=ep(t);e.children.forEach(o=>{const s=o.value.outlet;this.deactivateRoutes(o,i[s],r),delete i[s]}),Hi(i,(o,s)=>{this.deactivateRouteAndItsChildren(o,r)})}deactivateRoutes(e,t,r){const i=e.value,o=t?t.value:null;if(i===o)if(i.component){const s=r.getContext(i.outlet);s&&this.deactivateChildRoutes(e,t,s.children)}else this.deactivateChildRoutes(e,t,r);else o&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(e,t){this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const r=t.getContext(e.value.outlet);if(r&&r.outlet){const i=r.outlet.detach(),o=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:i,route:e,contexts:o})}}deactivateRouteAndOutlet(e,t){const r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,o=ep(e);for(const s of Object.keys(o))this.deactivateRouteAndItsChildren(o[s],i);r&&r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated(),r.attachRef=null,r.resolver=null,r.route=null)}activateChildRoutes(e,t,r){const i=ep(t);e.children.forEach(o=>{this.activateRoutes(o,i[o.value.outlet],r),this.forwardEvent(new Cz(o.value.snapshot))}),e.children.length&&this.forwardEvent(new wz(e.value.snapshot))}activateRoutes(e,t,r){const i=e.value,o=t?t.value:null;if(_b(i),i===o)if(i.component){const s=r.getOrCreateContext(i.outlet);this.activateChildRoutes(e,t,s.children)}else this.activateChildRoutes(e,t,r);else if(i.component){const s=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){const a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),s.children.onOutletReAttached(a.contexts),s.attachRef=a.componentRef,s.route=a.route.value,s.outlet&&s.outlet.attach(a.componentRef,a.route.value),EM(a.route)}else{const a=function(n){for(let e=n.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig;if(t&&t.component)return null}return null}(i.snapshot),u=a?a.module.componentFactoryResolver:null;s.attachRef=null,s.route=i,s.resolver=u,s.outlet&&s.outlet.activateWith(i,u),this.activateChildRoutes(e,null,s.children)}}else this.activateChildRoutes(e,null,r)}}function EM(n){_b(n.value),n.children.forEach(EM)}class Db{constructor(e,t){this.routes=e,this.module=t}}function yc(n){return"function"==typeof n}function fl(n){return n instanceof hl}const np=Symbol("INITIAL_VALUE");function rp(){return yu(n=>function(...n){let e,t;return ft(n[n.length-1])&&(t=n.pop()),"function"==typeof n[n.length-1]&&(e=n.pop()),1===n.length&&br(n[0])&&(n=n[0]),Ur(n,t).lift(new UH(e))}(n.map(e=>e.pipe(fb(1),function(...n){const e=n[n.length-1];return ft(e)?(n.pop(),t=>db(n,t,e)):t=>db(n,t)}(np)))).pipe(YT((e,t)=>{let r=!1;return t.reduce((i,o,s)=>i!==np?i:(o===np&&(r=!0),r||!1!==o&&s!==t.length-1&&!fl(o)?i:o),e)},np),$h(e=>e!==np),kt(e=>fl(e)?e:!0===e),fb(1)))}let IM=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=xe({type:n,selectors:[["ng-component"]],decls:1,vars:0,template:function(t,r){1&t&&yr(0,"router-outlet")},directives:function(){return[Ob]},encapsulation:2}),n})();function AM(n,e=""){for(let t=0;t<n.length;t++){const r=n[t];lG(r,hG(e,r))}}function lG(n,e){n.children&&AM(n.children,e)}function hG(n,e){return e?n||e.path?n&&!e.path?`${n}/`:!n&&e.path?e.path:`${n}/${e.path}`:"":n}function Sb(n){const e=n.children&&n.children.map(Sb),t=e?Object.assign(Object.assign({},n),{children:e}):Object.assign({},n);return!t.component&&(e||t.loadChildren)&&t.outlet&&t.outlet!==on&&(t.component=IM),t}function ms(n){return n.outlet||on}function DM(n,e){const t=n.filter(r=>ms(r)===e);return t.push(...n.filter(r=>ms(r)!==e)),t}const SM={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function i1(n,e,t){var r;if(""===e.path)return"full"===e.pathMatch&&(n.hasChildren()||t.length>0)?Object.assign({},SM):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const o=(e.matcher||Az)(t,n,e);if(!o)return Object.assign({},SM);const s={};Hi(o.posParams,(u,c)=>{s[c]=u.path});const a=o.consumed.length>0?Object.assign(Object.assign({},s),o.consumed[o.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:o.consumed,lastChild:o.consumed.length,parameters:a,positionalParamSegments:null!==(r=o.posParams)&&void 0!==r?r:{}}}function o1(n,e,t,r,i="corrected"){if(t.length>0&&function(n,e,t){return t.some(r=>s1(n,e,r)&&ms(r)!==on)}(n,t,r)){const s=new mn(e,function(n,e,t,r){const i={};i[on]=r,r._sourceSegment=n,r._segmentIndexShift=e.length;for(const o of t)if(""===o.path&&ms(o)!==on){const s=new mn([],{});s._sourceSegment=n,s._segmentIndexShift=e.length,i[ms(o)]=s}return i}(n,e,r,new mn(t,n.children)));return s._sourceSegment=n,s._segmentIndexShift=e.length,{segmentGroup:s,slicedSegments:[]}}if(0===t.length&&function(n,e,t){return t.some(r=>s1(n,e,r))}(n,t,r)){const s=new mn(n.segments,function(n,e,t,r,i,o){const s={};for(const a of r)if(s1(n,t,a)&&!i[ms(a)]){const u=new mn([],{});u._sourceSegment=n,u._segmentIndexShift="legacy"===o?n.segments.length:e.length,s[ms(a)]=u}return Object.assign(Object.assign({},i),s)}(n,e,t,r,n.children,i));return s._sourceSegment=n,s._segmentIndexShift=e.length,{segmentGroup:s,slicedSegments:t}}const o=new mn(n.segments,n.children);return o._sourceSegment=n,o._segmentIndexShift=e.length,{segmentGroup:o,slicedSegments:t}}function s1(n,e,t){return(!(n.hasChildren()||e.length>0)||"full"!==t.pathMatch)&&""===t.path}function TM(n,e,t,r){return!!(ms(n)===r||r!==on&&s1(e,t,n))&&("**"===n.path||i1(e,n,t).matched)}function MM(n,e,t){return 0===e.length&&!n.children[t]}class ip{constructor(e){this.segmentGroup=e||null}}class RM{constructor(e){this.urlTree=e}}function a1(n){return new ee(e=>e.error(new ip(n)))}function NM(n){return new ee(e=>e.error(new RM(n)))}function mG(n){return new ee(e=>e.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${n}'`)))}class xG{constructor(e,t,r,i,o){this.configLoader=t,this.urlSerializer=r,this.urlTree=i,this.config=o,this.allowRedirects=!0,this.ngModule=e.get(Ba)}apply(){const e=o1(this.urlTree.root,[],[],this.config).segmentGroup,t=new mn(e.segments,e.children);return this.expandSegmentGroup(this.ngModule,this.config,t,on).pipe(kt(o=>this.createUrlTree(Tb(o),this.urlTree.queryParams,this.urlTree.fragment))).pipe(ll(o=>{if(o instanceof RM)return this.allowRedirects=!1,this.match(o.urlTree);throw o instanceof ip?this.noMatchError(o):o}))}match(e){return this.expandSegmentGroup(this.ngModule,this.config,e.root,on).pipe(kt(i=>this.createUrlTree(Tb(i),e.queryParams,e.fragment))).pipe(ll(i=>{throw i instanceof ip?this.noMatchError(i):i}))}noMatchError(e){return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}createUrlTree(e,t,r){const i=e.segments.length>0?new mn([],{[on]:e}):e;return new hl(i,t,r)}expandSegmentGroup(e,t,r,i){return 0===r.segments.length&&r.hasChildren()?this.expandChildren(e,t,r).pipe(kt(o=>new mn([],o))):this.expandSegment(e,r,t,r.segments,i,!0)}expandChildren(e,t,r){const i=[];for(const o of Object.keys(r.children))"primary"===o?i.unshift(o):i.push(o);return Jn(i).pipe(Kf(o=>{const s=r.children[o],a=DM(t,o);return this.expandSegmentGroup(e,a,s,o).pipe(kt(u=>({segment:u,outlet:o})))}),YT((o,s)=>(o[s.outlet]=s.segment,o),{}),function(n,e){const t=arguments.length>=2;return r=>r.pipe(n?$h((i,o)=>n(i,o,r)):yn,pb(1),t?qT(e):XT(()=>new X0))}())}expandSegment(e,t,r,i,o,s){return Jn(r).pipe(Kf(a=>this.expandSegmentAgainstRoute(e,t,r,a,i,o,s).pipe(ll(c=>{if(c instanceof ip)return Ht(null);throw c}))),Kh(a=>!!a),ll((a,u)=>{if(a instanceof X0||"EmptyError"===a.name){if(MM(t,i,o))return Ht(new mn([],{}));throw new ip(t)}throw a}))}expandSegmentAgainstRoute(e,t,r,i,o,s,a){return TM(i,t,o,s)?void 0===i.redirectTo?this.matchSegmentAgainstRoute(e,t,i,o,s):a&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,r,i,o,s):a1(t):a1(t)}expandSegmentAgainstRouteUsingRedirect(e,t,r,i,o,s){return"**"===i.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,r,i,s):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,r,i,o,s)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,r,i){const o=this.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?NM(o):this.lineralizeSegments(r,o).pipe(pr(s=>{const a=new mn(s,{});return this.expandSegment(e,a,t,s,i,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,r,i,o,s){const{matched:a,consumedSegments:u,lastChild:c,positionalParamSegments:d}=i1(t,i,o);if(!a)return a1(t);const p=this.applyRedirectCommands(u,i.redirectTo,d);return i.redirectTo.startsWith("/")?NM(p):this.lineralizeSegments(i,p).pipe(pr(m=>this.expandSegment(e,t,r,m.concat(o.slice(c)),s,!1)))}matchSegmentAgainstRoute(e,t,r,i,o){if("**"===r.path)return r.loadChildren?(r._loadedConfig?Ht(r._loadedConfig):this.configLoader.load(e.injector,r)).pipe(kt(m=>(r._loadedConfig=m,new mn(i,{})))):Ht(new mn(i,{}));const{matched:s,consumedSegments:a,lastChild:u}=i1(t,r,i);if(!s)return a1(t);const c=i.slice(u);return this.getChildConfig(e,r,i).pipe(pr(p=>{const m=p.module,y=p.routes,{segmentGroup:w,slicedSegments:C}=o1(t,a,c,y),_=new mn(w.segments,w.children);if(0===C.length&&_.hasChildren())return this.expandChildren(m,y,_).pipe(kt(M=>new mn(a,M)));if(0===y.length&&0===C.length)return Ht(new mn(a,{}));const A=ms(r)===o;return this.expandSegment(m,_,y,C,A?on:o,!0).pipe(kt(N=>new mn(a.concat(N.segments),N.children)))}))}getChildConfig(e,t,r){return t.children?Ht(new Db(t.children,e)):t.loadChildren?void 0!==t._loadedConfig?Ht(t._loadedConfig):this.runCanLoadGuards(e.injector,t,r).pipe(pr(i=>i?this.configLoader.load(e.injector,t).pipe(kt(o=>(t._loadedConfig=o,o))):function(n){return new ee(e=>e.error(mb(`Cannot load children because the guard of the route "path: '${n.path}'" returned false`)))}(t))):Ht(new Db([],e))}runCanLoadGuards(e,t,r){const i=t.canLoad;return i&&0!==i.length?Ht(i.map(s=>{const a=e.get(s);let u;if(function(n){return n&&yc(n.canLoad)}(a))u=a.canLoad(t,r);else{if(!yc(a))throw new Error("Invalid CanLoad guard");u=a(t,r)}return Ua(u)})).pipe(rp(),Zo(s=>{if(!fl(s))return;const a=mb(`Redirecting to "${this.urlSerializer.serialize(s)}"`);throw a.url=s,a}),kt(s=>!0===s)):Ht(!0)}lineralizeSegments(e,t){let r=[],i=t.root;for(;;){if(r=r.concat(i.segments),0===i.numberOfChildren)return Ht(r);if(i.numberOfChildren>1||!i.children[on])return mG(e.redirectTo);i=i.children[on]}}applyRedirectCommands(e,t,r){return this.applyRedirectCreatreUrlTree(t,this.urlSerializer.parse(t),e,r)}applyRedirectCreatreUrlTree(e,t,r,i){const o=this.createSegmentGroup(e,t.root,r,i);return new hl(o,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const r={};return Hi(e,(i,o)=>{if("string"==typeof i&&i.startsWith(":")){const a=i.substring(1);r[o]=t[a]}else r[o]=i}),r}createSegmentGroup(e,t,r,i){const o=this.createSegments(e,t.segments,r,i);let s={};return Hi(t.children,(a,u)=>{s[u]=this.createSegmentGroup(e,a,r,i)}),new mn(o,s)}createSegments(e,t,r,i){return t.map(o=>o.path.startsWith(":")?this.findPosParam(e,o,i):this.findOrReturn(o,r))}findPosParam(e,t,r){const i=r[t.path.substring(1)];if(!i)throw new Error(`Cannot redirect to '${e}'. Cannot find '${t.path}'.`);return i}findOrReturn(e,t){let r=0;for(const i of t){if(i.path===e.path)return t.splice(r),i;r++}return e}}function Tb(n){const e={};for(const r of Object.keys(n.children)){const o=Tb(n.children[r]);(o.segments.length>0||o.hasChildren())&&(e[r]=o)}return function(n){if(1===n.numberOfChildren&&n.children[on]){const e=n.children[on];return new mn(n.segments.concat(e.segments),e.children)}return n}(new mn(n.segments,e))}class OM{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class u1{constructor(e,t){this.component=e,this.route=t}}function _G(n,e,t){const r=n._root;return op(r,e?e._root:null,t,[r.value])}function c1(n,e,t){const r=function(n){if(!n)return null;for(let e=n.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig}return null}(e);return(r?r.module.injector:t).get(n)}function op(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const o=ep(e);return n.children.forEach(s=>{(function(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const o=n.value,s=e?e.value:null,a=t?t.getContext(n.value.outlet):null;if(s&&o.routeConfig===s.routeConfig){const u=function(n,e,t){if("function"==typeof t)return t(n,e);switch(t){case"pathParamsChange":return!dl(n.url,e.url);case"pathParamsOrQueryParamsChange":return!dl(n.url,e.url)||!Va(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Cb(n,e)||!Va(n.queryParams,e.queryParams);case"paramsChange":default:return!Cb(n,e)}}(s,o,o.routeConfig.runGuardsAndResolvers);u?i.canActivateChecks.push(new OM(r)):(o.data=s.data,o._resolvedData=s._resolvedData),op(n,e,o.component?a?a.children:null:t,r,i),u&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new u1(a.outlet.component,s))}else s&&sp(e,a,i),i.canActivateChecks.push(new OM(r)),op(n,null,o.component?a?a.children:null:t,r,i)})(s,o[s.value.outlet],t,r.concat([s.value]),i),delete o[s.value.outlet]}),Hi(o,(s,a)=>sp(s,t.getContext(a),i)),i}function sp(n,e,t){const r=ep(n),i=n.value;Hi(r,(o,s)=>{sp(o,i.component?e?e.children.getContext(s):null:e,t)}),t.canDeactivateChecks.push(new u1(i.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,i))}class PG{}function kM(n){return new ee(e=>e.error(n))}class LG{constructor(e,t,r,i,o,s){this.rootComponentType=e,this.config=t,this.urlTree=r,this.url=i,this.paramsInheritanceStrategy=o,this.relativeLinkResolution=s}recognize(){const e=o1(this.urlTree.root,[],[],this.config.filter(s=>void 0===s.redirectTo),this.relativeLinkResolution).segmentGroup,t=this.processSegmentGroup(this.config,e,on);if(null===t)return null;const r=new e1([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},on,this.rootComponentType,null,this.urlTree.root,-1,{}),i=new bu(r,t),o=new mM(this.url,i);return this.inheritParamsAndData(o._root),o}inheritParamsAndData(e){const t=e.value,r=gM(t,this.paramsInheritanceStrategy);t.params=Object.freeze(r.params),t.data=Object.freeze(r.data),e.children.forEach(i=>this.inheritParamsAndData(i))}processSegmentGroup(e,t,r){return 0===t.segments.length&&t.hasChildren()?this.processChildren(e,t):this.processSegment(e,t,t.segments,r)}processChildren(e,t){const r=[];for(const o of Object.keys(t.children)){const s=t.children[o],a=DM(e,o),u=this.processSegmentGroup(a,s,o);if(null===u)return null;r.push(...u)}const i=PM(r);return function(n){n.sort((e,t)=>e.value.outlet===on?-1:t.value.outlet===on?1:e.value.outlet.localeCompare(t.value.outlet))}(i),i}processSegment(e,t,r,i){for(const o of e){const s=this.processSegmentAgainstRoute(o,t,r,i);if(null!==s)return s}return MM(t,r,i)?[]:null}processSegmentAgainstRoute(e,t,r,i){if(e.redirectTo||!TM(e,t,r,i))return null;let o,s=[],a=[];if("**"===e.path){const y=r.length>0?nM(r).parameters:{};o=new e1(r,y,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,BM(e),ms(e),e.component,e,FM(t),LM(t)+r.length,VM(e))}else{const y=i1(t,e,r);if(!y.matched)return null;s=y.consumedSegments,a=r.slice(y.lastChild),o=new e1(s,y.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,BM(e),ms(e),e.component,e,FM(t),LM(t)+s.length,VM(e))}const u=function(n){return n.children?n.children:n.loadChildren?n._loadedConfig.routes:[]}(e),{segmentGroup:c,slicedSegments:d}=o1(t,s,a,u.filter(y=>void 0===y.redirectTo),this.relativeLinkResolution);if(0===d.length&&c.hasChildren()){const y=this.processChildren(u,c);return null===y?null:[new bu(o,y)]}if(0===u.length&&0===d.length)return[new bu(o,[])];const p=ms(e)===i,m=this.processSegment(u,c,d,p?on:i);return null===m?null:[new bu(o,m)]}}function UG(n){const e=n.value.routeConfig;return e&&""===e.path&&void 0===e.redirectTo}function PM(n){const e=[],t=new Set;for(const r of n){if(!UG(r)){e.push(r);continue}const i=e.find(o=>r.value.routeConfig===o.value.routeConfig);void 0!==i?(i.children.push(...r.children),t.add(i)):e.push(r)}for(const r of t){const i=PM(r.children);e.push(new bu(r.value,i))}return e.filter(r=>!t.has(r))}function FM(n){let e=n;for(;e._sourceSegment;)e=e._sourceSegment;return e}function LM(n){let e=n,t=e._segmentIndexShift?e._segmentIndexShift:0;for(;e._sourceSegment;)e=e._sourceSegment,t+=e._segmentIndexShift?e._segmentIndexShift:0;return t-1}function BM(n){return n.data||{}}function VM(n){return n.resolve||{}}function Mb(n){return yu(e=>{const t=n(e);return t?Jn(t).pipe(kt(()=>e)):Ht(e)})}class qG extends class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}{}const Rb=new Vn("ROUTES");class UM{constructor(e,t,r,i){this.loader=e,this.compiler=t,this.onLoadStartListener=r,this.onLoadEndListener=i}load(e,t){if(t._loader$)return t._loader$;this.onLoadStartListener&&this.onLoadStartListener(t);const i=this.loadModuleFactory(t.loadChildren).pipe(kt(o=>{this.onLoadEndListener&&this.onLoadEndListener(t);const s=o.create(e);return new Db(tM(s.injector.get(Rb,void 0,Pe.Self|Pe.Optional)).map(Sb),s)}),ll(o=>{throw t._loader$=void 0,o}));return t._loader$=new Me(i,()=>new ie).pipe(Ms()),t._loader$}loadModuleFactory(e){return"string"==typeof e?Jn(this.loader.load(e)):Ua(e()).pipe(pr(t=>t instanceof xD?Ht(t):Jn(this.compiler.compileModuleAsync(t))))}}class $G{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Jh,this.attachRef=null}}class Jh{constructor(){this.contexts=new Map}onChildOutletCreated(e,t){const r=this.getOrCreateContext(e);r.outlet=t,this.contexts.set(e,r)}onChildOutletDestroyed(e){const t=this.getContext(e);t&&(t.outlet=null,t.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let t=this.getContext(e);return t||(t=new $G,this.contexts.set(e,t)),t}getContext(e){return this.contexts.get(e)||null}}class QG{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,t){return e}}function ZG(n){throw n}function JG(n,e,t){return e.parse("/")}function jM(n,e){return Ht(null)}const eY={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},tY={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let No=(()=>{class n{constructor(t,r,i,o,s,a,u,c){this.rootComponentType=t,this.urlSerializer=r,this.rootContexts=i,this.location=o,this.config=c,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.lastLocationChangeInfo=null,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new ie,this.errorHandler=ZG,this.malformedUriErrorHandler=JG,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:jM,afterPreactivation:jM},this.urlHandlingStrategy=new QG,this.routeReuseStrategy=new qG,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=s.get(Ba),this.console=s.get(x0);const m=s.get(Zr);this.isNgZoneEnabled=m instanceof Zr&&Zr.isInAngularZone(),this.resetConfig(c),this.currentUrlTree=new hl(new mn([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new UM(a,u,y=>this.triggerEvent(new KT(y)),y=>this.triggerEvent(new QT(y))),this.routerState=pM(this.currentUrlTree,this.rootComponentType),this.transitions=new na({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var t;return null===(t=this.location.getState())||void 0===t?void 0:t.\u0275routerPageId}setupNavigations(t){const r=this.events;return t.pipe($h(i=>0!==i.id),kt(i=>Object.assign(Object.assign({},i),{extractedUrl:this.urlHandlingStrategy.extract(i.rawUrl)})),yu(i=>{let o=!1,s=!1;return Ht(i).pipe(Zo(a=>{this.currentNavigation={id:a.id,initialUrl:a.currentRawUrl,extractedUrl:a.extractedUrl,trigger:a.source,extras:a.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),yu(a=>{const u=this.browserUrlTree.toString(),c=!this.navigated||a.extractedUrl.toString()!==u||u!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||c)&&this.urlHandlingStrategy.shouldProcessUrl(a.rawUrl))return l1(a.source)&&(this.browserUrlTree=a.extractedUrl),Ht(a).pipe(yu(p=>{const m=this.transitions.getValue();return r.next(new gb(p.id,this.serializeUrl(p.extractedUrl),p.source,p.restoredState)),m!==this.transitions.getValue()?qh:Promise.resolve(p)}),function(n,e,t,r){return yu(i=>function(n,e,t,r,i){return new xG(n,e,t,r,i).apply()}(n,e,t,i.extractedUrl,r).pipe(kt(o=>Object.assign(Object.assign({},i),{urlAfterRedirects:o}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Zo(p=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:p.urlAfterRedirects})}),function(n,e,t,r,i){return pr(o=>function(n,e,t,r,i="emptyOnly",o="legacy"){try{const s=new LG(n,e,t,r,i,o).recognize();return null===s?kM(new PG):Ht(s)}catch(s){return kM(s)}}(n,e,o.urlAfterRedirects,t(o.urlAfterRedirects),r,i).pipe(kt(s=>Object.assign(Object.assign({},o),{targetSnapshot:s}))))}(this.rootComponentType,this.config,p=>this.serializeUrl(p),this.paramsInheritanceStrategy,this.relativeLinkResolution),Zo(p=>{"eager"===this.urlUpdateStrategy&&(p.extras.skipLocationChange||this.setBrowserUrl(p.urlAfterRedirects,p),this.browserUrlTree=p.urlAfterRedirects);const m=new gz(p.id,this.serializeUrl(p.extractedUrl),this.serializeUrl(p.urlAfterRedirects),p.targetSnapshot);r.next(m)}));if(c&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:m,extractedUrl:y,source:w,restoredState:C,extras:_}=a,A=new gb(m,this.serializeUrl(y),w,C);r.next(A);const T=pM(y,this.rootComponentType).snapshot;return Ht(Object.assign(Object.assign({},a),{targetSnapshot:T,urlAfterRedirects:y,extras:Object.assign(Object.assign({},_),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=a.rawUrl,this.browserUrlTree=a.urlAfterRedirects,a.resolve(null),qh}),Mb(a=>{const{targetSnapshot:u,id:c,extractedUrl:d,rawUrl:p,extras:{skipLocationChange:m,replaceUrl:y}}=a;return this.hooks.beforePreactivation(u,{navigationId:c,appliedUrlTree:d,rawUrlTree:p,skipLocationChange:!!m,replaceUrl:!!y})}),Zo(a=>{const u=new mz(a.id,this.serializeUrl(a.extractedUrl),this.serializeUrl(a.urlAfterRedirects),a.targetSnapshot);this.triggerEvent(u)}),kt(a=>Object.assign(Object.assign({},a),{guards:_G(a.targetSnapshot,a.currentSnapshot,this.rootContexts)})),function(n,e){return pr(t=>{const{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:o,canDeactivateChecks:s}}=t;return 0===s.length&&0===o.length?Ht(Object.assign(Object.assign({},t),{guardsResult:!0})):function(n,e,t,r){return Jn(n).pipe(pr(i=>function(n,e,t,r,i){const o=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return o&&0!==o.length?Ht(o.map(a=>{const u=c1(a,e,i);let c;if(function(n){return n&&yc(n.canDeactivate)}(u))c=Ua(u.canDeactivate(n,e,t,r));else{if(!yc(u))throw new Error("Invalid CanDeactivate guard");c=Ua(u(n,e,t,r))}return c.pipe(Kh())})).pipe(rp()):Ht(!0)}(i.component,i.route,t,e,r)),Kh(i=>!0!==i,!0))}(s,r,i,n).pipe(pr(a=>a&&function(n){return"boolean"==typeof n}(a)?function(n,e,t,r){return Jn(e).pipe(Kf(i=>db(function(n,e){return null!==n&&e&&e(new bz(n)),Ht(!0)}(i.route.parent,r),function(n,e){return null!==n&&e&&e(new _z(n)),Ht(!0)}(i.route,r),function(n,e,t){const r=e[e.length-1],o=e.slice(0,e.length-1).reverse().map(s=>function(n){const e=n.routeConfig?n.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:n,guards:e}:null}(s)).filter(s=>null!==s).map(s=>zT(()=>Ht(s.guards.map(u=>{const c=c1(u,s.node,t);let d;if(function(n){return n&&yc(n.canActivateChild)}(c))d=Ua(c.canActivateChild(r,n));else{if(!yc(c))throw new Error("Invalid CanActivateChild guard");d=Ua(c(r,n))}return d.pipe(Kh())})).pipe(rp())));return Ht(o).pipe(rp())}(n,i.path,t),function(n,e,t){const r=e.routeConfig?e.routeConfig.canActivate:null;return r&&0!==r.length?Ht(r.map(o=>zT(()=>{const s=c1(o,e,t);let a;if(function(n){return n&&yc(n.canActivate)}(s))a=Ua(s.canActivate(e,n));else{if(!yc(s))throw new Error("Invalid CanActivate guard");a=Ua(s(e,n))}return a.pipe(Kh())}))).pipe(rp()):Ht(!0)}(n,i.route,t))),Kh(i=>!0!==i,!0))}(r,o,n,e):Ht(a)),kt(a=>Object.assign(Object.assign({},t),{guardsResult:a})))})}(this.ngModule.injector,a=>this.triggerEvent(a)),Zo(a=>{if(fl(a.guardsResult)){const c=mb(`Redirecting to "${this.serializeUrl(a.guardsResult)}"`);throw c.url=a.guardsResult,c}const u=new vz(a.id,this.serializeUrl(a.extractedUrl),this.serializeUrl(a.urlAfterRedirects),a.targetSnapshot,!!a.guardsResult);this.triggerEvent(u)}),$h(a=>!!a.guardsResult||(this.restoreHistory(a),this.cancelNavigationTransition(a,""),!1)),Mb(a=>{if(a.guards.canActivateChecks.length)return Ht(a).pipe(Zo(u=>{const c=new yz(u.id,this.serializeUrl(u.extractedUrl),this.serializeUrl(u.urlAfterRedirects),u.targetSnapshot);this.triggerEvent(c)}),yu(u=>{let c=!1;return Ht(u).pipe(function(n,e){return pr(t=>{const{targetSnapshot:r,guards:{canActivateChecks:i}}=t;if(!i.length)return Ht(t);let o=0;return Jn(i).pipe(Kf(s=>function(n,e,t,r){return function(n,e,t,r){const i=Object.keys(n);if(0===i.length)return Ht({});const o={};return Jn(i).pipe(pr(s=>function(n,e,t,r){const i=c1(n,e,r);return Ua(i.resolve?i.resolve(e,t):i(e,t))}(n[s],e,t,r).pipe(Zo(a=>{o[s]=a}))),pb(1),pr(()=>Object.keys(o).length===i.length?Ht(o):qh))}(n._resolve,n,e,r).pipe(kt(o=>(n._resolvedData=o,n.data=Object.assign(Object.assign({},n.data),gM(n,t).resolve),null)))}(s.route,r,n,e)),Zo(()=>o++),pb(1),pr(s=>o===i.length?Ht(t):qh))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Zo({next:()=>c=!0,complete:()=>{c||(this.restoreHistory(u),this.cancelNavigationTransition(u,"At least one route resolver didn't emit any value."))}}))}),Zo(u=>{const c=new xz(u.id,this.serializeUrl(u.extractedUrl),this.serializeUrl(u.urlAfterRedirects),u.targetSnapshot);this.triggerEvent(c)}))}),Mb(a=>{const{targetSnapshot:u,id:c,extractedUrl:d,rawUrl:p,extras:{skipLocationChange:m,replaceUrl:y}}=a;return this.hooks.afterPreactivation(u,{navigationId:c,appliedUrlTree:d,rawUrlTree:p,skipLocationChange:!!m,replaceUrl:!!y})}),kt(a=>{const u=function(n,e,t){const r=t1(n,e._root,t?t._root:void 0);return new fM(r,e)}(this.routeReuseStrategy,a.targetSnapshot,a.currentRouterState);return Object.assign(Object.assign({},a),{targetRouterState:u})}),Zo(a=>{this.currentUrlTree=a.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(a.urlAfterRedirects,a.rawUrl),this.routerState=a.targetRouterState,"deferred"===this.urlUpdateStrategy&&(a.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,a),this.browserUrlTree=a.urlAfterRedirects)}),((n,e,t)=>kt(r=>(new rG(e,r.targetRouterState,r.currentRouterState,t).activate(n),r)))(this.rootContexts,this.routeReuseStrategy,a=>this.triggerEvent(a)),Zo({next(){o=!0},complete(){o=!0}}),function(n){return e=>e.lift(new dz(n))}(()=>{var a;if(!o&&!s){const u=`Navigation ID ${i.id} is not equal to the current navigation id ${this.navigationId}`;"replace"===this.canceledNavigationResolution?(this.restoreHistory(i),this.cancelNavigationTransition(i,u)):this.cancelNavigationTransition(i,u)}(null===(a=this.currentNavigation)||void 0===a?void 0:a.id)===i.id&&(this.currentNavigation=null)}),ll(a=>{if(s=!0,function(n){return n&&n[JT]}(a)){const u=fl(a.url);u||(this.navigated=!0,this.restoreHistory(i,!0));const c=new $T(i.id,this.serializeUrl(i.extractedUrl),a.message);r.next(c),u?setTimeout(()=>{const d=this.urlHandlingStrategy.merge(a.url,this.rawUrlTree),p={skipLocationChange:i.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||l1(i.source)};this.scheduleNavigation(d,"imperative",null,p,{resolve:i.resolve,reject:i.reject,promise:i.promise})},0):i.resolve(!1)}else{this.restoreHistory(i,!0);const u=new pz(i.id,this.serializeUrl(i.extractedUrl),a);r.next(u);try{i.resolve(this.errorHandler(a))}catch(c){i.reject(c)}}return qh}))}))}resetRootComponentType(t){this.rootComponentType=t,this.routerState.root.component=this.rootComponentType}getTransition(){const t=this.transitions.value;return t.urlAfterRedirects=this.browserUrlTree,t}setTransition(t){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),t))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const r=this.extractLocationChangeInfoFromEvent(t);this.shouldScheduleNavigation(this.lastLocationChangeInfo,r)&&setTimeout(()=>{const{source:i,state:o,urlTree:s}=r,a={replaceUrl:!0};if(o){const u=Object.assign({},o);delete u.navigationId,delete u.\u0275routerPageId,0!==Object.keys(u).length&&(a.state=u)}this.scheduleNavigation(s,i,o,a)},0),this.lastLocationChangeInfo=r}))}extractLocationChangeInfoFromEvent(t){var r;return{source:"popstate"===t.type?"popstate":"hashchange",urlTree:this.parseUrl(t.url),state:(null===(r=t.state)||void 0===r?void 0:r.navigationId)?t.state:null,transitionId:this.getTransition().id}}shouldScheduleNavigation(t,r){if(!t)return!0;const i=r.urlTree.toString()===t.urlTree.toString();return r.transitionId!==t.transitionId||!i||!("hashchange"===r.source&&"popstate"===t.source||"popstate"===r.source&&"hashchange"===t.source)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(t){this.events.next(t)}resetConfig(t){AM(t),this.config=t.map(Sb),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(t,r={}){const{relativeTo:i,queryParams:o,fragment:s,queryParamsHandling:a,preserveFragment:u}=r,c=i||this.routerState.root,d=u?this.currentUrlTree.fragment:s;let p=null;switch(a){case"merge":p=Object.assign(Object.assign({},this.currentUrlTree.queryParams),o);break;case"preserve":p=this.currentUrlTree.queryParams;break;default:p=o||null}return null!==p&&(p=this.removeEmptyProps(p)),function(n,e,t,r,i){if(0===t.length)return Eb(e.root,e.root,e,r,i);const o=function(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new bM(!0,0,n);let e=0,t=!1;const r=n.reduce((i,o,s)=>{if("object"==typeof o&&null!=o){if(o.outlets){const a={};return Hi(o.outlets,(u,c)=>{a[c]="string"==typeof u?u.split("/"):u}),[...i,{outlets:a}]}if(o.segmentPath)return[...i,o.segmentPath]}return"string"!=typeof o?[...i,o]:0===s?(o.split("/").forEach((a,u)=>{0==u&&"."===a||(0==u&&""===a?t=!0:".."===a?e++:""!=a&&i.push(a))}),i):[...i,o]},[]);return new bM(t,e,r)}(t);if(o.toRoot())return Eb(e.root,new mn([],{}),e,r,i);const s=function(n,e,t){if(n.isAbsolute)return new Ib(e.root,!0,0);if(-1===t.snapshot._lastPathIndex){const o=t.snapshot._urlSegment;return new Ib(o,o===e.root,0)}const r=n1(n.commands[0])?0:1;return function(n,e,t){let r=n,i=e,o=t;for(;o>i;){if(o-=i,r=r.parent,!r)throw new Error("Invalid number of '../'");i=r.segments.length}return new Ib(r,!1,i-o)}(t.snapshot._urlSegment,t.snapshot._lastPathIndex+r,n.numberOfDoubleDots)}(o,e,n),a=s.processChildren?r1(s.segmentGroup,s.index,o.commands):wM(s.segmentGroup,s.index,o.commands);return Eb(s.segmentGroup,a,e,r,i)}(c,this.currentUrlTree,t,p,null!=d?d:null)}navigateByUrl(t,r={skipLocationChange:!1}){const i=fl(t)?t:this.parseUrl(t),o=this.urlHandlingStrategy.merge(i,this.rawUrlTree);return this.scheduleNavigation(o,"imperative",null,r)}navigate(t,r={skipLocationChange:!1}){return function(n){for(let e=0;e<n.length;e++){const t=n[e];if(null==t)throw new Error(`The requested path contains ${t} segment at index ${e}`)}}(t),this.navigateByUrl(this.createUrlTree(t,r),r)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let r;try{r=this.urlSerializer.parse(t)}catch(i){r=this.malformedUriErrorHandler(i,this.urlSerializer,t)}return r}isActive(t,r){let i;if(i=!0===r?Object.assign({},eY):!1===r?Object.assign({},tY):r,fl(t))return iM(this.currentUrlTree,t,i);const o=this.parseUrl(t);return iM(this.currentUrlTree,o,i)}removeEmptyProps(t){return Object.keys(t).reduce((r,i)=>{const o=t[i];return null!=o&&(r[i]=o),r},{})}processNavigations(){this.navigations.subscribe(t=>{this.navigated=!0,this.lastSuccessfulId=t.id,this.currentPageId=t.targetPageId,this.events.next(new Qf(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,t.resolve(!0)},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)})}scheduleNavigation(t,r,i,o,s){var a,u;if(this.disposed)return Promise.resolve(!1);const c=this.getTransition(),d=l1(r)&&c&&!l1(c.source),y=(this.lastSuccessfulId===c.id||this.currentNavigation?c.rawUrl:c.urlAfterRedirects).toString()===t.toString();if(d&&y)return Promise.resolve(!0);let w,C,_;s?(w=s.resolve,C=s.reject,_=s.promise):_=new Promise((N,M)=>{w=N,C=M});const A=++this.navigationId;let T;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(i=this.location.getState()),T=i&&i.\u0275routerPageId?i.\u0275routerPageId:o.replaceUrl||o.skipLocationChange?null!==(a=this.browserPageId)&&void 0!==a?a:0:(null!==(u=this.browserPageId)&&void 0!==u?u:0)+1):T=0,this.setTransition({id:A,targetPageId:T,source:r,restoredState:i,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:t,extras:o,resolve:w,reject:C,promise:_,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),_.catch(N=>Promise.reject(N))}setBrowserUrl(t,r){const i=this.urlSerializer.serialize(t),o=Object.assign(Object.assign({},r.extras.state),this.generateNgRouterState(r.id,r.targetPageId));this.location.isCurrentPathEqualTo(i)||r.extras.replaceUrl?this.location.replaceState(i,"",o):this.location.go(i,"",o)}restoreHistory(t,r=!1){var i,o;if("computed"===this.canceledNavigationResolution){const s=this.currentPageId-t.targetPageId;"popstate"!==t.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(i=this.currentNavigation)||void 0===i?void 0:i.finalUrl)||0===s?this.currentUrlTree===(null===(o=this.currentNavigation)||void 0===o?void 0:o.finalUrl)&&0===s&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(s)}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(t,r){const i=new $T(t.id,this.serializeUrl(t.extractedUrl),r);this.triggerEvent(i),t.resolve(!1)}generateNgRouterState(t,r){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:r}:{navigationId:t}}}return n.\u0275fac=function(t){return new(t||n)(Ye(Tg),Ye(vb),Ye(Jh),Ye(N0),Ye(Yn),Ye(w0),Ye(ol),Ye(void 0))},n.\u0275prov=Ve({token:n,factory:n.\u0275fac}),n})();function l1(n){return"imperative"!==n}let h1=(()=>{class n{constructor(t,r,i){this.router=t,this.route=r,this.locationStrategy=i,this.commands=[],this.onChanges=new ie,this.subscription=t.events.subscribe(o=>{o instanceof Qf&&this.updateTargetUrlAndHref()})}set routerLink(t){this.commands=null!=t?Array.isArray(t)?t:[t]:[]}ngOnChanges(t){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(t,r,i,o,s){if(0!==t||r||i||o||s||"string"==typeof this.target&&"_self"!=this.target)return!0;const a={skipLocationChange:ed(this.skipLocationChange),replaceUrl:ed(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,a),!1}updateTargetUrlAndHref(){this.href=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree))}get urlTree(){return this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:ed(this.preserveFragment)})}}return n.\u0275fac=function(t){return new(t||n)(ut(No),ut(Zh),ut(Xh))},n.\u0275dir=Je({type:n,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(t,r){1&t&&Qn("click",function(o){return r.onClick(o.button,o.ctrlKey,o.shiftKey,o.altKey,o.metaKey)}),2&t&&(Oy("href",r.href,Bg),_y("target",r.target))},inputs:{routerLink:"routerLink",target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo"},features:[E]}),n})();function ed(n){return""===n||!!n}let Ob=(()=>{class n{constructor(t,r,i,o,s){this.parentContexts=t,this.location=r,this.resolver=i,this.changeDetector=s,this.activated=null,this._activatedRoute=null,this.activateEvents=new ii,this.deactivateEvents=new ii,this.name=o||on,t.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const t=this.parentContexts.getContext(this.name);t&&t.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,t}attach(t,r){this.activated=t,this._activatedRoute=r,this.location.insert(t.hostView)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,r){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=t;const s=(r=r||this.resolver).resolveComponentFactory(t._futureSnapshot.routeConfig.component),a=this.parentContexts.getOrCreateContext(this.name).children,u=new oY(t,a,this.location.injector);this.activated=this.location.createComponent(s,this.location.length,u),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return n.\u0275fac=function(t){return new(t||n)(ut(Jh),ut(qs),ut(du),function(n){return function(n,e){if("class"===e)return n.classes;if("style"===e)return n.styles;const t=n.attrs;if(t){const r=t.length;let i=0;for(;i<r;){const o=t[i];if(cC(o))break;if(0===o)i+=2;else if("number"==typeof o)for(i++;i<r&&"string"==typeof t[i];)i++;else{if(o===e)return t[i+1];i+=2}}}return null}(vi(),n)}("name"),ut(Ef))},n.\u0275dir=Je({type:n,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),n})();class oY{constructor(e,t,r){this.route=e,this.childContexts=t,this.parent=r}get(e,t){return e===Zh?this.route:e===Jh?this.childContexts:this.parent.get(e,t)}}class WM{}class HM{preload(e,t){return Ht(null)}}let zM=(()=>{class n{constructor(t,r,i,o,s){this.router=t,this.injector=o,this.preloadingStrategy=s,this.loader=new UM(r,i,c=>t.triggerEvent(new KT(c)),c=>t.triggerEvent(new QT(c)))}setUpPreloading(){this.subscription=this.router.events.pipe($h(t=>t instanceof Qf),Kf(()=>this.preload())).subscribe(()=>{})}preload(){const t=this.injector.get(Ba);return this.processRoutes(t,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,r){const i=[];for(const o of r)if(o.loadChildren&&!o.canLoad&&o._loadedConfig){const s=o._loadedConfig;i.push(this.processRoutes(s.module,s.routes))}else o.loadChildren&&!o.canLoad?i.push(this.preloadConfig(t,o)):o.children&&i.push(this.processRoutes(t,o.children));return Jn(i).pipe(Ui(),kt(o=>{}))}preloadConfig(t,r){return this.preloadingStrategy.preload(r,()=>(r._loadedConfig?Ht(r._loadedConfig):this.loader.load(t.injector,r)).pipe(pr(o=>(r._loadedConfig=o,this.processRoutes(o.module,o.routes)))))}}return n.\u0275fac=function(t){return new(t||n)(Ye(No),Ye(w0),Ye(ol),Ye(Yn),Ye(WM))},n.\u0275prov=Ve({token:n,factory:n.\u0275fac}),n})(),kb=(()=>{class n{constructor(t,r,i={}){this.router=t,this.viewportScroller=r,this.options=i,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},i.scrollPositionRestoration=i.scrollPositionRestoration||"disabled",i.anchorScrolling=i.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(t=>{t instanceof gb?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof Qf&&(this.lastId=t.id,this.scheduleScrollEvent(t,this.router.parseUrl(t.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(t=>{t instanceof ZT&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,r){this.router.triggerEvent(new ZT(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return n.\u0275fac=function(t){return new(t||n)(Ye(No),Ye(ST),Ye(void 0))},n.\u0275prov=Ve({token:n,factory:n.\u0275fac}),n})();const pl=new Vn("ROUTER_CONFIGURATION"),GM=new Vn("ROUTER_FORROOT_GUARD"),aY=[N0,{provide:vb,useClass:uM},{provide:No,useFactory:function(n,e,t,r,i,o,s,a={},u,c){const d=new No(null,n,e,t,r,i,o,tM(s));return u&&(d.urlHandlingStrategy=u),c&&(d.routeReuseStrategy=c),function(n,e){n.errorHandler&&(e.errorHandler=n.errorHandler),n.malformedUriErrorHandler&&(e.malformedUriErrorHandler=n.malformedUriErrorHandler),n.onSameUrlNavigation&&(e.onSameUrlNavigation=n.onSameUrlNavigation),n.paramsInheritanceStrategy&&(e.paramsInheritanceStrategy=n.paramsInheritanceStrategy),n.relativeLinkResolution&&(e.relativeLinkResolution=n.relativeLinkResolution),n.urlUpdateStrategy&&(e.urlUpdateStrategy=n.urlUpdateStrategy)}(a,d),a.enableTracing&&d.events.subscribe(p=>{var m,y;null===(m=console.group)||void 0===m||m.call(console,`Router Event: ${p.constructor.name}`),console.log(p.toString()),console.log(p),null===(y=console.groupEnd)||void 0===y||y.call(console)}),d},deps:[vb,Jh,N0,Yn,w0,ol,Rb,pl,[class{},new Mo],[class{},new Mo]]},Jh,{provide:Zh,useFactory:function(n){return n.routerState.root},deps:[No]},{provide:w0,useClass:tU},zM,HM,class{preload(e,t){return t().pipe(ll(()=>Ht(null)))}},{provide:pl,useValue:{enableTracing:!1}}];function uY(){return new Ex("Router",No)}let YM=(()=>{class n{constructor(t,r){}static forRoot(t,r){return{ngModule:n,providers:[aY,XM(t),{provide:GM,useFactory:hY,deps:[[No,new Mo,new ac]]},{provide:pl,useValue:r||{}},{provide:Xh,useFactory:lY,deps:[cl,[new ch(jx),new Mo],pl]},{provide:kb,useFactory:cY,deps:[No,ST,pl]},{provide:WM,useExisting:r&&r.preloadingStrategy?r.preloadingStrategy:HM},{provide:Ex,multi:!0,useFactory:uY},[Pb,{provide:Bf,multi:!0,useFactory:gY,deps:[Pb]},{provide:qM,useFactory:mY,deps:[Pb]},{provide:_S,multi:!0,useExisting:qM}]]}}static forChild(t){return{ngModule:n,providers:[XM(t)]}}}return n.\u0275fac=function(t){return new(t||n)(Ye(GM,8),Ye(No,8))},n.\u0275mod=gt({type:n}),n.\u0275inj=ji({}),n})();function cY(n,e,t){return t.scrollOffset&&e.setOffset(t.scrollOffset),new kb(n,e,t)}function lY(n,e,t={}){return t.useHash?new wj(n,e):new dT(n,e)}function hY(n){return"guarded"}function XM(n){return[{provide:IF,multi:!0,useValue:n},{provide:Rb,multi:!0,useValue:n}]}let Pb=(()=>{class n{constructor(t){this.injector=t,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new ie}appInitializer(){return this.injector.get(yj,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let r=null;const i=new Promise(a=>r=a),o=this.injector.get(No),s=this.injector.get(pl);return"disabled"===s.initialNavigation?(o.setUpLocationChangeListener(),r(!0)):"enabled"===s.initialNavigation||"enabledBlocking"===s.initialNavigation?(o.hooks.afterPreactivation=()=>this.initNavigation?Ht(null):(this.initNavigation=!0,r(!0),this.resultOfPreactivationDone),o.initialNavigation()):r(!0),i})}bootstrapListener(t){const r=this.injector.get(pl),i=this.injector.get(zM),o=this.injector.get(kb),s=this.injector.get(No),a=this.injector.get(sl);t===a.components[0]&&(("enabledNonBlocking"===r.initialNavigation||void 0===r.initialNavigation)&&s.initialNavigation(),i.setUpPreloading(),o.init(),s.resetRootComponentType(a.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return n.\u0275fac=function(t){return new(t||n)(Ye(Yn))},n.\u0275prov=Ve({token:n,factory:n.\u0275fac}),n})();function gY(n){return n.appInitializer.bind(n)}function mY(n){return n.bootstrapListener.bind(n)}const qM=new Vn("Router Initializer");function $M(n,e,t,r,i,o,s){try{var a=n[o](s),u=a.value}catch(c){return void t(c)}a.done?e(u):Promise.resolve(u).then(r,i)}function qn(n){return function(){var e=this,t=arguments;return new Promise(function(r,i){var o=n.apply(e,t);function s(u){$M(o,r,i,s,a,"next",u)}function a(u){$M(o,r,i,s,a,"throw",u)}s(void 0)})}}const d1={minkowskyWeight:3};var bY=me(394);const ra_faceApiSourceUrl="https://cdn.jsdelivr.net/gh/cgarciagl/face-api.js/weights",wY={modelComplexity:1,smoothLandmarks:!0,enableSegmentation:!0,smoothSegmentation:!0,minDetectionConfidence:.5,minTrackingConfidence:.5};let _Y=(()=>{class n{constructor(){this.initTempPoseInstance()}getPoseInstance(t,r=wY){var i=this;return qn(function*(){const o=yield i.useTempPoseInstance();return o.setOptions(r),o.onResults(t),o})()}useTempPoseInstance(){var t=this;return qn(function*(){let r;return t._poseInstance?r=t._poseInstance:(r=yield t.createTempPoseInstance(),t.initTempPoseInstance()),r})()}initTempPoseInstance(){var t=this;return qn(function*(){t._poseInstance=yield t.createTempPoseInstance()})()}createTempPoseInstance(){return qn(function*(){const t=new bY.Pose({locateFile:r=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5.1635988162/${r}`});return yield t.initialize(),t})()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ve({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var KM=function(n,e){return(KM=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])})(n,e)};function ia(n,e){function t(){this.constructor=n}KM(n,e),n.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}function tt(n,e,t,r){return new(t||(t=Promise))(function(i,o){function s(c){try{u(r.next(c))}catch(d){o(d)}}function a(c){try{u(r.throw(c))}catch(d){o(d)}}function u(c){c.done?i(c.value):new t(function(d){d(c.value)}).then(s,a)}u((r=r.apply(n,e||[])).next())})}function nt(n,e){var t,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(c){return function(d){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,r&&(i=2&d[0]?r.return:d[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,d[1])).done)return i;switch(r=0,i&&(d=[2&d[0],i.value]),d[0]){case 0:case 1:i=d;break;case 4:return s.label++,{value:d[1],done:!1};case 5:s.label++,r=d[1],d=[0];continue;case 7:d=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===d[0]||2===d[0])){s=0;continue}if(3===d[0]&&(!i||d[1]>i[0]&&d[1]<i[3])){s.label=d[1];break}if(6===d[0]&&s.label<i[1]){s.label=i[1],i=d;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(d);break}i[2]&&s.ops.pop(),s.trys.pop();continue}d=e.call(n,s)}catch(p){d=[6,p],r=0}finally{t=i=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}([u,c])}}}var CY=function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},null!=this.urlFlags[e]){var i=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+i+"."),this.set(e,i)}},n.prototype.get=function(e){return e in this.flags||(this.flags[e]=this.evaluateFlag(e)),this.flags[e]},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),n.prototype.set=function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var r,i=(r={},this.global.location.search.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(o){for(var s=[],a=1;a<arguments.length;a++)s[a-1]=arguments[a];return EY(r,s[0],s[1]),s.join("=")}),r);"tfjsflags"in i&&i.tfjsflags.split(",").forEach(function(o){var s=o.split(":"),a=s[0];e.urlFlags[a]=function(c,d){if("true"===(d=d.toLowerCase())||"false"===d)return"true"===d;if(""+ +d===d)return+d;throw new Error("Could not parse value flag value "+d+" for flag "+c+".")}(a,s[1])})}},n}();function EY(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function ge(){return QM}var QM=null,td=new Map,ap=new Map;function ZM(n,e){var t=Fb(n,e);return td.get(t)}function JM(n){for(var e=td.entries(),t=[];;){var r=e.next(),o=r.value;if(r.done)break;var a=o[1];o[0].split("_")[0]===n&&t.push(a)}return t}function eR(n){var e=n.kernelName,t=n.backendName,r=Fb(e,t);if(td.has(r))throw new Error("The kernel '"+e+"' for backend '"+t+"' is already registered");td.set(r,n)}function AY(n){var e=n.kernelName;ap.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),ap.set(e,n)}function Fb(n,e){return e+"_"+n}function tR(n){for(var e=n.length,t=0,r=0;e>0;)r=Math.random()*e|0,t=n[--e],n[e]=n[r],n[r]=t}function f1(n,e,t){return Math.max(n,Math.min(e,t))}function Lb(n){return n%2==0?n:n+1}function nR(n){for(var e=0,t=0;t<n.length;t++)e+=n[t];return e}function X(n,e){if(!n)throw new Error("string"==typeof e?e:e())}function Rn(n,e,t){void 0===t&&(t=""),X(ai(n,e),function(){return t+" Shapes "+n+" and "+e+" must match"})}function gl(n){X(null!=n,function(){return"The input to the tensor constructor must be a non-null value."})}function wu(n,e,t){if(void 0===e&&(e=[]),void 0===t&&(t=!1),null==e&&(e=[]),Array.isArray(n)||zi(n)&&!t)for(var r=0;r<n.length;++r)wu(n[r],e,t);else e.push(n);return e}function st(n){if(0===n.length)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function ai(n,e){if(n===e)return!0;if(null==n||null==e||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Rr(n){return n%1==0}function rR(n){if(null!=Math.tanh)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var e=Math.exp(2*n);return(e-1)/(e+1)}function p1(n){var e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function ml(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function Bb(n,e,t){return void 0===e&&(e=function(r){return 0}),new Promise(function(r,i){var o=0,s=function(){if(n())r();else{o++;var a=e(o);null!=t&&o>=t?i():setTimeout(s,a)}};s()})}function iR(n,e){for(var t=1,r=-1,i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(-1===n[i]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(n[i]<0)throw Error("Shapes can not be < 0. Found "+n[i]+" at dim "+i);if(-1===r){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+n);return n}if(0===t)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var o=n.slice();return o[r]=e/t,o}function ui(n,e){var t=e.length;return X((n=null==n?e.map(function(r,i){return i}):[].concat(n)).every(function(r){return r>=-t&&r<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+n}),X(n.every(function(r){return Rr(r)}),function(){return"All values in axis param must be integers but got axis "+n}),n.map(function(r){return r<0?t+r:r})}function xc(n,e){for(var t=[],r=[],i=null!=e&&Array.isArray(e)&&0===e.length,o=null==e||i?null:ui(e,n).sort(),s=0,a=0;a<n.length;++a){if(null!=o){if(o[s]===a&&1!==n[a])throw new Error("Can't squeeze axis "+a+" since its dim '"+n[a]+"' is not 1");(null==o[s]||o[s]>a)&&1===n[a]&&(t.push(n[a]),r.push(a)),o[s]<=a&&s++}1!==n[a]&&(t.push(n[a]),r.push(a))}return{newShape:t,keptDims:r}}function nd(n,e){var t=null;if(null==n||"float32"===n)t=new Float32Array(e);else if("int32"===n)t=new Int32Array(e);else{if("bool"!==n)throw new Error("Unknown data type "+n);t=new Uint8Array(e)}return t}function up(n,e){var t=null;if(null==n||"float32"===n)t=new Float32Array(e);else if("int32"===n)t=new Int32Array(e);else if("bool"===n)t=new Uint8Array(e);else{if("string"!==n)throw new Error("Unknown data type "+n);t=new Array(e)}return t}function oR(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function sR(n){return"bool"===n||"complex64"===n||"float32"===n||"int32"===n||"string"===n}function aR(n,e){return!("complex64"===e||"float32"===e&&"complex64"!==n||"int32"===e&&"float32"!==n&&"complex64"!==n||"bool"===e&&"bool"===n)}function zi(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function Vb(n){if("float32"===n||"int32"===n)return 4;if("complex64"===n)return 8;if("bool"===n)return 1;throw new Error("Unknown dtype "+n)}function uR(n){if(null==n)return 0;var e=0;return n.forEach(function(t){return e+=t.length}),e}function bc(n){return"string"==typeof n||n instanceof String}function cR(n){return"boolean"==typeof n}function lR(n){return"number"==typeof n}function rd(n){return Array.isArray(n)?rd(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":lR(n)?"float32":bc(n)?"string":cR(n)?"bool":"float32"}function wc(n){return!!(n&&n.constructor&&n.call&&n.apply)}function g1(n,e){for(var t=e;t<n;++t)if(n%t==0)return t;return n}function oa(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function Ub(n,e,t){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=wu(n)),t&&oR(n,e),s=e,(o=n)instanceof Float32Array&&"float32"===s||o instanceof Int32Array&&"int32"===s||o instanceof Uint8Array&&"bool"===s)return n;var o,s;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(n);if("int32"===e)return new Int32Array(n);if("bool"===e){for(var r=new Uint8Array(n.length),i=0;i<r.length;++i)0!==Math.round(n[i])&&(r[i]=1);return r}throw new Error("Unknown data type "+e)}function jb(n,e){if(0===n.length)return e[0];var t=n.reduce(function(r,i){return r*i});if(0===t)return[];if(t!==e.length)throw new Error("["+n+"] does not match the input size.");return function r(i,o,s){var a=new Array;if(1===o.length)for(var u=o[0],c=0;c<u;c++)a[c]=s[i+c];else{u=o[0];var d=o.slice(1),p=d.reduce(function(m,y){return m*y});for(c=0;c<u;c++)a[c]=r(i+c*p,d,s)}return a}(0,n,e)}function Wb(n,e){for(var t=id(n,e),r=0;r<t.length;r++)t[r]=1;return t}function id(n,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(n);if("int32"===e)return new Int32Array(n);if("bool"===e)return new Uint8Array(n);throw new Error("Unknown data type "+e)}function sa(){return ge().platform.now()}function Hb(n){n.forEach(function(e){X(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."})})}function hR(n,e){return void 0===e&&(e="utf-8"),e=e||"utf-8",ge().platform.encode(n,e)}function cp(n,e){return void 0===e&&(e="utf-8"),e=e||"utf-8",ge().platform.decode(n,e)}function zb(n,e,t){if(0===e)return 0;if(1===e)return n[0];for(var r=n[n.length-1],i=0;i<n.length-1;++i)r+=t[i]*n[i];return r}function dR(n,e,t){if(0===e)return[];if(1===e)return[n];for(var r=new Array(e),i=0;i<r.length-1;++i)r[i]=Math.floor(n/t[i]),n-=r[i]*t[i];return r[r.length-1]=n,r}Object.freeze({shuffle:tR,clamp:f1,nearestLargerEven:Lb,sum:nR,randUniform:function(n,e){var t=Math.random();return e*t+(1-t)*n},distSquared:function(n,e){for(var t=0,r=0;r<n.length;r++){var i=Number(n[r])-Number(e[r]);t+=i*i}return t},assert:X,assertShapesMatch:Rn,assertNonNull:gl,flatten:wu,sizeFromShape:st,isScalarShape:function(n){return 0===n.length},arraysEqual:ai,isInt:Rr,tanh:rR,sizeToSquarishShape:p1,createShuffledIndices:function(n){for(var e=new Uint32Array(n),t=0;t<n;++t)e[t]=t;return tR(e),e},rightPad:ml,repeatedTry:Bb,inferFromImplicitShape:iR,parseAxisParam:ui,squeezeShape:xc,getTypedArrayFromDType:nd,getArrayFromDType:up,checkConversionForErrors:oR,isValidDtype:sR,hasEncodingLoss:aR,isTypedArray:zi,bytesPerElement:Vb,bytesFromStringArray:uR,isString:bc,isBoolean:cR,isNumber:lR,inferDtype:rd,isFunction:wc,nearestDivisor:g1,computeStrides:oa,toTypedArray:Ub,toNestedArray:jb,makeOnesTypedArray:Wb,makeZerosTypedArray:id,now:sa,assertNonNegativeIntegerDimensions:Hb,fetch:function(n,e){return ge().platform.fetch(n,e)},encodeString:hR,decodeString:cp,locToIndex:zb,indexToLoc:dR});var DY=function(){function n(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new SY)}return n.prototype.profileKernel=function(e,t,r){var i,o=this,s=this.backendTimer.time(function(){i=r()});return i.forEach(function(a){a.data().then(function(u){(function(c,d,p){if("float32"!==d)return!1;for(var m=0;m<c.length;m++){var y=c[m];if(isNaN(y)||!isFinite(y))return console.warn("Found "+y+" in the result of '"+p+"'"),!0}})(u,a.dtype,e),s.then(function(c){var d="";null!=c.getExtraProfileInfo&&(d=c.getExtraProfileInfo()),o.logger.logKernelProfile(e,a,u,c.kernelMs,t,d)})})}),i},n}(),SY=function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,i,o,s){var a="number"==typeof i?ml(i+"ms",9):i.error,u=ml(e,25),c=t.rank,d=t.size,p=ml(t.shape.toString(),14),m="";for(var y in o){var w=o[y].shape||t.shape,C=w.length;m+=y+": "+C+"D "+(C>0?w:"")+" "}console.log("%c"+u+"\t%c"+a+"\t%c"+c+"D "+p+"\t%c"+d+"\t%c"+m+"\t%c"+s,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n}();function hp(n,e,t){return ml(Array.isArray(n)?parseFloat(n[0].toFixed(7))+" + "+parseFloat(n[1].toFixed(7))+"j":bc(n)?"'"+n+"'":"bool"===t?pR(n):parseFloat(n.toFixed(7)).toString(),e)}function pR(n){return 0===n?"false":"true"}function dp(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var fp=function(){function n(e,t,r){var i=this;if(this.dtype=t,this.shape=e.slice(),this.size=st(e),null!=r){var o=r.length;X(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+i.size+"'."})}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||up(t,this.size),this.strides=oa(e)}return n.prototype.set=function(e){for(var t=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];0===r.length&&(r=[0]),X(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+t.rank+")"});var o=this.locToIndex(r);this.values[o]=e},n.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var r=0,i=0,o=e;i<o.length;i++){var s=o[i];if(s<0||s>=this.shape[r]){var a="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(a)}r++}for(var u=e[e.length-1],c=0;c<e.length-1;++c)u+=this.strides[c]*e[c];return this.values[u]},n.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return ja().makeTensor(this.values,this.shape,this.dtype)},n}(),ja=null,pe=null,gR=null,or=function(){function n(e,t,r,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=st(e),this.strides=oa(e),this.dataId=r,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}return n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),X(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},n.prototype.as3D=function(e,t,r){return this.throwIfDisposed(),this.reshape([e,t,r])},n.prototype.as4D=function(e,t,r,i){return this.throwIfDisposed(),this.reshape([e,t,r,i])},n.prototype.as5D=function(e,t,r,i,o){return this.throwIfDisposed(),this.reshape([e,t,r,i,o])},n.prototype.asType=function(e){return this.throwIfDisposed(),pe.cast(this,e)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return tt(this,void 0,void 0,function(){var e;return nt(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,pe.buffer(this.shape,this.dtype,e)]}})})},n.prototype.bufferSync=function(){return pe.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return tt(this,void 0,void 0,function(){var e;return nt(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,jb(this.shape,e)]}})})},n.prototype.arraySync=function(){return jb(this.shape,this.dataSync())},n.prototype.data=function(){return tt(this,void 0,void 0,function(){var e,t;return nt(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=ja().read(this.dataId),"string"!==this.dtype?[3,2]:[4,e];case 1:t=r.sent();try{return[2,t.map(function(i){return cp(i)})]}catch(i){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}})})},n.prototype.dataSync=function(){this.throwIfDisposed();var e=ja().readSync(this.dataId);if("string"===this.dtype)try{return e.map(function(t){return cp(t)})}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},n.prototype.bytes=function(){return tt(this,void 0,void 0,function(){var e;return nt(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,ja().read(this.dataId)];case 1:return e=t.sent(),"string"===this.dtype?[2,e]:[2,new Uint8Array(e.buffer)]}})})},n.prototype.dispose=function(){this.isDisposed||(ja().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(e){return void 0===e&&(e=!1),pe.print(this,e)},n.prototype.reshape=function(e){return this.throwIfDisposed(),pe.reshape(this,e)},n.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},n.prototype.expandDims=function(e){return void 0===e&&(e=0),pe.expandDims(this,e)},n.prototype.cumsum=function(e,t,r){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===r&&(r=!1),pe.cumsum(this,e,t,r)},n.prototype.squeeze=function(e){return this.throwIfDisposed(),pe.squeeze(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),pe.clone(this)},n.prototype.oneHot=function(e,t,r){return this.throwIfDisposed(),pe.oneHot(this,e,t,r)},n.prototype.toString=function(e){return void 0===e&&(e=!1),function(n,e,t,r){var i=oa(e),o=function(c,d,p,m){var y=st(d),w=m[m.length-1],C=new Array(w).fill(0),_=d.length,A="complex64"===p?dp(c):c;if(_>1)for(var T=0;T<y/w;T++)for(var N=T*w,M=0;M<w;M++)C[M]=Math.max(C[M],hp(A[N+M],0,p).length);return C}(n,e,t,i),s=e.length,a=function c(d,p,m,y,w,C){void 0===C&&(C=!0);var _="complex64"===m?2:1,A=p[0],T=p.length;if(0===T)return"complex64"===m?[hp(dp(d)[0],0,m)]:"bool"===m?[pR(d[0])]:[d[0].toString()];if(1===T){if(A>20){var M=Array.from(d.slice(0,3*_)),O=Array.from(d.slice((A-3)*_,A*_));return"complex64"===m&&(M=dp(M),O=dp(O)),["["+M.map(function(se,fe){return hp(se,w[fe],m)}).join(", ")+", ..., "+O.map(function(se,fe){return hp(se,w[A-3+fe],m)}).join(", ")+"]"]}return["["+("complex64"===m?dp(d):Array.from(d)).map(function(se,fe){return hp(se,w[fe],m)}).join(", ")+"]"]}var L=p.slice(1),V=y.slice(1),j=y[0]*_,U=[];if(A>20){for(var G=0;G<3;G++){var K=($=G*j)+j;U.push.apply(U,c(d.slice($,K),L,m,V,w,!1))}for(U.push("..."),G=A-3;G<A;G++)K=($=G*j)+j,U.push.apply(U,c(d.slice($,K),L,m,V,w,G===A-1))}else for(G=0;G<A;G++){var $;K=($=G*j)+j,U.push.apply(U,c(d.slice($,K),L,m,V,w,G===A-1))}var he=2===T?",":"";for(U[0]="["+U[0]+he,G=1;G<U.length-1;G++)U[G]=" "+U[G]+he;var de=",\n";for(G=2;G<T;G++)de+="\n";return U[U.length-1]=" "+U[U.length-1]+"]"+(C?"":de),U}(n,e,t,i,o),u=["Tensor"];return r&&(u.push("  dtype: "+t),u.push("  rank: "+s),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(a.map(function(c){return"    "+c}).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,e)},n.prototype.tile=function(e){return this.throwIfDisposed(),pe.tile(this,e)},n.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),pe.gather(this,e,t)},n.prototype.matMul=function(e,t,r){return void 0===t&&(t=!1),void 0===r&&(r=!1),this.throwIfDisposed(),pe.matMul(this,e,t,r)},n.prototype.dot=function(e){return this.throwIfDisposed(),pe.dot(this,e)},n.prototype.norm=function(e,t,r){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===r&&(r=!1),this.throwIfDisposed(),pe.norm(this,e,t,r)},n.prototype.slice=function(e,t){return this.throwIfDisposed(),pe.slice(this,e,t)},n.prototype.reverse=function(e){return this.throwIfDisposed(),pe.reverse(this,e)},n.prototype.concat=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),e instanceof n&&(e=[e]),pe.concat([this].concat(e),t)},n.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),pe.split(this,e,t)},n.prototype.stack=function(e,t){return void 0===t&&(t=0),pe.stack([this,e],t)},n.prototype.unstack=function(e){return void 0===e&&(e=0),pe.unstack(this,e)},n.prototype.pad=function(e,t){return void 0===t&&(t=0),pe.pad(this,e,t)},n.prototype.batchNormalization=function(e,t,r,i,o){return void 0===r&&(r=.001),gR("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,o,i,r)},n.prototype.batchNorm=function(e,t,r,i,o){return void 0===o&&(o=.001),this.throwIfDisposed(),pe.batchNorm(this,e,t,r,i,o)},n.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),pe.all(this,e,t)},n.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),pe.any(this,e,t)},n.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),pe.logSumExp(this,e,t)},n.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),pe.sum(this,e,t)},n.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),pe.prod(this,e,t)},n.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),pe.mean(this,e,t)},n.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),pe.min(this,e,t)},n.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),pe.max(this,e,t)},n.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),pe.argMin(this,e)},n.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),pe.argMax(this,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),pe.cast(this,e)},n.prototype.add=function(e){return this.throwIfDisposed(),pe.add(this,e)},n.prototype.addStrict=function(e){return this.throwIfDisposed(),pe.addStrict(this,e)},n.prototype.atan2=function(e){return this.throwIfDisposed(),pe.atan2(this,e)},n.prototype.sub=function(e){return this.throwIfDisposed(),pe.sub(this,e)},n.prototype.subStrict=function(e){return this.throwIfDisposed(),pe.subStrict(this,e)},n.prototype.pow=function(e){return this.throwIfDisposed(),pe.pow(this,e)},n.prototype.powStrict=function(e){return this.throwIfDisposed(),pe.powStrict(this,e)},n.prototype.mul=function(e){return this.throwIfDisposed(),pe.mul(this,e)},n.prototype.mulStrict=function(e){return this.throwIfDisposed(),pe.mulStrict(this,e)},n.prototype.div=function(e){return this.throwIfDisposed(),pe.div(this,e)},n.prototype.divNoNan=function(e){return this.throwIfDisposed(),pe.divNoNan(this,e)},n.prototype.floorDiv=function(e){return this.throwIfDisposed(),pe.floorDiv(this,e)},n.prototype.divStrict=function(e){return this.throwIfDisposed(),pe.divStrict(this,e)},n.prototype.minimum=function(e){return this.throwIfDisposed(),pe.minimum(this,e)},n.prototype.minimumStrict=function(e){return this.throwIfDisposed(),pe.minimumStrict(this,e)},n.prototype.maximum=function(e){return this.throwIfDisposed(),pe.maximum(this,e)},n.prototype.maximumStrict=function(e){return this.throwIfDisposed(),pe.maximumStrict(this,e)},n.prototype.mod=function(e){return this.throwIfDisposed(),pe.mod(this,e)},n.prototype.modStrict=function(e){return this.throwIfDisposed(),pe.modStrict(this,e)},n.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),pe.squaredDifferenceStrict(this,e)},n.prototype.transpose=function(e){return this.throwIfDisposed(),pe.transpose(this,e)},n.prototype.notEqual=function(e){return this.throwIfDisposed(),pe.notEqual(this,e)},n.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),pe.notEqualStrict(this,e)},n.prototype.less=function(e){return this.throwIfDisposed(),pe.less(this,e)},n.prototype.lessStrict=function(e){return this.throwIfDisposed(),pe.lessStrict(this,e)},n.prototype.equal=function(e){return this.throwIfDisposed(),pe.equal(this,e)},n.prototype.equalStrict=function(e){return this.throwIfDisposed(),pe.equalStrict(this,e)},n.prototype.lessEqual=function(e){return this.throwIfDisposed(),pe.lessEqual(this,e)},n.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),pe.lessEqualStrict(this,e)},n.prototype.greater=function(e){return this.throwIfDisposed(),pe.greater(this,e)},n.prototype.greaterStrict=function(e){return this.throwIfDisposed(),pe.greaterStrict(this,e)},n.prototype.greaterEqual=function(e){return this.throwIfDisposed(),pe.greaterEqual(this,e)},n.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),pe.greaterEqualStrict(this,e)},n.prototype.logicalAnd=function(e){return this.throwIfDisposed(),pe.logicalAnd(this,e)},n.prototype.logicalOr=function(e){return this.throwIfDisposed(),pe.logicalOr(this,e)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),pe.logicalNot(this)},n.prototype.logicalXor=function(e){return this.throwIfDisposed(),pe.logicalXor(this,e)},n.prototype.where=function(e,t){return this.throwIfDisposed(),pe.where(e,this,t)},n.prototype.neg=function(){return this.throwIfDisposed(),pe.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),pe.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),pe.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),pe.sign(this)},n.prototype.isNaN=function(){return this.throwIfDisposed(),pe.isNaN(this)},n.prototype.isInf=function(){return this.throwIfDisposed(),pe.isInf(this)},n.prototype.isFinite=function(){return this.throwIfDisposed(),pe.isFinite(this)},n.prototype.exp=function(){return this.throwIfDisposed(),pe.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),pe.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),pe.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),pe.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),pe.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),pe.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),pe.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),pe.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),pe.abs(this)},n.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),pe.clipByValue(this,e,t)},n.prototype.relu=function(){return this.throwIfDisposed(),pe.relu(this)},n.prototype.relu6=function(){return this.throwIfDisposed(),pe.relu6(this)},n.prototype.elu=function(){return this.throwIfDisposed(),pe.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),pe.selu(this)},n.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),pe.leakyRelu(this,e)},n.prototype.prelu=function(e){return this.throwIfDisposed(),pe.prelu(this,e)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),pe.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),pe.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),pe.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),pe.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),pe.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),pe.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),pe.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),pe.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),pe.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),pe.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),pe.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),pe.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),pe.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),pe.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),pe.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),pe.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),pe.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),pe.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),pe.round(this)},n.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),pe.step(this,e)},n.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),pe.softmax(this,e)},n.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),pe.logSoftmax(this,e)},n.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),pe.image.resizeBilinear(this,e,t)},n.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),pe.image.resizeNearestNeighbor(this,e,t)},n.prototype.conv1d=function(e,t,r,i,o,s){return void 0===i&&(i="NWC"),void 0===o&&(o=1),this.throwIfDisposed(),pe.conv1d(this,e,t,r,i,o,s)},n.prototype.conv2d=function(e,t,r,i,o,s){return void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),pe.conv2d(this,e,t,r,i,o,s)},n.prototype.conv2dTranspose=function(e,t,r,i,o){return this.throwIfDisposed(),pe.conv2dTranspose(this,e,t,r,i,o)},n.prototype.depthwiseConv2D=function(e,t,r,i,o,s){return void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),pe.depthwiseConv2d(this,e,t,r,i,o,s)},n.prototype.separableConv2d=function(e,t,r,i,o,s){return void 0===o&&(o=[1,1]),void 0===s&&(s="NHWC"),this.throwIfDisposed(),pe.separableConv2d(this,e,t,r,i,o,s)},n.prototype.avgPool=function(e,t,r,i){return this.throwIfDisposed(),pe.avgPool(this,e,t,r,i)},n.prototype.maxPool=function(e,t,r,i){return this.throwIfDisposed(),pe.maxPool(this,e,t,r,i)},n.prototype.localResponseNormalization=function(e,t,r,i){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===r&&(r=1),void 0===i&&(i=.5),pe.localResponseNormalization(this,e,t,r,i)},n.prototype.pool=function(e,t,r,i,o){return this.throwIfDisposed(),pe.pool(this,e,t,r,i,o)},n.prototype.variable=function(e,t,r){return void 0===e&&(e=!0),this.throwIfDisposed(),ja().makeVariable(this,e,t,r)},n.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),pe.unsortedSegmentSum(this,e,t)},n.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),pe.batchToSpaceND(this,e,t)},n.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),pe.spaceToBatchND(this,e,t)},n.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),pe.topk(this,e,t)},n.prototype.stridedSlice=function(e,t,r,i,o,s,a,u){return void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===u&&(u=0),this.throwIfDisposed(),pe.stridedSlice(this,e,t,r,i,o,s,a,u)},n.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),pe.depthToSpace(this,e,t)},n.prototype.fft=function(){return this.throwIfDisposed(),pe.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),pe.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),pe.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),pe.spectral.irfft(this)},n}();Object.defineProperty(or,Symbol.hasInstance,{value:function(n){return!!n&&null!=n.dataId&&null!=n.shape&&null!=n.dtype}});var mR,Yb,Xb,qb,$b,od=function(n){function e(t,r,i,o){var s=n.call(this,t.shape,t.dtype,t.dataId,o)||this;return s.trainable=r,s.name=i,s}return ia(e,n),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!ai(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");ja().disposeTensor(this),this.dataId=t.dataId,ja().incRef(this,null)},e.prototype.dispose=function(){ja().disposeVariable(this),this.isDisposedInternal=!0},e}(or);Object.defineProperty(od,Symbol.hasInstance,{value:function(n){return n instanceof or&&null!=n.assign&&n.assign instanceof Function}}),function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"}(mR||(mR={})),function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"}(Yb||(Yb={})),function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"}(Xb||(Xb={})),function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"}(qb||(qb={})),function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"}($b||($b={}));var MY={float32:qb,int32:Yb,bool:Xb,complex64:$b};function ki(n,e){if("string"===n||"string"===e){if("string"===n&&"string"===e)return"string";throw new Error("Can not upcast "+n+" with "+e)}return MY[n][e]}function Kb(n){return ki(n,"int32")}function Ar(n,e){if(n.dtype===e.dtype)return[n,e];var t=ki(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function vR(n,e){X(n.dtype===e.dtype,function(){return"The dtypes of the first("+n.dtype+") and second("+e.dtype+") input must match"})}function Qb(n){var e=[];return function t(r,i,o){if(null!=r){if(r instanceof or)return void i.push(r);if(s=r,Array.isArray(s)||"object"==typeof s){var s,a=r;for(var u in a){var c=a[u];o.has(c)||(o.add(c),t(c,i,o))}}}}(n,e,new Set),e}Object.freeze({makeTypesMatch:Ar,assertTypesMatch:vR,isTensorInList:function(n,e){return e.some(function(t){return t.id===n.id})},getTensorsInContainer:Qb});var Zb,yR=function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n}(),RY=function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new yR}return n.prototype.ready=function(){return tt(this,void 0,void 0,function(){var e,t,r;return nt(this,function(i){switch(i.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?[4,this.initializeBackend(r=e[t]).success]:[3,5];case 2:return i.sent()?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(n.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){return e in this.registry||e in this.registryFactory&&!this.initializeBackend(e).asyncInit?this.registry[e]:null},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return void 0===r&&(r=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return tt(this,void 0,void 0,function(){var t,r,i;return nt(this,function(o){switch(o.label){case 0:if(null==this.registryFactory[e])throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,null!=this.registry[e]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,t.asyncInit?[4,r]:[3,2]);case 1:return i=o.sent(),[3,3];case 2:i=r,o.label=3;case 3:if(!i)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new DY(this.backendInstance),[2,!0]}})})},n.prototype.setupRegisteredKernels=function(){var e=this;JM(this.backendName).forEach(function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)})},n.prototype.disposeRegisteredKernels=function(e){var t=this;JM(e).forEach(function(r){null!=r.disposeFunc&&r.disposeFunc(t.registry[e])})},n.prototype.initializeBackend=function(e){var t=this,r=this.registryFactory[e];if(null==r)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var i=r.factory();if(Promise.resolve(i)===i){var o=++this.pendingBackendInitId,s=i.then(function(a){return!(o<t.pendingBackendInitId||(t.registry[e]=a,t.pendingBackendInit=null,0))}).catch(function(a){return!(o<t.pendingBackendInitId||(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(a.stack||a.message),1))});return this.pendingBackendInit=s,{success:s,asyncInit:!0}}return this.registry[e]=i,{success:!0,asyncInit:!1}}catch(a){return console.warn("Initialization of backend "+e+" failed"),console.warn(a.stack||a.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority})},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],i=this.initializeBackend(r),s=i.asyncInit;if(s||i.success)return{name:r,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){var r=this.state.tensorInfo.get(t),i=r.backend,o=this.readSync(t);i.disposeData(t),r.backend=e,e.move(t,o,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(e,t){var r,i=this,o=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun(function(){return i.startScope(o)},function(){return i.endScope(r)},function(){return(r=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},n.prototype.scopedRun=function(e,t,r){e();try{var i=r();return t(),i}catch(o){throw t(),o}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype);return this.addTapeNode(this.state.activeScope.name,{x:e},[t],function(i){return{x:function(){return i.toFloat()}}},[]),t},n.prototype.runKernel=function(e,t,r,i,o){return this.runKernelFunc(null,t,null,e,r,i,o)},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(e,t,r){var i=this.backend.numDataIds(),o=0;r.forEach(function(u){o+="complex64"===u.dtype?3:1});var a=i-t-o-this.state.numDataMovesStack[this.state.numDataMovesStack.length-1];if(a>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+a+" data ids) after running '"+e+"'")},n.prototype.runKernelFunc=function(e,t,r,i,o,s,a){var u,c=this;void 0===s&&(s=[]),void 0===a&&(a=[]);var d=[],p=this.isTapeOn();null==i&&(i=null!=this.state.activeScope?this.state.activeScope.name:"");var m,y=function(T){p&&(d=T.map(function(N){return c.keep(c.clone(N))}))},w=this.state.numBytes,C=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var _,A=ZM(i,this.backendName);return m=null!=A?function(){var T=c.backend.numDataIds();_=A.kernelFunc({inputs:t,attrs:o,backend:c.backend});var N=Array.isArray(_)?_:[_];c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(i,T,N);var M=N.map(function(L){return c.makeTensorFromDataId(L.dataId,L.shape,L.dtype)}),O=M.filter(function(L,V){return a[V]});return y((s||[]).slice().concat(O)),M}:function(){var T=c.backend.numDataIds();_=c.tidy(function(){return e(c.backend,y)});var N=Array.isArray(_)?_:[_];return c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(i,T,N),N},this.scopedRun(function(){return c.state.kernelDepth++},function(){return c.state.kernelDepth--},function(){u=c.ENV.getBool("DEBUG")?c.profiler.profileKernel(i,t,function(){return m()}):m()}),p&&this.addTapeNode(i,t,u,r,d),this.state.profiling&&this.state.activeProfile.kernels.push({name:i,bytesAdded:this.state.numBytes-w,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-C,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(T){return t[T].shape}),outputShapes:u.map(function(T){return T.shape})}),Array.isArray(_)?u:u[0]},n.prototype.makeTensor=function(e,t,r,i){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");i=i||this.backend;var o=e;"string"===(r=r||"float32")&&bc(e[0])&&(o=e.map(function(d){return hR(d)}));var s=i.write(o,t,r),a=new or(t,r,s,this.nextTensorId());if(this.incRef(a,i),"string"===r){var u=this.state.tensorInfo.get(s),c=uR(o);this.state.numBytes+=c-u.bytes,u.bytes=c}return a},n.prototype.makeTensorFromDataId=function(e,t,r,i){var o=new or(t,r=r||"float32",e,this.nextTensorId());return this.incRef(o,i),o},n.prototype.makeVariable=function(e,t,r,i){void 0===t&&(t=!0),r=r||this.nextVariableId().toString(),null!=i&&i!==e.dtype&&(e=e.asType(i));var o=new od(e,t,r,this.nextTensorId());if(null!=this.state.registeredVariables[o.name])throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},n.prototype.incRef=function(e,t){var r=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===r){this.state.numDataBuffers++;var i=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(i=e.size*Vb(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:i,refCount:0}),this.state.numBytes+=i}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof od||this.track(e)},n.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables)this.disposeVariable(this.state.registeredVariables[e])},n.prototype.disposeVariable=function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return tt(this,void 0,void 0,function(){var t,r;return nt(this,function(i){return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(o){return o.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},n.prototype.addTapeNode=function(e,t,r,i,o){var s=this,a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:o},u=function(n){return ap.get(n)}(e);null!=u&&(i=u.gradFunc),null!=i&&(a.gradient=function(c){return c=c.map(function(d,p){if(null==d){var m=r[p],y=id(m.size,m.dtype);return s.makeTensor(y,m.shape,m.dtype)}return d}),i(c.length>1?c:c[0],o)}),this.state.activeTape.push(a)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=Qb(e),i=new Set(r.map(function(u){return u.id})),o=0;o<this.state.activeScope.track.length;o++){var s=this.state.activeScope.track[o];s.kept||i.has(s.id)||s.dispose()}var a=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==a.id||t.track(u)})},n.prototype.gradients=function(e,t,r,i){var o=this;if(void 0===i&&(i=!1),X(t.length>0,function(){return"gradients() received an empty list of xs."}),null!=r&&"float32"!==r.dtype)throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var s=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",e)});X(s instanceof or,function(){return"The result y returned by f() must be a tensor."});var a=function(u,c,d){for(var p={},m={},y=0;y<c.length;y++)p[c[y].id]=!0;for(y=0;y<u.length;y++){var w=(L=u[y]).inputs;for(var C in w){for(var _=w[C],A=!1,T=0;T<c.length;T++)if(p[_.id]){L.outputs.forEach(function(G){return p[G.id]=!0}),A=!0,m[L.id]=!0;break}if(A)break}}var N={};N[d.id]=!0;var M={};for(y=u.length-1;y>=0;y--)for(w=(L=u[y]).inputs,T=0;T<L.outputs.length;T++)if(N[L.outputs[T].id]){for(var C in w)N[w[C].id]=!0,M[L.id]=!0;break}var O=[];for(y=0;y<u.length;y++){var L;if(m[(L=u[y]).id]&&M[L.id]){var V={};for(var C in L.inputs){var j=L.inputs[C];p[j.id]&&(V[C]=j)}var U=Object.assign({},L);U.inputs=V,U.outputs=L.outputs,O.push(U)}}return O}(this.state.activeTape,t,s);if(!i&&0===a.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,c,d={};d[s.id]=null==r?(c=Wb(st(u=s.shape),"float32"),Z.makeTensor(c,u,"float32")):r,function(m,y,w){for(var C=function(A){var T=y[A],N=[];if(T.outputs.forEach(function(V){var j=m[V.id];N.push(null!=j?j:null)}),null==T.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+T.kernelName+".");var M=T.gradient(N),O=function(V){if(!(V in M))throw new Error("Cannot backprop through input "+V+". Available gradients found: "+Object.keys(M)+".");var j=o.tidy(function(){return M[V]()});if("float32"!==j.dtype)throw new Error("Error in gradient for op "+T.kernelName+". The gradient of input "+V+" must have 'float32' dtype, but has '"+j.dtype+"'");var U=T.inputs[V];if(!ai(j.shape,U.shape))throw new Error("Error in gradient for op "+T.kernelName+". The gradient of input '"+V+"' has shape '"+j.shape+"', which does not match the shape of the input '"+U.shape+"'");if(null==m[U.id])m[U.id]=j;else{var G=m[U.id];m[U.id]=G.add(j),G.dispose()}};for(var L in T.inputs)O(L)},_=y.length-1;_>=0;_--)C(_)}(d,a);var p=t.map(function(m){return d[m.id]});return 0===o.state.gradientDepth&&(o.state.activeTape.forEach(function(m){for(var y=0,w=m.saved;y<w.length;y++)w[y].dispose()}),o.state.activeTape=null),{value:s,grads:p}})},n.prototype.customGrad=function(e){var t=this;return X(wc(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];X(i.every(function(a){return a instanceof or}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var s={};return i.forEach(function(a,u){s[u]=a}),t.runKernelFunc(function(a,u){return X((r=e.apply(void 0,i.concat([u]))).value instanceof or,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),X(wc(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},s,function(a,u){var c=r.gradFunc(a,u),d=Array.isArray(c)?c:[c];X(d.length===i.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),X(d.every(function(m){return m instanceof or}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return d.forEach(function(m,y){p[y]=function(){return m}}),p})}},n.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},n.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},n.prototype.time=function(e){return tt(this,void 0,void 0,function(){var t,r;return nt(this,function(i){switch(i.label){case 0:return t=sa(),[4,this.backend.time(e)];case 1:return(r=i.sent()).wallMs=sa()-t,[2,r]}})})},n.prototype.track=function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),n.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new yR,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n.nextTensorId=0,n.nextVariableId=0,n}(),Z=function(){var n=function(){if(null==Zb){var t=void 0;if("undefined"!=typeof window)t=window;else if("undefined"!=typeof global)t=global;else if("undefined"!=typeof process)t=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}Zb=t}return Zb}();if(null==n._tfengine){var e=new CY(n);n._tfengine=new RY(e)}return QM=n._tfengine.ENV,ja=function(){return n._tfengine},n._tfengine}();function xR(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var _u=ge();_u.registerFlag("DEBUG",function(){return!1},function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),_u.registerFlag("IS_BROWSER",function(){return xR()}),_u.registerFlag("IS_NODE",function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node}),_u.registerFlag("IS_CHROME",function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),_u.registerFlag("PROD",function(){return!1}),_u.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return _u.getBool("DEBUG")}),_u.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),_u.registerFlag("IS_TEST",function(){return!1});var pp,Jo,es,vl={},Jb={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function bR(n,e){vl[n]=e}function Wa(n){n in vl||(vl[n]=function(t){if(1!==t&&2!==t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(i){if("undefined"!=typeof OffscreenCanvas&&2===i)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t);return r.addEventListener("webglcontextlost",function(i){i.preventDefault(),delete vl[t]},!1),1===t?r.getContext("webgl",Jb)||r.getContext("experimental-webgl",Jb):r.getContext("webgl2",Jb)}(n));var e=vl[n];return e.isContextLost()?(delete vl[n],Wa(n)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),vl[n])}function m1(n,e){return[e,n]}function gp(n){var e=st(n);return p1(Math.ceil(e/4))}function mp(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function ew(n,e){var t,r,i,o,s,a,u,c,d,p=n;return 2===ge().getNumber("WEBGL_VERSION")?(t=p.R32F,r=p.R16F,i=p.RGBA16F,o=p.RGBA32F,s=p.RED,a=4,u=1,c=p.HALF_FLOAT,d=p.FLOAT):(t=n.RGBA,r=n.RGBA,i=n.RGBA,o=p.RGBA,s=n.RGBA,a=4,u=4,c=null!=e?e.HALF_FLOAT_OES:null,d=n.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:s,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:a,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:d}}function Ze(n,e,t){var r=t();return e&&function(i){var o=i.getError();if(o!==i.NO_ERROR)throw new Error("WebGL Error: "+_R(i,o))}(n),r}function wR(n){return!!(ge().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===n||5.96e-8<Math.abs(n)&&Math.abs(n)<65504)}function _R(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function vp(n,e,t){return Cu(n,e,function(){return n.getExtension(t)},'Extension "'+t+'" not supported on this browser.')}function CR(n,e,t){var r=Cu(n,e,function(){return n.createShader(n.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Ze(n,e,function(){return n.shaderSource(r,t)}),Ze(n,e,function(){return n.compileShader(r)}),!1===n.getShaderParameter(r,n.COMPILE_STATUS))throw console.log(n.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function ER(n,e,t){var r=Cu(n,e,function(){return n.createShader(n.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Ze(n,e,function(){return n.shaderSource(r,t)}),Ze(n,e,function(){return n.compileShader(r)}),!1===n.getShaderParameter(r,n.COMPILE_STATUS))throw function(i,o){var s=kY.exec(o);if(null==s)return console.log("Couldn't parse line number in error: "+o),void console.log(i);for(var a=+s[1],u=i.split("\n"),c=u.length.toString().length+2,d=u.map(function(_,A){return ml((A+1).toString(),c)+_}),p=0,m=0;m<d.length;m++)p=Math.max(d[m].length,p);var y=d.slice(0,a-1),w=d.slice(a-1,a),C=d.slice(a);console.log(y.join("\n")),console.log(o.split("\n")[0]),console.log("%c "+ml(w[0],p),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(C.join("\n"))}(t,n.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(pp||(pp={})),function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"}(Jo||(Jo={})),function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(es||(es={}));var v1,y1,kY=/ERROR: [0-9]+:([0-9]+):/g;function IR(n,e){return Cu(n,e,function(){return n.createProgram()},"Unable to create WebGLProgram.")}function AR(n,e,t){if(Ze(n,e,function(){return n.linkProgram(t)}),!1===n.getProgramParameter(t,n.LINK_STATUS))throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function x1(n,e,t){if(Ze(n,e,function(){return n.validateProgram(t)}),!1===n.getProgramParameter(t,n.VALIDATE_STATUS))throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function DR(n,e,t){var r=Cu(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return Ze(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),Ze(n,e,function(){return n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function SR(n,e,t){var r=Cu(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return Ze(n,e,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r)}),Ze(n,e,function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function TR(n,e){return Cu(n,e,function(){return n.createTexture()},"Unable to create WebGLTexture.")}function MR(n,e){var t=ge().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){var r="["+n+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t)throw r="["+n+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+t+"x"+t+"].")}function RR(n,e){return Cu(n,e,function(){return n.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function tw(n,e,t,r,i,o,s,a){var u=n.getAttribLocation(t,r);return-1!==u&&(Ze(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,i)}),Ze(n,e,function(){return n.vertexAttribPointer(u,o,n.FLOAT,!1,s,a)}),Ze(n,e,function(){return n.enableVertexAttribArray(u)}),!0)}function NR(n,e,t,r){LR(n,r),Ze(n,e,function(){return n.activeTexture(n.TEXTURE0+r)}),Ze(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)})}function OR(n,e,t,r){return Cu(n,e,function(){return n.getUniformLocation(t,r)},'uniform "'+r+'" not present in program.')}function kR(n,e,t){return n.getUniformLocation(e,t)}function PR(n,e,t,r,i,o){Ze(n,e,function(){return NR(n,e,r,o)}),Ze(n,e,function(){return n.uniform1i(i,o)})}function b1(n,e,t,r){Ze(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)}),Ze(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0)})}function nw(n,e,t){Ze(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,t)}),Ze(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)})}function yp(n){var e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+FR(n,e))}function FR(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function Cu(n,e,t,r){var i=Ze(n,e,function(){return t()});if(null==i)throw new Error(r);return i}function LR(n,e){var t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+t+"].")}function xp(n,e){return void 0===e&&(e=2),st(n.slice(0,n.length-e))}function bp(n){if(0===n.length)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function w1(n){var e=[1,1,1];return 0===n.length||1===n.length&&1===n[0]||(e=[xp(n)].concat(bp(n))),e}function BR(n,e){var t;void 0===e&&(e=!1);var r=ge().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,1===(n=n.map(function(c,d){return d>=n.length-2?Lb(n[d]):n[d]})).length&&(n=[2,n[0]])),2!==n.length){var i=xc(n);n=i.newShape}var o=st(n);if(n.length<=1&&o<=r)return[1,o];if(2===n.length&&n[0]<=r&&n[1]<=r)return n;if(3===n.length&&n[0]*n[1]<=r&&n[2]<=r)return[n[0]*n[1],n[2]];if(3===n.length&&n[0]<=r&&n[1]*n[2]<=r)return[n[0],n[1]*n[2]];if(4===n.length&&n[0]*n[1]*n[2]<=r&&n[3]<=r)return[n[0]*n[1]*n[2],n[3]];if(4===n.length&&n[0]<=r&&n[1]*n[2]*n[3]<=r)return[n[0],n[1]*n[2]*n[3]];if(e){var s=xp(n),a=2,u=2;return n.length&&(a=(t=bp(n))[0],u=t[1]),p1(o=s*(a/2)*(u/2)).map(function(c){return 2*c})}return p1(o)}function _1(n){return n%2==0}function wp(n,e){if(ai(n=n.slice(-2),e=e.slice(-2))||!n.length||!e.length||0===n[0]||0===n[1]||0===e[0]||0===e[1])return!0;if(n.length!==e.length){var t=n.slice(-1)[0],r=e.slice(-1)[0];if(t===r||_1(t)&&_1(r)&&(1===n[0]||1===e[0]))return!0}return n[1]===e[1]&&_1(n[0])&&_1(e[0])}function VR(n){if(null==v1){var e=Wa(n);v1=e.getParameter(e.MAX_TEXTURE_SIZE)}return v1}function UR(n){if(null==y1){var e=Wa(n);y1=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,y1)}function jR(n){if(0===n)return 0;var e=Wa(n);return ts(e,"EXT_disjoint_timer_query_webgl2")&&2===n?2:ts(e,"EXT_disjoint_timer_query")?1:0}function ts(n,e){return null!=n.getExtension(e)}function rw(n){try{if(null!=Wa(n))return!0}catch(e){return!1}return!1}function WR(n){if(0===n)return!1;var e=Wa(n);if(1===n){if(!ts(e,"OES_texture_float"))return!1}else if(!ts(e,"EXT_color_buffer_float"))return!1;return iw(e)}function HR(n){if(0===n)return!1;var e=Wa(n);if(1!==n){if(ts(e,"EXT_color_buffer_float"))return iw(e);if(ts(e,"EXT_color_buffer_half_float")){var t=e.getExtension("EXT_color_buffer_half_float");return function(r,i){var o=ew(r,i),s=r.createTexture();r.bindTexture(r.TEXTURE_2D,s),r.texImage2D(r.TEXTURE_2D,0,o.internalFormatHalfFloat,1,1,0,o.textureFormatFloat,o.textureTypeHalfFloat,null);var a=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,a),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,s,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(s),r.deleteFramebuffer(a),u}(e,t)}return!1}return!!ts(e,"OES_texture_float")&&!!ts(e,"WEBGL_color_buffer_float")&&iw(e)}function iw(n){var e=ew(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var r=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);var i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(r),i}function zR(n){return 2===n&&null!=Wa(n).fenceSync}var PY=Object.freeze({callAndCheck:Ze,canBeRepresented:wR,getWebGLErrorMessage:_R,getExtensionOrThrow:vp,createVertexShader:CR,createFragmentShader:ER,createProgram:IR,linkProgram:AR,validateProgram:x1,createStaticVertexBuffer:DR,createStaticIndexBuffer:SR,getNumChannels:function(){return 2===ge().getNumber("WEBGL_VERSION")?1:4},createTexture:TR,validateTextureSize:MR,createFramebuffer:RR,bindVertexBufferToProgramAttribute:tw,bindTextureUnit:NR,unbindTextureUnit:function(n,e,t){LR(n,t),Ze(n,e,function(){return n.activeTexture(n.TEXTURE0+t)}),Ze(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:OR,getProgramUniformLocation:kR,bindTextureToProgramUniformSampler:PR,bindCanvasToFramebuffer:function(n,e){Ze(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,null)}),Ze(n,e,function(){return n.viewport(0,0,n.canvas.width,n.canvas.height)}),Ze(n,e,function(){return n.scissor(0,0,n.canvas.width,n.canvas.height)})},bindColorTextureToFramebuffer:b1,unbindColorTextureFromFramebuffer:nw,validateFramebuffer:yp,getFramebufferErrorMessage:FR,getBatchDim:xp,getRowsCols:bp,getShapeAs3D:w1,getTextureShapeFromLogicalShape:BR,isReshapeFree:wp,getWebGLMaxTextureSize:VR,resetMaxTextureSize:function(){v1=null},resetMaxTexturesInShader:function(){y1=null},getMaxTexturesInShader:UR,getWebGLDisjointQueryTimerVersion:jR,hasExtension:ts,isWebGLVersionEnabled:rw,isCapableOfRenderingToFloatTexture:WR,isDownloadFloatTextureEnabled:HR,isWebGLFenceEnabled:zR}),St=ge();function GR(n){ge().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function qe(n,e){return Z.tidy(n,e)}function Oo(n){Qb(n).forEach(function(e){return e.dispose()})}function C1(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];ge().getBool("IS_TEST")||console.warn.apply(console,n)}function Ha(n,e){var t=n;if(zi(n))return"string"===e?[]:[n.length];if(!Array.isArray(n))return[];for(var r=[];Array.isArray(t)||zi(t)&&"string"!==e;)r.push(t.length),t=t[0];return Array.isArray(n)&&ge().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function i(o,s,a){if(a=a||[],Array.isArray(o)||zi(o)){X(s.length>0,function(){return"Element arr["+a.join("][")+"] should be a primitive, but is an array of "+o.length+" elements"}),X(o.length===s[0],function(){return"Element arr["+a.join("][")+"] should have "+s[0]+" elements, but has "+o.length+" elements"});for(var u=s.slice(1),c=0;c<o.length;++c)i(o[c],u,a.concat(c))}else X(0===s.length,function(){return"Element arr["+a.join("][")+"] is a primitive, but should be an array/TypedArray of "+s[0]+" elements"})}(n,r,[]),r}function YR(n,e,t,r){if(null!=n&&("numeric"!==n&&n!==e||"numeric"===n&&"string"===e))throw new Error("Argument '"+t+"' passed to '"+r+"' must be "+n+" tensor, but got "+e+" tensor")}function H(n,e,t,r){if(void 0===r&&(r="numeric"),n instanceof or)return YR(r,n.dtype,e,t),n;var i=rd(n);if("string"!==i&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),YR(r,i,e,t),null==n||!zi(n)&&!Array.isArray(n)&&"number"!=typeof n&&"boolean"!=typeof n&&"string"!=typeof n)throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+(null==n?"null":n.constructor.name)+"'");var s=Ha(n,i);zi(n)||Array.isArray(n)||(n=[n]);var a="string"!==i?Ub(n,i,ge().getBool("DEBUG")):wu(n,[],!0);return Z.makeTensor(a,s,i)}function _p(n,e,t,r){if(void 0===r&&(r="numeric"),!Array.isArray(n))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return n.map(function(i,o){return H(i,e+"["+o+"]",t)},r)}function ow(n,e){for(var t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function XR(n,e,t){for(var r=n.length+e.length,i=[],o=0,s=0,a=0;a<r;a++)-1===t.indexOf(a)?i.push(n[o++]):i.push(e[s++]);return i}function Gi(n,e){for(var t=[],r=n.length,i=0;i<r;i++)-1===e.indexOf(i)&&t.push(n[i]);return[t,e.map(function(o){return n[o]})]}function Co(n,e){return XR(n,e.map(function(t){return 1}),e)}function ko(n,e,t){X(ow(e,t),function(){return n+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."})}function aa(n,e){if(ow(n,e))return null;for(var t=[],r=0;r<e;++r)-1===n.indexOf(r)&&t.push(r);return n.forEach(function(i){return t.push(i)}),t}function E1(n){return n.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function ua(n,e){for(var t=[],r=e-n;r<e;++r)t.push(r);return t}function qR(n,e){var t=n[0].length;n.forEach(function(i,o){X(i.length===t,function(){return"Error in concat"+t+"D: rank of tensors["+o+"] must be the same as the rank of the rest ("+t+")"})}),X(e>=0&&e<t,function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."});var r=n[0];n.forEach(function(i,o){for(var s=0;s<t;s++)X(s===e||i[s]===r[s],function(){return"Error in concat"+t+"D: Shape of tensors["+o+"] ("+i+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}function yl(n,e){for(var t=n[0].slice(),r=1;r<n.length;r++)t[e]+=n[r][e];return t}function J(n){var e=Object.keys(n);if(1!==e.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var i=function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];Z.startScope(t);try{var a=r.apply(void 0,o);return a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Z.endScope(a),a}catch(u){throw Z.endScope(null),u}};return Object.defineProperty(i,"name",{value:t,configurable:!0}),i}St.registerFlag("HAS_WEBGL",function(){return St.getNumber("WEBGL_VERSION")>0}),St.registerFlag("WEBGL_VERSION",function(){return rw(2)?2:rw(1)?1:0}),St.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===St.get("WEBGL_VERSION")}),St.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),St.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),St.registerFlag("WEBGL_PACK",function(){return St.getBool("HAS_WEBGL")}),St.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return St.getBool("WEBGL_PACK")}),St.registerFlag("WEBGL_PACK_CLIP",function(){return St.getBool("WEBGL_PACK")}),St.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),St.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return St.getBool("WEBGL_PACK")}),St.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return St.getBool("WEBGL_PACK")}),St.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return St.getBool("WEBGL_PACK")}),St.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return St.getBool("WEBGL_PACK")}),St.registerFlag("WEBGL_PACK_REDUCE",function(){return St.getBool("WEBGL_PACK")}),St.registerFlag("WEBGL_LAZILY_UNPACK",function(){return St.getBool("WEBGL_PACK")}),St.registerFlag("WEBGL_CONV_IM2COL",function(){return St.getBool("WEBGL_PACK")}),St.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return VR(St.getNumber("WEBGL_VERSION"))}),St.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return UR(St.getNumber("WEBGL_VERSION"))}),St.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var n=St.getNumber("WEBGL_VERSION");return 0===n?0:jR(n)}),St.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return St.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(n=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))));var n}),St.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return WR(St.getNumber("WEBGL_VERSION"))}),St.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!St.getBool("WEBGL_FORCE_F16_TEXTURES")&&St.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),St.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return HR(St.getNumber("WEBGL_VERSION"))}),St.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return zR(St.getNumber("WEBGL_VERSION"))}),St.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return St.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),gR=GR;var Yi=J({complex_:function(n,e){var t=H(n,"real","complex"),r=H(e,"imag","complex");return Rn(t.shape,r.shape,"real and imag shapes, "+t.shape+" and "+r.shape+", must match in call to tf.complex()."),Z.runKernelFunc(function(i){return i.complex(t,r)},{$real:t,$imag:r})}}),vs=J({real_:function(n){var e=H(n,"input","real");return Z.runKernelFunc(function(t){return t.real(e)},{$input:e})}}),za=J({imag_:function(n){var e=H(n,"input","imag");return Z.runKernelFunc(function(t){return t.imag(e)},{$input:e})}});function Xi(n,e,t){return _c(n,e,Ha(n,t),t)}function _c(n,e,t,r){if(null==r&&(r=rd(n)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!zi(n)&&!Array.isArray(n)&&"number"!=typeof n&&"boolean"!=typeof n&&"string"!=typeof n)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){Hb(e);var i=st(e),o=st(t);X(i===o,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+o});for(var s=0;s<t.length;++s){var u=s!==t.length-1||t[s]!==st(e.slice(s));X(t[s]===e[s]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+e+"). "})}}return zi(n)||Array.isArray(n)||(n=[n]),e=e||t,n="string"!==r?Ub(n,r,ge().getBool("DEBUG")):wu(n,[],!0),Z.makeTensor(n,e,r)}function Ue(n,e){if((zi(n)&&"string"!==e||Array.isArray(n))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&zi(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return _c(n,[],[],e)}function ci(n,e){gl(n);var t=Ha(n,e);if(1!==t.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return _c(n,null,t,e)}function Cc(n,e,t){if(gl(n),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Ha(n,t);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return _c(n,e,r,t)}function sw(n,e,t){if(gl(n),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");var r=Ha(n,t);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return _c(n,e,r,t)}function Po(n,e,t){if(gl(n),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");var r=Ha(n,t);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return _c(n,e,r,t)}function sd(n,e){if(void 0===e&&(e="float32"),"complex64"===e){var t=sd(n,"float32"),r=xr(n,"float32");return Yi(t,r)}var i=Wb(st(n),e);return Z.makeTensor(i,n,e)}function xr(n,e){if(void 0===e&&(e="float32"),"complex64"===e){var t=xr(n,"float32"),r=xr(n,"float32");return Yi(t,r)}var i=id(st(n),e);return Z.makeTensor(i,n,e)}function Ga(n,e,t){return Z.runKernelFunc(function(r){return r.fill(n,e,t)},{})}function I1(n,e,t,r){if(void 0===t&&(t=1),void 0===r&&(r="float32"),0===t)throw new Error("Cannot have a step of zero");if(n===e||n<e&&t<0||e<n&&t>1)return xr([0],r);var i=id(Math.abs(Math.ceil((e-n)/t)),r);e<n&&1===t&&(t=-1),i[0]=n;for(var o=1;o<i.length;o++)i[o]=i[o-1]+t;return ci(i,r)}var $R=J({onesLike_:function(n){var e=H(n,"x","onesLike");if("complex64"===e.dtype){var t=$R(vs(e)),r=Nn(za(e));return Yi(t,r)}return Z.runKernelFunc(function(i){return i.onesLike(e)},{$x:e},function(i,o){return{$x:function(){return Nn(i)}}})}}),Nn=J({zerosLike_:function(n){var e=H(n,"x","zerosLike");return Z.runKernelFunc(function(t){return t.zerosLike(e)},{$x:e},function(t,r){return{$x:function(){return Nn(t)}}})}}),_i=J({concat_:function(n,e){void 0===e&&(e=0),X(n.length>=1,function(){return"Pass at least one tensor to concat"});var t=_p(n,"tensors","concat");"complex64"===t[0].dtype&&t.forEach(function(a){if("complex64"!==a.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+a.dtype+". ")}),e=ui(e,t[0].shape)[0];var r=yl(t.map(function(a){return a.shape}),e);if(0===st(r))return Xi([],r);if(1===(t=t.filter(function(a){return a.size>0})).length)return t[0];var i=t.map(function(a){return a.shape});return qR(i,e),Z.runKernelFunc(function(a){return a.concat(t,e)},t,function(a){var u=i.map(function(c){return c[e]});return aw(a,u,e).map(function(c){return function(){return c}})},"Concat",{axis:e})}}),jY=J({concat1d_:function(n){return _i(n,0)}}),WY=J({concat2d_:function(n,e){return _i(n,e)}}),HY=J({concat3d_:function(n,e){return _i(n,e)}}),zY=J({concat4d_:function(n,e){return _i(n,e)}}),aw=J({split_:function(n,e,t){void 0===t&&(t=0);var r,i=H(n,"x","split");return t=ui(t,i.shape)[0],"number"==typeof e?(X(i.shape[t]%e==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(e).fill(i.shape[t]/e)):(X(i.shape[t]===e.reduce(function(o,s){return o+s}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=e),Z.runKernelFunc(function(o){return o.split(i,r,t)},{$x:i},function(o){return{$x:function(){return _i(o,t)}}})}});function xl(n,e){return n(e={exports:{}},e.exports),e.exports}"undefined"!=typeof globalThis||"undefined"!=typeof window||"undefined"!=typeof global&&global;var GY=xl(function(n){!function(e,t,r){function i(a){var u,c=this,d=(u=4022871197,function(p){p=p.toString();for(var m=0;m<p.length;m++){var y=.02519603282416938*(u+=p.charCodeAt(m));y-=u=y>>>0,u=(y*=u)>>>0,u+=4294967296*(y-=u)}return 2.3283064365386963e-10*(u>>>0)});c.next=function(){var p=2091639*c.s0+2.3283064365386963e-10*c.c;return c.s0=c.s1,c.s1=c.s2,c.s2=p-(c.c=0|p)},c.c=1,c.s0=d(" "),c.s1=d(" "),c.s2=d(" "),c.s0-=d(a),c.s0<0&&(c.s0+=1),c.s1-=d(a),c.s1<0&&(c.s1+=1),c.s2-=d(a),c.s2<0&&(c.s2+=1),d=null}function o(a,u){return u.c=a.c,u.s0=a.s0,u.s1=a.s1,u.s2=a.s2,u}function s(a,u){var c=new i(a),d=u&&u.state,p=c.next;return p.int32=function(){return 4294967296*c.next()|0},p.double=function(){return p()+11102230246251565e-32*(2097152*p()|0)},p.quick=p,d&&("object"==typeof d&&o(d,c),p.state=function(){return o(c,{})}),p}t&&t.exports?t.exports=s:this.alea=s}(0,n)}),YY=xl(function(n){!function(e,t,r){function i(a){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var p=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^p^p>>>8},a===(0|a)?u.x=a:c+=a;for(var d=0;d<c.length+64;d++)u.x^=0|c.charCodeAt(d),u.next()}function o(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u}function s(a,u){var c=new i(a),d=u&&u.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do{var m=((c.next()>>>11)+(c.next()>>>0)/4294967296)/(1<<21)}while(0===m);return m},p.int32=c.next,p.quick=p,d&&("object"==typeof d&&o(d,c),p.state=function(){return o(c,{})}),p}t&&t.exports?t.exports=s:this.xor128=s}(0,n)}),XY=xl(function(n){!function(e,t,r){function i(a){var u=this,c="";u.next=function(){var p=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^p^p<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,a===(0|a)?u.x=a:c+=a;for(var d=0;d<c.length+64;d++)u.x^=0|c.charCodeAt(d),d==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function o(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u.v=a.v,u.d=a.d,u}function s(a,u){var c=new i(a),d=u&&u.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do{var m=((c.next()>>>11)+(c.next()>>>0)/4294967296)/(1<<21)}while(0===m);return m},p.int32=c.next,p.quick=p,d&&("object"==typeof d&&o(d,c),p.state=function(){return o(c,{})}),p}t&&t.exports?t.exports=s:this.xorwow=s}(0,n)}),qY=xl(function(n){!function(e,t,r){function i(a){var u=this;u.next=function(){var c,d,p=u.x,m=u.i;return c=p[m],d=(c^=c>>>7)^c<<24,d^=(c=p[m+1&7])^c>>>10,d^=(c=p[m+3&7])^c>>>3,d^=(c=p[m+4&7])^c<<7,c=p[m+7&7],d^=(c^=c<<13)^c<<9,p[m]=d,u.i=m+1&7,d},function(c,d){var p,m=[];if(d===(0|d))m[0]=d;else for(d=""+d,p=0;p<d.length;++p)m[7&p]=m[7&p]<<15^d.charCodeAt(p)+m[p+1&7]<<13;for(;m.length<8;)m.push(0);for(p=0;p<8&&0===m[p];++p);for(8==p&&(m[7]=-1),c.x=m,c.i=0,p=256;p>0;--p)c.next()}(u,a)}function o(a,u){return u.x=a.x.slice(),u.i=a.i,u}function s(a,u){null==a&&(a=+new Date);var c=new i(a),d=u&&u.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do{var m=((c.next()>>>11)+(c.next()>>>0)/4294967296)/(1<<21)}while(0===m);return m},p.int32=c.next,p.quick=p,d&&(d.x&&o(d,c),p.state=function(){return o(c,{})}),p}t&&t.exports?t.exports=s:this.xorshift7=s}(0,n)}),$Y=xl(function(n){!function(e,t,r){function i(a){var u=this;u.next=function(){var c,d,p=u.w,m=u.X,y=u.i;return u.w=p=p+1640531527|0,d=m[y+34&127],c=m[y=y+1&127],d^=d<<13,c^=c<<17,d=m[y]=(d^=d>>>15)^(c^=c>>>12),u.i=y,d+(p^p>>>16)|0},function(c,d){var p,m,y,w,C,_=[],A=128;for(d===(0|d)?(m=d,d=null):(d+="\0",m=0,A=Math.max(A,d.length)),y=0,w=-32;w<A;++w)d&&(m^=d.charCodeAt((w+32)%d.length)),0===w&&(C=m),m^=m<<10,m^=m>>>15,m^=m<<4,m^=m>>>13,w>=0&&(y=0==(p=_[127&w]^=m+(C=C+1640531527|0))?y+1:0);for(y>=128&&(_[127&(d&&d.length||0)]=-1),y=127,w=512;w>0;--w)m=_[y+34&127],p=_[y=y+1&127],m^=m<<13,p^=p<<17,_[y]=(m^=m>>>15)^(p^=p>>>12);c.w=C,c.X=_,c.i=y}(u,a)}function o(a,u){return u.i=a.i,u.w=a.w,u.X=a.X.slice(),u}function s(a,u){null==a&&(a=+new Date);var c=new i(a),d=u&&u.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do{var m=((c.next()>>>11)+(c.next()>>>0)/4294967296)/(1<<21)}while(0===m);return m},p.int32=c.next,p.quick=p,d&&(d.X&&o(d,c),p.state=function(){return o(c,{})}),p}t&&t.exports?t.exports=s:this.xor4096=s}(0,n)}),KY=xl(function(n){!function(e,t,r){function i(a){var u=this,c="";u.next=function(){var p=u.b,m=u.c,y=u.d,w=u.a;return p=p<<25^p>>>7^m,m=m-y|0,y=y<<24^y>>>8^w,w=w-p|0,u.b=p=p<<20^p>>>12^m,u.c=m=m-y|0,u.d=y<<16^m>>>16^w,u.a=w-p|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,a===Math.floor(a)?(u.a=a/4294967296|0,u.b=0|a):c+=a;for(var d=0;d<c.length+20;d++)u.b^=0|c.charCodeAt(d),u.next()}function o(a,u){return u.a=a.a,u.b=a.b,u.c=a.c,u.d=a.d,u}function s(a,u){var c=new i(a),d=u&&u.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do{var m=((c.next()>>>11)+(c.next()>>>0)/4294967296)/(1<<21)}while(0===m);return m},p.int32=c.next,p.quick=p,d&&("object"==typeof d&&o(d,c),p.state=function(){return o(c,{})}),p}t&&t.exports?t.exports=s:this.tychei=s}(0,n)}),bl=xl(function(n){!function(e,t){var r,i=this,o=256,a="random",u=t.pow(o,6),c=t.pow(2,52),d=2*c,p=255;function m(A,T,N){var M=[],O=C(function j(U,G){var K,$=[],he=typeof U;if(G&&"object"==he)for(K in U)try{$.push(j(U[K],G-1))}catch(de){}return $.length?$:"string"==he?U:U+"\0"}((T=1==T?{entropy:!0}:T||{}).entropy?[A,_(e)]:null==A?function(){try{var j;return r&&(j=r.randomBytes)?j=j(o):(j=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(j)),_(j)}catch(K){var U=i.navigator,G=U&&U.plugins;return[+new Date,i,G,i.screen,_(e)]}}():A,3),M),L=new y(M),V=function(){for(var j=L.g(6),U=u,G=0;j<c;)j=(j+G)*o,U*=o,G=L.g(1);for(;j>=d;)j/=2,U/=2,G>>>=1;return(j+G)/U};return V.int32=function(){return 0|L.g(4)},V.quick=function(){return L.g(4)/4294967296},V.double=V,C(_(L.S),e),(T.pass||N||function(j,U,G,K){return K&&(K.S&&w(K,L),j.state=function(){return w(L,{})}),G?(t[a]=j,U):j})(V,O,"global"in T?T.global:this==t,T.state)}function y(A){var T,N=A.length,M=this,O=0,L=M.i=M.j=0,V=M.S=[];for(N||(A=[N++]);O<o;)V[O]=O++;for(O=0;O<o;O++)V[O]=V[L=p&L+A[O%N]+(T=V[O])],V[L]=T;(M.g=function(j){for(var U,G=0,K=M.i,$=M.j,he=M.S;j--;)U=he[K=p&K+1],G=G*o+he[p&(he[K]=he[$=p&$+U])+(he[$]=U)];return M.i=K,M.j=$,G})(o)}function w(A,T){return T.i=A.i,T.j=A.j,T.S=A.S.slice(),T}function C(A,T){for(var N,M=A+"",O=0;O<M.length;)T[p&O]=p&(N^=19*T[p&O])+M.charCodeAt(O++);return _(T)}function _(A){return String.fromCharCode.apply(0,A)}if(t["seed"+a]=m,C(t.random(),e),n.exports){n.exports=m;try{r=me(369)}catch(A){}}}([],Math)});bl.alea=GY,bl.xor128=YY,bl.xorwow=XY,bl.xorshift7=qY,bl.xor4096=$Y,bl.tychei=KY;var A1=bl.alea,uw=function(){function n(e,t,r,i,o){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var s=o||Math.random();this.random=A1(s.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,i=!1;!i;){var o=void 0,s=void 0,a=void 0;do{a=(o=2*this.random()-1)*o+(s=2*this.random()-1)*s}while(a>=1||0===a);var u=Math.sqrt(-2*Math.log(a)/a);t=this.mean+this.stdDev*o*u,r=this.mean+this.stdDev*s*u,this.truncated&&!this.isValidTruncated(t)||(i=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},n.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},n}(),QY=function(){function n(e,t,r,i){this.alpha=e,this.beta=1/t,this.dtype=r;var o=i||Math.random();this.randu=A1(o.toString()),this.randn=new uw(0,1,r,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var e,t,r,i,o,s;;){do{i=this.randn.nextValue(),s=1+this.c*i}while(s<=0);if(t=1-.331*(e=i*i)*e,r=.5*e+this.d*(1-(s*=s*s)+Math.log(s)),(o=this.randu())<t||Math.log(o)<r)break}return s*=1/this.beta*this.d,this.alpha<1&&(s*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(s)},n.prototype.convertValue=function(e){return"float32"===this.dtype?e:Math.round(e)},n}(),ZY=function(){function n(e,t,r,i){var o=this;if(void 0===e&&(e=0),void 0===t&&(t=1),this.canReturnFloat=function(){return null==o.dtype||"float32"===o.dtype},this.min=e,this.range=t-e,this.dtype=r,null==i&&(i=Math.random()),"number"==typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=A1(i)}return n.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n}();function Vt(n,e,t){return void 0===e&&(e="float32"),e=e||"float32",Hb(n),new fp(n,e,t)}var KR=J({batchToSpaceND_:function(n,e,t){var r=H(n,"x","batchToSpaceND"),i=e.reduce(function(o,s){return o*s});return X(r.rank>=1+e.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length}),X(t.length===e.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length}),X(r.shape[0]%i==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+i}),Z.runKernelFunc(function(o){return o.batchToSpaceND(r,e,t)},{$x:r},function(o){return{$x:function(){return o.spaceToBatchND(e,t)}}})}}),eX=J({broadcastTo_:function(n,e){var t=H(n,"broadcastTo","x"),r=t.shape;if(e.some(function(u){return!(u>0)||u%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var i=t.shape.slice();i.length<e.length;)i.unshift(1);t=t.reshape(i)}for(var o=Array.from(e),s=e.length-1;s>=0;s--)if(t.shape[s]===e[s])o[s]=1;else if(1!==t.shape[s])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");var a=o.map(function(u,c){return u>1?c:-1}).filter(function(u){return u>=0});return 0===a.length?t.clone():Z.runKernelFunc(function(u){return u.tile(t,o)},{input:t},function(u){return{input:function(){return u.sum(a,!0)}}})}}),tX=J({cast_:function(n,e){var t=H(n,"x","cast");if(!sR(e))throw new Error("Failed to cast to unknown dtype "+e);if("string"===e&&"string"!==t.dtype||"string"!==e&&"string"===t.dtype)throw new Error("Only strings can be casted to strings");return Z.runKernelFunc(function(i){return i.cast(t,e)},{x:t},function(i){return{x:function(){return i.clone()}}},"Cast",{dtype:e})}}),nX=J({clone_:function(n){var e=H(n,"x","clone",null);return Z.runKernelFunc(function(){return Z.makeTensorFromDataId(e.dataId,e.shape,e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}}),rX=J({cumsum_:function(n,e,t,r){void 0===e&&(e=0),void 0===t&&(t=!1),void 0===r&&(r=!1);var i=H(n,"x","cumsum"),o=aa([e|=0],i.rank),s=i;null!=o&&(s=i.transpose(o));var a=ua(1,i.rank)[0],u=Z.runKernelFunc(function(c){return c.cumsum(s,a,t,r)},{permutedX:s},function(c){return{permutedX:function(){return c.cumsum(e,t,!r)}}});return null!=o&&(u=u.transpose(o)),u}}),iX=J({depthToSpace_:function(n,e,t){void 0===t&&(t="NHWC");var r=H(n,"x","depthToSpace"),i="NHWC"===t?r.shape[1]:r.shape[2],o="NHWC"===t?r.shape[2]:r.shape[3],s="NHWC"===t?r.shape[3]:r.shape[1];return X(i*e>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+e+"  for depthToSpace with input shape\n      "+r.shape}),X(o*e>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+e+" for depthToSpace with input shape\n          "+r.shape}),X(s%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+s+" for depthToSpace with input shape "+r.shape}),Z.runKernelFunc(function(a){return a.depthToSpace(r,e,t)},{$x:r})}}),ys=J({expandDims_:function(n,e){void 0===e&&(e=0);var t=H(n,"x","expandDims",null);X(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var r=t.shape.slice();return e<0&&(X(-(t.rank+1)<=e,function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"}),e=t.rank+e+1),r.splice(e,0,1),ca(t,r)}}),QR=J({eye_:function(n,e,t,r){void 0===r&&(r="float32"),null==e&&(e=n);for(var i=Vt([n,e],r),o=n<=e?n:e,s=0;s<o;++s)i.set(1,s,s);var a=i.toTensor().as2D(n,e);if(null==t)return a;if(1===t.length)return ad(ys(a,0),[t[0],1,1]);if(2===t.length)return ad(ys(ys(a,0),0),[t[0],t[1],1,1]);if(3===t.length)return ad(ys(ys(ys(a,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),oX=J({multinomial_:function(n,e,t,r){void 0===r&&(r=!1);var i=H(n,"logits","multinomial"),o=i.size,s=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(s>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+s);t=t||Math.random();var a=1===s?i.as2D(1,-1):i,u=Z.runKernelFunc(function(c){return c.multinomial(a,r,e,t)},{logits2D:a});return 1===s?u.as1D():u}}),cw=J({oneHot_:function(n,e,t,r){if(void 0===t&&(t=1),void 0===r&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=H(n,"indices","oneHot","int32"),o=i.shape.concat([e]);return i=i.flatten(),Z.runKernelFunc(function(s){return s.oneHot(i,e,t,r)},{$indices:i},function(s){return{$indices:function(){return xr(i.shape,"float32")}}}).reshape(o)}}),wl=J({pad_:function(n,e,t){void 0===t&&(t=0);var r=H(n,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");return Z.runKernelFunc(function(o){return o.pad(r,e,t)},{x:r},function(o){var s=e.map(function(a){return a[0]});return{x:function(){return o.slice(s,r.shape)}}},"PadV2",{paddings:e,constantValue:t})}}),sX=J({pad1d_:function(n,e,t){return void 0===t&&(t=0),X(2===e.length,function(){return"Invalid number of paddings. Must be length of 2."}),wl(n,[e],t)}}),aX=J({pad2d_:function(n,e,t){return void 0===t&&(t=0),X(2===e.length&&2===e[0].length&&2===e[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),wl(n,e,t)}}),uX=J({pad3d_:function(n,e,t){return void 0===t&&(t=0),X(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),wl(n,e,t)}}),cX=J({pad4d_:function(n,e,t){return void 0===t&&(t=0),X(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),wl(n,e,t)}}),lX=J({rand_:function(n,e,t){var r=st(n),i=null;if(null==t||"float32"===t)i=new Float32Array(r);else if("int32"===t)i=new Int32Array(r);else{if("bool"!==t)throw new Error("Unknown data type "+t);i=new Uint8Array(r)}for(var o=0;o<r;o++)i[o]=e();return Z.makeTensor(i,n,t)}}),hX=J({randomNormal_:function(n,e,t,r,i){if(void 0===e&&(e=0),void 0===t&&(t=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var o=new uw(e,t,r,!1,i),s=Vt(n,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),dX=J({randomGamma_:function(n,e,t,r,i){if(void 0===t&&(t=1),void 0===r&&(r="float32"),null==t&&(t=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var o=new QY(e,t,r,i),s=Vt(n,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),ZR=J({randomUniform_:function(n,e,t,r,i){void 0===e&&(e=0),void 0===t&&(t=1),void 0===r&&(r="float32");for(var o=Vt(n,r),s=new ZY(e,t,null,i),a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}}),ca=J({reshape_:function(n,e){var t=H(n,"x","reshape",null);return e=iR(e,t.size),X(t.size===st(e),function(){return"new shape and old shape must have the same number of elements."}),Z.runKernelFunc(function(i){return i.reshape(t,e)},{x:t},function(i){return{x:function(){return i.reshape(t.shape)}}},"Reshape",{shape:e})}}),JR=J({spaceToBatchND_:function(n,e,t){var r=H(n,"x","spaceToBatchND");return X(r.rank>=1+e.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length}),X(t.length===e.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length}),X(r.shape.reduce(function(i,o,s){return s>0&&s<=e.length?i&&(o+t[s-1][0]+t[s-1][1])%e[s-1]==0:i},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()}),Z.runKernelFunc(function(i){return i.spaceToBatchND(r,e,t)},{$x:r},function(i){return{$x:function(){return i.batchToSpaceND(e,t)}}})}}),e3=J({squeeze_:function(n,e){var t=H(n,"x","squeeze");return ca(t,xc(t.shape,e).newShape)}}),ns=J({stack_:function(n,e){void 0===e&&(e=0);var t=_p(n,"tensors","stack");if(X(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===t.length)return t[0].expandDims(e);var i=t[0].shape,o=t[0].dtype;X(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"}),t.forEach(function(a){Rn(i,a.shape,"All tensors passed to stack must have matching shapes")}),t.forEach(function(a){X(o===a.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=t.map(function(a){return a.expandDims(e)});return _i(s,e)}}),ad=J({tile_:function(n,e){var t=H(n,"x","tile",null);return X(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."}),Z.runKernelFunc(function(o,s){var a=o.tile(t,e);return s([t]),a},{x:t},function(o,s){var a=s[0];return{x:function(){var u=Nn(a);if(1===a.rank)for(var c=0;c<e[0];++c)u=u.add(o.slice([c*a.shape[0]],[a.shape[0]]));else if(2===a.rank)for(c=0;c<e[0];++c)for(var d=0;d<e[1];++d)u=u.add(o.slice([c*a.shape[0],d*a.shape[1]],[a.shape[0],a.shape[1]]));else if(3===a.rank)for(c=0;c<e[0];++c)for(d=0;d<e[1];++d)for(var p=0;p<e[2];++p)u=u.add(o.slice([c*a.shape[0],d*a.shape[1],p*a.shape[2]],[a.shape[0],a.shape[1],a.shape[2]]));else{if(4!==a.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+a.rank+" tensors yet.");for(c=0;c<e[0];++c)for(d=0;d<e[1];++d)for(p=0;p<e[2];++p)for(var m=0;m<e[3];++m)u=u.add(o.slice([c*a.shape[0],d*a.shape[1],p*a.shape[2],m*a.shape[3]],[a.shape[0],a.shape[1],a.shape[2],a.shape[3]]))}return u}}},"Tile",{reps:e},[t])}}),fX=J({truncatedNormal_:function(n,e,t,r,i){if(void 0===e&&(e=0),void 0===t&&(t=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var o=new uw(e,t,r,!0,i),s=Vt(n,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),Ci=J({unstack_:function(n,e){void 0===e&&(e=0),e=e||0;var t=H(n,"x","unstack");return X(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"}),e<0&&(e+=t.shape.length),Z.runKernelFunc(function(i){return i.unstack(t,e)},{x:t},function(i){return{x:function(){return ns(i,e)}}},"Unpack",{axis:e})}});function D1(n,e,t,r){void 0===r&&(r=!0);var i=[];if(r)(i=i.concat(e.slice(0))).push(n[0]/t),i=i.concat(n.slice(1));else{i=i.concat(n[0]);for(var o=e.length,s=0;s<o;++s)i=i.concat([n[s+1]/e[s],e[s]]);i=i.concat(n.slice(o+1))}return i}function S1(n,e,t){void 0===t&&(t=!0);var r=[];if(t){r.push(e);for(var i=e+1;i<n;++i)i<=2*e?(r.push(i),r.push(i-(e+1))):r.push(i)}else{var o=[],s=[];for(i=1;i<n;++i)i>=2*e+1||i%2==1?s.push(i):o.push(i);r.push.apply(r,o),r.push(0),r.push.apply(r,s)}return r}function T1(n,e,t,r){void 0===r&&(r=!0);var i=[];i.push(r?n[0]/t:n[0]*t);for(var o=1;o<n.length;++o)i.push(o<=e.length?r?e[o-1]*n[o]:n[o]/e[o-1]:n[o]);return i}function t3(n,e){for(var t=[0],r=0;r<e;++r)t.push(n[r][0]);return t}function n3(n,e,t){for(var r=n.slice(0,1),i=0;i<t;++i)r.push(n[i+1]-e[i][0]-e[i][1]);return r}function lw(n,e){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==e.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+n.rank);if(0===n.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var t=e.shape,r=t[t.length-1],i=1,o=0;o<t.length-1;++o)i*=t[o];var s=n.shape,a=t.slice();a.pop();var u=1;for(o=r;o<n.rank;++o)u*=s[o],a.push(s[o]);var c=oa(n.shape).map(function(d){return d/u}).concat([1]).slice(0,r);return[a,i,u,c]}function M1(n){return n<=30?n:g1(n,Math.floor(Math.sqrt(n)))}function r3(n,e,t){var r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+e.shape+", shape: "+n+", sliceDim: "+r+", and batchDim: "+i+".";if(t.rank<i)throw new Error(o+" update.rank < "+i+". ");if(n.length<r+(t.rank-i))throw new Error(o+" Output shape length < "+(r+(t.rank-i)));if(t.rank!==i+n.length-r)throw new Error(o+" update.rank != "+(i+n.length-r));for(var s=0;s<i;++s)if(t.shape[s]!==e.shape[s])throw new Error(o+" updates.shape["+s+"] ("+t.shape[s]+") != indices.shape["+s+"] ("+e.shape[s]+").");for(s=0;s<t.rank-i;++s)if(t.shape[s+i]!==n[s+r])throw new Error(o+" updates.shape["+(s+i)+"] ("+t.shape[s+i]+") != shape["+(s+i)+"] ("+n[s+i]+")")}function i3(n,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if("int32"!==e.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(0===t.length){if(0===e.size)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(0===n.size)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}r3(t,e,n)}function Cp(n,e,t){for(var r=e.shape.length,i=r>1?e.shape[r-1]:1,o=t.length,s=1,a=i;a<o;++a)s*=t[a];var u=i<1?1:i;return{sliceRank:i,numUpdates:st(e.shape)/u,sliceSize:s,strides:oa(t.slice(0,i)).concat([1]),outputSize:st(t)}}function o3(n,e,t){X(n.rank===e.length,function(){return"Error in slice"+n.rank+"D: Length of begin "+e+" must match the rank of the array ("+n.rank+")."}),X(n.rank===t.length,function(){return"Error in slice"+n.rank+"D: Length of size "+t+" must match the rank of the array ("+n.rank+")."});for(var r=function(o){X(e[o]+t[o]<=n.shape[o],function(){return"Error in slice"+n.rank+"D: begin["+o+"] + size["+o+"] ("+(e[o]+t[o])+") would overflow input.shape["+o+"] ("+n.shape[o]+")"})},i=0;i<n.rank;++i)r(i)}function dw(n){for(var e=[],t=0;n>0;)1&n&&e.push(t),n/=2,t++;return e}function R1(n,e,t){for(var r=[],i=0;i<n.length;i++)r[i]=Math.ceil((e[i]-n[i])/t[i]);return r}function s3(n,e,t,r,i){var o=e[i];(n&1<<i||null==o)&&(o=(t[i]||1)>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var a=r[i];return o<0&&(o+=a),f1(0,o,a-1)}function a3(n,e,t,r,i){var o=e[i],s=t[i]||1;(n&1<<i||null==o)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var a=r[i];return o<0&&(o+=a),s>0?f1(0,o,a):f1(-1,o,a-1)}function fw(n,e,t){for(var r=t.length,i=0;i<t.length;i++)if(t[i]>1){r=i;break}for(i=r+1;i<t.length;i++)if(e[i]>0||t[i]!==n[i])return!1;return!0}function pw(n,e){for(var t=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function N1(n){return Z.customGrad(n)}Object.freeze({prepareAndValidate:lw}),Object.freeze({validateUpdateShape:r3,validateInput:i3,calculateShapes:Cp}),Object.freeze({assertParamsValid:o3,maskToAxes:dw,computeOutShape:R1,startForAxis:s3,stopForAxis:a3,isSliceContinous:fw,computeFlatOffset:pw});var Eu=J({softmax_:function(n,e){void 0===e&&(e=-1);var t=H(n,"logits","softmax","float32");if(-1===e&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return Z.runKernelFunc(function(r,i){var o=r.softmax(t,e);return i([o]),o},{logits:t},function(r,i){var o=i[0],s=r.mul(o);return{logits:function(){return s.sub(s.sum([e],!0).mul(o))}}},"Softmax",{dim:e},[],[!0])}}),mX=J({logSoftmax_:function(n,e){void 0===e&&(e=-1);var t=H(n,"logits","logSoftmax");if(-1===e&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return N1(function(r,i){var o=r.max(e,!0),s=r.sub(o),a=s.toFloat().sub(s.exp().sum(e,!0).log());return i([a]),{value:a,gradFunc:function(u,c){var d=c[0].exp();return u.sub(u.sum(e,!0).mul(d))}}})(t)}}),u3=function(){function n(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return n.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},n.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},n.prototype.has=function(e){return this.data.has(e)},n.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},n.prototype.numDataIds=function(){return this.dataIdsCount},n}(),c3=function(){function n(){}return n.prototype.time=function(e){return le("time")},n.prototype.read=function(e){return le("read")},n.prototype.readSync=function(e){return le("readSync")},n.prototype.numDataIds=function(){return le("numDataIds")},n.prototype.disposeData=function(e){return le("disposeData")},n.prototype.write=function(e,t,r){return le("write")},n.prototype.move=function(e,t,r,i){return le("move")},n.prototype.memory=function(){return le("memory")},n.prototype.floatPrecision=function(){return le("floatPrecision")},n.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},n.prototype.batchMatMul=function(e,t,r,i){return le("batchMatMul")},n.prototype.fusedBatchMatMul=function(e){return le("fusedBatchMatMul")},n.prototype.slice=function(e,t,r){return le("slice")},n.prototype.stridedSlice=function(e,t,r,i){return le("stridedSlice")},n.prototype.unstack=function(e,t){return le("unstack")},n.prototype.reverse=function(e,t){return le("reverse")},n.prototype.concat=function(e,t){return le("concat")},n.prototype.neg=function(e){return le("neg")},n.prototype.add=function(e,t){return le("add")},n.prototype.addN=function(e){return le("addN")},n.prototype.subtract=function(e,t){return le("subtract")},n.prototype.multiply=function(e,t){return le("multiply")},n.prototype.realDivide=function(e,t){return le("realDivide")},n.prototype.floorDiv=function(e,t){return le("floorDiv")},n.prototype.sum=function(e,t){return le("sum")},n.prototype.prod=function(e,t){return le("prod")},n.prototype.unsortedSegmentSum=function(e,t,r){return le("unsortedSegmentSum")},n.prototype.argMin=function(e,t){return le("argMin")},n.prototype.argMax=function(e,t){return le("argMax")},n.prototype.equal=function(e,t){return le("equal")},n.prototype.notEqual=function(e,t){return le("notEqual")},n.prototype.less=function(e,t){return le("less")},n.prototype.lessEqual=function(e,t){return le("lessEqual")},n.prototype.greater=function(e,t){return le("greater")},n.prototype.greaterEqual=function(e,t){return le("greaterEqual")},n.prototype.logicalNot=function(e){return le("logicalNot")},n.prototype.logicalAnd=function(e,t){return le("logicalAnd")},n.prototype.logicalOr=function(e,t){return le("logicalOr")},n.prototype.where=function(e){return le("where")},n.prototype.select=function(e,t,r){return le("select")},n.prototype.topk=function(e,t,r){return le("topk")},n.prototype.min=function(e,t){return le("min")},n.prototype.minimum=function(e,t){return le("minimum")},n.prototype.mod=function(e,t){return le("mod")},n.prototype.max=function(e,t){return le("max")},n.prototype.maximum=function(e,t){return le("maximum")},n.prototype.all=function(e,t){return le("all")},n.prototype.any=function(e,t){return le("any")},n.prototype.squaredDifference=function(e,t){return le("squaredDifference")},n.prototype.ceil=function(e){return le("ceil")},n.prototype.floor=function(e){return le("floor")},n.prototype.round=function(e){return le("round")},n.prototype.sign=function(e){return le("sign")},n.prototype.isNaN=function(e){return le("isNaN")},n.prototype.isInf=function(e){return le("isInf")},n.prototype.isFinite=function(e){return le("isFinite")},n.prototype.pow=function(e,t){return le("pow")},n.prototype.exp=function(e){return le("exp")},n.prototype.expm1=function(e){return le("expm1")},n.prototype.softmax=function(e,t){return le("softmax")},n.prototype.log=function(e){return le("log")},n.prototype.log1p=function(e){return le("log1p")},n.prototype.sqrt=function(e){return le("sqrt")},n.prototype.rsqrt=function(e){return le("rsqrt")},n.prototype.square=function(e){return le("square")},n.prototype.reciprocal=function(e){return le("reciprocal")},n.prototype.relu=function(e){return le("relu")},n.prototype.relu6=function(e){return le("relu6")},n.prototype.prelu=function(e,t){return le("prelu")},n.prototype.elu=function(e){return le("elu")},n.prototype.eluDer=function(e,t){return le("eluDer")},n.prototype.selu=function(e){return le("selu")},n.prototype.int=function(e){return le("int")},n.prototype.clip=function(e,t,r){return le("clip")},n.prototype.abs=function(e){return le("abs")},n.prototype.complexAbs=function(e){return le("complexAbs")},n.prototype.sigmoid=function(e){return le("sigmoid")},n.prototype.softplus=function(e){return le("softplus")},n.prototype.sin=function(e){return le("sin")},n.prototype.cos=function(e){return le("cos")},n.prototype.tan=function(e){return le("tan")},n.prototype.asin=function(e){return le("asin")},n.prototype.acos=function(e){return le("acos")},n.prototype.atan=function(e){return le("atan")},n.prototype.atan2=function(e,t){return le("atan2")},n.prototype.sinh=function(e){return le("sinh")},n.prototype.cosh=function(e){return le("cosh")},n.prototype.tanh=function(e){return le("tanh")},n.prototype.asinh=function(e){return le("asinh")},n.prototype.acosh=function(e){return le("acosh")},n.prototype.atanh=function(e){return le("atanh")},n.prototype.erf=function(e){return le("erf")},n.prototype.step=function(e,t){return le("step")},n.prototype.fusedConv2d=function(e){return le("fusedConv2d")},n.prototype.conv2d=function(e,t,r){return le("conv2d")},n.prototype.conv2dDerInput=function(e,t,r){return le("conv2dDerInput")},n.prototype.conv2dDerFilter=function(e,t,r){return le("conv2dDerFilter")},n.prototype.fusedDepthwiseConv2D=function(e){return le("fusedDepthwiseConv2D")},n.prototype.depthwiseConv2D=function(e,t,r){return le("depthwiseConv2D")},n.prototype.depthwiseConv2DDerInput=function(e,t,r){return le("depthwiseConv2DDerInput")},n.prototype.depthwiseConv2DDerFilter=function(e,t,r){return le("depthwiseConv2DDerFilter")},n.prototype.conv3d=function(e,t,r){return le("conv3d")},n.prototype.conv3dDerInput=function(e,t,r){return le("conv3dDerInput")},n.prototype.conv3dDerFilter=function(e,t,r){return le("conv3dDerFilter")},n.prototype.maxPool=function(e,t){return le("maxPool")},n.prototype.maxPoolBackprop=function(e,t,r,i){return le("maxPoolBackprop")},n.prototype.avgPool=function(e,t){return le("avgPool")},n.prototype.avgPoolBackprop=function(e,t,r){return le("avgPoolBackprop")},n.prototype.avgPool3d=function(e,t){return le("avgPool3d")},n.prototype.avgPool3dBackprop=function(e,t,r){return le("avgPool3dBackprop")},n.prototype.maxPool3d=function(e,t){return le("maxPool3d")},n.prototype.maxPool3dBackprop=function(e,t,r,i){return le("maxPool3dBackprop")},n.prototype.reshape=function(e,t){return le("reshape")},n.prototype.cast=function(e,t){return le("cast")},n.prototype.tile=function(e,t){return le("tile")},n.prototype.pad=function(e,t,r){return le("pad")},n.prototype.transpose=function(e,t){return le("transpose")},n.prototype.gather=function(e,t,r){return le("gather")},n.prototype.gatherND=function(e,t){return le("gatherND")},n.prototype.scatterND=function(e,t,r){return le("scatterND")},n.prototype.batchToSpaceND=function(e,t,r){return le("batchToSpaceND")},n.prototype.spaceToBatchND=function(e,t,r){return le("spaceToBatchND")},n.prototype.resizeBilinear=function(e,t,r,i){return le("resizeBilinear")},n.prototype.resizeBilinearBackprop=function(e,t,r){return le("resizeBilinearBackprop")},n.prototype.resizeNearestNeighbor=function(e,t,r,i){return le("resizeNearestNeighbor")},n.prototype.resizeNearestNeighborBackprop=function(e,t,r){return le("resizeNearestNeighborBackprop")},n.prototype.batchNormalization=function(e,t,r,i,o,s){return le("batchNormalization")},n.prototype.localResponseNormalization4D=function(e,t,r,i,o){return le("localResponseNormalization4D")},n.prototype.LRNGrad=function(e,t,r,i,o,s,a){return le("LRNGrad")},n.prototype.multinomial=function(e,t,r,i){return le("multinomial")},n.prototype.oneHot=function(e,t,r,i){return le("oneHot")},n.prototype.cumsum=function(e,t,r,i){return le("cumsum")},n.prototype.nonMaxSuppression=function(e,t,r,i,o){return le("nonMaxSuppression")},n.prototype.fft=function(e){return le("fft")},n.prototype.ifft=function(e){return le("ifft")},n.prototype.complex=function(e,t){return le("complex")},n.prototype.real=function(e){return le("real")},n.prototype.imag=function(e){return le("imag")},n.prototype.cropAndResize=function(e,t,r,i,o,s){return le("cropAndResize")},n.prototype.depthToSpace=function(e,t,r){return le("depthToSpace")},n.prototype.split=function(e,t,r){return le("split")},n.prototype.sparseToDense=function(e,t,r,i){return le("sparseToDense")},n.prototype.diag=function(e){return le("diag")},n.prototype.fill=function(e,t,r){return le("fill")},n.prototype.onesLike=function(e){return le("onesLike")},n.prototype.zerosLike=function(e){return le("zerosLike")},n.prototype.linspace=function(e,t,r){return le("linspace")},n.prototype.dispose=function(){return le("dispose")},n}();function le(n){throw new Error("'"+n+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Iu(n,e){for(var t=n.length,r=[],i=0;i<t;i++){var o=t-1-i;(e[e.length-1-i]||1)>1&&1===(n[o]||1)&&r.unshift(o)}return r}function li(n,e){for(var t=[],r=0;r<e.length;r++){var i=n[n.length-r-1],o=e.length-r-1;(null==i||1===i&&e[o]>1)&&t.unshift(o)}return t}function sn(n,e){for(var t=[],r=Math.max(n.length,e.length),i=0;i<r;i++){var o=n[n.length-i-1];null==o&&(o=1);var s=e[e.length-i-1];if(null==s&&(s=1),1===o)t.unshift(s);else if(1===s)t.unshift(o);else{if(o!==s)throw Error("Operands could not be broadcast together with shapes "+n+" and "+e+".");t.unshift(o)}}return t}function ud(n,e,t,r,i,o,s){void 0===s&&(s="channelsLast");var a,u=k1(e),c=u[0],d=u[1];if("channelsLast"===s)a=[c,d,n[3],n[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);a=[c,d,n[1],n[1]]}return Ec(n,a,t,r,i,o,!1,s)}function Ep(n,e,t,r,i,o,s){void 0===s&&(s="NDHWC");var a,u,c=mw(e),d=c[0],p=c[1],m=c[2];if("NDHWC"===s)u="channelsLast",a=[d,p,m,n[4],n[4]];else{if("NCDHW"!==s)throw new Error("Unknown dataFormat "+s);u="channelsFirst",a=[d,p,m,n[1],n[1]]}return Ip(n,a,t,r,i,!1,u,o)}function Ec(n,e,t,r,i,o,s,a){void 0===s&&(s=!1),void 0===a&&(a="channelsLast");var u=[-1,-1,-1,-1],c=u[0],d=u[1],p=u[2],m=u[3];if("channelsLast"===a)c=n[0],d=n[1],p=n[2],m=n[3];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);c=n[0],m=n[1],d=n[2],p=n[3]}var y,w=e[0],C=e[1],_=e[3],A=k1(t),T=A[0],N=A[1],M=k1(r),O=M[0],L=M[1],V=cd(w,O),j=cd(C,L),U=function(de,se,fe,we,ye,Ee,Se,je){var et,dt,zt;if("number"==typeof de){et={top:de,bottom:de,left:de,right:de,type:0===de?"VALID":"NUMBER"};var Gt=function(_n,nr,Hn,qr,Pr){null==qr&&(qr=gw(_n,nr,Hn));var eu=_n[1],tu=Ap((_n[0]-nr+2*qr)/Hn+1,Pr);X(Rr(tu),function(){return"The output # of rows ("+tu+") must be an integer. Change the stride and/or zero pad parameters"});var ss=Ap((eu-nr+2*qr)/Hn+1,Pr);return X(Rr(ss),function(){return"The output # of columns ("+ss+") must be an integer. Change the stride and/or zero pad parameters"}),[tu,ss]}([se,fe],Ee,we,de,je);dt=Gt[0],zt=Gt[1]}else if("same"===de){dt=Math.ceil(se/we),zt=Math.ceil(fe/ye);var dn=Math.max(0,(dt-1)*we+Ee-se),On=Math.max(0,(zt-1)*ye+Se-fe),wn=Math.floor(dn/2),kn=dn-wn,ni=Math.floor(On/2);et={top:wn,bottom:kn,left:ni,right:On-ni,type:"SAME"}}else{if("valid"!==de)throw Error("Unknown padding parameter: "+de);et={top:0,bottom:0,left:0,right:0,type:"VALID"},dt=Math.ceil((se-Ee+1)/we),zt=Math.ceil((fe-Se+1)/ye)}return{padInfo:et,outHeight:dt,outWidth:zt}}(i,d,p,T,N,V,j,o),K=U.outHeight,$=U.outWidth,he=s?_*m:_;return"channelsFirst"===a?y=[c,he,K,$]:"channelsLast"===a&&(y=[c,K,$,he]),{batchSize:c,dataFormat:a,inHeight:d,inWidth:p,inChannels:m,outHeight:K,outWidth:$,outChannels:he,padInfo:U.padInfo,strideHeight:T,strideWidth:N,filterHeight:w,filterWidth:C,effectiveFilterHeight:V,effectiveFilterWidth:j,dilationHeight:O,dilationWidth:L,inShape:n,outShape:y,filterShape:e}}function Ip(n,e,t,r,i,o,s,a){void 0===o&&(o=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],d=u[1],p=u[2],m=u[3],y=u[4];if("channelsLast"===s)c=n[0],d=n[1],p=n[2],m=n[3],y=n[4];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);c=n[0],y=n[1],d=n[2],p=n[3],m=n[4]}var w,C=e[0],_=e[1],A=e[2],T=e[4],N=mw(t),M=N[0],O=N[1],L=N[2],V=mw(r),j=V[0],U=V[1],G=V[2],K=cd(C,j),$=cd(_,U),he=cd(A,G),de=function(Se,je,et,dt,zt,Gt,dn,On,wn,kn,ni){var _n,nr,Hn,qr;if("number"==typeof Se){_n={top:Se,bottom:Se,left:Se,right:Se,front:Se,back:Se,type:0===Se?"VALID":"NUMBER"};var Pr=function(Nd,Hu,V_,Od,nu,U_){null==nu&&(nu=gw(Nd,Hu,Od));var yse=Nd[1],xse=Nd[2],j_=Ap((Nd[0]-Hu+2*nu)/Od+1,U_);X(Rr(j_),function(){return"The output # of depths ("+j_+") must be an integer. Change the stride and/or zero pad parameters"});var W_=Ap((yse-Hu+2*nu)/Od+1,U_);X(Rr(W_),function(){return"The output # of rows ("+W_+") must be an integer. Change the stride and/or zero pad parameters"});var H_=Ap((xse-Hu+2*nu)/Od+1,U_);return X(Rr(H_),function(){return"The output # of columns ("+H_+") must be an integer. Change the stride and/or zero pad parameters"}),[j_,W_,H_,1]}([je,et,dt,1],On,0,zt,Se,ni);nr=Pr[0],Hn=Pr[1],qr=Pr[2]}else if("same"===Se){var Fr=((nr=Math.ceil(je/zt))-1)*zt+On-je,eu=((Hn=Math.ceil(et/Gt))-1)*Gt+wn-et,tu=((qr=Math.ceil(dt/dn))-1)*dn+kn-dt,ss=Math.floor(Fr/2),Rd=Fr-ss,ju=Math.floor(eu/2),Lc=eu-ju,Wu=Math.floor(tu/2);_n={top:ju,bottom:Lc,left:Wu,right:tu-Wu,front:ss,back:Rd,type:"SAME"}}else{if("valid"!==Se)throw Error("Unknown padding parameter: "+Se);_n={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},nr=Math.ceil((je-On+1)/zt),Hn=Math.ceil((et-wn+1)/Gt),qr=Math.ceil((dt-kn+1)/dn)}return{padInfo:_n,outDepth:nr,outHeight:Hn,outWidth:qr}}(i,d,p,m,M,O,L,K,$,he,a),fe=de.outDepth,we=de.outHeight,ye=de.outWidth,Ee=o?T*y:T;return"channelsFirst"===s?w=[c,Ee,fe,we,ye]:"channelsLast"===s&&(w=[c,fe,we,ye,Ee]),{batchSize:c,dataFormat:s,inDepth:d,inHeight:p,inWidth:m,inChannels:y,outDepth:fe,outHeight:we,outWidth:ye,outChannels:Ee,padInfo:de.padInfo,strideDepth:M,strideHeight:O,strideWidth:L,filterDepth:C,filterHeight:_,filterWidth:A,effectiveFilterDepth:K,effectiveFilterHeight:$,effectiveFilterWidth:he,dilationDepth:j,dilationHeight:U,dilationWidth:G,inShape:n,outShape:w,filterShape:e}}function gw(n,e,t,r){void 0===r&&(r=1);var i=cd(e,r);return Math.floor((n[0]*(t-1)-t+i)/2)}function k1(n){return"number"==typeof n?[n,n,n]:2===n.length?[n[0],n[1],1]:n}function mw(n){return"number"==typeof n?[n,n,n]:n}function cd(n,e){return e<=1?n:n+(n-1)*(e-1)}function Ap(n,e){if(!e)return n;switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+e)}}function _l(n){var e=k1(n);return 1===e[0]&&1===e[1]&&1===e[2]}function Eo(n,e){return _l(n)||_l(e)}function P1(n){if("NHWC"===n)return"channelsLast";if("NCHW"===n)return"channelsFirst";throw new Error("Unknown dataFormat "+n)}function vw(n,e,t){if("complex64"===e){if("complex64"===n.dtype)return n.clone();var r=xr(n.shape),i=n.toFloat(),o=t.complex(i,r);return r.dispose(),i.dispose(),o}if(!aR(n.dtype,e))return Z.makeTensorFromDataId(n.dataId,n.shape,e);if("complex64"===n.dtype){var s=t.real(n);return o=s.cast(e),s.dispose(),o}if("int32"===e)return t.int(n);if("bool"===e){var a=Ue(0,n.dtype);return o=t.notEqual(n,a),a.dispose(),o}throw new Error("Error in Cast: failed to cast "+n.dtype+" to "+e)}function F1(n,e){return Z.makeTensorFromDataId(n.dataId,e,n.dtype)}function yw(n,e,t){var r=(e-n)/(t-1),i=id(t,"float32");i[0]=n;for(var o=1;o<i.length;o++)i[o]=i[o-1]+r;return ci(i,"float32")}function xw(n,e){if(n.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+e.length+".");for(var t=new Float32Array(2*n.length),r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function l3(n,e){return{real:n[2*e],imag:n[2*e+1]}}function vX(n,e,t,r){n[2*r]=e,n[2*r+1]=t}function yX(n,e,t){var r=(t?2:-2)*Math.PI*(n/e);return{real:Math.cos(r),imag:Math.sin(r)}}function xX(n,e,t){var r=function(u,c,d){for(var p=0,m=u.length,y=0,w=!1;p<m;){var C=d(c,u[y=p+(m-p>>>1)]);C>0?p=y+1:(m=y,w=!C)}return w?p:-p-1}(n,e,t||bX);n.splice(r<0?-(r+1):r,0,e)}function bX(n,e){return n>e?1:n<e?-1:0}function bw(n,e,t,r,i){return h3(n,e,t,r,i,0).selectedIndices}function ww(n,e,t,r,i,o){var s=h3(n,e,t,r,i,o,!0);return s.numValidOutputs.dispose(),{selectedIndices:s.selectedIndices,selectedScores:s.selectedScores}}function h3(n,e,t,r,i,o,s,a){void 0===s&&(s=!1),void 0===a&&(a=!1);for(var u=Array.from(e).map(function(M,O){return{score:M,boxIndex:O,suppressBeginIndex:0}}).filter(function(M){return M.score>i}).sort(d3),c=o>0?-.5/o:0,d=[],p=[];d.length<t&&u.length>0;){var m=u.pop(),y=m.score,w=m.boxIndex,C=m.suppressBeginIndex;if(y<i)break;for(var _=!1,A=d.length-1;A>=C;--A){var T=wX(n,w,d[A]);if(T>=r){_=!0;break}if(m.score=m.score*_X(r,c,T),m.score<=i)break}m.suppressBeginIndex=d.length,_||(m.score===y?(d.push(w),p.push(m.score)):m.score>i&&xX(u,m,d3))}var N=d.length;return a&&(d.fill(0,N),p.fill(0,N)),{selectedIndices:ci(d,"int32"),selectedScores:ci(p,"float32"),numValidOutputs:Ue(N,"int32")}}function wX(n,e,t){var r=n.subarray(4*e,4*e+4),i=n.subarray(4*t,4*t+4),o=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(i[0],i[2]),d=Math.min(i[1],i[3]),p=Math.max(i[0],i[2]),m=Math.max(i[1],i[3]),y=(a-o)*(u-s),w=(p-c)*(m-d);if(y<=0||w<=0)return 0;var C=Math.max(o,c),_=Math.max(s,d),A=Math.min(a,p),T=Math.min(u,m),N=Math.max(A-C,0)*Math.max(T-_,0);return N/(y+w-N)}function _X(n,e,t){var r=Math.exp(e*t*t);return t<=n?r:0}function d3(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}function f3(n,e,t){var r=new Array(n.rank).fill(0),i=n.shape.slice();return e.map(function(o){i[t]=o;var s=n.slice(r,i);return r[t]+=o,s})}function p3(n,e){for(var t=new Array(n.rank),r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];var i=Vt(t,n.dtype);for(r=0;r<i.values.length;++r){for(var o=i.indexToLoc(r),s=new Array(n.rank),a=0;a<s.length;a++)s[a]=o[a]%n.shape[a];var u=n.locToIndex(s);i.values[r]=n.values[u]}return i.toTensor()}function g3(n,e,t,r,i){for(var o=e[e.length-1],s=[n.length/o,o],a=s[0],u=s[1],c=nd(t,a*r),d=nd("int32",a*r),p=0;p<a;p++){for(var m=p*u,y=n.subarray(m,m+u),w=[],C=0;C<y.length;C++)w.push({value:y[C],index:C});w.sort(function(M,O){return O.value-M.value});var _=p*r,A=c.subarray(_,_+r),T=d.subarray(_,_+r);for(C=0;C<r;C++)A[C]=w[C].value,T[C]=w[C].index}var N=e.slice();return N[N.length-1]=r,[Xi(c,N,t),Xi(d,N,"int32")]}function _w(n,e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(r);var i=Vt(n,"int32"),o=Vt([t.length,n.length],"int32");for(r=0;r<t.length;r++){var s=i.indexToLoc(t[r]);o.values.set(s,r*n.length)}return o.toTensor()}Object.freeze({castTensor:vw,reshapeTensor:F1,linspaceImpl:yw,upcastType:ki,axesAreInnerMostDims:ow,combineLocations:XR,computeOutAndReduceShapes:Gi,expandShapeToKeepDim:Co,assertAxesAreInnerMostDims:ko,getAxesPermutation:aa,getUndoAxesPermutation:E1,getInnerMostAxes:ua,getBroadcastDims:Iu,getReductionAxes:li,assertAndGetBroadcastShape:sn,assertParamsConsistent:qR,computeOutShape:yl,computePool2DInfo:ud,computePool3DInfo:Ep,computeConv2DInfo:Ec,computeConv3DInfo:Ip,computeDefaultPad:gw,tupleValuesAreOne:_l,eitherStridesOrDilationsAreOne:Eo,convertConv2DDataFormat:P1,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:M1});var CX=function(n,e){this.outputShape=[],this.outputShape=n,this.variableNames=e.map(function(i,o){return"T"+o});var t=[];this.variableNames.forEach(function(i){t.push("float v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode="\n      void main() {\n        "+t.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},EX=function(n,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=e.map(function(i,o){return"T"+o});var t=[];this.variableNames.forEach(function(i){t.push("vec4 v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode="\n      void main() {\n        "+t.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},IX=function(n,e,t){this.variableNames=["A"];var r=n.windowSize,i=n.batchSize,s=Math.ceil(n.inSize/r);t||this.variableNames.push("bestIndicesA"),this.outputShape=[i,s],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+(t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));")+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+("max"===e?">":"<")+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function m3(n,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return n+"."+t})}function Fo(n,e){return 1===e?[n]:m3(n,e)}function io(){var n,e,t,r,i,o,s,a,u,c;return 2===ge().getNumber("WEBGL_VERSION")?(n="#version 300 es",e="in",t="out",r="in",i="texture",o="outputColor",s="out vec4 outputColor;",a="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(n="",e="attribute",t="varying",r="varying",i="texture2D",o="gl_FragColor",s="",a="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:i,output:o,defineOutput:s,defineSpecialNaN:a,defineSpecialInf:u,defineRound:c}}function Cl(n,e,t){void 0===t&&(t="index");var r=oa(e);return r.map(function(i,o){return"int "+n[o]+" = "+t+" / "+i+"; "+(o===r.length-1?"int "+n[o+1]+" = "+t+" - "+n[o]+" * "+i:"index -= "+n[o]+" * "+i)+";"}).join("")}function Cw(n){var e=oa(n).map(function(t){return t.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+e[0]+" + coords.y * "+e[1]+" + coords.z;\n  }\n"}var v3="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function AX(n,e,t,r){var i=[];n.forEach(function(y){var w=st(y.shapeInfo.logicalShape);y.shapeInfo.isUniform?i.push("uniform float "+y.name+(w>1?"["+w+"]":"")+";"):(i.push("uniform sampler2D "+y.name+";"),i.push("uniform int offset"+y.name+";"))});var o,s,y,a=i.join("\n"),u=n.map(function(y){return function(w,C,_){void 0===_&&(_=!1);var A="";return A+=_?y3(w):ld(w),w.shapeInfo.logicalShape.length<=C.logicalShape.length&&(A+=_?function(M,O){var L,fe,V=M.name,j=V.charAt(0).toUpperCase()+V.slice(1),U="get"+j+"AtOutCoords",G=M.shapeInfo.logicalShape.length,K=O.logicalShape.length,$=Iu(M.shapeInfo.logicalShape,O.logicalShape),he=lr(K),de=K-G,se=["x","y","z","w","u","v"];L=0===G?"":K<2&&$.length>=1?"coords = 0;":$.map(function(et){return"coords."+se[et+de]+" = 0;"}).join("\n"),fe=K<2&&G>0?"coords":M.shapeInfo.logicalShape.map(function(et,dt){return"coords."+se[dt+de]}).join(", ");var we="return outputValue;",ye=1===st(M.shapeInfo.logicalShape),Ee=1===st(O.logicalShape);if(1!==G||ye||Ee){if(ye&&!Ee)we=1===K?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if($.length){var Se=G-2,je=G-1;$.indexOf(Se)>-1&&$.indexOf(je)>-1?we="return vec4(outputValue.x);":$.indexOf(Se)>-1?we="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":$.indexOf(je)>-1&&(we="return vec4(outputValue.xx, outputValue.zz);")}}else we="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+U+"() {\n      "+he+" coords = getOutputCoords();\n      "+L+"\n      vec4 outputValue = get"+j+"("+fe+");\n      "+we+"\n    }\n  "}(w,C):function(M,O){var L=M.name,V=L.charAt(0).toUpperCase()+L.slice(1),j="get"+V+"AtOutCoords",K=M.shapeInfo.logicalShape.length,$=O.logicalShape.length;if(!M.shapeInfo.isUniform&&K===$&&null==M.shapeInfo.flatOffset&&ai(M.shapeInfo.texShape,O.texShape))return"\n      float "+j+"() {\n        return sampleTexture("+L+", resultUV);\n      }\n    ";var de=lr($),se=Iu(M.shapeInfo.logicalShape,O.logicalShape),fe=$-K,we=["x","y","z","w","u","v"];return"\n    float "+j+"() {\n      "+de+" coords = getOutputCoords();\n      "+(0===K?"":$<2&&se.length>=1?"coords = 0;":se.map(function(Ee){return"coords."+we[Ee+fe]+" = 0;"}).join("\n"))+"\n      return get"+V+"("+($<2&&K>0?"coords":M.shapeInfo.logicalShape.map(function(Ee,Se){return"coords."+we[Se+fe]}).join(", "))+");\n    }\n  "}(w,C)),A}(y,e,r)}).join("\n"),c=e.texShape,d=io(),p="\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+d.texture2D+"(textureSampler, uv).r;\n    }\n  ",m=(y=d).version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+y.varyingFs+" vec2 resultUV;\n    "+y.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+y.defineSpecialNaN+"\n    "+y.defineSpecialInf+"\n    "+y.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+DX+"\n    "+SX+"\n    "+TX+"\n  ";return e.isPacked?(o=function(y,w){switch(y.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return O=w,1===(L=[Math.ceil(O[0]/2),Math.ceil(O[1]/2)])[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+L[1]+".0);\n      }\n    ":1===L[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+L[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+L[0]+", "+L[1]+"));\n      return 2 * (resTexRC.x * "+L[1]+" + resTexRC.y);\n    }\n  ";case 2:return function(M,O){var L=[Math.ceil(O[0]/2),Math.ceil(O[1]/2)];if(ai(M,O))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+L[0]+", "+L[1]+"));\n      }\n    ";var V=Math.ceil(M[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+L[0]+", "+L[1]+"));\n\n      int index = resTexRC.x * "+L[1]+" + resTexRC.y;\n      int r = 2 * (index / "+V+");\n      int c = imod(index, "+V+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(y,w);case 3:return C=y,_=w,A=[Math.ceil(_[0]/2),Math.ceil(_[1]/2)],N=(T=Math.ceil(C[2]/2))*Math.ceil(C[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+A[0]+", "+A[1]+"));\n      int index = resTexRC.x * "+A[1]+" + resTexRC.y;\n\n      int b = index / "+N+";\n      index -= b * "+N+";\n\n      int r = 2 * (index / "+T+");\n      int c = imod(index, "+T+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(M,O){for(var L=[Math.ceil(O[0]/2),Math.ceil(O[1]/2)],V=Math.ceil(M[M.length-1]/2),j=V*Math.ceil(M[M.length-2]/2),U=j,G="",K="b, r, c",$=2;$<M.length-1;$++)G="\n      int b"+$+" = index / "+(U*=M[M.length-$-1])+";\n      index -= b"+$+" * "+U+";\n    "+G,K="b"+$+", "+K;return"\n    ivec"+M.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+L[0]+", "+L[1]+"));\n      int index = resTexRC.x * "+L[1]+" + resTexRC.y;\n\n      "+G+"\n\n      int b = index / "+j+";\n      index -= b * "+j+";\n\n      int r = 2 * (index / "+V+");\n      int c = imod(index, "+V+") * 2;\n\n      return ivec"+M.length+"("+K+");\n    }\n  "}(y,w)}var O,L,C,_,A,T,N}(e.logicalShape,c),s=function(y){return"\n    void setOutput(vec4 val) {\n      "+y.output+" = val;\n    }\n  "}(d)):(o=function(y,w){switch(y.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return 1===(T=w)[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+T[1]+".0);\n      }\n    ":1===T[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+T[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+T[0]+", "+T[1]+"));\n      return resTexRC.x * "+T[1]+" + resTexRC.y;\n    }\n  ";case 2:return function(A,T){return ai(A,T)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+T[0]+", "+T[1]+"));\n      }\n    ":1===A[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+T[0]+", "+T[1]+"));\n        int index = resTexRC.x * "+T[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===A[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+T[0]+", "+T[1]+"));\n        int index = resTexRC.x * "+T[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+T[0]+", "+T[1]+"));\n      int index = resTexRC.x * "+T[1]+" + resTexRC.y;\n      int r = index / "+A[1]+";\n      int c = index - r * "+A[1]+";\n      return ivec2(r, c);\n    }\n  "}(y,w);case 3:return C=w,_=Cl(["r","c","d"],y),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+C[0]+", "+C[1]+"));\n      int index = resTexRC.x * "+C[1]+" + resTexRC.y;\n      "+_+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(A,T){var N=Cl(["r","c","d","d2"],A);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+T[0]+", "+T[1]+"));\n      int index = resTexRC.x * "+T[1]+" + resTexRC.y;\n      "+N+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(y,w);case 5:return function(A,T){var N=Cl(["r","c","d","d2","d3"],A);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+T[0]+",\n                             "+T[1]+"));\n\n      int index = resTexRC.x * "+T[1]+" + resTexRC.y;\n\n      "+N+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(y,w);case 6:return function(A,T){var N=Cl(["r","c","d","d2","d3","d4"],A);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+T[0]+", "+T[1]+"));\n      int index = resTexRC.x * "+T[1]+" + resTexRC.y;\n\n      "+N+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(y,w);default:throw new Error(y.length+"-D output sampling is not yet supported")}var T,C,_}(e.logicalShape,c),s=function(y){return"\n    void setOutput(float val) {\n      "+y.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(d)),r&&(m+=MX),[m,p,s,a,o,u,t].join("\n")}function ld(n){var e=n.shapeInfo.logicalShape;switch(e.length){case 0:return function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return"float "+i+"() {return "+r+";}";var o=t.shapeInfo.texShape;if(1===o[0]&&1===o[1])return"\n      float "+i+"() {\n        return sampleTexture("+r+", halfCR);\n      }\n    ";var u=t.shapeInfo.texShape;return"\n    float "+i+"() {\n      vec2 uv = uvFromFlat("+u[0]+", "+u[1]+", "+El(r)+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(n);case 1:return function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return"\n      float "+i+"(int index) {\n        "+hd(t)+"\n      }\n    ";var o=t.shapeInfo.texShape,s=o[0],a=o[1];if(1===a&&1===s)return"\n      float "+i+"(int index) {\n        return sampleTexture("+r+", halfCR);\n      }\n    ";var u=El(r);return 1===a?"\n      float "+i+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+u+") + 0.5) / "+s+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":1===s?"\n      float "+i+"(int index) {\n        vec2 uv = vec2((float(index + "+u+") + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+i+"(int index) {\n      vec2 uv = uvFromFlat("+s+", "+a+", index + "+u+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(n);case 2:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=t.shapeInfo.texShape;if(null!=s&&ai(r,s))return"\n    float "+o+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+s[1]+".0, "+s[0]+".0);\n      return sampleTexture("+i+", uv);\n    }\n  ";var c=xc(r),d=c.newShape,p=c.keptDims;if(d.length<r.length)return"\n      "+ld(dd(t,d))+"\n      float "+o+"(int row, int col) {\n        return "+o+"("+fd(["row","col"],p)+");\n      }\n    ";if(t.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+r[1]+", 1)));\n        "+hd(t)+"\n      }\n    ";var w=s[0],C=s[1],_=El(i);return 1===C?"\n    float "+o+"(int row, int col) {\n      float index = dot(vec3(row, col, "+_+"), vec3("+r[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+w+".0);\n      return sampleTexture("+i+", uv);\n    }\n  ":1===w?"\n    float "+o+"(int row, int col) {\n      float index = dot(vec3(row, col, "+_+"), vec3("+r[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+C+".0, 0.5);\n      return sampleTexture("+i+", uv);\n    }\n  ":"\n  float "+o+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+r[1]+" + col + "+_+";\n    vec2 uv = uvFromFlat("+w+", "+C+", index);\n    return sampleTexture("+i+", uv);\n  }\n"}(n);case 3:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[1]*r[2],a=r[2],u=xc(r),c=u.newShape,d=u.keptDims;if(c.length<r.length)return"\n        "+ld(dd(t,c))+"\n        float "+o+"(int row, int col, int depth) {\n          return "+o+"("+fd(["row","col","depth"],d)+");\n        }\n      ";if(t.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+s+", "+a+", 1)));\n        "+hd(t)+"\n      }\n    ";var y=t.shapeInfo.texShape,w=y[0],C=y[1],_=t.shapeInfo.flatOffset;return C===s&&null==_?"\n        float "+o+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+C+".0, "+w+".0);\n          return sampleTexture("+i+", uv);\n        }\n      ":C===a&&null==_?"\n    float "+o+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+r[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+C+".0, "+w+".0);\n      return sampleTexture("+i+", uv);\n    }\n  ":"\n      float "+o+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+s+" + col * "+a+" + depth + "+El(i)+";\n        vec2 uv = uvFromFlat("+w+", "+C+", index);\n        return sampleTexture("+i+", uv);\n      }\n  "}(n);case 4:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[3],a=r[2]*s,u=r[1]*a,c=xc(r),d=c.newShape,p=c.keptDims;if(d.length<r.length)return"\n      "+ld(dd(t,d))+"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        return "+o+"("+fd(["row","col","depth","depth2"],p)+");\n      }\n    ";if(t.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+u+", "+a+", "+s+", 1)));\n        "+hd(t)+"\n      }\n    ";var y=t.shapeInfo.flatOffset,w=t.shapeInfo.texShape,C=w[0],_=w[1];return _===u&&null==y?"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+a+", "+s+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+_+".0, "+C+".0);\n        return sampleTexture("+i+", uv);\n      }\n    ":_===s&&null==y?"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+r[1]*r[2]+", "+r[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+_+".0, "+C+".0);\n        return sampleTexture("+i+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+u+" + col * "+a+" +\n          depth * "+s+" + depth2;\n      vec2 uv = uvFromFlat("+C+", "+_+", index + "+El(i)+");\n      return sampleTexture("+i+", uv);\n    }\n  "}(n);case 5:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[4],a=r[3]*s,u=r[2]*a,c=r[1]*u,d=xc(r),p=d.newShape,m=d.keptDims;if(p.length<r.length)return"\n      "+ld(dd(t,p))+"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+o+"("+fd(["row","col","depth","depth2","depth3"],m)+");\n      }\n    ";if(t.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+c+", "+u+", "+a+", "+s+")) +\n          depth3;\n        "+hd(t)+"\n      }\n    ";var w=t.shapeInfo.flatOffset,C=t.shapeInfo.texShape,_=C[0],A=C[1];return A===c&&null==w?"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+u+", "+a+", "+s+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+A+".0, "+_+".0);\n        return sampleTexture("+i+", uv);\n      }\n    ":A===s&&null==w?"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+r[1]*r[2]*r[3]+",\n               "+r[2]*r[3]+", "+r[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+A+".0, "+_+".0);\n        return sampleTexture("+i+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+c+" + col * "+u+" + depth * "+a+" +\n          depth2 * "+s+" + depth3 + "+El(i)+";\n      vec2 uv = uvFromFlat("+_+", "+A+", index);\n      return sampleTexture("+i+", uv);\n    }\n  "}(n);case 6:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=xc(r),a=s.newShape,u=s.keptDims;if(a.length<r.length)return"\n      "+ld(dd(t,a))+"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+o+"("+fd(["row","col","depth","depth2","depth3","depth4"],u)+");\n      }\n    ";var d=r[5],p=r[4]*d,m=r[3]*p,y=r[2]*m,w=r[1]*y;if(t.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+w+", "+y+", "+m+", "+p+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+d+", 1)));\n        "+hd(t)+"\n      }\n    ";var C=t.shapeInfo.flatOffset,_=t.shapeInfo.texShape,A=_[0],T=_[1];return T===w&&null==C?"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+y+", "+m+", "+p+", "+d+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+T+".0, "+A+".0);\n        return sampleTexture("+i+", uv);\n      }\n    ":T===d&&null==C?"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+r[1]*r[2]*r[3]*r[4]+",\n               "+r[2]*r[3]*r[4]+",\n               "+r[3]*r[4]+",\n               "+r[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+T+".0, "+A+".0);\n        return sampleTexture("+i+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+w+" + col * "+y+" + depth * "+m+" +\n          depth2 * "+p+" + depth3 * "+d+" + depth4 + "+El(i)+";\n      vec2 uv = uvFromFlat("+A+", "+T+", index);\n      return sampleTexture("+i+", uv);\n    }\n  "}(n);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function y3(n){var e,i,o,s,a,u,c;switch(n.shapeInfo.logicalShape.length){case 0:return"\n    vec4 get"+(e=n.name).charAt(0).toUpperCase()+e.slice(1)+"() {\n      return "+io().texture2D+"("+e+", halfCR);\n    }\n  ";case 1:return s="get"+(o=(i=n).name).charAt(0).toUpperCase()+o.slice(1),a=i.shapeInfo.texShape,u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=io(),"\n    vec4 "+s+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+u[0]+", "+u[1]+", index);\n      return "+c.texture2D+"("+o+", uv);\n    }\n  ";case 2:return function(i){var o=i.shapeInfo.logicalShape,s=i.name,a="get"+s.charAt(0).toUpperCase()+s.slice(1),u=i.shapeInfo.texShape,c=u[0],d=u[1],p=io();if(null!=u&&ai(o,u))return"\n      vec4 "+a+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+d+".0, "+c+".0);\n\n        return "+p.texture2D+"("+s+", uv);\n      }\n    ";var m=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];return"\n    vec4 "+a+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(o[1]/2)+", "+m[0]+", "+m[1]+", row, col);\n      return "+p.texture2D+"("+s+", uv);\n    }\n  "}(n);case 3:return function(i){var o=i.shapeInfo.logicalShape,s=i.name,a="get"+s.charAt(0).toUpperCase()+s.slice(1),u=i.shapeInfo.texShape,c=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(1===o[0])return"\n        "+y3(dd(i,o.slice(1)))+"\n        vec4 "+a+"(int b, int row, int col) {\n          return "+a+"("+fd(["b","row","col"],[1,2])+");\n        }\n      ";var m=c[0],y=c[1],w=Math.ceil(o[2]/2);return"\n    vec4 "+a+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+m+", "+y+", "+w*Math.ceil(o[1]/2)+", "+w+", b, row, col);\n      return "+io().texture2D+"("+s+", uv);\n    }\n  "}(n);default:return function(i){for(var o=i.shapeInfo.logicalShape,s=o.length,a=i.name,u="get"+a.charAt(0).toUpperCase()+a.slice(1),c=i.shapeInfo.texShape,d=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],p=d[0],m=d[1],y=Math.ceil(o[s-1]/2),w=y*Math.ceil(o[s-2]/2),C="int b, int row, int col",_="b * "+w+" + (row / 2) * "+y+" + (col / 2)",A=2;A<s-1;A++)C="int b"+A+", "+C,_="b"+A+" * "+(w*=o[s-A-1])+" + "+_;return"\n    vec4 "+u+"("+C+") {\n      int index = "+_+";\n      int texR = index / "+m+";\n      int texC = index - texR * "+m+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+m+", "+p+");\n      return "+io().texture2D+"("+a+", uv);\n    }\n  "}(n)}}var DX="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",SX="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",TX="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",MX="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function El(n){return"offset"+n}function hd(n){var e=n.name,t=st(n.shapeInfo.logicalShape);return t<2?"return "+e+";":"\n    for (int i = 0; i < "+t+"; i++) {\n      if (i == index) {\n        return "+e+"[i];\n      }\n    }\n  "}function lr(n){if(n<=1)return"int";if(2===n)return"ivec2";if(3===n)return"ivec3";if(4===n)return"ivec4";if(5===n)return"ivec5";if(6===n)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function dd(n,e){var t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function fd(n,e){return e.map(function(t){return n[t]}).join(", ")}var RX=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,X(n.length>2,function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."});var o=Math.ceil(n[n.length-1]/e);this.outputShape=n.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var s,a,u=this.outputShape,c=u.length,d=lr(c),p=Fo("coords",c);if(1===o){var m=lr(a=c+1);s="\n        "+m+" sourceLocR = "+m+"("+p.join()+", 0);\n        ++"+p[c-1]+";\n        "+m+" sourceLocG = "+m+"("+p.join()+", 0);\n        ++"+p[c-2]+";\n        "+m+" sourceLocA = "+m+"("+p.join()+", 0);\n        --"+p[c-1]+";\n        "+m+" sourceLocB = "+m+"("+p.join()+", 0);\n        --"+p[c-2]+";"}else a=c,s="\n        "+d+" sourceLocR = coords;\n        ++"+p[c-1]+";\n        "+d+" sourceLocG = coords;\n        ++"+p[c-2]+";\n        "+d+" sourceLocA = coords;\n        --"+p[c-1]+";\n        "+d+" sourceLocB = coords;\n        --"+p[c-2]+";";var y=["x","y","z","w","u","v"].slice(0,a),w="."+y[a-1],C=y.map(function(j){return"int "+j}),_=Fo("sourceLocR",a-1).concat("inIdx.r"),A=Fo("sourceLocG",a-1).concat("inIdx.g"),T=Fo("sourceLocB",a-1).concat("inIdx.b"),N=Fo("sourceLocA",a-1).concat("inIdx.a"),M="max"===t?"greaterThan":"lessThan",O=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+_.join()+"),\n                             getBestIndicesAChannel("+A.join()+"),\n                             getBestIndicesAChannel("+T.join()+"),\n                             getBestIndicesAChannel("+N.join()+")));",L="vec4(\n            getAChannel("+_.join()+"),\n            hasNextCol ? getAChannel("+A.join()+") : 0.,\n            hasNextRow ? getAChannel("+T.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+N.join()+") : 0.)",V=r?"":"\n      float getBestIndicesAChannel("+C.join()+") {\n        return getChannel(getBestIndicesA("+y.join()+"),\n                                          vec2("+y.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+C.join()+") {\n        return getChannel(getA("+y.join()+"),\n                               vec2("+y.slice(-2).join()+"));\n      }\n      "+V+"\n      void main() {\n        "+d+" coords = getOutputCoords();\n        bool hasNextCol = "+p[c-1]+" < "+(u[c-1]-1)+";\n        bool hasNextRow = "+p[c-2]+" < "+(u[c-2]-1)+";\n        "+s+"\n        ivec4 srcIdx = ivec4(sourceLocR"+w+", sourceLocG"+w+",\n          sourceLocB"+w+", sourceLocA"+w+") * "+e+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+L+";\n\n        for (int i = 0; i < "+e+"; i++) {\n          inIdx = srcIdx;\n          "+O+"\n          vec4 candidate = "+L+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+M+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},NX=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var a=n.effectiveFilterHeight,u=n.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(a-1-n.padInfo.top)+", "+(u-1-n.padInfo.left)+");\n      const float avgMultiplier = float("+1/(n.filterHeight*n.filterWidth)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+a+";\n            wR += "+n.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+n.dilationWidth+") {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},OX=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var d=n.effectiveFilterDepth,p=n.effectiveFilterHeight,m=n.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(d-1-n.padInfo.front)+", "+(p-1-n.padInfo.top)+", "+(m-1-n.padInfo.left)+");\n      const float avgMultiplier = float("+1/(n.filterDepth*n.filterHeight*n.filterWidth)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+d+";\n            wD += "+n.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+n.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+n.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+p+";\n              wR += "+n.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+n.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+m+";\n                wC += "+n.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},kX=function(n,e,t,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],sn(n,e),sn(n,t);var s="0.0";null!=r&&(sn(n,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var a="1.0";null!=i&&(sn(n,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=n,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+s+";\n        float scale = "+a+";\n        float inv = scale * inversesqrt(variance + float("+o+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},PX=function(n,e,t,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],sn(n,e),sn(n,t);var s="vec4(0.0)";null!=r&&(sn(n,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var a="vec4(1.0)";null!=i&&(sn(n,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=n,this.userCode="\n      void main() {\n        vec4 offset = "+s+";\n        vec4 scale = "+a+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+o+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},x3=function(n,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=sn(e,t),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+n+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},Ew="return a + b;",Iw="return a - b;",b3="return a * b;",w3="return (a < 0.) ? b * a : a;",Yr=function(n,e,t){this.variableNames=["A","B"],this.outputShape=sn(e,t),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+n+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},_3="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",Au=function(n,e,t,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=sn(e,t);var i=this.outputShape.length,o="";if(r)if(0===i||1===st(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(o="\n          "+lr(i)+" coords = getOutputCoords();\n        ",1===i)o+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var s=Fo("coords",i);o+="\n            bool nextRowOutOfBounds =\n              ("+s[i-2]+" + 1) >= "+this.outputShape[i-2]+";\n            bool nextColOutOfBounds =\n              ("+s[i-1]+" + 1) >= "+this.outputShape[i-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+n+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+o+"\n\n        setOutput(result);\n      }\n    "},BX=function(){function n(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,o){null==r.minLoc&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n}(),VX=function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,o){null==r.minLoc&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n}(),UX=function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},jX=function(n){this.outputShape=[],this.outputShape=yl(n,1),this.variableNames=n.map(function(a,u){return"T"+u});var e=new Array(n.length-1);e[0]=n[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+n[t][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++)r.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+e[t-1]+"));");r.push("else setOutput(getT"+e.length+"(yR, yC-"+e[e.length-1]+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},WX=function(n,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=yl(n,e);var t=this.outputShape,r=t.length,i=lr(r),o=Fo("coords",r),s=["x","y","z","w","u","v"].slice(0,r);this.variableNames=n.map(function(_,A){return"T"+A});var a=new Array(n.length-1);a[0]=n[0][e];for(var u=1;u<a.length;u++)a[u]=a[u-1]+n[u][e];var c=s[e],d=s.slice(-2),p=s.join(),m="if ("+c+" < "+a[0]+") {\n        return getChannel(\n            getT0("+p+"), vec2("+d.join()+"));\n        }";for(u=1;u<a.length;u++){var y=a[u-1];m+="\n        if ("+c+" < "+a[u]+"  && "+c+" >= "+a[u-1]+") {\n          return getChannel(\n            getT"+u+"("+L1(s,c,y)+"),\n            vec2("+L1(d,c,y)+"));\n        }"}var C=a[a.length-1];m+="\n        return getChannel(\n          getT"+a.length+"("+L1(s,c,C)+"),\n          vec2("+L1(d,c,C)+"));",this.userCode="\n      float getValue("+s.map(function(_){return"int "+_})+") {\n        "+m+"\n      }\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+o+"), 0., 0., 0.);\n\n        "+o[r-1]+" = "+o[r-1]+" + 1;\n        if ("+o[r-1]+" < "+t[r-1]+") {\n          result.g = getValue("+o+");\n        }\n\n        "+o[r-2]+" = "+o[r-2]+" + 1;\n        if ("+o[r-2]+" < "+t[r-2]+") {\n          result.a = getValue("+o+");\n        }\n\n        "+o[r-1]+" = "+o[r-1]+" - 1;\n        if ("+o[r-2]+" < "+t[r-2]+" &&\n            "+o[r-1]+" < "+t[r-1]+") {\n          result.b = getValue("+o+");\n        }\n        setOutput(result);\n      }\n    "};function L1(n,e,t){var r=n.indexOf(e);return n.map(function(i,o){return o===r?i+" - "+t:i}).join()}var HX=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n            int xR = wR + yR * "+n.strideHeight+" - "+n.padInfo.top+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n              int xC = wC + yC * "+n.strideWidth+" - "+n.padInfo.left+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              if ("+("channelsLast"===n.dataFormat)+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},zX=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,o="channelsLast"===n.dataFormat;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-n.padInfo.top)+", "+(t-1-n.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+(o?3:1)+"];\n\n        ivec2 dyCorner = ivec2(coords["+(o?1:2)+"], coords["+(o?2:3)+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+t+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+t+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+n.outChannels+"; d2++) {\n\n              if ("+o+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},GX=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape,this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yF = 0; yF < "+n.outDepth+"; yF++) {\n            int xF = wF + yF * "+n.strideDepth+" - "+n.padInfo.front+";\n\n            if (xF < 0 || xF >= "+n.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n              int xR = wR + yR * "+n.strideHeight+" - "+n.padInfo.top+";\n\n              if (xR < 0 || xR >= "+n.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n                int xC = wC + yC * "+n.strideWidth+" - "+n.padInfo.left+";\n\n                if (xC < 0 || xC >= "+n.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},YX=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(e-1-n.padInfo.front)+", "+(t-1-n.padInfo.top)+", "+(r-1-n.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+e+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+n.strideDepth+".0;\n\n          if (dyF < 0.0 || dyF >= "+n.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+e+" - 1 - wF;\n\n          for (int wR = 0; wR < "+t+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+n.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+t+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+n.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},XX=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+n.outChannels/n.inChannels+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n            int xR = wR + yR * "+n.strideHeight+" - "+n.padInfo.top+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n              int xC = wC + yC * "+n.strideWidth+" - "+n.padInfo.left+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},qX=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,a=n.outChannels/n.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-n.padInfo.top)+", "+(t-1-n.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+t+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+t+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+a+"; dm++) {\n              int d2 = d1 * "+a+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},C3=function(n,e,t,r){void 0===e&&(e=!1),void 0===t&&(t=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var i=n.padInfo.top,o=n.padInfo.left,s=n.strideHeight,a=n.strideWidth,u=n.dilationHeight,c=n.dilationWidth,d=n.filterHeight,p=n.filterWidth,m=4*Math.floor(n.inChannels/4),y=n.inChannels%4,w="channelsLast"===n.dataFormat,C=w?1:2,_=w?2:3,A=w?3:1,T="",N="";t&&(T=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+t+"\n        }":"\n          float activation(float x) {\n            "+t+"\n          }\n        ",N="result = activation(result);");var M=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+T+"\n\n      const ivec2 strides = ivec2("+s+", "+a+");\n      const ivec2 pads = ivec2("+i+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+A+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+C+"], coords["+_+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+d+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+n.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+p+"; wC++) {\n            int xC = xCCorner + wC * "+c+";\n\n            if (xC < 0 || xC >= "+n.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+m+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+w+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===y)+") {\n\n              if ("+w+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+m+") *\n                    getW(wR, wC, "+m+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+m+", xR, xC) *\n                    getW(wR, wC, "+m+", d2);\n              }\n\n            } else if ("+(2===y)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+m+", d2),\n                getW(wR, wC, "+m+" + 1, d2)\n              );\n\n              if ("+w+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+m+"),\n                  getX(batch, xR, xC, "+m+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+m+", xR, xC),\n                  getX(batch, "+m+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===y)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+m+", d2),\n                getW(wR, wC, "+m+" + 1, d2),\n                getW(wR, wC, "+m+" + 2, d2)\n              );\n\n              if ("+w+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+m+"),\n                  getX(batch, xR, xC, "+m+" + 1),\n                  getX(batch, xR, xC, "+m+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+m+", xR, xC),\n                  getX(batch, "+m+" + 1, xR, xC),\n                  getX(batch, "+m+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+M+"\n        "+N+"\n        setOutput(result);\n      }\n    "},$X=function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.padInfo.front,t=n.padInfo.top,r=n.padInfo.left,i=n.strideDepth,o=n.strideHeight,s=n.strideWidth,a=n.dilationDepth,u=n.dilationHeight,c=n.dilationWidth,d=n.filterDepth,p=n.filterHeight,m=n.filterWidth,y=4*Math.floor(n.inChannels/4),w=n.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+i+", "+o+", "+s+");\n      const ivec3 pads = ivec3("+e+", "+t+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+d+"; wF++) {\n          int xF = xFCorner + wF * "+a+";\n\n          if (xF < 0 || xF >= "+n.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+p+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+m+"; wC++) {\n              int xC = xCCorner + wC * "+c+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+y+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===w)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+y+") *\n                  getW(wF, wR, wC, "+y+", d2);\n              } else if ("+(2===w)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+y+"),\n                  getX(batch, xF, xR, xC, "+y+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+y+", d2),\n                  getW(wF, wR, wC, "+y+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===w)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+y+"),\n                  getX(batch, xF, xR, xC, "+y+" + 1),\n                  getX(batch, xF, xR, xC, "+y+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+y+", d2),\n                  getW(wF, wR, wC, "+y+" + 1, d2),\n                  getW(wF, wR, wC, "+y+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},E3=function(n,e,t,r){void 0===e&&(e=!1),void 0===t&&(t=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var i=n.inHeight,o=n.inWidth,s=n.padInfo.top,a=n.padInfo.left,u=n.strideHeight,c=n.strideWidth,d=n.dilationHeight,p=n.dilationWidth,m=n.filterHeight,y=n.filterWidth,w=n.outChannels/n.inChannels,C="",_="";t&&(C=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+t+"\n        }":"\n          float activation(float x) {\n            "+t+"\n          }\n        ",_="result = activation(result);");var A=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+C+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+s+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+w+";\n        int q = d2 - d1 * "+w+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+m+"; wR++) {\n          int xR = xRCorner + wR * "+d+";\n\n          if (xR < 0 || xR >= "+i+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+y+"; wC++) {\n            int xC = xCCorner + wC * "+p+";\n\n            if (xC < 0 || xC >= "+o+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+A+"\n        "+_+"\n        setOutput(result);\n      }\n    "},I3=function(n,e,t,r){void 0===e&&(e=!1),void 0===t&&(t=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;for(var i=n.inHeight,o=n.inWidth,s=n.padInfo.top,a=n.padInfo.left,u=n.strideHeight,c=n.strideWidth,d=n.dilationHeight,p=n.dilationWidth,m=n.filterHeight,y=n.filterWidth,w=y,C="int xR; int xC; int xCOffset;",_=0;_<m;_++)for(var A=0;A<y;A++)C+="\n          vec4 xTexelR"+_+"C"+2*A+" = vec4(0.);\n          vec4 wR"+_+"C"+A+" = vec4(0.);\n          vec4 xR"+_+"C"+A+" = vec4(0.);";for(_=0;_<m;_++)for(var T=0;T<w;T++){if(C+="\n          xR = xRCorner + "+_*d+";\n          xC = xCCorner + "+(A=2*T)*p+";\n        ",1===c){if(A<y&&(C+=a%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+o+") {\n                  xTexelR"+_+"C"+A+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+o+") {\n                    xTexelR"+_+"C"+A+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+_+"C"+A+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+o+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+o+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+_+"C"+A+" = vec4(previous.zw, xTexelR"+_+"C"+A+".xy);\n                } else {\n                  xR"+_+"C"+A+" = vec4(0, 0, xTexelR"+_+"C"+A+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+i+" && xC >= 0 && xC < "+o+") {\n                  xTexelR"+_+"C"+A+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+_+"C"+A+" = vec4(0.);\n                }\n\n                xR"+_+"C"+A+" = xTexelR"+_+"C"+A+";\n              ",A+1<y)){var N=a%2==0?Lb(p):p;p%2==0&&a%2==1||p%2!=0&&a%2!=1?(C+="\n                  xCOffset = xC + "+a%2+" + "+N+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+o+") {\n                    xTexelR"+_+"C"+(A+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",p>1&&(C+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+i+" &&\n                      xCOffset >= 0 && xCOffset < "+o+") {\n                      xTexelR"+_+"C"+A+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+_+"C"+A+" = vec4(0.);\n                    }\n                  "),C+="\n                  xR"+_+"C"+(A+1)+" = vec4(\n                    xTexelR"+_+"C"+A+".zw, xTexelR"+_+"C"+(A+2)+".xy);\n                "):C+="\n                  xCOffset = xC + "+N+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+o+") {\n                    xTexelR"+_+"C"+(A+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+_+"C"+(A+1)+" = xTexelR"+_+"C"+(A+2)+";\n                "}}else A<y&&(C+="\n              if(xR >= 0 && xR < "+i+") {\n            ",a%2==1?(C+="\n                xCOffset = xC + 1 - "+c+";\n                if(xCOffset >= 0 && xCOffset < "+o+") {\n                  xTexelR"+_+"C"+A+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+_+"C"+A+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+o+") {\n                  xTexelR"+_+"C"+(A+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+_+"C"+(A+2)+" = vec4(0.);\n                }\n\n                xR"+_+"C"+A+" = vec4(\n                  xTexelR"+_+"C"+A+".zw, xTexelR"+_+"C"+(A+2)+".zw);\n              ",A+1<y&&(C+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+c+";\n                  if(xCOffset >= 0 && xCOffset < "+o+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+_+"C"+(A+1)+" = vec4(xTexelR"+_+"C"+(A+2)+".xy, final.xy);\n                ")):(C+="\n                if(xC >= 0 && xC < "+o+") {\n                  xTexelR"+_+"C"+A+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+_+"C"+A+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+c+";\n                if(xCOffset >= 0 && xCOffset < "+o+") {\n                  xTexelR"+_+"C"+(A+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+_+"C"+(A+2)+" = vec4(0.);\n                }\n\n                xR"+_+"C"+A+" = vec4(\n                  xTexelR"+_+"C"+A+".xy, xTexelR"+_+"C"+(A+2)+".xy);\n              ",A+1<y&&(C+="\n                  xR"+_+"C"+(A+1)+" = vec4(\n                    xTexelR"+_+"C"+A+".zw, xTexelR"+_+"C"+(A+2)+".zw);\n                ")),C+="}");A<y&&(C+="\n            vec4 wTexelR"+_+"C"+A+" = getW("+_+", "+A+", d1, q);\n            wR"+_+"C"+A+" = vec4(wTexelR"+_+"C"+A+".xz, wTexelR"+_+"C"+A+".xz);\n          ",A+1<y&&(C+="\n              vec4 wTexelR"+_+"C"+(A+1)+" = getW("+_+", "+(A+1)+", d1, q);\n              wR"+_+"C"+(A+1)+" =\n                vec4(wTexelR"+_+"C"+(A+1)+".xz, wTexelR"+_+"C"+(A+1)+".xz);"))}for(_=0;_<m;_++)for(A=0;A<y;A++)C+="dotProd += xR"+_+"C"+A+" * wR"+_+"C"+A+";";var M="",O="";t&&(M=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+t+"\n        }":"vec4 activation(vec4 x) {\n          "+t+"\n        }",O="result = activation(result);");var L=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+M+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+s+", "+a+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+C+"\n\n        vec4 result = dotProd;\n        "+L+"\n        "+O+"\n        setOutput(result);\n      }\n    "},KX=function(n,e,t,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=n[0],s=n[1],a=n[2],d=t[0],p=t[1];this.outputShape=[e[0],d,p,n[3]];var y=[s-1+".0",a-1+".0"],w=y[0],C=y[1],_=d>1?[""+(s-1)/(d-1),"(y2-y1) * height_ratio","y1*"+w+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+w],M=p>1?[""+(a-1)/(p-1),"(x2-x1) * width_ratio","x1*"+C+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+C];this.userCode="\n      const float height_ratio = float("+_[0]+");\n      const float width_ratio = float("+M[0]+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+o+") {\n          return;\n        }\n\n        float height_scale = "+_[1]+";\n        float width_scale = "+M[1]+";\n\n        float in_y = "+_[2]+";\n        if( in_y < 0.0 || in_y > "+w+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n        float in_x = "+M[2]+";\n        if( in_x < 0.0 || in_x > "+C+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+("bilinear"===r?1:0)+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},QX=function(n,e,t){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=n[n.length-1],o=t?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(t?"return "+i+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+lr(r)+" coords = getOutputCoords();\n        int end = "+A3(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+i+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+o+" end) {\n            continue;\n          }\n          if (idx == end && "+e+") {\n            continue;\n          }\n          "+A3(r,"coords")+" = idx;\n          val += getX("+function(s,a){if(1===s)return""+a;if(2===s)return a+".x, "+a+".y";if(3===s)return a+".x, "+a+".y, "+a+".z";if(4===s)return a+".x, "+a+".y, "+a+".z, "+a+".w";throw Error("Cumulative sum for rank "+s+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function A3(n,e){if(1===n)return""+e;if(2===n)return e+".y";if(3===n)return e+".z";if(4===n)return e+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var ZX=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=pp.DENSE;var e=gp(n),t=io();this.outputShape=n,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Cl(["r","c","d"],n)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+e[0]+", "+e[1]+"));\n        int index = 4 * (resTexRC.x * "+e[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+t.output+" = result;\n      }\n    "},JX=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=pp.DENSE;var e=gp(n),t=io();this.outputShape=n,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Cl(["r","c","d"],n)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+e[0]+", "+e[1]+"));\n        int index = 4 * (resTexRC.x * "+e[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+t.output+" = result;\n      }\n    "},eq=function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return n.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n}(),tq=function(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},nq=function(n){this.variableNames=["A"],this.outTexUsage=Jo.DOWNLOAD;var e=io();this.outputShape=n,this.userCode="\n      "+v3+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+e.output+" = encode_float(x);\n      }\n    "},rq=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Jo.DOWNLOAD;var e=io();this.outputShape=n,this.userCode="\n      "+v3+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+e.output+" = encode_float(x);\n      }\n    "},iq=function(n,e,t){void 0===t&&(t=!1),this.variableNames=["A"];var r=io(),i=e[0],o=e[1];this.outputShape=n;var s="result";t&&(s="floor(result * 255. + 0.5)"),this.userCode="\n      "+Cw(n)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+o+";\n        int c = imod(flatIndex, "+o+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+o+".0, "+i+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+s+", 0., 0., 0.);\n      }\n    "},oq=function(n,e,t){void 0===t&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=io(),i=e[0],o=e[1];this.outputShape=n;var s="",a="result";t&&(a="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var d=2*u+c;s+="\n          localCoords = coords;\n          if(localCoords[2] + "+c+" < "+n[2]+") {\n            localCoords[2] += "+c+";\n            if(localCoords[1] + "+u+" < "+n[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+o+";\n              c = imod(flatIndex, "+o+");\n              uv = (vec2(c, r) + halfCR) / vec2("+o+".0, "+i+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+d+"] = values[0];\n              } else if(offset == 1) {\n                result["+d+"] = values[1];\n              } else if(offset == 2) {\n                result["+d+"] = values[2];\n              } else {\n                result["+d+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+Cw(n)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+s+"\n\n        "+r.output+" = "+a+";\n      }\n    "},D3=function(n,e,t){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var i=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI;this.userCode="\n      const float exponentMultiplier = "+i+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+n+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+(t?r+".0":"1.0")+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},uq=function(){function n(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){null==t.valueLoc&&(t.valueLoc=r.getUniformLocationNoThrow(i,"value")),r.gl.uniform1f(t.valueLoc,e)}},n}(),cq=function(n,e,t){this.variableNames=["A","indices"];var r=n.slice();r[t]=e,this.outputShape=r,this.rank=r.length;var i=lr(this.rank),o=function(s,a){var u=s.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(1===u)return"int(getIndices(resRC))";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w"],d=[],p=0;p<s.length;p++)d.push(p===a?"int(getIndices("+c[p]+"))":""+c[p]);return d.join()}(n,t);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+o+"));\n      }\n    "},lq=function(n,e,t){this.sliceDim=n,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var r=lr(e.length),i=lr(t.length);this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+i+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+(this.sliceDim>1?"strides[j]":"strides")+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function S3(n,e){var t=io();return CR(n,e,t.version+"\n    precision highp float;\n    "+t.attribute+" vec3 clipSpacePos;\n    "+t.attribute+" vec2 uv;\n    "+t.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function T3(n,e){return DR(n,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function M3(n,e){return SR(n,e,new Uint16Array([0,1,2,2,1,3]))}function Dp(n,e,t,r,i,o,s){MR(t,r);var a=TR(n,e),u=n.TEXTURE_2D;return Ze(n,e,function(){return n.bindTexture(u,a)}),Ze(n,e,function(){return n.texParameteri(u,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)}),Ze(n,e,function(){return n.texParameteri(u,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)}),Ze(n,e,function(){return n.texParameteri(u,n.TEXTURE_MIN_FILTER,n.NEAREST)}),Ze(n,e,function(){return n.texParameteri(u,n.TEXTURE_MAG_FILTER,n.NEAREST)}),Ze(n,e,function(){return n.texImage2D(u,0,i,t,r,0,o,s,null)}),Ze(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)}),a}function R3(n,e,t,r,i){var o=m1(t,r);return Dp(n,e,o[0],o[1],i.internalFormatFloat,i.textureFormatFloat,n.FLOAT)}function N3(n,e,t,r,i){var o=m1(t,r);return Dp(n,e,o[0],o[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function O3(n,e,t,r,i){var o=m1(t,r);return Dp(n,e,o[0],o[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function k3(n,e,t,r,i){var o=mp(t,r);return Dp(n,e,o[0],o[1],i.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function P3(n,e,t,r,i){var o=mp(t,r);return Dp(n,e,o[0],o[1],i.internalFormatPackedHalfFloat,n.RGBA,i.textureTypeHalfFloat)}function F3(n,e,t,r){return Ze(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),tw(n,e,t,"clipSpacePos",r,3,20,0)&&tw(n,e,t,"uv",r,2,20,12)}function L3(n,e,t,r,i,o,s){var a,u,c;Ze(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),o instanceof Uint8Array?(a=new Uint8Array(r*i*4),u=n.UNSIGNED_BYTE,c=n.RGBA):(a=new Float32Array(r*i*4),u=n.FLOAT,c=s.internalFormatPackedFloat),a.set(o),Ze(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,c,r,i,0,n.RGBA,u,a)}),Ze(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function B3(n,e,t,r){Ze(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),r.data instanceof Uint8Array?Ze(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r.width,r.height,0,n.RGBA,n.UNSIGNED_BYTE,r.data)}):Ze(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)}),Ze(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function V3(n,e,t,r,i){var o=n.createBuffer();Ze(n,e,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,o)});var s=16*t*r;return Ze(n,e,function(){return n.bufferData(n.PIXEL_PACK_BUFFER,s,n.STREAM_READ)}),Ze(n,e,function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,0)}),Ze(n,e,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)}),o}function U3(n,e,t){var r=n,i=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function j3(n,e,t,r,i){var o=m1(t,r),s=o[0],a=o[1],u=new Uint8Array(t*r*4);return Ze(n,e,function(){return n.readPixels(0,0,s,a,i.downloadTextureFormat,n.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function W3(n,e,t,r,i,o,s,a){var m,u=n,c=new Float32Array((m=mp(o,s))[0]*m[1]*4);return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function H3(n,e,t,r){var i=new Float32Array(t*r*4);return Ze(n,e,function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,i)}),i}var hq=Object.freeze({createVertexShader:S3,createVertexBuffer:T3,createIndexBuffer:M3,createFloat32MatrixTexture:R3,createFloat16MatrixTexture:N3,createUnsignedBytesMatrixTexture:O3,createPackedMatrixTexture:k3,createFloat16PackedMatrixTexture:P3,bindVertexProgramAttributeStreams:F3,uploadDenseMatrixToTexture:L3,uploadPixelDataToTexture:B3,createBufferFromOutputTexture:V3,downloadFloat32MatrixFromBuffer:U3,downloadByteEncodedFloatMatrixFromOutputTexture:j3,downloadPackedMatrixFromBuffer:W3,downloadMatrixFromPackedOutputTexture:H3}),z3=function(){function n(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=ge().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,bR(t,e)):this.gl=Wa(t);var r="WEBGL_color_buffer_float";if(1===ge().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=vp(this.gl,this.debug,"OES_texture_float"),ts(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=vp(this.gl,this.debug,"OES_texture_half_float");else if(ge().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),ts(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=vp(this.gl,this.debug,"EXT_color_buffer_half_float");else if(ge().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(ts(this.gl,r="EXT_color_buffer_float"))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!ts(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=T3(this.gl,this.debug),this.indexBuffer=M3(this.gl,this.debug),this.framebuffer=RR(this.gl,this.debug),this.textureConfig=ew(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return ge().getBool("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Ze(t,this.debug,function(){return t.finish()}),Ze(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Ze(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),Ze(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),Ze(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),Ze(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),R3(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),N3(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),O3(this.gl,this.debug,e,t)},n.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),B3(this.gl,this.debug,e,t)},n.prototype.uploadDenseMatrixToTexture=function(e,t,r,i){this.throwIfDisposed(),L3(this.gl,this.debug,e,t,r,i,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),P3(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),k3(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(nw(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Ze(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,function(){return j3(i.gl,i.debug,t,r,i.textureConfig)})},n.prototype.downloadPackedMatrixFromBuffer=function(e,t,r,i,o,s){return W3(this.gl,e,0,0,0,o,s)},n.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return U3(this.gl,e,t)},n.prototype.createBufferFromTexture=function(e,t,r){this.bindTextureToFrameBuffer(e);var i=V3(this.gl,this.debug,t,r);return this.unbindTextureToFrameBuffer(),i},n.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},n.prototype.createFence=function(e){var t,r,i=this;if(ge().getBool("WEBGL_FENCE_API_ENABLED")){var o=e,s=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=function(){var a=o.clientWaitSync(s,0,0);return a===o.ALREADY_SIGNALED||a===o.CONDITION_SATISFIED},t=s}else ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=function(){return i.isQueryAvailable(t,ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:t,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,function(){return H3(i.gl,i.debug,t,r)})},n.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,r=ER(t,this.debug,e),i=S3(t,this.debug),o=IR(t,this.debug);return Ze(t,this.debug,function(){return t.attachShader(o,i)}),Ze(t,this.debug,function(){return t.attachShader(o,r)}),AR(t,this.debug,o),this.debug&&x1(t,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=F3(t,this.debug,this.program,this.vertexBuffer)),o},n.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&Ze(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},n.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&x1(this.gl,this.debug,this.program),Ze(this.gl,this.debug,function(){return t.gl.useProgram(e)})},n.prototype.getUniformLocation=function(e,t,r){return void 0===r&&(r=!0),this.throwIfDisposed(),r?OR(this.gl,this.debug,e,t):kR(this.gl,e,t)},n.prototype.getAttributeLocation=function(e,t){var r=this;return this.throwIfDisposed(),Ze(this.gl,this.debug,function(){return r.gl.getAttribLocation(e,t)})},n.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},n.prototype.setInputMatrixTexture=function(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),PR(this.gl,this.debug,0,e,t,r)},n.prototype.setOutputMatrixTexture=function(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)},n.prototype.setOutputPackedMatrixTexture=function(e,t,r){this.throwIfDisposed();var i=mp(t,r);this.setOutputMatrixTextureDriver(e,i[0],i[1])},n.prototype.setOutputMatrixWriteRegion=function(e,t,r,i){this.setOutputMatrixWriteRegionDriver(r,e,i,t)},n.prototype.setOutputPackedMatrixWriteRegion=function(e,t,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){null!=this.program&&x1(this.gl,this.debug,this.program),yp(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Ze(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},n.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Ze(this.gl,this.debug,function(){return e.gl.finish()})},n.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=vp(this.gl,this.debug,2===ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(2===ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,r),r}var i=this.getQueryTimerExtensionWebGL1(),o=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,o),o},n.prototype.endQuery=function(){if(2!==ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(e){return tt(this,void 0,void 0,function(){var t=this;return nt(this,function(r){switch(r.label){case 0:return[4,Bb(function(){return t.disposed||t.isQueryAvailable(e,ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(e,ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},n.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var r=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint},n.prototype.pollFence=function(e){var t=this;return new Promise(function(r){t.addItemToPoll(function(){return e.isFencePassed()},function(){return r()})})},n.prototype.pollItems=function(){for(var e=function(r){for(var i=0;i<r.length&&r[i]();++i);return i-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},n.prototype.addItemToPoll=function(e,t){var r=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||Bb(function(){return r.pollItems(),0===r.itemsToPoll.length})},n.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),b1(this.gl,this.debug,e,this.framebuffer),this.debug&&yp(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(b1(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&yp(this.gl)):nw(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var r=t();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(e,t,r){this.throwIfDisposed();var i=this.gl;b1(i,this.debug,e,this.framebuffer),this.debug&&yp(i),this.outputTexture=e,Ze(i,this.debug,function(){return i.viewport(0,0,t,r)}),Ze(i,this.debug,function(){return i.scissor(0,0,t,r)})},n.prototype.setOutputMatrixWriteRegionDriver=function(e,t,r,i){var o=this;this.throwIfDisposed(),Ze(this.gl,this.debug,function(){return o.gl.scissor(e,t,r,i)})},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},n}();function G3(n,e){if(n.length!==e.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+e.length+" inputs");n.forEach(function(t,r){var i=t.logicalShape,o=e[r],s=o.shape;if(!ai(i,s))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+s+" must match");if(!t.isUniform||!o.isUniform){var a=t.texShape,u=o.isUniform?null:o.texData.texShape;if(!ai(a,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+u+" must match")}})}var dq=function(n,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var i=t.inChannels,o=t.strideWidth,s=t.strideHeight,a=t.padInfo,u=t.outWidth,c=t.dilationWidth,d=t.dilationHeight,p=t.dataFormat,m=a.left,y=a.top,w=i*t.filterWidth,C=io(),_="channelsLast"===p,A=_?0:1,T=_?1:2,N="",M=0;M<=1;M++)for(var O=0;O<=1;O++)N+="\n          blockIndex = rc.y + "+O+";\n          pos = rc.x + "+M+";\n\n          if(blockIndex < "+n[1]+" && pos < "+n[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+s+" - "+y+";\n            d0 = offsetY + "+d+" * (pos / "+w+");\n\n            if(d0 < "+e[A]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+o+". - "+m+".);\n              d1 = offsetX + "+c+" * (int(mod(float(pos), "+w+".) / "+i+".));\n\n              if(d1 < "+e[T]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+i+".));\n\n                if ("+_+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*M+O)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*M+O)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+N+"\n\n        "+C.output+" = result;\n      }\n    "},fq=function(n,e,t,r,i){this.variableNames=["x"],this.outputShape=[];var s=e,a=n[3]-1;this.outputShape=n;var u="float("+t+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+s+"; j <= "+s+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+a+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+(.5===i?"inversesqrt("+u+")":1===i?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));")+";\n        setOutput(val);\n      }\n    "},pq=function(n,e,t,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=e,this.bias=t,this.alpha=r,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+e+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+e+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+t+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+i+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+i+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},gq=function(n,e,t,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var s=e,a=n[3]-1;this.outputShape=n;var u="float("+t+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+s+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+s+"; j <= "+s+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+a+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+(.5===i?"inversesqrt("+u+")":1===i?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));")+";\n        setOutput(result);\n      }\n    "},mq=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var i=n.effectiveFilterHeight,o=n.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(i-1-n.padInfo.top)+", "+(o-1-n.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+i+";\n          wR += "+n.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+o+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+(i*o-1)+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+o+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},vq=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var a=n.effectiveFilterDepth,u=n.effectiveFilterHeight,c=n.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(a-1-n.padInfo.front)+", "+(u-1-n.padInfo.top)+", "+(c-1-n.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+a+";\n           wD += "+n.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+n.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+n.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+n.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+n.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+n.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+(a*u*c-1)+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+u+" * "+c+" +\n                  wR * "+c+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Aw=function(n,e,t,r,i,o,s){void 0===t&&(t=!1),void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===o&&(o=null),void 0===s&&(s=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var u=Math.ceil((t?n[1]:n[2])/2),c=t?"i * 2, rc.y":"rc.y, i * 2",d=r?"rc.z, i * 2":"i * 2, rc.z",p=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],y="",w="";o&&(y=s?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+o+"\n        }":"vec4 activation(vec4 x) {\n          "+o+"\n        }",w="result = activation(result);");var C=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+y+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+c+");\n          vec4 b = getMatrixB(rc.x, "+d+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+p[0]+" * "+m[0]+");\n          result += ("+p[1]+" * "+m[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+C+"\n\n        "+w+"\n\n        setOutput(result);\n      }\n    "},yq=function(){function n(e,t,r){this.variableNames=["probs"],this.outputShape=[e,r],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){null==t.seedLoc&&(t.seedLoc=r.getUniformLocation(i,"seed")),r.gl.uniform1f(t.seedLoc,e)}},n}(),xq=function(n,e,t,r){this.variableNames=["indices"],this.outputShape=[n,e],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+t+"),\n                      float(index == coords.y)));\n      }\n    "},bq=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;var a,c,d,e=n.length;if(0===e)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var t=Fo("rc",e),r=lr(e),i=function(a,u,c){if(1===a)return"rc > "+u[0];for(var d="",p=a-2;p<a;p++)d+=c[p]+" >= "+u[p],p<a-1&&(d+="||");return d}(e,n,t),o=function(a,u,c,d){if(1===a)return"";var p=d.slice(-2);return"\n    int r = "+p[0]+";\n    int c = "+p[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+u+";\n    bool rEdge = rp1 >= "+c+";\n  "}(e,n[n.length-1],n[n.length-2],t),s=(d=function(p,m){for(var y=[],w=0;w<=1;w++)for(var C=0;C<=1;C++){for(var _=(0===w?"r":"rp1")+", "+(0===C?"c":"cp1"),A=2;A<p;A++)_=m[m.length-1-A]+","+_;y.push(_)}return y}(c=(a=n).length,t),1===c?"getA(rc),\n            rc + 1 >= "+a[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+d[0]+"),\n          cEdge ? 0. : getA("+d[1]+"),\n          rEdge ? 0. : getA("+d[2]+"),\n          rEdge || cEdge ? 0. : getA("+d[3]+")");this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+i+") {\n            setOutput(vec4(0));\n          } else {\n            "+o+"\n\n            setOutput(vec4("+s+"));\n          }\n        }\n      "}},wq=function(n,e,t){this.variableNames=["x"],this.outputShape=e.map(function(u,c){return u[0]+n[c]+u[1]});var r=n.length,i=lr(r),o=e.map(function(u){return u[0]}).join(","),s=e.map(function(u,c){return u[0]+n[c]}).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+i+" start = "+i+"("+o+");\n      "+i+" end = "+i+"("+s+");\n\n      void main() {\n        "+i+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+t+"));\n        } else {\n          "+i+" coords = outC - start;\n          setOutput(getX("+a+"));\n        }\n      }\n    ":"\n        int start = "+o+";\n        int end = "+s+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+t+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},_q=function(n,e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(function(_,A){return _[0]+n[A]+_[1]});for(var r=n.length,i=lr(r),o=e.map(function(_){return _[0]}).join(","),s=e.map(function(_,A){return _[0]+n[A]}).join(","),a=Fo("rc",r),u=Fo("source",r),c=a[r-1]+" < "+this.outputShape[r-1],d=1===r?"source":"vec2("+u.slice(-2).join()+")",p=[i+" rc = outputLoc;",a[r-1]+" += 1;\n       if("+c+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+a[r-2]+" += 1;\n       if("+a[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+a[r-1]+" += 1;\n         if("+c+") {"],m=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",y="",w=0,C=1===r?2:4;w<C;w++)y+="\n        "+p[w]+"\n        if ("+m+") {\n          result["+w+"] = float("+t+");\n        } else {\n          "+i+" source = rc - start;\n          result["+w+"] = getChannel(getX("+u.join()+"), "+d+");\n        }\n      ";this.userCode="\n      const "+i+" start = "+i+"("+o+");\n      const "+i+" end = "+i+"("+s+");\n\n      void main() {\n        "+i+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+(y+=1===r?"} ":"}}")+"\n        setOutput(result);\n      }\n    "},Dw=function(n,e,t){if(this.variableNames=["x"],"avg"===e&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,i=n.strideHeight,o=n.strideWidth,s=n.dilationHeight,a=n.dilationWidth,u=n.effectiveFilterHeight,c=n.effectiveFilterWidth,d=n.padInfo.top,p=n.padInfo.left;this.outputShape=n.outShape;var m="avg"===e,y="0.0";if(m||(y="-1.0 / 1e-20"),t)this.userCode="\n        const ivec2 strides = ivec2("+i+", "+o+");\n        const ivec2 pads = ivec2("+d+", "+p+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+s+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+a+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+c+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var w=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(w="avgValue / count");var C=4*Math.floor(r/4),_=r%4,A="\n      if ("+m+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+i+", "+o+");\n      const ivec2 pads = ivec2("+d+", "+p+");\n      const float initializationValue = "+y+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+n.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+y+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+s+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+n.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+C+"; wC += 4) {\n            int xC = xCCorner + wC * "+a+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+a+", d),\n              getValue(batch, xR, xC + 2 * "+a+", d),\n              getValue(batch, xR, xC + 3 * "+a+", d)\n            );\n\n            "+A+"\n          }\n\n          int xC = xCCorner + "+C+";\n          if ("+(1===_)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+A+"\n          } else if ("+(2===_)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+a+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+A+"\n          } else if ("+(3===_)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+a+", d),\n              getValue(batch, xR, xC + 2 * "+a+", d),\n              initializationValue\n            );\n\n            "+A+"\n          }\n        }\n        setOutput("+w+");\n      }\n    "}},Sw=function(n,e,t){if(this.variableNames=["x"],"avg"===e&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,i=n.strideDepth,o=n.strideHeight,s=n.strideWidth,a=n.dilationDepth,u=n.dilationHeight,c=n.dilationWidth,d=n.effectiveFilterDepth,p=n.effectiveFilterHeight,m=n.effectiveFilterWidth,y=n.padInfo.front,w=n.padInfo.top,C=n.padInfo.left;this.outputShape=n.outShape;var _="avg"===e,A="0.0";if(_||(A="-1.0 / 1e-20"),t)this.userCode="\n        const ivec3 strides =\n            ivec3("+i+", "+o+", "+s+");\n        const ivec3 pads = ivec3("+y+", "+w+", "+C+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+d+";\n              wD += "+a+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+n.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+p+";\n                wR += "+u+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+n.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+m+";\n                  wC += "+c+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+n.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+p+" * "+m+" +\n                      wR * "+m+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var T=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(T="avgValue / count");var N=4*Math.floor(r/4),M=r%4,O="\n      if ("+_+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+i+", "+o+", "+s+");\n      const ivec3 pads = ivec3("+y+", "+w+", "+C+");\n      const float initializationValue = "+A+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+n.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+A+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+d+";\n            wD += "+a+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+n.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+p+";\n            wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+N+"; wC += 4) {\n              int xC = xCCorner + wC * "+c+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+c+", ch)\n              );\n\n              "+O+"\n            }\n\n            int xC = xCCorner + "+N+";\n            if ("+(1===M)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+O+"\n            } else if ("+(2===M)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+O+"\n            } else if ("+(3===M)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                initializationValue\n              );\n\n              "+O+"\n            }\n          }\n          setOutput("+T+");\n        }\n      }\n    "}},Cq=function(n,e){this.variableNames=["x"];var t=n.windowSize,r=n.batchSize,i=n.inSize,o=Math.ceil(i/t);this.outputShape=[r,o];var s="0.0",a="";"prod"===e?s="1.0":"min"===e?(s="1.0 / 1e-20",a="min"):"max"===e&&(s="-1.0 / 1e-20",a="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===e?u="sumValue":"prod"===e?u="prodValue":"all"===e?u="allValue":"any"===e&&(u="anyValue");var c=4*Math.floor(t/4),d=t%4,p="\n      if ("+("sum"===e)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===e)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+a+"(values, minMaxValue);\n      }\n    ",m="vec4";"all"===e?(s="1.0",p="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",m="bvec4"):"any"===e&&(s="0.0",p="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",m="bvec4");var y="";i%t>0&&(y="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+s+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+y+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+t+";\n\n        vec4 minMaxValue = vec4("+s+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+c+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+m+" values = "+m+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+p+"\n        }\n\n        int inIdx = inOffset + "+c+";\n        if ("+(1===d)+") {\n          "+m+" values = "+m+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+p+"\n        } else if ("+(2===d)+") {\n          "+m+" values = "+m+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+p+"\n        } else if ("+(3===d)+") {\n          "+m+" values = "+m+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+p+"\n        }\n        setOutput("+u+");\n      }\n    "},Eq=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var t="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),t+="\n        "+i+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+Cl(["r","c","d"],e)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+Cw(n)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+n[1]+";\n        int cols = "+n[2]+";\n\n        "+t+"\n\n        setOutput(result);\n      }\n    "},Iq=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],s=n.shape,a=s[1],u=s[2],c=[t&&a>1?i-1:i,t&&u>1?o-1:o],d=[t&&a>1?a-1:a,t&&u>1?u-1:u],p=c[0]/d[0],m=c[1]/d[1],y=1/p,w=1/m,C=2*Math.ceil(y)+2,_=2*Math.ceil(w)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+p+");\n        const float widthScale = float("+m+");\n\n        const float invHeightScale = float("+y+");\n        const float invWidthScale = float("+w+");\n\n        const int winHeight = int("+C+");\n        const int winWidth = int("+_+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+a+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(i-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(o-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Aq=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var o=n[1],s=n[2];this.outputShape=[n[0],e,t,n[3]];var u=[r&&e>1?o-1:o,r&&t>1?s-1:s],c=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+s+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},Dq=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=n[1],s=n[2],a=n[3];this.outputShape=[n[0],e,t,a];var u=[r&&e>1?o-1:o,r&&t>1?s-1:s],c=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+",\n          "+u[1]/c[1]+");\n      const vec3 inputShapeRC = vec3("+o+".0, "+s+".0,\n                                     "+s+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(a-1)+";\n        bool hasNextRow = coords.z < "+(t-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},Sq=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],s=n.shape,a=s[1],u=s[2],c=[t&&a>1?i-1:i,t&&u>1?o-1:o],d=[t&&a>1?a-1:a,t&&u>1?u-1:u],p=c[0]/d[0],m=c[1]/d[1],y=1/p,w=1/m,C=2*Math.ceil(y)+2,_=2*Math.ceil(w)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+p+");\n        const float widthScale = float("+m+");\n\n        const float invHeightScale = float("+y+");\n        const float invWidthScale = float("+w+");\n\n        const int winHeight = int("+C+");\n        const int winWidth = int("+_+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+a+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+c[0]+") *\n                (float(dyR) / float("+d[0]+"));\n\n            float sourceFracCol =\n                float("+c[1]+") *\n                  (float(dyC) / float("+d[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+i+") - 1),\n                "+t+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+o+") - 1),\n                "+t+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Tq=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var o=n[1],s=n[2];this.outputShape=[n[0],e,t,n[3]];var u=[r&&e>1?o-1:o,r&&t>1?s-1:s],c=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+s+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+(r?"0.5":"0.0")+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},Mq=function(n,e){this.variableNames=["x"];var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=n,1!==t){var r=n.map(function(o,s){return-1!==e.indexOf(a=s)&&1!==n[a]?n[a]+" - coords["+a+"] - 1":"coords["+a+"]";var a}).join(","),i=lr(t);this.userCode="\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+n[0]+" - coord - 1));\n        }\n      "},Rq=function(n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=n;var u,r=Fo("rc",t),i=r[t-1]+" + 1 < "+this.outputShape[t-1],o=r[t-2]+" + 1 < "+this.outputShape[t-2],s=lr(t);function a(u){var c=n.map(function(d,p){return y=u,-1!==e.indexOf(m=p)&&1!==n[m]?n[m]+" - "+y[m]+" - 1":""+y[m];var m,y});return"getChannel(getX("+c.join(",")+"), vec2("+c.slice(-2).join(",")+"))"}this.userCode=1===t?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+n[0]+" - rc - 1),\n            "+n[0]+" - rc - 1);\n          if("+i+"){\n              result.g = getChannel(getX("+n[0]+" - (rc  + 1) - 1),\n                "+n[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+s+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+a(r.slice())+";\n          if("+i+"){\n            result.g = "+((u=r.slice())[t-1]="("+u[t-1]+" + 1)",a(u)+";\n          }\n          if(")+o+") {\n            result.b = "+function(u){return u[t-2]="("+u[t-2]+" + 1)",a(u)}(r.slice())+";\n            if("+i+") {\n              result.a = "+function(u){return u[t-1]="("+u[t-1]+" + 1)",u[t-2]="("+u[t-2]+" + 1)",a(u)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},Y3=function(n,e,t,r,i,o,s){void 0===s&&(s=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var a=lr(i.length),u=lr(o.length),c="";1===t?c="i":2===t&&(c="i, j");var p="";1===r?p="i":2===r&&(p="i, coords[1]"),this.userCode="\n        "+a+" strides = "+a+"("+i+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+n+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+e+"; j++) {\n              int index = round(getIndices("+c+"));\n              flattenedIndex += index * "+(e>1?"strides[j]":"strides")+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates("+p+");\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},Nq=function(n,e){this.variableNames=["x","segmentIds"];var t=n.windowSize,r=n.batchSize,i=n.inSize,o=n.numSegments,s=o*Math.ceil(i/t);this.outputShape=[r,s];var a=4*Math.floor(t/4),u=t%4,c="\n        sumValue += dot(values, segFilter);\n    ",d="";i%t>0&&(d="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      ");var p="";i%t>0&&(p="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+d+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+p+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+o+")) * float("+t+"));\n        int currentSeg = int(mod(float(outIdx), float("+o+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+a+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+c+"\n        }\n\n        int inIdx = inOffset + "+a+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+c+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+c+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+c+"\n        }\n        setOutput(sumValue);\n      }\n    "},Oq=function(n,e,t){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(1===t)i="resRC",r="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],a=[],u=0;u<e.length;u++)a.push(""+o[u]),u<n&&s.push(""+o[u]);r=s.join(),i=a.join()}var c=lr(t);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+i+"));\n        } else {\n          setOutput(getB("+i+"));\n        }\n      }\n    "},kq=function(){function n(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,r=lr(this.rank),i="uniform int start["+this.rank+"];",o=function(s){if(1===s)return"sourceLoc";if(s<=6)return Tw.slice(0,s).map(function(a){return"sourceLoc."+a}).join(",");throw Error("Slicing for rank "+s+" is not yet supported")}(this.rank);t="\n        "+r+" sourceLoc;\n        "+r+" coords = getOutputCoords();\n        "+e.map(function(s,a){return"sourceLoc."+Tw[a]+" = start["+a+"] + coords."+Tw[a]+";"}).join("\n")+"\n      ",this.userCode="\n      "+i+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+o+"));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){null==t.startLoc&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),null==t.startLoc)||r.gl.uniform1iv(t.startLoc,e)}},n}(),Tw=["x","y","z","w","u","v"],Pq=function(){function n(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=lr(this.rank),r=Fo("coords",this.rank),i=Fo("sourceLoc",this.rank),o=1===this.rank?"sourceLoc":"vec2("+i.slice(-2).join()+")",s="getChannel(getSource("+i.join()+"), "+o+")",a="\n      result.x = "+s+";\n      if (++"+r[this.rank-1]+" < "+e[this.rank-1]+") {\n        ++"+i[this.rank-1]+";\n        result.y = "+s+";\n        --"+i[this.rank-1]+";\n      }\n    ",u=1===this.rank?"":"\n      --"+r[this.rank-1]+";\n      if (++"+r[this.rank-2]+" < "+e[this.rank-2]+") {\n        ++"+i[this.rank-2]+";\n        result.z = "+s+";\n        if (++"+r[this.rank-1]+" < "+e[this.rank-1]+") {\n          ++"+i[this.rank-1]+";\n          result.w = "+s+";\n        }\n      }\n    ",c=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+e.map(function(d,p){return"start["+p+"]"}).join()+");":e.map(function(d,p){return i[p]+" = "+r[p]+" + start["+p+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+c+"\n        vec4 result = vec4(0.);\n        "+a+"\n        "+u+"\n        setOutput(result);\n      }\n    "}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){null==t.startLoc&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),null==t.startLoc)||r.gl.uniform1iv(t.startLoc,e)}},n}(),Fq=function(n,e,t){this.variableNames=["x"],this.outputShape=t;var r=t.length,i=lr(t.length),o=lr(t.length),s="";if(1===r)s="coords * strides + begin";else{var a=0;s=t.map(function(u,c){return a++,1===t.length?"coords * strides["+c+"] + begin["+c+"]":"coords["+(a-1)+"] * strides["+c+"] + begin["+c+"]"}).join(",")}this.userCode="\n      "+i+" begin = "+i+"("+n+");\n      "+i+" strides = "+i+"("+e+");\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+s+"));\n      }\n    "},Lq=function(){function n(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(e,t,r){var i,o=X3(t,r),s=q3(e,o,r);if(s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]),this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var a=this.freeTextures[s].shift();return this.usedTextures[s].push(a),a}return this.numUsedTextures++,this.log(),o===es.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===es.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===es.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===es.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===es.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[s].push(i),i},n.prototype.releaseTexture=function(e,t,r,i){if(null!=this.freeTextures){var o=q3(t,X3(r,i),i);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var s=this.usedTextures[o],a=s.indexOf(e);if(a<0)throw new Error("Cannot release a texture that was never provided by this texture manager");s.splice(a,1),this.log()}},n.prototype.log=function(){this.logEnabled&&console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+(this.numFreeTextures+this.numUsedTextures)+")")},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(r){e.gpgpu.deleteMatrixTexture(r)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(i){e.gpgpu.deleteMatrixTexture(i)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n}();function X3(n,e){if(n===Jo.UPLOAD)return es.PACKED_2X2_FLOAT32;if(n===Jo.RENDER||null==n)return t=e,ge().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?es.PACKED_2X2_FLOAT32:es.UNPACKED_FLOAT32:t?es.PACKED_2X2_FLOAT16:es.UNPACKED_FLOAT16;var t;if(n===Jo.DOWNLOAD||n===Jo.PIXELS)return es.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function q3(n,e,t){return n[0]+"_"+n[1]+"_"+e+"_"+t}var Bq=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[r]*e[r];this.outputShape=t,this.rank=t.length;var i=lr(this.rank),o=function(s){var a=s.length;if(a>5)throw Error("Tile for rank "+a+" is not yet supported");if(1===a)return"imod(resRC, "+s[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],c=[],d=0;d<s.length;d++)c.push("imod("+u[d]+", "+s[d]+")");return c.join()}(n);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+o+"));\n      }\n    "},Vq=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];this.outputShape=t,this.rank=t.length;var i=lr(this.rank),o=function(s){var a=s.length;if(a>6)throw Error("Transpose for rank "+a+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],c=new Array(a),d=0;d<s.length;d++)c[s[d]]=u[d];return c.join()}(e);this.userCode="\n    void main() {\n      "+i+" resRC = getOutputCoords();\n      setOutput(getA("+o+"));\n    }\n    "},Uq=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=lr(this.rank),o=m3("rc",this.rank),s=new Array(this.rank);for(r=0;r<e.length;r++)s[e[r]]=o[r];var a="vec2("+s.slice(-2).join()+")",u="++"+o[this.rank-1]+" < "+t[this.rank-1],c="getChannel(getA("+s.join()+"), "+a+")";this.userCode="\n    void main() {\n      "+i+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+c+";\n      if("+u+") {\n        result[1] = "+c+";\n      }\n      --"+o[this.rank-1]+";\n      if(++"+o[this.rank-2]+" < "+t[this.rank-2]+") {\n        result[2] = "+c+";\n        if("+u+") {\n          result[3] = "+c+";\n        }\n      }\n      setOutput(result);\n    }\n    "},qt=function(n,e){this.variableNames=["A"],this.outputShape=n,this.userCode="\n      float unaryOperation(float x) {\n        "+e+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},la="if (isnan(x)) return x;",$3="return abs(x);",K3=la+"\n  return (x < 0.0) ? 0.0 : x;\n",Q3=la+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",Z3="return (x >= 0.0) ? x : (exp(x) - 1.0);",J3="return -x;",eN="return ceil(x);",tN="return floor(x);",nN="return exp(x);",rN="return exp(x) - 1.0;",B1="return x;",iN="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",oN="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",sN="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",Sp=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Zq=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;var e=n.length,t=Fo("rc",e),r=lr(e),i=function(a,u){if(1===a)return"rc";for(var c="",d=0;d<a;d++)c+=u[d],d<a-1&&(c+=",");return c}(e,t),o=t.slice(-2),s=e<=1?"rc":"vec2("+o.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+i+");\n\n        setOutput(getChannel(packedInput, "+s+"));\n      }\n    "},V1={};function U1(n,e){if(void 0===e&&(e=!1),"linear"===n)return"return x;";if("relu"===n)return e?iN:K3;if("elu"===n)return e?sN:Z3;if("relu6"===n)return e?oN:Q3;if("prelu"===n)return e?_3:w3;throw new Error("Activation "+n+" has not been implemented for the WebGL backend.")}var aN=function(n){function e(t){var r,i=n.call(this)||this;if(i.pendingRead=new WeakMap,i.pendingDisposal=new WeakSet,i.dataRefCount=new WeakMap,i.numBytesInGPU=0,i.uploadWaitMs=0,i.downloadWaitMs=0,i.warnedAboutMemory=!1,i.pendingDeletes=0,i.disposed=!1,!ge().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==t){var o=Wa(ge().getNumber("WEBGL_VERSION"));i.binaryCache=((r=ge().getNumber("WEBGL_VERSION"))in V1||(V1[r]={}),V1[r]),i.gpgpu=new z3(o),i.canvas=o.canvas,i.gpgpuCreatedLocally=!0}else i.gpgpu=t,i.binaryCache={},i.gpgpuCreatedLocally=!1,i.canvas=t.gl.canvas;return i.textureManager=new Lq(i.gpgpu),i.numMBBeforeWarning=null==ge().global.screen?1024:ge().global.screen.height*ge().global.screen.width*window.devicePixelRatio*600/1024/1024,i.texData=new u3(i,Z),i}return ia(e,n),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,r,i){if(ge().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===i&&null!=t)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var o={};return this.texData.set(o,{shape:r,dtype:i,values:t,usage:Jo.UPLOAD}),o},e.prototype.move=function(t,r,i,o){if(ge().getBool("DEBUG")&&this.checkNumericalProblems(r),"complex64"===o)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:i,dtype:o,values:r,usage:Jo.UPLOAD})},e.prototype.readSync=function(t){var r=this.texData.get(t),i=r.values,o=r.dtype,s=r.complexTensors,u=r.shape;if(null!=r.slice){var d;d=r.isPacked?new Sp(u,B1):new qt(u,B1);var p=this.runWebGLProgram(d,[{dataId:t,shape:u,dtype:o}],o),m=this.readSync(p.dataId);return this.disposeData(p.dataId),m}if(null!=i)return this.convertAndCacheOnCPU(t);if("string"===o)return i;var y,w,C=null!=this.activeTimers;return C&&(y=sa()),w="complex64"===o?xw(s.real.dataSync(),s.imag.dataSync()):this.getValuesFromTexture(t),C&&(this.downloadWaitMs+=sa()-y),this.convertAndCacheOnCPU(t,w)},e.prototype.read=function(t){return tt(this,void 0,void 0,function(){var r,i,o,s,u,c,d,p,m,y,w,C,_,A,T,O,L,V,j;return nt(this,function(U){switch(U.label){case 0:if(this.pendingRead.has(t))return r=this.pendingRead.get(t),[2,new Promise(function(G){return r.push(G)})];if(i=this.texData.get(t),o=i.values,s=i.shape,u=i.dtype,c=i.complexTensors,d=i.isPacked,null!=i.slice)return p=d?new Sp(s,B1):new qt(s,B1),m=this.runWebGLProgram(p,[{dataId:t,shape:s,dtype:u}],u),y=this.read(m.dataId),this.disposeData(m.dataId),[2,y];if(null!=o)return[2,this.convertAndCacheOnCPU(t)];if(!ge().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===ge().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return w=null,"complex64"!==u&&ge().get("WEBGL_BUFFER_SUPPORTED")&&(C=this.decode(t),_=this.texData.get(C.dataId),w=(j=this.gpgpu).createBufferFromTexture.apply(j,[_.texture].concat(gp(s)))),this.pendingRead.set(t,[]),"complex64"===u?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:U.sent(),U.label=2;case 2:return"complex64"!==u?[3,4]:[4,Promise.all([c.real.data(),c.imag.data()])];case 3:return T=U.sent(),A=xw(T[0],T[1]),[3,5];case 4:null==w?A=this.getValuesFromTexture(t):(O=st(s),A=this.gpgpu.downloadFloat32MatrixFromBuffer(w,O)),U.label=5;case 5:return null!=C&&this.disposeData(C.dataId),L=this.convertAndCacheOnCPU(t,A),V=this.pendingRead.get(t),this.pendingRead.delete(t),V.forEach(function(G){return G(L)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,L]}})})},e.prototype.checkNumericalProblems=function(t){if(null!=t)for(var r=0;r<t.length;r++){var i=t[r];if(!wR(i))throw ge().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+i+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+i+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(t){var r,i=this.texData.get(t),o=i.shape,s=i.dtype,a=i.isPacked,u=st(o);if(ge().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(t),d=this.texData.get(c.dataId),p=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[d.texture].concat(gp(o))).subarray(0,u);return this.disposeData(c.dataId),p}var m=ge().getBool("WEBGL_PACK")&&!0===a,y=m?w1(o):o,w=m?new rq(y):new nq(y),C=this.runWebGLProgram(w,[{shape:y,dtype:s,dataId:t}],"float32"),_=this.texData.get(C.dataId),A=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(_.texture,_.texShape[0],_.texShape[1]).subarray(0,u);return this.disposeData(C.dataId),A},e.prototype.time=function(t){return tt(this,void 0,void 0,function(){var r,i,o,s,a,u,c;return nt(this,function(d){switch(d.label){case 0:return r=this.activeTimers,i=[],o=!1,null==this.programTimersStack?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,t(),s=wu(this.activeTimers.map(function(p){return p.query})).filter(function(p){return null!=p}),a=wu(this.activeTimers.map(function(p){return p.name})).filter(function(p){return null!=p}),this.activeTimers=r,o&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(s)]:[3,2];case 1:return c=d.sent(),u.kernelMs=nR(c),u.getExtraProfileInfo=function(){return c.map(function(p,m){return{name:a[m],ms:p}}).map(function(p){return p.name+": "+p.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},d.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:sa(),endMs:null}},e.prototype.endTimer=function(t){return ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=sa(),t)},e.prototype.getQueryTime=function(t){return tt(this,void 0,void 0,function(){var r;return nt(this,function(i){return ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(r=t).endMs-r.startMs]})})},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var r=this.texData.get(t).complexTensors;null!=r&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var r=this.texData.get(t),i=r.texture,o=r.dtype,s=r.texShape,a=r.usage,u=r.isPacked,c=r.slice,d=c&&c.origDataId||t,p=this.dataRefCount.get(d);p>1?this.dataRefCount.set(d,p-1):(this.dataRefCount.delete(d),null!=i&&(this.numBytesInGPU-=this.computeBytes(s,o),this.textureManager.releaseTexture(i,s,a,u)));var m=this.texData.get(t);m.texture=null,m.texShape=null,m.isPacked=!1,m.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return ge().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=Z.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,r){var i=this;return void 0===r&&(r=128),null!=this.getCPUBackend()&&t.every(function(o){return null==i.texData.get(o.dataId).texture&&o.size<r})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,r){var i=this.makeOutput(t.shape,"complex64");return this.texData.get(i.dataId).complexTensors={real:Z.keep(t.clone()),imag:Z.keep(r.clone())},i},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,i){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,r,i);if(0===st(i))return Xi([],i,t.dtype);var o=this.texData.get(t.dataId).isPacked,s=fw(t.shape,r,i);if(o||!s){var a=ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Pq(i):new kq(i),u=a.getCustomSetupFunc(r);return this.compileAndRun(a,[t],null,u)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,r,i)},e.prototype.shallowSlice=function(t,r,i){var o=this.texData.get(t.dataId),s=this.makeOutput(i,t.dtype),a=this.texData.get(s.dataId);Object.assign(a,o),a.shape=i,a.dtype=t.dtype;var u=pw(r,t.strides);o.slice&&(u+=o.slice.flatOffset),a.slice={flatOffset:u,origDataId:o.slice&&o.slice.origDataId||t.dataId};var c=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,c+1),s},e.prototype.stridedSlice=function(t,r,i,o){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,r,i,o);var s=R1(r,i,o);if(s.some(function(u){return 0===u}))return Xi([],s);var a=new Fq(r,o,s);return this.compileAndRun(a,[t])},e.prototype.reverse=function(t,r){var i=ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Rq(t.shape,r):new Mq(t.shape,r);return this.compileAndRun(i,[t])},e.prototype.concat=function(t,r){if("complex64"===t[0].dtype){var i=t.map(function(y){return vs(y)}),o=t.map(function(y){return za(y)});return Yi(this.concat(i,r),this.concat(o,r))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,r);if(1===t.length)return t[0];if(t.length>ge().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var s=Math.floor(t.length/2),a=this.concat(t.slice(0,s),r),u=this.concat(t.slice(s),r);return this.concat([a,u],r)}if(ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var c=new WX(t.map(function(y){return y.shape}),r);return this.compileAndRun(c,t)}var d=yl(t.map(function(y){return y.shape}),r),p=t.map(function(y){return y.as2D(-1,st(y.shape.slice(r)))}),m=new jX(p.map(function(y){return y.shape}));return this.compileAndRun(m,p).reshape(d)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,J3,t.dtype);var r=new qt(t.shape,J3);return this.compileAndRun(r,[t])},e.prototype.batchMatMul=function(t,r,i,o){var s=i?t.shape[2]:t.shape[1],a=o?r.shape[1]:r.shape[2],u=i?t.shape[1]:t.shape[2],c=t.shape[0];if((1===s||1===a)&&u>1e3){i&&(t=t.transpose([0,2,1])),o&&(r=r.transpose([0,2,1]));var d=1===a?t:t.as3D(c,u,1),p=1===a?2:1,m=1===a?r.as3D(c,1,u):r;return this.multiply(d,m).sum(p,!0)}var y=ki(t.dtype,r.dtype),w=new Aw(t.shape,[c,s,a],i,o);return this.compileAndRun(w,[t,r],y)},e.prototype.fusedBatchMatMul=function(t){var r=t.a,i=t.b,o=t.transposeA,s=t.transposeB,a=t.bias,u=t.activation,c=t.preluActivationWeights,d=o?r.shape[2]:r.shape[1],p=s?i.shape[1]:i.shape[2],m=r.shape[0],y=ki(r.dtype,i.dtype),w=null!=a,C=null!=c,_=u?U1(u,!0):null,A=new Aw(r.shape,[m,d,p],o,s,w,_,C),T=[r,i];return a&&T.push(a),c&&T.push(c),this.compileAndRun(A,T,y)},e.prototype.multiply=function(t,r){if("complex64"===t.dtype){var i=this.texData.get(t.dataId),o=this.texData.get(r.dataId),s=new x3("return areal * breal - aimag * bimag;",t.shape,r.shape),a=new x3("return areal * bimag + aimag * breal;",t.shape,r.shape),u=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag),this.makeComplexComponentTensorInfo(r,o.complexTensors.real),this.makeComplexComponentTensorInfo(r,o.complexTensors.imag)],c=this.compileAndRun(s,u),d=this.compileAndRun(a,u),p=this.complex(c,d);return c.dispose(),d.dispose(),p}if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.multiply(t,r);if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,b3,t.dtype);var m=new Yr(b3,t.shape,r.shape);return this.compileAndRun(m,[t,r],t.dtype)},e.prototype.batchNormalization=function(t,r,i,o,s,a){var u=[t,r,i],c=null;null!=a&&(c=a.shape,u.push(a));var d=null;if(null!=s&&(d=s.shape,u.push(s)),ge().getBool("WEBGL_PACK_NORMALIZATION")){var p=new PX(t.shape,r.shape,i.shape,c,d,o);return this.compileAndRun(p,u)}var m=new kX(t.shape,r.shape,i.shape,c,d,o);return this.compileAndRun(m,u)},e.prototype.localResponseNormalization4D=function(t,r,i,o,s){var a=ge().getBool("WEBGL_PACK_NORMALIZATION")?new gq(t.shape,r,i,o,s):new fq(t.shape,r,i,o,s);return this.compileAndRun(a,[t])},e.prototype.LRNGrad=function(t,r,i,o,s,a,u){var c=new pq(r.shape,o,s,a,u);return this.compileAndRun(c,[r,i,t])},e.prototype.tile=function(t,r){if("string"===t.dtype){var i=this.readSync(t.dataId).map(function(s){return cp(s)});return p3(Vt(t.shape,t.dtype,i),r)}var o=new Bq(t.shape,r);return this.compileAndRun(o,[t])},e.prototype.pad=function(t,r,i){var o=ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new _q(t.shape,r,i):new wq(t.shape,r,i);return this.compileAndRun(o,[t])},e.prototype.transpose=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,r);var i=ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Uq(t.shape,r):new Vq(t.shape,r);return this.compileAndRun(i,[t])},e.prototype.gather=function(t,r,i){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.gather(t,r,i);var o=new cq(t.shape,r.size,i);return this.compileAndRun(o,[t,r])},e.prototype.batchToSpaceND=function(t,r,i){X(t.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var o=r.reduce(function(p,m){return p*m}),s=D1(t.shape,r,o),a=S1(s.length,r.length),u=T1(t.shape,r,o),c=t3(i,r.length),d=n3(u,i,r.length);return t.reshape(s).transpose(a).reshape(u).slice(c,d)},e.prototype.spaceToBatchND=function(t,r,i){X(t.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var o=r.reduce(function(m,y){return m*y}),s=[[0,0]];s.push.apply(s,i);for(var a=1+r.length;a<t.shape.length;++a)s.push([0,0]);var u=t.pad(s),c=D1(u.shape,r,o,!1),d=S1(c.length,r.length,!1),p=T1(u.shape,r,o,!1);return u.reshape(c).transpose(d).reshape(p)},e.prototype.reduce=function(t,r,i){var o=t.shape[0],s=t.shape[1],a=M1(s),u=new Cq({windowSize:a,inSize:s,batchSize:o},r),c=this.compileAndRun(u,[t],i);return 1===c.shape[1]?c:this.reduce(c,r,i)},e.prototype.argReduce=function(t,r,i){void 0===i&&(i=null);var o=t.shape[0],s=t.shape[1];null!=i&&(o=i.shape[0],s=i.shape[1]);var a=M1(s),u=new IX({windowSize:a,inSize:s,batchSize:o},r,null==i),c=[t];null!=i&&c.push(i);var d=this.compileAndRun(u,c,"int32");return 1===d.shape[1]?d:this.argReduce(t,r,d)},e.prototype.argReducePacked=function(t,r,i){void 0===i&&(i=null);var o=null!=i?i.shape:t.shape,s=M1(o[o.length-1]),a=new RX(o,s,r,null==i),c=this.compileAndRun(a,null==i?[t]:[t,i],"int32");return c.rank===t.rank?this.argReducePacked(t,r,c):c},e.prototype.sum=function(t,r){ko("sum",r,t.rank);var i=Gi(t.shape,r),o=i[0],s=st(i[1]),a=t.as2D(-1,s),u=Kb(t.dtype);return this.reduce(a,"sum",u).reshape(o)},e.prototype.prod=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,r);var i=Gi(t.shape,r),o=i[0],s=st(i[1]),a=t.as2D(-1,s),u=Kb(t.dtype);return this.reduce(a,"prod",u).reshape(o)},e.prototype.unsortedSegmentSum=function(t,r,i){var o=0,s=aa([o],t.rank),a=t;null!=s&&(a=t.transpose(s),o=ua(1,t.rank)[0]);var u=function(y,w,C){for(var _=[],A=y.length,T=0;T<A;T++)_.push(T!==w?y[T]:C);return _}(a.shape,o,i),c=st([a.shape[o]]),d=a.as2D(-1,c),p=Kb(t.dtype),m=this.segOpCompute(d,"unsortedSegmentSum",r,p,i).reshape(u);return null!=s&&(m=m.transpose(E1(s))),m},e.prototype.segOpCompute=function(t,r,i,o,s){var a=t.shape[0],u=t.shape[1],c=function(m,y){var w,C=!1;for(m<=30?(w=m,C=!0):w=g1(m,Math.floor(Math.sqrt(m)));!C;)w>y||w===m?C=!0:w=g1(m,w+1);return w}(u,s),d=new Nq({windowSize:c,inSize:u,batchSize:a,numSegments:s},r),p=this.compileAndRun(d,[t,i],o);return p.shape[1]===s?p:(i=I1(0,s).tile([u/c]),this.segOpCompute(p,r,i,o,s))},e.prototype.argMinMaxReduce=function(t,r,i){var o=[r];if(ko("arg"+i.charAt(0).toUpperCase()+i.slice(1),o,t.rank),!ge().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var s=Gi(t.shape,o),a=s[0],u=st(s[1]),c=t.as2D(-1,u);return this.argReduce(c,i).reshape(a)}return this.argReducePacked(t,i)},e.prototype.argMin=function(t,r){return this.argMinMaxReduce(t,r,"min")},e.prototype.argMax=function(t,r){return this.argMinMaxReduce(t,r,"max")},e.prototype.cumsum=function(t,r,i,o){if(r!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+r);var s=new QX(t.shape,i,o);return this.compileAndRun(s,[t])},e.prototype.equal=function(t,r){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  return vec4(equal(a, b));\n","bool");var i=new Yr("return float(a == b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.notEqual=function(t,r){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  return vec4(notEqual(a, b));\n","bool");var i=new Yr("return float(a != b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.less=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.less(t,r);if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  return vec4(lessThan(a, b));\n","bool");var i=new Yr("return float(a < b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.lessEqual=function(t,r){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  return vec4(lessThanEqual(a, b));\n","bool");var i=new Yr("return float(a <= b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.greater=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.greater(t,r);if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  return vec4(greaterThan(a, b));\n","bool");var i=new Yr("return float(a > b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.greaterEqual=function(t,r){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var i=new Yr("return float(a >= b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.logicalNot=function(t){var r=new qt(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[t])},e.prototype.logicalAnd=function(t,r){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var i=new Yr("return float(a >= 1.0 && b >= 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.logicalOr=function(t,r){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var i=new Yr("return float(a >= 1.0 || b >= 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.select=function(t,r,i){var o=new Oq(t.rank,r.shape,r.rank);return this.compileAndRun(o,[t,r,i],ki(r.dtype,i.dtype))},e.prototype.where=function(t){C1("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=t.dataSync();return _w(t.shape,r)},e.prototype.topk=function(t,r,i){return g3(t.dataSync(),t.shape,t.dtype,r)},e.prototype.min=function(t,r){ko("min",r,t.rank);var i=Gi(t.shape,r),o=i[0],s=st(i[1]),a=t.as2D(-1,s);return this.reduce(a,"min",a.dtype).reshape(o)},e.prototype.minimum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.minimum(t,r);var i=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Au("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,r.shape):new Yr("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.mod=function(t,r){var i=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Au("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,r.shape):new Yr("if (b == 0.0) return NAN;\n  return mod(a, b);",t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.max=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,r);ko("max",r,t.rank);var i=Gi(t.shape,r),o=i[0],s=st(i[1]),a=t.as2D(-1,s);return this.reduce(a,"max",a.dtype).reshape(o)},e.prototype.maximum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.maximum(t,r);var i=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Au("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,r.shape):new Yr("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.all=function(t,r){ko("all",r,t.rank);var i=Gi(t.shape,r),o=i[0],s=st(i[1]),a=t.as2D(-1,s);return this.reduce(a,"all",a.dtype).reshape(o)},e.prototype.any=function(t,r){ko("any",r,t.rank);var i=Gi(t.shape,r),o=i[0],s=st(i[1]),a=t.as2D(-1,s);return this.reduce(a,"any",a.dtype).reshape(o)},e.prototype.realDivide=function(t,r){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var i=new Yr("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",t.shape,r.shape);return this.compileAndRun(i,[t,r],"float32")},e.prototype.floorDiv=function(t,r){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var i=new Yr("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",t.shape,r.shape);return this.compileAndRun(i,[t,r],"int32")},e.prototype.add=function(t,r){if("complex64"===t.dtype&&"complex64"===r.dtype)return this.complexSeparableBinaryOp(t,r,Ew);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.add(t,r);var i=ki(t.dtype,r.dtype);if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,Ew,i);var o=new Yr(Ew,t.shape,r.shape);return this.compileAndRun(o,[t,r],i)},e.prototype.packedUnaryOp=function(t,r,i){var o=new Sp(t.shape,r);return this.compileAndRun(o,[t],i)},e.prototype.packedBinaryOp=function(t,r,i,o,s){void 0===s&&(s=!1);var a=new Au(i,t.shape,r.shape,s);return this.compileAndRun(a,[t,r],o)},e.prototype.complexSeparableBinaryOp=function(t,r,i){var o=this,s=this.texData.get(t.dataId),a=this.texData.get(r.dataId),u=[[s.complexTensors.real,a.complexTensors.real],[s.complexTensors.imag,a.complexTensors.imag]].map(function(m){var y=m[0],w=m[1],C=o.makeComplexComponentTensorInfo(t,y),_=o.makeComplexComponentTensorInfo(r,w),A=new Yr(i,t.shape,r.shape);return o.compileAndRun(A,[C,_],ki(y.dtype,w.dtype))}),c=u[0],d=u[1],p=this.complex(c,d);return c.dispose(),d.dispose(),p},e.prototype.makeComplexComponentTensorInfo=function(t,r){return{dataId:r.dataId,dtype:r.dtype,shape:t.shape}},e.prototype.addN=function(t){if(1===t.length)return t[0];if(t.length>ge().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(t.length/2),i=this.addN(t.slice(0,r)),o=this.addN(t.slice(r));return this.addN([i,o])}var s=t.map(function(c){return c.dtype}).reduce(function(c,d){return ki(c,d)}),a=t.map(function(c){return c.shape}),u=ge().getBool("WEBGL_PACK")?new EX(t[0].shape,a):new CX(t[0].shape,a);return this.compileAndRun(u,t,s)},e.prototype.subtract=function(t,r){if("complex64"===t.dtype&&"complex64"===r.dtype)return this.complexSeparableBinaryOp(t,r,Iw);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.subtract(t,r);var i=ki(t.dtype,r.dtype);if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,Iw,t.dtype);var o=new Yr(Iw,t.shape,r.shape);return this.compileAndRun(o,[t,r],i)},e.prototype.pow=function(t,r){var i=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Au("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,r.shape):new Yr("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",t.shape,r.shape),o=ki(t.dtype,r.dtype);return this.compileAndRun(i,[t,r],o)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,eN,t.dtype);var r=new qt(t.shape,eN);return this.compileAndRun(r,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,tN,t.dtype);var r=new qt(t.shape,tN);return this.compileAndRun(r,[t])},e.prototype.sign=function(t){var r=new qt(t.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(r,[t])},e.prototype.isNaN=function(t){var r=new qt(t.shape,"return float(isnan(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isInf=function(t){var r=new qt(t.shape,"return float(isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isFinite=function(t){var r=new qt(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.round=function(t){var r=new qt(t.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(r,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,nN,t.dtype);var r=new qt(t.shape,nN);return this.compileAndRun(r,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,rN,t.dtype);var r=new qt(t.shape,rN);return this.compileAndRun(r,[t])},e.prototype.softmax=function(t,r){var i=ui([r],t.shape),o=this.max(t,i),s=Co(o.shape,i),a=this.subtract(t,o.reshape(s)),u=this.exp(a),c=this.sum(u,i).reshape(s);return this.realDivide(u,c)},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",t.dtype);var r=new qt(t.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(r,[t])},e.prototype.log1p=function(t){var r=new qt(t.shape,"return log(1.0 + x);");return this.compileAndRun(r,[t])},e.prototype.sqrt=function(t){var r=new qt(t.shape,"return sqrt(x);");return this.compileAndRun(r,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var r=new qt(t.shape,"return inversesqrt(x);");return this.compileAndRun(r,[t])},e.prototype.reciprocal=function(t){var r=new qt(t.shape,"return 1.0 / x;");return this.compileAndRun(r,[t])},e.prototype.relu=function(t){var r;return r=ge().getBool("WEBGL_PACK")?new Sp(t.shape,iN):new qt(t.shape,K3),this.compileAndRun(r,[t])},e.prototype.relu6=function(t){var r;return r=ge().getBool("WEBGL_PACK")?new Sp(t.shape,oN):new qt(t.shape,Q3),this.compileAndRun(r,[t])},e.prototype.prelu=function(t,r){var i=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Au(_3,t.shape,r.shape):new Yr(w3,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.elu=function(t){if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,sN,t.dtype);var r=new qt(t.shape,Z3);return this.compileAndRun(r,[t])},e.prototype.eluDer=function(t,r){var i=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Au("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",t.shape,r.shape):new Yr("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.selu=function(t){var r=new qt(t.shape,"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n");return this.compileAndRun(r,[t])},e.prototype.int=function(t){var r=new qt(t.shape,"return float(int(x));");return this.compileAndRun(r,[t],"int32")},e.prototype.clip=function(t,r,i){var o,s=(o=ge().getBool("WEBGL_PACK_CLIP")?new VX(t.shape):new BX(t.shape)).getCustomSetupFunc(r,i);return this.compileAndRun(o,[t],null,s)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,$3,t.dtype);var r=new qt(t.shape,$3);return this.compileAndRun(r,[t])},e.prototype.complexAbs=function(t){var r=this.texData.get(t.dataId),i=new UX(t.shape),o=[this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)];return this.compileAndRun(i,o)},e.prototype.sigmoid=function(t){var r=new qt(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[t])},e.prototype.softplus=function(t){var r=new qt(t.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(r,[t])},e.prototype.sin=function(t){var r=new qt(t.shape,"if (isnan(x)) return x;\n  return sin(x);\n");return this.compileAndRun(r,[t])},e.prototype.cos=function(t){var r=new qt(t.shape,"if (isnan(x)) return x;\n  return cos(x);\n");return this.compileAndRun(r,[t])},e.prototype.tan=function(t){var r=new qt(t.shape,"return tan(x);");return this.compileAndRun(r,[t])},e.prototype.asin=function(t){var r=new qt(t.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n");return this.compileAndRun(r,[t])},e.prototype.acos=function(t){var r=new qt(t.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n");return this.compileAndRun(r,[t])},e.prototype.atan=function(t){var r=new qt(t.shape,"if (isnan(x)) return x;\n  return atan(x);\n");return this.compileAndRun(r,[t])},e.prototype.atan2=function(t,r){var i=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Au("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,r.shape):new Yr("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.sinh=function(t){var r=new qt(t.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(r,[t])},e.prototype.cosh=function(t){var r=new qt(t.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(r,[t])},e.prototype.tanh=function(t){var r=new qt(t.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(r,[t])},e.prototype.asinh=function(t){var r=new qt(t.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(r,[t])},e.prototype.acosh=function(t){var r=new qt(t.shape,"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(r,[t])},e.prototype.atanh=function(t){var r=new qt(t.shape,"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(r,[t])},e.prototype.erf=function(t){var r=new qt(t.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(r,[t])},e.prototype.step=function(t,r){var o,i=new qt(t.shape,(void 0===(o=r)&&(o=0),la+"\n    return x > 0.0 ? 1.0 : float("+o+");\n  "));return this.compileAndRun(i,[t])},e.prototype.conv2dByMatMul=function(t,r,i,o,s,a){var u=t.shape,c=this.texData.get(t.dataId),y="channelsLast"===i.dataFormat,C=u[2]%2!=0&&!!c.isPacked;if((1==u[0]*u[1]*u[2]||1===i.outChannels)&&i.inChannels>1e3||!ge().getBool("WEBGL_LAZILY_UNPACK")||!ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!C){var A=this.reshape(t,[1,y?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],i.inChannels]),T=this.reshape(r,[1,i.inChannels,i.outChannels]);return this.reshape(this.fusedBatchMatMul({a:A,b:T,transposeA:!1,transposeB:!1,bias:o,activation:s,preluActivationWeights:a}),i.outShape)}var M={dataId:t.dataId,shape:[1,y?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),i.inChannels],dtype:t.dtype},O=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,X(wp(c.shape,M.shape),function(){return"packed reshape "+c.shape+" to "+M.shape+" isn't free"});var L=this.reshape(r,[1,i.inChannels,i.outChannels]),V=this.fusedBatchMatMul({a:M,b:L,transposeA:!1,transposeB:!1,bias:o,activation:s,preluActivationWeights:a}),j=this.texData.get(V.dataId);return X(j.isPacked,function(){return"batchMatMul result is expected to be packed"}),c.shape=O,j.shape=i.outShape,Z.makeTensorFromDataId(V.dataId,i.outShape,V.dtype)},e.prototype.conv2dWithIm2Row=function(t,r,i,o,s,a){var p=i.outWidth,m=i.outHeight,y="channelsLast"===i.dataFormat,w=i.filterWidth*i.filterHeight*i.inChannels,C=m*p,_=[w,C],A=t.squeeze([0]),T=r.reshape([1,w,-1]),N=new dq(_,A.shape,i),M=this.compileAndRun(N,[A]).reshape([1,_[0],_[1]]),O=null!=o,L=null!=a,V=s?U1(s,!0):null,j=new Aw(M.shape,[1,C,i.outChannels],!0,!1,O,V,L),U=[M,T];return o&&U.push(o),L&&U.push(a),this.compileAndRun(j,U).reshape(y?[1,m,p,i.outChannels]:[1,i.outChannels,m,p])},e.prototype.fusedConv2d=function(t){var r=t.input,i=t.filter,o=t.convInfo,s=t.bias,a=t.activation,u=t.preluActivationWeights;if(1===o.filterHeight&&1===o.filterWidth&&1===o.dilationHeight&&1===o.dilationWidth&&1===o.strideHeight&&1===o.strideWidth&&("SAME"===o.padInfo.type||"VALID"===o.padInfo.type))return this.conv2dByMatMul(r,i,o,s,a,u);if(ge().getBool("WEBGL_CONV_IM2COL")&&1===r.shape[0])return this.conv2dWithIm2Row(r,i,o,s,a,u);var c=null!=s,d=null!=u,p=a?U1(a,!1):null,m=new C3(o,c,p,d),y=[r,i];return s&&y.push(s),u&&y.push(u),this.compileAndRun(m,y)},e.prototype.conv2d=function(t,r,i){if(1===i.filterHeight&&1===i.filterWidth&&1===i.dilationHeight&&1===i.dilationWidth&&1===i.strideHeight&&1===i.strideWidth&&("SAME"===i.padInfo.type||"VALID"===i.padInfo.type))return this.conv2dByMatMul(t,r,i);if(ge().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,r,i);var o=new C3(i);return this.compileAndRun(o,[t,r])},e.prototype.conv2dDerInput=function(t,r,i){var o=new zX(i);return this.compileAndRun(o,[t,r])},e.prototype.conv2dDerFilter=function(t,r,i){var o=new HX(i);return this.compileAndRun(o,[t,r])},e.prototype.fusedDepthwiseConv2D=function(t){var r,i=t.input,o=t.filter,s=t.convInfo,a=t.bias,u=t.activation,c=t.preluActivationWeights,d=ge().getBool("WEBGL_PACK_DEPTHWISECONV")&&s.strideWidth<=2&&s.outChannels/s.inChannels==1,p=u?U1(u,d):null,m=[i,o],y=null!=a,w=null!=c;return y&&m.push(a),w&&m.push(c),d?(r=new I3(s,y,p,w),this.compileAndRun(r,m)):(r=new E3(s,y,p,w),this.compileAndRun(r,m))},e.prototype.depthwiseConv2D=function(t,r,i){var o;return ge().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1?(o=new I3(i),this.compileAndRun(o,[t,r])):(o=new E3(i),this.compileAndRun(o,[t,r]))},e.prototype.depthwiseConv2DDerInput=function(t,r,i){var o=new qX(i);return this.compileAndRun(o,[t,r])},e.prototype.depthwiseConv2DDerFilter=function(t,r,i){var o=new XX(i);return this.compileAndRun(o,[t,r])},e.prototype.conv3d=function(t,r,i){var o=new $X(i);return this.compileAndRun(o,[t,r])},e.prototype.conv3dDerInput=function(t,r,i){var o=new YX(i);return this.compileAndRun(o,[t,r])},e.prototype.conv3dDerFilter=function(t,r,i){var o=new GX(i);return this.compileAndRun(o,[t,r])},e.prototype.maxPool=function(t,r){var i=new Dw(r,"max",!1);return this.compileAndRun(i,[t])},e.prototype.avgPool=function(t,r){var i=new Dw(r,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPoolBackprop=function(t,r,i,o){var s=new Dw(o,"max",!0),a=this.compileAndRun(s,[r]),u=new mq(o),c=this.compileAndRun(u,[t,a],r.dtype);return a.dispose(),c},e.prototype.avgPoolBackprop=function(t,r,i){var o=new NX(i);return this.compileAndRun(o,[t],r.dtype)},e.prototype.cast=function(t,r){return vw(t,r,this)},e.prototype.unstack=function(t,r){for(var i=t.shape[r],o=new Array(t.rank-1),s=0,a=0;a<t.rank;a++)a!==r&&(o[s++]=t.shape[a]);var u=new Array(t.rank).fill(0),c=t.shape.slice();c[r]=1;var d=new Array(i);for(a=0;a<d.length;a++)u[r]=a,d[a]=this.slice(t,u,c).reshape(o);return d},e.prototype.avgPool3d=function(t,r){var i=new Sw(r,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,r,i){var o=new OX(i);return this.compileAndRun(o,[t],r.dtype)},e.prototype.maxPool3d=function(t,r){var i=new Sw(r,"max",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,r,i,o){var s=new Sw(o,"max",!0),a=this.compileAndRun(s,[r]),u=new vq(o),c=this.compileAndRun(u,[t,a],r.dtype);return a.dispose(),c},e.prototype.reshape=function(t,r){var i=this.texData.get(t.dataId);if(i.isPacked&&!wp(t.shape,r)&&(null===i.texture||!wp(i.shape,r))){var o=this.packedReshape(t,r);return Z.makeTensorFromDataId(o.dataId,o.shape,o.dtype)}return F1(t,r)},e.prototype.resizeBilinear=function(t,r,i,o){var s=ge().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Dq(t.shape,r,i,o):new Aq(t.shape,r,i,o);return this.compileAndRun(s,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,r,i){var o=new Iq(t,r,i);return this.compileAndRun(o,[t])},e.prototype.resizeNearestNeighbor=function(t,r,i,o){var s=new Tq(t.shape,r,i,o);return this.compileAndRun(s,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,r,i){var o=new Sq(t,r,i);return this.compileAndRun(o,[t])},e.prototype.multinomial=function(t,r,i,o){var s=r?t:Eu(t),c=new yq(s.shape[0],s.shape[1],i),d=c.getCustomSetupFunc(o);return this.compileAndRun(c,[s],"int32",d)},e.prototype.oneHot=function(t,r,i,o){var s=new xq(t.size,r,i,o);return this.compileAndRun(s,[t])},e.prototype.diag=function(t){var r=new tq(t.size);return this.compileAndRun(r,[t])},e.prototype.nonMaxSuppression=function(t,r,i,o,s){return C1("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),bw(t.dataSync(),r.dataSync(),i,o,s)},e.prototype.cropAndResize=function(t,r,i,o,s,a){var u=new KX(t.shape,r.shape,o,s,a);return this.compileAndRun(u,[t,r,i],"float32")},e.prototype.depthToSpace=function(t,r,i){X(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var o=t.shape[0],c=("NHWC"===i?t.shape[1]:t.shape[2])*r,d=("NHWC"===i?t.shape[2]:t.shape[3])*r,p=("NHWC"===i?t.shape[3]:t.shape[1])/(r*r),m=new eq("NHWC"===i?[o,c,d,p]:[o,p,c,d],r,i);return this.compileAndRun(m,[t])},e.prototype.split=function(t,r,i){return f3(t,r,i)},e.prototype.scatterND=function(t,r,i){var o=Cp(0,t,i),s=o.sliceRank,a=o.numUpdates,u=o.sliceSize,c=o.strides,d=o.outputSize,p=[d/u,u],m=t.reshape([a,s]),y=r.reshape([a,u]);if(0===d)return F1(Xi([]),i);var w=Ue(0),C=new Y3(a,s,m.rank,y.rank,c,p);return this.compileAndRun(C,[y,m,w]).reshape(i)},e.prototype.sparseToDense=function(t,r,i,o){var s=Cp(0,t,i),p=new Y3(s.numUpdates,s.sliceRank,t.rank,r.rank,s.strides,[s.outputSize,1],!1);return this.compileAndRun(p,[r,t,o]).reshape(i)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,r){var i=this.texData.get(t.dataId),o=new D3("return real * expR - imag * expI;",t.shape,r),s=new D3("return real * expI + imag * expR;",t.shape,r),a=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag)],u=this.compileAndRun(o,a),c=this.compileAndRun(s,a),d=this.complex(u,c).as2D(t.shape[0],t.shape[1]);return u.dispose(),c.dispose(),d},e.prototype.gatherND=function(t,r){var i=r.shape,o=i[i.length-1],s=lw(t,r),a=s[0],u=s[1],c=s[2],d=s[3],p=r.reshape([u,o]),m=t.reshape([t.size/c,c]),y=new lq(o,d,[u,c]);return this.compileAndRun(y,[m,p]).reshape(a)},e.prototype.fill=function(t,r,i){if("string"===(i=i||rd(r))){var o=up(i,st(t));return o.fill(r),Z.makeTensor(o,t,i,this)}var s=new uq(t,r),a=s.getCustomSetupFunc(r);return this.compileAndRun(s,[],i,a)},e.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,"string"===t.dtype?"":0,t.dtype)},e.prototype.linspace=function(t,r,i){return yw(t,r,i)},e.prototype.makeTensorInfo=function(t,r){var i=this.write(null,t,r);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:r}},e.prototype.makeOutput=function(t,r){var i=this.makeTensorInfo(t,r).dataId;return Z.makeTensorFromDataId(i,t,r,this)},e.prototype.unpackTensor=function(t){var r=new Zq(t.shape);return this.runWebGLProgram(r,[t],t.dtype)},e.prototype.packTensor=function(t){var r=new bq(t.shape);return this.runWebGLProgram(r,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,r){var i=[xp(t.shape)].concat(bp(t.shape)),o={dtype:t.dtype,shape:i,dataId:t.dataId},s=[xp(r)].concat(bp(r)),a=new Eq(s,i),u=this.runWebGLProgram(a,[o],t.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},e.prototype.decode=function(t){var r,i=this.texData.get(t),o=i.isPacked,s=i.shape,a=i.dtype,u=w1(s);return r=o?new JX(u):new ZX(u),{dtype:a,shape:s,dataId:this.runWebGLProgram(r,[{shape:u,dtype:a,dataId:t}],a,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,r,i,o,s){var a=this;void 0===s&&(s=!1);var u=this.makeTensorInfo(t.outputShape,i),c=this.texData.get(u.dataId);if(t.packedOutput&&(c.isPacked=!0),t.outPackingScheme===pp.DENSE){var d=gp(t.outputShape);c.texShape=d.map(function(N){return 2*N})}if(null!=t.outTexUsage&&(c.usage=t.outTexUsage),0===st(u.shape))return c.values=nd(u.dtype,0),u;var p=[],m=r.map(function(N){if("complex64"===N.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var M=a.texData.get(N.dataId);if(null==M.texture){if(!t.packedInputs&&st(N.shape)<=ge().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:N.shape,texData:null,isUniform:!0,uniformValues:M.values};t.packedInputs&&(M.isPacked=!0,M.shape=N.shape)}else if(!!M.isPacked!=!!t.packedInputs)N=M.isPacked?a.unpackTensor(N):a.packTensor(N),p.push(N),M=a.texData.get(N.dataId);else if(M.isPacked&&!wp(M.shape,N.shape)){var O=N,L=N.shape;N.shape=M.shape,N=a.packedReshape(N,L),p.push(N),M=a.texData.get(N.dataId),O.shape=L}return a.uploadToGPU(N.dataId),{shape:N.shape,texData:M,isUniform:!1}});this.uploadToGPU(u.dataId);var y,N,L,w={shape:u.shape,texData:c,isUniform:!1},C=(N=t,L="",m.concat(w).forEach(function(U){L+=U.shape+"_"+(U.isUniform?"uniform":U.texData.texShape)+"_"+(null!=U.texData&&null!=U.texData.slice&&U.texData.slice.flatOffset>0)}),N.constructor.name+"_"+L+"_"+N.userCode),_=this.getAndSaveBinary(C,function(){return function(N,M,O,L){var V=M.userCode,j=O.map(function(ye,Ee){var Se={logicalShape:ye.shape,texShape:ye.isUniform?null:ye.texData.texShape,isUniform:ye.isUniform,isPacked:!ye.isUniform&&ye.texData.isPacked,flatOffset:null};return null!=ye.texData&&null!=ye.texData.slice&&ye.texData.slice.flatOffset>0&&(Se.flatOffset=ye.texData.slice.flatOffset),{name:M.variableNames[Ee],shapeInfo:Se}}),U=j.map(function(ye){return ye.shapeInfo}),G={logicalShape:L.shape,texShape:L.texData.texShape,isUniform:!1,isPacked:L.texData.isPacked,flatOffset:null},K=AX(j,G,V,M.packedInputs),$=N.createProgram(K),he=null,de=N.getUniformLocation($,"NAN",!1);1===ge().getNumber("WEBGL_VERSION")&&(he=N.getUniformLocation($,"INFINITY",!1));for(var se={},fe=0;fe<M.variableNames.length;fe++){var we=M.variableNames[fe];se[we]=N.getUniformLocation($,we,!1),se["offset"+we]=N.getUniformLocation($,"offset"+we,!1)}return{program:M,source:K,webGLProgram:$,uniformLocations:se,inShapeInfos:U,outShapeInfo:G,infLoc:he,nanLoc:de}}(a.gpgpu,t,m,w)}),A=null!=this.activeTimers;if(A&&(y=this.startTimer()),function(N,M,O,L,V){G3(M.inShapeInfos,O),G3([M.outShapeInfo],[L]);var j=L.texData.texture,U=L.texData.texShape;L.texData.isPacked?N.setOutputPackedMatrixTexture(j,U[0],U[1]):N.setOutputMatrixTexture(j,U[0],U[1]),N.setProgram(M.webGLProgram),1===ge().getNumber("WEBGL_VERSION")&&null!==M.infLoc&&N.gl.uniform1f(M.infLoc,1/0),null!==M.nanLoc&&N.gl.uniform1f(M.nanLoc,NaN),O.forEach(function(G,K){var $=M.program.variableNames[K],he=M.uniformLocations[$],de=M.uniformLocations["offset"+$];if(null!=he)if(G.isUniform)if(st(G.shape)<2)N.gl.uniform1f(he,G.uniformValues[0]);else{var se=G.uniformValues;se instanceof Float32Array||(se=new Float32Array(se)),N.gl.uniform1fv(he,se)}else null!=G.texData.slice&&null!=de&&N.gl.uniform1i(de,G.texData.slice.flatOffset),N.setInputMatrixTexture(G.texData.texture,he,K)}),null!=V&&V(N,M.webGLProgram),N.executeProgram()}(this.gpgpu,_,m,w,o),p.forEach(function(N){return a.disposeData(N.dataId)}),A&&(y=this.endTimer(y),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(y)})),!ge().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&!1===s){var T=this.unpackTensor(u);return this.disposeData(u.dataId),T}return u},e.prototype.compileAndRun=function(t,r,i,o,s){void 0===s&&(s=!1);var a=this.runWebGLProgram(t,r,i=i||r[0].dtype,o,s);return Z.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},e.prototype.getAndSaveBinary=function(t,r){return t in this.binaryCache||(this.binaryCache[t]=r()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(ge().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){t.gpgpu.deleteProgram(t.binaryCache[r].webGLProgram),delete t.binaryCache[r]}),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=qe(function(){if(!ge().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=ge().getBool("DEBUG");ge().set("DEBUG",!1);var i=t.abs(Ue(1e-8)).dataSync()[0];if(ge().set("DEBUG",r),i>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var r,i=this.texData.get(t),o=i.shape,s=i.dtype,a=i.values,c=i.usage,d=i.isPacked;if(null==i.texture){var p,m=null!=this.activeTimers;m&&(p=sa());var y=i.texShape;if(null==y&&(y=BR(o,d),i.texShape=y),null!=a){var w=w1(o),C=void 0,_=y[1],A=y[0],T=a instanceof Uint8Array;d?(_=(r=mp(y[0],y[1]))[0],C=new oq(w,[A=r[1],_],T)):C=new iq(w,[A,_],T);var N=this.makeTensorInfo([A,_],s);this.texData.get(N.dataId).usage=T?Jo.PIXELS:Jo.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(N.dataId),_,A,a);var M=this.runWebGLProgram(C,[N],s,null,!0),O=this.texData.get(M.dataId);i.texture=O.texture,i.texShape=O.texShape,i.isPacked=O.isPacked,i.usage=O.usage,this.disposeData(N.dataId),this.texData.delete(M.dataId),i.values=null,m&&(this.uploadWaitMs+=sa()-p)}else{var L=this.acquireTexture(y,c,s,d);i.texture=L}}},e.prototype.convertAndCacheOnCPU=function(t,r){var i=this.texData.get(t),o=i.dtype;return this.releaseGPUData(t),null!=r&&(i.values=function(s,a){if("float32"===a||"complex64"===a)return s;if("int32"===a||"bool"===a){for(var u="int32"===a?new Int32Array(s.length):new Uint8Array(s.length),c=0;c<u.length;++c)u[c]=Math.round(s[c]);return u}throw new Error("Unknown dtype "+a)}(r,o)),i.values},e.prototype.acquireTexture=function(t,r,i,o){if(this.numBytesInGPU+=this.computeBytes(t,i),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+s+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,r,o)},e.prototype.computeBytes=function(t,r){return t[0]*t[1]*Vb(r)},e}(c3);xR()&&Z.registerBackend("webgl",function(){return new aN},2);var e$=J({square_:function(n){var e=H(n,"x","square");return Z.runKernelFunc(function(r,i){return i([e]),r.square(e)},{x:e},null,"Square",{},[e],[])}}),Tp="SquaredDifference",uN=J({squaredDifference_:function(n,e){var t,r=H(n,"a","squaredDifference"),i=H(e,"b","squaredDifference");return t=Ar(r,i),sn((r=t[0]).shape,(i=t[1]).shape),Z.runKernelFunc(function(a,u){var c=a.squaredDifference(r,i);return u([r,i]),c},{a:r,b:i},function(a,u){var c=u[0],d=u[1],p=Ue(2);return{a:function(){return a.mul(c.sub(d).mul(p))},b:function(){return a.mul(d.sub(c).mul(p))}}},Tp,{},[r,i],[])}}),t$=J({abs_:function(n){var e=H(n,"x","abs");return"complex64"===e.dtype?Z.runKernelFunc(function(t){return t.complexAbs(e)},{$x:e}):Z.runKernelFunc(function(t,r){var i=t.abs(e);return r([e]),i},{x:e},function(t,r){var i=r[0];return{x:function(){return t.mul(i.toFloat().step(-1))}}},"Abs")}}),n$=J({acos_:function(n){var e=H(n,"x","acos");return Z.runKernelFunc(function(t,r){var i=t.acos(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(Ue(1).sub(i.toFloat().square()).sqrt()).neg()}}})}}),r$=J({acosh_:function(n){var e=H(n,"x","acosh");return Z.runKernelFunc(function(t,r){var i=t.acosh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(i.toFloat().square().sub(1).sqrt())}}})}}),i$=J({asin_:function(n){var e=H(n,"x","asin");return Z.runKernelFunc(function(t,r){var i=t.asin(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(Ue(1).sub(i.toFloat().square()).sqrt())}}})}}),o$=J({asinh_:function(n){var e=H(n,"x","asinh");return Z.runKernelFunc(function(t,r){var i=t.asinh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(Ue(1).add(i.toFloat().square()).sqrt())}}})}}),s$=J({atan_:function(n){var e=H(n,"x","atan");return Z.runKernelFunc(function(t,r){var i=t.atan(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().square().add(1))}}})}}),a$=J({atanh_:function(n){var e=H(n,"x","atanh");return Z.runKernelFunc(function(t,r){var i=t.atanh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(Ue(1).sub(i.toFloat().square()))}}})}}),u$=J({ceil_:function(n){var e=H(n,"x","ceil");return Z.runKernelFunc(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return Nn(t)}}})}}),Nw=J({clipByValue_:function(n,e,t){var r=H(n,"x","clipByValue");return X(e<=t,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."}),Z.runKernelFunc(function(s,a){var u=s.clip(r,e,t);return a([r]),u},{x:r},function(s,a){var u=a[0];return{x:function(){return s.where(u.greaterEqual(e).logicalAnd(u.lessEqual(t)),Nn(s))}}},"ClipByValue",{min:e,max:t},[r])}}),c$=J({cos_:function(n){var e=H(n,"x","cos");return Z.runKernelFunc(function(r,i){var o=r.cos(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return o.toFloat().sin().neg().mul(r)}}},"Cos",{},[e])}}),l$=J({cosh_:function(n){var e=H(n,"x","cosh");return Z.runKernelFunc(function(t,r){var i=t.cosh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().sinh().mulStrict(t)}}})}}),h$=J({erf_:function(n){var e=H(n,"x","erf");return X("int32"===e.dtype||"float32"===e.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===e.dtype&&(e=e.toFloat()),Z.runKernelFunc(function(t,r){var i=t.erf(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Ow=J({exp_:function(n){var e=H(n,"x","exp");return Z.runKernelFunc(function(t,r){var i=t.exp(e);return r([i]),i},{x:e},function(t,r){return{x:function(){return t.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),d$=J({expm1_:function(n){var e=H(n,"x","expm1");return Z.runKernelFunc(function(t,r){var i=t.expm1(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.exp())}}})}}),f$=J({floor_:function(n){var e=H(n,"x","floor");return Z.runKernelFunc(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return Nn(t)}}})}}),p$=J({log_:function(n){var e=H(n,"x","log");return Z.runKernelFunc(function(r,i){var o=r.log(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return r.div(o.toFloat())}}},"Log",{},[e])}}),g$=J({log1p_:function(n){var e=H(n,"x","log1p");return Z.runKernelFunc(function(t,r){var i=t.log1p(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.add(1))}}})}}),m$=J({logSigmoid_:function(n){var e=H(n,"x","logSigmoid");return Z.runKernelFunc(function(t,r){var i=t.softplus(e.neg()).neg();return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.neg().sigmoid())}}})}}),j1=J({neg_:function(n){var e=H(n,"x","neg");return Z.runKernelFunc(function(r){return r.neg(e)},{x:e},function(r){return{x:function(){return r.neg()}}},"Neg",{},[e])}}),v$=J({reciprocal_:function(n){var e=H(n,"x","reciprocal");return Z.runKernelFunc(function(t,r){var i=t.reciprocal(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.square().neg())}}})}}),y$=J({round_:function(n){var e=H(n,"x","round");return Z.runKernelFunc(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return Nn(t)}}})}}),cN=J({rsqrt_:function(n){var e=H(n,"x","rsqrt");return Z.runKernelFunc(function(r,i){var o=r.rsqrt(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return r.div(o.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},[e])}}),lN=J({sigmoid_:function(n){var e=H(n,"x","sigmoid");return Z.runKernelFunc(function(t,r){var i=t.sigmoid(e);return r([i]),i},{x:e},function(t,r){var i=r[0];return{x:function(){return t.mul(i.mul(Ue(1).sub(i)))}}},"Sigmoid")}}),x$=J({sign_:function(n){var e=H(n,"x","sign");return Z.runKernelFunc(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return Nn(t)}}})}}),b$=J({isNaN_:function(n){var e=H(n,"x","isNaN");return Z.runKernelFunc(function(t){return t.isNaN(e)},{$x:e},function(t){return{$x:function(){return Nn(t)}}})}}),w$=J({isInf_:function(n){var e=H(n,"x","isInf");return Z.runKernelFunc(function(t){return t.isInf(e)},{$x:e},function(t){return{$x:function(){return Nn(t)}}})}}),_$=J({isFinite_:function(n){var e=H(n,"x","isFinite");return Z.runKernelFunc(function(t){return t.isFinite(e)},{$x:e},function(t){return{$x:function(){return Nn(t)}}})}}),C$=J({sin_:function(n){var e=H(n,"x","sin");return Z.runKernelFunc(function(r,i){var o=r.sin(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return o.toFloat().cos().mul(r)}}},"Sin",{},[e])}}),E$=J({sinh_:function(n){var e=H(n,"x","sinh");return Z.runKernelFunc(function(t,r){var i=t.sinh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().cosh().mulStrict(t)}}})}}),I$=J({softplus_:function(n){var e=H(n,"x","softplus");return Z.runKernelFunc(function(t,r){var i=t.softplus(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.sigmoid())}}})}}),A$=J({sqrt_:function(n){var e=H(n,"x","sqrt");return Z.runKernelFunc(function(t,r){var i=t.sqrt(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().sqrt().mul(2))}}})}}),D$=J({step_:function(n,e){void 0===e&&(e=0);var t=H(n,"x","step");return Z.runKernelFunc(function(r){return r.step(t,e)},{$x:t},function(r){return{$x:function(){return Nn(r)}}})}}),S$=J({tan_:function(n){var e=H(n,"x","tan");return Z.runKernelFunc(function(t,r){var i=t.tan(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.cos().square())}}})}}),T$=J({tanh_:function(n){var e=H(n,"x","tanh");return Z.runKernelFunc(function(t,r){var i=t.tanh(e);return r([i]),i},{x:e},function(t,r){var i=r[0];return{x:function(){return Ue(1).sub(i.square()).mulStrict(t)}}},"Tanh",{},null,[!0])}});function hN(n,e,t,r,i,o){var s,a,u=H(n,"x","batchNorm"),c=H(e,"mean","batchNorm"),d=H(t,"variance","batchNorm");return null!=i&&(s=H(i,"scale","batchNorm")),null!=r&&(a=H(r,"offset","batchNorm")),X(2===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),X(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."}),X(2===d.rank||1===d.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+d.rank+"."}),null!=s&&X(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+s.rank+"."}),null!=a&&X(2===a.rank||1===a.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+a.rank+"."}),Mp(u,c,d,a,s,o)}function dN(n,e,t,r,i,o){var s,a,u=H(n,"x","batchNorm"),c=H(e,"mean","batchNorm"),d=H(t,"variance","batchNorm");return null!=i&&(s=H(i,"scale","batchNorm")),null!=r&&(a=H(r,"offset","batchNorm")),X(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),X(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."}),X(3===d.rank||1===d.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+d.rank+"."}),null!=s&&X(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+s.rank+"."}),null!=a&&X(3===a.rank||1===a.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+a.rank+"."}),Mp(u,c,d,a,s,o)}function fN(n,e,t,r,i,o){var s,a,u=H(n,"x","batchNorm"),c=H(e,"mean","batchNorm"),d=H(t,"variance","batchNorm");return null!=i&&(s=H(i,"scale","batchNorm")),null!=r&&(a=H(r,"offset","batchNorm")),X(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),X(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."}),X(4===d.rank||1===d.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+d.rank+"."}),null!=s&&X(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+s.rank+"."}),null!=a&&X(4===a.rank||1===a.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+a.rank+"."}),Mp(u,c,d,a,s,o)}function Mp(n,e,t,r,i,o){null==o&&(o=.001);var s,a,u,c=H(n,"x","batchNorm"),d=H(e,"mean","batchNorm"),p=H(t,"variance","batchNorm");return null!=i&&(s=H(i,"scale","batchNorm")),null!=r&&(a=H(r,"offset","batchNorm")),X(d.rank===p.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),X(null==a||d.rank===a.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),X(null==s||d.rank===s.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=0===c.rank||1===c.rank?c.as4D(1,1,1,c.size):2===c.rank?c.as4D(1,1,c.shape[0],c.shape[1]):3===c.rank?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c,Z.runKernelFunc(function(y,w){var C=y.batchNormalization(u,W1(d),W1(p),o,W1(s),W1(a));return w([c,d,p,s]),C},{x:c,mean:d,variance:p,scale:s,offset:a},function(y,w){var _=w[0],A=w[1],T=w[2],N=w[3],M=null==N?Ue(1):N,O=li(A.shape,u.shape),L=[];if(1===A.rank){for(var V=0;V<u.shape.length-1;++V)L.push(u.shape[V]);L.push(1)}var j=_.sub(A),U=y.mul(M),G=cN(T.add(Ue(o))),K=G.mul(G).mul(G).mul(Ue(-.5));return{x:function(){return 1===A.rank?y.mul(ad(G.as4D(1,1,1,A.shape[0]),L)).mul(M).reshape(_.shape):y.mul(G).mul(M).reshape(_.shape)},mean:function(){var $=G.mul(Ue(-1)).mul(U);return 1===A.rank&&($=$.sum(O)),$.reshape(A.shape)},variance:function(){var $=K.mul(j).mul(U);return 1===A.rank&&($=$.sum(O)),$.reshape(A.shape)},scale:function(){var $=j.mul(G),he=y.mul($);return 1===A.rank&&(he=he.sum(O)),he.reshape(A.shape)},offset:function(){var $=y;return 1===A.rank&&($=$.sum(O)),$.reshape(A.shape)}}},"BatchNormalization",{varianceEpsilon:o},[c,d,p,s]).reshape(c.shape)}function W1(n){return null==n?null:0===n.rank?n.as1D():1===n.rank?n:2===n.rank?n.as4D(1,1,n.shape[0],n.shape[1]):3===n.rank?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function H1(){GR("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var M$=J({batchNormalization2d_:function(n,e,t,r,i,o){return void 0===r&&(r=.001),H1(),hN(n,e,t,o,i,r)}}),R$=J({batchNormalization3d_:function(n,e,t,r,i,o){return void 0===r&&(r=.001),H1(),dN(n,e,t,o,i,r)}}),N$=J({batchNormalization4d_:function(n,e,t,r,i,o){return void 0===r&&(r=.001),H1(),fN(n,e,t,o,i,r)}}),O$=J({batchNormalization_:function(n,e,t,r,i,o){return void 0===r&&(r=.001),H1(),Mp(n,e,t,o,i,r)}}),pN=J({batchNorm_:Mp}),k$=J({batchNorm2d_:hN}),P$=J({batchNorm3d_:dN}),F$=J({batchNorm4d_:fN}),z1=J({logicalAnd_:function(n,e){var t=H(n,"a","logicalAnd","bool"),r=H(e,"b","logicalAnd","bool");return sn(t.shape,r.shape),Z.runKernelFunc(function(i){return i.logicalAnd(t,r)},{a:t,b:r},null,"LogicalAnd")}}),L$=J({logicalNot_:function(n){var e=H(n,"x","logicalNot","bool");return Z.runKernelFunc(function(t){return t.logicalNot(e)},{$x:e})}}),gN=J({logicalOr_:function(n,e){var t=H(n,"a","logicalOr","bool"),r=H(e,"b","logicalOr","bool");return sn(t.shape,r.shape),Z.runKernelFunc(function(i){return i.logicalOr(t,r)},{$a:t,$b:r})}}),B$=J({logicalXor_:function(n,e){var t=H(n,"a","logicalXor","bool"),r=H(e,"b","logicalXor","bool");return sn(t.shape,r.shape),gN(n,e).logicalAnd(z1(n,e).logicalNot())}}),Il=J({where_:function(n,e,t){var r=H(e,"a","where"),i=H(t,"b","where"),o=H(n,"condition","where","bool");return Rn(r.shape,i.shape,"Error in where: "),1===o.rank?X(o.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Rn(o.shape,i.shape,"Error in where: "),Z.runKernelFunc(function(s,a){var u=s.select(o,r,i);return a([o]),u},{$condition:o,$a:r,$b:i},function(s,a){var u=a[0];return{$condition:function(){return Nn(u).toFloat()},$a:function(){return s.mul(u.cast(s.dtype))},$b:function(){return s.mul(u.logicalNot().cast(s.dtype))}}})}}),mN=function(n){return tt(this,void 0,void 0,function(){var e,t,r;return nt(this,function(i){switch(i.label){case 0:return[4,(e=H(n,"condition","whereAsync","bool")).data()];case 1:return t=i.sent(),r=_w(e.shape,t),n!==e&&e.dispose(),[2,r]}})})},an=J({add_:function(n,e){var t,r=H(n,"a","add"),i=H(e,"b","add");t=Ar(r,i);var o=sn((r=t[0]).shape,(i=t[1]).shape);return Z.runKernelFunc(function(s){return s.add(r,i)},{a:r,b:i},function(s){return{a:function(){var a=s,u=li(r.shape,o);return u.length>0&&(a=a.sum(u)),a.reshape(r.shape)},b:function(){var a=s,u=li(i.shape,o);return u.length>0&&(a=a.sum(u)),a.reshape(i.shape)}}},"Add")}}),V$=J({addN_:function(n){X(Array.isArray(n),function(){return"The argument passed to tf.addN() must be a list of tensors"}),X(n.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length});var e=n.map(function(i,o){return H(i,"tensors"+o,"addN")}),t=e[0];return e.forEach(function(i){if(i.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(i){if(!ai(i.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}),Z.runKernelFunc(function(i){return i.addN(e)},e,function(i){var o={};return e.forEach(function(s,a){o[a]=function(){return i.clone()}}),o},"AddN")}}),U$=J({addStrict_:function(n,e){var t=H(n,"a","addStrict"),r=H(e,"b","addStrict");return Rn(t.shape,r.shape,"Error in addStrict: "),t.add(r)}}),j$=J({atan2_:function(n,e){var t,r=H(n,"a","atan2"),i=H(e,"b","atan2");t=Ar(r,i);var o=sn((r=t[0]).shape,(i=t[1]).shape);return Z.runKernelFunc(function(s,a){var u=s.atan2(r,i);return a([r,i]),u},{$a:r,$b:i},function(s,a){var u=a[0],c=a[1];return{$a:function(){var d=an(u.square(),c.square()),p=s.mul(c.div(d)),m=li(u.shape,o);return m.length>0&&(p=p.sum(m)),p.reshape(u.shape)},$b:function(){var d=an(u.square(),c.square()),p=j1(s.mul(u.div(d))),m=li(c.shape,o);return m.length>0&&(p=p.sum(m)),p.reshape(c.shape)}}})}}),ha=J({div_:function(n,e){var t,r=H(n,"a","div"),i=H(e,"b","div");if(t=Ar(r,i),i=t[1],"int32"===(r=t[0]).dtype&&"int32"===i.dtype)return vN(r,i);var o=sn(r.shape,i.shape);return Z.runKernelFunc(function(s,a){var u=s.realDivide(r,i);return a([r,i]),u},{a:r,b:i},function(s,a){var u=a[0],c=a[1];return{a:function(){var d=s.div(c.toFloat()),p=li(u.shape,o);return p.length>0?d.sum(p).reshape(u.shape):d},b:function(){var d=s.mul(u.toFloat()),p=li(c.shape,o);p.length>0&&(d=d.sum(p).reshape(c.shape));var m=c.square();return d.div(m.toFloat()).neg()}}},"Div")}}),W$=J({divNoNan_:function(n,e){var t,r=H(n,"a","div"),i=H(e,"b","div");r=(t=Ar(r,i))[0];var o=ha(r,i=t[1]),s=Nn(o),a=i.equal(s);return Il(a,s,o)}}),H$=J({divStrict_:function(n,e){var t=H(n,"a","div"),r=H(e,"b","div");return Rn(t.shape,r.shape,"Error in divideStrict: "),t.div(r)}}),vN=J({floorDiv_:function(n,e){var t,r=H(n,"a","floorDiv"),i=H(e,"b","floorDiv");t=Ar(r,i);var o=sn((r=t[0]).shape,(i=t[1]).shape);return Z.runKernelFunc(function(s,a){var u=s.floorDiv(r,i);return a([r,i]),u},{a:r,b:i},function(s,a){var u=a[0],c=a[1];return{a:function(){var d=s.div(c.toFloat()),p=li(u.shape,o);return p.length>0?d.sum(p).reshape(u.shape):d},b:function(){var d=s.mul(u.toFloat()),p=li(c.shape,o);p.length>0&&(d=d.sum(p).reshape(c.shape));var m=c.square();return d.div(m.toFloat()).neg()}}},"FloorDiv")}}),kw=J({maximum_:function(n,e){var t,r=H(n,"a","maximum"),i=H(e,"b","maximum");return t=Ar(r,i),i=t[1],"bool"===(r=t[0]).dtype&&(r=r.toInt(),i=i.toInt()),sn(r.shape,i.shape),Z.runKernelFunc(function(o,s){var a=o.maximum(r,i);return s([r,i]),a},{a:r,b:i},function(o,s){var a=s[0],u=s[1];return{a:function(){return o.mul(a.greaterEqual(u).toFloat())},b:function(){return o.mul(a.less(u).toFloat())}}},"Maximum")}}),z$=J({maximumStrict_:function(n,e){var t=H(n,"a","maximumStrict"),r=H(e,"b","maximumStrict");return Rn(t.shape,r.shape,"Error in maximumStrict: "),t.maximum(r)}}),yN=J({minimum_:function(n,e){var t,r=H(n,"a","minimum"),i=H(e,"b","minimum");return t=Ar(r,i),i=t[1],"bool"===(r=t[0]).dtype&&(r=r.toInt(),i=i.toInt()),sn(r.shape,i.shape),Z.runKernelFunc(function(o,s){var a=o.minimum(r,i);return s([r,i]),a},{a:r,b:i},function(o,s){var a=s[0],u=s[1];return{a:function(){return o.mul(a.lessEqual(u).toFloat())},b:function(){return o.mul(a.greater(u).toFloat())}}},"Minimum")}}),G$=J({minimumStrict_:function(n,e){var t=H(n,"a","minimumStrict"),r=H(e,"b","minimumStrict");return Rn(t.shape,r.shape,"Error in minimumStrict: "),t.minimum(r)}}),Y$=J({mod_:function(n,e){var t,r=H(n,"a","mod"),i=H(e,"b","mod");t=Ar(r,i);var o=sn((r=t[0]).shape,(i=t[1]).shape);return Z.runKernelFunc(function(s,a){var u=s.mod(r,i);return a([r,i]),u},{$a:r,$b:i},function(s,a){var u=a[0],c=a[1];return{$a:function(){var d=li(u.shape,o);return d.length>0?s.sum(d).reshape(u.shape):s},$b:function(){var d=s.mul(u.div(c).floor().neg()),p=li(c.shape,o);return p.length>0?d.sum(p).reshape(c.shape):d}}})}}),X$=J({modStrict_:function(n,e){var t=H(n,"a","modStrict"),r=H(e,"b","modStrict");return Rn(t.shape,r.shape,"Error in modStrict: "),t.mod(r)}}),oo=J({mul_:function(n,e){var t,r=H(n,"a","mul"),i=H(e,"b","mul");t=Ar(r,i);var o=sn((r=t[0]).shape,(i=t[1]).shape);return Z.runKernelFunc(function(s,a){var u=s.multiply(r,i);return a([r,i]),u},{a:r,b:i},function(s,a){var u=a[0],c=a[1];return{a:function(){var d=s.mul(c.toFloat()),p=li(u.shape,o);return p.length>0?d.sum(p).reshape(u.shape):d},b:function(){var d=s.mul(u.toFloat()),p=li(c.shape,o);return p.length>0?d.sum(p).reshape(c.shape):d}}},"Mul")}}),q$=J({mulStrict_:function(n,e){var t=H(n,"a","mul"),r=H(e,"b","mul");return Rn(t.shape,r.shape,"Error in multiplyStrict: "),t.mul(r)}}),G1=J({pow_:function(n,e){var t,r=H(n,"base","pow"),i=H(e,"exp","pow");t=Ar(r,i);var o=sn((r=t[0]).shape,(i=t[1]).shape);return Z.runKernelFunc(function(a,u){var c=a.pow(r,i);return u([r,i,c]),c},{a:r,b:i},function(a,u){var c=u[0],d=u[1],p=u[2];return{a:function(){var m=d.toFloat(),y=a.mul(m.mul(c.pow(m.sub(Ue(1))))),w=li(c.shape,o);return w.length>0&&(y=y.sum(w)),y.reshape(c.shape)},b:function(){var m=c.greater(0),y=c.log().where(m,Nn(c)),w=a.mul(p.mul(y)),C=li(d.shape,o);return C.length>0&&(w=w.sum(C)),w.reshape(d.shape)}}},"Pow",{},[r,i],[!0])}}),$$=J({powStrict_:function(n,e){return Rn(n.shape,e.shape,"Error in powStrict: "),n.pow(e)}}),K$=J({squaredDifferenceStrict_:function(n,e){var t=H(n,"a","squaredDifferenceStrict"),r=H(e,"b","squaredDifferenceStrict");return Rn(t.shape,r.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(r)}}),Ei=J({sub_:function(n,e){var t,r=H(n,"a","sub"),i=H(e,"b","sub");t=Ar(r,i);var o=sn((r=t[0]).shape,(i=t[1]).shape);return Z.runKernelFunc(function(s){return s.subtract(r,i)},{a:r,b:i},function(s){return{a:function(){var a=s,u=li(r.shape,o);return u.length>0&&(a=a.sum(u)),a.reshape(r.shape)},b:function(){var a=s,u=li(i.shape,o);return u.length>0&&(a=a.sum(u)),a.neg().reshape(i.shape)}}},"Sub")}}),Q$=J({subStrict_:function(n,e){var t=H(n,"a","subStrict"),r=H(e,"b","subStrict");return Rn(t.shape,r.shape,"Error in subStrict: "),t.sub(r)}}),xN=J({equal_:function(n,e){var t,r=H(n,"a","equal"),i=H(e,"b","equal");return t=Ar(r,i),sn((r=t[0]).shape,(i=t[1]).shape),Z.runKernelFunc(function(o){return o.equal(r,i)},{$a:r,$b:i})}}),Z$=J({equalStrict_:function(n,e){var t=H(n,"a","equalStrict"),r=H(e,"b","equalStrict");return Rn(t.shape,r.shape,"Error in equalStrict: "),t.equal(r)}}),J$=J({greater_:function(n,e){var t,r=H(n,"a","greater"),i=H(e,"b","greater");return t=Ar(r,i),sn((r=t[0]).shape,(i=t[1]).shape),Z.runKernelFunc(function(o){return o.greater(r,i)},{a:r,b:i},null,"Greater")}}),bN=J({greaterEqual_:function(n,e){var t,r=H(n,"a","greaterEqual"),i=H(e,"b","greaterEqual");return t=Ar(r,i),sn((r=t[0]).shape,(i=t[1]).shape),Z.runKernelFunc(function(o,s){var a=o.greaterEqual(r,i);return s([r,i]),a},{a:r,b:i},function(o,s){var a=s[0],u=s[1];return{a:function(){return Nn(a)},b:function(){return Nn(u)}}},"GreaterEqual")}}),eK=J({greaterEqualStrict_:function(n,e){var t=H(n,"a","greaterEqualStrict"),r=H(e,"b","greaterEqualStrict");return Rn(t.shape,r.shape,"Error in greaterEqualStrict: "),t.greaterEqual(r)}}),tK=J({greaterStrict_:function(n,e){var t=H(n,"a","greaterStrict"),r=H(e,"b","greaterStrict");return Rn(t.shape,r.shape,"Error in greaterStrict: "),t.greater(r)}}),nK=J({less_:function(n,e){var t,r=H(n,"a","less"),i=H(e,"b","less");return t=Ar(r,i),sn((r=t[0]).shape,(i=t[1]).shape),Z.runKernelFunc(function(o){return o.less(r,i)},{a:r,b:i},null,"Less")}}),rK=J({lessEqual_:function(n,e){var t,r=H(n,"a","lessEqual"),i=H(e,"b","lessEqual");return t=Ar(r,i),sn((r=t[0]).shape,(i=t[1]).shape),Z.runKernelFunc(function(o,s){var a=o.lessEqual(r,i);return s([r,i]),a},{a:r,b:i},null,"LessEqual")}}),iK=J({lessEqualStrict_:function(n,e){var t=H(n,"a","lessEqualStrict"),r=H(e,"b","lessEqualStrict");return Rn(t.shape,r.shape,"Error in lessEqualStrict: "),t.lessEqual(r)}}),oK=J({lessStrict_:function(n,e){var t=H(n,"a","lessStrict"),r=H(e,"b","lessStrict");return Rn(t.shape,r.shape,"Error in lessStrict: "),t.less(r)}}),sK=J({notEqual_:function(n,e){var t,r=H(n,"a","notEqual"),i=H(e,"b","notEqual");return t=Ar(r,i),sn((r=t[0]).shape,(i=t[1]).shape),Z.runKernelFunc(function(o){return o.notEqual(r,i)},{a:r,b:i},null,"NotEqual")}}),aK=J({notEqualStrict_:function(n,e){var t=H(n,"a","notEqualStrict"),r=H(e,"b","notEqualStrict");return Rn(t.shape,r.shape,"Error in notEqualStrict: "),t.notEqual(r)}});function wN(n,e){for(var t=[],r=n;r<e;++r)t.push(r);return t}function _N(n){for(var e=[],t=0;t<n.length;++t)for(var r=0;r<n[t].length;++r)e.push(n[t][r]);return e}var Pw=J({gather_:function(n,e,t){void 0===t&&(t=0);var r=H(n,"x","gather"),i=H(e,"indices","gather","int32");t=ui(t,r.shape)[0];var o=function(s,a,u){for(var c=s.shape[u],d=[],p=1,m=1,y=0;y<u;y++)d.push(s.shape[y]),p*=s.shape[y];for(y=0;y<a.rank;y++)d.push(a.shape[y]);for(y=u+1;y<s.rank;y++)d.push(s.shape[y]),m*=s.shape[y];return{batchSize:p,sliceSize:m,dimSize:c,outputShape:d}}(r,i,t);return Z.runKernelFunc(function(s,a){var u=s.gather(r,i.flatten(),t);return a([i]),u},{x:r,indices:i},function(s,a){var u=a[0];return{x:function(){var c=r.shape,d=u.size,p=c.slice(0,t),m=p.length,y=c.slice(t,c.length).slice(1),w=y.length,C=wN(0,m),_=wN(m+1,m+1+w),A=_N([p,[d],y]),T=s.reshape(A),N=u.reshape([d]),M=_N([[m],C,_]),O=T.transpose(M),L=CN(O,N,r.shape[t]),V=E1(M);return L.transpose(V)},indices:function(){return u}}},"Gather",{axis:t}).reshape(o.outputShape)}}),CN=J({unsortedSegmentSum_:function(n,e,t){var r=H(n,"x","unsortedSegmentSum"),i=H(e,"segmentIds","unsortedSegmentSum","int32");return X(Rr(t),function(){return"numSegments must be of dtype int"}),Z.runKernelFunc(function(o,s){var a=o.unsortedSegmentSum(r,i,t);return s([i]),a},{$x:r},function(o,s){var a=s[0];return{$x:function(){return function(u,c){for(var d=kw(c,Nn(c)),p=Pw(u,d),m=bN(c,Ue(0,"int32")),y=p.rank-m.rank,w=0;w<y;++w)m=ys(m,w+1);m=z1(m,sd(p.shape,"bool"));var C=Nn(p);return Il(m,p,C)}(o,a)}}})}});function EN(n,e,t,r,i,o,s){void 0===o&&(o="NHWC"),X(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var a=n,u=e,c=!1;3===e.rank&&(c=!0,u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),a=[1,n[0],n[1],n[2]]),X(4===a.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+a.length+"."}),X(4===u.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),X(4===t.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank});var d="NHWC"===o?a[3]:a[1],p="NHWC"===o?u.shape[3]:u.shape[1];X(d===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+d+") must match input depth for filter "+t.shape[2]+"."}),X(p===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+p+") must match output depth for filter "+t.shape[3]+"."}),null!=s&&X(Rr(i),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."});var m=P1(o),y=Ec(a,t.shape,r,1,i,s,!1,m),w=Z.runKernelFunc(function(C,_){var A=C.conv2dDerInput(u,t,y);return _([t,u]),A},{dy4D:u,filter:t},function(C,_){var A=_[0],T=_[1];return{dy4D:function(){return xs(C,A,r,i,o,1,s)},filter:function(){return Lw(C,T,A.shape,r,i,o,s)}}});return c?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}function Fw(n){var o,e="number"==typeof(o=n)?[o,o,o]:2===o.length?[o[0],o[1],1]:o;return 1===e[0]&&1===e[1]&&1===e[2]}function IN(n,e,t,r,i){X(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var o=n,s=e,a=!1;4===e.rank&&(a=!0,s=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),o=[1,n[0],n[1],n[2],n[3]]);var u=o[4],c=s.shape[4];X(5===o.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."}),X(5===s.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+s.rank}),X(5===t.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank}),X(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+t.shape[3]+"."}),X(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+t.shape[4]+"."});var d=Ip(o,t.shape,r,1,i),p=Z.runKernelFunc(function(m){return m.conv3dDerInput(s,t,d)},{dy5D:s});return a?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}var cK=J({conv1d_:function(n,e,t,r,i,o,s){void 0===i&&(i="NWC"),void 0===o&&(o=1);var a=H(n,"x","conv1d"),u=H(e,"filter","conv1d"),c=a,d=!1;2===a.rank&&(d=!0,c=a.as3D(1,a.shape[0],a.shape[1])),X(3===c.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."}),X(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=s&&X(Rr(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."}),X(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),X(Eo(t,o),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+o+"'"}),X("NWC"===i,function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."});var p=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),m=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),y=xs(m,p,[1,t],r,"NHWC",[1,o],s);return d?y.as2D(y.shape[2],y.shape[3]):y.as3D(y.shape[0],y.shape[2],y.shape[3])}}),xs=J({conv2d_:function(n,e,t,r,i,o,s){void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]);var a=H(n,"x","conv2d"),u=H(e,"filter","conv2d"),c=a,d=!1;3===a.rank&&(d=!0,c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),X(4===c.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."}),X(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=s&&X(Rr(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."});var p="NHWC"===i?c.shape[3]:c.shape[1];X(p===u.shape[2],function(){return"Error in conv2d: depth of input ("+p+") must match input depth for filter "+u.shape[2]+"."}),X(Eo(t,o),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"});var m=P1(i),y=Ec(c.shape,u.shape,t,o,r,s,!1,m),C=Z.runKernelFunc(function(_,A){var T=_.conv2d(c,u,y);return A([u,c]),T},{x:c,filter:u},function(_,A){var N=A[0],M=A[1];return X(_l(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}),{x:function(){return AN(M.shape,_,N,t,r,i)},filter:function(){return Lw(M,_,N.shape,t,r,i)}}},"Conv2D",y,[u,c]);return d?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),lK=J({conv3d_:function(n,e,t,r,i,o){void 0===i&&(i="NDHWC"),void 0===o&&(o=[1,1,1]);var y,s=H(n,"x","conv3d"),a=H(e,"filter","conv3d"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),X(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),X(5===a.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+a.rank+"."}),X(u.shape[4]===a.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+a.shape[3]+"."}),X((y=o,Fw(t)||Fw(y)),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),X("NDHWC"===i,function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."});var d=Ip(u.shape,a.shape,t,o,r),p=Z.runKernelFunc(function(m,y){var w=m.conv3d(u,a,d);return y([u,a]),w},{x:u,$filter:a},function(m,y){X(Fw(o),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"});var w=y[0],C=y[1];return{x:function(){return IN(w.shape,m,C,t,r)},$filter:function(){return function(_,A,T,N,M){var O=_;4===_.rank&&(O=_.as5D(1,_.shape[0],_.shape[1],_.shape[2],_.shape[3]));var L=A;4===L.rank&&(L=A.as5D(1,A.shape[0],A.shape[1],A.shape[2],A.shape[3])),X(5===O.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+O.shape+"."}),X(5===L.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+L.shape+"."}),X(5===T.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+T+"."}),X(O.shape[4]===T[3],function(){return"Error in conv3dDerFilter: depth of input "+O.shape[4]+") must match input depth in filter ("+T[3]+"."}),X(L.shape[4]===T[4],function(){return"Error in conv3dDerFilter: depth of dy ("+L.shape[4]+") must match output depth for filter ("+T[4]+")."});var V=Ip(O.shape,T,N,1,M);return Z.runKernelFunc(function(j){return j.conv3dDerFilter(O,L,V)},{x5D:O,dy5D:L})}(w,m,C.shape,t,r)}}});return c?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),Lw=J({conv2dDerFilter_:function(n,e,t,r,i,o,s){void 0===o&&(o="NHWC");var a=n;3===n.rank&&(a=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var u=e;3===u.rank&&(u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),X(4===a.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+a.shape+"."}),X(4===u.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),X(4===t.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."});var c="NHWC"===o?a.shape[3]:a.shape[1],d="NHWC"===o?u.shape[3]:u.shape[1];X(c===t[2],function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+t[2]+"."}),X(d===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+d+") must match output depth for filter ("+t[3]+")."}),null!=s&&X(Rr(i),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."});var p=P1(o),m=Ec(a.shape,t,r,1,i,s,!1,p);return Z.runKernelFunc(function(y){return y.conv2dDerFilter(a,u,m)},{x4D:a,dy4D:u})}}),AN=J({conv2dDerInput_:EN}),Y1=J({depthwiseConv2d_:function(n,e,t,r,i,o,s){void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]);var a=H(n,"x","depthwiseConv2d"),u=H(e,"filter","depthwiseConv2d"),c=a,d=!1;3===a.rank&&(d=!0,c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),X(4===c.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."}),X(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),X(c.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==o&&(o=[1,1]),X(Eo(t,o),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),null!=s&&X(Rr(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."});var p=Ec(c.shape,u.shape,t,o,r,s,!0),y=Z.runKernelFunc(function(w,C){var _=w.depthwiseConv2D(c,u,p);return C([c,u]),_},{x:c,filter:u},function(w,C){X(_l(o),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"});var _=C[0],A=C[1];return{x:function(){return DN(_.shape,w,A,p)},filter:function(){return SN(_,w,A.shape,p)}}},"DepthwiseConv2dNative",p,[c,u]);return d?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),DN=J({depthwiseConv2dDerInput_:function(n,e,t,r){var i=e,o=!1;3===e.rank&&(o=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var s=Z.runKernelFunc(function(a){return a.depthwiseConv2DDerInput(i,t,r)},{dy4D:i});return o?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),SN=J({depthwiseConv2dDerFilter_:function(n,e,t,r){var i=n;3===n.rank&&(i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var o=e;return 3===o.rank&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),Z.runKernelFunc(function(s){return s.depthwiseConv2DDerFilter(i,o,r)},{x4D:i,dy4D:o})}}),Bw=J({separableConv2d_:function(n,e,t,r,i,o,s){void 0===o&&(o=[1,1]),void 0===s&&(s="NHWC");var a=H(n,"x","separableConv2d"),u=H(e,"depthwiseFilter","separableConv2d"),c=H(t,"pointwiseFilter","separableConv2d"),d=a,p=!1;if(3===a.rank&&(p=!0,d=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),"NCHW"===s)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");X(4===d.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+d.rank+"."}),X(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),X(4===c.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),X(1===c.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."}),X(1===c.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."});var m=u.shape[2],y=u.shape[3];X(c.shape[2]===m*y,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+m*y+", but got "+c.shape[2]+"."});var w=Y1(d,u,r,i,s,o),C=xs(w,c,1,"valid",s);return p?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),hK=J({conv2dTranspose_:function(n,e,t,r,i,o){return EN(t,H(n,"x","conv2dTranspose"),H(e,"filter","conv2dTranspose"),r,i,"NHWC",o)}}),dK=J({conv3dTranspose_:function(n,e,t,r,i){return IN(t,H(n,"x","conv3dTranspose"),H(e,"filter","conv3dTranspose"),r,i)}}),X1=J({matMul_:function(n,e,t,r){var i;void 0===t&&(t=!1),void 0===r&&(r=!1);var o=H(n,"a","matMul"),s=H(e,"b","matMul");i=Ar(o,s),o=i[0],s=i[1];var a=t?o.shape[o.rank-2]:o.shape[o.rank-1],u=r?s.shape[s.rank-1]:s.shape[s.rank-2],c=t?o.shape[o.rank-1]:o.shape[o.rank-2],d=r?s.shape[s.rank-2]:s.shape[s.rank-1],p=o.shape.slice(0,-2),m=s.shape.slice(0,-2),y=st(p),w=st(m);X(o.rank>=2&&s.rank>=2&&o.rank===s.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+s.rank+"."}),X(ai(p,m),function(){return"Error in matMul: outer dimensions ("+p+") and ("+m+") of Tensors with shapes "+o.shape+" and "+s.shape+" must match."}),X(a===u,function(){return"Error in matMul: inner shapes ("+a+") and ("+u+") of Tensors with shapes "+o.shape+" and "+s.shape+" and transposeA="+t+" and transposeB="+r+" must match."});var C=o.shape.slice(0,-2).concat([c,d]),_=t?o.as3D(y,a,c):o.as3D(y,c,a),A=r?s.as3D(w,d,u):s.as3D(w,u,d);return Z.runKernelFunc(function(N,M){var O=N.batchMatMul(_,A,t,r);return M([_,A]),O},{a:_,b:A},function(N,M){var L=M[0],V=M[1];return t||r?!t&&r?{a:function(){return N.matMul(V,!1,!1)},b:function(){return N.matMul(L,!0,!1)}}:t&&!r?{a:function(){return V.matMul(N,!1,!0)},b:function(){return L.matMul(N,!1,!1)}}:{a:function(){return V.matMul(N,!0,!0)},b:function(){return N.matMul(L,!0,!0)}}:{a:function(){return N.matMul(V,!1,!0)},b:function(){return L.matMul(N,!0,!1)}}},"BatchMatMul",{transposeA:t,transposeB:r}).reshape(C)}}),fK=J({dot_:function(n,e){var t=H(n,"t1","dot"),r=H(e,"t2","dot");X(!(1!==t.rank&&2!==t.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+r.rank+"."});var i=1===t.rank?t.size:t.shape[1],o=1===r.rank?r.size:r.shape[0];return X(i===o,function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."}),1===t.rank&&1===r.rank?t.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===t.rank&&2===r.rank?t.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===t.rank&&1===r.rank?t.matMul(r.as2D(-1,1)).as1D():t.matMul(r.as2D(r.shape[0],r.shape[1]))}}),pK=J({outerProduct_:function(n,e){var t=H(n,"v1","outerProduct"),r=H(e,"v2","outerProduct");return X(1===t.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+r.rank+"."}),t.as2D(-1,1).matMul(r.as2D(1,-1))}}),Rp=J({reverse_:function(n,e){var t=H(n,"x","reverse");if(0===t.rank)return t.clone();var r=ui(e,t.shape);return Z.runKernelFunc(function(i){return i.reverse(t,r)},{$x:t},function(i){return{$x:function(){return i.reverse(r)}}}).reshapeAs(t)}}),gK=J({reverse1d_:function(n){var e=H(n,"x","reverse");return X(1===e.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),Rp(e,0)}}),mK=J({reverse2d_:function(n,e){var t=H(n,"x","reverse");return X(2===t.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),Rp(t,e)}}),vK=J({reverse3d_:function(n,e){var t=H(n,"x","reverse");return X(3===t.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),Rp(t,e)}}),yK=J({reverse4d_:function(n,e){var t=H(n,"x","reverse");return X(4===t.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),Rp(t,e)}});function TN(n,e,t,r,i,o){var s=H(n,"x","maxPool"),a=s,u=!1;3===s.rank&&(u=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),null==r&&(r=[1,1]),X(4===a.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+a.rank+"."}),X(Eo(t,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"}),null!=o&&X(Rr(i),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var c=ud(a.shape,e,t,r,i,o);if(1===c.filterWidth&&1===c.filterHeight&&ai(c.inShape,c.outShape))return s.clone();var p=Z.runKernelFunc(function(m,y){var w=m.maxPool(a,c);return y([a,w]),w},{x:a},function(m,y){var w=y[0],C=y[1];return{x:function(){return function(_,A,T,N,M,O,L,V){var j=H(_,"dy","maxPoolBackprop"),U=H(A,"input","maxPoolBackprop"),G=H(T,"output","maxPoolBackprop");X(U.rank===j.rank,function(){return"Rank of input ("+U.rank+") does not match rank of dy ("+j.rank+")"}),null==O&&(O=[1,1]),X(Eo(M,O),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+M+" and dilations '"+O+"'"}),X(4===j.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+j.rank+"."}),X(4===U.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+U.rank+"."});var K=ud(U.shape,N,M,O,L,void 0);return Z.runKernelFunc(function($){return $.maxPoolBackprop(j,U,G,K)},{$dy:j,$input:U})}(m,w,C,e,t,r,i)}}},"MaxPool",c,[a]);return u?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function MN(n,e,t,r,i,o){var s=H(n,"x","avgPool","float32");null==r&&(r=[1,1]),X(Eo(t,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"});var a=s,u=!1;3===s.rank&&(u=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),X(4===a.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+a.rank+"."}),null!=o&&X(Rr(i),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var c=ud(a.shape,e,t,r,i,o);if(1===c.filterWidth&&1===c.filterHeight&&ai(c.inShape,c.outShape))return s.clone();var d=Z.runKernelFunc(function(p){return p.avgPool(a,c)},{x:a},function(p){return{x:function(){return function(m,y,w,C,_,A){var T=H(m,"dy","avgPoolBackprop"),N=H(y,"input","avgPoolBackprop");X(N.rank===T.rank,function(){return"Rank of input ("+N.rank+") does not match rank of dy ("+T.rank+")"}),null==_&&(_=[1,1]),X(Eo(C,_),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+C+" and dilations '"+_+"'"});var M=N,O=T,L=!1;3===N.rank&&(L=!0,M=N.as4D(1,N.shape[0],N.shape[1],N.shape[2]),O=T.as4D(1,T.shape[0],T.shape[1],T.shape[2])),X(4===O.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+O.rank+"."}),X(4===M.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+M.rank+"."});var V=ud(M.shape,w,C,_,A),j=Z.runKernelFunc(function(U){return U.avgPoolBackprop(O,M,V)},{dy4D:O,input4D:M});return L?j.as3D(j.shape[1],j.shape[2],j.shape[3]):j}(p,a,e,t,r,i)}}},"AvgPool",c);return d=d.cast(s.dtype),u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}var Pi=J({maxPool_:function(n,e,t,r,i){return TN(n,e,t,1,r,i)}}),Np=J({avgPool_:function(n,e,t,r,i){return MN(n,e,t,1,r,i)}}),xK=J({pool_:function(n,e,t,r,i,o){null==i&&(i=[1,1]),null==o&&(o=1),0===r&&(r="valid");var s=H(n,"x","maxPool"),a=s,u=!1;3===s.rank&&(u=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),X(Eo(o,i),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"});var c,O,L,V,j,d=ud(a.shape,e,o,i,r),p=[d.dilationHeight,d.dilationWidth];c="same"===r?(O=p,L=[d.filterHeight,d.filterWidth].map(function(U,G){return U+(U-1)*(O[G]-1)}).map(function(U){return U-1}),V=L.map(function(U){return Math.floor(U/2)}),j=L.map(function(U,G){return U-V[G]}),L.map(function(U,G){return[V[G],j[G]]})):[[0,0],[0,0]];var m=1===p[0]&&1===p[1],y=function(M,O,L){var V=L.map(function(de){return de[0]}),j=L.map(function(de){return de[1]}),U=M.concat(V,j),G=O.map(function(de,se){return(de-U[se]%de)%de}),K=j.map(function(de,se){return de+G[se]});return[O.map(function(de,se){return[V[se],K[se]]}),O.map(function(de,se){return[0,G[se]]})]}([d.inHeight,d.inWidth],p,c),C=y[1],_=m?r:"valid",A=m?a:JR(a,p,y[0]),T=("avg"===t?function(){return MN(A,e,o,1,_)}:function(){return TN(A,e,o,1,_)})(),N=m?T:KR(T,p,C);return u?N.as3D(N.shape[1],N.shape[2],N.shape[3]):N}}),bK=J({maxPool3d_:function(n,e,t,r,i,o,s){void 0===o&&(o="NDHWC");var a=H(n,"x","maxPool3d"),u=a,c=!1;4===a.rank&&(c=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),null==s&&(s=[1,1,1]),X(5===u.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),X("NDHWC"===o,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),X(Eo(t,s),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+s+"'"}),null!=i&&X(Rr(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var d=Ep(u.shape,e,t,s,r,i,o),p=Z.runKernelFunc(function(m,y){var w=m.maxPool3d(u,d);return y([u,w]),w},{x:u},function(m,y){var w=y[0],C=y[1];return{x:function(){return function(_,A,T,N,M,O,L,V){var j=H(_,"dy","maxPool3dBackprop"),U=H(A,"input","maxPool3dBackprop"),G=H(T,"output","maxPool3dBackprop"),K=j,$=U,he=G,de=!1;4===U.rank&&(de=!0,K=j.as5D(1,j.shape[0],j.shape[1],j.shape[2],j.shape[3]),$=U.as5D(1,U.shape[0],U.shape[1],U.shape[2],U.shape[3]),he=G.as5D(1,G.shape[0],G.shape[1],G.shape[2],G.shape[3])),X(5===K.rank,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+K.rank+"."}),X(5===$.rank,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+$.rank+"."}),X(5===he.rank,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+he.rank+"."}),null==O&&(O=[1,1,1]),X(Eo(M,O),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+M+" and dilations '"+O+"'"}),null!=V&&X(Rr(L),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+V+" but got pad "+L+"."});var se=Ep($.shape,N,M,O,L,V),fe=Z.runKernelFunc(function(we){return we.maxPool3dBackprop(K,$,he,se)},{dy5D:K,input5D:$});return de?fe.as4D(fe.shape[1],fe.shape[2],fe.shape[3],fe.shape[4]):fe}(m,w,C,e,t,s,r,i)}}});return c?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),wK=J({avgPool3d_:function(n,e,t,r,i,o,s){void 0===o&&(o="NDHWC");var a=H(n,"x","avgPool3d","float32"),u=a,c=!1;4===a.rank&&(c=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),null==s&&(s=[1,1,1]),X(5===u.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),X("NDHWC"===o,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),X(Eo(t,s),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+s+"'"}),null!=i&&X(Rr(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var d=Ep(u.shape,e,t,s,r,i,o),p=Z.runKernelFunc(function(m){return m.avgPool3d(u,d)},{x:u},function(m){return{x:function(){return function(y,w,C,_,A,T,N){var M=H(y,"dy","avgPool3dBackprop"),O=H(w,"input","avgPool3dBackprop"),L=M,V=O,j=!1;4===O.rank&&(j=!0,L=M.as5D(1,M.shape[0],M.shape[1],M.shape[2],M.shape[3]),V=O.as5D(1,O.shape[0],O.shape[1],O.shape[2],O.shape[3])),X(5===L.rank,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+L.rank+"."}),X(5===V.rank,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+V.rank+"."}),null==A&&(A=[1,1,1]),X(Eo(_,A),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+_+" and dilations '"+A+"'"}),null!=N&&X(Rr(T),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+N+" but got pad "+T+"."});var U=Ep(V.shape,C,_,A,T,N),G=Z.runKernelFunc(function(K){return K.avgPool3dBackprop(L,V,U)},{dy5D:L,input5D:V});return j?G.as4D(G.shape[1],G.shape[2],G.shape[3],G.shape[4]):G}(m,u,e,t,s,r,i)}}});return p=p.cast(u.dtype),c?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),Ya=J({slice_:function(n,e,t){var r,i,o=H(n,"x","slice");if(0===o.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof e?[e].concat(new Array(o.rank-1).fill(0)):e.length<o.rank?e.concat(new Array(o.rank-e.length).fill(0)):e.slice()).forEach(function(u){X(-1!==u,function(){return"slice() does not support negative begin indexing."})}),i=(i=null==t?new Array(o.rank).fill(-1):"number"==typeof t?[t].concat(new Array(o.rank-1).fill(-1)):t.length<o.rank?t.concat(new Array(o.rank-t.length).fill(-1)):t).map(function(u,c){return u>=0?u:(X(-1===u,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+c+"."}),o.shape[c]-r[c])}),o3(o,r,i);var s=o.shape;return Z.runKernelFunc(function(u){return u.slice(o,r,i)},{x:o},function(u){for(var c=[],d=0;d<u.rank;d++)c.push([r[d],s[d]-r[d]-i[d]]);return{x:function(){return u.pad(c)}}},"Slice",{begin:r,size:i})}}),_K=J({slice1d_:function(n,e,t){var r=H(n,"x","slice1d");return X(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),Ya(r,[e],[t])}}),CK=J({slice2d_:function(n,e,t){var r=H(n,"x","slice2d");return X(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),Ya(r,e,t)}}),RN=J({slice3d_:function(n,e,t){var r=H(n,"x","slice3d");return X(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),Ya(r,e,t)}}),EK=J({slice4d_:function(n,e,t){var r=H(n,"x","slice4d");return X(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),Ya(r,e,t)}});function NN(n,e,t,r,i){return e.rank<t.rank&&(e=e.reshape(Co(e.shape,r))),n.rank<t.rank&&(n=n.reshape(Co(n.shape,r))),{x:function(){var o=n.mul(t.equal(e).cast(n.dtype));return null==i?o:o.transpose(i)}}}var IK=J({all_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=H(n,"x","all","bool"),i=ui(e,r.shape),o=i,s=aa(o,r.rank);null!=s&&(r=r.transpose(s),o=ua(o.length,r.rank));var a=Z.runKernelFunc(function(c){return c.all(r,o)},{$x:r});if(t){var u=Co(a.shape,i);return a.reshape(u)}return a}}),AK=J({any_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=H(n,"x","any","bool"),i=ui(e,r.shape),o=i,s=aa(o,r.rank);null!=s&&(r=r.transpose(s),o=ua(o.length,r.rank));var a=Z.runKernelFunc(function(c){return c.any(r,o)},{$x:r});if(t){var u=Co(a.shape,i);return a.reshape(u)}return a}}),DK=J({argMax_:function(n,e){void 0===e&&(e=0);var t=H(n,"x","argMax");null==e&&(e=0);var r=ui(e,t.shape),i=aa(r,t.rank);return null!=i&&(t=t.transpose(i),r=ua(r.length,t.rank)),Z.runKernelFunc(function(a,u){var c=a.argMax(t,r[0]);return u([t]),c},{x:t},function(a,u){var c=u[0];return{x:function(){return Nn(c)}}},"ArgMax",{axis:r[0]},[t])}}),SK=J({argMin_:function(n,e){void 0===e&&(e=0);var t=H(n,"x","argMin");null==e&&(e=0);var r=ui(e,t.shape),i=aa(r,t.rank);return null!=i&&(t=t.transpose(i),r=ua(r.length,t.rank)),Z.runKernelFunc(function(o,s){var a=o.argMin(t,r[0]);return s([t]),a},{$x:t},function(o,s){var a=s[0];return{$x:function(){return Nn(a)}}})}}),TK=J({logSumExp_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=H(n,"x","logSumExp"),i=ui(e,r.shape),o=r.max(i,!0),s=r.sub(o).exp().sum(i).log(),a=o.reshape(s.shape).add(s);if(t){var u=Co(a.shape,i);return a.reshape(u)}return a}}),q1=J({max_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=H(n,"x","max"),i=r,o=ui(e,r.shape),s=o,a=aa(s,r.rank);null!=a&&(r=r.transpose(a),s=ua(s.length,r.rank));var c=Z.runKernelFunc(function(p,m){var y=p.max(r,s);return m([i,y]),y},{x:r},function(p,m){return NN(p,m[1],m[0],o,a)},"Max",{axes:s},[r],[!0]);if(t){var d=Co(c.shape,o);c=c.reshape(d)}return c}}),MK=J({mean_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=H(n,"x","mean"),i=ui(e,r.shape),o=st(Gi(r.shape,i)[1]);return N1(function(s){var a=Ue(o);return{value:(a.dtype===s.dtype?s:s.cast(a.dtype)).div(a).sum(e,t),gradFunc:function(u){var c=s.shape.slice();return i.forEach(function(d){c[d]=1}),u.reshape(c).mul(sd(s.shape,"float32")).div(o)}}})(r)}}),RK=J({min_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=H(n,"x","min"),i=r,o=ui(e,r.shape),s=o,a=aa(s,r.rank);null!=a&&(r=r.transpose(a),s=ua(s.length,r.rank));var c=Z.runKernelFunc(function(p,m){var y=p.min(r,s);return m([i,y]),y},{x:r},function(p,m){return NN(p,m[1],m[0],o,a)},"Min",{axes:s},[r],[!0]);if(t){var d=Co(c.shape,o);c=c.reshape(d)}return c}}),NK=J({moments_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=ui(e,(n=H(n,"x","moments")).shape),i=n.mean(r,t),o=i.shape;t||(o=Co(i.shape,r));var s=n.toFloat().sub(i.reshape(o)).square();return{mean:i,variance:s.mean(r,t)}}}),ON=J({sum_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=H(n,"x","sum");"bool"===r.dtype&&(r=r.toInt());var i=ui(e,r.shape);return N1(function(o){var s=aa(i,o.rank),a=i,u=o;null!=s&&(u=o.transpose(s),a=ua(a.length,o.rank));var c=function(y){var w=o.shape.slice();return i.forEach(function(C){w[C]=1}),y.reshape(w).mul(sd(o.shape,"float32"))},p=Z.runKernelFunc(function(y){return y.sum(u,a)},{x:u},function(y){return{x:function(){return c(y)}}},"Sum",{axes:a});if(t){var m=Co(p.shape,i);p=p.reshape(m)}return{value:p,gradFunc:c}})(r)}}),OK=J({prod_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=H(n,"x","prod");"bool"===r.dtype&&(r=r.toInt());var i=ui(e,r.shape),o=aa(i,r.rank),s=i,a=r;null!=o&&(a=r.transpose(o),s=ua(s.length,r.rank));var u=Z.runKernelFunc(function(d){return d.prod(a,s)},{permutedX:a});if(t){var c=Co(u.shape,i);u=u.reshape(c)}return u}}),kN=J({elu_:function(n){var e=H(n,"x","elu");return Z.runKernelFunc(function(t,r){var i=t.elu(e);return r([i]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return Z.runKernelFunc(function(o){return o.eluDer(t,i)},{dy:t,y:i})}}})}}),kK=J({leakyRelu_:function(n,e){void 0===e&&(e=.2);var t=H(n,"x","leakyRelu");return kw(Ue(e).mul(t),t)}}),PN=J({prelu_:function(n,e){var t=H(n,"x","prelu"),r=H(e,"alpha","prelu");return Z.runKernelFunc(function(i,o){var s=i.prelu(t,r);return o([t,r]),s},{x:t,alpha:r},function(i,o){var s=o[0],a=o[1],u=s.greater(0);return{x:function(){return Il(u,i,i.mul(a))},alpha:function(){var c=Il(u,Nn(i),i.mul(s)),d=li(a.shape,i.shape);return d.length>0&&(c=c.sum(d)),c.reshape(a.shape)}}},"Prelu")}}),Nr=J({relu_:function(n){var e=H(n,"x","relu");return"bool"===e.dtype?e.toInt():Z.runKernelFunc(function(t,r){var i=t.relu(e);return r([e]),i},{x:e},function(t,r){var i=r[0];return{x:function(){return t.mulStrict(i.step().toFloat())}}},"Relu")}}),FN=J({relu6_:function(n){var e=H(n,"x","relu6");return"bool"===e.dtype?e.toInt():Z.runKernelFunc(function(t,r){var i=t.relu6(e);return r([e]),i},{x:e},function(t,r){var i=r[0],o=i.lessEqual(6).mul(i.step());return{x:function(){return t.mulStrict(o.toFloat())}}},"Relu6")}}),PK=J({selu_:function(n){var e=H(n,"x","selu");return Z.runKernelFunc(function(t,r){var i=t.selu(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){var o=i.greater(Ue(0)),s=Ue(1.7580993408473768),a=Ue(1.0507009873554805),u=t.mul(a),c=t.mul(s).mul(i.toFloat().exp());return Il(o,u,c)}}})}}),Ic=J({transpose_:function(n,e){var t=H(n,"x","transpose");return null==e&&(e=t.shape.map(function(i,o){return o}).reverse()),X(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."}),e.forEach(function(i){X(i>=0&&i<t.rank,function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e})}),t.rank<=1?t.clone():Z.runKernelFunc(function(i){return i.transpose(t,e)},{x:t},function(i){var o=E1(e);return{x:function(){return i.transpose(o)}}},"Transpose",{perm:e})}}),FK=J({localResponseNormalization_:function(n,e,t,r,i){void 0===e&&(e=5),void 0===t&&(t=1),void 0===r&&(r=1),void 0===i&&(i=.5);var o=H(n,"x","localResponseNormalization");X(4===o.rank||3===o.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+o.rank+"."}),X(Rr(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var s=o,a=!1;3===o.rank&&(a=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var u=Z.runKernelFunc(function(c,d){var p=c.localResponseNormalization4D(s,e,t,r,i);return d([s,p]),p},{x4D:s},function(c,d){var p=d[0],m=d[1];return{x4D:function(){return Z.runKernelFunc(function(y){return y.LRNGrad(c,p,m,e,t,r,i)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),LN=J({norm_:function(n,e,t,r){void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===r&&(r=!1);var i=function a(u,c,d){if(void 0===d&&(d=null),0===u.rank)return u.abs();if(1!==u.rank&&null===d)return a(u.reshape([-1]),c,d);if(1===u.rank||"number"==typeof d||Array.isArray(d)&&1===d.length){if(1===c)return u.abs().sum(d);if(c===1/0)return u.abs().max(d);if(c===-1/0)return u.abs().min(d);if("euclidean"===c||2===c)return u.abs().pow(Ue(2,"int32")).sum(d).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}if(Array.isArray(d)&&2===d.length){if(1===c)return u.abs().sum(d[0]).max(d[1]-1);if(c===1/0)return u.abs().sum(d[1]).max(d[0]);if(c===-1/0)return u.abs().sum(d[1]).min(d[0]);if("fro"===c||"euclidean"===c)return u.square().sum(d).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}throw new Error("Error in norm: invalid axis: "+d)}(n=H(n,"x","norm"),e,t),o=i.shape;if(r){var s=ui(t,n.shape);o=Co(i.shape,s)}return i.reshape(o)}}),LK=J({basicLSTMCell_:function(n,e,t,r,i,o){var s=H(n,"forgetBias","basicLSTMCell"),a=H(e,"lstmKernel","basicLSTMCell"),u=H(t,"lstmBias","basicLSTMCell"),c=H(r,"data","basicLSTMCell"),d=H(i,"c","basicLSTMCell"),p=H(o,"h","basicLSTMCell"),m=c.concat(p,1).matMul(a).add(u),w=m.shape[1]/4,C=[m.shape[0],w],_=m.slice([0,0],C),A=m.slice([0,w],C),T=m.slice([0,2*w],C),N=m.slice([0,3*w],C),M=_.sigmoid().mulStrict(A.tanh()).addStrict(d.mulStrict(s.add(T).sigmoid())),O=M.tanh().mulStrict(N.sigmoid());return[M,O]}}),BK=J({multiRNNCell_:function(n,e,t,r){for(var i=H(e,"data","multiRNNCell"),o=_p(t,"c","multiRNNCell"),s=_p(r,"h","multiRNNCell"),a=i,u=[],c=0;c<n.length;c++){var d=n[c](a,o[c],s[c]);u.push(d[0]),u.push(d[1]),a=d[1]}var p=[],m=[];for(c=0;c<u.length;c+=2)p.push(u[c]),m.push(u[c+1]);return[p,m]}}),VK=J({movingAverage_:function(n,e,t,r,i){void 0===i&&(i=!0);var o=H(n,"v","movingAverage"),s=H(e,"x","movingAverage"),a=H(t,"decay","movingAverage");vR(o,s),X(ai(o.shape,s.shape),function(){return"Shape mismatch in v and x"});var u=Ue(1),c=u.sub(a),d=s.sub(o).mul(c);if(i){X(null!=r,function(){return"When using zeroDebias: true, step is required."});var p=H(r,"step","movingAverage");d=d.div(u.sub(G1(a,p)))}return o.add(d)}}),UK=J({stridedSlice_:function(n,e,t,r,i,o,s,a,u){if(void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===u&&(u=0),null==r&&(r=new Array(e.length)),0!==s)throw new Error("ellipsis mask is not yet supported");var c=H(n,"x","stridedSlice"),d=dw(a),p=c.shape.slice();d.forEach(function(_){e[_]=0,t[_]=1,p.splice(_,0,1)}),c=c.reshape(p);for(var m=0;m<c.rank;m++)e[m]=s3(i,e,r,c.shape,m),t[m]=a3(o,t,r,c.shape,m),r[m]=r[m]||1;var y=dw(u);y.forEach(function(_){t[_]=e[_]+1,r[_]=1});var w=R1(e,t,r),C=w.filter(function(_,A){return-1===y.indexOf(A)});return r.every(function(_){return 1===_})?Ya(c,e,w).reshape(C):Z.runKernelFunc(function(_){return _.stridedSlice(c,e,t,r)},{$x:c}).reshape(C)}}),jK=J({topk_:function(n,e,t){void 0===e&&(e=1),void 0===t&&(t=!0);var r=H(n,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(e>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+e);var o=Z.runKernelFunc(function(s){return s.topk(r,e,t)},{$x:r});return{values:o[0],indices:o[1]}}}),WK=J({scatterND_:function(n,e,t){var r=H(n,"indices","scatterND","int32"),i=H(e,"updates","scatterND");return i3(i,r,t),Z.runKernelFunc(function(o){return o.scatterND(r,i,t)},{indices:r,updates:i},null,"ScatterNd",{shape:t})}}),Vw=J({fft_:function(n){X("complex64"===n.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],r=n.as2D(n.size/e,e);return Z.runKernelFunc(function(i){return i.fft(r)},{input:n}).reshape(n.shape)}}),$1=J({ifft_:function(n){X("complex64"===n.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],r=n.as2D(n.size/e,e);return Z.runKernelFunc(function(i){return i.ifft(r)},{input:n}).reshape(n.shape)}}),Uw=J({rfft_:function(n,e){X("float32"===n.dtype,function(){return"The dtype for rfft() must be real value but got "+n.dtype});var t,r=n.shape[n.shape.length-1],i=n.size/r;if(null!=e&&e<r){var o=n.shape.map(function(A){return 0}),s=n.shape.map(function(A){return A});s[n.shape.length-1]=e,t=n.slice(o,s),r=e}else if(null!=e&&e>r){var a=n.shape.map(function(A){return A});a[n.shape.length-1]=e-r,t=n.concat(xr(a),n.shape.length-1),r=e}else t=n;var u=t.zerosLike(),c=Yi(t,u).as2D(i,r),d=Vw(c),p=Math.floor(r/2)+1,m=vs(d),y=za(d),w=m.split([p,r-p],m.shape.length-1),C=y.split([p,r-p],y.shape.length-1),_=t.shape.slice();return _[t.shape.length-1]=p,Yi(w[0],C[0]).reshape(_)}}),BN=J({irfft_:function(n){var e=n.shape[n.shape.length-1],t=n.size/e;if(e<=2){var r=n.as2D(t,e),i=$1(r);return vs(i)}var o=[t,2*(e-1)],s=vs(n).as2D(t,e),a=za(n).as2D(t,e),u=s.slice([0,1],[t,e-2]).reverse(1),c=a.slice([0,1],[t,e-2]).reverse(1).mul(Ue(-1)),d=s.concat(u,1),p=a.concat(c,1);return r=Yi(d,p).as2D(o[0],o[1]),i=$1(r),vs(i)}}),HK=Object.freeze({fft:Vw,ifft:$1,rfft:Uw,irfft:BN}),zK=J({sparseToDense_:function(n,e,t,r){void 0===r&&(r=0);var i=H(n,"sparseIndices","sparseToDense","int32"),o=H(e,"sparseValues","sparseToDense"),s=H(r,"defaultValue","sparseToDense",o.dtype);return function(a,u,c,d){if("int32"!==a.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+a.dtype+".");if(a.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+a.shape+".");var p=a.rank>0?a.shape[0]:1,m=a.rank>1?a.shape[1]:1;if(c.length!==m)throw new Error("outputShape has incorrect number of elements:, "+c.length+", should be: "+m+".");if(0!==u.rank&&(1!==u.rank||u.size!==p))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+p+"]");if(u.dtype!==d.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,o,t,s),Z.runKernelFunc(function(a){return a.sparseToDense(i,o,t,s)},{$sparseIndices:i,$sparseValues:o,$defaultValue:s})}}),GK=J({gatherND_:function(n,e){var t=H(e,"indices","gatherND","int32"),r=H(n,"x","gatherND");return Z.runKernelFunc(function(i){return i.gatherND(r,t)},{x:r,indices:t},null,"GatherNd")}}),YK=J({diag_:function(n){var e=H(n,"x","diag").flatten(),t=n.shape.concat(n.shape);return Z.runKernelFunc(function(r){return r.diag(e)},{$x:e}).reshape(t)}}),XK=J({dropout_:function(n,e,t,r){var i=H(n,"x","dropout");if(X("float32"===i.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."}),X(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),0===e)return n instanceof or?i.clone():i;var o=function(u,c){if(null==c)return u.shape.slice();if(ai(u.shape,c))return c;if(u.shape.length===c.length){for(var d=[],p=0;p<u.shape.length;p++)d.push(null==c[p]&&null!=u.shape[p]?u.shape[p]:c[p]);return d}return c}(i,t),s=1-e,a=ZR(o,0,1,"float32",r).add(s).floor().div(s);return i.mul(a)}});function VN(n,e,t){for(var r=1-n%2,i=new Float32Array(n),o=0;o<n;++o){var s=2*Math.PI*o/(n+r-1);i[o]=e-t*Math.cos(s)}return ci(i,"float32")}var so,jw=J({hannWindow_:function(n){return VN(n,.5,.5)}}),UN=J({hammingWindow_:function(n){return VN(n,.54,.46)}}),Ww=J({frame_:function(n,e,t,r,i){void 0===r&&(r=!1),void 0===i&&(i=0);for(var o=0,s=[];o+e<=n.size;)s.push(Ya(n,o,e)),o+=t;if(r)for(;o<n.size;){var a=o+e-n.size,u=_i([Ya(n,o,e-a),Ga([a],i)]);s.push(u),o+=t}return 0===s.length?Cc([],[0,e]):_i(s).as2D(s.length,e)}}),jN=J({stft_:function(n,e,t,r,i){void 0===i&&(i=jw),null==r&&(r=Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2)))));for(var s=Ww(n,e,t),a=oo(s,i(e)),u=[],c=0;c<s.shape[0];c++)u.push(Uw(a.slice([c,0],[1,e]),r));return _i(u)}}),qK=Object.freeze({hannWindow:jw,hammingWindow:UN,frame:Ww,stft:jN});!function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(so||(so={}));var KK=J({absoluteDifference_:function(n,e,t,r){void 0===r&&(r=so.SUM_BY_NONZERO_WEIGHTS);var i=H(n,"labels","absoluteDifference"),o=H(e,"predictions","absoluteDifference"),s=null;null!=t&&(s=H(t,"weights","absoluteDifference")),Rn(i.shape,o.shape,"Error in absoluteDifference: ");var a=i.sub(o).abs();return Du(a,s,r)}}),Du=J({computeWeightedLoss_:function(n,e,t){void 0===t&&(t=so.SUM_BY_NONZERO_WEIGHTS);var r=H(n,"losses","computeWeightedLoss"),i=null;null!=e&&(i=H(e,"weights","computeWeightedLoss"));var o=null==i?r:r.mul(i);if(t===so.NONE)return o;if(t===so.SUM)return o.sum();if(t===so.MEAN){if(null==i)return o.mean();var s=r.size/i.size,a=o.sum().div(i.sum());return s>1?a.div(Ue(s)):a}if(t===so.SUM_BY_NONZERO_WEIGHTS){if(null==i)return o.sum().div(Ue(r.size));var u=i.mul(sd(r.shape)).notEqual(Ue(0)).sum().toFloat();return o.sum().div(u)}throw Error("Unknown reduction: "+t)}}),QK=J({cosineDistance_:function(n,e,t,r,i){void 0===i&&(i=so.SUM_BY_NONZERO_WEIGHTS);var o=H(n,"labels","cosineDistance"),s=H(e,"predictions","cosineDistance"),a=null;null!=r&&(a=H(r,"weights","cosineDistance")),Rn(o.shape,s.shape,"Error in cosineDistance: ");var u=Ue(1).sub(o.mul(s).sum(t,!0));return Du(u,a,i)}}),ZK=J({hingeLoss_:function(n,e,t,r){void 0===r&&(r=so.SUM_BY_NONZERO_WEIGHTS);var i=H(n,"labels","hingeLoss"),o=H(e,"predictions","hingeLoss"),s=null;null!=t&&(s=H(t,"weights","hingeLoss")),Rn(i.shape,o.shape,"Error in hingeLoss: ");var a=Ue(1);i=Ue(2).mul(i).sub(a);var u=a.sub(i.mul(o)).relu();return Du(u,s,r)}}),JK=J({huberLoss_:function(n,e,t,r,i){void 0===r&&(r=1),void 0===i&&(i=so.SUM_BY_NONZERO_WEIGHTS);var o=H(n,"labels","huberLoss"),s=H(e,"predictions","huberLoss"),a=null;null!=t&&(a=H(t,"weights","huberLoss")),Rn(o.shape,s.shape,"Error in huberLoss: ");var u=Ue(r),c=s.sub(o).abs(),d=yN(c,u),p=c.sub(d),m=Ue(.5).mul(d.square()).add(u.mul(p));return Du(m,a,i)}}),eQ=J({logLoss_:function(n,e,t,r,i){void 0===r&&(r=1e-7),void 0===i&&(i=so.SUM_BY_NONZERO_WEIGHTS);var o=H(n,"labels","logLoss"),s=H(e,"predictions","logLoss"),a=null;null!=t&&(a=H(t,"weights","logLoss")),Rn(o.shape,s.shape,"Error in logLoss: ");var u=Ue(1),c=Ue(r),d=o.mul(s.add(c).log()).neg().sub(u.sub(o).mul(u.sub(s).add(c).log()));return Du(d,a,i)}}),tQ=J({meanSquaredError_:function(n,e,t,r){void 0===r&&(r=so.SUM_BY_NONZERO_WEIGHTS);var i=H(n,"labels","meanSquaredError"),o=H(e,"predictions","meanSquaredError"),s=null;null!=t&&(s=H(t,"weights","meanSquaredError")),Rn(i.shape,o.shape,"Error in meanSquaredError: ");var a=i.squaredDifference(o);return Du(a,s,r)}}),nQ=J({sigmoidCrossEntropy_:function(n,e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=so.SUM_BY_NONZERO_WEIGHTS);var o=H(n,"multiClassLabels","sigmoidCrossEntropy"),s=H(e,"logits","sigmoidCrossEntropy"),a=null;if(null!=t&&(a=H(t,"weights","sigmoidCrossEntropy")),Rn(o.shape,s.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Ue(r),c=Ue(1),d=Ue(.5);o=o.mul(c.sub(u)).add(d.mul(u))}var p=function(m,y){var w=H(m,"labels","sigmoidCrossEntropyWithLogits"),C=H(y,"logits","sigmoidCrossEntropyWithLogits");Rn(w.shape,C.shape,"Error in sigmoidCrossEntropyWithLogits: ");var _=C.relu(),A=C.mul(w),T=C.abs().neg().exp().log1p();return _.sub(A).add(T)}(o,s);return Du(p,a,i)}}),rQ=J({softmaxCrossEntropy_:function(n,e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=so.SUM_BY_NONZERO_WEIGHTS);var o=H(n,"onehotLabels","softmaxCrossEntropy"),s=H(e,"logits","softmaxCrossEntropy"),a=null;if(null!=t&&(a=H(t,"weights","softmaxCrossEntropy")),Rn(o.shape,s.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Ue(r),c=Ue(1),d=Ue(o.shape[1]);o=o.mul(c.sub(u)).add(u.div(d))}var p=function(m,y,w){if(void 0===w&&(w=-1),-1===w&&(w=y.rank-1),w!==y.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+y.rank+" and dim was "+w);return N1(function(C,_,A){var T=_.logSumExp([w],!0),N=_.toFloat().sub(T);return A([C,N]),{value:N.mul(C).neg().sum([w]),gradFunc:function(M,O){var L=O[0],V=O[1],j=Co(M.shape,[w]);return[M.reshape(j).mul(L.toFloat().sub(V.exp())),M.reshape(j).mul(V.exp().sub(L.toFloat()))]}}})(m,y)}(o,s);return Du(p,a,i)}}),iQ=Object.freeze({get Reduction(){return so},absoluteDifference:KK,computeWeightedLoss:Du,cosineDistance:QK,hingeLoss:ZK,huberLoss:JK,logLoss:eQ,meanSquaredError:tQ,sigmoidCrossEntropy:nQ,softmaxCrossEntropy:rQ});function WN(n,e){return void 0===e&&(e=!1),Z.tidy(function(){if(2!==n.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var t=n.shape[0],r=n.shape[1],i=QR(t),o=n.clone(),s=Cc([[1]],[1,1]),a=s.clone(),u=t>=r?r:t,c=function(p){var m,y=o,w=a,C=i;m=Z.tidy(function(){var _=o.slice([p,p],[t-p,1]),A=_.norm(),T=o.slice([p,p],[1,1]),N=Cc([[-1]]).where(T.greater(0),Cc([[1]])),M=T.sub(N.mul(A)),O=_.div(M);a=1===O.shape[0]?s.clone():s.concat(O.slice([1,0],[O.shape[0]-1,O.shape[1]]),0);var L=N.matMul(M).div(A).neg(),V=o.slice([p,0],[t-p,r]),j=L.mul(a);if(0===p)o=V.sub(j.matMul(a.transpose().matMul(V)));else{var U=V.sub(j.matMul(a.transpose().matMul(V)));o=o.slice([0,0],[p,r]).concat(U,0)}var G=i.slice([0,p],[t,i.shape[1]-p]);if(0===p)i=G.sub(G.matMul(a).matMul(j.transpose()));else{var K=G.sub(G.matMul(a).matMul(j.transpose()));i=i.slice([0,0],[t,p]).concat(K,1)}return[a,o,i]}),a=m[0],o=m[1],i=m[2],Oo([y,w,C])},d=0;d<u;++d)c(d);return!e&&t>r&&(i=i.slice([0,0],[t,r]),o=o.slice([0,0],[r,r])),[i,o]})}var oQ=J({bandPart_:function(n,e,t){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(t%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+t+".");var r=H(n,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var i=r.shape,o=r.shape.slice(-2),s=o[0],a=o[1];if(!(e<=s))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+s+").");if(!(t<=a))throw new Error("bandPart(): numUpper ("+t+") must not be greater than the number of columns ("+a+").");e<0&&(e=s),t<0&&(t=a);var u=I1(0,s,1,"int32").reshape([-1,1]),c=I1(0,a,1,"int32"),d=Ei(u,c),p=z1(d.lessEqual(Ue(+e,"int32")),d.greaterEqual(Ue(-t,"int32"))),m=xr([s,a],r.dtype);return ns(Ci(r.reshape([-1,s,a])).map(function(y){return Il(p,y,m)})).reshape(i)}}),sQ=J({gramSchmidt_:function(n){var e;if(Array.isArray(n)){e=!1,X(null!=n&&n.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=n[0].shape[0],r=function(u){X(n[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[u].shape[0]+" vs. "+t+")"})},i=1;i<n.length;++i)r(i)}else e=!0,n=aw(n,n.shape[0],0).map(function(u){return e3(u,[0])});X(n.length<=n[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."});var o=[],s=n,a=function(u){o.push(Z.tidy(function(){var c=s[u];if(u>0)for(var d=0;d<u;++d){var p=ON(o[d].mulStrict(c)).mul(o[d]);c=c.sub(p)}return c.div(LN(c,"euclidean"))}))};for(i=0;i<n.length;++i)a(i);return e?ns(o,0):o}}),aQ=J({qr_:function(n,e){if(void 0===e&&(e=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(2===n.rank)return WN(n,e);var t=n.shape.slice(0,n.shape.length-2).reduce(function(s,a){return s*a}),r=Ci(n.reshape([t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),i=[],o=[];return r.forEach(function(s){var a=WN(s,e),c=a[1];i.push(a[0]),o.push(c)}),[ns(i,0).reshape(n.shape),ns(o,0).reshape(n.shape)]}}),uQ=Object.freeze({bandPart:oQ,gramSchmidt:sQ,qr:aQ});function K1(n,e,t,r,i,o){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==o&&(o=0);var s=n.shape[0];return t=Math.min(t,s),X(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),X(2===n.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"}),X(4===n.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]}),X(1===e.rank,function(){return"scores must be a 1D tensor"}),X(e.shape[0]===s,function(){return"scores has incompatible shape with boxes. Expected "+s+", but was "+e.shape[0]}),X(0<=o&&o<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+o+"'"}),{maxOutputSize:t,iouThreshold:r,scoreThreshold:i,softNmsSigma:o}}var cQ=J({resizeBilinear_:function(n,e,t){void 0===t&&(t=!1);var r=H(n,"images","resizeBilinear");X(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),X(2===e.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var i=r,o=!1;3===r.rank&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=e[0],a=e[1],u=Z.runKernelFunc(function(c,d){return d([i]),c.resizeBilinear(i,s,a,t)},{x:i},function(c,d){return{x:function(){return Z.runKernelFunc(function(p){return p.resizeBilinearBackprop(c,d[0],t)},{})}}},"ResizeBilinear",{alignCorners:t,newHeight:s,newWidth:a});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),lQ=J({resizeNearestNeighbor_:function(n,e,t){void 0===t&&(t=!1);var r=H(n,"images","resizeNearestNeighbor");X(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),X(2===e.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),X("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var i=r,o=!1;3===r.rank&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=e[0],a=e[1],u=Z.runKernelFunc(function(c,d){return d([i]),c.resizeNearestNeighbor(i,s,a,t)},{batchImages:i},function(c,d){return{batchImages:function(){return Z.runKernelFunc(function(p){return p.resizeNearestNeighborBackprop(c,d[0],t)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),hQ=J({nonMaxSuppression_:function(n,e,t,r,i){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY);var o=H(n,"boxes","nonMaxSuppression"),s=H(e,"scores","nonMaxSuppression"),a=K1(o,s,t,r,i);return Z.runKernelFunc(function(c){return c.nonMaxSuppression(o,s,t,r,i)},{boxes:o,scores:s},null,"NonMaxSuppressionV3",{maxOutputSize:t=a.maxOutputSize,iouThreshold:r=a.iouThreshold,scoreThreshold:i=a.scoreThreshold})}}),fQ=J({nonMaxSuppressionWithScore_:function(n,e,t,r,i,o){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===o&&(o=0);var s=H(n,"boxes","nonMaxSuppression"),a=H(e,"scores","nonMaxSuppression"),u=K1(s,a,t,r,i,o),c={maxOutputSize:t=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:i=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},d=Z.runKernel("NonMaxSuppressionV5",{boxes:s,scores:a},c);return{selectedIndices:d[0],selectedScores:d[1]}}}),gQ=J({cropAndResize_:function(n,e,t,r,i,o){var s=H(n,"image","cropAndResize"),a=H(e,"boxes","cropAndResize","float32"),u=H(t,"boxInd","cropAndResize","int32");i=i||"bilinear",o=o||0;var c=a.shape[0];return X(4===s.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+s.rank+"."}),X(2===a.rank&&4===a.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+a.shape+"."}),X(1===u.rank&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+a.shape+"."}),X(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),X(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),X("bilinear"===i||"nearest"===i,function(){return"method must be bilinear or nearest, but was "+i}),Z.runKernelFunc(function(d,p){return d.cropAndResize(s,a,u,r,i,o)},{images:s,boxes:a,boxInd:u},null,"CropAndResize",{method:i,extrapolationValue:o,cropSize:r})}}),Hw=Object.freeze({resizeBilinear:cQ,resizeNearestNeighbor:lQ,nonMaxSuppression:hQ,nonMaxSuppressionAsync:function(n,e,t,r,i){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),tt(this,void 0,void 0,function(){var o,s,a,u,p;return nt(this,function(m){switch(m.label){case 0:return o=H(n,"boxes","nonMaxSuppressionAsync"),s=H(e,"scores","nonMaxSuppressionAsync"),a=K1(o,s,t,r,i),t=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return u=m.sent(),p=bw(u[0],u[1],t,r,i),o!==n&&o.dispose(),s!==e&&s.dispose(),[2,p]}})})},nonMaxSuppressionWithScore:fQ,nonMaxSuppressionWithScoreAsync:function(n,e,t,r,i,o){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===o&&(o=0),tt(this,void 0,void 0,function(){var s,a,u,c,m;return nt(this,function(y){switch(y.label){case 0:return s=H(n,"boxes","nonMaxSuppressionAsync"),a=H(e,"scores","nonMaxSuppressionAsync"),u=K1(s,a,t,r,i,o),t=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,o=u.softNmsSigma,[4,Promise.all([s.data(),a.data()])];case 1:return c=y.sent(),m=ww(c[0],c[1],t,r,i,o),s!==n&&s.dispose(),a!==e&&a.dispose(),[2,m]}})})},cropAndResize:gQ}),zw=function(n,e){return!(n>0)||"linear"===e},Gw=function(n,e,t){if(null==t||"linear"===t)return n;if("relu"===t)return n.mul(e.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},Yw=function(n,e){var t=e,r=li(n.shape,e.shape);return r.length>0&&(t=t.sum(r)),t.reshape(n.shape)},Xw=function(n,e,t){if("linear"===e)return n;if("relu"===e)return Nr(n);if("elu"===e)return kN(n);if("relu6"===e)return FN(n);if("prelu"===e)return PN(n,t);throw new Error("Unknown fused activation "+e+".")},mQ=J({fusedMatMul_:function(n){var e,t=n.a,r=n.b,i=n.transposeA,o=void 0!==i&&i,s=n.transposeB,a=void 0!==s&&s,u=n.bias,c=n.activation,d=void 0===c?"linear":c,p=n.preluActivationWeights;if(!1===zw(Z.state.gradientDepth,d)){var m=X1(t,r,o,a);return null!=u&&(m=an(m,u)),Xw(m,d,p)}var y=H(t,"a","fused matMul"),w=H(r,"b","fused matMul");e=Ar(y,w),y=e[0],w=e[1];var C=o?y.shape[y.rank-2]:y.shape[y.rank-1],_=a?w.shape[w.rank-1]:w.shape[w.rank-2],A=o?y.shape[y.rank-1]:y.shape[y.rank-2],T=a?w.shape[w.rank-2]:w.shape[w.rank-1],N=y.shape.slice(0,-2),M=w.shape.slice(0,-2),O=st(N),L=st(M);X(y.rank>=2&&w.rank>=2&&y.rank===w.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+y.rank+" and "+w.rank+"."}),X(ai(N,M),function(){return"Error in fused matMul: outer dimensions ("+N+") and ("+M+") of Tensors with shapes "+y.shape+" and "+w.shape+" must match."}),X(C===_,function(){return"Error in fused matMul: inner shapes ("+C+") and ("+_+") of Tensors with shapes "+y.shape+" and "+w.shape+" and transposeA="+o+" and transposeB="+a+" must match."});var V,j,U=y.shape.slice(0,-2).concat([A,T]),G=o?y.as3D(O,C,A):y.as3D(O,A,C),K=a?w.as3D(L,T,_):w.as3D(L,_,T);null!=u&&sn(U,(V=Ar(V=H(u,"bias","fused matMul"),y)[0]).shape),null!=p&&(j=H(p,"prelu weights","fused matMul"));var $={a:G,b:K};return null!=u&&($.bias=V),null!=p&&($.preluActivationWeights=j),Z.runKernelFunc(function(de,se){var fe=de.fusedBatchMatMul({a:G,b:K,transposeA:o,transposeB:a,bias:V,activation:d,preluActivationWeights:j});return se([G,K,fe]),fe},$,function(de,se){var fe=se[0],we=se[1],Ee=Gw(de,se[2],d),Se={};return null!=u&&(Se={bias:function(){return Yw(V,Ee)}}),Object.assign(o||a?!o&&a?{a:function(){return Ee.matMul(we,!1,!1)},b:function(){return Ee.matMul(fe,!0,!1)}}:o&&!a?{a:function(){return we.matMul(Ee,!1,!0)},b:function(){return fe.matMul(Ee,!1,!1)}}:{a:function(){return we.matMul(Ee,!0,!0)},b:function(){return Ee.matMul(fe,!0,!0)}}:{a:function(){return Ee.matMul(we,!1,!0)},b:function(){return fe.matMul(Ee,!0,!1)}},Se)},"_FusedMatMul",{transposeA:o,transposeB:a,activation:d},[G,K],[!0]).reshape(U)}}),vQ=J({fusedConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,i=n.pad,o=n.dataFormat,s=void 0===o?"NHWC":o,a=n.dilations,u=void 0===a?[1,1]:a,c=n.dimRoundingMode,d=n.bias,p=n.activation,m=void 0===p?"linear":p,y=n.preluActivationWeights;if(!1===zw(Z.state.gradientDepth,m=m||"linear")){var w=xs(e,t,r,i,s,u,c);return null!=d&&(w=an(w,d)),Xw(w,m,y)}var C=H(e,"x","conv2d"),_=H(t,"filter","conv2d"),A=C,T=!1;3===C.rank&&(T=!0,A=C.as4D(1,C.shape[0],C.shape[1],C.shape[2])),X(4===A.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+A.rank+"."}),X(4===_.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+_.rank+"."}),null!=c&&X(Rr(i),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+i+"."}),X(A.shape[3]===_.shape[2],function(){return"Error in conv2d: depth of input ("+A.shape[3]+") must match input depth for filter "+_.shape[2]+"."}),X(Eo(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),X("NHWC"===s,function(){return"Error in conv2d: got dataFormat of "+s+" but only NHWC is currently supported."});var N,M,O=Ec(A.shape,_.shape,r,u,i,c);null!=d&&(N=Ar(N=H(d,"bias","fused conv2d"),C)[0],sn(O.outShape,N.shape)),null!=y&&(M=H(y,"prelu weights","fused conv2d"));var L={x:A,filter:_};null!=d&&(L.bias=N),null!=y&&(L.preluActivationWeights=M);var j=Z.runKernelFunc(function(U,G){var K=U.fusedConv2d({input:A,filter:_,convInfo:O,bias:N,activation:m,preluActivationWeights:M});return G([_,A,K]),K},L,function(U,G){var $=G[0],he=G[1],se=Gw(U,G[2],m);X(_l(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var fe={};return null!=d&&(fe={bias:function(){return Yw(N,se)}}),Object.assign({x:function(){return AN(he.shape,se,$,r,i)},filter:function(){return Lw(he,se,$.shape,r,i)}},fe)},"FusedConv2D",{convInfo:O,activation:m},[_,A],[!0]);return T?j.as3D(j.shape[1],j.shape[2],j.shape[3]):j}}),yQ=J({fusedDepthwiseConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,i=n.pad,o=n.dataFormat,s=void 0===o?"NHWC":o,a=n.dilations,u=void 0===a?[1,1]:a,c=n.dimRoundingMode,d=n.bias,p=n.activation,m=void 0===p?"linear":p,y=n.preluActivationWeights;if(!1===zw(Z.state.gradientDepth,m)){var w=Y1(e,t,r,i,s,u,c);return null!=d&&(w=an(w,d)),Xw(w,m,y)}var C=H(e,"x","depthwiseConv2d"),_=H(t,"filter","depthwiseConv2d"),A=C,T=!1;3===C.rank&&(T=!0,A=C.as4D(1,C.shape[0],C.shape[1],C.shape[2])),X(4===A.rank,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+A.rank+"."}),X(4===_.rank,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+_.rank+"."}),X(A.shape[3]===_.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+A.shape[3]+") must match the inChannels dimension in filter "+_.shape[2]+"."}),null==u&&(u=[1,1]),X(Eo(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),null!=c&&X(Rr(i),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+i+"."});var N,M,O=Ec(A.shape,_.shape,r,u,i,c,!0);null!=d&&(N=Ar(N=H(d,"bias","fused conv2d"),C)[0],sn(O.outShape,N.shape)),null!=y&&(M=H(y,"prelu weights","fused depthwiseConv2d"));var L={x:A,filter:_};null!=d&&(L.bias=N),null!=y&&(L.preluActivationWeights=M);var j=Z.runKernelFunc(function(U,G){var K=U.fusedDepthwiseConv2D({input:A,filter:_,convInfo:O,bias:N,activation:m,preluActivationWeights:M});return G([_,A,K]),K},L,function(U,G){X(_l(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var K=G[0],$=G[1],de=Gw(U,G[2],m),se={};return null!=d&&(se={bias:function(){return Yw(N,de)}}),Object.assign({x:function(){return DN($.shape,de,K,O)},filter:function(){return SN($,de,K.shape,O)}},se)},"FusedDepthwiseConv2D",{convInfo:O,activation:m},[_,A],[!0]);return T?j.as3D(j.shape[1],j.shape[2],j.shape[3]):j}}),xQ=Object.freeze({matMul:mQ,conv2d:vQ,depthwiseConv2d:yQ}),bQ=Object.freeze({image:Hw,linalg:uQ,losses:iQ,spectral:HK,fused:xQ,signal:qK,square:e$,squaredDifference:uN,conv1d:cK,conv2d:xs,conv3d:lK,depthwiseConv2d:Y1,separableConv2d:Bw,conv2dTranspose:hK,conv3dTranspose:dK,op:J,batchNormalization2d:M$,batchNormalization3d:R$,batchNormalization4d:N$,batchNormalization:O$,batchNorm:pN,batchNorm2d:k$,batchNorm3d:P$,batchNorm4d:F$,booleanMaskAsync:function(n,e,t){return tt(this,void 0,void 0,function(){var r,i,o,s,a,u,c,d,p,m,y,w,C;return nt(this,function(_){switch(_.label){case 0:for(r=H(n,"tensor","boolMask"),i=H(e,"mask","boolMask","bool"),o=null==t?0:t,a=r.shape,X((s=i.rank)>0,function(){return"mask cannot be scalar"}),Rn(a.slice(o,o+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=o;c<o+s;c++)u*=a[c];return d=a.slice(0,o).concat([u],a.slice(o+s)),p=r.reshape(d),m=i.reshape([-1]),[4,mN(m)];case 1:return y=_.sent(),w=y.squeeze([1]),C=Pw(p,w,o),n!==r&&r.dispose(),e!==i&&i.dispose(),w.dispose(),p.dispose(),m.dispose(),y.dispose(),[2,C]}})})},complex:Yi,real:vs,imag:za,concat:_i,concat1d:jY,concat2d:WY,concat3d:HY,concat4d:zY,split:aw,matMul:X1,dot:fK,outerProduct:pK,reverse:Rp,reverse1d:gK,reverse2d:mK,reverse3d:vK,reverse4d:yK,maxPool:Pi,avgPool:Np,pool:xK,maxPool3d:bK,avgPool3d:wK,slice:Ya,slice1d:_K,slice2d:CK,slice3d:RN,slice4d:EK,abs:t$,acos:n$,acosh:r$,asin:i$,asinh:o$,atan:s$,atanh:a$,ceil:u$,clipByValue:Nw,cos:c$,cosh:l$,erf:h$,exp:Ow,expm1:d$,floor:f$,log:p$,log1p:g$,logSigmoid:m$,neg:j1,reciprocal:v$,round:y$,rsqrt:cN,sigmoid:lN,sign:x$,isNaN:b$,isInf:w$,isFinite:_$,sin:C$,sinh:E$,softplus:I$,sqrt:A$,step:D$,tan:S$,tanh:T$,all:IK,any:AK,argMax:DK,argMin:SK,logSumExp:TK,max:q1,mean:MK,min:RK,moments:NK,sum:ON,prod:OK,equal:xN,equalStrict:Z$,greater:J$,greaterEqual:bN,greaterEqualStrict:eK,greaterStrict:tK,less:nK,lessEqual:rK,lessEqualStrict:iK,lessStrict:oK,notEqual:sK,notEqualStrict:aK,add:an,addN:V$,addStrict:U$,atan2:j$,div:ha,divNoNan:W$,divStrict:H$,floorDiv:vN,maximum:kw,maximumStrict:z$,minimum:yN,minimumStrict:G$,mod:Y$,modStrict:X$,mul:oo,mulStrict:q$,pow:G1,powStrict:$$,squaredDifferenceStrict:K$,sub:Ei,subStrict:Q$,elu:kN,leakyRelu:kK,prelu:PN,relu:Nr,relu6:FN,selu:PK,logicalAnd:z1,logicalNot:L$,logicalOr:gN,logicalXor:B$,where:Il,whereAsync:mN,buffer:Vt,print:function(n,e){void 0===e&&(e=!1),console.log(n.toString(e))},batchToSpaceND:KR,broadcastTo:eX,cast:tX,clone:nX,cumsum:rX,depthToSpace:iX,expandDims:ys,eye:QR,multinomial:oX,oneHot:cw,pad:wl,pad1d:sX,pad2d:aX,pad3d:uX,pad4d:cX,rand:lX,randomNormal:hX,randomGamma:dX,randomUniform:ZR,reshape:ca,spaceToBatchND:JR,squeeze:e3,stack:ns,tile:ad,truncatedNormal:fX,unstack:Ci,setdiff1dAsync:function(n,e){return tt(this,void 0,void 0,function(){var t,r,i,o,s,a,u,c,d,p;return nt(this,function(m){switch(m.label){case 0:return t=H(n,"x","setdiff1d"),r=H(e,"y","setdiff1d"),X(t.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+r.dtype+")."}),X(1===t.rank,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),X(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,t.data()];case 1:return i=m.sent(),[4,r.data()];case 2:for(o=m.sent(),s=new Set(o),a=0,d=0;d<i.length;d++)s.has(i[d])||a++;for(u=new fp([a],t.dtype),c=new fp([a],"int32"),d=0,p=0;d<i.length;d++)s.has(i[d])||(u.values[p]=i[d],c.values[p]=d,p++);return[2,[u.toTensor(),c.toTensor()]]}})})},fill:Ga,linspace:function(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");return Z.runKernelFunc(function(r){return r.linspace(n,e,t)},{})},ones:sd,range:I1,scalar:Ue,tensor:Xi,tensor1d:ci,tensor2d:Cc,tensor3d:sw,tensor4d:Po,tensor5d:function(n,e,t){if(gl(n),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");var r=Ha(n,t);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return _c(n,e,r,t)},tensor6d:function(n,e,t){if(gl(n),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");var r=Ha(n,t);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return _c(n,e=e||r,r,t)},variable:function(n,e,t,r){return void 0===e&&(e=!0),Z.makeVariable(n,e,t,r)},zeros:xr,onesLike:$R,zerosLike:Nn,transpose:Ic,softmax:Eu,logSoftmax:mX,localResponseNormalization:FK,norm:LN,gather:Pw,unsortedSegmentSum:CN,basicLSTMCell:LK,multiRNNCell:BK,movingAverage:VK,stridedSlice:UK,topk:jK,scatterND:WK,fft:Vw,ifft:$1,rfft:Uw,irfft:BN,sparseToDense:zK,gatherND:GK,diag:YK,dropout:XK,hannWindow:jw,hammingWindow:UN,frame:Ww,stft:jN,inTopKAsync:function(n,e,t){return void 0===t&&(t=1),tt(this,void 0,void 0,function(){var r,i,o,s,a,u,c,d,p,m,y,w,C,_;return nt(this,function(A){switch(A.label){case 0:return r=H(n,"predictions","inTopK"),i=H(e,"targets","inTopK"),X(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),X(r.rank-1===i.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank}),Rn(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=r.shape[r.shape.length-1],X(t>0&&t<=o,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+o+"), but got "+t}),[4,r.data()];case 1:return s=A.sent(),[4,i.data()];case 2:for(a=A.sent(),d=(u=[s.length/o,o])[1],p=nd("bool",c=u[0]),m=0;m<c;m++){for(w=s.subarray(y=m*d,y+d),C=[],_=0;_<w.length;_++)C.push({value:w[_],index:_});for(C.sort(function(T,N){return N.value-T.value}),p[m]=0,_=0;_<t;_++)if(C[_].index===a[m]){p[m]=1;break}}return n!==r&&r.dispose(),e!==i&&i.dispose(),[2,Xi(p,i.shape,"bool")]}})})}});function Ie(n,e){Array.isArray(n)||(n=[n]),n.forEach(function(t){null!=t&&X("complex64"!==t.dtype,function(){return e+" does not support complex64 tensors."})})}function qw(n,e,t,r){if("linear"===t)return n.linear(e);if("relu"===t)return n.relu(e);if("elu"===t)return n.elu(e);if("relu6"===t)return n.relu6(e);if("prelu"===t)return n.prelu(e,r);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var wQ=function(n){function e(){var t=n.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new u3(t,Z),t}return ia(e,n),e.prototype.write=function(t,r,i){this.firstUse&&(this.firstUse=!1,ge().get("IS_NODE")&&C1("\n============================\nHi there \u{1f44b}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var o={};return this.data.set(o,{values:t,dtype:i}),o},e.prototype.move=function(t,r,i,o){this.data.set(t,{values:r,dtype:o})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return tt(this,void 0,void 0,function(){return nt(this,function(r){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var r=this.data.get(t),o=r.complexTensors;return"complex64"===r.dtype?xw(this.readSync(o.real.dataId),this.readSync(o.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var r=this.readSync(t.dataId),i=r;if("string"===t.dtype)try{i=r.map(function(o){return cp(o)})}catch(o){throw new Error("Failed to decode encoded string bytes into utf-8")}return Vt(t.shape,t.dtype,i)},e.prototype.makeOutput=function(t,r,i){var o=this.write(t,r,i);return Z.makeTensorFromDataId(o,r,i,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var r=this.data.get(t).complexTensors;null!=r&&(r.real.dispose(),r.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return tt(this,void 0,void 0,function(){var r;return nt(this,function(i){return r=sa(),t(),[2,{kernelMs:sa()-r}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,r){var i=this.makeOutput(null,t.shape,"complex64");return this.data.get(i.dataId).complexTensors={real:Z.keep(t.clone()),imag:Z.keep(r.clone())},i},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,i){if(Ie(t,"slice"),fw(t.shape,r,i)){var o=pw(r,t.strides),s=st(i);return Xi(this.readSync(t.dataId).subarray(o,o+s),i,t.dtype)}for(var a=Vt(i,t.dtype),u=this.bufferSync(t),c=0;c<a.size;++c){var d=a.indexToLoc(c).map(function(p,m){return p+r[m]});a.values[c]=u.get.apply(u,d)}return a.toTensor()},e.prototype.stridedSlice=function(t,r,i,o){Ie(t,"stridedSlice");var s=R1(r,i,o);if(s.some(function(y){return 0===y}))return Xi([],s);for(var a=Vt(s,t.dtype),u=this.bufferSync(t),c=0;c<a.size;c++){for(var d=a.indexToLoc(c),p=new Array(d.length),m=0;m<p.length;m++)p[m]=d[m]*o[m]+r[m];a.set.apply(a,[u.get.apply(u,p)].concat(d))}return a.toTensor()},e.prototype.diag=function(t){for(var r=this.readSync(t.dataId),i=Vt([t.size,t.size],t.dtype),o=i.values,s=0;s<r.length;s++)o[s*t.size+s]=r[s];return i.toTensor()},e.prototype.unstack=function(t,r){for(var i=t.shape[r],o=new Array(t.rank-1),s=0,a=0;a<t.rank;a++)a!==r&&(o[s++]=t.shape[a]);var u=new Array(t.rank).fill(0),c=t.shape.slice();c[r]=1;var d=new Array(i);for(a=0;a<d.length;a++)u[r]=a,d[a]=this.slice(t,u,c).reshape(o);return d},e.prototype.reverse=function(t,r){Ie(t,"reverse");for(var i=Vt(t.shape,t.dtype),o=this.bufferSync(t),s=function(u){var c=i.indexToLoc(u),d=c.slice();r.forEach(function(p){return d[p]=t.shape[p]-1-d[p]}),i.set.apply(i,[o.get.apply(o,d)].concat(c))},a=0;a<i.size;a++)s(a);return i.toTensor()},e.prototype.concat=function(t,r){var i=this;if("complex64"===t[0].dtype){var o=t.map(function(y){return vs(y)}),s=t.map(function(y){return za(y)});return Yi(this.concat(o,r),this.concat(s,r))}var a=t.map(function(y){var w=st(y.shape.slice(r));return y.as2D(-1,w)}),u=yl(a.map(function(y){return y.shape}),1),c=Vt(u,t[0].dtype).values;if(1===a[0].shape[0]){var d=0;a.forEach(function(y){c.set(i.readSync(y.dataId),d),d+=y.size})}else{var p=0;a.forEach(function(y){for(var w=i.readSync(y.dataId),C=0,_=0;_<y.shape[0];++_)for(var A=_*u[1]+p,T=0;T<y.shape[1];++T)c[A+T]=w[C++];p+=y.shape[1]})}var m=yl(t.map(function(y){return y.shape}),r);return Xi(c,m,t[0].dtype)},e.prototype.neg=function(t){return Ie(t,"neg"),this.multiply(Ue(-1),t)},e.prototype.add=function(t,r){return"complex64"===t.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(i,o,s,a){return{real:i+s,imag:o+a}}):this.broadcastedBinaryOp(t,r,ki(t.dtype,r.dtype),function(i,o){return i+o})},e.prototype.addN=function(t){var r=this;Ie(t,"addN");for(var i=t.map(function(d){return r.readSync(d.dataId)}),o=Vt(t[0].shape,t[0].dtype),s=o.values,a=0;a<t.length;a++)for(var u=i[a],c=0;c<s.length;c++)s[c]+=u[c];return o.toTensor()},e.prototype.softmax=function(t,r){var i=ui([r],t.shape),o=this.max(t,i),s=Co(o.shape,i),a=this.subtract(t,o.reshape(s)),u=this.exp(a),c=this.sum(u,i).reshape(s);return this.realDivide(u,c)},e.prototype.subtract=function(t,r){return"complex64"===t.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(i,o,s,a){return{real:i-s,imag:o-a}}):this.broadcastedBinaryOp(t,r,ki(t.dtype,r.dtype),function(i,o){return i-o})},e.prototype.pow=function(t,r){return Ie([t,r],"pow"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return Math.pow(i,o)})},e.prototype.batchMatMul=function(t,r,i,o){Ie([t,r],"matMul");for(var s=i?t.shape[1]:t.shape[2],a=i?t.shape[2]:t.shape[1],u=o?r.shape[1]:r.shape[2],c=t.shape[0],d=this.readSync(t.dataId),p=this.readSync(r.dataId),m=i?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],y=m[0],w=m[1],C=m[2],_=o?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],A=_[0],T=_[1],N=_[2],M=a*u,O=Vt([c,a,u],t.dtype),L=O.values,V=this.blockSize,j=0;j<c;j++)for(var U=0;U<a;U+=V)for(var G=0;G<u;G+=V)for(var K=0;K<s;K+=V)for(var $=Math.min(U+V,a),he=Math.min(G+V,u),de=Math.min(K+V,s),se=U;se<$;se++)for(var fe=G;fe<he;fe++){for(var we=0,ye=K;ye<de;ye++)we+=d[j*y+se*w+ye*C]*p[ye*A+fe*T+j*N];L[j*M+(se*u+fe)]+=we}return O.toTensor()},e.prototype.fusedBatchMatMul=function(t){var a=t.bias,u=t.activation,c=t.preluActivationWeights,d=this.batchMatMul(t.a,t.b,t.transposeA,t.transposeB);return a&&(d=this.add(d,a)),u&&(d=qw(this,d,u,c)),d},e.prototype.multiply=function(t,r){return"complex64"===t.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(i,o,s,a){return{real:i*s-o*a,imag:i*a+o*s}}):this.broadcastedBinaryOp(t,r,ki(t.dtype,r.dtype),function(i,o){return i*o})},e.prototype.realDivide=function(t,r){return Ie([t,r],"realDivide"),this.broadcastedBinaryOp(t,r,"float32",function(i,o){return i/o})},e.prototype.floorDiv=function(t,r){return Ie([t,r],"floorDiv"),this.broadcastedBinaryOp(t,r,"int32",function(i,o){return Math.floor(i/o)})},e.prototype.sum=function(t,r){Ie(t,"sum"),ko("sum",r,t.rank);for(var i=Gi(t.shape,r),s=i[1],a=xr(i[0],ki(t.dtype,"int32")),u=st(s),c=this.readSync(a.dataId),d=this.readSync(t.dataId),p=0;p<c.length;++p){for(var m=p*u,y=0,w=0;w<u;++w)y+=d[m+w];c[p]=y}return a},e.prototype.prod=function(t,r){Ie(t,"sum");for(var i=Gi(t.shape,r),s=i[1],a=xr(i[0],ki(t.dtype,"int32")),u=st(s),c=this.readSync(a.dataId),d=this.readSync(t.dataId),p=0;p<c.length;++p){for(var m=p*u,y=1,w=0;w<u;++w)y*=d[m+w];c[p]=y}return a},e.prototype.unsortedSegmentSum=function(t,r,i){Ie(t,"unsortedSegmentSum");for(var o=[],s=t.rank-r.rank,a=0;a<s;++a)r=r.expandDims(a+1);for(a=0;a<i;++a){var u=Ue(a,"int32"),c=xN(u,r).asType("float32").mul(t).sum(0);o.push(c)}return ns(o)},e.prototype.argMin=function(t,r){Ie(t,"argMin");var i=[r];ko("argMin",i,t.rank);for(var o=Gi(t.shape,i),a=o[1],u=xr(o[0],"int32"),c=st(a),d=this.readSync(u.dataId),p=this.readSync(t.dataId),m=0;m<d.length;++m){for(var y=m*c,w=p[y],C=0,_=0;_<c;++_){var A=p[y+_];A<w&&(w=A,C=_)}d[m]=C}return u},e.prototype.argMax=function(t,r){Ie(t,"argMax");var i=[r];ko("argMax",i,t.rank);for(var o=Gi(t.shape,i),a=o[1],u=xr(o[0],"int32"),c=st(a),d=this.readSync(u.dataId),p=this.readSync(t.dataId),m=0;m<d.length;++m){for(var y=m*c,w=p[y],C=0,_=0;_<c;++_){var A=p[y+_];A>w&&(w=A,C=_)}d[m]=C}return u},e.prototype.cumsum=function(t,r,i,o){if(Ie(t,"cumsum"),r!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+r);for(var s=ki(t.dtype,"int32"),a=xr(t.shape,s),u=this.readSync(a.dataId),c=this.readSync(t.dataId),d=t.shape[t.rank-1],p=o?function(_,A){return _+d-A-1}:function(_,A){return _+A},m=0;m<c.length;m+=d)for(var y=0;y<d;y++){var w=p(m,y);if(0===y)u[w]=i?0:c[w];else{var C=p(m,y-1);u[w]=i?c[C]+u[C]:c[w]+u[C]}}return a},e.prototype.equal=function(t,r){return Ie([t,r],"equal"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i===o?1:0})},e.prototype.notEqual=function(t,r){return Ie([t,r],"notEqual"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i!==o?1:0})},e.prototype.less=function(t,r){return Ie([t,r],"less"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i<o?1:0})},e.prototype.lessEqual=function(t,r){return Ie([t,r],"lessEqual"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i<=o?1:0})},e.prototype.greater=function(t,r){return Ie([t,r],"greater"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i>o?1:0})},e.prototype.greaterEqual=function(t,r){return Ie([t,r],"greaterEqual"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i>=o?1:0})},e.prototype.logicalNot=function(t){Ie(t,"logicalNot");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)i[o]=r[o]?0:1;return this.makeOutput(i,t.shape,"bool")},e.prototype.logicalAnd=function(t,r){return Ie([t,r],"logicalAnd"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i&&o})},e.prototype.logicalOr=function(t,r){return Ie([t,r],"logicalOr"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i||o})},e.prototype.select=function(t,r,i){Ie([t,r,i],"select");for(var o=this.readSync(t.dataId),s=this.readSync(r.dataId),a=this.readSync(i.dataId),u=xr(r.shape,ki(r.dtype,i.dtype)),c=this.readSync(u.dataId),d=0,p=0===t.rank||t.rank>1||1===r.rank?1:st(r.shape.slice(1)),m=0;m<o.length;m++)for(var y=0;y<p;y++)c[d++]=1===o[m]?s[m]:a[m];return u},e.prototype.where=function(t){Ie([t],"where");var r=this.readSync(t.dataId);return _w(t.shape,r)},e.prototype.topk=function(t,r,i){return Ie(t,"topk"),g3(this.readSync(t.dataId),t.shape,t.dtype,r)},e.prototype.min=function(t,r){Ie(t,"min"),ko("min",r,t.rank);for(var i=Gi(t.shape,r),s=i[1],a=xr(i[0],t.dtype),u=st(s),c=this.readSync(a.dataId),d=this.readSync(t.dataId),p=0;p<c.length;++p){for(var m=p*u,y=d[m],w=0;w<u;++w){var C=d[m+w];C<y&&(y=C)}c[p]=y}return a},e.prototype.minimum=function(t,r){return Ie([t,r],"minimum"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return Math.min(i,o)})},e.prototype.mod=function(t,r){return Ie([t,r],"mod"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){var s=i%o;return i<0&&o<0||i>=0&&o>=0?s:(s+o)%o})},e.prototype.max=function(t,r){Ie(t,"max"),ko("max",r,t.rank);for(var i=Gi(t.shape,r),s=i[1],a=xr(i[0],t.dtype),u=st(s),c=this.readSync(a.dataId),d=this.readSync(t.dataId),p=0;p<c.length;++p){for(var m=p*u,y=d[m],w=0;w<u;++w){var C=d[m+w];C>y&&(y=C)}c[p]=y}return a},e.prototype.maximum=function(t,r){return Ie([t,r],"maximum"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return Math.max(i,o)})},e.prototype.all=function(t,r){Ie(t,"all"),ko("all",r,t.rank);for(var i=Gi(t.shape,r),s=i[1],a=xr(i[0],t.dtype),u=st(s),c=this.readSync(a.dataId),d=this.readSync(t.dataId),p=0;p<c.length;++p){for(var m=p*u,y=d[m],w=0;w<u;++w)y=y&&d[m+w];c[p]=y}return a},e.prototype.any=function(t,r){Ie(t,"any"),ko("any",r,t.rank);for(var i=Gi(t.shape,r),s=i[1],a=xr(i[0],t.dtype),u=st(s),c=this.readSync(a.dataId),d=this.readSync(t.dataId),p=0;p<c.length;++p){for(var m=p*u,y=d[m],w=0;w<u;++w)y=y||d[m+w];c[p]=y}return a},e.prototype.squaredDifference=function(t,r){return Ie([t,r],"squaredDifference"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){var s=i-o;return s*s})},e.prototype.ceil=function(t){Ie(t,"ceil");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.ceil(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.floor=function(t){Ie(t,"floor");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.floor(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.sign=function(t){Ie(t,"x");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=r[o]<0?-1:r[o]>0?1:0;return this.makeOutput(i,t.shape,"float32")},e.prototype.isNaN=function(t){Ie(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isNaN(r[o])&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isInf=function(t){Ie(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Math.abs(r[o])===1/0&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isFinite=function(t){Ie(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isFinite(r[o])&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.round=function(t){Ie(t,"round");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var s=Math.floor(r[o]);i[o]=r[o]-s<.5?Math.floor(r[o]):r[o]-s>.5?Math.ceil(r[o]):s%2==0?s:s+1}return this.makeOutput(i,t.shape,"float32")},e.prototype.exp=function(t){Ie(t,"exp");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.exp(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.expm1=function(t){Ie(t,"expm1");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.expm1(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.log=function(t){Ie(t,"log");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.log(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.log1p=function(t){Ie(t,"log1p");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.log1p(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.sqrt=function(t){Ie(t,"sqrt");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.sqrt(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.rsqrt=function(t){Ie(t,"rsqrt");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=1/Math.sqrt(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.reciprocal=function(t){Ie(t,"reciprocal");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=1/r[o];return this.makeOutput(i,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){Ie(t,"relu");for(var r=xr(t.shape,t.dtype),i=this.readSync(r.dataId),o=this.readSync(t.dataId),s=0;s<o.length;++s)i[s]=Math.max(0,o[s]);return r},e.prototype.relu6=function(t){Ie(t,"relu");for(var r=xr(t.shape,t.dtype),i=this.readSync(r.dataId),o=this.readSync(t.dataId),s=0;s<o.length;++s)i[s]=Math.min(Math.max(0,o[s]),6);return r},e.prototype.prelu=function(t,r){return Ie([t,r],"prelu"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return i<0?o*i:i})},e.prototype.elu=function(t){Ie(t,"elu");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o){var s=i[o];r[o]=s>=0?s:Math.exp(s)-1}return this.makeOutput(r,t.shape,"float32")},e.prototype.eluDer=function(t,r){Ie([t,r],"eluDer");for(var i=new Float32Array(r.size),o=this.readSync(r.dataId),s=this.readSync(t.dataId),a=0;a<o.length;++a){var u=o[a];i[a]=u>=1?s[a]:s[a]*(u+1)}return this.makeOutput(i,r.shape,"float32")},e.prototype.selu=function(t){Ie(t,"selu");for(var o=new Float32Array(t.size),s=this.readSync(t.dataId),a=0;a<s.length;++a){var u=s[a];o[a]=u>=0?1.0507009873554805*u:1.7580993408473768*(Math.exp(u)-1)}return this.makeOutput(o,t.shape,"float32")},e.prototype.clip=function(t,r,i){Ie(t,"clip");for(var o=new Float32Array(t.size),s=this.readSync(t.dataId),a=0;a<s.length;++a){var u=s[a];o[a]=u>i?i:u<r?r:u}return this.makeOutput(o,t.shape,"float32")},e.prototype.abs=function(t){for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.abs(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<t.size;++o)r[o]=Math.hypot(i[2*o],i[2*o+1]);return this.makeOutput(r,t.shape,"float32")},e.prototype.int=function(t){Ie(t,"int");for(var r=new Int32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=i[o];return this.makeOutput(r,t.shape,"int32")},e.prototype.sigmoid=function(t){Ie(t,"sigmoid");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=1/(1+Math.exp(-i[o]));return this.makeOutput(r,t.shape,"float32")},e.prototype.softplus=function(t){Ie(t,"softplus");for(var r=Math.log(1.1920928955078125e-7)+2,i=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s){var d,a=o[s]>-r,u=o[s]<r,c=Math.exp(o[s]);d=u?c:a?o[s]:Math.log(1+c),i[s]=d}return this.makeOutput(i,t.shape,"float32")},e.prototype.sin=function(t){Ie(t,"sin");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.sin(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cos=function(t){Ie(t,"cos");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.cos(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tan=function(t){Ie(t,"tan");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.tan(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asin=function(t){Ie(t,"asin");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.asin(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acos=function(t){Ie(t,"acos");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.acos(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan=function(t){Ie(t,"atan");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.atan(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan2=function(t,r){return Ie([t,r],"atan2"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return Math.atan2(i,o)})},e.prototype.sinh=function(t){Ie(t,"sinh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.sinh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cosh=function(t){Ie(t,"cosh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.cosh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tanh=function(t){Ie(t,"tanh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=rR(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asinh=function(t){Ie(t,"asinh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.asinh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acosh=function(t){Ie(t,"acosh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.acosh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atanh=function(t){Ie(t,"atanh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.atanh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.erf=function(t){Ie(t,"erf");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o){var s=Math.sign(i[o]),a=Math.abs(i[o]),u=1/(1+.3275911*a);r[o]=s*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-a*a))}return this.makeOutput(r,t.shape,"float32")},e.prototype.step=function(t,r){void 0===r&&(r=0),Ie(t,"step");for(var i=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s){var a=o[s];i[s]=isNaN(a)?NaN:a>0?1:r}return this.makeOutput(i,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var s=t.bias,a=t.activation,u=t.preluActivationWeights,c=this.conv2d(t.input,t.filter,t.convInfo);return s&&(c=this.add(c,s)),a&&(c=qw(this,c,a,u)),c},e.prototype.conv2d=function(t,r,i){Ie([t,r],"conv2d");for(var o=i.filterHeight,s=i.filterWidth,a=i.dilationHeight,u=i.dilationWidth,c=i.padInfo.left,d=i.padInfo.top,p="channelsLast"===i.dataFormat,m=Vt(i.outShape,t.dtype),y=t.strides[0],w=p?t.strides[1]:t.strides[2],C=p?t.strides[2]:1,_=p?1:t.strides[1],A=m.strides[0],T=p?m.strides[1]:m.strides[2],N=p?m.strides[2]:1,M=p?1:m.strides[1],O=this.readSync(t.dataId),L=this.readSync(r.dataId),V=m.values,j=0;j<i.batchSize;++j)for(var U=j*y,G=j*A,K=0;K<i.outHeight;++K)for(var $=G+K*T,he=K*i.strideHeight-d,de=0;de<o;de++){var se=he+de*a;if(!(se<0||se>=i.inHeight))for(var fe=de*r.strides[0],we=U+se*w,ye=0;ye<i.outWidth;++ye)for(var Ee=$+ye*N,Se=ye*i.strideWidth-c,je=0;je<s;je++){var et=Se+je*u;if(!(et<0||et>=i.inWidth))for(var dt=we+et*C,zt=fe+je*r.strides[1],Gt=0;Gt<i.inChannels;++Gt){for(var dn=O[dt+Gt*_],On=0;On<i.outChannels;++On)V[Ee+On*M]+=dn*L[zt+On];zt+=i.outChannels}}}return m.toTensor()},e.prototype.conv3d=function(t,r,i){for(var o=i.filterDepth,s=i.filterHeight,a=i.filterWidth,u=i.dilationDepth,c=i.dilationHeight,d=i.dilationWidth,p=i.padInfo.front,m=i.padInfo.left,y=i.padInfo.top,w=Vt(i.outShape,t.dtype),C=this.readSync(t.dataId),_=this.readSync(r.dataId),A=w.values,T=0;T<i.batchSize;++T)for(var N=T*t.strides[0],M=T*w.strides[0],O=0;O<i.outDepth;++O)for(var L=M+O*w.strides[1],V=O*i.strideDepth-p,j=0;j<o;j++){var U=V+j*u;if(!(U<0||U>=i.inDepth))for(var G=j*r.strides[0],K=N+U*t.strides[1],$=0;$<i.outHeight;++$)for(var he=L+$*w.strides[2],de=$*i.strideHeight-y,se=0;se<s;se++){var fe=de+se*c;if(!(fe<0||fe>=i.inHeight))for(var we=G+se*r.strides[1],ye=K+fe*t.strides[2],Ee=0;Ee<i.outWidth;++Ee)for(var Se=he+Ee*i.outChannels,je=Ee*i.strideWidth-m,et=0;et<a;et++){var dt=je+et*d;if(!(dt<0||dt>=i.inWidth))for(var Gt=ye+dt*i.inChannels,dn=we+et*r.strides[2],On=0;On<i.inChannels;++On){for(var wn=C[Gt+On],kn=0;kn<i.outChannels;++kn)A[Se+kn]+=wn*_[dn+kn];dn+=i.outChannels}}}}return w.toTensor()},e.prototype.conv2dDerInput=function(t,r,i){Ie([t,r],"conv2dDerInput");for(var o=Vt(i.inShape,"float32"),s=o.values,a=this.readSync(t.dataId),u=this.readSync(r.dataId),c=r.strides,d=c[0],p=c[1],m=c[2],y=i.batchSize,w=i.filterHeight,C=i.filterWidth,_=i.inChannels,A=i.inHeight,T=i.inWidth,N=i.outChannels,M=i.outHeight,O=i.outWidth,L=i.strideHeight,V=i.strideWidth,U=w-1-i.padInfo.top,G=C-1-i.padInfo.left,K="channelsLast"===i.dataFormat,$=o.strides[0],he=K?o.strides[1]:o.strides[2],de=K?o.strides[2]:1,se=K?1:o.strides[1],fe=t.strides[0],we=K?t.strides[1]:t.strides[2],ye=K?t.strides[2]:1,Ee=K?1:t.strides[1],Se=0;Se<y;++Se)for(var je=0;je<_;++je)for(var et=0;et<A;++et)for(var dt=et-U,zt=Math.max(0,Math.ceil(dt/L)),Gt=Math.min(M,(w+dt)/L),dn=0;dn<T;++dn){for(var On=dn-G,wn=Math.max(0,Math.ceil(On/V)),kn=Math.min(O,(C+On)/V),ni=0,_n=zt;_n<Gt;++_n)for(var nr=_n*L-dt,Hn=wn;Hn<kn;++Hn)for(var qr=fe*Se+we*_n+ye*Hn,Pr=d*(w-1-nr)+p*(C-1-(Hn*V-On))+m*je,Fr=0;Fr<N;++Fr)ni+=a[qr+Ee*Fr]*u[Pr+Fr];s[$*Se+he*et+de*dn+se*je]=ni}return o.toTensor()},e.prototype.conv3dDerInput=function(t,r,i){for(var o=Vt(i.inShape,"float32"),s=o.values,a=o.strides,u=a[0],c=a[1],d=a[2],p=a[3],m=this.readSync(t.dataId),y=t.strides,w=y[0],C=y[1],_=y[2],A=y[3],T=this.readSync(r.dataId),N=r.strides,M=N[0],O=N[1],L=N[2],V=N[3],j=i.batchSize,U=i.filterDepth,G=i.filterHeight,K=i.filterWidth,$=i.inChannels,he=i.inDepth,de=i.inHeight,se=i.inWidth,fe=i.outChannels,we=i.outDepth,ye=i.outHeight,Ee=i.outWidth,Se=i.strideDepth,je=i.strideHeight,et=i.strideWidth,dt=U-1-i.padInfo.front,zt=G-1-i.padInfo.top,Gt=K-1-i.padInfo.left,dn=0;dn<j;++dn)for(var On=0;On<$;++On)for(var wn=0;wn<he;++wn)for(var kn=wn-dt,ni=Math.max(0,Math.ceil(kn/Se)),_n=Math.min(we,(U+kn)/Se),nr=0;nr<de;++nr)for(var Hn=nr-zt,qr=Math.max(0,Math.ceil(Hn/je)),Pr=Math.min(ye,(G+Hn)/je),Fr=0;Fr<se;++Fr){for(var eu=Fr-Gt,tu=Math.max(0,Math.ceil(eu/et)),ss=Math.min(Ee,(K+eu)/et),Rd=0,ju=ni;ju<_n;++ju)for(var Lc=ju*Se-kn,Wu=qr;Wu<Pr;++Wu)for(var Nd=Wu*je-Hn,Hu=tu;Hu<ss;++Hu)for(var V_=w*dn+C*ju+_*Wu+A*Hu,Od=M*(U-1-Lc)+O*(G-1-Nd)+L*(K-1-(Hu*et-eu))+V*On,nu=0;nu<fe;++nu)Rd+=m[V_+nu]*T[Od+nu];s[u*dn+c*wn+d*nr+p*Fr+On]=Rd}return o.toTensor()},e.prototype.conv2dDerFilter=function(t,r,i){Ie([t,r],"conv2dDerFilter");for(var o=i.strideHeight,s=i.strideWidth,a=i.filterHeight,u=i.filterWidth,c="channelsLast"===i.dataFormat,d=Vt(i.filterShape,"float32"),p=i.padInfo.left,m=i.padInfo.top,y=this.bufferSync(t),w=this.bufferSync(r),C=0;C<a;++C)for(var _=Math.max(0,Math.ceil((m-C)/o)),A=Math.min(i.outHeight,(i.inHeight+m-C)/o),T=0;T<u;++T)for(var N=Math.max(0,Math.ceil((p-T)/s)),M=Math.min(i.outWidth,(i.inWidth+p-T)/s),O=0;O<i.inChannels;++O)for(var L=0;L<i.outChannels;++L){for(var V=0,j=0;j<i.batchSize;++j)for(var U=_;U<A;++U)for(var G=C+U*o-m,K=N;K<M;++K){var $=T+K*s-p;V+=c?y.get(j,G,$,O)*w.get(j,U,K,L):y.get(j,O,G,$)*w.get(j,L,U,K)}d.set(V,C,T,O,L)}return d.toTensor()},e.prototype.conv3dDerFilter=function(t,r,i){for(var o=i.strideDepth,s=i.strideHeight,a=i.strideWidth,u=i.filterDepth,c=i.filterHeight,d=i.filterWidth,p=Vt(i.filterShape,"float32"),m=p.values,y=p.strides,w=y[0],C=y[1],_=y[2],A=y[3],T=this.readSync(r.dataId),N=r.strides,M=N[0],O=N[1],L=N[2],V=N[3],j=this.readSync(t.dataId),U=t.strides,G=U[0],K=U[1],$=U[2],he=U[3],de=i.padInfo.front,se=i.padInfo.left,fe=i.padInfo.top,we=0;we<u;++we)for(var ye=Math.max(0,Math.ceil((de-we)/o)),Ee=Math.min(i.outDepth,(i.inDepth+de-we)/o),Se=we*w,je=0;je<c;++je)for(var et=Math.max(0,Math.ceil((fe-je)/s)),dt=Math.min(i.outHeight,(i.inHeight+fe-je)/s),zt=je*C+Se,Gt=0;Gt<d;++Gt)for(var dn=Math.max(0,Math.ceil((se-Gt)/a)),On=Math.min(i.outWidth,(i.inWidth+se-Gt)/a),wn=Gt*_+zt,kn=0;kn<i.inChannels;++kn)for(var ni=kn*A+wn,_n=0;_n<i.outChannels;++_n){for(var nr=0,Hn=0;Hn<i.batchSize;++Hn)for(var qr=Hn*G,Pr=Hn*M,Fr=ye;Fr<Ee;++Fr)for(var eu=(we+Fr*o-de)*K+qr,tu=Fr*O+Pr,ss=et;ss<dt;++ss)for(var Rd=(je+ss*s-fe)*$+eu,ju=ss*L+tu,Lc=dn;Lc<On;++Lc)nr+=j[(Gt+Lc*a-se)*he+Rd+kn]*T[Lc*V+ju+_n];m[ni+_n]=nr}return p.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var s=t.bias,a=t.activation,u=t.preluActivationWeights,c=this.depthwiseConv2D(t.input,t.filter,t.convInfo);return s&&(c=this.add(c,s)),a&&(c=qw(this,c,a,u)),c},e.prototype.depthwiseConv2D=function(t,r,i){Ie([t,r],"depthwiseConv2D");for(var o=i.filterHeight,s=i.filterWidth,a=i.dilationHeight,u=i.dilationWidth,c=i.padInfo.left,d=i.padInfo.top,p=i.outChannels/i.inChannels,m=Vt(i.outShape,t.dtype),y=this.readSync(t.dataId),w=this.readSync(r.dataId),C=m.values,_=0;_<i.batchSize;++_)for(var A=_*t.strides[0],T=_*m.strides[0],N=0;N<i.outHeight;++N)for(var M=T+N*m.strides[1],O=N*i.strideHeight-c,L=0;L<o;++L){var V=O+L*a;if(!(V<0||V>=i.inHeight))for(var j=L*r.strides[0],U=A+V*t.strides[1],G=0;G<i.outWidth;++G)for(var K=M+G*m.strides[2],$=G*i.strideWidth-d,he=0;he<s;++he){var de=$+he*u;if(!(de<0||de>=i.inWidth))for(var fe=U+de*i.inChannels,we=K,ye=j+he*r.strides[1],Ee=0;Ee<i.inChannels;++Ee){for(var Se=y[fe+Ee],je=0;je<p;++je)C[we+je]+=Se*w[ye+je];we+=p,ye+=p}}}return m.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,r,i){Ie([t,r],"depthwiseConv2DDerInput");for(var o=Vt(i.inShape,"float32"),s=o.values,a=o.strides,u=a[0],c=a[1],d=a[2],p=this.readSync(t.dataId),m=t.strides,y=m[0],w=m[1],C=m[2],_=this.readSync(r.dataId),A=r.strides,T=A[0],N=A[1],M=A[2],O=i.batchSize,L=i.filterHeight,V=i.filterWidth,j=i.inChannels,U=i.inHeight,G=i.inWidth,$=i.outHeight,he=i.outWidth,de=i.strideHeight,se=i.strideWidth,fe=L-1-i.padInfo.top,we=V-1-i.padInfo.left,ye=i.outChannels/j,Ee=0;Ee<O;++Ee)for(var Se=0;Se<j;++Se)for(var je=0;je<U;++je)for(var et=je-fe,dt=Math.max(0,Math.ceil(et/de)),zt=Math.min($,(L+et)/de),Gt=0;Gt<G;++Gt){for(var dn=Gt-we,On=Math.max(0,Math.ceil(dn/se)),wn=Math.min(he,(V+dn)/se),kn=0,ni=dt;ni<zt;++ni)for(var _n=ni*de-et,nr=On;nr<wn;++nr)for(var Hn=y*Ee+w*ni+C*nr,qr=T*(L-1-_n)+N*(V-1-(nr*se-dn))+M*Se,Pr=0;Pr<ye;++Pr)kn+=p[Hn+(Se*ye+Pr)]*_[qr+Pr];s[u*Ee+c*je+d*Gt+Se]=kn}return o.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,r,i){Ie([t,r],"depthwiseConv2DDerFilter");for(var o=i.strideHeight,s=i.strideWidth,a=i.filterHeight,u=i.filterWidth,c=Vt(i.filterShape,"float32"),d=i.padInfo.left,p=i.padInfo.top,m=i.outChannels/i.inChannels,y=this.bufferSync(t),w=this.bufferSync(r),C=0;C<a;++C)for(var _=Math.max(0,Math.ceil((p-C)/o)),A=Math.min(i.outHeight,(i.inHeight+p-C)/o),T=0;T<u;++T)for(var N=Math.max(0,Math.ceil((d-T)/s)),M=Math.min(i.outWidth,(i.inWidth+d-T)/s),O=0;O<i.outChannels;++O){for(var L=Math.trunc(O/m),V=O%m,j=0,U=0;U<i.batchSize;++U)for(var G=_;G<A;++G)for(var K=C+G*o-p,$=N;$<M;++$)j+=y.get(U,K,T+$*s-d,L)*w.get(U,G,$,O);c.set(j,C,T,L,V)}return c.toTensor()},e.prototype.tile=function(t,r){return Ie(t,"tile"),p3(this.bufferSync(t),r)},e.prototype.pad=function(t,r,i){Ie(t,"pad");var o=r.map(function(m,y){return m[0]+t.shape[y]+m[1]}),s=r.map(function(m){return m[0]}),a=this.bufferSync(t),u=Vt(o,t.dtype);0!==i&&u.values.fill(i);for(var c=0;c<t.size;c++){var d=a.indexToLoc(c),p=d.map(function(m,y){return m+s[y]});u.set.apply(u,[a.get.apply(a,d)].concat(p))}return u.toTensor()},e.prototype.transpose=function(t,r){Ie(t,"transpose");for(var i=new Array(t.rank),o=0;o<i.length;o++)i[o]=t.shape[r[o]];var s=this.readSync(t.dataId),a=Vt(i,t.dtype),u=this.bufferSync(t);for(o=0;o<t.size;++o){for(var c=u.indexToLoc(o),d=new Array(c.length),p=0;p<d.length;p++)d[p]=c[r[p]];var m=a.locToIndex(d);a.values[m]=s[o]}return a.toTensor()},e.prototype.gather=function(t,r,i){Ie([t,r],"gather");var o=t.shape.slice(),s=this.readSync(r.dataId);o[i]=s.length;for(var a=Vt(o,t.dtype),u=this.bufferSync(t),c=0;c<a.size;++c){var d=a.indexToLoc(c),p=d.slice();p[i]=s[d[i]];var m=u.locToIndex(p);a.values[c]=u.values[m]}return a.toTensor()},e.prototype.batchToSpaceND=function(t,r,i){Ie([t],"batchToSpaceND");var o=r.reduce(function(p,m){return p*m}),s=D1(t.shape,r,o),a=S1(s.length,r.length),u=T1(t.shape,r,o),c=t3(i,r.length),d=n3(u,i,r.length);return t.reshape(s).transpose(a).reshape(u).slice(c,d)},e.prototype.spaceToBatchND=function(t,r,i){Ie([t],"spaceToBatchND");var o=r.reduce(function(m,y){return m*y}),s=[[0,0]];s.push.apply(s,i);for(var a=1+r.length;a<t.shape.length;++a)s.push([0,0]);var u=t.pad(s),c=D1(u.shape,r,o,!1),d=S1(c.length,r.length,!1),p=T1(u.shape,r,o,!1);return u.reshape(c).transpose(d).reshape(p)},e.prototype.pool=function(t,r,i){Ie(t,"pool");for(var o=r.strideHeight,s=r.strideWidth,a=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=r.padInfo.top,m=r.padInfo.left,y="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=this.readSync(t.dataId),C=Vt(r.outShape,t.dtype),_=C.values,A=r.outShape[1]*r.outShape[2]*r.outShape[3],T=r.outShape[2]*r.outShape[3],N=r.outShape[3],M=0;M<r.batchSize;++M)for(var O=M*A,L=M*t.strides[0],V=0;V<r.inChannels;++V)for(var j=0;j<r.outHeight;++j)for(var U=j*o-p,G=Math.max(0,U),K=Math.min(r.inHeight,c+U),$=O+j*T,he=0;he<r.outWidth;++he){for(var de=he*s-m,se=Math.max(0,de),fe=Math.min(r.inWidth,d+de),we=y,ye=0,Ee=0,Se=G;Se<K;Se+=a){for(var je=L+Se*t.strides[1],et=se;et<fe;et+=u){var dt=w[je+et*t.strides[2]+V];"max"===i&&dt>we?we=dt:"avg"===i&&(ye+=dt,Ee++)}if(isNaN(we))break}_[$+he*N+V]="avg"===i?ye/Ee:we}return C.toTensor()},e.prototype.maxPool=function(t,r){return this.pool(t,r,"max")},e.prototype.maxPoolPositions=function(t,r){for(var i=Vt(r.outShape,"int32"),o=r.strideHeight,s=r.strideWidth,a=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=r.padInfo.top,m=r.padInfo.left,y=this.bufferSync(t),w=0;w<r.batchSize;++w)for(var C=0;C<r.inChannels;++C)for(var _=0;_<r.outHeight;++_){for(var A=_*o-p,T=A;T<0;)T+=a;for(var N=Math.min(r.inHeight,c+A),M=0;M<r.outWidth;++M){for(var O=M*s-m,L=O;L<0;)L+=u;for(var V=Math.min(r.inWidth,d+O),j=Number.NEGATIVE_INFINITY,U=-1,G=T;G<N;G+=a)for(var K=G-A,$=L;$<V;$+=u){var he=$-O,de=y.get(w,G,$,C);de>j&&(j=de,U=K*d+he)}i.set(U,w,_,M,C)}}return i.toTensor()},e.prototype.maxPoolBackprop=function(t,r,i,o){Ie([r,i],"maxPoolBackprop");for(var s=this.maxPoolPositions(r,o),a=o.strideHeight,u=o.strideWidth,c=o.dilationHeight,d=o.dilationWidth,p=o.effectiveFilterHeight,m=o.effectiveFilterWidth,y=m-1-o.padInfo.left,w=p-1-o.padInfo.top,C=Vt(r.shape,"float32"),_=this.bufferSync(s),A=this.bufferSync(t),T=0;T<o.batchSize;++T)for(var N=0;N<o.inChannels;++N)for(var M=0;M<o.inHeight;++M)for(var O=0;O<o.inWidth;++O){for(var L=M-w,V=O-y,j=0,U=0;U<p;U+=c){var G=(L+U)/a;if(!(G<0||G>=o.outHeight||Math.floor(G)!==G))for(var K=0;K<m;K+=d){var $=(V+K)/u;if(!($<0||$>=o.outWidth||Math.floor($)!==$)){var he=p*m-1-_.get(T,G,$,N)===U*m+K?1:0;0!==he&&(j+=A.get(T,G,$,N)*he)}}}C.set(j,T,M,O,N)}return C.toTensor()},e.prototype.avgPoolBackprop=function(t,r,i){Ie([t,r],"avgPoolBackprop");for(var o=i.strideHeight,s=i.strideWidth,a=i.filterHeight,u=i.filterWidth,c=i.dilationHeight,d=i.dilationWidth,p=i.effectiveFilterHeight,m=i.effectiveFilterWidth,y=m-1-i.padInfo.left,w=p-1-i.padInfo.top,C=Vt(r.shape,"float32"),_=1/(a*u),A=this.bufferSync(t),T=0;T<i.batchSize;++T)for(var N=0;N<i.inChannels;++N)for(var M=0;M<i.inHeight;++M)for(var O=0;O<i.inWidth;++O){for(var L=M-w,V=O-y,j=0,U=0;U<p;U+=c){var G=(L+U)/o;if(!(G<0||G>=i.outHeight||Math.floor(G)!==G))for(var K=0;K<m;K+=d){var $=(V+K)/s;$<0||$>=i.outWidth||Math.floor($)!==$||(j+=A.get(T,G,$,N))}}C.set(j*_,T,M,O,N)}return C.toTensor()},e.prototype.pool3d=function(t,r,i){Ie(t,"pool3d");for(var o=r.strideDepth,s=r.strideHeight,a=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,d=r.dilationWidth,p=r.effectiveFilterDepth,m=r.effectiveFilterHeight,y=r.effectiveFilterWidth,w=r.padInfo.front,C=r.padInfo.top,_=r.padInfo.left,A="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,T=this.readSync(t.dataId),N=Vt(r.outShape,t.dtype),M=N.values,O=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],L=r.outShape[2]*r.outShape[3]*r.outShape[4],V=r.outShape[3]*r.outShape[4],j=r.outShape[4],U=0;U<r.batchSize;++U)for(var G=U*O,K=U*t.strides[0],$=0;$<r.inChannels;++$)for(var he=0;he<r.outDepth;++he){for(var de=he*o-w,se=de;se<0;)se+=u;for(var fe=Math.min(r.inDepth,p+de),we=G+he*L,ye=0;ye<r.outHeight;++ye){for(var Ee=ye*s-C,Se=Ee;Se<0;)Se+=c;for(var je=Math.min(r.inHeight,m+Ee),et=we+ye*V,dt=0;dt<r.outWidth;++dt){for(var zt=dt*a-_,Gt=zt;Gt<0;)Gt+=d;for(var dn=Math.min(r.inWidth,y+zt),On=et+dt*j,wn=A,kn=0,ni=0,_n=se;_n<fe;_n+=u){for(var nr=K+_n*t.strides[1],Hn=Se;Hn<je;Hn+=c){for(var qr=nr+Hn*t.strides[2],Pr=Gt;Pr<dn;Pr+=d){var Fr=T[qr+Pr*t.strides[3]+$];if("max"===i&&Fr>wn?wn=Fr:"avg"===i&&(kn+=Fr,ni++),isNaN(wn))break}if(isNaN(wn))break}if(isNaN(wn))break}M[On+$]="avg"===i?kn/ni:wn}}}return N.toTensor()},e.prototype.avgPool3d=function(t,r){return Ie(t,"avgPool3d"),this.pool3d(t,r,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,r,i){Ie([t,r],"avgPool3dBackprop");for(var o=i.strideDepth,s=i.strideHeight,a=i.strideWidth,u=i.filterDepth,c=i.filterHeight,d=i.filterWidth,p=i.dilationDepth,m=i.dilationHeight,y=i.dilationWidth,w=i.effectiveFilterDepth,C=i.effectiveFilterHeight,_=i.effectiveFilterWidth,A=w-1-i.padInfo.front,T=_-1-i.padInfo.left,N=C-1-i.padInfo.top,M=Vt(r.shape,"float32"),O=1/(u*c*d),L=this.bufferSync(t),V=0;V<i.batchSize;++V)for(var j=0;j<i.inChannels;++j)for(var U=0;U<i.inDepth;++U)for(var G=0;G<i.inHeight;++G)for(var K=0;K<i.inWidth;++K){for(var $=U-A,he=G-N,de=K-T,se=0,fe=0;fe<w;fe+=p){var we=($+fe)/o;if(!(we<0||we>=i.outDepth||Math.floor(we)!==we))for(var ye=0;ye<C;ye+=m){var Ee=(he+ye)/s;if(!(Ee<0||Ee>=i.outHeight||Math.floor(Ee)!==Ee))for(var Se=0;Se<_;Se+=y){var je=(de+Se)/a;je<0||je>=i.outWidth||Math.floor(je)!==je||(se+=L.get(V,we,Ee,je,j))}}}M.set(se*O,V,U,G,K,j)}return M.toTensor()},e.prototype.maxPool3d=function(t,r){return Ie(t,"maxPool3d"),this.pool3d(t,r,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,r){for(var i=Vt(r.outShape,"int32"),o=r.strideDepth,s=r.strideHeight,a=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,d=r.dilationWidth,p=r.effectiveFilterDepth,m=r.effectiveFilterHeight,y=r.effectiveFilterWidth,w=r.padInfo.front,C=r.padInfo.top,_=r.padInfo.left,A=this.bufferSync(t),T=0;T<r.batchSize;++T)for(var N=0;N<r.inChannels;++N)for(var M=0;M<r.outDepth;++M){for(var O=M*o-w,L=O;L<0;)L+=u;for(var V=Math.min(r.inDepth,p+O),j=0;j<r.outHeight;++j){for(var U=j*s-C,G=U;G<0;)G+=c;for(var K=Math.min(r.inHeight,m+U),$=0;$<r.outWidth;++$){for(var he=$*a-_,de=he;de<0;)de+=d;for(var se=Math.min(r.inWidth,y+he),fe=Number.NEGATIVE_INFINITY,we=-1,ye=L;ye<V;ye+=u)for(var Ee=ye-O,Se=G;Se<K;Se+=c)for(var je=Se-U,et=de;et<se;et+=d){var dt=et-he,zt=A.get(T,ye,Se,et,N);zt>=fe&&(fe=zt,we=Ee*m*y+je*m+dt)}i.set(we,T,M,j,$,N)}}}return i.toTensor()},e.prototype.maxPool3dBackprop=function(t,r,i,o){Ie([r,i],"maxPool3dBackprop");for(var s=this.maxPool3dPositions(r,o),a=o.strideDepth,u=o.strideHeight,c=o.strideWidth,d=o.dilationDepth,p=o.dilationHeight,m=o.dilationWidth,y=o.effectiveFilterDepth,w=o.effectiveFilterHeight,C=o.effectiveFilterWidth,_=y-1-o.padInfo.front,A=C-1-o.padInfo.left,T=w-1-o.padInfo.top,N=Vt(r.shape,"float32"),M=this.bufferSync(s),O=this.bufferSync(t),L=0;L<o.batchSize;++L)for(var V=0;V<o.inChannels;++V)for(var j=0;j<o.inDepth;++j)for(var U=0;U<o.inHeight;++U)for(var G=0;G<o.inWidth;++G){for(var K=j-_,$=U-T,he=G-A,de=0,se=0;se<y;se+=d){var fe=(K+se)/a;if(!(fe<0||fe>=o.outDepth||Math.floor(fe)!==fe))for(var we=0;we<w;we+=p){var ye=($+we)/u;if(!(ye<0||ye>=o.outHeight||Math.floor(ye)!==ye))for(var Ee=0;Ee<C;Ee+=m){var Se=(he+Ee)/c;if(!(Se<0||Se>=o.outWidth||Math.floor(Se)!==Se)){var je=y*w*C-1-M.get(L,fe,ye,Se,V)===se*w*C+we*C+Ee?1:0;0!==je&&(de+=O.get(L,fe,ye,Se,V)*je)}}}}N.set(de,L,j,U,G,V)}return N.toTensor()},e.prototype.cast=function(t,r){return vw(t,r,this)},e.prototype.reshape=function(t,r){return F1(t,r)},e.prototype.avgPool=function(t,r){return Ie(t,"avgPool"),this.pool(t,r,"avg").toFloat()},e.prototype.resizeBilinear=function(t,r,i,o){Ie(t,"resizeBilinear");for(var s=t.shape,a=s[0],u=s[1],c=s[2],d=s[3],p=this.readSync(t.dataId),m=new Float32Array(st([a,r,i,d])),y=[o&&r>1?u-1:u,o&&i>1?c-1:c],w=[o&&r>1?r-1:r,o&&i>1?i-1:i],C=0,_=y[0]/w[0],A=y[1]/w[1],T=0;T<a;T++)for(var N=0;N<r;N++)for(var M=_*N,O=Math.floor(M),L=M-O,V=Math.min(u-1,Math.ceil(M)),j=T*t.strides[0]+O*t.strides[1],U=T*t.strides[0]+V*t.strides[1],G=0;G<i;G++)for(var K=A*G,$=Math.floor(K),he=K-$,de=Math.min(c-1,Math.ceil(K)),se=j+$*t.strides[2],fe=U+$*t.strides[2],we=j+de*t.strides[2],ye=U+de*t.strides[2],Ee=0;Ee<d;Ee++){var Se=p[se+Ee],je=p[fe+Ee],et=Se+(p[we+Ee]-Se)*he;m[C++]=et+(je+(p[ye+Ee]-je)*he-et)*L}return Xi(m,[a,r,i,d])},e.prototype.resizeBilinearBackprop=function(t,r,i){Ie([t,r],"resizeBilinearBackprop");for(var o=r.shape,s=o[0],a=o[1],u=o[2],c=o[3],d=t.shape,p=d[1],m=d[2],y=new Float32Array(s*a*u*c),w=[i&&p>1?a-1:a,i&&m>1?u-1:u],C=[i&&p>1?p-1:p,i&&m>1?m-1:m],_=w[0]/C[0],A=w[1]/C[1],T=this.readSync(t.dataId),N=0,M=0;M<s;M++)for(var O=M*r.strides[0],L=0;L<p;L++)for(var V=L*_,j=Math.floor(V),U=Math.min(Math.ceil(V),a-1),G=O+j*r.strides[1],K=O+U*r.strides[1],$=V-j,he=1-$,de=0;de<m;de++)for(var se=de*A,fe=Math.floor(se),we=Math.min(Math.ceil(se),u-1),ye=se-fe,Ee=1-ye,Se=G+fe*r.strides[2],je=G+we*r.strides[2],et=K+fe*r.strides[2],dt=K+we*r.strides[2],zt=he*Ee,Gt=he*ye,dn=$*Ee,On=$*ye,wn=0;wn<c;wn++){var kn=T[N++];y[Se+wn]+=kn*zt,y[je+wn]+=kn*Gt,y[et+wn]+=kn*dn,y[dt+wn]+=kn*On}return Po(y,[s,u,a,c],r.dtype)},e.prototype.resizeNearestNeighbor=function(t,r,i,o){Ie(t,"resizeNearestNeighbor");for(var s=t.shape,a=s[0],u=s[1],c=s[2],d=s[3],p=this.readSync(t.dataId),m=new Float32Array(a*r*i*d),y=[o&&r>1?u-1:u,o&&i>1?c-1:c],w=[o&&r>1?r-1:r,o&&i>1?i-1:i],C=y[0]/w[0],_=y[1]/w[1],A=0,T=0;T<a;T++)for(var N=T*t.strides[0],M=0;M<r;M++)for(var O=C*M,L=N+Math.min(u-1,o?Math.round(O):Math.floor(O))*t.strides[1],V=0;V<i;V++)for(var j=_*V,U=L+Math.min(c-1,o?Math.round(j):Math.floor(j))*t.strides[2],G=0;G<d;G++)m[A++]=p[U+G];return Xi(m,[a,r,i,d],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,r,i){Ie([t,r],"resizeNearestNeighborBackprop");for(var o=r.shape,s=o[0],a=o[1],u=o[2],c=o[3],d=t.shape,p=d[1],m=d[2],y=new Float32Array(s*a*u*c),w=this.readSync(t.dataId),C=[i&&p>1?a-1:a,i&&m>1?u-1:u],_=[i&&p>1?p-1:p,i&&m>1?m-1:m],A=C[0]/_[0],T=C[1]/_[1],N=1/A,M=1/T,O=2*Math.ceil(N)+2,L=2*Math.ceil(M)+2,V=0;V<s;V++)for(var j=V*r.strides[0],U=0;U<a;U++)for(var G=j+U*r.strides[1],K=Math.floor(U*N),$=Math.floor(K-O/2),he=0;he<u;he++)for(var de=G+he*r.strides[2],se=Math.floor(he*M),fe=Math.floor(se-L/2),we=0;we<c;we++){for(var ye=0,Ee=0;Ee<O;Ee++){var Se=Ee+$;if(!(Se<0||Se>=p)){var je=j+Se*t.strides[1],et=Se*A;if(U===Math.min(a-1,i?Math.round(et):Math.floor(et)))for(var dt=0;dt<L;dt++){var zt=dt+fe;if(!(zt<0||zt>=m)){var Gt=je+zt*t.strides[2],dn=zt*T;he===Math.min(u-1,i?Math.round(dn):Math.floor(dn))&&(ye+=w[Gt+we])}}}}y[de+we]=ye}return Po(y,r.shape,r.dtype)},e.prototype.batchNormalization=function(t,r,i,o,s,a){Ie([t,r,i,s,a],"batchNorm");for(var u=this.readSync(t.dataId),c=this.readSync(r.dataId),d=this.readSync(i.dataId),p=s?this.readSync(s.dataId):new Float32Array([1]),m=a?this.readSync(a.dataId):new Float32Array([0]),y=new Float32Array(u.length),w=m.length,C=p.length,_=d.length,A=c.length,T=0,N=0,M=0,O=0,L=0;L<u.length;++L)y[L]=m[T++]+(u[L]-c[N++])*p[M++]/Math.sqrt(d[O++]+o),T>=w&&(T=0),N>=A&&(N=0),M>=C&&(M=0),O>=_&&(O=0);return Po(y,t.shape)},e.prototype.localResponseNormalization4D=function(t,r,i,o,s){Ie(t,"localResponseNormalization4D");var a=t.shape[3],u=a-1,c=this.readSync(t.dataId),d=t.size,p=new Float32Array(d);function m(_){for(var A=_%a,T=_-A+Math.max(0,A-r),N=_-A+Math.min(A+r,u),M=0;T<=N;T++){var O=c[T];M+=O*O}return M}for(var y=0;y<d;y++){var w=m(y),C=c[y]*Math.pow(i+o*w,-s);p[y]=C}return Po(p,t.shape)},e.prototype.LRNGrad=function(t,r,i,o,s,a,u){Ie(t,"LRNGrad");for(var c=t.shape[3],d=this.readSync(t.dataId),p=this.readSync(r.dataId),m=this.readSync(i.dataId),y=new Float32Array(t.size),w=t.size,C=0;C<w;C++){for(var _=C%c,A=C-_+Math.max(0,_-o),T=C-_+Math.min(c,_+o+1),N=0,M=A;M<T;M++)N+=Math.pow(p[M],2);for(N=a*N+s,M=A;M<T;M++){var O=-2*a*u*p[M]*m[C]/N;C===M&&(O+=Math.pow(N,-u)),y[M]+=O*=d[C]}}return Po(y,t.shape)},e.prototype.multinomial=function(t,r,i,o){Ie(t,"multinomial");for(var s=r?t:Eu(t),a=s.shape[0],u=s.shape[1],c=xr([a,i],"int32"),d=this.readSync(c.dataId),p=this.readSync(s.dataId),m=0;m<a;++m){var y=m*u,w=new Float32Array(u-1);w[0]=p[y];for(var C=1;C<w.length;++C)w[C]=w[C-1]+p[y+C];for(var _=A1(o.toString()),A=m*i,T=0;T<i;++T){var N=_();d[A+T]=w.length;for(var M=0;M<w.length;M++)if(N<w[M]){d[A+T]=M;break}}}return c},e.prototype.oneHot=function(t,r,i,o){Ie(t,"oneHot");var s=new Float32Array(t.size*r);s.fill(o);for(var a=this.readSync(t.dataId),u=0;u<t.size;++u)a[u]>=0&&a[u]<r&&(s[u*r+a[u]]=i);return Cc(s,[t.size,r],"int32")},e.prototype.nonMaxSuppression=function(t,r,i,o,s){return Ie(t,"nonMaxSuppression"),bw(this.readSync(t.dataId),this.readSync(r.dataId),i,o,s)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,r){for(var i=t.shape[0],o=t.shape[1],s=Vt(t.shape,"float32"),a=Vt(t.shape,"float32"),u=vs(t).as2D(i,o),c=za(t).as2D(i,o),d=0;d<i;d++)for(var p=u.slice([d,0],[1,o]),m=c.slice([d,0],[1,o]),y=Yi(p,m),w=this.readSync(this.fftImpl(y,r).dataId),C=0;C<o;C++){var _=l3(w,C);s.values[d*o+C]=_.real,a.values[d*o+C]=_.imag}return Yi(s.toTensor(),a.toTensor()).as2D(i,o)},e.prototype.fftImpl=function(t,r){var i=t.as1D(),o=i.size;if(this.isExponentOf2(o)){var s=this.fftRadix2(i,o,r).as2D(t.shape[0],t.shape[1]);return r&&(s=Yi(vs(s).div(Ue(o)),za(s).div(Ue(o)))),s}var a=this.readSync(t.dataId),u=function(c){for(var d=new Float32Array(c.length/2),p=new Float32Array(c.length/2),m=0;m<c.length;m+=2)d[m/2]=c[m],p[m/2]=c[m+1];return{real:d,imag:p}}(this.fourierTransformByMatmul(a,o,r));return Yi(u.real,u.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return 0==(t&t-1)},e.prototype.fftRadix2=function(t,r,i){if(1===r)return t;var o=this.readSync(t.dataId),s=r/2,a=function(A){for(var T=Math.ceil(A.length/4),N=new Float32Array(T),M=new Float32Array(T),O=0;O<A.length;O+=4)N[Math.floor(O/4)]=A[O],M[Math.floor(O/4)]=A[O+1];return{real:N,imag:M}}(o),u=Yi(a.real,a.imag).as1D(),c=function(A){for(var T=Math.floor(A.length/4),N=new Float32Array(T),M=new Float32Array(T),O=2;O<A.length;O+=4)N[Math.floor(O/4)]=A[O],M[Math.floor(O/4)]=A[O+1];return{real:N,imag:M}}(o),d=Yi(c.real,c.imag).as1D();u=this.fftRadix2(u,s,i),d=this.fftRadix2(d,s,i);var p=function(A,T){for(var N=new Float32Array(A/2),M=new Float32Array(A/2),O=0;O<Math.ceil(A/2);O++){var L=(T?2:-2)*Math.PI*(O/A);N[O]=Math.cos(L),M[O]=Math.sin(L)}return{real:N,imag:M}}(r,i),m=Yi(p.real,p.imag).mul(d),y=u.add(m),w=u.sub(m),C=vs(y).concat(vs(w)),_=za(y).concat(za(w));return Yi(C,_).as1D()},e.prototype.fourierTransformByMatmul=function(t,r,i){for(var o=new Float32Array(2*r),s=0;s<r;s++){for(var a=0,u=0,c=0;c<r;c++){var d=yX(s*c,r,i),p=l3(t,c);a+=p.real*d.real-p.imag*d.imag,u+=p.real*d.imag+p.imag*d.real}i&&(a/=r,u/=r),vX(o,a,u,s)}return o},e.prototype.depthToSpace=function(t,r,i){X("NHWC"===i,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+i}),X(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var o=t.shape[0],s=t.shape[1],a=t.shape[2],u=t.shape[3],c=s*r,d=a*r,p=u/(r*r),m=this.readSync(t.dataId),y=new Float32Array(o*c*d*p),w=0,C=0;C<o;++C)for(var _=0;_<c;++_)for(var A=Math.floor(_/r),T=_%r,N=0;N<d;++N)for(var M=Math.floor(N/r),O=(T*r+N%r)*p,L=0;L<p;++L)y[w++]=m[L+O+u*(M+a*(A+s*C))];return Po(y,[o,c,d,p])},e.prototype.broadcastedBinaryOp=function(t,r,i,o){var s=sn(t.shape,r.shape),a=Vt(s,i),u=this.readSync(t.dataId),c=this.readSync(r.dataId),d=Iu(t.shape,s),p=Iu(r.shape,s),m=a.values;if(d.length+p.length===0)for(var y=0;y<m.length;++y)m[y]=o(u[y%u.length],c[y%c.length]);else{var w=this.bufferSync(t),C=this.bufferSync(r),_=function(A){var T=a.indexToLoc(A),N=T.slice(-t.rank);d.forEach(function(V){return N[V]=0});var M=w.locToIndex(N),O=T.slice(-r.rank);p.forEach(function(V){return O[V]=0});var L=C.locToIndex(O);m[A]=o(u[M],c[L])};for(y=0;y<m.length;++y)_(y)}return a.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,r,i){var o=sn(t.shape,r.shape),s=Vt(o,"float32"),a=Vt(o,"float32"),u=this.readSync(t.dataId),c=this.readSync(r.dataId),d=Iu(t.shape,o),p=Iu(r.shape,o),m=s.values,y=a.values;if(d.length+p.length===0)for(var w=0;w<m.length;w++){var C=w%u.length,_=w%c.length,A=i(u[2*C],u[2*C+1],c[2*_],c[2*_+1]);m[w]=A.real,y[w]=A.imag}else{var T=this.bufferSync(this.data.get(t.dataId).complexTensors.real),N=this.bufferSync(this.data.get(r.dataId).complexTensors.real),M=function(O){var L=s.indexToLoc(O),V=L.slice(-t.rank);d.forEach(function($){return V[$]=0});var j=T.locToIndex(V),U=L.slice(-r.rank);p.forEach(function($){return U[$]=0});var G=N.locToIndex(U),K=i(u[2*j],u[2*j+1],c[2*G],c[2*G+1]);m[O]=K.real,y[O]=K.imag};for(w=0;w<m.length;w++)M(w)}return this.complex(s.toTensor(),a.toTensor())},e.prototype.split=function(t,r,i){return f3(t,r,i)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,r,i,o,s,a){for(var u=t.shape,c=u[0],d=u[1],p=u[2],m=u[3],y=r.shape[0],w=o[0],C=o[1],_=Vt([y,w,C,m],"float32"),A=this.readSync(r.dataId),T=this.readSync(i.dataId),N=this.readSync(t.dataId),M=t.strides,O=_.strides,L=0;L<y;L++){var V=4*L,j=A[V],U=A[V+1],G=A[V+2],K=A[V+3],$=T[L];if(!($>=c))for(var he=w>1?(G-j)*(d-1)/(w-1):0,de=C>1?(K-U)*(p-1)/(C-1):0,se=0;se<w;se++){var fe=w>1?j*(d-1)+se*he:.5*(j+G)*(d-1);if(fe<0||fe>d-1)for(var we=0;we<C;we++)for(var ye=0;ye<m;ye++){var Ee=ye+we*O[2]+se*O[1]+L*O[0];_.values[Ee]=a}else if("bilinear"===s){var Se=Math.floor(fe),je=Math.ceil(fe),et=fe-Se;for(we=0;we<C;we++)if((_n=C>1?U*(p-1)+we*de:.5*(U+K)*(p-1))<0||_n>p-1)for(ye=0;ye<m;ye++)_.values[Ee=ye+we*O[2]+se*O[1]+L*O[0]]=a;else{var dt=Math.floor(_n),zt=Math.ceil(_n),Gt=_n-dt;for(ye=0;ye<m;ye++){var dn=N[Ee=ye+dt*M[2]+Se*M[1]+$*M[0]],On=N[Ee=ye+zt*M[2]+Se*M[1]+$*M[0]],wn=N[Ee=ye+dt*M[2]+je*M[1]+$*M[0]],kn=dn+(On-dn)*Gt,ni=wn+(N[Ee=ye+zt*M[2]+je*M[1]+$*M[0]]-wn)*Gt;_.values[Ee=ye+we*O[2]+se*O[1]+L*O[0]]=kn+(ni-kn)*et}}}else for(we=0;we<C;++we){var _n;if((_n=C>1?U*(p-1)+we*de:.5*(U+K)*(p-1))<0||_n>p-1)for(ye=0;ye<m;ye++)_.values[Ee=ye+we*O[2]+se*O[1]+L*O[0]]=a;else{var nr=Math.round(_n),Hn=Math.round(fe);for(ye=0;ye<m;ye++)_.values[ye+we*O[2]+se*O[1]+L*O[0]]=N[ye+nr*M[2]+Hn*M[1]+$*M[0]]}}}}return _.toTensor()},e.prototype.sparseToDense=function(t,r,i,o){var s=Cp(0,t,i);return this.scatter(t,r,i,s.outputSize,s.sliceSize,s.numUpdates,s.sliceRank,s.strides,o,!1)},e.prototype.gatherND=function(t,r){var i=r.shape,o=i[i.length-1],s=lw(t,r),a=s[0],u=s[1],c=s[2],d=s[3];if(0===u)return Xi([],a,t.dtype);for(var p=new fp([u,c],t.dtype),m=this.readSync(r.dataId),y=this.readSync(t.dataId),w=0;w<u;w++){for(var C=[],_=0,A=0;A<o;A++){var T=m[w*o+A];_+=T*d[A],C.push(T)}if(_<0||_>=t.size/c)throw new Error("Invalid indices: "+C+" does not index into "+t.shape);for(var N=0;N<c;N++)p.values[w*c+N]=y[_*c+N]}return p.toTensor().reshape(a)},e.prototype.scatterND=function(t,r,i){var o=Cp(0,t,i),s=o.sliceRank,a=o.numUpdates,u=o.sliceSize,c=o.strides,d=o.outputSize,p=Ue(0);return this.scatter(t,r,i,d,u,a,s,c,p,!0)},e.prototype.fill=function(t,r,i){var o=up(i=i||rd(r),st(t));return o.fill(r),Z.makeTensor(o,t,i,this)},e.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var r=up(t.dtype,st(t.shape));return this.makeOutput(r,t.shape,t.dtype)},e.prototype.linspace=function(t,r,i){return yw(t,r,i)},e.prototype.scatter=function(t,r,i,o,s,a,u,c,d,p){var m=[o/s,s],y=this.readSync(t.dataId),w=this.readSync(r.dataId);if(0===o)return Xi([],i,r.dtype);var C=new fp(m,r.dtype);C.values.fill(this.readSync(d.dataId)[0]);for(var _=0;_<a;_++){for(var A=[],T=0,N=0;N<u;N++){var M=y[_*u+N];A.push(M),T+=M*c[N]}if(T<0||T>=o/s)throw new Error("Invalid indices: "+A+" does not index into "+i);for(var O=0;O<s;O++)p?C.values[T*s+O]+=w[_*s+O]:C.values[T*s+O]=0===r.rank?w[0]:w[_*s+O]}return C.toTensor().reshape(i)},e}(c3);Z.registerBackend("cpu",function(){return new wQ},1);for(var $w=0,HN=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,r=n.attrs,o=e.boxes,s=e.scores,u=r.maxOutputSize,c=r.iouThreshold,d=r.scoreThreshold,p=r.softNmsSigma,m=n.backend;Ie(o,"NonMaxSuppressionWithScore");var y=ww(m.data.get(o.dataId).values,m.data.get(s.dataId).values,u,c,d,p);return[y.selectedIndices,y.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(n){var r=n.inputs.x,i=n.backend;Ie(r,"square");for(var o=i.data.get(r.dataId).values,s=new Float32Array(o.length),a=0;a<o.length;++a){var u=o[a];s[a]=u*u}return{dataId:i.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:Tp,backendName:"cpu",kernelFunc:function(n){var e=n.inputs,i=e.a,o=e.b,s=n.backend;Ie([i,o],Tp);var a=s.data.get(i.dataId).values,u=s.data.get(o.dataId).values,c=function(m,y,w,C,_,A){var T=sn(m,y),N=T.length,M=oa(T),O=nd(_,st(T)),L=m.length,V=y.length,j=oa(m),U=oa(y),G=Iu(m,T),K=Iu(y,T);if(G.length+K.length===0)for(var $=0;$<O.length;++$)O[$]=A(w[$%w.length],C[$%C.length]);else{var he=function(de){var se=dR(de,N,M),fe=se.slice(-L);G.forEach(function(Se){return fe[Se]=0});var we=zb(fe,L,j),ye=se.slice(-V);K.forEach(function(Se){return ye[Se]=0});var Ee=zb(ye,V,U);O[de]=A(w[we],C[Ee])};for($=0;$<O.length;++$)he($)}return[O,T]}(i.shape,o.shape,a,u,i.dtype,function(m,y){var w=m-y;return w*w}),p=c[1];return{dataId:s.write(c[0],p,i.dtype),shape:p,dtype:i.dtype}}}];$w<HN.length;$w++)eR(HN[$w]);for(var pd,_Q=function(n){this.variableNames=["A"];var e=io(),t=n[0],r=n[1];this.outputShape=n,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+t+".0);\n\n        vec4 values = "+e.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},CQ=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=io(),t=n[0],r=n[1];this.outputShape=n,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+t+".0);\n            vec4 values = "+e.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+e.output+" = result;\n      }\n    "},Kw=0,zN=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(n){var t=n.backend,i=n.inputs.pixels,s="undefined"!=typeof HTMLVideoElement&&i instanceof HTMLVideoElement,a="undefined"!=typeof HTMLImageElement&&i instanceof HTMLImageElement,u=s?[i.videoWidth,i.videoHeight]:[i.width,i.height],c=u[0],d=u[1],p=[d,c],m=[d,c,n.attrs.numChannels];(a||s)&&(null==pd&&(pd=document.createElement("canvas").getContext("2d")),pd.canvas.width=c,pd.canvas.height=d,pd.drawImage(i,0,0,c,d),i=pd.canvas);var y=t.makeTensorInfo(p,"int32");t.texData.get(y.dataId).usage=Jo.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(y.dataId),i);var w=ge().getBool("WEBGL_PACK")?new CQ(m):new _Q(m),C=t.runWebGLProgram(w,[y],"int32");return t.disposeData(y.dataId),C}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs;C1("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var s=e.scores,u=r.maxOutputSize,c=r.iouThreshold,d=r.scoreThreshold,p=r.softNmsSigma,m=t,y=ww(m.readSync(e.boxes.dataId),m.readSync(s.dataId),u,c,d,p);return[y.selectedIndices,y.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(n){var r=n.inputs.x,i=n.backend,o=new qt(r.shape,"return x * x;");return i.runWebGLProgram(o,[r],r.dtype)}},{kernelName:Tp,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,i=e.a,o=e.b,s=n.backend,a=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Au("return (a - b) * (a - b);",i.shape,o.shape):new Yr("return (a - b) * (a - b);",i.shape,o.shape);return s.compileAndRun(a,[i,o])}}];Kw<zN.length;Kw++)eR(zN[Kw]);for(var Qw=0,GN=[{kernelName:"Square",gradFunc:function(n,e){var t=e[0];return{x:function(){return n.mul(t.toFloat().mul(2))}}}},{kernelName:Tp,gradFunc:function(n,e){var t=e[0],r=e[1],i=Ue(2);return{a:function(){return oo(n,oo(i,Ei(t,r)))},b:function(){return oo(n,oo(i,Ei(r,t)))}}}}];Qw<GN.length;Qw++)AY(GN[Qw]);var EQ=function(){function n(){}return n.prototype.fetch=function(e,t){return fetch(e,t)},n.prototype.now=function(){return performance.now()},n.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},n}();ge().get("IS_BROWSER")&&ge().setPlatform("browser",new EQ);var Zw,AQ=function(){function n(){this.util=me(118),this.textEncoder=new this.util.TextEncoder}return n.prototype.fetch=function(e,t){return null!=ge().global.fetch?ge().global.fetch(e,t):(null==Zw&&(Zw=me(655)),Zw(e,t))},n.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},n.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)},n}();ge().get("IS_NODE")&&ge().setPlatform("node",new AQ);var Jw={float32:4,int32:4,uint16:2,uint8:1,bool:1};function YN(n,e){for(var t={},r=0,i=function(a){var u=a.name,c=a.dtype,d=a.shape,p=st(d),m=void 0;if("quantization"in a){var y=a.quantization;if("uint8"!==y.dtype&&"uint16"!==y.dtype)throw new Error("Weight "+a.name+" has unknown quantization dtype "+y.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var w=Jw[y.dtype],C=n.slice(r,r+p*w),_="uint8"===y.dtype?new Uint8Array(C):new Uint16Array(C);if("float32"===c)m=Float32Array.from(_,function(L){return L*y.scale+y.min});else{if("int32"!==c)throw new Error("Unsupported dtype in weight '"+u+"': "+c);m=Int32Array.from(_,function(L){return Math.round(L*y.scale+y.min)})}r+=p*w}else if("string"===c){var A=st(a.shape);m=[];for(var T=0;T<A;T++){var N=new Uint32Array(n.slice(r,r+4))[0];r+=4;var M=new Uint8Array(n.slice(r,r+N));m.push(M),r+=N}}else{var O=Jw[c];if(C=n.slice(r,r+p*O),"float32"===c)m=new Float32Array(C);else if("int32"===c)m=new Int32Array(C);else{if("bool"!==c)throw new Error("Unsupported dtype in weight '"+u+"': "+c);m=new Uint8Array(C)}r+=p*O}t[u]=Xi(m,d,c)},o=0,s=e;o<s.length;o++)i(s[o]);return t}function DQ(n){if(null===n)throw new Error("Invalid input value: "+JSON.stringify(n));var e=0,t=[];n.forEach(function(o){if(e+=o.byteLength,t.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+o.constructor.name)});var r=new Uint8Array(e),i=0;return t.forEach(function(o){r.set(new Uint8Array(o.buffer),i),i+=o.byteLength}),r.buffer}var e2="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function XN(n){return e2?Buffer.byteLength(n):new Blob([n]).size}function t2(n){var e=0;n.forEach(function(i){e+=i.byteLength});var t=new Uint8Array(e),r=0;return n.forEach(function(i){t.set(new Uint8Array(i),r),r+=i.byteLength}),t.buffer}function qN(n){for(n=n.trim();n.endsWith("/");)n=n.slice(0,n.length-1);var e=n.split("/");return e[e.length-1]}function Op(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==n.modelTopology?0:XN(JSON.stringify(n.modelTopology)),weightSpecsBytes:null==n.weightSpecs?0:XN(JSON.stringify(n.weightSpecs)),weightDataBytes:null==n.weightData?0:n.weightData.byteLength}}var rs=function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return null==n.instance&&(n.instance=new n),n.instance},n.registerSaveRouter=function(e){n.getInstance().saveRouters.push(e)},n.registerLoadRouter=function(e){n.getInstance().loadRouters.push(e)},n.getSaveHandlers=function(e){return n.getHandlers(e,"save")},n.getLoadHandlers=function(e,t){return n.getHandlers(e,"load",t)},n.getHandlers=function(e,t,r){var i=[];return("load"===t?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach(function(o){var s=o(e,r);null!==s&&i.push(s)}),i},n}(),gd="://",Ac=function(){function n(){this.managers={}}return n.getInstance=function(){return null==n.instance&&(n.instance=new n),n.instance},n.registerManager=function(e,t){X(null!=e,function(){return"scheme must not be undefined or null."}),e.endsWith(gd)&&(e=e.slice(0,e.indexOf(gd))),X(e.length>0,function(){return"scheme must not be an empty string."});var r=n.getInstance();X(null==r.managers[e],function(){return"A model store manager is already registered for scheme '"+e+"'."}),r.managers[e]=t},n.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n}();function Z1(n){if(-1===n.indexOf(gd))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Ac.getSchemes().join(","));return{scheme:n.split(gd)[0],path:n.split(gd)[1]}}function $N(n,e,t){return void 0===t&&(t=!1),tt(this,void 0,void 0,function(){var r,i,o,s,a,u,c,d,p;return nt(this,function(m){switch(m.label){case 0:return X(n!==e,function(){return"Old path and new path are the same: '"+n+"'"}),X((r=rs.getLoadHandlers(n)).length>0,function(){return"Copying failed because no load handler is found for source URL "+n+"."}),X(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+n+"."}),i=r[0],X((o=rs.getSaveHandlers(e)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),X(o.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."}),s=o[0],a=Z1(n).scheme,u=Z1(n).path,c=a===Z1(n).scheme,[4,i.load()];case 1:return d=m.sent(),t&&c?[4,Ac.getManager(a).removeModel(u)]:[3,3];case 2:m.sent(),m.label=3;case 3:return[4,s.save(d)];case 4:return p=m.sent(),!t||c?[3,6]:[4,Ac.getManager(a).removeModel(u)];case 5:m.sent(),m.label=6;case 6:return[2,p.modelArtifactsInfo]}})})}var Al="models_store",Dc="model_info_store";function KN(){if(!ge().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window||self,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function n2(n){var e=n.result;e.createObjectStore(Al,{keyPath:"modelPath"}),e.createObjectStore(Dc,{keyPath:"modelPath"})}var md=function(){function n(e){if(this.indexedDB=KN(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return n.prototype.save=function(e){return tt(this,void 0,void 0,function(){return nt(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},n.prototype.load=function(){return tt(this,void 0,void 0,function(){return nt(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},n.prototype.databaseAction=function(e,t){var r=this;return new Promise(function(i,o){var s=r.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return n2(s)},s.onsuccess=function(){var a=s.result;if(null==t){var u=a.transaction(Al,"readonly"),c=u.objectStore(Al).get(r.modelPath);c.onsuccess=function(){if(null==c.result)return a.close(),o(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));i(c.result.modelArtifacts)},c.onerror=function(C){return a.close(),o(c.error)},u.oncomplete=function(){return a.close()}}else{var d,p=Op(t),m=a.transaction(Dc,"readwrite"),y=m.objectStore(Dc),w=y.put({modelPath:r.modelPath,modelArtifactsInfo:p});w.onsuccess=function(){var C=(d=a.transaction(Al,"readwrite")).objectStore(Al).put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:p});C.onsuccess=function(){return i({modelArtifactsInfo:p})},C.onerror=function(_){var A=(y=m.objectStore(Dc)).delete(r.modelPath);A.onsuccess=function(){return a.close(),o(C.error)},A.onerror=function(T){return a.close(),o(C.error)}}},w.onerror=function(C){return a.close(),o(w.error)},m.oncomplete=function(){null==d?a.close():d.oncomplete=function(){return a.close()}}}},s.onerror=function(a){return o(s.error)}})},n.URL_SCHEME="indexeddb://",n}(),QN=function(n){return ge().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(md.URL_SCHEME)?(e=n.slice(md.URL_SCHEME.length),new md(e)):null;var e};rs.registerSaveRouter(QN),rs.registerLoadRouter(QN);var SQ=function(){function n(){this.indexedDB=KN()}return n.prototype.listModels=function(){return tt(this,void 0,void 0,function(){var e=this;return nt(this,function(t){return[2,new Promise(function(r,i){var o=e.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return n2(o)},o.onsuccess=function(){var s=o.result,a=s.transaction(Dc,"readonly"),u=a.objectStore(Dc).getAll();u.onsuccess=function(){for(var c={},d=0,p=u.result;d<p.length;d++){var m=p[d];c[m.modelPath]=m.modelArtifactsInfo}r(c)},u.onerror=function(c){return s.close(),i(u.error)},a.oncomplete=function(){return s.close()}},o.onerror=function(s){return i(o.error)}})]})})},n.prototype.removeModel=function(e){return tt(this,void 0,void 0,function(){var t=this;return nt(this,function(r){var i;return e=(i=e).startsWith(md.URL_SCHEME)?i.slice(md.URL_SCHEME.length):i,[2,new Promise(function(o,s){var a=t.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return n2(a)},a.onsuccess=function(){var u,c=a.result,d=c.transaction(Dc,"readwrite"),p=d.objectStore(Dc),m=p.get(e);m.onsuccess=function(){if(null==m.result)return c.close(),s(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var y=p.delete(e),w=function(){var C=(u=c.transaction(Al,"readwrite")).objectStore(Al).delete(e);C.onsuccess=function(){return o(m.result.modelArtifactsInfo)},C.onerror=function(_){return s(m.error)}};y.onsuccess=w,y.onerror=function(C){return w(),c.close(),s(m.error)}},m.onerror=function(y){return c.close(),s(m.error)},d.oncomplete=function(){null==u?c.close():u.oncomplete=function(){return c.close()}}},a.onerror=function(u){return s(a.error)}})]})})},n}();if(ge().getBool("IS_BROWSER"))try{Ac.registerManager(md.URL_SCHEME,new SQ)}catch(n){}var Su="/",vd="tensorflowjs_models",ZN="info",TQ="model_topology",MQ="weight_specs",RQ="weight_data",NQ="model_metadata";function JN(n){return{info:[vd,n,ZN].join(Su),topology:[vd,n,TQ].join(Su),weightSpecs:[vd,n,MQ].join(Su),weightData:[vd,n,RQ].join(Su),modelMetadata:[vd,n,NQ].join(Su)}}function OQ(n){var e=n.split(Su);if(e.length<3)throw new Error("Invalid key format: "+n);return e.slice(1,e.length-1).join(Su)}var yd=function(){function n(e){if(!ge().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=JN(this.modelPath)}return n.prototype.save=function(e){return tt(this,void 0,void 0,function(){var t,r,i;return nt(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),i=Op(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(s){if(e2)return Buffer.from(s).toString("base64");for(var a=new Uint8Array(s),u="",c=0,d=a.length;c<d;c++)u+=String.fromCharCode(a[c]);return btoa(u)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:i}]}catch(s){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}return[2]})})},n.prototype.load=function(){return tt(this,void 0,void 0,function(){var e,t,r,i,o,s,a;return nt(this,function(u){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(r=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=r,null==(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=i,null!=(o=this.LS.getItem(this.keys.modelMetadata))&&(s=JSON.parse(o),t.format=s.format,t.generatedBy=s.generatedBy,t.convertedBy=s.convertedBy,t.userDefinedMetadata=s.userDefinedMetadata),null==(a=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(c){if(e2){var d=Buffer.from(c,"base64");return d.buffer.slice(d.byteOffset,d.byteOffset+d.byteLength)}for(var p=atob(c),m=new Uint8Array(p.length),y=0;y<p.length;++y)m.set([p.charCodeAt(y)],y);return m.buffer}(a),[2,t]})})},n.URL_SCHEME="localstorage://",n}(),eO=function(n){return ge().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(yd.URL_SCHEME)?(e=n.slice(yd.URL_SCHEME.length),new yd(e)):null;var e};rs.registerSaveRouter(eO),rs.registerLoadRouter(eO);var kQ=function(){function n(){X(ge().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),X("undefined"==typeof window||void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return n.prototype.listModels=function(){return tt(this,void 0,void 0,function(){var e,t,r,i,o,s;return nt(this,function(a){for(e={},t=vd+Su,r=Su+ZN,i=0;i<this.LS.length;++i)(o=this.LS.key(i)).startsWith(t)&&o.endsWith(r)&&(s=OQ(o),e[s]=JSON.parse(this.LS.getItem(o)));return[2,e]})})},n.prototype.removeModel=function(e){return tt(this,void 0,void 0,function(){var t,r;return nt(this,function(i){var o;if(e=(o=e).startsWith(yd.URL_SCHEME)?o.slice(yd.URL_SCHEME.length):o,t=JN(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return r=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,r]})})},n}();if(ge().getBool("IS_BROWSER"))try{Ac.registerManager(yd.URL_SCHEME,new kQ)}catch(n){}function tO(n){return new Promise(function(e){return setTimeout(e)}).then(n)}var r2=function(){function n(e){if(!ge().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),null!=e&&0!==e.length||(e="model"),this.modelTopologyFileName=e+".json",this.weightDataFileName=e+".weights.bin"}return n.prototype.save=function(e){return tt(this,void 0,void 0,function(){var t,o,s,a;return nt(this,function(u){switch(u.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return o=window.URL.createObjectURL(new Blob([JSON.stringify({modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}]})],{type:"application/json"})),(s=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,s.href=o,[4,tO(function(){return s.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),null==e.weightData?[3,4]:((a=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,a.href=t,[4,tO(function(){return a.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:Op(e)}]}})})},n.URL_SCHEME="downloads://",n}(),BQ=function(){function n(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return n.prototype.load=function(){return tt(this,void 0,void 0,function(){var e,t,r=this;return nt(this,function(i){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(o,s){var a=new FileReader;a.onload=function(u){var c=JSON.parse(u.target.result),d=c.modelTopology;if(null!=d){0===t.length&&o({modelTopology:d});var p=c.weightsManifest;if(null!=p){var m;try{m=r.checkManifestAndWeightFiles(p,t)}catch(_){return void s(_)}var y=[],w=[],C=[];p.forEach(function(_){_.paths.forEach(function(A){w.push(A),C.push(null)}),y.push.apply(y,_.weights)}),p.forEach(function(_){_.paths.forEach(function(A){var T=new FileReader;T.onload=function(N){var M=N.target.result,O=w.indexOf(A);C[O]=M,-1===C.indexOf(null)&&o({modelTopology:d,weightSpecs:y,weightData:t2(C),format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,userDefinedMetadata:c.userDefinedMetadata})},T.onerror=function(N){return s("Failed to weights data from file of path '"+A+"'.")},T.readAsArrayBuffer(m[A])})})}else s(new Error("weightManifest field is missing from file "+e.name))}else s(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(u){return s("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)})]})})},n.prototype.checkManifestAndWeightFiles=function(e,t){for(var r=[],i=t.map(function(u){return qN(u.name)}),o={},s=0,a=e;s<a.length;s++)a[s].paths.forEach(function(u){var c=qN(u);if(-1!==r.indexOf(c))throw new Error("Duplicate file basename found in weights manifest: '"+c+"'");if(r.push(c),-1===i.indexOf(c))throw new Error("Weight file with basename '"+c+"' is not provided.");o[u]=t[i.indexOf(c)]});if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+t.length+").");return o},n}();function nO(n,e,t,r){var o;X(null!=(o=n)&&Array.isArray(o)&&o.length>0,function(){return"promises must be a none empty array"}),function(o,s){X(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+o}),X(s>=0&&s<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+s}),X(s>=o,function(){return"startFraction must be no more than endFraction, but got startFraction "+o+" and endFraction "+s})}(t=null==t?0:t,r=null==r?1:r);var i=0;return Promise.all(n.map(function(o){return o.then(function(s){var a=t+ ++i/n.length*(r-t);return e(a),s}),o}))}function rO(n,e){return tt(this,void 0,void 0,function(){var t,r,i,o,s,a,u,c,d;return nt(this,function(p){switch(p.label){case 0:return null==e&&(e={}),t=null==e.fetchFunc?ge().platform.fetch:e.fetchFunc,r=n.map(function(m){return t(m,e.requestInit,{isBinary:!0})}),i=0,o=.5,null!=e.onProgress?[3,2]:[4,Promise.all(r)];case 1:return s=p.sent(),[3,4];case 2:return[4,nO(r,e.onProgress,i,o)];case 3:s=p.sent(),p.label=4;case 4:return a=s.map(function(m){return m.arrayBuffer()}),u=.5,c=1,null!=e.onProgress?[3,6]:[4,Promise.all(a)];case 5:return d=p.sent(),[3,8];case 6:return[4,nO(a,e.onProgress,u,c)];case 7:d=p.sent(),p.label=8;case 8:return[2,d]}})})}function iO(n){var e=this;return function(t,r,i){return void 0===r&&(r=""),tt(e,void 0,void 0,function(){var o,s,a,u,c,d,p,m,y,w;return nt(this,function(C){switch(C.label){case 0:if(o=t.map(function(){return!1}),s={},a=null!=i?i.map(function(){return!1}):[],u=[],t.forEach(function(_,A){var T=0;_.weights.forEach(function(N){var O=Jw["quantization"in N?N.quantization.dtype:N.dtype]*st(N.shape),L=function(){o[A]=!0,null==s[A]&&(s[A]=[]),s[A].push({manifestEntry:N,groupOffset:T,sizeBytes:O})};null!=i?i.forEach(function(V,j){V===N.name&&(L(),a[j]=!0)}):L(),u.push(N.name),T+=O})}),!a.every(function(_){return _}))throw c=i.filter(function(_,A){return!a[A]}),new Error("Could not find weights in manifest with names: "+c.join(", ")+". \nManifest JSON has weights with names: "+u.join(", ")+".");return d=o.reduce(function(_,A,T){return A&&_.push(T),_},[]),p=[],d.forEach(function(_){t[_].paths.forEach(function(A){var T=r+(r.endsWith("/")?"":"/")+A;p.push(T)})}),[4,n(p)];case 1:return m=C.sent(),y={},w=0,d.forEach(function(_){for(var A=t[_].paths.length,T=0,N=0;N<A;N++)T+=m[w+N].byteLength;for(var M=new ArrayBuffer(T),O=new Uint8Array(M),L=0,V=0;V<A;V++){var j=new Uint8Array(m[w+V]);O.set(j,L),L+=j.byteLength}s[_].forEach(function(U){var G=YN(M.slice(U.groupOffset,U.groupOffset+U.sizeBytes),[U.manifestEntry]);for(var K in G)y[K]=G[K]}),w+=A}),[2,y]}})})}}rs.registerSaveRouter(function(n){return ge().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(r2.URL_SCHEME)?(void 0===(e=n.slice(r2.URL_SCHEME.length))&&(e="model"),new r2(e)):null;var e});var oO=function(){function n(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null!=t.fetchFunc?(X("function"==typeof t.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=ge().platform.fetch,X(null!=e&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&X(2===e.length,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(e){return tt(this,void 0,void 0,function(){var t,o;return nt(this,function(s){switch(s.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,t.body.append("model.json",new Blob([JSON.stringify({modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:[{paths:["./model.weights.bin"],weights:e.weightSpecs}]})],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((o=s.sent()).ok)return[2,{modelArtifactsInfo:Op(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},n.prototype.load=function(){return tt(this,void 0,void 0,function(){var e,t,r,i,o,s,a,u,c,d,p,m;return nt(this,function(y){switch(y.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=y.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");y.label=2;case 2:return y.trys.push([2,4,,5]),[4,e.json()];case 3:return t=y.sent(),[3,5];case 4:throw y.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(o=t.weightsManifest,s=t.generatedBy,a=t.convertedBy,u=t.format,c=t.userDefinedMetadata,null==(i=t.modelTopology)&&null==o)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==o?[3,7]:[4,this.loadWeights(o)];case 6:m=y.sent(),d=m[0],p=m[1],y.label=7;case 7:return[2,{modelTopology:i,weightSpecs:d,weightData:p,userDefinedMetadata:c,generatedBy:s,convertedBy:a,format:u}]}})})},n.prototype.loadWeights=function(e){return tt(this,void 0,void 0,function(){var r,i,o,s,a,u,c,p,m;return nt(this,function(y){switch(y.label){case 0:for(void 0,void 0,C=(w=Array.isArray(this.path)?this.path[1]:this.path).lastIndexOf("/"),_=w.lastIndexOf("?"),r=[w.substring(0,C)+"/",_>C?w.substring(_):""],i=r[0],o=r[1],s=this.weightPathPrefix||i,a=[],u=0,c=e;u<c.length;u++)a.push.apply(a,c[u].weights);return p=[],e.forEach(function(w){w.paths.forEach(function(C){p.push(s+C+o)})}),[4,rO(p,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return m=y.sent(),[2,[a,t2(m)]]}var w,C,_})})},n.URL_SCHEME_REGEX=/^https?:\/\//,n}();function i2(n){return null!=n.match(oO.URL_SCHEME_REGEX)}var sO=function(n,e){return"undefined"==typeof fetch?null:(Array.isArray(n)?n.every(function(t){return i2(t)}):i2(n))?o2(n,{onProgress:e}):null};function o2(n,e){return new oO(n,e)}rs.registerSaveRouter(sO),rs.registerLoadRouter(sO);var xd,s2=function(){function n(e){this.modelArtifacts=e}return n.prototype.load=function(){return tt(this,void 0,void 0,function(){return nt(this,function(e){return[2,this.modelArtifacts]})})},n}(),VQ=function(){function n(e){this.saveHandler=e}return n.prototype.save=function(e){return tt(this,void 0,void 0,function(){return nt(this,function(t){return[2,this.saveHandler(e)]})})},n}(),aO=Object.freeze({browserFiles:function(n){return new BQ(n)},browserHTTPRequest:function(n,e){return o2(n,e)},concatenateArrayBuffers:t2,decodeWeights:YN,encodeWeights:function(n,e){return tt(this,void 0,void 0,function(){var t,r,i,o,s,a=this;return nt(this,function(u){switch(u.label){case 0:for(t=[],r=[],i=Array.isArray(n)?n.map(function(c){return c.name}):Object.keys(n),o=function(c){var d=i[c],p=Array.isArray(n)?n[c].tensor:n[d];if("float32"!==p.dtype&&"int32"!==p.dtype&&"bool"!==p.dtype&&"string"!==p.dtype)throw new Error("Unsupported dtype in weight '"+d+"': "+p.dtype);var m={name:d,shape:p.shape,dtype:p.dtype};if("string"===p.dtype){var y=new Promise(function(w){return tt(a,void 0,void 0,function(){var C,_,A,T,N,M,O;return nt(this,function(L){switch(L.label){case 0:return[4,p.bytes()];case 1:for(C=L.sent(),_=C.reduce(function(V,j){return V+j.length},0)+4*C.length,A=new Uint8Array(_),T=0,N=0;N<C.length;N++)M=C[N],O=new Uint8Array(new Uint32Array([M.length]).buffer),A.set(O,T),A.set(M,T+=4),T+=M.length;return w(A),[2]}})})});r.push(y)}else r.push(p.data());null!=e&&(m.group=e),t.push(m)},s=0;s<i.length;++s)o(s);return[4,Promise.all(r)];case 1:return[2,{data:DQ(u.sent()),specs:t}]}})})},fromMemory:function(n,e,t,r){return 1===arguments.length?null!=n.modelTopology||null!=n.weightSpecs?new s2(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new s2({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new s2({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:r}))},getLoadHandlers:function(n,e){return rs.getLoadHandlers(n,e)},getModelArtifactsInfoForJSON:Op,getSaveHandlers:function(n){return rs.getSaveHandlers(n)},http:o2,isHTTPScheme:i2,loadWeights:function(n,e,t,r){return void 0===e&&(e=""),tt(this,void 0,void 0,function(){return nt(this,function(i){return[2,iO(function(o){return rO(o,{requestInit:r})})(n,e,t)]})})},registerLoadRouter:function(n){return rs.registerLoadRouter(n)},registerSaveRouter:function(n){return rs.registerSaveRouter(n)},weightsLoaderFactory:iO,withSaveHandler:function(n){return new VQ(n)},copyModel:function(n,e){return tt(this,void 0,void 0,function(){return nt(this,function(t){return[2,$N(n,e,!1)]})})},listModels:function(){return tt(this,void 0,void 0,function(){var n,e,t,r,i,o,s;return nt(this,function(a){switch(a.label){case 0:n=Ac.getSchemes(),e={},t=0,r=n,a.label=1;case 1:return t<r.length?[4,Ac.getManager(i=r[t]).listModels()]:[3,4];case 2:for(s in o=a.sent())e[i+gd+s]=o[s];a.label=3;case 3:return t++,[3,1];case 4:return[2,e]}})})},moveModel:function(n,e){return tt(this,void 0,void 0,function(){return nt(this,function(t){return[2,$N(n,e,!0)]})})},removeModel:function(n){return tt(this,void 0,void 0,function(){var e;return nt(this,function(t){return e=Z1(n),[2,Ac.getManager(e.scheme).removeModel(e.path)]})})}}),UQ=J({confusionMatrix_:function(n,e,t){var r=H(n,"labels","confusionMatrix"),i=H(e,"predictions","confusionMatrix");X(null==t||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, but got "+t}),X(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),X(1===i.rank,function(){return"Expected the rank of predictions to be 1, but got "+i.rank}),X(r.shape[0]===i.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."}),X(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+t});var o=cw(r.asType("int32"),t),s=cw(i.asType("int32"),t);return o.transpose().matMul(s).asType("int32")}}),jQ=(Object.freeze({confusionMatrix:UQ}),J({fromPixels_:function(n,e){if(void 0===e&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==n)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,r=!1,i=!1,o=!1,s=!1;if(n.data instanceof Uint8Array)t=!0;else if("undefined"!=typeof ImageData&&n instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&n instanceof HTMLVideoElement)i=!0;else if("undefined"!=typeof HTMLImageElement&&n instanceof HTMLImageElement)o=!0;else{if(null==n.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+n.constructor.name);s=!0}if(i&&i&&n.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=ZM("FromPixels",Z.backendName))return Z.runKernel("FromPixels",{pixels:n},{numChannels:e});var a,u,c=i?[n.videoWidth,n.videoHeight]:[n.width,n.height],d=c[0],p=c[1];if(s?a=n.getContext("2d").getImageData(0,0,d,p).data:r||t?a=n.data:(o||i)&&(null==xd&&(xd=document.createElement("canvas").getContext("2d")),xd.canvas.width=d,xd.canvas.height=p,xd.drawImage(n,0,0,d,p),a=xd.getImageData(0,0,d,p).data),4===e)u=new Int32Array(a);else{var m=d*p;u=new Int32Array(m*e);for(var y=0;y<m;y++)for(var w=0;w<e;++w)u[y*e+w]=a[4*y+w]}return sw(u,[p,d,e],"int32")}})),a2=Object.freeze({toPixels:function(n,e){return tt(this,void 0,void 0,function(){var t,r,i,o,s,a,u,c,d,y,w,C,_,A,T,N,M,O,L,V,j;return nt(this,function(U){switch(U.label){case 0:if(t=H(n,"img","toPixels"),n instanceof or||(t=t.toInt()),2!==t.rank&&3!==t.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(r=t.shape.slice(0,2),i=r[0],o=r[1],(s=2===t.rank?1:t.shape[2])>4||2===s)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+s);return[4,t.data()];case 1:return a=U.sent(),u=t.min(),c=t.max(),[4,Promise.all([u.data(),c.data()])];case 2:if(d=U.sent(),y=d[0][0],w=d[1][0],u.dispose(),c.dispose(),"float32"===t.dtype){if(y<0||w>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+y+" - "+w+"].")}else{if("int32"!==t.dtype)throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(y<0||w>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+y+" - "+w+"].")}for(C="float32"===t.dtype?255:1,_=new Uint8ClampedArray(o*i*4),A=0;A<i*o;++A)T=void 0,N=void 0,M=void 0,O=void 0,1===s?(T=a[A]*C,N=a[A]*C,M=a[A]*C,O=255):3===s?(T=a[3*A]*C,N=a[3*A+1]*C,M=a[3*A+2]*C,O=255):4===s&&(T=a[4*A]*C,N=a[4*A+1]*C,M=a[4*A+2]*C,O=a[4*A+3]*C),_[0+(L=4*A)]=Math.round(T),_[L+1]=Math.round(N),_[L+2]=Math.round(M),_[L+3]=Math.round(O);return null!=e&&(e.width=o,e.height=i,V=e.getContext("2d"),j=new ImageData(_,o,i),V.putImageData(j,0,0)),t!==n&&t.dispose(),[2,_]}})})},fromPixels:jQ}),uO=function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(e,t){return new e(t)},n}(),cO=function(){function n(){this.classNameMap={}}return n.getMap=function(){return null==n.instance&&(n.instance=new n),n.instance},n.register=function(e){n.getMap().classNameMap[e.className]=[e,e.fromConfig]},n}();function Sc(n){X(null!=n.className,function(){return"Class being registered does not have the static className property defined."}),X("string"==typeof n.className,function(){return"className is required to be a string, but got type "+typeof n.className}),X(n.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),cO.register(n)}function u2(){return 32===Z.backend.floatPrecision()?.001:.1}function c2(n,e,t){var r=!0;if((zi(n)||zi(e))&&(r=!1),zi(n)&&zi(e)&&(r=!0),r){var i=n.constructor.name,o=e.constructor.name;if(i!==o)throw new Error("Arrays are of different type. Actual: "+i+". Expected: "+o)}if(Array.isArray(n)&&Array.isArray(e)){var s=Ha(n),a=Ha(e);if(!ai(s,a))throw new Error("Arrays have different shapes. Actual: ["+s+"]. Expected: ["+a+"]")}var u=zi(n)?n:wu(n),c=zi(e)?e:wu(e);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+c.length+".\nActual:   "+u+".\nExpected: "+c+".");for(var d=0;d<c.length;++d){var p=u[d],m=c[d];if(!t(p,m))throw new Error("Arrays differ: actual["+d+"] = "+p+", expected["+d+"] = "+m+".\nActual:   "+u+".\nExpected: "+c+".")}}function l2(n,e,t){return!isFinite(n)&&!isFinite(e)||!(isNaN(n)||isNaN(e)||Math.abs(n-e)>t)}Object.freeze({Serializable:uO,SerializationMap:cO,registerClass:Sc}),Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(n,e,t){return null==t&&(t=u2()),c2(n,e,function(r,i){return l2(r,i,t)})},testEpsilon:u2,expectPromiseToFail:function(n,e){n().then(function(){return e.fail()},function(){return e()})},expectArraysEqual:function(n,e){var t="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return bc(n)||bc(n[0])||bc(e)||bc(e[0])?c2(n,t,function(r,i){return r==i}):c2(n,e,function(r,i){return l2(r,i,0)})},expectNumbersClose:function(n,e,t){if(null==t&&(t=u2()),!l2(n,e,t))throw new Error("Numbers differ: actual === "+n+", expected === "+e)},expectValuesInRange:function(n,e,t){for(var r=0;r<n.length;r++)if(n[r]<e||n[r]>t)throw new Error("Value out of range:"+n[r]+" low: "+e+", high: "+t)},expectArrayBuffersEqual:function(n,e){expect(new Float32Array(n)).toEqual(new Float32Array(e))}}),Object.freeze({gpgpu_util:hq,webgl_util:PY,forceHalfFloat:function(){ge().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:aN,setWebGLContext:bR,GPGPUContext:z3});var Dl=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return ia(e,n),e.prototype.minimize=function(t,r,i){void 0===r&&(r=!1);var o=this.computeGradients(t,i),s=o.value,a=o.grads;if(null!=i){var u=i.map(function(c){return{name:c.name,tensor:a[c.name]}});this.applyGradients(u)}else this.applyGradients(a);return Oo(a),r?s:(s.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,r){return function(n,e){X(wc(n),function(){return"The f passed in variableGrads(f) must be a function"}),X(null==e||Array.isArray(e)&&e.every(function(d){return d instanceof od}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=null!=e;if(!t)for(var r in e=[],Z.registeredVariables)e.push(Z.registeredVariables[r]);var i=t?e.filter(function(d){return!d.trainable}):null,o=e.length;X((e=e.filter(function(d){return d.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."});var s=Z.gradients(n,e,null,!0),a=s.value,u=s.grads;X(u.some(function(d){return null!=d}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),X(0===a.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+a.rank+" tensor"});var c={};return e.forEach(function(d,p){null!=u[p]&&(c[d.name]=u[p])}),null!=i&&i.forEach(function(d){return c[d.name]=null}),{value:a,grads:c}}(t,r)},e.prototype.dispose=function(){null!=this.iterations_&&Oo(this.iterations_)},e.prototype.saveIterations=function(){return tt(this,void 0,void 0,function(){return nt(this,function(t){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:Ue(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return tt(this,void 0,void 0,function(){return nt(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return tt(this,void 0,void 0,function(){return nt(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(t){return tt(this,void 0,void 0,function(){var r;return nt(this,function(i){switch(i.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=i.sent()[0],[2,t.slice(1)]}})})},e}(uO);Object.defineProperty(Dl,Symbol.hasInstance,{value:function(n){return null!=n.minimize&&null!=n.computeGradients&&null!=n.applyGradients}});var hO=function(n){function e(t,r,i){void 0===i&&(i=null);var o=n.call(this)||this;return o.learningRate=t,o.rho=r,o.epsilon=i,o.accumulatedGrads=[],o.accumulatedUpdates=[],null==i&&(o.epsilon=Z.backend.epsilon()),o}return ia(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var s=Z.registeredVariables[i];null==r.accumulatedGrads[o]&&(r.accumulatedGrads[o]={originalName:i+"/accum_grad",variable:qe(function(){return Nn(s).variable(!1)})}),null==r.accumulatedUpdates[o]&&(r.accumulatedUpdates[o]={originalName:i+"/accum_var",variable:qe(function(){return Nn(s).variable(!1)})});var a=Array.isArray(t)?t[o].tensor:t[i];if(null!=a){var u=r.accumulatedGrads[o].variable,c=r.accumulatedUpdates[o].variable;qe(function(){var d=u.mul(r.rho).add(a.square().mul(1-r.rho)),p=c.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(a),m=c.mul(r.rho).add(p.square().mul(1-r.rho));u.assign(d),c.assign(m);var y=p.mul(-r.learningRate).add(s);s.assign(y)})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedUpdates&&(Oo(this.accumulatedGrads.map(function(t){return t.variable})),Oo(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return tt(this,void 0,void 0,function(){var t;return nt(this,function(r){switch(r.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return tt(this,void 0,void 0,function(){var r;return nt(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),this.accumulatedGrads=t.slice(0,r=t.length/2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedUpdates=t.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},e.className="Adadelta",e}(Dl);Sc(hO);var dO=function(n){function e(t,r){void 0===r&&(r=.1);var i=n.call(this)||this;return i.learningRate=t,i.initialAccumulatorValue=r,i.accumulatedGrads=[],i}return ia(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var s=Z.registeredVariables[i];null==r.accumulatedGrads[o]&&(r.accumulatedGrads[o]={originalName:i+"/accumulator",variable:qe(function(){return Ga(s.shape,r.initialAccumulatorValue).variable(!1)})});var a=Array.isArray(t)?t[o].tensor:t[i];if(null!=a){var u=r.accumulatedGrads[o].variable;qe(function(){var c=u.add(a.square());u.assign(c);var d=a.div(c.add(Z.backend.epsilon()).sqrt()).mul(-r.learningRate).add(s);s.assign(d)})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedGrads&&Oo(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return tt(this,void 0,void 0,function(){return nt(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return tt(this,void 0,void 0,function(){return nt(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},e.className="Adagrad",e}(Dl);Sc(dO);var fO=function(n){function e(t,r,i,o){void 0===o&&(o=null);var s=n.call(this)||this;return s.learningRate=t,s.beta1=r,s.beta2=i,s.epsilon=o,s.accumulatedFirstMoment=[],s.accumulatedSecondMoment=[],qe(function(){s.accBeta1=Ue(r).variable(),s.accBeta2=Ue(i).variable()}),null==o&&(s.epsilon=Z.backend.epsilon()),s}return ia(e,n),e.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t);qe(function(){var o=Ei(1,r.accBeta1),s=Ei(1,r.accBeta2);i.forEach(function(a,u){var c=Z.registeredVariables[a];null==r.accumulatedFirstMoment[u]&&(r.accumulatedFirstMoment[u]={originalName:a+"/m",variable:qe(function(){return Nn(c).variable(!1)})}),null==r.accumulatedSecondMoment[u]&&(r.accumulatedSecondMoment[u]={originalName:a+"/v",variable:qe(function(){return Nn(c).variable(!1)})});var d=Array.isArray(t)?t[u].tensor:t[a];if(null!=d){var p=r.accumulatedFirstMoment[u].variable,m=r.accumulatedSecondMoment[u].variable,y=p.mul(r.beta1).add(d.mul(1-r.beta1)),w=m.mul(r.beta2).add(d.square().mul(1-r.beta2)),C=y.div(o),_=w.div(s);p.assign(y),m.assign(w);var A=C.div(_.sqrt().add(r.epsilon)).mul(-r.learningRate).add(c);c.assign(A)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Oo(this.accumulatedFirstMoment.map(function(t){return t.variable})),null!=this.accumulatedSecondMoment&&Oo(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return tt(this,void 0,void 0,function(){var t;return nt(this,function(r){switch(r.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return tt(this,void 0,void 0,function(){var r,i=this;return nt(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),qe(function(){i.accBeta1.assign(G1(i.beta1,i.iterations_+1)),i.accBeta2.assign(G1(i.beta2,i.iterations_+1))}),this.accumulatedFirstMoment=t.slice(0,r=t.length/2).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),this.accumulatedSecondMoment=t.slice(r,2*r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},e.className="Adam",e}(Dl);Sc(fO);var pO=function(n){function e(t,r,i,o,s){void 0===o&&(o=null),void 0===s&&(s=0);var a=n.call(this)||this;return a.learningRate=t,a.beta1=r,a.beta2=i,a.epsilon=o,a.decay=s,a.accumulatedFirstMoment=[],a.accumulatedWeightedInfNorm=[],qe(function(){a.iteration=Ue(0).variable(),a.accBeta1=Ue(r).variable()}),null==o&&(a.epsilon=Z.backend.epsilon()),a}return ia(e,n),e.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t);qe(function(){var o=Ei(1,r.accBeta1),s=ha(-r.learningRate,r.iteration.mul(r.decay).add(1));i.forEach(function(a,u){var c=Z.registeredVariables[a];null==r.accumulatedFirstMoment[u]&&(r.accumulatedFirstMoment[u]={originalName:a+"/m",variable:Nn(c).variable(!1)}),null==r.accumulatedWeightedInfNorm[u]&&(r.accumulatedWeightedInfNorm[u]={originalName:a+"/v",variable:Nn(c).variable(!1)});var d=Array.isArray(t)?t[u].tensor:t[a];if(null!=d){var p=r.accumulatedFirstMoment[u].variable,m=r.accumulatedWeightedInfNorm[u].variable,y=p.mul(r.beta1).add(d.mul(1-r.beta1)),w=m.mul(r.beta2),C=d.abs(),_=w.maximum(C);p.assign(y),m.assign(_);var A=s.div(o).mul(y.div(_.add(r.epsilon))).add(c);c.assign(A)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Oo(this.accumulatedFirstMoment.map(function(t){return t.variable})),null!=this.accumulatedWeightedInfNorm&&Oo(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return tt(this,void 0,void 0,function(){return nt(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return tt(this,void 0,void 0,function(){return nt(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e.className="Adamax",e}(Dl);Sc(pO);var h2=function(n){function e(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return ia(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var s=Array.isArray(t)?t[o].tensor:t[i];if(null!=s){var a=Z.registeredVariables[i];qe(function(){var u=r.c.mul(s).add(a);a.assign(u)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=function(n){return Z.keep(n)}(Ue(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return tt(this,void 0,void 0,function(){return nt(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return tt(this,void 0,void 0,function(){return nt(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if(0!==(t=r.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,r){return new t(r.learningRate)},e.className="SGD",e}(Dl);Sc(h2);var gO=function(n){function e(t,r,i){void 0===i&&(i=!1);var o=n.call(this,t)||this;return o.learningRate=t,o.momentum=r,o.useNesterov=i,o.accumulations=[],o.m=Ue(o.momentum),o}return ia(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var s=Z.registeredVariables[i];null==r.accumulations[o]&&(r.accumulations[o]={originalName:i+"/momentum",variable:qe(function(){return Nn(s).variable(!1)})});var a=r.accumulations[o].variable,u=Array.isArray(t)?t[o].tensor:t[i];null!=u&&qe(function(){var c,d=r.m.mul(a).add(u);c=r.useNesterov?r.c.mul(u.add(d.mul(r.m))).add(s):r.c.mul(d).add(s),a.assign(d),s.assign(c)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&Oo(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return tt(this,void 0,void 0,function(){return nt(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return tt(this,void 0,void 0,function(){return nt(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},e.className="Momentum",e}(h2);Sc(gO);var mO=function(n){function e(t,r,i,o,s){void 0===r&&(r=.9),void 0===i&&(i=0),void 0===o&&(o=null),void 0===s&&(s=!1);var a=n.call(this)||this;if(a.learningRate=t,a.decay=r,a.momentum=i,a.epsilon=o,a.accumulatedMeanSquares=[],a.accumulatedMoments=[],a.accumulatedMeanGrads=[],a.centered=s,null==o&&(a.epsilon=Z.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.");return a}return ia(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var s=Z.registeredVariables[i];null==r.accumulatedMeanSquares[o]&&(r.accumulatedMeanSquares[o]={originalName:i+"/rms",variable:qe(function(){return Nn(s).variable(!1)})}),null==r.accumulatedMoments[o]&&(r.accumulatedMoments[o]={originalName:i+"/momentum",variable:qe(function(){return Nn(s).variable(!1)})}),null==r.accumulatedMeanGrads[o]&&r.centered&&(r.accumulatedMeanGrads[o]={originalName:i+"/mg",variable:qe(function(){return Nn(s).variable(!1)})});var a=Array.isArray(t)?t[o].tensor:t[i];if(null!=a){var u=r.accumulatedMeanSquares[o].variable,c=r.accumulatedMoments[o].variable;qe(function(){var d=u.mul(r.decay).add(a.square().mul(1-r.decay));if(r.centered){var p=r.accumulatedMeanGrads[o].variable,m=p.mul(r.decay).add(a.mul(1-r.decay)),y=c.mul(r.momentum).add(a.mul(r.learningRate).div(d.sub(m.square().add(r.epsilon)).sqrt()));u.assign(d),p.assign(m),c.assign(y);var w=s.sub(y);s.assign(w)}else{var C=u.mul(r.decay).add(a.square().mul(1-r.decay));y=c.mul(r.momentum).add(a.mul(r.learningRate).div(C.add(r.epsilon).sqrt())),u.assign(C),c.assign(y),w=s.sub(y),s.assign(w)}})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&Oo(this.accumulatedMeanSquares.map(function(t){return t.variable})),null!=this.accumulatedMeanGrads&&this.centered&&Oo(this.accumulatedMeanGrads.map(function(t){return t.variable})),null!=this.accumulatedMoments&&Oo(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return tt(this,void 0,void 0,function(){var t;return nt(this,function(r){switch(r.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return tt(this,void 0,void 0,function(){var r;return nt(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),this.accumulatedMeanSquares=t.slice(0,r=this.centered?t.length/3:t.length/2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedMoments=t.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(2*r,3*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e.className="RMSProp",e}(Dl);Sc(mO),function(){function n(){}n.sgd=function(e){return new h2(e)},n.momentum=function(e,t,r){return void 0===r&&(r=!1),new gO(e,t,r)},n.rmsprop=function(e,t,r,i,o){return void 0===t&&(t=.9),void 0===r&&(r=0),void 0===i&&(i=null),void 0===o&&(o=!1),new mO(e,t,r,i,o)},n.adam=function(e,t,r,i){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===r&&(r=.999),void 0===i&&(i=null),new fO(e,t,r,i)},n.adadelta=function(e,t,r){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===r&&(r=null),new hO(e,t,r)},n.adamax=function(e,t,r,i,o){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===r&&(r=.999),void 0===i&&(i=null),void 0===o&&(o=0),new pO(e,t,r,i,o)},n.adagrad=function(e,t){return void 0===t&&(t=.1),new dO(e,t)}}(),"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate&&setImmediate,or.prototype.squaredDifference=function(n){return uN(this,n)},pe=bQ;var d2=function(n,e){return(d2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])})(n,e)};function Bt(n,e){function t(){this.constructor=n}d2(n,e),n.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}var ao=function(){return(ao=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function ct(n,e,t,r){return new(t||(t=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(p){s(p)}}function u(d){try{c(r.throw(d))}catch(p){s(p)}}function c(d){d.done?o(d.value):function(o){return o instanceof t?o:new t(function(s){s(o)})}(d.value).then(a,u)}c((r=r.apply(n,e||[])).next())})}function lt(n,e){var r,i,o,s,t={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(d){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=2&c[0]?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(!(o=(o=t.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){t=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){t.label=c[1];break}if(6===c[0]&&t.label<o[1]){t.label=o[1],o=c;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(c);break}o[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(d){c=[6,d],i=0}finally{r=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,d])}}}function kp(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;var r=Array(n),i=0;for(e=0;e<t;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}var bd=function(){function n(e,t){if(!Tl(e)||!Tl(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),n.prototype.reverse=function(){return new n(1/this.width,1/this.height)},n}();function Pp(n,e){return n instanceof or&&n.shape.length===e}function em(n){return Pp(n,3)}function Tc(n){return Pp(n,4)}function yO(n){return n%2==0}function xO(n){return n&&n.width&&n.height}function f2(n){return n.reduce(function(e,t){return e.add(t)},new Wn(0,0)).div(new Wn(n.length,n.length))}function Fp(n,e,t){return Array(n).fill(0).map(function(r,i){return e+i*t})}function Tl(n){return!!n&&n!==1/0&&n!==-1/0&&!isNaN(n)||0===n}function bO(n){return Tl(n)&&0<=n&&n<=1}var Wn=function(){function n(e,t){this._x=e,this._y=t}return Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),n.prototype.add=function(e){return new n(this.x+e.x,this.y+e.y)},n.prototype.sub=function(e){return new n(this.x-e.x,this.y-e.y)},n.prototype.mul=function(e){return new n(this.x*e.x,this.y*e.y)},n.prototype.div=function(e){return new n(this.x/e.x,this.y/e.y)},n.prototype.abs=function(){return new n(Math.abs(this.x),Math.abs(this.y))},n.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},n.prototype.floor=function(){return new n(Math.floor(this.x),Math.floor(this.y))},n}(),Tu=function(){function n(e,t){void 0===t&&(t=!0);var r=e||{},i=[r.left,r.top,r.right,r.bottom].every(Tl),o=[r.x,r.y,r.width,r.height].every(Tl);if(!o&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var s=o?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],a=s[0],u=s[1],c=s[2],d=s[3];n.assertIsValidBox({x:a,y:u,width:c,height:d},"Box.constructor",t),this._x=a,this._y=u,this._width=c,this._height=d}return n.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(Tl)},n.assertIsValidBox=function(e,t,r){if(void 0===r&&(r=!1),!n.isRect(e))throw new Error(t+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw new Error(t+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topLeft",{get:function(){return new Wn(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topRight",{get:function(){return new Wn(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomLeft",{get:function(){return new Wn(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomRight",{get:function(){return new Wn(this.right,this.bottom)},enumerable:!0,configurable:!0}),n.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(s){return Math.round(s)});return new n({x:e[0],y:e[1],width:e[2],height:e[3]})},n.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(s){return Math.floor(s)});return new n({x:e[0],y:e[1],width:e[2],height:e[3]})},n.prototype.toSquare=function(){var e=this,t=e.x,r=e.y,i=e.width,o=e.height,s=Math.abs(i-o);return i<o&&(t-=s/2,i+=s),o<i&&(r-=s/2,o+=s),new n({x:t,y:r,width:i,height:o})},n.prototype.rescale=function(e){var t=xO(e)?e.width:e,r=xO(e)?e.height:e;return new n({x:this.x*t,y:this.y*r,width:this.width*t,height:this.height*r})},n.prototype.pad=function(e,t){var r=[this.x-e/2,this.y-t/2,this.width+e,this.height+t];return new n({x:r[0],y:r[1],width:r[2],height:r[3]})},n.prototype.clipAtImageBorders=function(e,t){var r=this,o=r.y,s=r.right,a=r.bottom,u=Math.max(r.x,0),c=Math.max(o,0),p=a-c;return new n({x:u,y:c,width:Math.min(s-u,e-u),height:Math.min(p,t-c)}).floor()},n.prototype.shift=function(e,t){return new n({x:this.x+e,y:this.y+t,width:this.width,height:this.height})},n.prototype.padAtBorders=function(e,t){var r=this.width+1,i=this.height+1,a=r,u=i,c=this.left,d=this.top,p=this.right,m=this.bottom;return p>t&&(a=-p+t+r,p=t),m>e&&(u=-m+e+i,m=e),c<1&&(u=2-c,c=1),d<1&&(u=2-d,d=1),{dy:1,edy:u,dx:1,edx:a,y:d,ey:m,x:c,ex:p,w:r,h:i}},n.prototype.calibrate=function(e){return new n({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},n}(),tm=function(n){function e(t,r,i,o,s){return void 0===s&&(s=!1),n.call(this,{left:t,top:r,right:i,bottom:o},s)||this}return Bt(e,n),e}(Tu),wO=function(){function n(e,t,r,i,o){this._imageDims=new bd(o.width,o.height),this._score=e,this._classScore=t,this._className=r,this._box=new Tu(i).rescale(this._imageDims)}return Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativeBox",{get:function(){return new Tu(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new n(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:t})},n}(),Xa=function(n){function e(t,r,i){return n.call(this,t,t,"",r,i)||this}return Bt(e,n),e.prototype.forSize=function(t,r){var i=n.prototype.forSize.call(this,t,r);return new e(i.score,i.relativeBox,i.imageDims)},e}(wO);function KQ(n,e,t){void 0===t&&(t=!0);var o=Math.max(0,Math.min(n.right,e.right)-Math.max(n.left,e.left))*Math.max(0,Math.min(n.bottom,e.bottom)-Math.max(n.top,e.top));return t?o/(n.area+e.area-o):o/Math.min(n.area,e.area)}function Lp(n,e,t,r){void 0===r&&(r=!0);for(var i=e.map(function(a,u){return{score:a,boxIndex:u}}).sort(function(a,u){return a.score-u.score}).map(function(a){return a.boxIndex}),o=[],s=function(){var a=i.pop();o.push(a);for(var u=i,c=[],d=0;d<u.length;d++)c.push(KQ(n[a],n[u[d]],r));i=i.filter(function(w,C){return c[C]<=t})};i.length>0;)s();return o}function Bp(n,e){return qe(function(){var t=e[0],r=e[1],i=e[2],o=Ga(kp(n.shape.slice(0,3),[1]),t),s=Ga(kp(n.shape.slice(0,3),[1]),r),a=Ga(kp(n.shape.slice(0,3),[1]),i),u=_i([o,s,a],3);return Ei(n,u)})}function p2(n){return 1/(1+Math.exp(-n))}var Ii,g2=function(n){function e(t,r,i,o,s){return void 0===s&&(s=!1),n.call(this,{x:t,y:r,width:i,height:o},s)||this}return Bt(e,n),e}(Tu),nm=function(){function n(e,t,r){void 0===r&&(r=new Wn(0,0));var i=t.width,o=t.height;this._imgDims=new bd(i,o),this._shift=r,this._positions=e.map(function(s){return s.mul(new Wn(i,o)).add(r)})}return Object.defineProperty(n.prototype,"shift",{get:function(){return new Wn(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new Wn(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},n.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new Wn(e,t))},n.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},n.prototype.align=function(e,t){if(void 0===t&&(t={}),e){var r=e instanceof Xa?e.box.floor():new Tu(e);return this.shiftBy(r.x,r.y).align(null,t)}var i=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),s=i.minBoxPadding;return i.useDlibAlignment?this.alignDlib():this.alignMinBbox(s)},n.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),r=e[1],i=e[2],o=function(p){return i.sub(p).magnitude()},s=(o(e[0])+o(r))/2,a=Math.floor(s/.45),u=f2(e),c=Math.floor(Math.max(0,u.x-.5*a)),d=Math.floor(Math.max(0,u.y-.43*a));return new g2(c,d,Math.min(a,this.imageWidth+c),Math.min(a,this.imageHeight+d))},n.prototype.alignMinBbox=function(e){var t=function(n){var e=n.map(function(a){return a.x}),t=n.map(function(a){return a.y}),r=e.reduce(function(a,u){return u<a?u:a},1/0),i=t.reduce(function(a,u){return u<a?u:a},1/0),o=e.reduce(function(a,u){return a<u?u:a},0),s=t.reduce(function(a,u){return a<u?u:a},0);return new tm(r,i,o,s)}(this.positions);return t.pad(t.width*e,t.height*e)},n.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},n}(),tZ=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return Bt(e,n),e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],f2([t[3],t[4]])]},e}(nm),_O=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return Bt(e,n),e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(f2)},e}(nm),CO=function(){function n(e,t){this._label=e,this._distance=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),n.prototype.toString=function(e){return void 0===e&&(e=!0),this.label+(e?" ("+function(n,e){void 0===e&&(e=2);var t=Math.pow(10,e);return Math.floor(n*t)/t}(this.distance)+")":"")},n}(),EO=function(n){function e(t,r){var i=n.call(this,t)||this;return i._label=r,i}return Bt(e,n),e.assertIsValidLabeledBox=function(t,r){if(Tu.assertIsValidBox(t,r),!Tl(t.label))throw new Error(r+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e}(Tu),rm=function(){function n(e,t){if("string"!=typeof e)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),n.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(e){return Array.from(e)})}},n.fromJSON=function(e){var t=e.descriptors.map(function(r){return new Float32Array(r)});return new n(e.label,t)},n}();function m2(n,e){return Object.assign({},n,{detection:e})}function IO(){var n=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:n,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function AO(n){var e="";if(!n)try{n=me(730)}catch(r){e=r.toString()}return{readFile:n?function(r){return new Promise(function(i,o){n.readFile(r,function(s,a){return s?o(s):i(a)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)}}}function DO(){var n=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,i=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=AO();return ao({Canvas:n||function(){},CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){},Image:e||function(){},ImageData:global.ImageData||function(){},Video:global.HTMLVideoElement||function(){},createCanvasElement:function(){if(n)return new n;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:i},o)}function SO(){return"object"==typeof window&&"undefined"!=typeof document&&"undefined"!=typeof HTMLImageElement&&"undefined"!=typeof HTMLCanvasElement&&"undefined"!=typeof HTMLVideoElement&&"undefined"!=typeof ImageData&&"undefined"!=typeof CanvasRenderingContext2D}function TO(){return"object"==typeof global&&"undefined"!=typeof process&&!!process.version}function v2(n){Ii=n}function y2(){SO()&&v2(IO()),TO()&&v2(DO())}!function(n){function e(t,r,i,o){var s=n.call(this,t,r)||this;return s._score=i,s._classScore=o,s}Bt(e,n),e.assertIsValidPredictedBox=function(t,r){if(EO.assertIsValidLabeledBox(t,r),!bO(t.score)||!bO(t.classScore))throw new Error(r+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(EO);var qi={getEnv:function(){if(!Ii)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return Ii},setEnv:v2,initialize:y2,createBrowserEnv:IO,createFileSystem:AO,createNodejsEnv:DO,monkeyPatch:function(n){if(Ii||y2(),!Ii)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=n.Canvas,t=void 0===e?Ii.Canvas:e,r=n.Image,i=void 0===r?Ii.Image:r;Ii.Canvas=t,Ii.Image=i,Ii.createCanvasElement=n.createCanvasElement||function(){return new t},Ii.createImageElement=n.createImageElement||function(){return new i},Ii.ImageData=n.ImageData||Ii.ImageData,Ii.Video=n.Video||Ii.Video,Ii.fetch=n.fetch||Ii.fetch,Ii.readFile=n.readFile||Ii.readFile},isBrowser:SO,isNodejs:TO};function x2(n){return qi.isNodejs()||"string"!=typeof n?n:document.getElementById(n)}function qa(n){var e=qi.getEnv(),t=e.Canvas;if(n instanceof e.CanvasRenderingContext2D)return n;var i=x2(n);if(!(i instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=i.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}y2();var Mu=(()=>(function(n){n.TOP_LEFT="TOP_LEFT",n.TOP_RIGHT="TOP_RIGHT",n.BOTTOM_LEFT="BOTTOM_LEFT",n.BOTTOM_RIGHT="BOTTOM_RIGHT"}(Mu||(Mu={})),Mu))(),MO=function(e){void 0===e&&(e={});var r=e.backgroundColor,i=e.fontColor,o=e.fontSize,s=e.fontStyle,a=e.padding;this.anchorPosition=e.anchorPosition||Mu.TOP_LEFT,this.backgroundColor=r||"rgba(0, 0, 0, 0.5)",this.fontColor=i||"rgba(255, 255, 255, 1)",this.fontSize=o||14,this.fontStyle=s||"Georgia",this.padding=a||4};!function(){function n(e,t,r){void 0===r&&(r={}),this.text="string"==typeof e?[e]:e instanceof n?e.text:e,this.anchor=t,this.options=new MO(r)}n.prototype.measureWidth=function(e){var t=this.options.padding;return this.text.map(function(r){return e.measureText(r).width}).reduce(function(r,i){return r<i?i:r},0)+2*t},n.prototype.measureHeight=function(){var e=this.options;return this.text.length*e.fontSize+2*e.padding},n.prototype.getUpperLeft=function(e,t){var r=this.options.anchorPosition,i=r===Mu.BOTTOM_RIGHT||r===Mu.TOP_RIGHT,o=r===Mu.BOTTOM_LEFT||r===Mu.BOTTOM_RIGHT,s=this.measureWidth(e),a=this.measureHeight(),u=i?this.anchor.x-s:this.anchor.x,c=o?this.anchor.y-a:this.anchor.y;if(t){var p=t.height;return{x:Math.max(Math.min(u,t.width-s),0),y:Math.max(Math.min(c,p-a),0)}}return{x:u,y:c}},n.prototype.draw=function(e){var t=x2(e),r=qa(t),i=this.options,o=i.backgroundColor,s=i.fontColor,a=i.fontSize,c=i.padding;r.font=a+"px "+i.fontStyle;var d=this.measureWidth(r),p=this.measureHeight();r.fillStyle=o;var m=this.getUpperLeft(r,t);r.fillRect(m.x,m.y,d,p),r.fillStyle=s,this.text.forEach(function(y,w){r.fillText(y,c+m.x,c+m.y+(w+1)*a)})}}();function RO(n){var e=qi.getEnv();return n instanceof e.Image&&n.complete||n instanceof e.Video&&n.readyState>=3}function NO(n){var e=qi.getEnv(),r=e.Video;return n instanceof e.Image?new bd(n.naturalWidth,n.naturalHeight):n instanceof r?new bd(n.videoWidth,n.videoHeight):new bd(n.width,n.height)}function im(n){var e=n.width,t=n.height,i=(0,qi.getEnv().createCanvasElement)();return i.width=e,i.height=t,i}function b2(n,e){var t=qi.getEnv().ImageData;if(!(n instanceof t||RO(n)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=e||NO(n),i=r.width,o=r.height,s=im({width:i,height:o});return n instanceof t?qa(s).putImageData(n,0,0):qa(s).drawImage(n,0,0,i,o),s}function cZ(n,e){return ct(this,void 0,void 0,function(){var t,r,i,o,s,a;return lt(this,function(u){switch(u.label){case 0:return t=e||qi.getEnv().createCanvasElement(),r=n.shape.slice(Tc(n)?1:0),i=r[0],o=r[1],s=r[2],a=qe(function(){return n.as3D(i,o,s).toInt()}),[4,a2.toPixels(a,t)];case 1:return u.sent(),a.dispose(),[2,t]}})})}function OO(n){var e=qi.getEnv();return n instanceof e.Image||n instanceof e.Canvas||n instanceof e.Video}var om=function(){function n(e,t){var r=this;if(void 0===t&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(i,o){if(em(i))return r._imageTensors[o]=i,void(r._inputDimensions[o]=i.shape);if(Tc(i)){var s=i.shape[0];if(1!==s)throw new Error("NetInput - tf.Tensor4D with batchSize "+s+" passed, but not supported in input array");return r._imageTensors[o]=i,void(r._inputDimensions[o]=i.shape.slice(1))}var a=i instanceof qi.getEnv().Canvas?i:b2(i);r._canvases[o]=a,r._inputDimensions[o]=[a.height,a.width,3]})}return Object.defineProperty(n.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"reshapedInputDimensions",{get:function(){var e=this;return Fp(this.batchSize,0,1).map(function(t,r){return e.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),n.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},n.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},n.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},n.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},n.prototype.getReshapedInputDimensions=function(e){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function(n,e){var t=n.width,r=n.height,i=e/Math.max(r,t);return new bd(Math.round(t*i),Math.round(r*i))}({width:this.getInputWidth(e),height:this.getInputHeight(e)},this.inputSize)},n.prototype.toBatchTensor=function(e,t){var r=this;return void 0===t&&(t=!0),this._inputSize=e,qe(function(){var i=Fp(r.batchSize,0,1).map(function(s){var a=r.getInput(s);if(a instanceof or){var u=Tc(a)?a:a.expandDims();return((u=function(n,e){return void 0===e&&(e=!1),qe(function(){var t=n.shape.slice(1),r=t[0],i=t[1];if(r===i)return n;var o=Math.abs(r-i),s=Math.round(o*(e?.5:1)),a=r>i?2:1,u=function(y){var w=n.shape.slice();return w[a]=y,Ga(w,0)},c=u(s),d=o-c.shape[a],m=[e&&d?u(d):null,n,c].filter(function(y){return!!y}).map(function(y){return y.toFloat()});return _i(m,a)})}(u,t)).shape[1]!==e||u.shape[2]!==e)&&(u=Hw.resizeBilinear(u,[e,e])),u.as3D(e,e,3)}if(a instanceof qi.getEnv().Canvas)return a2.fromPixels(function(n,e,t){void 0===t&&(t=!1);var r=qi.getEnv(),o=r.Canvas;if(!(n instanceof r.Image||n instanceof o))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var s=NO(n),a=e/Math.max(s.height,s.width),u=a*s.width,c=a*s.height,d=im({width:e,height:e}),p=n instanceof o?n:b2(n),m=Math.abs(u-c)/2,y=t&&u<c?m:0,w=t&&c<u?m:0;return qa(d).drawImage(p,y,w,u,c),d}(a,e,t));throw new Error("toBatchTensor - at batchIdx "+s+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+a)});return ns(i.map(function(s){return s.toFloat()})).as4D(r.batchSize,e,e,3)})},n}();function Fi(n){return ct(this,void 0,void 0,function(){var e,t,r;return lt(this,function(i){switch(i.label){case 0:if(n instanceof om)return[2,n];if(!(e=Array.isArray(n)?n:[n]).length)throw new Error("toNetInput - empty array passed as input");return t=function(o){return Array.isArray(n)?" at input index "+o+":":""},(r=e.map(x2)).forEach(function(o,s){if(!OO(o)&&!em(o)&&!Tc(o))throw"string"==typeof e[s]?new Error("toNetInput -"+t(s)+" string passed, but could not resolve HTMLElement for element id "+e[s]):new Error("toNetInput -"+t(s)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(Tc(o)){var a=o.shape[0];if(1!==a)throw new Error("toNetInput -"+t(s)+" tf.Tensor4D with batchSize "+a+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(o){return OO(o)&&function(n){return new Promise(function(e,t){if(n instanceof qi.getEnv().Canvas||RO(n))return e();function r(o){!o.currentTarget||(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),e(o))}function i(o){!o.currentTarget||(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),t(o))}n.addEventListener("load",r),n.addEventListener("error",i)})}(o)}))];case 1:return i.sent(),[2,new om(r,Array.isArray(n))]}})})}function w2(n,e){return ct(this,void 0,void 0,function(){var t,r,i,o,s,a;return lt(this,function(c){switch(c.label){case 0:return t=qi.getEnv().Canvas,r=n,n instanceof t?[3,5]:[4,Fi(n)];case 1:if((i=c.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(o=i.getInput(0))instanceof t?(s=o,[3,4]):[3,2];case 2:return[4,cZ(o)];case 3:s=c.sent(),c.label=4;case 4:r=s,c.label=5;case 5:return a=qa(r),[2,e.map(function(d){return d instanceof Xa?d.forSize(r.width,r.height).box.floor():d}).map(function(d){return d.clipAtImageBorders(r.width,r.height)}).map(function(d){var p=d.x,m=d.y,y=d.width,w=d.height,C=im({width:y,height:w});return qa(C).putImageData(a.getImageData(p,m,y,w),0,0),C})]}})})}function _2(n,e){return ct(this,void 0,void 0,function(){return lt(this,function(t){if(!em(n)&&!Tc(n))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Tc(n)&&n.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,qe(function(){var r=n.shape.slice(Tc(n)?1:0),i=r[0],o=r[1],s=r[2];return e.map(function(c){return c instanceof Xa?c.forSize(o,i).box:c}).map(function(c){return c.clipAtImageBorders(o,i)}).map(function(c){var d=c.x,p=c.y,m=c.width,y=c.height;return RN(n.as3D(i,o,s),[p,d,0],[y,m,s])})})]})})}function hZ(n,e){return ct(this,void 0,void 0,function(){var r;return lt(this,function(i){switch(i.label){case 0:return[4,(0,qi.getEnv().fetch)(n,e)];case 1:if(!((r=i.sent()).status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function dZ(n){return ct(this,void 0,void 0,function(){return lt(this,function(e){switch(e.label){case 0:return[4,hZ(n)];case 1:return[2,e.sent().json()]}})})}function kO(n,e){var t=e+"-weights_manifest.json";if(!n)return{modelBaseUri:"",manifestUri:t};if("/"===n)return{modelBaseUri:"/",manifestUri:"/"+t};var r=n.startsWith("http://")?"http://":n.startsWith("https://")?"https://":"",i=(n=n.replace(r,"")).split("/").filter(function(a){return a}),o=n.endsWith(".json")?i[i.length-1]:t,s=r+(n.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return{modelBaseUri:s=n.startsWith("/")?"/"+s:s,manifestUri:"/"===s?"/"+o:s+"/"+o}}function fZ(n,e){return ct(this,void 0,void 0,function(){var t,i,o;return lt(this,function(s){switch(s.label){case 0:return t=kO(n,e),i=t.modelBaseUri,[4,dZ(t.manifestUri)];case 1:return o=s.sent(),[2,aO.loadWeights(o,i)]}})})}var Ru=function(){function n(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(n.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),n.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e);return t.obj[t.objProp]},n.prototype.reassignParamFromPath=function(e,t){var r=this.traversePropertyPath(e),i=r.obj,o=r.objProp;i[o].dispose(),i[o]=t},n.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var r=t.paramPath;return{path:r,tensor:e.getParamFromPath(r)}})},n.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof od})},n.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof od)})},n.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){e.reassignParamFromPath(t.path,t.tensor.variable())})},n.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var r=t.path,i=t.tensor,o=Xi(i.dataSync());i.dispose(),e.reassignParamFromPath(r,o)})},n.prototype.dispose=function(e){void 0===e&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},n.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){return Array.from(e.tensor.dataSync())}).reduce(function(e,t){return e.concat(t)}))},n.prototype.load=function(e){return ct(this,void 0,void 0,function(){return lt(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},n.prototype.loadFromUri=function(e){return ct(this,void 0,void 0,function(){var t;return lt(this,function(r){switch(r.label){case 0:if(e&&"string"!=typeof e)throw new Error(this._name+".loadFromUri - expected model uri");return[4,fZ(e,this.getDefaultModelName())];case 1:return t=r.sent(),this.loadFromWeightMap(t),[2]}})})},n.prototype.loadFromDisk=function(e){return ct(this,void 0,void 0,function(){var t,r,i,o,a,u,c,d,p;return lt(this,function(m){switch(m.label){case 0:if(e&&"string"!=typeof e)throw new Error(this._name+".loadFromDisk - expected model file path");return t=qi.getEnv().readFile,r=kO(e,this.getDefaultModelName()),i=r.manifestUri,o=r.modelBaseUri,a=aO.weightsLoaderFactory(function(y){return Promise.all(y.map(function(w){return t(w).then(function(C){return C.buffer})}))}),d=(c=JSON).parse,[4,t(i)];case 1:return u=d.apply(c,[m.sent().toString()]),[4,a(u,o)];case 2:return p=m.sent(),this.loadFromWeightMap(p),[2]}})})},n.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),i=t.params;this._paramMappings=t.paramMappings,this._params=i},n.prototype.extractWeights=function(e){var t=this.extractParams(e),i=t.params;this._paramMappings=t.paramMappings,this._params=i},n.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(o,s){if(!o.nextObj.hasOwnProperty(s))throw new Error("traversePropertyPath - object does not have property "+s+", for path "+e);return{obj:o.nextObj,objProp:s,nextObj:o.nextObj[s]}},{nextObj:this.params}),r=t.obj,i=t.objProp;if(!(r&&i&&r[i]instanceof or))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:r,objProp:i}},n}();function is(n,e,t){return qe(function(){var r=Bw(n,e.depthwise_filter,e.pointwise_filter,t,"same");return an(r,e.bias)})}function C2(n,e,t){return void 0===t&&(t=!1),qe(function(){var r=Nr(t?an(xs(n,e.conv0.filters,[2,2],"same"),e.conv0.bias):is(n,e.conv0,[2,2])),i=is(r,e.conv1,[1,1]),s=is(Nr(an(r,i)),e.conv2,[1,1]);return Nr(an(r,an(i,s)))})}function sm(n,e,t,r){return void 0===t&&(t=!1),void 0===r&&(r=!0),qe(function(){var i=Nr(t?an(xs(n,e.conv0.filters,r?[2,2]:[1,1],"same"),e.conv0.bias):is(n,e.conv0,r?[2,2]:[1,1])),o=is(i,e.conv1,[1,1]),a=is(Nr(an(i,o)),e.conv2,[1,1]),c=is(Nr(an(i,an(o,a))),e.conv3,[1,1]);return Nr(an(i,an(o,an(a,c))))})}function da(n,e,t,r){return void 0===t&&(t="same"),void 0===r&&(r=!1),qe(function(){var i=an(xs(n,e.filters,[1,1],t),e.bias);return r?Nr(i):i})}function Nu(n,e){Object.keys(n).forEach(function(t){e.some(function(r){return r.originalPath===t})||n[t].dispose()})}function am(n,e){return function(t,r,i,o){var s=Po(n(t*r*i*i),[i,i,t,r]),a=ci(n(r));return e.push({paramPath:o+"/filters"},{paramPath:o+"/bias"}),{filters:s,bias:a}}}function E2(n,e){return function(t,r,i){var o=Cc(n(t*r),[t,r]),s=ci(n(r));return e.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:o,bias:s}}}var PO=function(e,t,r){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=r};function I2(n,e){return function(t,r,i){var o=Po(n(9*t),[3,3,t,1]),s=Po(n(t*r),[1,1,t,r]),a=ci(n(r));return e.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new PO(o,s,a)}}function A2(n){return function(e){var t=n(e+"/depthwise_filter",4),r=n(e+"/pointwise_filter",4),i=n(e+"/bias",1);return new PO(t,r,i)}}function Mc(n,e){return function(t,r,i){var o=n[t];if(!Pp(o,r))throw new Error("expected weightMap["+t+"] to be a Tensor"+r+"D, instead have "+o);return e.push({originalPath:t,paramPath:i||t}),o}}function Ou(n){var e=n;return{extractWeights:function(i){var o=e.slice(0,i);return e=e.slice(i),o},getRemainingWeights:function(){return e}}}function FO(n,e){var t=am(n,e),r=I2(n,e);function i(s,a,u,c){return void 0===c&&(c=!1),{conv0:c?t(s,a,3,u+"/conv0"):r(s,a,u+"/conv0"),conv1:r(a,a,u+"/conv1"),conv2:r(a,a,u+"/conv2")}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:function(s,a,u,c){void 0===c&&(c=!1);var d=i(s,a,u,c);return{conv0:d.conv0,conv1:d.conv1,conv2:d.conv2,conv3:r(a,a,u+"/conv3")}}}}function LO(n){return function(e){return{filters:n(e+"/filters",4),bias:n(e+"/bias",1)}}}function BO(n,e){var t=Mc(n,e),r=LO(t),i=A2(t);return{extractDenseBlock3Params:function(a,u){return void 0===u&&(u=!1),{conv0:u?r(a+"/conv0"):i(a+"/conv0"),conv1:i(a+"/conv1"),conv2:i(a+"/conv2")}},extractDenseBlock4Params:function(a,u){return void 0===u&&(u=!1),{conv0:u?r(a+"/conv0"):i(a+"/conv0"),conv1:i(a+"/conv1"),conv2:i(a+"/conv2"),conv3:i(a+"/conv3")}}}}var VO=function(n){function e(){return n.call(this,"FaceFeatureExtractor")||this}return Bt(e,n),e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return qe(function(){var a=sm(Bp(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Ue(255)),r.dense0,!0);return a=sm(a,r.dense1),a=sm(a,r.dense2),a=sm(a,r.dense3),Np(a,[7,7],[2,2],"valid")})},e.prototype.forward=function(t){return ct(this,void 0,void 0,function(){var r;return lt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Fi(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(n){var e=[],t=BO(n,e).extractDenseBlock4Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2"),dense3:t("dense3")};return Nu(n,e),{params:r,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(n){var e=[],t=Ou(n),i=t.getRemainingWeights,o=FO(t.extractWeights,e).extractDenseBlock4Params,s=o(3,32,"dense0",!0),a=o(32,64,"dense1"),u=o(64,128,"dense2"),c=o(128,256,"dense3");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:s,dense1:a,dense2:u,dense3:c}}}(t)},e}(Ru);function $a(n,e){return qe(function(){return an(X1(n,e.weights),e.bias)})}function UO(n){var e={},t={};return Object.keys(n).forEach(function(r){(r.startsWith("fc")?t:e)[r]=n[r]}),{featureExtractorMap:e,classifierMap:t}}var jO=function(n){function e(t,r){var i=n.call(this,t)||this;return i._faceFeatureExtractor=r,i}return Bt(e,n),Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return qe(function(){var o=t instanceof om?r.faceFeatureExtractor.forwardInput(t):t;return $a(o.as2D(o.shape[0],-1),i.fc)})},e.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),o=r.paramMappings;this._params=r.params,this._paramMappings=o},e.prototype.extractClassifierParams=function(t){return function(n,e,t){var r=[],i=Ou(n),s=i.getRemainingWeights,u=E2(i.extractWeights,r)(e,t,"fc");if(0!==s().length)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:r,params:{fc:u}}}(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var r=UO(t),o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(r.featureExtractorMap),function(n){var e=[],t=Mc(n,e),i={fc:("fc",{weights:t("fc/weights",2),bias:t("fc/bias",1)})};return Nu(n,e),{params:i,paramMappings:e}}(o)},e.prototype.extractParams=function(t){var r=this.getClassifierChannelsIn(),i=this.getClassifierChannelsOut(),o=i*r+i,s=t.slice(0,t.length-o),a=t.slice(t.length-o);return this.faceFeatureExtractor.extractWeights(s),this.extractClassifierParams(a)},e}(Ru),WO=["neutral","happy","sad","angry","fearful","disgusted","surprised"],yZ=function(){function n(e){var t=this;if(7!==e.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);WO.forEach(function(r,i){t[r]=e[i]})}return n.prototype.asSortedArray=function(){var e=this;return WO.map(function(t){return{expression:t,probability:e[t]}}).sort(function(t,r){return r.probability-t.probability})},n}(),xZ=function(n){function e(t){return void 0===t&&(t=new VO),n.call(this,"FaceExpressionNet",t)||this}return Bt(e,n),e.prototype.forwardInput=function(t){var r=this;return qe(function(){return Eu(r.runNet(t))})},e.prototype.forward=function(t){return ct(this,void 0,void 0,function(){var r;return lt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Fi(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictExpressions=function(t){return ct(this,void 0,void 0,function(){var r,i,o,s,a=this;return lt(this,function(u){switch(u.label){case 0:return[4,Fi(t)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return i=u.sent(),[4,Promise.all(Ci(i).map(function(c){return ct(a,void 0,void 0,function(){var d;return lt(this,function(p){switch(p.label){case 0:return[4,c.data()];case 1:return d=p.sent(),c.dispose(),[2,d]}})})}))];case 3:return o=u.sent(),i.dispose(),s=o.map(function(c){return new yZ(c)}),[2,r.isBatchInput?s:s[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(jO);function HO(n,e){return Object.assign({},n,{expressions:e})}function D2(n,e){var t=n.detection.box,r=e.shiftBy(t.x,t.y),i=r.align(),o=n.detection.imageDims,s=new Xa(n.detection.score,i.rescale(o.reverse()),o);return Object.assign({},n,{landmarks:r,unshiftedLandmarks:e,alignedRect:s})}function zO(n,e,t){return an(xs(n,e.filters,t,"same"),e.bias)}function S2(n,e,t){void 0===t&&(t=!0);var r=t?Nr(n):n;return r=is(r,e.separable_conv0,[1,1]),r=is(Nr(r),e.separable_conv1,[1,1]),r=Pi(r,[3,3],[2,2],"same"),an(r,zO(n,e.expansion_conv,[2,2]))}var SZ=function(n){function e(t){var r=n.call(this,"TinyXception")||this;return r._numMainBlocks=t,r}return Bt(e,n),e.prototype.forwardInput=function(t){var r=this,i=this.params;if(!i)throw new Error("TinyXception - load model before inference");return qe(function(){var a=Bp(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Ue(256)),u=Nr(zO(a,i.entry_flow.conv_in,[2,2]));return u=S2(u,i.entry_flow.reduction_block_0,!1),u=S2(u,i.entry_flow.reduction_block_1),Fp(r._numMainBlocks,0,1).forEach(function(c){u=function(n,e){var t=is(Nr(n),e.separable_conv0,[1,1]);return t=is(Nr(t),e.separable_conv1,[1,1]),t=is(Nr(t),e.separable_conv2,[1,1]),an(t,n)}(u,i.middle_flow["main_block_"+c])}),u=S2(u,i.exit_flow.reduction_block),u=Nr(is(u,i.exit_flow.separable_conv,[1,1]))})},e.prototype.forward=function(t){return ct(this,void 0,void 0,function(){var r;return lt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Fi(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(n,e){var t=[],r=function(n,e){var t=Mc(n,e),r=LO(t),i=A2(t);return{extractConvParams:r,extractSeparableConvParams:i,extractReductionBlockParams:function(a){return{separable_conv0:i(a+"/separable_conv0"),separable_conv1:i(a+"/separable_conv1"),expansion_conv:r(a+"/expansion_conv")}},extractMainBlockParams:function(a){return{separable_conv0:i(a+"/separable_conv0"),separable_conv1:i(a+"/separable_conv1"),separable_conv2:i(a+"/separable_conv2")}}}}(n,t),o=r.extractSeparableConvParams,s=r.extractReductionBlockParams,a=r.extractMainBlockParams,p={conv_in:(0,r.extractConvParams)("entry_flow/conv_in"),reduction_block_0:s("entry_flow/reduction_block_0"),reduction_block_1:s("entry_flow/reduction_block_1")},m={};Fp(e,0,1).forEach(function(_){m["main_block_"+_]=a("middle_flow/main_block_"+_)});var C={reduction_block:s("exit_flow/reduction_block"),separable_conv:o("exit_flow/separable_conv")};return Nu(n,t),{params:{entry_flow:p,middle_flow:m,exit_flow:C},paramMappings:t}}(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return function(n,e){var t=[],r=Ou(n),o=r.getRemainingWeights,s=function(n,e){var t=am(n,e),r=I2(n,e);return{extractConvParams:t,extractSeparableConvParams:r,extractReductionBlockParams:function(s,a,u){return{separable_conv0:r(s,a,u+"/separable_conv0"),separable_conv1:r(a,a,u+"/separable_conv1"),expansion_conv:t(s,a,1,u+"/expansion_conv")}},extractMainBlockParams:function(s,a){return{separable_conv0:r(s,s,a+"/separable_conv0"),separable_conv1:r(s,s,a+"/separable_conv1"),separable_conv2:r(s,s,a+"/separable_conv2")}}}}(r.extractWeights,t),u=s.extractSeparableConvParams,c=s.extractReductionBlockParams,d=s.extractMainBlockParams,w={conv_in:(0,s.extractConvParams)(3,32,3,"entry_flow/conv_in"),reduction_block_0:c(32,64,"entry_flow/reduction_block_0"),reduction_block_1:c(64,128,"entry_flow/reduction_block_1")},C={};Fp(e,0,1).forEach(function(N){C["main_block_"+N]=d(128,"middle_flow/main_block_"+N)});var T={reduction_block:c(128,256,"exit_flow/reduction_block"),separable_conv:u(256,512,"exit_flow/separable_conv")};if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{entry_flow:w,middle_flow:C,exit_flow:T}}}(t,this._numMainBlocks)},e}(Ru),Vp=(()=>(function(n){n.FEMALE="female",n.MALE="male"}(Vp||(Vp={})),Vp))(),RZ=function(n){function e(t){void 0===t&&(t=new SZ(2));var r=n.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=t,r}return Bt(e,n),Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return qe(function(){var o=t instanceof om?r.faceFeatureExtractor.forwardInput(t):t,s=Np(o,[7,7],[2,2],"valid").as2D(o.shape[0],-1);return{age:$a(s,i.fc.age).as1D(),gender:$a(s,i.fc.gender)}})},e.prototype.forwardInput=function(t){var r=this;return qe(function(){var i=r.runNet(t);return{age:i.age,gender:Eu(i.gender)}})},e.prototype.forward=function(t){return ct(this,void 0,void 0,function(){var r;return lt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Fi(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return ct(this,void 0,void 0,function(){var r,i,o,s,a,u,c=this;return lt(this,function(d){switch(d.label){case 0:return[4,Fi(t)];case 1:return r=d.sent(),[4,this.forwardInput(r)];case 2:return i=d.sent(),o=Ci(i.age),s=Ci(i.gender),a=o.map(function(p,m){return{ageTensor:p,genderTensor:s[m]}}),[4,Promise.all(a.map(function(p){var m=p.ageTensor,y=p.genderTensor;return ct(c,void 0,void 0,function(){var w,C,_,A,T;return lt(this,function(N){switch(N.label){case 0:return[4,m.data()];case 1:return w=N.sent()[0],[4,y.data()];case 2:return C=N.sent()[0],A=(_=C>.5)?Vp.MALE:Vp.FEMALE,T=_?C:1-C,m.dispose(),y.dispose(),[2,{age:w,gender:A,genderProbability:T}]}})})}))];case 3:return u=d.sent(),i.age.dispose(),i.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),o=r.paramMappings;this._params=r.params,this._paramMappings=o},e.prototype.extractClassifierParams=function(t){return function(n){var e=[],t=Ou(n),i=t.getRemainingWeights,o=E2(t.extractWeights,e),s=o(512,1,"fc/age"),a=o(512,2,"fc/gender");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{fc:{age:s,gender:a}}}}(t)},e.prototype.extractParamsFromWeigthMap=function(t){var r=UO(t),o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(r.featureExtractorMap),function(n){var e=[],t=Mc(n,e);function r(o){return{weights:t(o+"/weights",2),bias:t(o+"/bias",1)}}var i={fc:{age:r("fc/age"),gender:r("fc/gender")}};return Nu(n,e),{params:i,paramMappings:e}}(o)},e.prototype.extractParams=function(t){var i=t.slice(0,t.length-1539),o=t.slice(t.length-1539);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(o)},e}(Ru),GO=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return Bt(e,n),e.prototype.postProcess=function(t,r,i){var o=i.map(function(a){var u=a.width,c=a.height,d=r/Math.max(c,u);return{width:u*d,height:c*d}}),s=o.length;return qe(function(){var a=function(m,y){return ns([Ga([68],m),Ga([68],y)],1).as2D(1,136).as1D()},u=function(m,y){var w=o[m],C=w.width,_=w.height;return y(C,_)?Math.abs(C-_)/2:0};return t.mul(Ga([s,136],r)).sub(ns(Array.from(Array(s),function(m,y){return a(function(m){return u(m,function(y,w){return y<w})}(y),function(m){return u(m,function(y,w){return w<y})}(y))}))).div(ns(Array.from(Array(s),function(m,y){return a(o[y].width,o[y].height)})))})},e.prototype.forwardInput=function(t){var r=this;return qe(function(){var i=r.runNet(t);return r.postProcess(i,t.inputSize,t.inputDimensions.map(function(o){return{height:o[0],width:o[1]}}))})},e.prototype.forward=function(t){return ct(this,void 0,void 0,function(){var r;return lt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Fi(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.detectLandmarks=function(t){return ct(this,void 0,void 0,function(){var r,i,o,s=this;return lt(this,function(a){switch(a.label){case 0:return[4,Fi(t)];case 1:return r=a.sent(),i=qe(function(){return Ci(s.forwardInput(r))}),[4,Promise.all(i.map(function(u,c){return ct(s,void 0,void 0,function(){var d,p,m,y,w;return lt(this,function(C){switch(C.label){case 0:return m=(p=Array).from,[4,u.data()];case 1:return d=m.apply(p,[C.sent()]),y=d.filter(function(_,A){return yO(A)}),w=d.filter(function(_,A){return!yO(A)}),[2,new _O(Array(68).fill(0).map(function(_,A){return new Wn(y[A],w[A])}),{height:r.getInputHeight(c),width:r.getInputWidth(c)})]}})})}))];case 2:return o=a.sent(),i.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e}(jO),YO=function(n){function e(t){return void 0===t&&(t=new VO),n.call(this,"FaceLandmark68Net",t)||this}return Bt(e,n),e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(GO),kZ=function(n){function e(){return n.call(this,"TinyFaceFeatureExtractor")||this}return Bt(e,n),e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return qe(function(){var a=C2(Bp(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Ue(255)),r.dense0,!0);return a=C2(a,r.dense1),a=C2(a,r.dense2),Np(a,[14,14],[2,2],"valid")})},e.prototype.forward=function(t){return ct(this,void 0,void 0,function(){var r;return lt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Fi(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(n){var e=[],t=BO(n,e).extractDenseBlock3Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2")};return Nu(n,e),{params:r,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(n){var e=[],t=Ou(n),i=t.getRemainingWeights,o=FO(t.extractWeights,e).extractDenseBlock3Params,s=o(3,32,"dense0",!0),a=o(32,64,"dense1"),u=o(64,128,"dense2");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:s,dense1:a,dense2:u}}}(t)},e}(Ru),PZ=function(n){function e(t){return void 0===t&&(t=new kZ),n.call(this,"FaceLandmark68TinyNet",t)||this}return Bt(e,n),e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(GO);function T2(n,e,t,r,i){void 0===i&&(i="same");var o=e.conv,a=o.bias,u=xs(n,o.filters,t,i);return u=function(n,e){return an(oo(n,e.weights),e.biases)}(u=an(u,a),e.scale),r?Nr(u):u}function XO(n,e){return T2(n,e,[1,1],!1)}function qO(n,e){return T2(n,e,[2,2],!0,"valid")}function jZ(n){var e=[],t=function(n,e){var t=Mc(n,e);function i(s){return{conv:{filters:t(s+"/conv/filters",4),bias:t(s+"/conv/bias",1)},scale:function(s){return{weights:t(s+"/scale/weights",1),biases:t(s+"/scale/biases",1)}}(s)}}return{extractConvLayerParams:i,extractResidualLayerParams:function(s){return{conv1:i(s+"/conv1"),conv2:i(s+"/conv2")}}}}(n,e),i=t.extractResidualLayerParams,o=(0,t.extractConvLayerParams)("conv32_down"),s=i("conv32_1"),a=i("conv32_2"),u=i("conv32_3"),c=i("conv64_down"),d=i("conv64_1"),p=i("conv64_2"),m=i("conv64_3"),y=i("conv128_down"),w=i("conv128_1"),C=i("conv128_2"),_=i("conv256_down"),A=i("conv256_1"),T=i("conv256_2"),N=i("conv256_down_out"),M=n.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!function(n){return Pp(n,2)}(M))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+M);var O={conv32_down:o,conv32_1:s,conv32_2:a,conv32_3:u,conv64_down:c,conv64_1:d,conv64_2:p,conv64_3:m,conv128_down:y,conv128_1:w,conv128_2:C,conv256_down:_,conv256_1:A,conv256_2:T,conv256_down_out:N,fc:M};return Nu(n,e),{params:O,paramMappings:e}}function Ka(n,e){var t=function(n,e){return T2(n,e,[1,1],!0)}(n,e.conv1);return t=XO(t,e.conv2),t=an(t,n),Nr(t)}function um(n,e){var t=qO(n,e.conv1);t=XO(t,e.conv2);var r=Np(n,2,2,"valid"),i=xr(r.shape),o=r.shape[3]!==t.shape[3];if(r.shape[1]!==t.shape[1]||r.shape[2]!==t.shape[2]){var a=kp(t.shape);a[1]=1;var u=xr(a),c=kp((t=_i([t,u],1)).shape);c[2]=1;var d=xr(c);t=_i([t,d],2)}return r=o?_i([r,i],3):r,t=an(r,t),Nr(t)}!function(n){Bt(function(){return null!==n&&n.apply(this,arguments)||this},n)}(YO);var WZ=function(n){function e(){return n.call(this,"FaceRecognitionNet")||this}return Bt(e,n),e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return qe(function(){var a=qO(Bp(t.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(Ue(256)),r.conv32_down);a=Ka(a=Pi(a,3,2,"valid"),r.conv32_1),a=Ka(a,r.conv32_2),a=Ka(a,r.conv32_3),a=Ka(a=um(a,r.conv64_down),r.conv64_1),a=Ka(a,r.conv64_2),a=Ka(a,r.conv64_3),a=Ka(a=um(a,r.conv128_down),r.conv128_1),a=Ka(a,r.conv128_2),a=Ka(a=um(a,r.conv256_down),r.conv256_1);var u=(a=um(a=Ka(a,r.conv256_2),r.conv256_down_out)).mean([1,2]);return X1(u,r.fc)})},e.prototype.forward=function(t){return ct(this,void 0,void 0,function(){var r;return lt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Fi(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return ct(this,void 0,void 0,function(){var r,i,o,s=this;return lt(this,function(a){switch(a.label){case 0:return[4,Fi(t)];case 1:return r=a.sent(),i=qe(function(){return Ci(s.forwardInput(r))}),[4,Promise.all(i.map(function(u){return u.data()}))];case 2:return o=a.sent(),i.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return jZ(t)},e.prototype.extractParams=function(t){return function(n){var e=Ou(n),t=e.extractWeights,r=e.getRemainingWeights,i=[],o=function(n,e){function r(a,u,c,d){var p=function(a,u,c){var d=n(a),p=d.length/(u*c*c);if(function(n){return n%1!=0}(p))throw new Error("depth has to be an integer: "+p+", weights.length: "+d.length+", numFilters: "+u+", filterSize: "+c);return qe(function(){return Ic(Po(d,[u,p,c,c]),[2,3,1,0])})}(a,u,c),m=ci(n(u));return e.push({paramPath:d+"/filters"},{paramPath:d+"/bias"}),{filters:p,bias:m}}function o(a,u,c,d){return{conv:r(a,u,c,d+"/conv"),scale:function(a,u){var c=ci(n(a)),d=ci(n(a));return e.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:c,biases:d}}(u,d+"/scale")}}return{extractConvLayerParams:o,extractResidualLayerParams:function(a,u,c,d,p){return void 0===p&&(p=!1),{conv1:o((p?.5:1)*a,u,c,d+"/conv1"),conv2:o(a,u,c,d+"/conv2")}}}}(t,i),a=o.extractResidualLayerParams,u=(0,o.extractConvLayerParams)(4704,32,7,"conv32_down"),c=a(9216,32,3,"conv32_1"),d=a(9216,32,3,"conv32_2"),p=a(9216,32,3,"conv32_3"),m=a(36864,64,3,"conv64_down",!0),y=a(36864,64,3,"conv64_1"),w=a(36864,64,3,"conv64_2"),C=a(36864,64,3,"conv64_3"),_=a(147456,128,3,"conv128_down",!0),A=a(147456,128,3,"conv128_1"),T=a(147456,128,3,"conv128_2"),N=a(589824,256,3,"conv256_down",!0),M=a(589824,256,3,"conv256_1"),O=a(589824,256,3,"conv256_2"),L=a(589824,256,3,"conv256_down_out"),V=qe(function(){return Ic(Cc(t(32768),[128,256]),[1,0])});if(i.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:u,conv32_1:c,conv32_2:d,conv32_3:p,conv64_down:m,conv64_1:y,conv64_2:w,conv64_3:C,conv128_down:_,conv128_1:A,conv128_2:T,conv256_down:N,conv256_1:M,conv256_2:O,conv256_down_out:L,fc:V},paramMappings:i}}(t)},e}(Ru);function $O(n,e,t){return Object.assign({},n,{gender:e,genderProbability:t})}var KO=function(){function n(e){var t=void 0===e?{}:e,r=t.minFaceSize,i=t.scaleFactor,o=t.maxNumScales,s=t.scoreThresholds,a=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=i||.709,this._maxNumScales=o||10,this._scoreThresholds=s||[.6,.7,.7],this._scaleSteps=a,"number"!=typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(u){return"number"!=typeof u}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return"number"!=typeof u})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(n.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),n}();function Qa(n,e,t){return qe(function(){var r=xs(n,e.filters,t,"same");return r=an(r,e.batch_norm_offset),Nw(r,0,6)})}function ZZ(n,e,t){var r=n.arraySync(),i=Math.min(r[e][0],r[e][2]),o=Math.min(r[e][1],r[e][3]),s=Math.max(r[e][0],r[e][2]),a=Math.max(r[e][1],r[e][3]),u=Math.min(r[t][0],r[t][2]),c=Math.min(r[t][1],r[t][3]),d=Math.max(r[t][0],r[t][2]),p=Math.max(r[t][1],r[t][3]),m=(s-i)*(a-o),y=(d-u)*(p-c);if(m<=0||y<=0)return 0;var w=Math.max(i,u),C=Math.max(o,c),_=Math.min(s,d),A=Math.min(a,p),T=Math.max(_-w,0)*Math.max(A-C,0);return T/(m+y-T)}function wd(n,e){return qe(function(){var t=n.shape[0];return{boxPredictionEncoding:ca(da(n,e.box_encoding_predictor),[t,-1,1,4]),classPrediction:ca(da(n,e.class_predictor),[t,-1,3])}})}var cm=function(){function n(e){var t=void 0===e?{}:e,r=t.minConfidence,i=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=i||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(n.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),n}(),QO=function(n){function e(){return n.call(this,"SsdMobilenetv1")||this}return Bt(e,n),e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return qe(function(){var i=t.toBatchTensor(512,!1).toFloat(),s=function(n,e){return qe(function(){var t=null,r=Qa(n,e.conv_0,[2,2]);if([e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13].forEach(function(o,s){var a=s+1,u=function(n){return[2,4,6,12].some(function(e){return e===n})?[2,2]:[1,1]}(a);r=Qa(r=function(n,e,t){return qe(function(){var r=Y1(n,e.filters,t,"same");return r=pN(r,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,.0010000000474974513),Nw(r,0,6)})}(r,o.depthwise_conv,u),o.pointwise_conv,[1,1]),11===a&&(t=r)}),null===t)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:t}})}(Ei(oo(i,Ue(.007843137718737125)),Ue(1)),r.mobilenetv1),a=function(n,e,t){return qe(function(){var r=Qa(n,t.conv_0,[1,1]),i=Qa(r,t.conv_1,[2,2]),o=Qa(i,t.conv_2,[1,1]),s=Qa(o,t.conv_3,[2,2]),a=Qa(s,t.conv_4,[1,1]),u=Qa(a,t.conv_5,[2,2]),c=Qa(u,t.conv_6,[1,1]),d=Qa(c,t.conv_7,[2,2]),p=wd(e,t.box_predictor_0),m=wd(n,t.box_predictor_1),y=wd(i,t.box_predictor_2),w=wd(s,t.box_predictor_3),C=wd(u,t.box_predictor_4),_=wd(d,t.box_predictor_5);return{boxPredictions:_i([p.boxPredictionEncoding,m.boxPredictionEncoding,y.boxPredictionEncoding,w.boxPredictionEncoding,C.boxPredictionEncoding,_.boxPredictionEncoding],1),classPredictions:_i([p.classPrediction,m.classPrediction,y.classPrediction,w.classPrediction,C.classPrediction,_.classPrediction],1)}})}(s.out,s.conv11,r.prediction_layer);return function(n,e,t){return qe(function(){var r=n.shape[0],i=function(n,e){var t=function(n){var e=Ci(Ic(n,[1,0])),t=[Ei(e[2],e[0]),Ei(e[3],e[1])];return{sizes:t,centers:[an(e[0],ha(t[0],Ue(2))),an(e[1],ha(t[1],Ue(2)))]}}(n),r=t.sizes,i=t.centers,o=Ci(Ic(e,[1,0])),s=ha(oo(Ow(ha(o[2],Ue(5))),r[0]),Ue(2)),a=an(oo(ha(o[0],Ue(10)),r[0]),i[0]),u=ha(oo(Ow(ha(o[3],Ue(5))),r[1]),Ue(2)),c=an(oo(ha(o[1],Ue(10)),r[1]),i[1]);return Ic(ns([Ei(a,s),Ei(c,u),an(a,s),an(c,u)]),[1,0])}(ca(ad(t.extra_dim,[r,1,1]),[-1,4]),ca(n,[-1,4]));i=ca(i,[r,i.shape[0]/r,4]);var o=lN(Ya(e,[0,0,1],[-1,-1,-1])),s=Ya(o,[0,0,0],[-1,-1,1]);return s=ca(s,[r,s.shape[1]]),{boxes:Ci(i),scores:Ci(s)}})}(a.boxPredictions,a.classPredictions,r.output_layer)})},e.prototype.forward=function(t){return ct(this,void 0,void 0,function(){var r;return lt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Fi(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.locateFaces=function(t,r){return void 0===r&&(r={}),ct(this,void 0,void 0,function(){var i,o,s,a,u,c,d,p,m,y,w,C,_,T,N,M,O,L,V,j;return lt(this,function(U){switch(U.label){case 0:return i=new cm(r),o=i.maxResults,s=i.minConfidence,[4,Fi(t)];case 1:for(a=U.sent(),u=this.forwardInput(a),p=(c=u.boxes)[0],m=(d=u.scores)[0],y=1;y<c.length;y++)c[y].dispose(),d[y].dispose();return _=(C=Array).from,[4,m.data()];case 2:return w=_.apply(C,[U.sent()]),T=function(n,e,t,r,i){var s=Math.min(t,n.shape[0]),a=e.map(function(d,p){return{score:d,boxIndex:p}}).filter(function(d){return d.score>i}).sort(function(d,p){return p.score-d.score}),u=function(d){return d<=.5?1:0},c=[];return a.forEach(function(d){if(!(c.length>=s)){for(var p=d.score,m=c.length-1;m>=0;--m){var y=ZZ(n,d.boxIndex,c[m]);if(0!==y&&(d.score*=u(y),d.score<=i))break}p===d.score&&c.push(d.boxIndex)}}),c}(p,w,o,0,s),N=a.getReshapedInputDimensions(0),O=(M=a.inputSize)/N.width,L=M/N.height,V=p.arraySync(),j=T.map(function(G){var K=[Math.max(0,V[G][0]),Math.min(1,V[G][2])].map(function(we){return we*L}),$=K[0],he=K[1],de=[Math.max(0,V[G][1]),Math.min(1,V[G][3])].map(function(we){return we*O}),se=de[0];return new Xa(w[G],new g2(se,$,de[1]-se,he-$),{height:a.getInputHeight(0),width:a.getInputWidth(0)})}),p.dispose(),m.dispose(),[2,j]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(n){var e=[],t=function(n,e){var t=Mc(n,e);function r(c,d,p){return{filters:t(c+"/Conv2d_"+d+"_pointwise/weights",4,p+"/filters"),batch_norm_offset:t(c+"/Conv2d_"+d+"_pointwise/convolution_bn_offset",1,p+"/batch_norm_offset")}}function i(c){var d="mobilenetv1/conv_"+c,p="MobilenetV1/Conv2d_"+c+"_depthwise",m=d+"/depthwise_conv",y=d+"/pointwise_conv";return{depthwise_conv:{filters:t(p+"/depthwise_weights",4,m+"/filters"),batch_norm_scale:t(p+"/BatchNorm/gamma",1,m+"/batch_norm_scale"),batch_norm_offset:t(p+"/BatchNorm/beta",1,m+"/batch_norm_offset"),batch_norm_mean:t(p+"/BatchNorm/moving_mean",1,m+"/batch_norm_mean"),batch_norm_variance:t(p+"/BatchNorm/moving_variance",1,m+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",c,y)}}function s(c,d){return{filters:t(c+"/weights",4,d+"/filters"),bias:t(c+"/biases",1,d+"/bias")}}function a(c){return{box_encoding_predictor:s("Prediction/BoxPredictor_"+c+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+c+"/box_encoding_predictor"),class_predictor:s("Prediction/BoxPredictor_"+c+"/ClassPredictor","prediction_layer/box_predictor_"+c+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:a(0),box_predictor_1:a(1),box_predictor_2:a(2),box_predictor_3:a(3),box_predictor_4:a(4),box_predictor_5:a(5)}}}}(n,e),r=t.extractMobilenetV1Params,i=t.extractPredictionLayerParams,o=n["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!em(o))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+o);var s={mobilenetv1:r(),prediction_layer:i(),output_layer:{extra_dim:o}};return Nu(n,e),{params:s,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(n){var e=[],t=Ou(n),r=t.extractWeights,i=t.getRemainingWeights,o=function(n,e){function r(u,c,d,p,m){var y=Po(n(u*c*d*d),[d,d,u,c]),w=ci(n(c));return e.push({paramPath:p+"/filters"},{paramPath:p+"/"+(m?"batch_norm_offset":"bias")}),{filters:y,bias:w}}function i(u,c,d,p){var m=r(u,c,d,p,!0);return{filters:m.filters,batch_norm_offset:m.bias}}function o(u,c,d){return{depthwise_conv:function(u,c){var d=Po(n(9*u),[3,3,u,1]),p=ci(n(u)),m=ci(n(u)),y=ci(n(u)),w=ci(n(u));return e.push({paramPath:c+"/filters"},{paramPath:c+"/batch_norm_scale"},{paramPath:c+"/batch_norm_offset"},{paramPath:c+"/batch_norm_mean"},{paramPath:c+"/batch_norm_variance"}),{filters:d,batch_norm_scale:p,batch_norm_offset:m,batch_norm_mean:y,batch_norm_variance:w}}(u,d+"/depthwise_conv"),pointwise_conv:i(u,c,1,d+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:i(3,32,3,"mobilenetv1/conv_0"),conv_1:o(32,64,"mobilenetv1/conv_1"),conv_2:o(64,128,"mobilenetv1/conv_2"),conv_3:o(128,128,"mobilenetv1/conv_3"),conv_4:o(128,256,"mobilenetv1/conv_4"),conv_5:o(256,256,"mobilenetv1/conv_5"),conv_6:o(256,512,"mobilenetv1/conv_6"),conv_7:o(512,512,"mobilenetv1/conv_7"),conv_8:o(512,512,"mobilenetv1/conv_8"),conv_9:o(512,512,"mobilenetv1/conv_9"),conv_10:o(512,512,"mobilenetv1/conv_10"),conv_11:o(512,512,"mobilenetv1/conv_11"),conv_12:o(512,1024,"mobilenetv1/conv_12"),conv_13:o(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:i(1024,256,1,"prediction_layer/conv_0"),conv_1:i(256,512,3,"prediction_layer/conv_1"),conv_2:i(512,128,1,"prediction_layer/conv_2"),conv_3:i(128,256,3,"prediction_layer/conv_3"),conv_4:i(256,128,1,"prediction_layer/conv_4"),conv_5:i(128,256,3,"prediction_layer/conv_5"),conv_6:i(256,64,1,"prediction_layer/conv_6"),conv_7:i(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:r(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:r(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:r(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:r(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:r(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}(r,e),a=o.extractPredictionLayerParams,u=(0,o.extractMobilenetV1Params)(),c=a(),p={extra_dim:sw(r(20472),[1,5118,4])};if(e.push({paramPath:"output_layer/extra_dim"}),0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:u,prediction_layer:c,output_layer:p},paramMappings:e}}(t)},e}(Ru);!function(n){Bt(function(){return null!==n&&n.apply(this,arguments)||this},n)}(QO);var oJ=[new Wn(.738768,.874946),new Wn(2.42204,2.65704),new Wn(4.30971,7.04493),new Wn(10.246,4.59428),new Wn(12.6868,11.8741)],sJ=[new Wn(1.603231,2.094468),new Wn(6.041143,7.080126),new Wn(2.882459,3.518061),new Wn(4.266906,5.178857),new Wn(9.041765,10.66308)],aJ=[117.001,114.697,97.404],lm=function(n){return"number"==typeof n};function M2(n){return qe(function(){var e=oo(n,Ue(.10000000149011612));return an(Nr(Ei(n,e)),e)})}function Rc(n,e){return qe(function(){var t=wl(n,[[0,0],[1,1],[1,1],[0,0]]);return t=xs(t,e.conv.filters,[1,1],"valid"),t=Ei(t,e.bn.sub),t=oo(t,e.bn.truediv),M2(t=an(t,e.conv.bias))})}function Nc(n,e){return qe(function(){var t=wl(n,[[0,0],[1,1],[1,1],[0,0]]);return t=Bw(t,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),M2(t=an(t,e.bias))})}var R2=function(){function n(e){var t=void 0===e?{}:e,r=t.inputSize,i=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=i||.5,"number"!=typeof this._inputSize||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),n}(),ZO=function(n){function e(t){var r=n.call(this,"TinyYolov2")||this;return function(n){if(!n)throw new Error("invalid config: "+n);if("boolean"!=typeof n.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+n.withSeparableConvs);if(!lm(n.iouThreshold)||n.iouThreshold<0||n.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+n.iouThreshold);if(!Array.isArray(n.classes)||!n.classes.length||!n.classes.every(function(e){return"string"==typeof e}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(n.classes));if(!Array.isArray(n.anchors)||!n.anchors.length||!n.anchors.map(function(e){return e||{}}).every(function(e){return lm(e.x)&&lm(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(n.anchors));if(n.meanRgb&&(!Array.isArray(n.meanRgb)||3!==n.meanRgb.length||!n.meanRgb.every(lm)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(n.meanRgb))}(t),r._config=t,r}return Bt(e,n),Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,r){var i=Rc(t,r.conv0);return i=Rc(i=Pi(i,[2,2],[2,2],"same"),r.conv1),i=Rc(i=Pi(i,[2,2],[2,2],"same"),r.conv2),i=Rc(i=Pi(i,[2,2],[2,2],"same"),r.conv3),i=Rc(i=Pi(i,[2,2],[2,2],"same"),r.conv4),i=Rc(i=Pi(i,[2,2],[2,2],"same"),r.conv5),i=Rc(i=Pi(i,[2,2],[1,1],"same"),r.conv6),da(i=Rc(i,r.conv7),r.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,r){var i=this.config.isFirstLayerConv2d?M2(da(t,r.conv0,"valid",!1)):Nc(t,r.conv0);return i=Nc(i=Pi(i,[2,2],[2,2],"same"),r.conv1),i=Nc(i=Pi(i,[2,2],[2,2],"same"),r.conv2),i=Nc(i=Pi(i,[2,2],[2,2],"same"),r.conv3),i=Nc(i=Pi(i,[2,2],[2,2],"same"),r.conv4),i=Nc(i=Pi(i,[2,2],[2,2],"same"),r.conv5),i=Pi(i,[2,2],[1,1],"same"),i=r.conv6?Nc(i,r.conv6):i,da(i=r.conv7?Nc(i,r.conv7):i,r.conv8,"valid",!1)},e.prototype.forwardInput=function(t,r){var i=this,o=this.params;if(!o)throw new Error("TinyYolov2 - load model before inference");return qe(function(){var s=t.toBatchTensor(r,!1).toFloat();return s=(s=i.config.meanRgb?Bp(s,i.config.meanRgb):s).div(Ue(256)),i.config.withSeparableConvs?i.runMobilenet(s,o):i.runTinyYolov2(s,o)})},e.prototype.forward=function(t,r){return ct(this,void 0,void 0,function(){var i;return lt(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,Fi(t)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent()]}})})},e.prototype.detect=function(t,r){return void 0===r&&(r={}),ct(this,void 0,void 0,function(){var i,o,s,a,u,c,d,p,m,y,w,C,T=this;return lt(this,function(N){switch(N.label){case 0:return i=new R2(r),o=i.inputSize,s=i.scoreThreshold,[4,Fi(t)];case 1:return a=N.sent(),[4,this.forwardInput(a,o)];case 2:return u=N.sent(),c=qe(function(){return Ci(u)[0].expandDims()}),d={width:a.getInputWidth(0),height:a.getInputHeight(0)},[4,this.extractBoxes(c,a.getReshapedInputDimensions(0),s)];case 3:return p=N.sent(),u.dispose(),c.dispose(),m=p.map(function(M){return M.box}),y=p.map(function(M){return M.score}),w=p.map(function(M){return M.classScore}),C=p.map(function(M){return T.config.classes[M.label]}),[2,Lp(m.map(function(M){return M.rescale(o)}),y,this.config.iouThreshold,!0).map(function(M){return new wO(y[M],w[M],C[M],m[M],d)})]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return function(n,e){var a,t=[],r=function(n,e){var t=Mc(n,e);function i(a){return{filters:t(a+"/filters",4),bias:t(a+"/bias",1)}}return{extractConvParams:i,extractConvWithBatchNormParams:function(a){return{conv:i(a+"/conv"),bn:function(a){return{sub:t(a+"/sub",1),truediv:t(a+"/truediv",1)}}(a+"/bn")}},extractSeparableConvParams:A2(t)}}(n,t),i=r.extractConvParams,o=r.extractConvWithBatchNormParams,s=r.extractSeparableConvParams;if(e.withSeparableConvs){var u=e.filterSizes&&e.filterSizes.length||9;a={conv0:e.isFirstLayerConv2d?i("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:u>7?s("conv6"):void 0,conv7:u>8?s("conv7"):void 0,conv8:i("conv8")}}else a={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:i("conv8")};return Nu(n,t),{params:a,paramMappings:t}}(t,this.config)},e.prototype.extractParams=function(t){var r=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,i=r?r.length:void 0;if(7!==i&&8!==i&&9!==i)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+i+" filterSizes in config");return function(n,e,t,r){var m,i=Ou(n),s=i.getRemainingWeights,a=[],u=function(n,e){var t=am(n,e),o=I2(n,e);return{extractConvParams:t,extractConvWithBatchNormParams:function(s,a,u){return{conv:t(s,a,3,u+"/conv"),bn:function(s,a){var u=ci(n(s)),c=ci(n(s));return e.push({paramPath:a+"/sub"},{paramPath:a+"/truediv"}),{sub:u,truediv:c}}(a,u+"/bn")}},extractSeparableConvParams:o}}(i.extractWeights,a),c=u.extractConvParams,d=u.extractConvWithBatchNormParams,p=u.extractSeparableConvParams;if(e.withSeparableConvs){var y=r[0],w=r[1],C=r[2],_=r[3],A=r[4],T=r[5],N=r[6],M=r[7],O=r[8];m={conv0:e.isFirstLayerConv2d?c(y,w,3,"conv0"):p(y,w,"conv0"),conv1:p(w,C,"conv1"),conv2:p(C,_,"conv2"),conv3:p(_,A,"conv3"),conv4:p(A,T,"conv4"),conv5:p(T,N,"conv5"),conv6:M?p(N,M,"conv6"):void 0,conv7:O?p(M,O,"conv7"):void 0,conv8:c(O||M||N,5*t,1,"conv8")}}else C=r[2],_=r[3],A=r[4],T=r[5],N=r[6],M=r[7],O=r[8],m={conv0:d(y=r[0],w=r[1],"conv0"),conv1:d(w,C,"conv1"),conv2:d(C,_,"conv2"),conv3:d(_,A,"conv3"),conv4:d(A,T,"conv4"),conv5:d(T,N,"conv5"),conv6:d(N,M,"conv6"),conv7:d(M,O,"conv7"),conv8:c(O,5*t,1,"conv8")};if(0!==s().length)throw new Error("weights remaing after extract: "+s().length);return{params:m,paramMappings:a}}(t,this.config,this.boxEncodingSize,r)},e.prototype.extractBoxes=function(t,r,i){return ct(this,void 0,void 0,function(){var o,s,a,u,c,d,p,m,y,w,C,_,A,T,N,M,O,L,V,j,U,G,K,$,he,de,se,fe,we,ye=this;return lt(this,function(Ee){switch(Ee.label){case 0:return o=r.width,s=r.height,a=Math.max(o,s),u=a/o,c=a/s,d=t.shape[1],p=this.config.anchors.length,m=qe(function(){var Se=t.reshape([d,d,p,ye.boxEncodingSize]);return[Se.slice([0,0,0,0],[d,d,p,4]),Se.slice([0,0,0,4],[d,d,p,1]),ye.withClassScores?Eu(Se.slice([0,0,0,5],[d,d,p,ye.config.classes.length]),3):Ue(0)]}),y=m[0],C=m[2],_=[],[4,(w=m[1]).array()];case 1:return A=Ee.sent(),[4,y.array()];case 2:T=Ee.sent(),N=0,Ee.label=3;case 3:if(!(N<d))return[3,12];M=0,Ee.label=4;case 4:if(!(M<d))return[3,11];O=0,Ee.label=5;case 5:return O<p?(L=p2(A[N][M][O][0]),!i||L>i?(V=(M+p2(T[N][M][O][0]))/d*u,j=(N+p2(T[N][M][O][1]))/d*c,U=Math.exp(T[N][M][O][2])*this.config.anchors[O].x/d*u,G=Math.exp(T[N][M][O][3])*this.config.anchors[O].y/d*c,K=V-U/2,$=j-G/2,he={row:N,col:M,anchor:O},this.withClassScores?[4,this.extractPredictedClass(C,he)]:[3,7]):[3,9]):[3,10];case 6:return we=Ee.sent(),[3,8];case 7:we={classScore:1,label:0},Ee.label=8;case 8:se=(de=we).classScore,fe=de.label,_.push(ao({box:new tm(K,$,K+U,$+G),score:L,classScore:L*se,label:fe},he)),Ee.label=9;case 9:return O++,[3,5];case 10:return M++,[3,4];case 11:return N++,[3,3];case 12:return y.dispose(),w.dispose(),C.dispose(),[2,_]}})})},e.prototype.extractPredictedClass=function(t,r){return ct(this,void 0,void 0,function(){var i,o,s,a;return lt(this,function(u){switch(u.label){case 0:return i=r.row,o=r.col,s=r.anchor,[4,t.array()];case 1:return a=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(c,d){return a[i][o][s][d]}).map(function(c,d){return{classScore:c,label:d}}).reduce(function(c,d){return c.classScore>d.classScore?c:d})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(Ru),gJ=function(n){function e(t){void 0===t&&(t=!0);var i=Object.assign({},{withSeparableConvs:t,iouThreshold:.4,classes:["face"]},t?{anchors:sJ,meanRgb:aJ}:{anchors:oJ,withClassScores:!0});return n.call(this,i)||this}return Bt(e,n),Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return ct(this,void 0,void 0,function(){return lt(this,function(o){switch(o.label){case 0:return[4,this.detect(t,r)];case 1:return[2,o.sent().map(function(s){return new Xa(s.score,s.relativeBox,{width:s.imageWidth,height:s.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e}(ZO),mJ=function(n){function e(){var t=null!==n&&n.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return Bt(e,n),e}(R2),Up=function(){function n(){}return n.prototype.then=function(e){return ct(this,void 0,void 0,function(){var t;return lt(this,function(r){switch(r.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[r.sent()])]}})})},n.prototype.run=function(){return ct(this,void 0,void 0,function(){return lt(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},n}();function JO(n,e){return Object.assign({},n,{descriptor:e})}function hm(n,e,t,r,i){return void 0===i&&(i=function(o){return o.alignedRect}),ct(this,void 0,void 0,function(){var o,s,a,u,c;return lt(this,function(d){switch(d.label){case 0:return o=n.map(function(p){return function(n){return function(n){return n.detection instanceof Xa}(n)&&n.landmarks instanceof nm&&n.unshiftedLandmarks instanceof nm&&n.alignedRect instanceof Xa}(p)?i(p):p.detection}),(a=r)?[3,5]:e instanceof or?[4,_2(e,o)]:[3,2];case 1:return u=d.sent(),[3,4];case 2:return[4,w2(e,o)];case 3:u=d.sent(),d.label=4;case 4:a=u,d.label=5;case 5:return[4,t(s=a)];case 6:return c=d.sent(),s.forEach(function(p){return p instanceof or&&p.dispose()}),[2,c]}})})}function N2(n,e,t,r,i){return ct(this,void 0,void 0,function(){var o=this;return lt(this,function(s){return[2,hm([n],e,function(a){return ct(o,void 0,void 0,function(){return lt(this,function(u){return[2,t(a[0])]})})},r,i)]})})}function O2(n,e){var r=e[1];return{height:Math.floor(e[0]*n),width:Math.floor(r*n)}}var k2=function(n){function e(t,r,i,o){return n.call(this,{left:t,top:r,right:i,bottom:o},!0)||this}return Bt(e,n),e}(Tu);function ek(n){return qe(function(){return oo(Ei(n,Ue(127.5)),Ue(.0078125))})}function _d(n,e){return qe(function(){return an(Nr(n),oo(e,j1(Nr(j1(n)))))})}function P2(n,e,t){return void 0===t&&(t=!1),qe(function(){var r=da(n,e.conv1,"valid");return r=_d(r,e.prelu1_alpha),r=_d(r=da(r=Pi(r,t?[2,2]:[3,3],[2,2],"same"),e.conv2,"valid"),e.prelu2_alpha),_d(r=da(r=t?r:Pi(r,[3,3],[2,2],"valid"),e.conv3,"valid"),e.prelu3_alpha)})}function AJ(n,e,t,r,i){i.stage1=[];var a=e.map(function(m){return qe(function(){var y={scale:m},w=function(n,e){return qe(function(){var t=O2(e,n.shape.slice(1)),s=ek(Hw.resizeBilinear(n,[t.height,t.width]));return Ic(s,[0,2,1,3])})}(n,m),C=Date.now(),_=function(n,e){return qe(function(){var t=P2(n,e,!0),r=da(t,e.conv4_1,"valid"),i=ys(q1(r,3),3);return{prob:Eu(Ei(r,i),3),regions:da(t,e.conv4_2,"valid")}})}(w,r),A=_.prob,T=_.regions;return y.pnet=Date.now()-C,{scoresTensor:Ci(Ci(A,3)[1])[0],regionsTensor:Ci(T)[0],scale:m,statsForScale:y}})}).map(function(m){var y=m.scoresTensor,w=m.regionsTensor,_=m.statsForScale,A=function(n,e,t,r){for(var i=[],o=n.arraySync(),s=0;s<n.shape[0];s++)for(var a=0;a<n.shape[1];a++)o[s][a]>=r&&i.push(new Wn(a,s));return i.map(function(c){var d=new tm(Math.round((2*c.y+1)/t),Math.round((2*c.x+1)/t),Math.round((2*c.y+12)/t),Math.round((2*c.x+12)/t)),p=o[c.y][c.x],m=e.arraySync();return{cell:d,score:p,region:new k2(m[c.y][c.x][0],m[c.y][c.x][1],m[c.y][c.x][2],m[c.y][c.x][3])}})}(y,w,m.scale,t);if(y.dispose(),w.dispose(),!A.length)return i.stage1.push(_),[];var T=Date.now(),N=Lp(A.map(function(M){return M.cell}),A.map(function(M){return M.score}),.5);return _.nms=Date.now()-T,_.numBoxes=N.length,i.stage1.push(_),N.map(function(M){return A[M]})}).reduce(function(m,y){return m.concat(y)},[]),u=[],c=[];if(a.length>0){var d=Date.now(),p=Lp(a.map(function(m){return m.cell}),a.map(function(m){return m.score}),.7);i.stage1_nms=Date.now()-d,c=p.map(function(m){return a[m].score}),u=p.map(function(m){return a[m]}).map(function(m){var y=m.cell,w=m.region;return new tm(y.left+w.left*y.width,y.top+w.top*y.height,y.right+w.right*y.width,y.bottom+w.bottom*y.height).toSquare().round()})}return{boxes:u,scores:c}}function tk(n,e,t){var r=t.width,i=t.height;return ct(this,void 0,void 0,function(){var o,s,a,u=this;return lt(this,function(c){switch(c.label){case 0:return o=qa(n),[4,Promise.all(e.map(function(d){return ct(u,void 0,void 0,function(){var p,_,A,T;return lt(this,function(N){return p=d.padAtBorders(n.height,n.width),T=o.getImageData(_=p.x-1,A=p.y-1,p.ex-_,p.ey-A),[2,qi.isNodejs()?b2(T):createImageBitmap(T)]})})}))];case 1:return s=c.sent(),a=[],s.forEach(function(d){var m=qa(im({width:r,height:i}));m.drawImage(d,0,0,r,i);for(var y=m.getImageData(0,0,r,i).data,w=[],C=0;C<y.length;C+=4)w.push(y[C+2]),w.push(y[C+1]),w.push(y[C]);a.push(w)}),[2,a.map(function(d){return qe(function(){return ek(Ic(Po(d,[1,r,i,3]),[0,2,1,3]).toFloat())})})]}})})}function SJ(n,e,t,r,i){return ct(this,void 0,void 0,function(){var o,s,a,u,c,d,p,m,y,w,C,_,A,T;return lt(this,function(N){switch(N.label){case 0:return o=Date.now(),[4,tk(n,e,{width:24,height:24})];case 1:return s=N.sent(),i.stage2_extractImagePatches=Date.now()-o,o=Date.now(),a=s.map(function(M){var O=function(n,e){return qe(function(){var t=P2(n,e),o=_d($a(ca(t,[t.shape[0],e.fc1.weights.shape[0]]),e.fc1),e.prelu4_alpha),s=$a(o,e.fc2_1),a=ys(q1(s,1),1),u=Eu(Ei(s,a),1),c=$a(o,e.fc2_2);return{scores:Ci(u,1)[1],regions:c}})}(M,r);return M.dispose(),O}),i.stage2_rnet=Date.now()-o,u=a.length>1?_i(a.map(function(M){return M.scores})):a[0].scores,p=(d=Array).from,[4,u.data()];case 2:return c=p.apply(d,[N.sent()]),u.dispose(),m=c.map(function(M,O){return{score:M,idx:O}}).filter(function(M){return M.score>t}).map(function(M){return M.idx}),y=m.map(function(M){return e[M]}),w=m.map(function(M){return c[M]}),C=[],_=[],y.length>0&&(o=Date.now(),A=Lp(y,w,.7),i.stage2_nms=Date.now()-o,T=A.map(function(M){var O=a[m[M]].regions.arraySync();return new k2(O[0][0],O[0][1],O[0][2],O[0][3])}),_=A.map(function(M){return w[M]}),C=A.map(function(M,O){return y[M].calibrate(T[O])})),a.forEach(function(M){M.regions.dispose(),M.scores.dispose()}),[2,{boxes:C,scores:_}]}})})}function MJ(n,e,t,r,i){return ct(this,void 0,void 0,function(){var o,s,a,u,c,d,p,m,y,w,C,_,A,T,N;return lt(this,function(M){switch(M.label){case 0:return o=Date.now(),[4,tk(n,e,{width:48,height:48})];case 1:return s=M.sent(),i.stage3_extractImagePatches=Date.now()-o,o=Date.now(),a=s.map(function(O){var L=function(n,e){return qe(function(){var t=P2(n,e);t=_d(t=da(t=Pi(t,[2,2],[2,2],"same"),e.conv4,"valid"),e.prelu4_alpha);var o=_d($a(ca(t,[t.shape[0],e.fc1.weights.shape[0]]),e.fc1),e.prelu5_alpha),s=$a(o,e.fc2_1),a=ys(q1(s,1),1),u=Eu(Ei(s,a),1),c=$a(o,e.fc2_2),d=$a(o,e.fc2_3);return{scores:Ci(u,1)[1],regions:c,points:d}})}(O,r);return O.dispose(),L}),i.stage3_onet=Date.now()-o,u=a.length>1?_i(a.map(function(O){return O.scores})):a[0].scores,p=(d=Array).from,[4,u.data()];case 2:return c=p.apply(d,[M.sent()]),u.dispose(),m=c.map(function(O,L){return{score:O,idx:L}}).filter(function(O){return O.score>t}).map(function(O){return O.idx}),y=m.map(function(O){var L=a[O].regions.arraySync();return new k2(L[0][0],L[0][1],L[0][2],L[0][3])}),w=m.map(function(O,L){return e[O].calibrate(y[L])}),C=m.map(function(O){return c[O]}),_=[],A=[],T=[],w.length>0&&(o=Date.now(),N=Lp(w,C,.7,!1),i.stage3_nms=Date.now()-o,_=N.map(function(O){return w[O]}),A=N.map(function(O){return C[O]}),T=N.map(function(O,L){return Array(5).fill(0).map(function(V,j){var U=a[O].points.arraySync();return new Wn(U[0][j]*(_[L].width+1)+_[L].left,U[0][j+5]*(_[L].height+1)+_[L].top)})})),a.forEach(function(O){O.regions.dispose(),O.scores.dispose(),O.points.dispose()}),[2,{boxes:_,scores:A,points:T}]}})})}var RJ=function(n){function e(){return n.call(this,"Mtcnn")||this}return Bt(e,n),e.prototype.load=function(t){return ct(this,void 0,void 0,function(){return lt(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.load.call(this,t)]})})},e.prototype.loadFromDisk=function(t){return ct(this,void 0,void 0,function(){return lt(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.loadFromDisk.call(this,t)]})})},e.prototype.forwardInput=function(t,r){return void 0===r&&(r={}),ct(this,void 0,void 0,function(){var i,o,s,a,u,c,d,p,m,y,w,C,_,A,N,M,O,L,V,j;return lt(this,function(U){switch(U.label){case 0:if(!(i=this.params))throw new Error("Mtcnn - load model before inference");if(!(o=t.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return s={},a=Date.now(),u=qe(function(){return function(n){return qe(function(){return ns(Ci(n,3).reverse(),3)})}(ys(a2.fromPixels(o)).toFloat())}),c=function(G){return u.dispose(),s.total=Date.now()-a,G},d=u.shape.slice(1),p=d[0],m=d[1],y=new KO(r),w=y.minFaceSize,C=y.scaleFactor,_=y.maxNumScales,A=y.scoreThresholds,N=(y.scaleSteps||function(n,e,t){for(var o=12/n,s=[],a=Math.min(t[0],t[1])*o,u=0;a>=12;)s.push(o*Math.pow(e,u)),a*=e,u+=1;return s}(w,C,[p,m])).filter(function(G){var K=O2(G,[p,m]);return Math.min(K.width,K.height)>12}).slice(0,_),s.scales=N,s.pyramid=N.map(function(G){return O2(G,[p,m])}),M=Date.now(),[4,AJ(u,N,A[0],i.pnet,s)];case 1:return O=U.sent(),s.total_stage1=Date.now()-M,O.boxes.length?(s.stage2_numInputBoxes=O.boxes.length,M=Date.now(),[4,SJ(o,O.boxes,A[1],i.rnet,s)]):[2,c({results:[],stats:s})];case 2:return L=U.sent(),s.total_stage2=Date.now()-M,L.boxes.length?(s.stage3_numInputBoxes=L.boxes.length,M=Date.now(),[4,MJ(o,L.boxes,A[2],i.onet,s)]):[2,c({results:[],stats:s})];case 3:return V=U.sent(),s.total_stage3=Date.now()-M,j=V.boxes.map(function(G,K){return D2(m2({},new Xa(V.scores[K],new g2(G.left/m,G.top/p,G.width/m,G.height/p),{height:p,width:m})),new tZ(V.points[K].map(function($){return $.sub(new Wn(G.left,G.top)).div(new Wn(G.width,G.height))}),{width:G.width,height:G.height}))}),[2,c({results:j,stats:s})]}})})},e.prototype.forward=function(t,r){return void 0===r&&(r={}),ct(this,void 0,void 0,function(){var i;return lt(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,Fi(t)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent().results]}})})},e.prototype.forwardWithStats=function(t,r){return void 0===r&&(r={}),ct(this,void 0,void 0,function(){var i;return lt(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,Fi(t)];case 1:return[2,i.apply(this,[o.sent(),r])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(n){var e=[],t=function(n,e){var t=Mc(n,e);function r(d){return{filters:t(d+"/weights",4,d+"/filters"),bias:t(d+"/bias",1)}}function i(d){return{weights:t(d+"/weights",2),bias:t(d+"/bias",1)}}function o(d){return t(d,1)}function s(d){return{conv1:r(d+"/conv1"),prelu1_alpha:o(d+"/prelu1_alpha"),conv2:r(d+"/conv2"),prelu2_alpha:o(d+"/prelu2_alpha"),conv3:r(d+"/conv3"),prelu3_alpha:o(d+"/prelu3_alpha")}}return{extractPNetParams:function(){var d=s("pnet"),p=r("pnet/conv4_1"),m=r("pnet/conv4_2");return ao(ao({},d),{conv4_1:p,conv4_2:m})},extractRNetParams:function(){var d=s("rnet"),p=i("rnet/fc1"),m=o("rnet/prelu4_alpha"),y=i("rnet/fc2_1"),w=i("rnet/fc2_2");return ao(ao({},d),{fc1:p,prelu4_alpha:m,fc2_1:y,fc2_2:w})},extractONetParams:function(){var d=s("onet"),p=r("onet/conv4"),m=o("onet/prelu4_alpha"),y=i("onet/fc1"),w=o("onet/prelu5_alpha"),C=i("onet/fc2_1"),_=i("onet/fc2_2"),A=i("onet/fc2_3");return ao(ao({},d),{conv4:p,prelu4_alpha:m,fc1:y,prelu5_alpha:w,fc2_1:C,fc2_2:_,fc2_3:A})}}}(n,e),i=t.extractRNetParams,o=t.extractONetParams,s=(0,t.extractPNetParams)(),a=i(),u=o();return Nu(n,e),{params:{pnet:s,rnet:a,onet:u},paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(n){var e=Ou(n),r=e.getRemainingWeights,i=[],o=function(n,e){var t=am(n,e),r=E2(n,e);function i(c,d){var p=ci(n(c));return e.push({paramPath:d}),p}function o(c,d,p){return void 0===p&&(p=!1),{conv1:t(c[0],c[1],3,d+"/conv1"),prelu1_alpha:i(c[1],d+"/prelu1_alpha"),conv2:t(c[1],c[2],3,d+"/conv2"),prelu2_alpha:i(c[2],d+"/prelu2_alpha"),conv3:t(c[2],c[3],p?2:3,d+"/conv3"),prelu3_alpha:i(c[3],d+"/prelu3_alpha")}}return{extractPNetParams:function(){var c=o([3,10,16,32],"pnet"),d=t(32,2,1,"pnet/conv4_1"),p=t(32,4,1,"pnet/conv4_2");return ao(ao({},c),{conv4_1:d,conv4_2:p})},extractRNetParams:function(){var c=o([3,28,48,64],"rnet",!0),d=r(576,128,"rnet/fc1"),p=i(128,"rnet/prelu4_alpha"),m=r(128,2,"rnet/fc2_1"),y=r(128,4,"rnet/fc2_2");return ao(ao({},c),{fc1:d,prelu4_alpha:p,fc2_1:m,fc2_2:y})},extractONetParams:function(){var c=o([3,32,64,64],"onet"),d=t(64,128,2,"onet/conv4"),p=i(128,"onet/prelu4_alpha"),m=r(1152,256,"onet/fc1"),y=i(256,"onet/prelu5_alpha"),w=r(256,2,"onet/fc2_1"),C=r(256,4,"onet/fc2_2"),_=r(256,10,"onet/fc2_3");return ao(ao({},c),{conv4:d,prelu4_alpha:p,fc1:m,prelu5_alpha:y,fc2_1:w,fc2_2:C,fc2_3:_})}}}(e.extractWeights,i),a=o.extractRNetParams,u=o.extractONetParams,c=(0,o.extractPNetParams)(),d=a(),p=u();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:c,rnet:d,onet:p},paramMappings:i}}(t)},e}(Ru),OJ=[new Wn(1.603231,2.094468),new Wn(6.041143,7.080126),new Wn(2.882459,3.518061),new Wn(4.266906,5.178857),new Wn(9.041765,10.66308)],kJ=[117.001,114.697,97.404],PJ=function(n){function e(){return n.call(this,{withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:OJ,meanRgb:kJ,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]})||this}return Bt(e,n),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return ct(this,void 0,void 0,function(){return lt(this,function(o){switch(o.label){case 0:return[4,this.detect(t,r)];case 1:return[2,o.sent().map(function(s){return new Xa(s.score,s.relativeBox,{width:s.imageWidth,height:s.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e}(ZO),Ln={ssdMobilenetv1:new QO,tinyFaceDetector:new PJ,tinyYolov2:new gJ,mtcnn:new RJ,faceLandmark68Net:new YO,faceLandmark68TinyNet:new PZ,faceRecognitionNet:new WZ,faceExpressionNet:new xZ,ageGenderNet:new RZ};function nk(n,e){return Object.assign({},n,{age:e})}var rk=function(n){function e(t,r,i){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o.extractedFaces=i,o}return Bt(e,n),e}(Up),F2=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return Bt(e,n),e.prototype.run=function(){return ct(this,void 0,void 0,function(){var t,r,i=this;return lt(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return[4,hm(t=o.sent(),this.input,function(s){return ct(i,void 0,void 0,function(){return lt(this,function(a){switch(a.label){case 0:return[4,Promise.all(s.map(function(u){return Ln.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,a.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,t.map(function(s,a){return HO(s,r[a])})]}})})},e.prototype.withAgeAndGender=function(){return new U2(this,this.input)},e}(rk),L2=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return Bt(e,n),e.prototype.run=function(){return ct(this,void 0,void 0,function(){var t,r;return lt(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return(t=i.sent())?[4,N2(t,this.input,function(o){return Ln.faceExpressionNet.predictExpressions(o)},this.extractedFaces)]:[2];case 2:return r=i.sent(),[2,HO(t,r)]}})})},e.prototype.withAgeAndGender=function(){return new j2(this,this.input)},e}(rk),B2=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return Bt(e,n),e.prototype.withAgeAndGender=function(){return new W2(this,this.input)},e.prototype.withFaceDescriptors=function(){return new z2(this,this.input)},e}(F2),V2=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return Bt(e,n),e.prototype.withAgeAndGender=function(){return new H2(this,this.input)},e.prototype.withFaceDescriptor=function(){return new G2(this,this.input)},e}(L2),ik=function(n){function e(t,r,i){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o.extractedFaces=i,o}return Bt(e,n),e}(Up),U2=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return Bt(e,n),e.prototype.run=function(){return ct(this,void 0,void 0,function(){var t,r,i=this;return lt(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return[4,hm(t=o.sent(),this.input,function(s){return ct(i,void 0,void 0,function(){return lt(this,function(a){switch(a.label){case 0:return[4,Promise.all(s.map(function(u){return Ln.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,a.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,t.map(function(s,a){var u=r[a],c=u.age;return nk($O(s,u.gender,u.genderProbability),c)})]}})})},e.prototype.withFaceExpressions=function(){return new F2(this,this.input)},e}(ik),j2=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return Bt(e,n),e.prototype.run=function(){return ct(this,void 0,void 0,function(){var t,r,i;return lt(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return(t=a.sent())?[4,N2(t,this.input,function(u){return Ln.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=a.sent(),i=r.age,[2,nk($O(t,r.gender,r.genderProbability),i)]}})})},e.prototype.withFaceExpressions=function(){return new L2(this,this.input)},e}(ik),W2=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return Bt(e,n),e.prototype.withFaceExpressions=function(){return new B2(this,this.input)},e.prototype.withFaceDescriptors=function(){return new z2(this,this.input)},e}(U2),H2=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return Bt(e,n),e.prototype.withFaceExpressions=function(){return new V2(this,this.input)},e.prototype.withFaceDescriptor=function(){return new G2(this,this.input)},e}(j2),ok=function(n){function e(t,r){var i=n.call(this)||this;return i.parentTask=t,i.input=r,i}return Bt(e,n),e}(Up),z2=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return Bt(e,n),e.prototype.run=function(){return ct(this,void 0,void 0,function(){var t;return lt(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return[4,hm(t=i.sent(),this.input,function(o){return Promise.all(o.map(function(s){return Ln.faceRecognitionNet.computeFaceDescriptor(s)}))},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,i.sent().map(function(o,s){return JO(t[s],o)})]}})})},e.prototype.withFaceExpressions=function(){return new B2(this,this.input)},e.prototype.withAgeAndGender=function(){return new W2(this,this.input)},e}(ok),G2=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return Bt(e,n),e.prototype.run=function(){return ct(this,void 0,void 0,function(){var t,r;return lt(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return(t=i.sent())?[4,N2(t,this.input,function(o){return Ln.faceRecognitionNet.computeFaceDescriptor(o)},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=i.sent(),[2,JO(t,r)]}})})},e.prototype.withFaceExpressions=function(){return new V2(this,this.input)},e.prototype.withAgeAndGender=function(){return new H2(this,this.input)},e}(ok),sk=function(n){function e(t,r,i){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o.useTinyLandmarkNet=i,o}return Bt(e,n),Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?Ln.faceLandmark68TinyNet:Ln.faceLandmark68Net},enumerable:!0,configurable:!0}),e}(Up),FJ=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return Bt(e,n),e.prototype.run=function(){return ct(this,void 0,void 0,function(){var t,r,i,o,s,a=this;return lt(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return t=u.sent(),r=t.map(function(c){return c.detection}),this.input instanceof or?[4,_2(this.input,r)]:[3,3];case 2:return o=u.sent(),[3,5];case 3:return[4,w2(this.input,r)];case 4:o=u.sent(),u.label=5;case 5:return i=o,[4,Promise.all(i.map(function(c){return a.landmarkNet.detectLandmarks(c)}))];case 6:return s=u.sent(),i.forEach(function(c){return c instanceof or&&c.dispose()}),[2,t.map(function(c,d){return D2(c,s[d])})]}})})},e.prototype.withFaceExpressions=function(){return new B2(this,this.input)},e.prototype.withAgeAndGender=function(){return new W2(this,this.input)},e.prototype.withFaceDescriptors=function(){return new z2(this,this.input)},e}(sk),LJ=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return Bt(e,n),e.prototype.run=function(){return ct(this,void 0,void 0,function(){var t,r,i,o,s;return lt(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return(t=a.sent())?(r=t.detection,this.input instanceof or?[4,_2(this.input,[r])]:[3,3]):[2];case 2:return o=a.sent(),[3,5];case 3:return[4,w2(this.input,[r])];case 4:o=a.sent(),a.label=5;case 5:return[4,this.landmarkNet.detectLandmarks((i=o)[0])];case 6:return s=a.sent(),i.forEach(function(u){return u instanceof or&&u.dispose()}),[2,D2(t,s)]}})})},e.prototype.withFaceExpressions=function(){return new V2(this,this.input)},e.prototype.withAgeAndGender=function(){return new H2(this,this.input)},e.prototype.withFaceDescriptor=function(){return new G2(this,this.input)},e}(sk),ak=function(n){function e(t,r){void 0===r&&(r=new cm);var i=n.call(this)||this;return i.input=t,i.options=r,i}return Bt(e,n),e}(Up),BJ=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return Bt(e,n),e.prototype.run=function(){return ct(this,void 0,void 0,function(){var t,r,i,o;return lt(this,function(s){switch(s.label){case 0:return r=(t=this).input,(i=t.options)instanceof KO?[4,Ln.mtcnn.forward(r,i)]:[3,2];case 1:return[2,s.sent().map(function(a){return a.detection})];case 2:if(!(o=i instanceof mJ?function(a){return Ln.tinyFaceDetector.locateFaces(a,i)}:i instanceof cm?function(a){return Ln.ssdMobilenetv1.locateFaces(a,i)}:i instanceof R2?function(a){return Ln.tinyYolov2.locateFaces(a,i)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,o(r)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(r){return ct(t,void 0,void 0,function(){var i;return lt(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i.map(function(s){return m2({},s)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new FJ(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new F2(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new U2(this.runAndExtendWithFaceDetections(),this.input)},e}(ak),VJ=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return Bt(e,n),e.prototype.run=function(){return ct(this,void 0,void 0,function(){var t,r;return lt(this,function(i){switch(i.label){case 0:return[4,new BJ(this.input,this.options)];case 1:return t=i.sent(),r=t[0],t.forEach(function(o){o.score>r.score&&(r=o)}),[2,r]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(r){return ct(t,void 0,void 0,function(){var i;return lt(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i?m2({},i):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new LJ(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new L2(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new j2(this.runAndExtendWithFaceDetection(),this.input)},e}(ak);!function(){function n(e,t){void 0===t&&(t=.6),this._distanceThreshold=t;var r=Array.isArray(e)?e:[e];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var i=1,o=function(){return"person "+i++};this._labeledDescriptors=r.map(function(s){if(s instanceof rm)return s;if(s instanceof Float32Array)return new rm(o(),[s]);if(s.descriptor&&s.descriptor instanceof Float32Array)return new rm(o(),[s.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}Object.defineProperty(n.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),n.prototype.computeMeanDistance=function(e,t){return t.map(function(r){return function(n,e){if(n.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var t=Array.from(n),r=Array.from(e);return Math.sqrt(t.map(function(i,o){return i-r[o]}).reduce(function(i,o){return i+Math.pow(o,2)},0))}(r,e)}).reduce(function(r,i){return r+i},0)/(t.length||1)},n.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(r){return new CO(r.label,t.computeMeanDistance(e,r.descriptors))}).reduce(function(r,i){return r.distance<i.distance?r:i})},n.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new CO("unknown",t.distance)},n.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(e){return e.toJSON()})}},n.fromJSON=function(e){return new n(e.labeledDescriptors.map(function(r){return rm.fromJSON(r)}),e.distanceThreshold)}}();let Y2=(()=>{class n{constructor(){Ln.ssdMobilenetv1.loadFromUri(ra_faceApiSourceUrl),Ln.faceLandmark68Net.loadFromUri(ra_faceApiSourceUrl),Ln.faceRecognitionNet.loadFromUri(ra_faceApiSourceUrl)}getSingleFaceDescriptor(t){var r=this;return qn(function*(){const i=yield r.getSingleFace(t);return null==i?void 0:i.descriptor})()}getSingleFace(t){return qn(function*(){return yield function(n,e){return void 0===e&&(e=new cm),new VJ(n,e)}(t).withFaceLandmarks().withFaceDescriptor()})()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ve({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class HJ extends At{constructor(e,t){super()}schedule(e,t=0){return this}}class uk extends HJ{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){if(this.closed)return this;this.state=e;const r=this.id,i=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(i,r,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(i,this.id,t),this}requestAsyncId(e,t,r=0){return setInterval(e.flush.bind(e,this),r)}recycleAsyncId(e,t,r=0){if(null!==r&&this.delay===r&&!1===this.pending)return t;clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(e,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let i,r=!1;try{this.work(e)}catch(o){r=!0,i=!!o&&o||new Error(o)}if(r)return this.unsubscribe(),i}_unsubscribe(){const e=this.id,t=this.scheduler,r=t.actions,i=r.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==i&&r.splice(i,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null}}let ck=(()=>{class n{constructor(t,r=n.now){this.SchedulerAction=t,this.now=r}schedule(t,r=0,i){return new this.SchedulerAction(this,t).schedule(i,r)}}return n.now=()=>Date.now(),n})();class ku extends ck{constructor(e,t=ck.now){super(e,()=>ku.delegate&&ku.delegate!==this?ku.delegate.now():t()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(e,t=0,r){return ku.delegate&&ku.delegate!==this?ku.delegate.schedule(e,t,r):super.schedule(e,t,r)}flush(e){const{actions:t}=this;if(this.active)return void t.push(e);let r;this.active=!0;do{if(r=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,r){for(;e=t.shift();)e.unsubscribe();throw r}}}const YJ=new class extends ku{}(class extends uk{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}schedule(e,t=0){return t>0?super.schedule(e,t):(this.delay=t,this.state=e,this.scheduler.flush(this),this)}execute(e,t){return t>0||this.closed?super.execute(e,t):this._execute(e,t)}requestAsyncId(e,t,r=0){return null!==r&&r>0||null===r&&this.delay>0?super.requestAsyncId(e,t,r):e.flush(this)}});class bs{constructor(e,t,r){this.kind=e,this.value=t,this.error=r,this.hasValue="N"===e}observe(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}}do(e,t,r){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return r&&r()}}accept(e,t,r){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,r)}toObservable(){switch(this.kind){case"N":return Ht(this.value);case"E":return function(n,e){return new ee(t=>t.error(n))}(this.error);case"C":return q0()}throw new Error("unexpected notification kind value")}static createNext(e){return void 0!==e?new bs("N",e):bs.undefinedValueNotification}static createError(e){return new bs("E",void 0,e)}static createComplete(){return bs.completeNotification}}bs.completeNotification=new bs("C"),bs.undefinedValueNotification=new bs("N",void 0);class pm extends Pn{constructor(e,t,r=0){super(e),this.scheduler=t,this.delay=r}static dispatch(e){const{notification:t,destination:r}=e;t.observe(r),this.unsubscribe()}scheduleMessage(e){this.destination.add(this.scheduler.schedule(pm.dispatch,this.delay,new KJ(e,this.destination)))}_next(e){this.scheduleMessage(bs.createNext(e))}_error(e){this.scheduleMessage(bs.createError(e)),this.unsubscribe()}_complete(){this.scheduleMessage(bs.createComplete()),this.unsubscribe()}}class KJ{constructor(e,t){this.notification=e,this.destination=t}}class QJ extends ie{constructor(e=Number.POSITIVE_INFINITY,t=Number.POSITIVE_INFINITY,r){super(),this.scheduler=r,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=e<1?1:e,this._windowTime=t<1?1:t,t===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(e){if(!this.isStopped){const t=this._events;t.push(e),t.length>this._bufferSize&&t.shift()}super.next(e)}nextTimeWindow(e){this.isStopped||(this._events.push(new ZJ(this._getNow(),e)),this._trimBufferThenGetEvents()),super.next(e)}_subscribe(e){const t=this._infiniteTimeWindow,r=t?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,o=r.length;let s;if(this.closed)throw new _e;if(this.isStopped||this.hasError?s=At.EMPTY:(this.observers.push(e),s=new Oe(this,e)),i&&e.add(e=new pm(e,i)),t)for(let a=0;a<o&&!e.closed;a++)e.next(r[a]);else for(let a=0;a<o&&!e.closed;a++)e.next(r[a].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),s}_getNow(){return(this.scheduler||YJ).now()}_trimBufferThenGetEvents(){const e=this._getNow(),t=this._bufferSize,r=this._windowTime,i=this._events,o=i.length;let s=0;for(;s<o&&!(e-i[s].time<r);)s++;return o>t&&(s=Math.max(s,o-t)),s>0&&i.splice(0,s),i}}class ZJ{constructor(e,t){this.time=e,this.value=t}}const gm={schedule(n,e){const t=setTimeout(n,e);return()=>clearTimeout(t)},scheduleBeforeRender(n){if("undefined"==typeof window)return gm.schedule(n,0);if(void 0===window.requestAnimationFrame)return gm.schedule(n,16);const e=window.requestAnimationFrame(n);return()=>window.cancelAnimationFrame(e)}};let X2;function uee(n,e,t){let r=t;return function(n){return!!n&&n.nodeType===Node.ELEMENT_NODE}(n)&&e.some((i,o)=>!("*"===i||!function(n,e){if(!X2){const t=Element.prototype;X2=t.matches||t.matchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector||t.webkitMatchesSelector}return n.nodeType===Node.ELEMENT_NODE&&X2.call(n,e)}(n,i)||(r=o,0))),r}class lee{constructor(e,t){this.componentFactory=t.get(du).resolveComponentFactory(e)}create(e){return new hee(this.componentFactory,e)}}class hee{constructor(e,t){this.componentFactory=e,this.injector=t,this.eventEmitters=new QJ(1),this.events=this.eventEmitters.pipe(yu(r=>Ts(...r))),this.componentRef=null,this.viewChangeDetectorRef=null,this.inputChanges=null,this.hasInputChanges=!1,this.implementsOnChanges=!1,this.scheduledChangeDetectionFn=null,this.scheduledDestroyFn=null,this.initialInputValues=new Map,this.unchangedInputs=new Set(this.componentFactory.inputs.map(({propName:r})=>r)),this.ngZone=this.injector.get(Zr),this.elementZone="undefined"==typeof Zone?null:this.ngZone.run(()=>Zone.current)}connect(e){this.runInZone(()=>{if(null!==this.scheduledDestroyFn)return this.scheduledDestroyFn(),void(this.scheduledDestroyFn=null);null===this.componentRef&&this.initializeComponent(e)})}disconnect(){this.runInZone(()=>{null===this.componentRef||null!==this.scheduledDestroyFn||(this.scheduledDestroyFn=gm.schedule(()=>{null!==this.componentRef&&(this.componentRef.destroy(),this.componentRef=null,this.viewChangeDetectorRef=null)},10))})}getInputValue(e){return this.runInZone(()=>null===this.componentRef?this.initialInputValues.get(e):this.componentRef.instance[e])}setInputValue(e,t){this.runInZone(()=>{null!==this.componentRef?function(n,e){return n===e||n!=n&&e!=e}(t,this.getInputValue(e))&&(void 0!==t||!this.unchangedInputs.has(e))||(this.recordInputChange(e,t),this.unchangedInputs.delete(e),this.hasInputChanges=!0,this.componentRef.instance[e]=t,this.scheduleDetectChanges()):this.initialInputValues.set(e,t)})}initializeComponent(e){const t=Yn.create({providers:[],parent:this.injector}),r=function(n,e){const t=n.childNodes,r=e.map(()=>[]);let i=-1;e.some((o,s)=>"*"===o&&(i=s,!0));for(let o=0,s=t.length;o<s;++o){const a=t[o],u=uee(a,e,i);-1!==u&&r[u].push(a)}return r}(e,this.componentFactory.ngContentSelectors);this.componentRef=this.componentFactory.create(t,r,e),this.viewChangeDetectorRef=this.componentRef.injector.get(Ef),this.implementsOnChanges=function(n){return"function"==typeof n}(this.componentRef.instance.ngOnChanges),this.initializeInputs(),this.initializeOutputs(this.componentRef),this.detectChanges(),this.injector.get(sl).attachView(this.componentRef.hostView)}initializeInputs(){this.componentFactory.inputs.forEach(({propName:e})=>{this.initialInputValues.has(e)&&this.setInputValue(e,this.initialInputValues.get(e))}),this.initialInputValues.clear()}initializeOutputs(e){const t=this.componentFactory.outputs.map(({propName:r,templateName:i})=>e.instance[r].pipe(kt(s=>({name:i,value:s}))));this.eventEmitters.next(t)}callNgOnChanges(e){if(!this.implementsOnChanges||null===this.inputChanges)return;const t=this.inputChanges;this.inputChanges=null,e.instance.ngOnChanges(t)}markViewForCheck(e){this.hasInputChanges&&(this.hasInputChanges=!1,e.markForCheck())}scheduleDetectChanges(){this.scheduledChangeDetectionFn||(this.scheduledChangeDetectionFn=gm.scheduleBeforeRender(()=>{this.scheduledChangeDetectionFn=null,this.detectChanges()}))}recordInputChange(e,t){if(!this.implementsOnChanges)return;null===this.inputChanges&&(this.inputChanges={});const r=this.inputChanges[e];if(r)return void(r.currentValue=t);const i=this.unchangedInputs.has(e),o=i?void 0:this.getInputValue(e);this.inputChanges[e]=new b(o,t,i)}detectChanges(){null!==this.componentRef&&(this.callNgOnChanges(this.componentRef),this.markViewForCheck(this.viewChangeDetectorRef),this.componentRef.changeDetectorRef.detectChanges())}runInZone(e){return this.elementZone&&Zone.current!==this.elementZone?this.ngZone.run(e):e()}}class dee extends HTMLElement{constructor(){super(...arguments),this.ngElementEventsSubscription=null}}const lk=new ku(uk);function mee(n){const{subscriber:e,counter:t,period:r}=n;e.next(t),this.schedule({subscriber:e,counter:t+1,period:r},r)}class yee{constructor(e){this.notifier=e}call(e,t){const r=new xee(e),i=Uo(this.notifier,new Qt(r));return i&&!r.seenValue?(r.add(i),t.subscribe(r)):r}}class xee extends Xe{constructor(e){super(e),this.seenValue=!1}notifyNext(){this.seenValue=!0,this.complete()}notifyComplete(){}}const hk={pitch:20,yaw:20,roll:10};function mm(n){const{leftEyeInner:e,rightEyeInner:r,leftEar:o,rightEar:s}=function(n){const[e,t,r,i,o,s,a,u,c,d,p,...m]=n;return{nose:e,leftEyeInner:t,leftEyeCenter:r,leftEyeOuter:i,rightEyeInner:o,rightEyeCenter:s,rightEyeOuter:a,leftEar:u,rightEar:c,mouthLeft:d,mouthRight:p}}(n.poseLandmarks);return function(n,e,t){const[r,i,o]=[e.x-n.x,e.y-n.y,e.z-n.z],s=r*r,a=o*o,u=i*i,d=(Math.sqrt(s+u+a),Math.atan2(o,Math.sqrt(s+u))),p=Math.atan2(i,Math.sqrt(s+a)),m={z:t.z-n.z,x:t.x-n.x,y:t.y-n.y},y=Object.assign(Object.assign({},m),{x:Math.sin(-d)*m.z+Math.cos(-d)*m.x,z:Math.cos(-d)*m.z-Math.sin(-d)*m.x}),w=Object.assign(Object.assign({},y),{x:Math.cos(-p)*y.x-Math.sin(-p)*y.y,y:Math.sin(-p)*y.x+Math.cos(-p)*y.y}),_=180*Math.atan2(w.y,w.z)/Math.PI%180;return{yaw:180*d/Math.PI,roll:180*p/Math.PI,pitch:(180-Math.abs(_))*(_>0?-1:1)}}(o,s,{x:(e.x+r.x)/2,y:(e.y+r.y)/2,z:(e.z+r.z)/2})}const wee=["videoRef"],_ee=["overlayRef"];function Cee(n,e){1&n&&(rt(0,"span"),xn(1,"Webcam Input: "),it())}function Eee(n,e){if(1&n){const t=Ri();rt(0,"app-webcam-list",9),Qn("selectCamera",function(i){return Qr(t),gn().cameraId=i}),it()}2&n&&_t("cameraId",gn().cameraId)}function Iee(n,e){if(1&n){const t=Ri();rt(0,"button",10),Qn("click",function(){return Qr(t),gn().startStream()}),xn(1,"Start"),it()}2&n&&_t("disabled",!gn().cameraId)}function Aee(n,e){if(1&n){const t=Ri();rt(0,"button",11),Qn("click",function(){return Qr(t),gn().stopStream()}),xn(1,"Stop"),it()}}function Dee(n,e){if(1&n){const t=Ri();rt(0,"button",11),Qn("click",function(){return Qr(t),gn().onCapture()}),xn(1,"Capture"),it()}}function See(n,e){if(1&n&&(rt(0,"option",3),xn(1),it()),2&n){const t=gn().$implicit,r=gn();_t("value",t.deviceId)("selected",t.deviceId===r.cameraId),wt(1),mf(t.label)}}function Tee(n,e){if(1&n&&(lc(0),Mn(1,See,2,3,"option",2),hc()),2&n){const t=e.$implicit;wt(1),_t("ngIf",t.deviceId)}}const vm={width:{ideal:1280,min:640},height:{ideal:780,min:480}};let jp=(()=>{class n{constructor(t){this.host=t,this.fps=20,this.shouldPlay=!1,this.capture=new ii,this.error=new ii,this.width=vm.width,this.height=vm.height}ngOnInit(){this.shouldPlay&&this.startStream()}ngOnChanges(t){t.shouldPlay.previousValue!==this.shouldPlay&&this.shouldPlay&&this.startStream()}ngAfterViewInit(){return qn(function*(){})()}ngOnDestroy(){this.shouldPlay=!1,this.stopStream()}startStream(){var t=this;return qn(function*(){yield t.startStreamInstance(),t.updateStartStreamAttribute()})()}stopStream(){var t=this;return qn(function*(){var r;t.hideElements(),yield t.stopStreamInstance(),null===(r=t.videoRef)||void 0===r||r.nativeElement.pause()})()}onCapture(){var t=this;return qn(function*(){if(!t.videoRef)return;const r=t.getImgFromCanvas();t.capture.emit(r)})()}stopStreamInstance(){var t=this;return qn(function*(){var r;null===(r=t.stream)||void 0===r||r.getTracks().forEach(i=>i.stop())})()}startStreamInstance(){var t=this;return qn(function*(){const r=Object.assign({},vm);t.cameraId&&(r.deviceId=t.cameraId),t.stream=yield navigator.mediaDevices.getUserMedia({video:r});const{width:i,height:o}=t.stream.getVideoTracks()[0].getSettings();i&&(t.width=i),o&&(t.height=o)})()}updateStartStreamAttribute(){this.host.nativeElement.classList.add("popup"),this.shouldPlay=!0}getImgFromCanvas(t=0,r=0,i,o){var s,a;if(!this.videoRef)return;const u=document.createElement("canvas"),c=null===(s=this.videoRef)||void 0===s?void 0:s.nativeElement;u.width=null!=i?i:c.videoWidth,u.height=null!=o?o:c.videoHeight,null===(a=u.getContext("2d"))||void 0===a||a.drawImage(c,t,r,u.width,u.height,0,0,u.width,u.height);const d=document.createElement("img");return d.src=u.toDataURL(),d.width=u.width,d.height=u.height,d}onPlay(t){this.shouldPlay&&setTimeout(()=>this.onPlay(t),1e3/this.fps)}selectCamera(t){var r;this.cameraId=null===(r=t.target)||void 0===r?void 0:r.value}hideElements(){this.host.nativeElement.classList.remove("popup"),this.shouldPlay=!1}}return n.\u0275fac=function(t){return new(t||n)(ut(bi))},n.\u0275cmp=xe({type:n,selectors:[["app-webcam-input"]],viewQuery:function(t,r){if(1&t&&(Ff(wee,5,bi),Ff(_ee,5,bi)),2&t){let i;rl(i=il())&&(r.videoRef=i.first),rl(i=il())&&(r.overlayRef=i.first)}},inputs:{fps:"fps",shouldPlay:"shouldPlay"},outputs:{capture:"capture",error:"error"},features:[E],decls:10,vars:12,consts:[["id","videoRef","autoplay","","muted","",3,"srcObject","width","height","play"],["videoRef",""],["id","overlayRef"],["overlayRef",""],[1,"buttons"],[4,"ngIf"],[3,"cameraId","selectCamera",4,"ngIf"],["type","button",3,"disabled","click",4,"ngIf"],["type","button",3,"click",4,"ngIf"],[3,"cameraId","selectCamera"],["type","button",3,"disabled","click"],["type","button",3,"click"]],template:function(t,r){if(1&t){const i=Ri();rt(0,"video",0,1),Qn("play",function(){Qr(i);const s=hu(1);return r.onPlay(s)}),it(),yr(2,"canvas",2,3),rt(4,"div",4),Mn(5,Cee,2,0,"span",5),Mn(6,Eee,1,1,"app-webcam-list",6),Mn(7,Iee,2,1,"button",7),Mn(8,Aee,2,0,"button",8),Mn(9,Dee,2,0,"button",8),it()}2&t&&(Pa("hidden",!r.shouldPlay),_t("srcObject",r.stream)("width",r.width)("height",r.height),wt(4),Pa("absolute",r.shouldPlay),wt(1),_t("ngIf",!r.shouldPlay),wt(1),_t("ngIf",!r.shouldPlay),wt(1),_t("ngIf",!r.shouldPlay),wt(1),_t("ngIf",r.shouldPlay),wt(1),_t("ngIf",r.shouldPlay))},directives:function(){return[vu,Wp]},styles:["[_nghost-%COMP%]{position:relative;text-align:center}[_nghost-%COMP%]   .overlay[_ngcontent-%COMP%]{display:none}.popup[_nghost-%COMP%]{position:fixed;z-index:999;top:50%;left:50%;transform:translate(-50%) translateY(-50%);box-shadow:1px 1px 14px #000000bf;max-height:90vh;width:auto;min-height:10vh;min-width:30vw;background-color:#fff}.popup[_nghost-%COMP%]   .overlay[_ngcontent-%COMP%]{display:block;height:100%;width:100%;pointer-events:none}.popup[_nghost-%COMP%]   .overlay[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]{position:absolute;pointer-events:inherit;left:50%;top:30%;transform:translate(-50%) translateY(-30%);display:block;border:3px solid greenyellow;width:30%;padding-top:40%;border-radius:30% 30% 50% 50%;box-shadow:1px -1px 30vw 25vw #0006}.popup[_nghost-%COMP%]   .overlay[_ngcontent-%COMP%]   .v-line[_ngcontent-%COMP%]{position:absolute;pointer-events:inherit;top:0px;left:50%;height:100%;transform:translate(calc(-50% + 1px));display:block;border-left:1px dotted gold;width:0%}.popup[_nghost-%COMP%]   .overlay[_ngcontent-%COMP%]   .h-line[_ngcontent-%COMP%]{position:absolute;pointer-events:inherit;left:0px;top:32%;width:100%;transform:translateY(-50%);display:block;border-top:1px dotted gold}.popup[_nghost-%COMP%]   .overlay[_ngcontent-%COMP%]   .h-line-2[_ngcontent-%COMP%]{top:42%}.popup[_nghost-%COMP%]   .overlay[_ngcontent-%COMP%]   .h-line-3[_ngcontent-%COMP%]{top:52%}video[_ngcontent-%COMP%]{transform:rotateY(180deg);min-height:inherit;min-width:inherit;max-height:90vh;max-width:90vw;height:auto;width:auto;position:relative}canvas[_ngcontent-%COMP%]{display:none}.buttons[_ngcontent-%COMP%]{display:flex;align-items:center}.buttons[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{white-space:nowrap}.buttons.absolute[_ngcontent-%COMP%]{position:absolute;bottom:0;left:50%;transform:translate(-50%)}.hidden[_ngcontent-%COMP%]{display:none}"]}),n})(),Wp=(()=>{class n{constructor(){this.cameraList$=this.getCameraList(),this.selectCamera=new ii}ngOnInit(){var t=this;return qn(function*(){var r,i;t.cameraId=null!==(r=t.cameraId)&&void 0!==r?r:null===(i=(yield t.cameraList$)[0])||void 0===i?void 0:i.deviceId,t.cameraId&&t.selectCamera.emit(t.cameraId)})()}getCameraList(){return qn(function*(){return(yield navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(r=>r.stop()),(yield navigator.mediaDevices.enumerateDevices()).filter(r=>r.label&&r.deviceId)})()}onSelectCamera(t){var r;this.selectCamera.emit(null===(r=t.target)||void 0===r?void 0:r.value)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=xe({type:n,selectors:[["app-webcam-list"]],inputs:{cameraId:"cameraId"},outputs:{selectCamera:"selectCamera"},decls:3,vars:3,consts:[[3,"change"],[4,"ngFor","ngForOf"],[3,"value","selected",4,"ngIf"],[3,"value","selected"]],template:function(t,r){1&t&&(rt(0,"select",0),Qn("change",function(o){return r.onSelectCamera(o)}),Mn(1,Tee,2,1,"ng-container",1),Wh(2,"async"),it()),2&t&&(wt(1),_t("ngForOf",ZD(2,1,r.cameraList$)))},directives:[Yf,vu],pipes:[IT],encapsulation:2}),n})();function Mee(n,e){1&n&&(rt(0,"span"),xn(1,"Webcam Face Input with validation: "),it())}function Ree(n,e){if(1&n){const t=Ri();rt(0,"app-webcam-list",15),Qn("selectCamera",function(i){return Qr(t),gn().cameraId=i}),it()}2&n&&_t("cameraId",gn().cameraId)}function Nee(n,e){if(1&n){const t=Ri();rt(0,"button",16),Qn("click",function(){return Qr(t),gn().startStream()}),xn(1,"Start"),it()}}function Oee(n,e){if(1&n){const t=Ri();rt(0,"button",16),Qn("click",function(){return Qr(t),gn().stopStream()}),xn(1,"Stop"),it()}}function kee(n,e){if(1&n){const t=Ri();rt(0,"button",17),Qn("click",function(){return Qr(t),gn().onCapture()}),xn(1,"Capture"),it()}2&n&&_t("disabled",!gn().isCaptureEnabled)}function Pee(n,e){1&n&&(rt(0,"span"),xn(1,"Mohon wajah untuk lurus menghadap ke kamera"),it())}function Fee(n,e){1&n&&(rt(0,"span"),xn(1,"Mohon tunggu, sedang meload library"),it())}let Hp=(()=>{class n extends jp{constructor(t,r,i,o){super(t),this.host=t,this.cdr=r,this.faceService=i,this.poseService=o,this.isCaptureEnabled=!1,this.fps=3,this.isLibraryInitialized=!1,this.captureFaceRotation=new ii,this.captureFaceDescriptor=new ii,this.captureFaceImage=new ii}startStream(){var t=()=>super.startStream,r=this;return qn(function*(){yield t().call(r),yield r.initPoseInstance()})()}initPoseInstance(){var t=this;return qn(function*(){t.pose=yield t.poseService.getPoseInstance(t.onPoseResult.bind(t)),t.isLibraryInitialized=!0,t.cdr.detectChanges()})()}onPlay(t){var r=()=>super.onPlay,i=this;return qn(function*(){var o;r().call(i,t),i.shouldPlay&&(yield t)&&(null==i?void 0:i.stream)&&(null===(o=i.pose)||void 0===o||o.send({image:i.videoRef.nativeElement}))})()}onCapture(){var t=()=>super.onCapture,r=this;return qn(function*(){var i,o;null===(i=r.videoRef)||void 0===i||i.nativeElement.pause(),t().call(r);const s=r.getImgFromCanvas();if(s){const a=yield r.faceService.getSingleFace(s);if(null==a?void 0:a.detection){const{left:u,top:c,width:d,height:p}=a.detection.box,m=.3,y=1+2*m,w=r.getImgFromCanvas(Math.max(u-d*m,0),Math.max(c-p*m,0),d*y,p*y);r.captureFaceImage.emit(w),r.captureFaceDescriptor.emit(null==a?void 0:a.descriptor)}}null===(o=r.videoRef)||void 0===o||o.nativeElement.play()})()}onPoseResult(t){if(this.isLibraryInitialized=!0,!(null==t?void 0:t.poseLandmarks))return void(this.isCaptureEnabled=!1);const r=mm(t),i=function(n,e=hk){return Math.abs(n.roll)<e.roll&&Math.abs(n.yaw)<e.yaw&&Math.abs(n.pitch)<e.pitch}(r);this.axesRotation=r,this.captureFaceRotation.emit(r),this.isCaptureEnabled!==i&&(this.isCaptureEnabled=i,this.cdr.detectChanges())}}return n.\u0275fac=function(t){return new(t||n)(ut(bi),ut(Ef),ut(Y2),ut(_Y))},n.\u0275cmp=xe({type:n,selectors:[["app-webcam-face-input"]],outputs:{captureFaceRotation:"captureFaceRotation",captureFaceDescriptor:"captureFaceDescriptor",captureFaceImage:"captureFaceImage"},features:[df],decls:18,vars:12,consts:[["crossorigin","anonymous","playsinline","true","id","videoRef","autoplay","","muted","",3,"srcObject","play"],["videoRef",""],["id","overlayRef"],["overlayRef",""],[1,"overlay"],[1,"box"],[1,"v-line"],[1,"h-line"],[1,"h-line","h-line-2"],[1,"h-line","h-line-3"],[1,"buttons"],[4,"ngIf"],[3,"cameraId","selectCamera",4,"ngIf"],["type","button",3,"click",4,"ngIf"],["type","button",3,"disabled","click",4,"ngIf"],[3,"cameraId","selectCamera"],["type","button",3,"click"],["type","button",3,"disabled","click"]],template:function(t,r){if(1&t){const i=Ri();rt(0,"video",0,1),Qn("play",function(){Qr(i);const s=hu(1);return r.onPlay(s)}),it(),yr(2,"canvas",2,3),rt(4,"div",4),rt(5,"div",5),yr(6,"div",6),yr(7,"div",7),yr(8,"div",8),yr(9,"div",9),it(),it(),rt(10,"div",10),Mn(11,Mee,2,0,"span",11),Mn(12,Ree,1,1,"app-webcam-list",12),Mn(13,Nee,2,0,"button",13),Mn(14,Oee,2,0,"button",13),Mn(15,kee,2,1,"button",14),Mn(16,Pee,2,0,"span",11),Mn(17,Fee,2,0,"span",11),it()}2&t&&(Pa("hidden",!r.shouldPlay),_t("srcObject",r.stream),wt(10),Pa("absolute",r.shouldPlay),wt(1),_t("ngIf",!r.shouldPlay),wt(1),_t("ngIf",!r.shouldPlay),wt(1),_t("ngIf",!r.shouldPlay),wt(1),_t("ngIf",r.shouldPlay),wt(1),_t("ngIf",r.shouldPlay),wt(1),_t("ngIf",r.shouldPlay&&!r.isCaptureEnabled&&r.isLibraryInitialized),wt(1),_t("ngIf",!r.isLibraryInitialized&&r.shouldPlay))},directives:[vu,Wp],styles:["[_nghost-%COMP%]{position:relative;text-align:center}[_nghost-%COMP%]   .overlay[_ngcontent-%COMP%]{display:none}.popup[_nghost-%COMP%]{position:fixed;z-index:999;top:50%;left:50%;transform:translate(-50%) translateY(-50%);box-shadow:1px 1px 14px #000000bf;max-height:90vh;width:auto;min-height:10vh;min-width:30vw;background-color:#fff}.popup[_nghost-%COMP%]   .overlay[_ngcontent-%COMP%]{display:block;height:100%;width:100%;pointer-events:none}.popup[_nghost-%COMP%]   .overlay[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]{position:absolute;pointer-events:inherit;left:50%;top:30%;transform:translate(-50%) translateY(-30%);display:block;border:3px solid greenyellow;width:30%;padding-top:40%;border-radius:30% 30% 50% 50%;box-shadow:1px -1px 30vw 25vw #0006}.popup[_nghost-%COMP%]   .overlay[_ngcontent-%COMP%]   .v-line[_ngcontent-%COMP%]{position:absolute;pointer-events:inherit;top:0px;left:50%;height:100%;transform:translate(calc(-50% + 1px));display:block;border-left:1px dotted gold;width:0%}.popup[_nghost-%COMP%]   .overlay[_ngcontent-%COMP%]   .h-line[_ngcontent-%COMP%]{position:absolute;pointer-events:inherit;left:0px;top:32%;width:100%;transform:translateY(-50%);display:block;border-top:1px dotted gold}.popup[_nghost-%COMP%]   .overlay[_ngcontent-%COMP%]   .h-line-2[_ngcontent-%COMP%]{top:42%}.popup[_nghost-%COMP%]   .overlay[_ngcontent-%COMP%]   .h-line-3[_ngcontent-%COMP%]{top:52%}video[_ngcontent-%COMP%]{transform:rotateY(180deg);min-height:inherit;min-width:inherit;max-height:90vh;max-width:90vw;height:auto;width:auto;position:relative}canvas[_ngcontent-%COMP%]{display:none}.buttons[_ngcontent-%COMP%]{display:flex;align-items:center}.buttons[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{white-space:nowrap}.buttons.absolute[_ngcontent-%COMP%]{position:absolute;bottom:0;left:50%;transform:translate(-50%)}.hidden[_ngcontent-%COMP%]{display:none}.buttons[_ngcontent-%COMP%]{background-color:#fff}"],changeDetection:0}),n})();function Lee(n,e){if(1&n){const t=Ri();rt(0,"app-webcam-list",5),Qn("selectCamera",function(i){return Qr(t),gn().cameraId=i}),it()}}let q2=(()=>{class n extends Hp{constructor(){super(...arguments),this.isYawingToSide=!1,this.minimumYawDuration=5e3,this.isPopUpShown=!1,this._onYawStop$=new ie}ngOnInit(){this.startStream()}onPoseResult(t){if(!(null==t?void 0:t.poseLandmarks))return void(this.isCaptureEnabled=!1);const r=mm(t);this.axesRotation=r;const i=function(n,e=30){return Math.abs(n.yaw)>e}(r);i?(!this._yawTimerInstance$||this._yawTimerInstance$.closed)&&(this.createTimerInstance(),console.log("start counting",new Date)):(this._onYawStop$.next(),this._yawTimerInstance$&&this._yawTimerInstance$.unsubscribe(),this.isPopUpShown=!1),this.isYawingToSide!==i&&(this.isYawingToSide=i,this.cdr.detectChanges())}createTimerInstance(){this._yawTimerInstance$=function(n=0,e=lk){return(!function(n){return!br(n)&&n-parseFloat(n)+1>=0}(n)||n<0)&&(n=0),(!e||"function"!=typeof e.schedule)&&(e=lk),new ee(t=>(t.add(e.schedule(mee,n,{subscriber:t,counter:0,period:n})),t))}(this.minimumYawDuration).pipe(function(n){return e=>e.lift(new yee(n))}(this._onYawStop$)).subscribe(()=>{this.followUpYaw()})}followUpYaw(){this.capture.emit(this.getImgFromCanvas()),this.isPopUpShown=!0}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=yv(n)))(r||n)}}(),n.\u0275cmp=xe({type:n,selectors:[["app-peek-to-side-detector"]],inputs:{minimumYawDuration:"minimumYawDuration"},features:[df],decls:7,vars:6,consts:[[3,"selectCamera",4,"ngIf"],["crossorigin","anonymous","playsinline","true","id","videoRef","autoplay","","muted","",3,"srcObject","play"],["videoRef",""],[1,"pin"],[1,"popup"],[3,"selectCamera"]],template:function(t,r){if(1&t){const i=Ri();Mn(0,Lee,1,0,"app-webcam-list",0),rt(1,"video",1,2),Qn("play",function(){Qr(i);const s=hu(2);return r.onPlay(s)}),it(),rt(3,"div",3),xn(4," Photo pengawas\n"),it(),rt(5,"div",4),xn(6," Ada yang bisa kami bantu\n"),it()}2&t&&(_t("ngIf",!r.shouldPlay),wt(1),Pa("hidden",!r.shouldPlay),_t("srcObject",r.stream),wt(4),Pa("show",r.isPopUpShown))},directives:[vu,Wp],styles:[".pin[_ngcontent-%COMP%]{position:fixed;right:30px;bottom:30px;display:flex;align-items:center;justify-content:center;background-color:#ececec;border-radius:50%;white-space:normal;width:150px;height:150px}.popup[_ngcontent-%COMP%]{display:none;position:fixed;right:30px;bottom:60px;min-width:100px;background-color:red;color:#fff;font-size:3em;padding:10px}.popup.show[_ngcontent-%COMP%]{display:block}video[_ngcontent-%COMP%]{display:none}app-webcam-list[_ngcontent-%COMP%]{display:none}"]}),n})();var $e=(()=>(function(n){n[n.QR_CODE=0]="QR_CODE",n[n.AZTEC=1]="AZTEC",n[n.CODABAR=2]="CODABAR",n[n.CODE_39=3]="CODE_39",n[n.CODE_93=4]="CODE_93",n[n.CODE_128=5]="CODE_128",n[n.DATA_MATRIX=6]="DATA_MATRIX",n[n.MAXICODE=7]="MAXICODE",n[n.ITF=8]="ITF",n[n.EAN_13=9]="EAN_13",n[n.EAN_8=10]="EAN_8",n[n.PDF_417=11]="PDF_417",n[n.RSS_14=12]="RSS_14",n[n.RSS_EXPANDED=13]="RSS_EXPANDED",n[n.UPC_A=14]="UPC_A",n[n.UPC_E=15]="UPC_E",n[n.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"}($e||($e={})),$e))(),vk=new Map([[$e.QR_CODE,"QR_CODE"],[$e.AZTEC,"AZTEC"],[$e.CODABAR,"CODABAR"],[$e.CODE_39,"CODE_39"],[$e.CODE_93,"CODE_93"],[$e.CODE_128,"CODE_128"],[$e.DATA_MATRIX,"DATA_MATRIX"],[$e.MAXICODE,"MAXICODE"],[$e.ITF,"ITF"],[$e.EAN_13,"EAN_13"],[$e.EAN_8,"EAN_8"],[$e.PDF_417,"PDF_417"],[$e.RSS_14,"RSS_14"],[$e.RSS_EXPANDED,"RSS_EXPANDED"],[$e.UPC_A,"UPC_A"],[$e.UPC_E,"UPC_E"],[$e.UPC_EAN_EXTENSION,"UPC_EAN_EXTENSION"]]);function Bee(n){return Object.values($e).includes(n)}var ws=(()=>(function(n){n[n.SCAN_TYPE_CAMERA=0]="SCAN_TYPE_CAMERA",n[n.SCAN_TYPE_FILE=1]="SCAN_TYPE_FILE"}(ws||(ws={})),ws))(),Cd=function(){function n(){}return n.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",n.SCAN_DEFAULT_FPS=2,n.DEFAULT_DISABLE_FLIP=!1,n.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,n}(),yk=function(){function n(e,t){this.format=e,this.formatName=t}return n.prototype.toString=function(){return this.formatName},n.create=function(e){if(!vk.has(e))throw e+" not in html5QrcodeSupportedFormatsTextMap";return new n(e,vk.get(e))},n}(),xk=function(){function n(){}return n.createFromText=function(e){return{decodedText:e,result:{text:e}}},n.createFromQrcodeResult=function(e){return{decodedText:e.text,result:e}},n}(),ym=(()=>(function(n){n[n.UNKWOWN_ERROR=0]="UNKWOWN_ERROR",n[n.IMPLEMENTATION_ERROR=1]="IMPLEMENTATION_ERROR",n[n.NO_CODE_FOUND_ERROR=2]="NO_CODE_FOUND_ERROR"}(ym||(ym={})),ym))(),bk=function(){function n(){}return n.createFrom=function(e){return{errorMessage:e,type:ym.UNKWOWN_ERROR}},n}(),wk=function(){function n(e){this.verbose=e}return n.prototype.log=function(e){this.verbose&&console.log(e)},n.prototype.warn=function(e){this.verbose&&console.warn(e)},n.prototype.logError=function(e,t){(this.verbose||!0===t)&&console.error(e)},n.prototype.logErrors=function(e){if(0===e.length)throw"Logger#logError called without arguments";this.verbose&&console.error(e)},n}();function Ed(n){return null==n}var zp=function(){function n(){}return n.codeParseError=function(e){return"QR code parse error, error = "+e},n.errorGettingUserMedia=function(e){return"Error getting userMedia, error = "+e},n.onlyDeviceSupportedError=function(){return"The device doesn't support navigator.mediaDevices , only supported cameraIdOrConfig in this case is deviceId parameter (string)."},n.cameraStreamingNotSupported=function(){return"Camera streaming not supported by the browser."},n.unableToQuerySupportedDevices=function(){return"Unable to query supported devices, unknown error."},n.insecureContextCameraQueryError=function(){return"Camera access is only supported in secure context like https or localhost."},n}(),fa=function(){function n(){}return n.scanningStatus=function(){return"Scanning"},n.idleStatus=function(){return"Idle"},n.errorStatus=function(){return"Error"},n.permissionStatus=function(){return"Permission"},n.noCameraFoundErrorStatus=function(){return"No Cameras"},n.lastMatch=function(e){return"Last Match: "+e},n.codeScannerTitle=function(){return"Code Scanner"},n.cameraPermissionTitle=function(){return"Request Camera Permissions"},n.cameraPermissionRequesting=function(){return"Requesting camera permissions..."},n.noCameraFound=function(){return"No camera found"},n.scanButtonStopScanningText=function(){return"Stop Scanning"},n.scanButtonStartScanningText=function(){return"Start Scanning"},n.scanButtonScanningStarting=function(){return"Launching Camera..."},n.textIfCameraScanSelected=function(){return"Scan an Image File"},n.textIfFileScanSelected=function(){return"Scan using camera directly"},n.selectCamera=function(){return"Select Camera"},n}(),_k=function(){function n(){}return n.builtUsing=function(){return"Built using "},n.reportIssues=function(){return"Report issues"},n}(),Ck=function(){function n(){}return n.isMediaStreamConstraintsValid=function(e,t){if("object"!=typeof e)return t.logError("videoConstraints should be of type object, the object passed is of type "+typeof e+".",!0),!1;for(var o=new Set(["autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","volume"]),a=0,u=Object.keys(e);a<u.length;a++){var c=u[a];if(o.has(c))return t.logError(c+" is not supported videoConstaints.",!0),!1}return!0},n}(),Or=me(65),Vee=function(){function n(e,t,r){if(this.formatMap=new Map([[$e.QR_CODE,Or.BarcodeFormat.QR_CODE],[$e.AZTEC,Or.BarcodeFormat.AZTEC],[$e.CODABAR,Or.BarcodeFormat.CODABAR],[$e.CODE_39,Or.BarcodeFormat.CODE_39],[$e.CODE_93,Or.BarcodeFormat.CODE_93],[$e.CODE_128,Or.BarcodeFormat.CODE_128],[$e.DATA_MATRIX,Or.BarcodeFormat.DATA_MATRIX],[$e.MAXICODE,Or.BarcodeFormat.MAXICODE],[$e.ITF,Or.BarcodeFormat.ITF],[$e.EAN_13,Or.BarcodeFormat.EAN_13],[$e.EAN_8,Or.BarcodeFormat.EAN_8],[$e.PDF_417,Or.BarcodeFormat.PDF_417],[$e.RSS_14,Or.BarcodeFormat.RSS_14],[$e.RSS_EXPANDED,Or.BarcodeFormat.RSS_EXPANDED],[$e.UPC_A,Or.BarcodeFormat.UPC_A],[$e.UPC_E,Or.BarcodeFormat.UPC_E],[$e.UPC_EAN_EXTENSION,Or.BarcodeFormat.UPC_EAN_EXTENSION]]),this.reverseFormatMap=this.createReverseFormatMap(),!Or)throw"Use html5qrcode.min.js without edit, ZXing not found.";this.verbose=t,this.logger=r;var i=this.createZXingFormats(e),o=new Map;o.set(Or.DecodeHintType.POSSIBLE_FORMATS,i),this.hints=o}return n.prototype.decodeAsync=function(e){var t=this;return new Promise(function(r,i){try{r(t.decode(e))}catch(o){i(o)}})},n.prototype.decode=function(e){var t=new Or.MultiFormatReader(this.verbose,this.hints),r=new Or.HTMLCanvasElementLuminanceSource(e),i=new Or.BinaryBitmap(new Or.HybridBinarizer(r)),o=t.decode(i);return{text:o.text,format:yk.create(this.toHtml5QrcodeSupportedFormats(o.format))}},n.prototype.createReverseFormatMap=function(){var e=new Map;return this.formatMap.forEach(function(t,r,i){e.set(t,r)}),e},n.prototype.toHtml5QrcodeSupportedFormats=function(e){if(!this.reverseFormatMap.has(e))throw"reverseFormatMap doesn't have "+e;return this.reverseFormatMap.get(e)},n.prototype.createZXingFormats=function(e){for(var t=[],r=0,i=e;r<i.length;r++){var o=i[r];this.formatMap.has(o)?t.push(this.formatMap.get(o)):this.logger.logError(o+" is not supported byZXingHtml5QrcodeShim")}return t},n}(),Ek=function(){function n(e,t,r){if(this.formatMap=new Map([[$e.QR_CODE,"qr_code"],[$e.AZTEC,"aztec"],[$e.CODABAR,"codabar"],[$e.CODE_39,"code_39"],[$e.CODE_93,"code_93"],[$e.CODE_128,"code_128"],[$e.DATA_MATRIX,"data_matrix"],[$e.ITF,"itf"],[$e.EAN_13,"ean_13"],[$e.EAN_8,"ean_8"],[$e.PDF_417,"pdf417"],[$e.UPC_A,"upc_a"],[$e.UPC_E,"upc_e"]]),this.reverseFormatMap=this.createReverseFormatMap(),!n.isSupported())throw"Use html5qrcode.min.js without edit, Use BarcodeDetectorDelegate only if it isSupported();";this.verbose=t,this.logger=r;var i=this.createBarcodeDetectorFormats(e);if(this.detector=new BarcodeDetector(i),!this.detector)throw"BarcodeDetector detector not supported"}return n.isSupported=function(){return"BarcodeDetector"in window&&void 0!==new BarcodeDetector({formats:["qr_code"]})},n.prototype.decodeAsync=function(e){return function(n,e,t,r){return new(t||(t=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(p){s(p)}}function u(d){try{c(r.throw(d))}catch(p){s(p)}}function c(d){d.done?o(d.value):function(o){return o instanceof t?o:new t(function(s){s(o)})}(d.value).then(a,u)}c((r=r.apply(n,e||[])).next())})}(this,void 0,void 0,function(){var t,r;return function(n,e){var r,i,o,s,t={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(d){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=2&c[0]?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(!(o=(o=t.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){t=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){t.label=c[1];break}if(6===c[0]&&t.label<o[1]){t.label=o[1],o=c;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(c);break}o[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(d){c=[6,d],i=0}finally{r=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,d])}}}(this,function(i){switch(i.label){case 0:return[4,this.detector.detect(e)];case 1:if(!(t=i.sent())||0===t.length)throw"No barcode or QR code detected.";return[2,{text:(r=this.selectLargestBarcode(t)).rawValue,format:yk.create(this.toHtml5QrcodeSupportedFormats(r.format))}]}})})},n.prototype.selectLargestBarcode=function(e){for(var t=null,r=0,i=0,o=e;i<o.length;i++){var s=o[i],a=s.boundingBox.width*s.boundingBox.height;a>r&&(r=a,t=s)}if(!t)throw"No largest barcode found";return t},n.prototype.createBarcodeDetectorFormats=function(e){for(var t=[],r=0,i=e;r<i.length;r++){var o=i[r];this.formatMap.has(o)?t.push(this.formatMap.get(o)):this.logger.warn(o+" is not supported byBarcodeDetectorDelegate")}return{formats:t}},n.prototype.toHtml5QrcodeSupportedFormats=function(e){if(!this.reverseFormatMap.has(e))throw"reverseFormatMap doesn't have "+e;return this.reverseFormatMap.get(e)},n.prototype.createReverseFormatMap=function(){var e=new Map;return this.formatMap.forEach(function(t,r,i){e.set(t,r)}),e},n}(),Wee=function(){function n(e,t,r,i){this.EXECUTIONS_TO_REPORT_PERFORMANCE=100,this.executions=0,this.executionResults=[],this.verbose=t,this.decoder=!0===i.useBarCodeDetectorIfSupported&&Ek.isSupported()?new Ek(e,t,r):new Vee(e,t,r)}return n.prototype.decodeAsync=function(e){var t=this,r=performance.now();return this.decoder.decodeAsync(e).finally(function(){if(t.verbose){var i=performance.now()-r;t.executionResults.push(i),t.executions++,t.possiblyFlushPerformanceReport()}})},n.prototype.possiblyFlushPerformanceReport=function(){if(!(this.executions<this.EXECUTIONS_TO_REPORT_PERFORMANCE)){for(var e=0,t=0,r=this.executionResults;t<r.length;t++)e+=r[t];console.log(e/this.executionResults.length+" ms for "+this.executionResults.length+" last runs."),this.executions=0,this.executionResults=[]}},n}(),Hee=function(){function n(){}return n.createExperimentalFeaturesConfig=function(e){return e?(!0!==e.useBarCodeDetectorIfSupported&&(e.useBarCodeDetectorIfSupported=!1),e):{useBarCodeDetectorIfSupported:!1}},n}(),kr=(()=>(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.NOT_STARTED=1]="NOT_STARTED",n[n.SCANNING=2]="SCANNING",n[n.PAUSED=3]="PAUSED"}(kr||(kr={})),kr))(),zee=function(){function n(){this.state=kr.NOT_STARTED,this.onGoingTransactionNewState=kr.UNKNOWN}return n.prototype.directTransition=function(e){this.failIfTransitionOngoing(),this.validateTransition(e),this.state=e},n.prototype.startTransition=function(e){return this.failIfTransitionOngoing(),this.validateTransition(e),this.onGoingTransactionNewState=e,this},n.prototype.execute=function(){if(this.onGoingTransactionNewState===kr.UNKNOWN)throw"Transaction is already cancelled, cannot execute().";var e=this.onGoingTransactionNewState;this.onGoingTransactionNewState=kr.UNKNOWN,this.directTransition(e)},n.prototype.cancel=function(){if(this.onGoingTransactionNewState===kr.UNKNOWN)throw"Transaction is already cancelled, cannot cancel().";this.onGoingTransactionNewState=kr.UNKNOWN},n.prototype.getState=function(){return this.state},n.prototype.failIfTransitionOngoing=function(){if(this.onGoingTransactionNewState!==kr.UNKNOWN)throw"Cannnot transition to a new state, already under transition"},n.prototype.validateTransition=function(e){switch(this.state){case kr.UNKNOWN:throw"Transition from unknown is not allowed";case kr.NOT_STARTED:this.failIfNewStateIs(e,[kr.PAUSED])}},n.prototype.failIfNewStateIs=function(e,t){for(var r=0,i=t;r<i.length;r++)if(e===i[r])throw"Cannot transition from "+this.state+" to "+e},n}(),Gee=function(){function n(e){this.stateManager=e}return n.prototype.startTransition=function(e){return this.stateManager.startTransition(e)},n.prototype.directTransition=function(e){this.stateManager.directTransition(e)},n.prototype.getState=function(){return this.stateManager.getState()},n.prototype.canScanFile=function(){return this.stateManager.getState()===kr.NOT_STARTED},n.prototype.isScanning=function(){return this.stateManager.getState()!==kr.NOT_STARTED},n.prototype.isStrictlyScanning=function(){return this.stateManager.getState()===kr.SCANNING},n.prototype.isPaused=function(){return this.stateManager.getState()===kr.PAUSED},n}(),Yee=function(){function n(){}return n.create=function(){return new Gee(new zee)},n}(),Xee=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])})(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),_s=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return Xee(e,n),e.DEFAULT_WIDTH=300,e.DEFAULT_WIDTH_OFFSET=2,e.FILE_SCAN_MIN_HEIGHT=300,e.MIN_QR_BOX_SIZE=50,e.SHADED_LEFT=1,e.SHADED_RIGHT=2,e.SHADED_TOP=3,e.SHADED_BOTTOM=4,e.SHADED_REGION_ELEMENT_ID="qr-shaded-region",e.VERBOSE=!1,e.BORDER_SHADER_DEFAULT_COLOR="#ffffff",e.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",e}(Cd),qee=function(){function n(e,t){this.logger=t,this.fps=_s.SCAN_DEFAULT_FPS,e?(e.fps&&(this.fps=e.fps),this.disableFlip=!0===e.disableFlip,this.qrbox=e.qrbox,this.aspectRatio=e.aspectRatio,this.videoConstraints=e.videoConstraints):this.disableFlip=_s.DEFAULT_DISABLE_FLIP}return n.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?Ck.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},n.prototype.isShadedBoxEnabled=function(){return!Ed(this.qrbox)},n.create=function(e,t){return new n(e,t)},n}(),$2=function(){function n(e,t){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.videoElement=null,this.localMediaStream=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(e))throw"HTML Element with id="+e+" not found";var r;this.elementId=e,this.verbose=!1,"boolean"==typeof t?this.verbose=!0===t:t&&(this.verbose=!0===t.verbose,r=t.experimentalFeatures),this.logger=new wk(this.verbose),this.qrcode=new Wee(this.getSupportedFormats(t),this.verbose,this.logger,Hee.createExperimentalFeaturesConfig(r)),this.shouldScan=!0,this.stateManagerProxy=Yee.create()}return n.prototype.start=function(e,t,r,i){if(!e)throw"cameraIdOrConfig is required";if(!r||"function"!=typeof r)throw"qrCodeSuccessCallback is required and should be a function.";i||(i=this.verbose?this.logger.log:function(){});var o=qee.create(t,this.logger);this.clearElement();var s=!1;o.videoConstraints&&(o.isMediaStreamConstraintsValid()?s=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var a=s,u=o.isShadedBoxEnabled(),c=document.getElementById(this.elementId),d=c.clientWidth?c.clientWidth:_s.DEFAULT_WIDTH;c.style.position="relative",this.shouldScan=!0,this.element=c,u&&this.validateQrboxSize(o,d);var p=this,m=this.stateManagerProxy.startTransition(kr.SCANNING);return new Promise(function(y,w){var C=a?o.videoConstraints:p.createVideoConstraints(e);if(!C)return m.cancel(),void w("videoConstraints should be defined");navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!1,video:C}).then(function(_){p.onMediaStreamReceived(_,o,a,d,r,i).then(function(A){m.execute(),p.isScanning=!0,y(null)}).catch(function(A){m.cancel(),w(A)})}).catch(function(_){m.cancel(),w(zp.errorGettingUserMedia(_))}):(m.cancel(),w(zp.cameraStreamingNotSupported()))})},n.prototype.pause=function(e){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(kr.PAUSED),this.showPausedState(),(Ed(e)||!0!==e)&&(e=!1),e&&this.videoElement&&this.videoElement.pause()},n.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.videoElement)throw"VideoElement doesn't exist while trying resume()";var e=this,t=function(){e.stateManagerProxy.directTransition(kr.SCANNING),e.hidePausedState()};if(this.videoElement.paused){var i=function(){var o;setTimeout(t,200),null===(o=e.videoElement)||void 0===o||o.removeEventListener("playing",i)};this.videoElement.addEventListener("playing",i),this.videoElement.play()}else t()},n.prototype.getState=function(){return this.stateManagerProxy.getState()},n.prototype.stop=function(){var e=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var t=this.stateManagerProxy.startTransition(kr.NOT_STARTED);return this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout),new Promise(function(i,o){var s=function(){e.localMediaStream=null,e.element&&(e.element.removeChild(e.videoElement),e.element.removeChild(e.canvasElement)),function(){if(e.element){var i=document.getElementById(_s.SHADED_REGION_ELEMENT_ID);i&&e.element.removeChild(i)}}(),e.qrRegion&&(e.qrRegion=null),e.context&&(e.context=null),t.execute(),e.hidePausedState(),e.isScanning=!1,i()};e.localMediaStream||s();var a=e.localMediaStream.getVideoTracks().length,u=0;e.localMediaStream.getVideoTracks().forEach(function(c){e.localMediaStream.removeTrack(c),c.stop(),++u>=a&&s()})})},n.prototype.scanFile=function(e,t){return this.scanFileV2(e,t).then(function(r){return r.decodedText})},n.prototype.scanFileV2=function(e,t){var r=this;if(!(e&&e instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(Ed(t)&&(t=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise(function(i,o){r.possiblyCloseLastScanImageFile(),r.clearElement(),r.lastScanImageFile=URL.createObjectURL(e);var s=new Image;s.onload=function(){var a=s.width,u=s.height,c=document.getElementById(r.elementId),d=c.clientWidth?c.clientWidth:_s.DEFAULT_WIDTH,p=Math.max(c.clientHeight?c.clientHeight:u,_s.FILE_SCAN_MIN_HEIGHT),m=r.computeCanvasDrawConfig(a,u,d,p);if(t){var y=r.createCanvasElement(d,p,"qr-canvas-visible");y.style.display="inline-block",c.appendChild(y);var w=y.getContext("2d");if(!w)throw"Unable to get 2d context from canvas";w.canvas.width=d,w.canvas.height=p,w.drawImage(s,0,0,a,u,m.x,m.y,m.width,m.height)}var C=r.createCanvasElement(m.width,m.height);c.appendChild(C);var _=C.getContext("2d");if(!_)throw"Unable to get 2d context from canvas";_.canvas.width=m.width,_.canvas.height=m.height,_.drawImage(s,0,0,a,u,0,0,m.width,m.height);try{r.qrcode.decodeAsync(C).then(function(A){i(xk.createFromQrcodeResult(A))}).catch(o)}catch(A){o("QR code parse error, error = "+A)}},s.onerror=o,s.onabort=o,s.onstalled=o,s.onsuspend=o,s.src=URL.createObjectURL(e)})},n.prototype.clear=function(){this.clearElement()},n.getCameras=function(){if(navigator.mediaDevices)return n.getCamerasFromMediaDevices();var e=MediaStreamTrack;if(MediaStreamTrack&&e.getSources)return n.getCamerasFromMediaStreamTrack();var r=zp.unableToQuerySupportedDevices();return function(){if("https:"===location.protocol)return!0;var i=location.host.split(":")[0];return"127.0.0.1"===i||"localhost"===i}()||(r=zp.insecureContextCameraQueryError()),Promise.reject(r)},n.prototype.getRunningTrackCapabilities=function(){if(null==this.localMediaStream)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";if(0===this.localMediaStream.getVideoTracks().length)throw"No video tracks found";return this.localMediaStream.getVideoTracks()[0].getCapabilities()},n.prototype.applyVideoConstraints=function(e){var t=this;if(!e)throw"videoConstaints is required argument.";if(!Ck.isMediaStreamConstraintsValid(e,this.logger))throw"invalid videoConstaints passed, check logs for more details";if(null===this.localMediaStream)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";if(0===this.localMediaStream.getVideoTracks().length)throw"No video tracks found";return new Promise(function(r,i){"aspectRatio"in e?i("Chaning 'aspectRatio' in run-time is not yet supported."):t.localMediaStream.getVideoTracks()[0].applyConstraints(e).then(function(s){r(s)}).catch(function(s){i(s)})})},n.getCamerasFromMediaDevices=function(){return new Promise(function(e,t){navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then(function(r){navigator.mediaDevices.enumerateDevices().then(function(o){for(var s=[],a=0,u=o;a<u.length;a++){var c=u[a];"videoinput"===c.kind&&s.push({id:c.deviceId,label:c.label})}(function(o){for(var a=0,u=o.getVideoTracks();a<u.length;a++){var c=u[a];c.enabled=!1,c.stop(),o.removeTrack(c)}})(r),e(s)}).catch(function(o){t(o.name+" : "+o.message)})}).catch(function(r){t(r.name+" : "+r.message)})})},n.getCamerasFromMediaStreamTrack=function(){return new Promise(function(e,t){MediaStreamTrack.getSources(function(o){for(var s=[],a=0,u=o;a<u.length;a++){var c=u[a];"video"===c.kind&&s.push({id:c.id,label:c.label})}e(s)})})},n.prototype.getSupportedFormats=function(e){if(!e||"boolean"==typeof e||!e.formatsToSupport)return[$e.QR_CODE,$e.AZTEC,$e.CODABAR,$e.CODE_39,$e.CODE_93,$e.CODE_128,$e.DATA_MATRIX,$e.MAXICODE,$e.ITF,$e.EAN_13,$e.EAN_8,$e.PDF_417,$e.RSS_14,$e.RSS_EXPANDED,$e.UPC_A,$e.UPC_E,$e.UPC_EAN_EXTENSION];if(!Array.isArray(e.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(0===e.formatsToSupport.length)throw"Atleast 1 formatsToSupport is needed.";for(var r=[],i=0,o=e.formatsToSupport;i<o.length;i++){var s=o[i];Bee(s)?r.push(s):this.logger.warn("Invalid format: "+s+" passed in config, ignoring.")}if(0===r.length)throw"None of formatsToSupport match supported values.";return r},n.prototype.validateQrboxSize=function(e,t){var i=e.qrbox;this.validateQrboxConfig(i);var u,o=this.toQrdimensions(i),s=function(u){if(u<_s.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is "+_s.MIN_QR_BOX_SIZE+"px."};s(o.width),s(o.height),o.width=((u=o.width)>t&&(this.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),u=t),u)},n.prototype.validateQrboxConfig=function(e){if("number"!=typeof e&&(void 0===e.width||void 0===e.height))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},n.prototype.toQrdimensions=function(e){return"number"==typeof e?{width:e,height:e}:e},n.prototype.setupUi=function(e,t,r){var i=Ed(r.qrbox)?{width:e,height:t}:r.qrbox;this.validateQrboxConfig(i);var o=this.toQrdimensions(i);o.height>t&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var s=r.isShadedBoxEnabled()&&o.height<=t,a={x:0,y:0,width:e,height:t},u=s?this.getShadedRegionBounds(e,t,o):a,c=this.createCanvasElement(u.width,u.height),d=c.getContext("2d");d.canvas.width=u.width,d.canvas.height=u.height,this.element.append(c),s&&this.possiblyInsertShadingElement(this.element,e,t,o),this.createScannerPausedUiElement(this.element),this.qrRegion=u,this.context=d,this.canvasElement=c},n.prototype.createScannerPausedUiElement=function(e){var t=document.createElement("div");t.innerText="Scanner paused",t.style.display="none",t.style.position="absolute",t.style.top="0px",t.style.zIndex="1",t.style.background="yellow",t.style.textAlign="center",t.style.width="100%",e.appendChild(t),this.scannerPausedUiElement=t},n.prototype.scanContext=function(e,t){var r=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then(function(i){return e(i.text,xk.createFromQrcodeResult(i)),r.possiblyUpdateShaders(!0),!0}).catch(function(i){r.possiblyUpdateShaders(!1);var o=zp.codeParseError(i);return t(o,bk.createFrom(o)),!1})},n.prototype.foreverScan=function(e,t,r){var i=this;if(this.shouldScan&&this.localMediaStream){var o=this.videoElement,s=o.videoWidth/o.clientWidth,a=o.videoHeight/o.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";this.context.drawImage(o,this.qrRegion.x*s,this.qrRegion.y*a,this.qrRegion.width*s,this.qrRegion.height*a,0,0,this.qrRegion.width,this.qrRegion.height);var m=function(){i.foreverScanTimeout=setTimeout(function(){i.foreverScan(e,t,r)},i.getTimeoutFps(e.fps))};this.scanContext(t,r).then(function(y){y||!0===e.disableFlip?m():(i.context.translate(i.context.canvas.width,0),i.context.scale(-1,1),i.scanContext(t,r).finally(function(){m()}))}).catch(function(y){i.logger.logError("Error happend while scanning context",y),m()})}},n.prototype.onMediaStreamReceived=function(e,t,r,i,o,s){var a=this,u=this;return new Promise(function(c,d){var p=function(){var w=a.createVideoElement(i);u.element.append(w),w.onabort=d,w.onerror=d;var C=function(){u.setupUi(w.clientWidth,w.clientHeight,t),u.foreverScan(t,o,s),w.removeEventListener("playing",C),c(null)};w.addEventListener("playing",C),w.srcObject=e,w.play(),u.videoElement=w};if(u.localMediaStream=e,r||!t.aspectRatio)p();else{var m={aspectRatio:t.aspectRatio};e.getVideoTracks()[0].applyConstraints(m).then(function(w){return p()}).catch(function(w){u.logger.logErrors(["[Html5Qrcode] Constriants could not be satisfied, ignoring constraints",w]),p()})}})},n.prototype.createVideoConstraints=function(e){if("string"==typeof e)return{deviceId:{exact:e}};if("object"==typeof e){var t="facingMode",r="deviceId",i={user:!0,environment:!0},o="exact",s=function(w){if(w in i)return!0;throw"config has invalid 'facingMode' value = '"+w+"'"},a=Object.keys(e);if(1!==a.length)throw"'cameraIdOrConfig' object should have exactly 1 key, if passed as an object, found "+a.length+" keys";var u=Object.keys(e)[0];if(u!==t&&u!==r)throw"Only '"+t+"' and '"+r+"'  are supported for 'cameraIdOrConfig'";if(u!==t){var p=e.deviceId;if("string"==typeof p)return{deviceId:p};if("object"==typeof p){if(o in p)return{deviceId:{exact:p.exact}};throw"'deviceId' should be string or object with exact as key."}throw"Invalid type of 'deviceId' = "+typeof p}var c=e.facingMode;if("string"==typeof c){if(s(c))return{facingMode:c}}else{if("object"!=typeof c)throw"Invalid type of 'facingMode' = "+typeof c;if(!(o in c))throw"'facingMode' should be string or object with exact as key.";if(s(c.exact))return{facingMode:{exact:c.exact}}}}throw"Invalid type of 'cameraIdOrConfig' = "+typeof e},n.prototype.computeCanvasDrawConfig=function(e,t,r,i){if(e<=r&&t<=i)return{x:(r-e)/2,y:(i-t)/2,width:e,height:t};var a=e,u=t;return e>r&&(t*=r/e,e=r),t>i&&(e*=i/t,t=i),this.logger.log("Image downsampled from "+a+"X"+u+" to "+e+"X"+t+"."),this.computeCanvasDrawConfig(e,t,r,i)},n.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var e=document.getElementById(this.elementId);e&&(e.innerHTML="")},n.prototype.createVideoElement=function(e){var t=document.createElement("video");return t.style.width=e+"px",t.muted=!0,t.setAttribute("muted","true"),t.playsInline=!0,t},n.prototype.possiblyUpdateShaders=function(e){this.qrMatch!==e&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach(function(t){t.style.backgroundColor=e?_s.BORDER_SHADER_MATCH_COLOR:_s.BORDER_SHADER_DEFAULT_COLOR}),this.qrMatch=e)},n.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},n.prototype.createCanvasElement=function(e,t,r){var i=e,o=t,s=document.createElement("canvas");return s.style.width=i+"px",s.style.height=o+"px",s.style.display="none",s.id=Ed(r)?"qr-canvas":r,s},n.prototype.getShadedRegionBounds=function(e,t,r){if(r.width>e||r.height>t)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(e-r.width)/2,y:(t-r.height)/2,width:r.width,height:r.height}},n.prototype.possiblyInsertShadingElement=function(e,t,r,i){if(!(t-i.width<1||r-i.height<1)){var o=document.createElement("div");o.style.position="absolute";var s=(t-i.width)/2,a=(r-i.height)/2;if(o.style.borderLeft=s+"px solid #0000007a",o.style.borderRight=s+"px solid #0000007a",o.style.borderTop=a+"px solid #0000007a",o.style.borderBottom=a+"px solid #0000007a",o.style.boxSizing="border-box",o.style.top="0px",o.style.bottom="0px",o.style.left="0px",o.style.right="0px",o.id=""+_s.SHADED_REGION_ELEMENT_ID,t-i.width<11||r-i.height<11)this.hasBorderShaders=!1;else{var c=40;this.insertShaderBorders(o,c,5,-5,0,!0),this.insertShaderBorders(o,c,5,-5,0,!1),this.insertShaderBorders(o,c,5,i.height+5,0,!0),this.insertShaderBorders(o,c,5,i.height+5,0,!1),this.insertShaderBorders(o,5,45,-5,-5,!0),this.insertShaderBorders(o,5,45,i.height+5-c,-5,!0),this.insertShaderBorders(o,5,45,-5,-5,!1),this.insertShaderBorders(o,5,45,i.height+5-c,-5,!1),this.hasBorderShaders=!0}e.append(o)}},n.prototype.insertShaderBorders=function(e,t,r,i,o,s){var a=document.createElement("div");a.style.position="absolute",a.style.backgroundColor=_s.BORDER_SHADER_DEFAULT_COLOR,a.style.width=t+"px",a.style.height=r+"px",a.style.top=i+"px",s?a.style.left=o+"px":a.style.right=o+"px",this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(a),e.appendChild(a)},n.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},n.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},n.prototype.getTimeoutFps=function(e){return 1e3/e},n}(),Ik="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NjAgNDYwIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NjAgNDYwIiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJNMjMwIDBDMTAyLjk3NSAwIDAgMTAyLjk3NSAwIDIzMHMxMDIuOTc1IDIzMCAyMzAgMjMwIDIzMC0xMDIuOTc0IDIzMC0yMzBTMzU3LjAyNSAwIDIzMCAwem0zOC4zMzMgMzc3LjM2YzAgOC42NzYtNy4wMzQgMTUuNzEtMTUuNzEgMTUuNzFoLTQzLjEwMWMtOC42NzYgMC0xNS43MS03LjAzNC0xNS43MS0xNS43MVYyMDIuNDc3YzAtOC42NzYgNy4wMzMtMTUuNzEgMTUuNzEtMTUuNzFoNDMuMTAxYzguNjc2IDAgMTUuNzEgNy4wMzMgMTUuNzEgMTUuNzFWMzc3LjM2ek0yMzAgMTU3Yy0yMS41MzkgMC0zOS0xNy40NjEtMzktMzlzMTcuNDYxLTM5IDM5LTM5IDM5IDE3LjQ2MSAzOSAzOS0xNy40NjEgMzktMzkgMzl6Ii8+PC9zdmc+",Ak=function(){function n(){}return n.createDefault=function(){return{hasPermission:!1,lastUsedCameraId:null}},n}(),Zee=function(){function n(){this.data=Ak.createDefault();var e=localStorage.getItem(n.LOCAL_STORAGE_KEY);e?this.data=JSON.parse(e):this.reset()}return n.prototype.hasCameraPermissions=function(){return this.data.hasPermission},n.prototype.getLastUsedCameraId=function(){return this.data.lastUsedCameraId},n.prototype.setHasPermission=function(e){this.data.hasPermission=e,this.flush()},n.prototype.setLastUsedCameraId=function(e){this.data.lastUsedCameraId=e,this.flush()},n.prototype.resetLastUsedCameraId=function(){this.data.lastUsedCameraId=null,this.flush()},n.prototype.reset=function(){this.data=Ak.createDefault(),this.flush()},n.prototype.flush=function(){localStorage.setItem(n.LOCAL_STORAGE_KEY,JSON.stringify(this.data))},n.LOCAL_STORAGE_KEY="HTML5_QRCODE_DATA",n}(),Jee=function(){function n(){this.infoDiv=document.createElement("div")}return n.prototype.renderInto=function(e){this.infoDiv.style.position="absolute",this.infoDiv.style.top="10px",this.infoDiv.style.right="10px",this.infoDiv.style.zIndex="2",this.infoDiv.style.display="none",this.infoDiv.style.padding="5pt",this.infoDiv.style.border="1px solid silver",this.infoDiv.style.fontSize="10pt",this.infoDiv.style.background="rgb(248 248 248)",this.infoDiv.innerText=_k.builtUsing();var t=document.createElement("a");t.innerText="html5-qrcode",t.href="https://github.com/mebjas/html5-qrcode",t.target="new",this.infoDiv.appendChild(t);var r=document.createElement("br"),i=document.createElement("br");this.infoDiv.appendChild(r),this.infoDiv.appendChild(i);var o=document.createElement("a");o.innerText=_k.reportIssues(),o.href="https://github.com/mebjas/html5-qrcode/issues",o.target="new",this.infoDiv.appendChild(o),e.appendChild(this.infoDiv)},n.prototype.show=function(){this.infoDiv.style.display="block"},n.prototype.hide=function(){this.infoDiv.style.display="none"},n}(),ete=function(){function n(e,t){this.isShowingInfoIcon=!0,this.onTapIn=e,this.onTapOut=t,this.infoIcon=document.createElement("img")}return n.prototype.renderInto=function(e){var t=this;this.infoIcon.alt="Info icon",this.infoIcon.src=Ik,this.infoIcon.style.position="absolute",this.infoIcon.style.top="4px",this.infoIcon.style.right="4px",this.infoIcon.style.opacity="0.6",this.infoIcon.style.cursor="pointer",this.infoIcon.style.zIndex="2",this.infoIcon.style.width="16px",this.infoIcon.style.height="16px",this.infoIcon.onmouseover=function(r){return t.onHoverIn()},this.infoIcon.onmouseout=function(r){return t.onHoverOut()},this.infoIcon.onclick=function(r){return t.onClick()},e.appendChild(this.infoIcon)},n.prototype.onHoverIn=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="1")},n.prototype.onHoverOut=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="0.6")},n.prototype.onClick=function(){this.isShowingInfoIcon?(this.isShowingInfoIcon=!1,this.onTapIn(),this.infoIcon.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAQgAAAEIBarqQRAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAE1SURBVDiNfdI7S0NBEAXgLya1otFgpbYSbISAgpXYi6CmiH9KCAiChaVga6OiWPgfRDQ+0itaGVNosXtluWwcuMzePfM4M3sq8lbHBubwg1dc4m1E/J/N4ghDPOIsfk/4xiEao5KX0McFljN4C9d4QTPXuY99jP3DsIoDPGM6BY5i5yI5R7O4q+ImFkJY2DCh3cAH2klyB+9J1xUMMAG7eCh1a+Mr+k48b5diXrFVwwLuS+BJ9MfR7+G0FHOHhTHhnXNWS87VDF4pcnfQK4Ep7XScNLmPTZgURNKKYENYWDpzW1BhscS1WHS8CDgURFJQrWcoF3c13KKbgg1BYQfy8xZWEzTTw1QZbAoKu8FqJnktdu5hcVSHmchiILzzuaDQvjBzV2m8yohCE1jHfPx/xhU+y4G/D75ELlRJsSYAAAAASUVORK5CYII=",this.infoIcon.style.opacity="1"):(this.isShowingInfoIcon=!0,this.onTapOut(),this.infoIcon.src=Ik,this.infoIcon.style.opacity="0.6")},n}(),tte=function(){function n(){var e=this;this.infoDiv=new Jee,this.infoIcon=new ete(function(){e.infoDiv.show()},function(){e.infoDiv.hide()})}return n.prototype.renderInto=function(e){this.infoDiv.renderInto(e),this.infoIcon.renderInto(e)},n}(),nte=function(){function n(){}return n.hasCameraPermissions=function(){return new Promise(function(e,t){navigator.mediaDevices.enumerateDevices().then(function(r){r.forEach(function(i){"videoinput"===i.kind&&i.label&&e(!0)}),e(!1)})})},n}(),os=(()=>(function(n){n[n.STATUS_DEFAULT=0]="STATUS_DEFAULT",n[n.STATUS_SUCCESS=1]="STATUS_SUCCESS",n[n.STATUS_WARNING=2]="STATUS_WARNING",n[n.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION"}(os||(os={})),os))();function ote(n,e){1&n&&(rt(0,"span"),xn(1,"Qr Input: "),it())}function ste(n,e){if(1&n){const t=Ri();rt(0,"app-webcam-list",7),Qn("selectCamera",function(i){return Qr(t),gn().cameraId=i}),it()}}function ate(n,e){if(1&n){const t=Ri();rt(0,"button",8),Qn("click",function(){return Qr(t),gn().startStream()}),xn(1,"Start"),it()}2&n&&_t("disabled",!gn().cameraId)}function ute(n,e){if(1&n){const t=Ri();rt(0,"button",9),Qn("click",function(){return Qr(t),gn().stopStream()}),xn(1,"Stop"),it()}}!function(){function n(e,t,r){if(this.lastMatchFound=null,this.cameraScanImage=null,this.fileScanImage=null,this.elementId=e,this.config=this.createConfig(t),this.verbose=!0===r,!document.getElementById(e))throw"HTML Element with id="+e+" not found";this.currentScanType=ws.SCAN_TYPE_CAMERA,this.sectionSwapAllowed=!0,this.logger=new wk(this.verbose),this.persistedDataManager=new Zee,!0!==t.rememberLastUsedCamera&&this.persistedDataManager.reset()}n.prototype.render=function(e,t){var r=this;this.lastMatchFound=null,this.qrCodeSuccessCallback=function(o,s){if(e)e(o,s);else{if(r.lastMatchFound===o)return;r.lastMatchFound=o,r.setHeaderMessage(fa.lastMatch(o),os.STATUS_SUCCESS)}},this.qrCodeErrorCallback=function(o,s){t&&t(o,s)};var i=document.getElementById(this.elementId);if(!i)throw"HTML Element with id="+this.elementId+" not found";i.innerHTML="",this.createBasicLayout(i),this.html5Qrcode=new $2(this.getScanRegionId(),function(n,e){return{formatsToSupport:n.formatsToSupport,experimentalFeatures:n.experimentalFeatures,verbose:e}}(this.config,this.verbose))},n.prototype.pause=function(e){if(!this.html5Qrcode)throw"Code scanner not initialized.";(Ed(e)||!0!==e)&&(e=!1),this.html5Qrcode.pause(e)},n.prototype.resume=function(){if(!this.html5Qrcode)throw"Code scanner not initialized.";this.html5Qrcode.resume()},n.prototype.getState=function(){if(!this.html5Qrcode)throw"Code scanner not initialized.";return this.html5Qrcode.getState()},n.prototype.clear=function(){var e=this,t=function(){var r=document.getElementById(e.elementId);r&&(r.innerHTML="",e.resetBasicLayout(r))};return this.html5Qrcode?new Promise(function(r,i){e.html5Qrcode?e.html5Qrcode.isScanning?e.html5Qrcode.stop().then(function(o){e.html5Qrcode?(e.html5Qrcode.clear(),t(),r()):r()}).catch(function(o){e.verbose&&e.logger.logError("Unable to stop qrcode scanner",o),i(o)}):(e.html5Qrcode.clear(),t()):r()}):Promise.resolve()},n.prototype.getRunningTrackCapabilities=function(){if(!this.html5Qrcode)throw"Code scanner not initialized.";return this.html5Qrcode.getRunningTrackCapabilities()},n.prototype.applyVideoConstraints=function(e){if(!this.html5Qrcode)throw"Code scanner not initialized.";return this.html5Qrcode.applyVideoConstraints(e)},n.prototype.createConfig=function(e){return e?(e.fps||(e.fps=Cd.SCAN_DEFAULT_FPS),e.rememberLastUsedCamera!==!Cd.DEFAULT_REMEMBER_LAST_CAMERA_USED&&(e.rememberLastUsedCamera=Cd.DEFAULT_REMEMBER_LAST_CAMERA_USED),e):{fps:Cd.SCAN_DEFAULT_FPS,rememberLastUsedCamera:Cd.DEFAULT_REMEMBER_LAST_CAMERA_USED}},n.prototype.createBasicLayout=function(e){e.style.position="relative",e.style.padding="0px",e.style.border="1px solid silver",this.createHeader(e);var t=document.createElement("div"),r=this.getScanRegionId();t.id=r,t.style.width="100%",t.style.minHeight="100px",t.style.textAlign="center",e.appendChild(t),this.insertCameraScanImageToScanRegion();var i=document.createElement("div"),o=this.getDashboardId();i.id=o,i.style.width="100%",e.appendChild(i),this.setupInitialDashboard(i)},n.prototype.resetBasicLayout=function(e){e.style.border="none"},n.prototype.setupInitialDashboard=function(e){this.createSection(e),this.createSectionControlPanel(),this.createSectionSwap()},n.prototype.createHeader=function(e){var t=document.createElement("div");t.style.textAlign="left",t.style.margin="0px",e.appendChild(t),(new tte).renderInto(t);var i=document.createElement("div");i.id=this.getHeaderMessageContainerId(),i.style.display="none",i.style.textAlign="center",i.style.fontSize="14px",i.style.padding="2px 10px",i.style.margin="4px",i.style.borderTop="1px solid #f6f6f6",t.appendChild(i)},n.prototype.createSection=function(e){var t=document.createElement("div");t.id=this.getDashboardSectionId(),t.style.width="100%",t.style.padding="10px 0px 10px 0px",t.style.textAlign="left",e.appendChild(t)},n.prototype.createCameraListUi=function(e,t,r){var i=this;i.setHeaderMessage(fa.cameraPermissionRequesting());var o=function(){r||i.createPermissionButton(e,t)};$2.getCameras().then(function(s){i.persistedDataManager.setHasPermission(!0),i.resetHeaderMessage(),s&&s.length>0?(e.removeChild(t),i.renderCameraSelection(s)):(i.setHeaderMessage(fa.noCameraFound(),os.STATUS_WARNING),o())}).catch(function(s){i.persistedDataManager.setHasPermission(!1),r?r.disabled=!1:o(),i.setHeaderMessage(s,os.STATUS_WARNING)})},n.prototype.createPermissionButton=function(e,t){var r=this,i=document.createElement("button");i.innerText=fa.cameraPermissionTitle(),i.addEventListener("click",function(){i.disabled=!0,r.createCameraListUi(e,t,i)}),t.appendChild(i)},n.prototype.createPermissionsUi=function(e,t){var r=this;this.persistedDataManager.hasCameraPermissions()?nte.hasCameraPermissions().then(function(i){i?r.createCameraListUi(e,t):(r.persistedDataManager.setHasPermission(!1),r.createPermissionButton(e,t))}).catch(function(i){r.persistedDataManager.setHasPermission(!1),r.createPermissionButton(e,t)}):this.createPermissionButton(e,t)},n.prototype.createSectionControlPanel=function(){var e=this,t=document.getElementById(this.getDashboardSectionId()),r=document.createElement("div");t.appendChild(r);var i=document.createElement("div");i.id=this.getDashboardSectionCameraScanRegionId(),i.style.display=this.currentScanType===ws.SCAN_TYPE_CAMERA?"block":"none",r.appendChild(i);var o=document.createElement("div");o.style.textAlign="center",i.appendChild(o),this.createPermissionsUi(i,o);var s=document.createElement("div");s.id=this.getDashboardSectionFileScanRegionId(),s.style.textAlign="center",s.style.display=this.currentScanType===ws.SCAN_TYPE_CAMERA?"none":"block",r.appendChild(s);var a=document.createElement("input");a.id=this.getFileScanInputId(),a.accept="image/*",a.type="file",a.style.width="200px",a.disabled=this.currentScanType===ws.SCAN_TYPE_CAMERA;var u=document.createElement("span");u.innerText=" Select Image",s.appendChild(a),s.appendChild(u),a.addEventListener("change",function(c){if(!e.html5Qrcode)throw"html5Qrcode not defined";null!=c&&null!=c.target&&e.currentScanType===ws.SCAN_TYPE_FILE&&0!==c.target.files.length&&e.html5Qrcode.scanFileV2(c.target.files[0],!0).then(function(p){e.resetHeaderMessage(),e.qrCodeSuccessCallback(p.decodedText,p)}).catch(function(p){e.setHeaderMessage(p,os.STATUS_WARNING),e.qrCodeErrorCallback(p,bk.createFrom(p))})})},n.prototype.renderCameraSelection=function(e){var t=this,r=document.getElementById(this.getDashboardSectionCameraScanRegionId());r.style.textAlign="center";var i=document.createElement("span");i.style.marginRight="10px";var o=e.length,s=document.createElement("select");if(1===o)s.style.display="none";else{var a=fa.selectCamera();i.innerText=a+" ("+e.length+")  "}s.id=this.getCameraSelectionId();for(var u=[],c=0,d=e;c<d.length;c++){var p=d[c],m=p.id,y=null==p.label?m:p.label;(w=document.createElement("option")).value=m,w.innerText=y,u.push(w),s.appendChild(w)}i.appendChild(s),r.appendChild(i);var C=document.createElement("span"),_=document.createElement("button");_.innerText=fa.scanButtonStartScanningText(),C.appendChild(_);var A=document.createElement("button");A.innerText=fa.scanButtonStopScanningText(),A.style.display="none",A.disabled=!0,C.appendChild(A),r.appendChild(C);var T=function(V){V||(_.style.display="none"),_.innerText=fa.scanButtonStartScanningText(),_.style.opacity="1",_.disabled=!1,V&&(_.style.display="inline-block")};if(_.addEventListener("click",function(V){_.innerText=fa.scanButtonScanningStarting(),s.disabled=!0,_.disabled=!0,_.style.opacity="0.5",t.showHideScanTypeSwapLink(!1),t.resetHeaderMessage();var j=s.value;t.persistedDataManager.setLastUsedCameraId(j),t.html5Qrcode.start(j,function(n){return{fps:n.fps,qrbox:n.qrbox,aspectRatio:n.aspectRatio,disableFlip:n.disableFlip,videoConstraints:n.videoConstraints}}(t.config),t.qrCodeSuccessCallback,t.qrCodeErrorCallback).then(function(U){A.disabled=!1,A.style.display="inline-block",T(!1)}).catch(function(U){t.showHideScanTypeSwapLink(!0),s.disabled=!1,T(!0),t.setHeaderMessage(U,os.STATUS_WARNING)})}),1===o&&_.click(),A.addEventListener("click",function(V){if(!t.html5Qrcode)throw"html5Qrcode not defined";A.disabled=!0,t.html5Qrcode.stop().then(function(j){t.showHideScanTypeSwapLink(!0),s.disabled=!1,_.disabled=!1,A.style.display="none",_.style.display="inline-block",t.insertCameraScanImageToScanRegion()}).catch(function(j){A.disabled=!1,t.setHeaderMessage(j,os.STATUS_WARNING)})}),t.persistedDataManager.getLastUsedCameraId()){for(var N=t.persistedDataManager.getLastUsedCameraId(),M=!1,O=0,L=u;O<L.length;O++){var w;if((w=L[O]).value===N){M=!0;break}}M?(s.value=N,_.click()):t.persistedDataManager.resetLastUsedCameraId()}},n.prototype.createSectionSwap=function(){var e=this,t=fa.textIfCameraScanSelected(),r=fa.textIfFileScanSelected(),i=document.getElementById(this.getDashboardSectionId()),o=document.createElement("div");o.style.textAlign="center";var s=document.createElement("a");s.style.textDecoration="underline",s.id=this.getDashboardSectionSwapLinkId(),s.innerText=this.currentScanType===ws.SCAN_TYPE_CAMERA?t:r,s.href="#scan-using-file",s.addEventListener("click",function(){e.sectionSwapAllowed?(e.resetHeaderMessage(),e.getFileScanInput().value="",e.sectionSwapAllowed=!1,e.currentScanType===ws.SCAN_TYPE_CAMERA?(e.clearScanRegion(),e.getFileScanInput().disabled=!1,e.getCameraScanRegion().style.display="none",e.getFileScanRegion().style.display="block",s.innerText=r,e.currentScanType=ws.SCAN_TYPE_FILE,e.insertFileScanImageToScanRegion()):(e.clearScanRegion(),e.getFileScanInput().disabled=!0,e.getCameraScanRegion().style.display="block",e.getFileScanRegion().style.display="none",s.innerText=t,e.currentScanType=ws.SCAN_TYPE_CAMERA,e.insertCameraScanImageToScanRegion()),e.sectionSwapAllowed=!0):e.verbose&&e.logger.logError("Section swap called when not allowed")}),o.appendChild(s),i.appendChild(o)},n.prototype.resetHeaderMessage=function(){document.getElementById(this.getHeaderMessageContainerId()).style.display="none"},n.prototype.setHeaderMessage=function(e,t){t||(t=os.STATUS_DEFAULT);var r=this.getHeaderMessageDiv();switch(r.innerText=e,r.style.display="block",t){case os.STATUS_SUCCESS:r.style.background="#6aaf5042",r.style.color="#477735";break;case os.STATUS_WARNING:r.style.background="#cb243124",r.style.color="#cb2431";break;case os.STATUS_DEFAULT:default:r.style.background="#00000000",r.style.color="rgb(17, 17, 17)"}},n.prototype.showHideScanTypeSwapLink=function(e){!0!==e&&(e=!1),this.sectionSwapAllowed=e,this.getDashboardSectionSwapLink().style.display=e?"inline-block":"none"},n.prototype.insertCameraScanImageToScanRegion=function(){var e=this,t=document.getElementById(this.getScanRegionId());if(this.cameraScanImage)return t.innerHTML="<br>",void t.appendChild(this.cameraScanImage);this.cameraScanImage=new Image,this.cameraScanImage.onload=function(r){t.innerHTML="<br>",t.appendChild(e.cameraScanImage)},this.cameraScanImage.width=64,this.cameraScanImage.style.opacity="0.8",this.cameraScanImage.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzNzEuNjQzIDM3MS42NDMiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDM3MS42NDMgMzcxLjY0MyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PHBhdGggZD0iTTEwNS4wODQgMzguMjcxaDE2My43Njh2MjBIMTA1LjA4NHoiLz48cGF0aCBkPSJNMzExLjU5NiAxOTAuMTg5Yy03LjQ0MS05LjM0Ny0xOC40MDMtMTYuMjA2LTMyLjc0My0yMC41MjJWMzBjMC0xNi41NDItMTMuNDU4LTMwLTMwLTMwSDEyNS4wODRjLTE2LjU0MiAwLTMwIDEzLjQ1OC0zMCAzMHYxMjAuMTQzaC04LjI5NmMtMTYuNTQyIDAtMzAgMTMuNDU4LTMwIDMwdjEuMzMzYTI5LjgwNCAyOS44MDQgMCAwIDAgNC42MDMgMTUuOTM5Yy03LjM0IDUuNDc0LTEyLjEwMyAxNC4yMjEtMTIuMTAzIDI0LjA2MXYxLjMzM2MwIDkuODQgNC43NjMgMTguNTg3IDEyLjEwMyAyNC4wNjJhMjkuODEgMjkuODEgMCAwIDAtNC42MDMgMTUuOTM4djEuMzMzYzAgMTYuNTQyIDEzLjQ1OCAzMCAzMCAzMGg4LjMyNGMuNDI3IDExLjYzMSA3LjUwMyAyMS41ODcgMTcuNTM0IDI2LjE3Ny45MzEgMTAuNTAzIDQuMDg0IDMwLjE4NyAxNC43NjggNDUuNTM3YTkuOTg4IDkuOTg4IDAgMCAwIDguMjE2IDQuMjg4IDkuOTU4IDkuOTU4IDAgMCAwIDUuNzA0LTEuNzkzYzQuNTMzLTMuMTU1IDUuNjUtOS4zODggMi40OTUtMTMuOTIxLTYuNzk4LTkuNzY3LTkuNjAyLTIyLjYwOC0xMC43Ni0zMS40aDgyLjY4NWMuMjcyLjQxNC41NDUuODE4LjgxNSAxLjIxIDMuMTQyIDQuNTQxIDkuMzcyIDUuNjc5IDEzLjkxMyAyLjUzNCA0LjU0Mi0zLjE0MiA1LjY3Ny05LjM3MSAyLjUzNS0xMy45MTMtMTEuOTE5LTE3LjIyOS04Ljc4Ny0zNS44ODQgOS41ODEtNTcuMDEyIDMuMDY3LTIuNjUyIDEyLjMwNy0xMS43MzIgMTEuMjE3LTI0LjAzMy0uODI4LTkuMzQzLTcuMTA5LTE3LjE5NC0xOC42NjktMjMuMzM3YTkuODU3IDkuODU3IDAgMCAwLTEuMDYxLS40ODZjLS40NjYtLjE4Mi0xMS40MDMtNC41NzktOS43NDEtMTUuNzA2IDEuMDA3LTYuNzM3IDE0Ljc2OC04LjI3MyAyMy43NjYtNy42NjYgMjMuMTU2IDEuNTY5IDM5LjY5OCA3LjgwMyA0Ny44MzYgMTguMDI2IDUuNzUyIDcuMjI1IDcuNjA3IDE2LjYyMyA1LjY3MyAyOC43MzMtLjQxMyAyLjU4NS0uODI0IDUuMjQxLTEuMjQ1IDcuOTU5LTUuNzU2IDM3LjE5NC0xMi45MTkgODMuNDgzLTQ5Ljg3IDExNC42NjEtNC4yMjEgMy41NjEtNC43NTYgOS44Ny0xLjE5NCAxNC4wOTJhOS45OCA5Ljk4IDAgMCAwIDcuNjQ4IDMuNTUxIDkuOTU1IDkuOTU1IDAgMCAwIDYuNDQ0LTIuMzU4YzQyLjY3Mi0zNi4wMDUgNTAuODAyLTg4LjUzMyA1Ni43MzctMTI2Ljg4OC40MTUtMi42ODQuODIxLTUuMzA5IDEuMjI5LTcuODYzIDIuODM0LTE3LjcyMS0uNDU1LTMyLjY0MS05Ljc3Mi00NC4zNDV6bS0yMzIuMzA4IDQyLjYyYy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM2MwLTUuNTE0IDQuNDg2LTEwIDEwLTEwaDE1djIxLjMzM2gtMTV6bS0yLjUtNTIuNjY2YzAtNS41MTQgNC40ODYtMTAgMTAtMTBoNy41djIxLjMzM2gtNy41Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM3ptMTcuNSA5My45OTloLTcuNWMtNS41MTQgMC0xMC00LjQ4Ni0xMC0xMHYtMS4zMzNjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGg3LjV2MjEuMzMzem0zMC43OTYgMjguODg3Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi04LjI3MWg5MS40NTdjLS44NTEgNi42NjgtLjQzNyAxMi43ODcuNzMxIDE4LjI3MWgtODIuMTg4em03OS40ODItMTEzLjY5OGMtMy4xMjQgMjAuOTA2IDEyLjQyNyAzMy4xODQgMjEuNjI1IDM3LjA0IDUuNDQxIDIuOTY4IDcuNTUxIDUuNjQ3IDcuNzAxIDcuMTg4LjIxIDIuMTUtMi41NTMgNS42ODQtNC40NzcgNy4yNTEtLjQ4Mi4zNzgtLjkyOS44LTEuMzM1IDEuMjYxLTYuOTg3IDcuOTM2LTExLjk4MiAxNS41Mi0xNS40MzIgMjIuNjg4aC05Ny41NjRWMzBjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGgxMjMuNzY5YzUuNTE0IDAgMTAgNC40ODYgMTAgMTB2MTM1LjU3OWMtMy4wMzItLjM4MS02LjE1LS42OTQtOS4zODktLjkxNC0yNS4xNTktMS42OTQtNDIuMzcgNy43NDgtNDQuODk4IDI0LjY2NnoiLz48cGF0aCBkPSJNMTc5LjEyOSA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXpNMTcyLjYyOSAxNDIuODZoLTEyLjU2VjEzMC44YTUgNSAwIDEgMC0xMCAwdjE3LjA2MWE1IDUgMCAwIDAgNSA1aDE3LjU2YTUgNSAwIDEgMCAwLTEwLjAwMXpNMjE2LjU2OCA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXptLTUgMjQuMDYxaC0xNC4wNlY5My4xNjdoMTQuMDZ2MTQuMDYxek0yMTEuNjY5IDEyNS45MzZIMTk3LjQxYTUgNSAwIDAgMC01IDV2MTQuMjU3YTUgNSAwIDAgMCA1IDVoMTQuMjU5YTUgNSAwIDAgMCA1LTV2LTE0LjI1N2E1IDUgMCAwIDAtNS01eiIvPjwvc3ZnPg=="},n.prototype.insertFileScanImageToScanRegion=function(){var e=this,t=document.getElementById(this.getScanRegionId());if(this.fileScanImage)return t.innerHTML="<br>",void t.appendChild(this.fileScanImage);this.fileScanImage=new Image,this.fileScanImage.onload=function(r){t.innerHTML="<br>",t.appendChild(e.fileScanImage)},this.fileScanImage.width=64,this.fileScanImage.style.opacity="0.8",this.fileScanImage.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1OS4wMTggNTkuMDE4IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1OS4wMTggNTkuMDE4IiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJtNTguNzQxIDU0LjgwOS01Ljk2OS02LjI0NGExMC43NCAxMC43NCAwIDAgMCAyLjgyLTcuMjVjMC01Ljk1My00Ljg0My0xMC43OTYtMTAuNzk2LTEwLjc5NlMzNCAzNS4zNjEgMzQgNDEuMzE0IDM4Ljg0MyA1Mi4xMSA0NC43OTYgNTIuMTFjMi40NDEgMCA0LjY4OC0uODI0IDYuNDk5LTIuMTk2bDYuMDAxIDYuMjc3YS45OTguOTk4IDAgMCAwIDEuNDE0LjAzMiAxIDEgMCAwIDAgLjAzMS0xLjQxNHpNMzYgNDEuMzE0YzAtNC44NSAzLjk0Ni04Ljc5NiA4Ljc5Ni04Ljc5NnM4Ljc5NiAzLjk0NiA4Ljc5NiA4Ljc5Ni0zLjk0NiA4Ljc5Ni04Ljc5NiA4Ljc5NlMzNiA0Ni4xNjQgMzYgNDEuMzE0ek0xMC40MzEgMTYuMDg4YzAgMy4wNyAyLjQ5OCA1LjU2OCA1LjU2OSA1LjU2OHM1LjU2OS0yLjQ5OCA1LjU2OS01LjU2OGMwLTMuMDcxLTIuNDk4LTUuNTY5LTUuNTY5LTUuNTY5cy01LjU2OSAyLjQ5OC01LjU2OSA1LjU2OXptOS4xMzggMGMwIDEuOTY4LTEuNjAyIDMuNTY4LTMuNTY5IDMuNTY4cy0zLjU2OS0xLjYwMS0zLjU2OS0zLjU2OCAxLjYwMi0zLjU2OSAzLjU2OS0zLjU2OSAzLjU2OSAxLjYwMSAzLjU2OSAzLjU2OXoiLz48cGF0aCBkPSJtMzAuODgyIDI4Ljk4NyA5LjE4LTEwLjA1NCAxMS4yNjIgMTAuMzIzYTEgMSAwIDAgMCAxLjM1MS0xLjQ3NWwtMTItMTFhMSAxIDAgMCAwLTEuNDE0LjA2M2wtOS43OTQgMTAuNzI3LTQuNzQzLTQuNzQzYTEuMDAzIDEuMDAzIDAgMCAwLTEuMzY4LS4wNDRMNi4zMzkgMzcuNzY4YTEgMSAwIDEgMCAxLjMyMiAxLjUwMWwxNi4zMTMtMTQuMzYyIDcuMzE5IDcuMzE4YS45OTkuOTk5IDAgMSAwIDEuNDE0LTEuNDE0bC0xLjgyNS0xLjgyNHoiLz48cGF0aCBkPSJNMzAgNDYuNTE4SDJ2LTQyaDU0djI4YTEgMSAwIDEgMCAyIDB2LTI5YTEgMSAwIDAgMC0xLTFIMWExIDEgMCAwIDAtMSAxdjQ0YTEgMSAwIDAgMCAxIDFoMjlhMSAxIDAgMSAwIDAtMnoiLz48L3N2Zz4="},n.prototype.clearScanRegion=function(){document.getElementById(this.getScanRegionId()).innerHTML=""},n.prototype.getDashboardSectionId=function(){return this.elementId+"__dashboard_section"},n.prototype.getDashboardSectionCameraScanRegionId=function(){return this.elementId+"__dashboard_section_csr"},n.prototype.getDashboardSectionFileScanRegionId=function(){return this.elementId+"__dashboard_section_fsr"},n.prototype.getDashboardSectionSwapLinkId=function(){return this.elementId+"__dashboard_section_swaplink"},n.prototype.getScanRegionId=function(){return this.elementId+"__scan_region"},n.prototype.getDashboardId=function(){return this.elementId+"__dashboard"},n.prototype.getFileScanInputId=function(){return this.elementId+"__filescan_input"},n.prototype.getStatusSpanId=function(){return this.elementId+"__status_span"},n.prototype.getHeaderMessageContainerId=function(){return this.elementId+"__header_message"},n.prototype.getCameraSelectionId=function(){return this.elementId+"__camera_selection"},n.prototype.getCameraScanRegion=function(){return document.getElementById(this.getDashboardSectionCameraScanRegionId())},n.prototype.getFileScanRegion=function(){return document.getElementById(this.getDashboardSectionFileScanRegionId())},n.prototype.getFileScanInput=function(){return document.getElementById(this.getFileScanInputId())},n.prototype.getDashboardSectionSwapLink=function(){return document.getElementById(this.getDashboardSectionSwapLinkId())},n.prototype.getHeaderMessageDiv=function(){return document.getElementById(this.getHeaderMessageContainerId())}}();let Q2=(()=>{class n extends jp{constructor(){super(...arguments),this.videoRefId=`videoRef-${(new Date).getTime()}`,this.captureText=new ii}ngAfterViewInit(){var t=()=>super.ngAfterViewInit,r=this;return qn(function*(){t().call(r),r.html5QrCode=new $2(r.videoRefId)})()}startStream(){var t=this;return qn(function*(){t.html5QrCode&&t.cameraId&&(t.html5QrCode.start(t.cameraId,{fps:t.fps,qrbox:{width:500,height:500},videoConstraints:vm},(r,i)=>{r&&(t.captureText.emit(r),t.stopStream())},r=>{t.error.emit(r)}).catch(r=>{t.error.emit(r)}),t.updateStartStreamAttribute())})()}stopStream(){var t=this;return qn(function*(){var r;null===(r=t.html5QrCode)||void 0===r||r.stop(),t.hideElements()})()}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=yv(n)))(r||n)}}(),n.\u0275cmp=xe({type:n,selectors:[["app-webcam-qr-input"]],outputs:{captureText:"captureText"},features:[df],decls:7,vars:9,consts:[[1,"video-div",3,"id"],["videoRef",""],[1,"buttons"],[4,"ngIf"],[3,"selectCamera",4,"ngIf"],["type","button",3,"disabled","click",4,"ngIf"],["type","button",3,"click",4,"ngIf"],[3,"selectCamera"],["type","button",3,"disabled","click"],["type","button",3,"click"]],template:function(t,r){1&t&&(yr(0,"div",0,1),rt(2,"div",2),Mn(3,ote,2,0,"span",3),Mn(4,ste,1,0,"app-webcam-list",4),Mn(5,ate,2,1,"button",5),Mn(6,ute,2,0,"button",6),it()),2&t&&(Pa("hidden",!r.shouldPlay),_t("id",r.videoRefId),wt(2),Pa("absolute",r.shouldPlay),wt(1),_t("ngIf",!r.shouldPlay),wt(1),_t("ngIf",!r.shouldPlay),wt(1),_t("ngIf",!r.shouldPlay),wt(1),_t("ngIf",r.shouldPlay))},directives:[vu,Wp],styles:["[_nghost-%COMP%]{position:relative;text-align:center}[_nghost-%COMP%]   .overlay[_ngcontent-%COMP%]{display:none}.popup[_nghost-%COMP%]{position:fixed;z-index:999;top:50%;left:50%;transform:translate(-50%) translateY(-50%);box-shadow:1px 1px 14px #000000bf;max-height:90vh;width:auto;min-height:10vh;min-width:30vw;background-color:#fff}.popup[_nghost-%COMP%]   .overlay[_ngcontent-%COMP%]{display:block;height:100%;width:100%;pointer-events:none}.popup[_nghost-%COMP%]   .overlay[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]{position:absolute;pointer-events:inherit;left:50%;top:30%;transform:translate(-50%) translateY(-30%);display:block;border:3px solid greenyellow;width:30%;padding-top:40%;border-radius:30% 30% 50% 50%;box-shadow:1px -1px 30vw 25vw #0006}.popup[_nghost-%COMP%]   .overlay[_ngcontent-%COMP%]   .v-line[_ngcontent-%COMP%]{position:absolute;pointer-events:inherit;top:0px;left:50%;height:100%;transform:translate(calc(-50% + 1px));display:block;border-left:1px dotted gold;width:0%}.popup[_nghost-%COMP%]   .overlay[_ngcontent-%COMP%]   .h-line[_ngcontent-%COMP%]{position:absolute;pointer-events:inherit;left:0px;top:32%;width:100%;transform:translateY(-50%);display:block;border-top:1px dotted gold}.popup[_nghost-%COMP%]   .overlay[_ngcontent-%COMP%]   .h-line-2[_ngcontent-%COMP%]{top:42%}.popup[_nghost-%COMP%]   .overlay[_ngcontent-%COMP%]   .h-line-3[_ngcontent-%COMP%]{top:52%}video[_ngcontent-%COMP%]{transform:rotateY(180deg);min-height:inherit;min-width:inherit;max-height:90vh;max-width:90vw;height:auto;width:auto;position:relative}canvas[_ngcontent-%COMP%]{display:none}.buttons[_ngcontent-%COMP%]{display:flex;align-items:center}.buttons[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{white-space:nowrap}.buttons.absolute[_ngcontent-%COMP%]{position:absolute;bottom:0;left:50%;transform:translate(-50%)}.hidden[_ngcontent-%COMP%]{display:none}.popup[_nghost-%COMP%]{width:auto}[_nghost-%COMP%]   .video-div[_ngcontent-%COMP%]{min-width:70vw;min-height:20vh}[_nghost-%COMP%]   .video-div[_ngcontent-%COMP%]     video{min-width:inherit;min-height:inherit}"]}),n})();const cte={"webcam-face-input":Hp,"webcam-input":jp,"webcam-qr-input":Q2,"peek-detector":q2};let lte=(()=>{class n{constructor(t){this.injector=t,this.components=cte,Object.keys(this.components).forEach(r=>{const i=function(n,e){const t=function(n,e){return e.get(du).resolveComponentFactory(n).inputs}(n,e.injector),r=e.strategyFactory||new lee(n,e.injector),i=function(n){const e={};return n.forEach(({propName:t,templateName:r})=>{e[function(n){return n.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}(r)]=t}),e}(t);class o extends dee{constructor(a){super(),this.injector=a}get ngElementStrategy(){if(!this._ngElementStrategy){const a=this._ngElementStrategy=r.create(this.injector||e.injector);t.forEach(({propName:u})=>{if(!this.hasOwnProperty(u))return;const c=this[u];delete this[u],a.setInputValue(u,c)})}return this._ngElementStrategy}attributeChangedCallback(a,u,c,d){this.ngElementStrategy.setInputValue(i[a],c)}connectedCallback(){let a=!1;this.ngElementStrategy.events&&(this.subscribeToEvents(),a=!0),this.ngElementStrategy.connect(this),a||this.subscribeToEvents()}disconnectedCallback(){this._ngElementStrategy&&this._ngElementStrategy.disconnect(),this.ngElementEventsSubscription&&(this.ngElementEventsSubscription.unsubscribe(),this.ngElementEventsSubscription=null)}subscribeToEvents(){this.ngElementEventsSubscription=this.ngElementStrategy.events.subscribe(a=>{const u=function(n,e,t){if("function"!=typeof CustomEvent){const o=n.createEvent("CustomEvent");return o.initCustomEvent(e,!1,!1,t),o}return new CustomEvent(e,{bubbles:!1,cancelable:!1,detail:t})}(this.ownerDocument,a.name,a.value);this.dispatchEvent(u)})}}return o.observedAttributes=Object.keys(i),t.forEach(({propName:s})=>{Object.defineProperty(o.prototype,s,{get(){return this.ngElementStrategy.getInputValue(s)},set(a){this.ngElementStrategy.setInputValue(s,a)},configurable:!0,enumerable:!0})}),o}(this.components[r],{injector:t});customElements.define(r,i)})}ngDoBootstrap(){}}return n.\u0275fac=function(t){return new(t||n)(Ye(Yn))},n.\u0275mod=gt({type:n}),n.\u0275inj=ji({imports:[[jT]]}),n})(),Dk=(()=>{class n{constructor(t){this.faceService=t,this.faces=[],this.descriptors=[],this.faceDirections=[]}get filteredDescriptors(){return this.descriptors.filter(t=>!!t)}addFaceImage(t){var r=this;return qn(function*(){const i=yield r.faceService.getSingleFaceDescriptor(t);return i?(r.descriptors.push(i),r.faces.push(t)):-1})()}removeFace(t){this.faces[t]=null,this.descriptors.splice(t,1)}getAvgMatchDistance(t){var r=this;return qn(function*(){const i=r.filteredDescriptors;return(yield r.getArrayMatchDistance(t)).reduce((s,a)=>s+(null!=a?a:0),0)/(i.length||1)})()}getArrayMatchDistance(t){var r=this;return qn(function*(){const i=new Array(r.descriptors.length).fill(null);if(0===r.filteredDescriptors.length)return i;const s=yield r.faceService.getSingleFaceDescriptor(t);return s&&(yield r.descriptors.forEach(function(){var a=qn(function*(u,c){!u||(i[c]=function(n,e){return function(n,e){const t=n.reduce((r,i,o)=>r+Math.pow(Math.abs(i-e[o]),d1.minkowskyWeight),0);return Math.pow(t,1/d1.minkowskyWeight)}(n,e)}(u,s))});return function(u,c){return a.apply(this,arguments)}}())),i})()}}return n.\u0275fac=function(t){return new(t||n)(Ye(Y2))},n.\u0275prov=Ve({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const hte=["imgFileUpload"],dte=[".jpg",".jpeg",".png"];let Z2=(()=>{class n{constructor(){this.multiple=!0,this.addImage=new ii,this.extensions=dte.join(", ")}ngOnInit(){}uploadImage(){var t=this;return qn(function*(){var r;if(!t.imgFileUpload.nativeElement.value)return;const i=Array.from((null===(r=t.imgFileUpload.nativeElement)||void 0===r?void 0:r.files)||[]),o=yield Promise.all(i.map(function(){var s=qn(function*(a){return yield function(n){return new Promise(function(e,t){if(!(n instanceof Blob))return t("bufferToImage - expected buf to be of type: Blob");var r=new FileReader;r.onload=function(){if("string"!=typeof r.result)return t("bufferToImage - expected reader.result to be a string, in onload");var i=qi.getEnv().createImageElement();i.onload=function(){return e(i)},i.onerror=t,i.src=r.result},r.onerror=t,r.readAsDataURL(n)})}(a)});return function(a){return s.apply(this,arguments)}}()));t.addImage.emit(o),t.imgFileUpload.nativeElement.value=""})()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=xe({type:n,selectors:[["app-image-picker"]],viewQuery:function(t,r){if(1&t&&Ff(hte,5,bi),2&t){let i;rl(i=il())&&(r.imgFileUpload=i.first)}},inputs:{multiple:"multiple"},outputs:{addImage:"addImage"},decls:3,vars:2,consts:[["id","imgFileUpload","type","file",3,"accept","multiple","change"],["imgFileUpload",""]],template:function(t,r){1&t&&(xn(0,"File Input: "),rt(1,"input",0,1),Qn("change",function(){return r.uploadImage()}),it()),2&t&&(wt(1),_t("accept",r.extensions)("multiple",r.multiple))},styles:[""],changeDetection:0}),n})();function fte(n,e){if(1&n&&(rt(0,"div",1),xn(1),Wh(2,"number"),Wh(3,"number"),Wh(4,"number"),yr(5,"br"),xn(6," reference: "),rt(7,"a",2),xn(8,"link"),it(),it()),2&n){const t=gn();wt(1),Ny(" yaw = ",Of(2,3,null==t.axesRotation?null:t.axesRotation.yaw,"1.0-0")," | roll = ",Of(3,6,null==t.axesRotation?null:t.axesRotation.roll,"1.0-0")," | pitch = ",Of(4,9,null==t.axesRotation?null:t.axesRotation.pitch,"1.0-0")," ")}}let J2=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=xe({type:n,selectors:[["app-axes-rotation-info"]],inputs:{axesRotation:"axesRotation"},decls:1,vars:1,consts:[["class","popup",4,"ngIf"],[1,"popup"],["href","https://media.springernature.com/original/springer-static/image/chp%3A10.1007%2F978-4-431-54439-5_32/MediaObjects/313955_1_En_32_Fig1_HTML.gif"]],template:function(t,r){1&t&&Mn(0,fte,9,12,"div",0),2&t&&_t("ngIf",r.axesRotation)},directives:[vu],pipes:[Zx],styles:[".popup[_ngcontent-%COMP%]{display:block;position:fixed;bottom:10px;left:10px;background-color:#ff0;max-width:100px;padding:3px;white-space:normal}"]}),n})();const Sk="undefined"==typeof window?function(n){return n()}:window.requestAnimationFrame;function Tk(n,e,t){const r=t||(s=>Array.prototype.slice.call(s));let i=!1,o=[];return function(...s){o=r(s),i||(i=!0,Sk.call(window,()=>{i=!1,n.apply(e,o)}))}}const e_=n=>"start"===n?"left":"end"===n?"right":"center",uo=(n,e,t)=>"start"===n?e:"end"===n?t:(e+t)/2;function Pu(){}const mte=function(){let n=0;return function(){return n++}}();function Un(n){return null==n}function hr(n){if(Array.isArray&&Array.isArray(n))return!0;const e=Object.prototype.toString.call(n);return"[object"===e.substr(0,7)&&"Array]"===e.substr(-6)}function vn(n){return null!==n&&"[object Object]"===Object.prototype.toString.call(n)}const ei=n=>("number"==typeof n||n instanceof Number)&&isFinite(+n);function Cs(n,e){return ei(n)?n:e}function en(n,e){return void 0===n?e:n}const Mk=(n,e)=>"string"==typeof n&&n.endsWith("%")?parseFloat(n)/100*e:+n;function dr(n,e,t){if(n&&"function"==typeof n.call)return n.apply(t,e)}function Zn(n,e,t,r){let i,o,s;if(hr(n))if(o=n.length,r)for(i=o-1;i>=0;i--)e.call(t,n[i],i);else for(i=0;i<o;i++)e.call(t,n[i],i);else if(vn(n))for(s=Object.keys(n),o=s.length,i=0;i<o;i++)e.call(t,n[s[i]],s[i])}function xm(n,e){let t,r,i,o;if(!n||!e||n.length!==e.length)return!1;for(t=0,r=n.length;t<r;++t)if(i=n[t],o=e[t],i.datasetIndex!==o.datasetIndex||i.index!==o.index)return!1;return!0}function bm(n){if(hr(n))return n.map(bm);if(vn(n)){const e=Object.create(null),t=Object.keys(n),r=t.length;let i=0;for(;i<r;++i)e[t[i]]=bm(n[t[i]]);return e}return n}function Rk(n){return-1===["__proto__","prototype","constructor"].indexOf(n)}function yte(n,e,t,r){if(!Rk(n))return;const i=e[n],o=t[n];vn(i)&&vn(o)?Gp(i,o,r):e[n]=bm(o)}function Gp(n,e,t){const r=hr(e)?e:[e],i=r.length;if(!vn(n))return n;const o=(t=t||{}).merger||yte;for(let s=0;s<i;++s){if(!vn(e=r[s]))continue;const a=Object.keys(e);for(let u=0,c=a.length;u<c;++u)o(a[u],n,e,t)}return n}function Yp(n,e){return Gp(n,e,{merger:xte})}function xte(n,e,t){if(!Rk(n))return;const r=e[n],i=t[n];vn(r)&&vn(i)?Yp(r,i):Object.prototype.hasOwnProperty.call(e,n)||(e[n]=bm(i))}function Nk(n,e){const t=n.indexOf(".",e);return-1===t?n.length:t}function Rl(n,e){if(""===e)return n;let t=0,r=Nk(e,t);for(;n&&r>t;)n=n[e.substr(t,r-t)],t=r+1,r=Nk(e,t);return n}function t_(n){return n.charAt(0).toUpperCase()+n.slice(1)}const Es=n=>void 0!==n,Oc=n=>"function"==typeof n,Xr=Math.PI,sr=2*Xr,Cte=sr+Xr,wm=Number.POSITIVE_INFINITY,Ete=Xr/180,ti=Xr/2,Xp=Xr/4,Ok=2*Xr/3,Is=Math.log10,Za=Math.sign;function kk(n){const e=Math.round(n);n=qp(n,e,n/1e3)?e:n;const t=Math.pow(10,Math.floor(Is(n))),r=n/t;return(r<=1?1:r<=2?2:r<=5?5:10)*t}function Id(n){return!isNaN(parseFloat(n))&&isFinite(n)}function qp(n,e,t){return Math.abs(n-e)<t}function Pk(n,e,t){let r,i,o;for(r=0,i=n.length;r<i;r++)o=n[r][t],isNaN(o)||(e.min=Math.min(e.min,o),e.max=Math.max(e.max,o))}function pa(n){return n*(Xr/180)}function n_(n){return n*(180/Xr)}function Fk(n){if(!ei(n))return;let e=1,t=0;for(;Math.round(n*e)/e!==n;)e*=10,t++;return t}function r_(n,e){return Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2))}function Ste(n,e){return(n-e+Cte)%sr-Xr}function ga(n){return(n%sr+sr)%sr}function _m(n,e,t,r){const i=ga(n),o=ga(e),s=ga(t),a=ga(o-i),u=ga(s-i),c=ga(i-o),d=ga(i-s);return i===o||i===s||r&&o===s||a>u&&c<d}function Li(n,e,t){return Math.max(e,Math.min(t,n))}const Cm=n=>0===n||1===n,Lk=(n,e,t)=>-Math.pow(2,10*(n-=1))*Math.sin((n-e)*sr/t),Bk=(n,e,t)=>Math.pow(2,-10*n)*Math.sin((n-e)*sr/t)+1,$p={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>-n*(n-2),easeInOutQuad:n=>(n/=.5)<1?.5*n*n:-.5*(--n*(n-2)-1),easeInCubic:n=>n*n*n,easeOutCubic:n=>(n-=1)*n*n+1,easeInOutCubic:n=>(n/=.5)<1?.5*n*n*n:.5*((n-=2)*n*n+2),easeInQuart:n=>n*n*n*n,easeOutQuart:n=>-((n-=1)*n*n*n-1),easeInOutQuart:n=>(n/=.5)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2),easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>(n-=1)*n*n*n*n+1,easeInOutQuint:n=>(n/=.5)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2),easeInSine:n=>1-Math.cos(n*ti),easeOutSine:n=>Math.sin(n*ti),easeInOutSine:n=>-.5*(Math.cos(Xr*n)-1),easeInExpo:n=>0===n?0:Math.pow(2,10*(n-1)),easeOutExpo:n=>1===n?1:1-Math.pow(2,-10*n),easeInOutExpo:n=>Cm(n)?n:n<.5?.5*Math.pow(2,10*(2*n-1)):.5*(2-Math.pow(2,-10*(2*n-1))),easeInCirc:n=>n>=1?n:-(Math.sqrt(1-n*n)-1),easeOutCirc:n=>Math.sqrt(1-(n-=1)*n),easeInOutCirc:n=>(n/=.5)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1),easeInElastic:n=>Cm(n)?n:Lk(n,.075,.3),easeOutElastic:n=>Cm(n)?n:Bk(n,.075,.3),easeInOutElastic(n){const e=.1125;return Cm(n)?n:n<.5?.5*Lk(2*n,e,.45):.5+.5*Bk(2*n-1,e,.45)},easeInBack(n){const e=1.70158;return n*n*((e+1)*n-e)},easeOutBack(n){const e=1.70158;return(n-=1)*n*((e+1)*n+e)+1},easeInOutBack(n){let e=1.70158;return(n/=.5)<1?n*n*((1+(e*=1.525))*n-e)*.5:.5*((n-=2)*n*((1+(e*=1.525))*n+e)+2)},easeInBounce:n=>1-$p.easeOutBounce(1-n),easeOutBounce(n){const e=7.5625,t=2.75;return n<1/t?e*n*n:n<2/t?e*(n-=1.5/t)*n+.75:n<2.5/t?e*(n-=2.25/t)*n+.9375:e*(n-=2.625/t)*n+.984375},easeInOutBounce:n=>n<.5?.5*$p.easeInBounce(2*n):.5*$p.easeOutBounce(2*n-1)+.5},As={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},i_="0123456789ABCDEF",Mte=n=>i_[15&n],Rte=n=>i_[(240&n)>>4]+i_[15&n],Em=n=>(240&n)>>4==(15&n);function Kp(n){return n+.5|0}const Im=(n,e,t)=>Math.max(Math.min(n,t),e);function Qp(n){return Im(Kp(2.55*n),0,255)}function Zp(n){return Im(Kp(255*n),0,255)}function o_(n){return Im(Kp(n/2.55)/100,0,1)}function Vk(n){return Im(Kp(100*n),0,100)}const Pte=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/,Bte=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Uk(n,e,t){const r=e*Math.min(t,1-t),i=(o,s=(o+n/30)%12)=>t-r*Math.max(Math.min(s-3,9-s,1),-1);return[i(0),i(8),i(4)]}function Vte(n,e,t){const r=(i,o=(i+n/60)%6)=>t-t*e*Math.max(Math.min(o,4-o,1),0);return[r(5),r(3),r(1)]}function Ute(n,e,t){const r=Uk(n,1,.5);let i;for(e+t>1&&(i=1/(e+t),e*=i,t*=i),i=0;i<3;i++)r[i]*=1-e-t,r[i]+=e;return r}function s_(n){const t=n.r/255,r=n.g/255,i=n.b/255,o=Math.max(t,r,i),s=Math.min(t,r,i),a=(o+s)/2;let u,c,d;return o!==s&&(d=o-s,c=a>.5?d/(2-o-s):d/(o+s),u=o===t?(r-i)/d+(r<i?6:0):o===r?(i-t)/d+2:(t-r)/d+4,u=60*u+.5),[0|u,c||0,a]}function a_(n,e,t,r){return(Array.isArray(e)?n(e[0],e[1],e[2]):n(e,t,r)).map(Zp)}function u_(n,e,t){return a_(Uk,n,e,t)}function jk(n){return(n%360+360)%360}const Wk={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Hk={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let Am;function Dm(n,e,t){if(n){let r=s_(n);r[e]=Math.max(0,Math.min(r[e]+r[e]*t,0===e?360:1)),r=u_(r),n.r=r[0],n.g=r[1],n.b=r[2]}}function zk(n,e){return n&&Object.assign(e||{},n)}function Gk(n){var e={r:0,g:0,b:0,a:255};return Array.isArray(n)?n.length>=3&&(e={r:n[0],g:n[1],b:n[2],a:255},n.length>3&&(e.a=Zp(n[3]))):(e=zk(n,{r:0,g:0,b:0,a:1})).a=Zp(e.a),e}function qte(n){return"r"===n.charAt(0)?function(n){const e=Pte.exec(n);let r,i,o,t=255;if(e){if(e[7]!==r){const s=+e[7];t=255&(e[8]?Qp(s):255*s)}return r=+e[1],i=+e[3],o=+e[5],r=255&(e[2]?Qp(r):r),i=255&(e[4]?Qp(i):i),o=255&(e[6]?Qp(o):o),{r,g:i,b:o,a:t}}}(n):function(n){const e=Bte.exec(n);let r,t=255;if(!e)return;e[5]!==r&&(t=e[6]?Qp(+e[5]):Zp(+e[5]));const i=jk(+e[2]),o=+e[3]/100,s=+e[4]/100;return r="hwb"===e[1]?function(n,e,t){return a_(Ute,n,e,t)}(i,o,s):"hsv"===e[1]?function(n,e,t){return a_(Vte,n,e,t)}(i,o,s):u_(i,o,s),{r:r[0],g:r[1],b:r[2],a:t}}(n)}class Sm{constructor(e){if(e instanceof Sm)return e;const t=typeof e;let r;"object"===t?r=Gk(e):"string"===t&&(r=function(n){var t,e=n.length;return"#"===n[0]&&(4===e||5===e?t={r:255&17*As[n[1]],g:255&17*As[n[2]],b:255&17*As[n[3]],a:5===e?17*As[n[4]]:255}:(7===e||9===e)&&(t={r:As[n[1]]<<4|As[n[2]],g:As[n[3]]<<4|As[n[4]],b:As[n[5]]<<4|As[n[6]],a:9===e?As[n[7]]<<4|As[n[8]]:255})),t}(e)||function(n){Am||(Am=function(){const n={},e=Object.keys(Hk),t=Object.keys(Wk);let r,i,o,s,a;for(r=0;r<e.length;r++){for(s=a=e[r],i=0;i<t.length;i++)o=t[i],a=a.replace(o,Wk[o]);o=parseInt(Hk[s],16),n[a]=[o>>16&255,o>>8&255,255&o]}return n}(),Am.transparent=[0,0,0,0]);const e=Am[n.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:4===e.length?e[3]:255}}(e)||qte(e)),this._rgb=r,this._valid=!!r}get valid(){return this._valid}get rgb(){var e=zk(this._rgb);return e&&(e.a=o_(e.a)),e}set rgb(e){this._rgb=Gk(e)}rgbString(){return this._valid?function(n){return n&&(n.a<255?`rgba(${n.r}, ${n.g}, ${n.b}, ${o_(n.a)})`:`rgb(${n.r}, ${n.g}, ${n.b})`)}(this._rgb):this._rgb}hexString(){return this._valid?function(n){var e=function(n){return Em(n.r)&&Em(n.g)&&Em(n.b)&&Em(n.a)}(n)?Mte:Rte;return n&&"#"+e(n.r)+e(n.g)+e(n.b)+(n.a<255?e(n.a):"")}(this._rgb):this._rgb}hslString(){return this._valid?function(n){if(!n)return;const e=s_(n),t=e[0],r=Vk(e[1]),i=Vk(e[2]);return n.a<255?`hsla(${t}, ${r}%, ${i}%, ${o_(n.a)})`:`hsl(${t}, ${r}%, ${i}%)`}(this._rgb):this._rgb}mix(e,t){const r=this;if(e){const i=r.rgb,o=e.rgb;let s;const a=t===s?.5:t,u=2*a-1,c=i.a-o.a,d=((u*c==-1?u:(u+c)/(1+u*c))+1)/2;s=1-d,i.r=255&d*i.r+s*o.r+.5,i.g=255&d*i.g+s*o.g+.5,i.b=255&d*i.b+s*o.b+.5,i.a=a*i.a+(1-a)*o.a,r.rgb=i}return r}clone(){return new Sm(this.rgb)}alpha(e){return this._rgb.a=Zp(e),this}clearer(e){return this._rgb.a*=1-e,this}greyscale(){const e=this._rgb,t=Kp(.3*e.r+.59*e.g+.11*e.b);return e.r=e.g=e.b=t,this}opaquer(e){return this._rgb.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return Dm(this._rgb,2,e),this}darken(e){return Dm(this._rgb,2,-e),this}saturate(e){return Dm(this._rgb,1,e),this}desaturate(e){return Dm(this._rgb,1,-e),this}rotate(e){return function(n,e){var t=s_(n);t[0]=jk(t[0]+e),t=u_(t),n.r=t[0],n.g=t[1],n.b=t[2]}(this._rgb,e),this}}function Yk(n){return new Sm(n)}const Xk=n=>n instanceof CanvasGradient||n instanceof CanvasPattern;function qk(n){return Xk(n)?n:Yk(n)}function c_(n){return Xk(n)?n:Yk(n).saturate(.5).darken(.1).hexString()}const Nl=Object.create(null),l_=Object.create(null);function Jp(n,e){if(!e)return n;const t=e.split(".");for(let r=0,i=t.length;r<i;++r){const o=t[r];n=n[o]||(n[o]=Object.create(null))}return n}function h_(n,e,t){return"string"==typeof e?Gp(Jp(n,e),t):Gp(Jp(n,""),e)}var bn=new class{constructor(e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=t=>t.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(t,r)=>c_(r.backgroundColor),this.hoverBorderColor=(t,r)=>c_(r.borderColor),this.hoverColor=(t,r)=>c_(r.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.describe(e)}set(e,t){return h_(this,e,t)}get(e){return Jp(this,e)}describe(e,t){return h_(l_,e,t)}override(e,t){return h_(Nl,e,t)}route(e,t,r,i){const o=Jp(this,e),s=Jp(this,r),a="_"+t;Object.defineProperties(o,{[a]:{value:o[t],writable:!0},[t]:{enumerable:!0,get(){const u=this[a],c=s[i];return vn(u)?Object.assign({},c,u):en(u,c)},set(u){this[a]=u}}})}}({_scriptable:n=>!n.startsWith("on"),_indexable:n=>"events"!==n,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}});function Tm(n,e,t,r,i){let o=e[i];return o||(o=e[i]=n.measureText(i).width,t.push(i)),o>r&&(r=o),r}function Qte(n,e,t,r){let i=(r=r||{}).data=r.data||{},o=r.garbageCollect=r.garbageCollect||[];r.font!==e&&(i=r.data={},o=r.garbageCollect=[],r.font=e),n.save(),n.font=e;let s=0;const a=t.length;let u,c,d,p,m;for(u=0;u<a;u++)if(p=t[u],null!=p&&!0!==hr(p))s=Tm(n,i,o,s,p);else if(hr(p))for(c=0,d=p.length;c<d;c++)m=p[c],null!=m&&!hr(m)&&(s=Tm(n,i,o,s,m));n.restore();const y=o.length/2;if(y>t.length){for(u=0;u<y;u++)delete i[o[u]];o.splice(0,y)}return s}function Ol(n,e,t){const r=n.currentDevicePixelRatio,i=0!==t?Math.max(t/2,.5):0;return Math.round((e-i)*r)/r+i}function $k(n,e){(e=e||n.getContext("2d")).save(),e.resetTransform(),e.clearRect(0,0,n.width,n.height),e.restore()}function Mm(n,e,t,r){let i,o,s,a,u;const c=e.pointStyle,d=e.rotation,p=e.radius;let m=(d||0)*Ete;if(c&&"object"==typeof c&&(i=c.toString(),"[object HTMLImageElement]"===i||"[object HTMLCanvasElement]"===i))return n.save(),n.translate(t,r),n.rotate(m),n.drawImage(c,-c.width/2,-c.height/2,c.width,c.height),void n.restore();if(!(isNaN(p)||p<=0)){switch(n.beginPath(),c){default:n.arc(t,r,p,0,sr),n.closePath();break;case"triangle":n.moveTo(t+Math.sin(m)*p,r-Math.cos(m)*p),m+=Ok,n.lineTo(t+Math.sin(m)*p,r-Math.cos(m)*p),m+=Ok,n.lineTo(t+Math.sin(m)*p,r-Math.cos(m)*p),n.closePath();break;case"rectRounded":u=.516*p,a=p-u,o=Math.cos(m+Xp)*a,s=Math.sin(m+Xp)*a,n.arc(t-o,r-s,u,m-Xr,m-ti),n.arc(t+s,r-o,u,m-ti,m),n.arc(t+o,r+s,u,m,m+ti),n.arc(t-s,r+o,u,m+ti,m+Xr),n.closePath();break;case"rect":if(!d){a=Math.SQRT1_2*p,n.rect(t-a,r-a,2*a,2*a);break}m+=Xp;case"rectRot":o=Math.cos(m)*p,s=Math.sin(m)*p,n.moveTo(t-o,r-s),n.lineTo(t+s,r-o),n.lineTo(t+o,r+s),n.lineTo(t-s,r+o),n.closePath();break;case"crossRot":m+=Xp;case"cross":o=Math.cos(m)*p,s=Math.sin(m)*p,n.moveTo(t-o,r-s),n.lineTo(t+o,r+s),n.moveTo(t+s,r-o),n.lineTo(t-s,r+o);break;case"star":o=Math.cos(m)*p,s=Math.sin(m)*p,n.moveTo(t-o,r-s),n.lineTo(t+o,r+s),n.moveTo(t+s,r-o),n.lineTo(t-s,r+o),m+=Xp,o=Math.cos(m)*p,s=Math.sin(m)*p,n.moveTo(t-o,r-s),n.lineTo(t+o,r+s),n.moveTo(t+s,r-o),n.lineTo(t-s,r+o);break;case"line":o=Math.cos(m)*p,s=Math.sin(m)*p,n.moveTo(t-o,r-s),n.lineTo(t+o,r+s);break;case"dash":n.moveTo(t,r),n.lineTo(t+Math.cos(m)*p,r+Math.sin(m)*p)}n.fill(),e.borderWidth>0&&n.stroke()}}function kl(n,e,t){return t=t||.5,!e||n&&n.x>e.left-t&&n.x<e.right+t&&n.y>e.top-t&&n.y<e.bottom+t}function Rm(n,e){n.save(),n.beginPath(),n.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),n.clip()}function Nm(n){n.restore()}function Zte(n,e,t,r,i){if(!e)return n.lineTo(t.x,t.y);if("middle"===i){const o=(e.x+t.x)/2;n.lineTo(o,e.y),n.lineTo(o,t.y)}else"after"===i!=!!r?n.lineTo(e.x,t.y):n.lineTo(t.x,e.y);n.lineTo(t.x,t.y)}function Jte(n,e,t,r){if(!e)return n.lineTo(t.x,t.y);n.bezierCurveTo(r?e.cp1x:e.cp2x,r?e.cp1y:e.cp2y,r?t.cp2x:t.cp1x,r?t.cp2y:t.cp1y,t.x,t.y)}function Pl(n,e,t,r,i,o={}){const s=hr(e)?e:[e],a=o.strokeWidth>0&&""!==o.strokeColor;let u,c;for(n.save(),n.font=i.string,function(n,e){e.translation&&n.translate(e.translation[0],e.translation[1]),Un(e.rotation)||n.rotate(e.rotation),e.color&&(n.fillStyle=e.color),e.textAlign&&(n.textAlign=e.textAlign),e.textBaseline&&(n.textBaseline=e.textBaseline)}(n,o),u=0;u<s.length;++u)c=s[u],a&&(o.strokeColor&&(n.strokeStyle=o.strokeColor),Un(o.strokeWidth)||(n.lineWidth=o.strokeWidth),n.strokeText(c,t,r,o.maxWidth)),n.fillText(c,t,r,o.maxWidth),tne(n,t,r,c,o),r+=i.lineHeight;n.restore()}function tne(n,e,t,r,i){if(i.strikethrough||i.underline){const o=n.measureText(r),s=e-o.actualBoundingBoxLeft,a=e+o.actualBoundingBoxRight,u=t-o.actualBoundingBoxAscent,c=t+o.actualBoundingBoxDescent,d=i.strikethrough?(u+c)/2:c;n.strokeStyle=n.fillStyle,n.beginPath(),n.lineWidth=i.decorationWidth||2,n.moveTo(s,d),n.lineTo(a,d),n.stroke()}}function Om(n,e){const{x:t,y:r,w:i,h:o,radius:s}=e;n.arc(t+s.topLeft,r+s.topLeft,s.topLeft,-ti,Xr,!0),n.lineTo(t,r+o-s.bottomLeft),n.arc(t+s.bottomLeft,r+o-s.bottomLeft,s.bottomLeft,Xr,ti,!0),n.lineTo(t+i-s.bottomRight,r+o),n.arc(t+i-s.bottomRight,r+o-s.bottomRight,s.bottomRight,ti,0,!0),n.lineTo(t+i,r+s.topRight),n.arc(t+i-s.topRight,r+s.topRight,s.topRight,0,-ti,!0),n.lineTo(t+s.topLeft,r)}const nne=new RegExp(/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/),rne=new RegExp(/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/);function ine(n,e){const t=(""+n).match(nne);if(!t||"normal"===t[1])return 1.2*e;switch(n=+t[2],t[3]){case"px":return n;case"%":n/=100}return e*n}const one=n=>+n||0;function d_(n,e){const t={},r=vn(e),i=r?Object.keys(e):e,o=vn(n)?r?s=>en(n[s],n[e[s]]):s=>n[s]:()=>n;for(const s of i)t[s]=one(o(s));return t}function Kk(n){return d_(n,{top:"y",right:"x",bottom:"y",left:"x"})}function Ad(n){return d_(n,["topLeft","topRight","bottomLeft","bottomRight"])}function Io(n){const e=Kk(n);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function Ai(n,e){let t=en((n=n||{}).size,(e=e||bn.font).size);"string"==typeof t&&(t=parseInt(t,10));let r=en(n.style,e.style);r&&!(""+r).match(rne)&&(console.warn('Invalid font style specified: "'+r+'"'),r="");const i={family:en(n.family,e.family),lineHeight:ine(en(n.lineHeight,e.lineHeight),t),size:t,style:r,weight:en(n.weight,e.weight),string:""};return i.string=function(n){return!n||Un(n.size)||Un(n.family)?null:(n.style?n.style+" ":"")+(n.weight?n.weight+" ":"")+n.size+"px "+n.family}(i),i}function eg(n,e,t,r){let o,s,a,i=!0;for(o=0,s=n.length;o<s;++o)if(a=n[o],void 0!==a&&(void 0!==e&&"function"==typeof a&&(a=a(e),i=!1),void 0!==t&&hr(a)&&(a=a[t%a.length],i=!1),void 0!==a))return r&&!i&&(r.cacheable=!1),a}function kc(n,e){return Object.assign(Object.create(n),e)}function f_(n,e,t){t=t||(s=>n[s]<e);let o,r=n.length-1,i=0;for(;r-i>1;)o=i+r>>1,t(o)?i=o:r=o;return{lo:i,hi:r}}const Fu=(n,e,t)=>f_(n,t,r=>n[r][e]<t),ane=(n,e,t)=>f_(n,t,r=>n[r][e]>=t),Qk=["push","pop","shift","splice","unshift"];function Zk(n,e){const t=n._chartjs;if(!t)return;const r=t.listeners,i=r.indexOf(e);-1!==i&&r.splice(i,1),!(r.length>0)&&(Qk.forEach(o=>{delete n[o]}),delete n._chartjs)}function Jk(n){const e=new Set;let t,r;for(t=0,r=n.length;t<r;++t)e.add(n[t]);return e.size===r?n:Array.from(e)}function p_(n,e=[""],t=n,r,i=(()=>n[0])){Es(r)||(r=o4("_fallback",n));const o={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:n,_rootScopes:t,_fallback:r,_getTarget:i,override:s=>p_([s,...n],e,t,r)};return new Proxy(o,{deleteProperty:(s,a)=>(delete s[a],delete s._keys,delete n[0][a],!0),get:(s,a)=>n4(s,a,()=>function(n,e,t,r){let i;for(const o of e)if(i=o4(lne(o,n),t),Es(i))return t4(n,i)?g_(t,r,n,i):i}(a,e,n,s)),getOwnPropertyDescriptor:(s,a)=>Reflect.getOwnPropertyDescriptor(s._scopes[0],a),getPrototypeOf:()=>Reflect.getPrototypeOf(n[0]),has:(s,a)=>s4(s).includes(a),ownKeys:s=>s4(s),set:(s,a,u)=>((s._storage||(s._storage=i()))[a]=u,delete s[a],delete s._keys,!0)})}function Dd(n,e,t,r){const i={_cacheable:!1,_proxy:n,_context:e,_subProxy:t,_stack:new Set,_descriptors:e4(n,r),setContext:o=>Dd(n,o,t,r),override:o=>Dd(n.override(o),e,t,r)};return new Proxy(i,{deleteProperty:(o,s)=>(delete o[s],delete n[s],!0),get:(o,s,a)=>n4(o,s,()=>function(n,e,t){const{_proxy:r,_context:i,_subProxy:o,_descriptors:s}=n;let a=r[e];return Oc(a)&&s.isScriptable(e)&&(a=function(n,e,t,r){const{_proxy:i,_context:o,_subProxy:s,_stack:a}=t;if(a.has(n))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+n);return a.add(n),e=e(o,s||r),a.delete(n),vn(e)&&(e=g_(i._scopes,i,n,e)),e}(e,a,n,t)),hr(a)&&a.length&&(a=function(n,e,t,r){const{_proxy:i,_context:o,_subProxy:s,_descriptors:a}=t;if(Es(o.index)&&r(n))e=e[o.index%e.length];else if(vn(e[0])){const u=e,c=i._scopes.filter(d=>d!==u);e=[];for(const d of u){const p=g_(c,i,n,d);e.push(Dd(p,o,s&&s[n],a))}}return e}(e,a,n,s.isIndexable)),t4(e,a)&&(a=Dd(a,i,o&&o[e],s)),a}(o,s,a)),getOwnPropertyDescriptor:(o,s)=>o._descriptors.allKeys?Reflect.has(n,s)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(n,s),getPrototypeOf:()=>Reflect.getPrototypeOf(n),has:(o,s)=>Reflect.has(n,s),ownKeys:()=>Reflect.ownKeys(n),set:(o,s,a)=>(n[s]=a,delete o[s],!0)})}function e4(n,e={scriptable:!0,indexable:!0}){const{_scriptable:t=e.scriptable,_indexable:r=e.indexable,_allKeys:i=e.allKeys}=n;return{allKeys:i,scriptable:t,indexable:r,isScriptable:Oc(t)?t:()=>t,isIndexable:Oc(r)?r:()=>r}}const lne=(n,e)=>n?n+t_(e):e,t4=(n,e)=>vn(e)&&"adapters"!==n;function n4(n,e,t){if(Object.prototype.hasOwnProperty.call(n,e))return n[e];const r=t();return n[e]=r,r}function r4(n,e,t){return Oc(n)?n(e,t):n}const pne=(n,e)=>!0===n?e:"string"==typeof n?Rl(e,n):void 0;function gne(n,e,t,r){for(const i of e){const o=pne(t,i);if(o){n.add(o);const s=r4(o._fallback,t,o);if(Es(s)&&s!==t&&s!==r)return s}else if(!1===o&&Es(r)&&t!==r)return null}return!1}function g_(n,e,t,r){const i=e._rootScopes,o=r4(e._fallback,t,r),s=[...n,...i],a=new Set;a.add(r);let u=i4(a,s,t,o||t);return!(null===u||Es(o)&&o!==t&&(u=i4(a,s,o,u),null===u))&&p_(Array.from(a),[""],i,o,()=>function(n,e,t){const r=n._getTarget();e in r||(r[e]={});const i=r[e];return hr(i)&&vn(t)?t:i}(e,t,r))}function i4(n,e,t,r){for(;t;)t=gne(n,e,t,r);return t}function o4(n,e){for(const t of e){if(!t)continue;const r=t[n];if(Es(r))return r}}function s4(n){let e=n._keys;return e||(e=n._keys=function(n){const e=new Set;for(const t of n)for(const r of Object.keys(t).filter(i=>!i.startsWith("_")))e.add(r);return Array.from(e)}(n._scopes)),e}const xne=Number.EPSILON||1e-14,Sd=(n,e)=>e<n.length&&!n[e].skip&&n[e],a4=n=>"x"===n?"y":"x";function bne(n,e,t,r){const i=n.skip?e:n,o=e,s=t.skip?e:t,a=r_(o,i),u=r_(s,o);let c=a/(a+u),d=u/(a+u);c=isNaN(c)?0:c,d=isNaN(d)?0:d;const p=r*c,m=r*d;return{previous:{x:o.x-p*(s.x-i.x),y:o.y-p*(s.y-i.y)},next:{x:o.x+m*(s.x-i.x),y:o.y+m*(s.y-i.y)}}}function km(n,e,t){return Math.max(Math.min(n,t),e)}function Ine(n,e,t,r,i){let o,s,a,u;if(e.spanGaps&&(n=n.filter(c=>!c.skip)),"monotone"===e.cubicInterpolationMode)!function(n,e="x"){const t=a4(e),r=n.length,i=Array(r).fill(0),o=Array(r);let s,a,u,c=Sd(n,0);for(s=0;s<r;++s)if(a=u,u=c,c=Sd(n,s+1),u){if(c){const d=c[e]-u[e];i[s]=0!==d?(c[t]-u[t])/d:0}o[s]=a?c?Za(i[s-1])!==Za(i[s])?0:(i[s-1]+i[s])/2:i[s-1]:i[s]}(function(n,e,t){const r=n.length;let i,o,s,a,u,c=Sd(n,0);for(let d=0;d<r-1;++d)if(u=c,c=Sd(n,d+1),u&&c){if(qp(e[d],0,xne)){t[d]=t[d+1]=0;continue}i=t[d]/e[d],o=t[d+1]/e[d],a=Math.pow(i,2)+Math.pow(o,2),!(a<=9)&&(s=3/Math.sqrt(a),t[d]=i*s*e[d],t[d+1]=o*s*e[d])}})(n,i,o),function(n,e,t="x"){const r=a4(t),i=n.length;let o,s,a,u=Sd(n,0);for(let c=0;c<i;++c){if(s=a,a=u,u=Sd(n,c+1),!a)continue;const d=a[t],p=a[r];s&&(o=(d-s[t])/3,a[`cp1${t}`]=d-o,a[`cp1${r}`]=p-o*e[c]),u&&(o=(u[t]-d)/3,a[`cp2${t}`]=d+o,a[`cp2${r}`]=p+o*e[c])}}(n,o,e)}(n,i);else{let c=r?n[n.length-1]:n[0];for(o=0,s=n.length;o<s;++o)a=n[o],u=bne(c,a,n[Math.min(o+1,s-(r?0:1))%s],e.tension),a.cp1x=u.previous.x,a.cp1y=u.previous.y,a.cp2x=u.next.x,a.cp2y=u.next.y,c=a}e.capBezierPoints&&function(n,e){let t,r,i,o,s,a=kl(n[0],e);for(t=0,r=n.length;t<r;++t)s=o,o=a,a=t<r-1&&kl(n[t+1],e),o&&(i=n[t],s&&(i.cp1x=km(i.cp1x,e.left,e.right),i.cp1y=km(i.cp1y,e.top,e.bottom)),a&&(i.cp2x=km(i.cp2x,e.left,e.right),i.cp2y=km(i.cp2y,e.top,e.bottom)))}(n,t)}function u4(){return"undefined"!=typeof window&&"undefined"!=typeof document}function m_(n){let e=n.parentNode;return e&&"[object ShadowRoot]"===e.toString()&&(e=e.host),e}function Pm(n,e,t){let r;return"string"==typeof n?(r=parseInt(n,10),-1!==n.indexOf("%")&&(r=r/100*e.parentNode[t])):r=n,r}const Fm=n=>window.getComputedStyle(n,null),Dne=["top","right","bottom","left"];function Fl(n,e,t){const r={};t=t?"-"+t:"";for(let i=0;i<4;i++){const o=Dne[i];r[o]=parseFloat(n[e+"-"+o+t])||0}return r.width=r.left+r.right,r.height=r.top+r.bottom,r}function c4(n,e){const{canvas:t,currentDevicePixelRatio:r}=e,i=Fm(t),o="border-box"===i.boxSizing,s=Fl(i,"padding"),a=Fl(i,"border","width"),{x:u,y:c,box:d}=function(n,e){const t=n.native||n,r=t.touches,i=r&&r.length?r[0]:t,{offsetX:o,offsetY:s}=i;let u,c,a=!1;if(((n,e,t)=>(n>0||e>0)&&(!t||!t.shadowRoot))(o,s,t.target))u=o,c=s;else{const d=e.getBoundingClientRect();u=i.clientX-d.left,c=i.clientY-d.top,a=!0}return{x:u,y:c,box:a}}(n,t),p=s.left+(d&&a.left),m=s.top+(d&&a.top);let{width:y,height:w}=e;return o&&(y-=s.width+a.width,w-=s.height+a.height),{x:Math.round((u-p)/y*t.width/r),y:Math.round((c-m)/w*t.height/r)}}const v_=n=>Math.round(10*n)/10;function l4(n,e,t){const r=e||1,i=Math.floor(n.height*r),o=Math.floor(n.width*r);n.height=i/r,n.width=o/r;const s=n.canvas;return s.style&&(t||!s.style.height&&!s.style.width)&&(s.style.height=`${n.height}px`,s.style.width=`${n.width}px`),(n.currentDevicePixelRatio!==r||s.height!==i||s.width!==o)&&(n.currentDevicePixelRatio=r,s.height=i,s.width=o,n.ctx.setTransform(r,0,0,r,0,0),!0)}const Nne=function(){let n=!1;try{const e={get passive(){return n=!0,!1}};window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch(e){}return n}();function h4(n,e){const t=function(n,e){return Fm(n).getPropertyValue(e)}(n,e),r=t&&t.match(/^(\d+)(\.\d+)?px$/);return r?+r[1]:void 0}function Ll(n,e,t,r){return{x:n.x+t*(e.x-n.x),y:n.y+t*(e.y-n.y)}}function One(n,e,t,r){return{x:n.x+t*(e.x-n.x),y:"middle"===r?t<.5?n.y:e.y:"after"===r?t<1?n.y:e.y:t>0?e.y:n.y}}function kne(n,e,t,r){const i={x:n.cp2x,y:n.cp2y},o={x:e.cp1x,y:e.cp1y},s=Ll(n,i,t),a=Ll(i,o,t),u=Ll(o,e,t),c=Ll(s,a,t),d=Ll(a,u,t);return Ll(c,d,t)}const d4=new Map;function tg(n,e,t){return function(n,e){e=e||{};const t=n+JSON.stringify(e);let r=d4.get(t);return r||(r=new Intl.NumberFormat(n,e),d4.set(t,r)),r}(e,t).format(n)}function Td(n,e,t){return n?function(n,e){return{x:t=>n+n+e-t,setWidth(t){e=t},textAlign:t=>"center"===t?t:"right"===t?"left":"right",xPlus:(t,r)=>t-r,leftForLtr:(t,r)=>t-r}}(e,t):{x:n=>n,setWidth(n){},textAlign:n=>n,xPlus:(n,e)=>n+e,leftForLtr:(n,e)=>n}}function f4(n,e){let t,r;("ltr"===e||"rtl"===e)&&(t=n.canvas.style,r=[t.getPropertyValue("direction"),t.getPropertyPriority("direction")],t.setProperty("direction",e,"important"),n.prevTextDirection=r)}function p4(n,e){void 0!==e&&(delete n.prevTextDirection,n.canvas.style.setProperty("direction",e[0],e[1]))}function g4(n){return"angle"===n?{between:_m,compare:Ste,normalize:ga}:{between:(e,t,r)=>e>=Math.min(t,r)&&e<=Math.max(r,t),compare:(e,t)=>e-t,normalize:e=>e}}function m4({start:n,end:e,count:t,loop:r,style:i}){return{start:n%t,end:e%t,loop:r&&(e-n+1)%t==0,style:i}}function v4(n,e,t){if(!t)return[n];const{property:r,start:i,end:o}=t,s=e.length,{compare:a,between:u,normalize:c}=g4(r),{start:d,end:p,loop:m,style:y}=function(n,e,t){const{property:r,start:i,end:o}=t,{between:s,normalize:a}=g4(r),u=e.length;let m,y,{start:c,end:d,loop:p}=n;if(p){for(c+=u,d+=u,m=0,y=u;m<y&&s(a(e[c%u][r]),i,o);++m)c--,d--;c%=u,d%=u}return d<c&&(d+=u),{start:c,end:d,loop:p,style:n.style}}(n,e,t),w=[];let A,T,N,C=!1,_=null;for(let j=d,U=d;j<=p;++j)T=e[j%s],!T.skip&&(A=c(T[r]),A!==N&&(C=u(A,i,o),null===_&&(C||u(i,N,A)&&0!==a(i,N))&&(_=0===a(A,i)?j:U),null!==_&&(!C||0===a(o,A)||u(o,N,A))&&(w.push(m4({start:_,end:j,loop:m,count:s,style:y})),_=null),U=j,N=A));return null!==_&&w.push(m4({start:_,end:p,loop:m,count:s,style:y})),w}function y4(n,e){const t=[],r=n.segments;for(let i=0;i<r.length;i++){const o=v4(r[i],n.points,e);o.length&&t.push(...o)}return t}function b4(n){return{backgroundColor:n.backgroundColor,borderCapStyle:n.borderCapStyle,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderJoinStyle:n.borderJoinStyle,borderWidth:n.borderWidth,borderColor:n.borderColor}}function Hne(n,e){return e&&JSON.stringify(n)!==JSON.stringify(e)}var Lu=new class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,t,r,i){const s=t.duration;t.listeners[i].forEach(a=>a({chart:e,initial:t.initial,numSteps:s,currentStep:Math.min(r-t.start,s)}))}_refresh(){this._request||(this._running=!0,this._request=Sk.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let t=0;this._charts.forEach((r,i)=>{if(!r.running||!r.items.length)return;const o=r.items;let u,s=o.length-1,a=!1;for(;s>=0;--s)u=o[s],u._active?(u._total>r.duration&&(r.duration=u._total),u.tick(e),a=!0):(o[s]=o[o.length-1],o.pop());a&&(i.draw(),this._notify(i,r,e,"progress")),o.length||(r.running=!1,this._notify(i,r,e,"complete"),r.initial=!1),t+=o.length}),this._lastDate=e,0===t&&(this._running=!1)}_getAnims(e){const t=this._charts;let r=t.get(e);return r||(r={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(e,r)),r}listen(e,t,r){this._getAnims(e).listeners[t].push(r)}add(e,t){!t||!t.length||this._getAnims(e).items.push(...t)}has(e){return this._getAnims(e).items.length>0}start(e){const t=this._charts.get(e);!t||(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce((r,i)=>Math.max(r,i._duration),0),this._refresh())}running(e){if(!this._running)return!1;const t=this._charts.get(e);return!(!t||!t.running||!t.items.length)}stop(e){const t=this._charts.get(e);if(!t||!t.items.length)return;const r=t.items;let i=r.length-1;for(;i>=0;--i)r[i].cancel();t.items=[],this._notify(e,t,Date.now(),"complete")}remove(e){return this._charts.delete(e)}};const w4="transparent",Gne={boolean:(n,e,t)=>t>.5?e:n,color(n,e,t){const r=qk(n||w4),i=r.valid&&qk(e||w4);return i&&i.valid?i.mix(r,t).hexString():e},number:(n,e,t)=>n+(e-n)*t};class Yne{constructor(e,t,r,i){const o=t[r];i=eg([e.to,i,o,e.from]);const s=eg([e.from,o,i]);this._active=!0,this._fn=e.fn||Gne[e.type||typeof s],this._easing=$p[e.easing]||$p.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=t,this._prop=r,this._from=s,this._to=i,this._promises=void 0}active(){return this._active}update(e,t,r){if(this._active){this._notify(!1);const i=this._target[this._prop],o=r-this._start,s=this._duration-o;this._start=r,this._duration=Math.floor(Math.max(s,e.duration)),this._total+=o,this._loop=!!e.loop,this._to=eg([e.to,t,i,e.from]),this._from=eg([e.from,i,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const t=e-this._start,r=this._duration,i=this._prop,o=this._from,s=this._loop,a=this._to;let u;if(this._active=o!==a&&(s||t<r),!this._active)return this._target[i]=a,void this._notify(!0);t<0?this._target[i]=o:(u=t/r%2,u=s&&u>1?2-u:u,u=this._easing(Math.min(1,Math.max(0,u))),this._target[i]=this._fn(o,a,u))}wait(){const e=this._promises||(this._promises=[]);return new Promise((t,r)=>{e.push({res:t,rej:r})})}_notify(e){const t=e?"res":"rej",r=this._promises||[];for(let i=0;i<r.length;i++)r[i][t]()}}bn.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0});const $ne=Object.keys(bn.animation);bn.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:n=>"onProgress"!==n&&"onComplete"!==n&&"fn"!==n}),bn.set("animations",{colors:{type:"color",properties:["color","borderColor","backgroundColor"]},numbers:{type:"number",properties:["x","y","borderWidth","radius","tension"]}}),bn.describe("animations",{_fallback:"animation"}),bn.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:n=>0|n}}}});class _4{constructor(e,t){this._chart=e,this._properties=new Map,this.configure(t)}configure(e){if(!vn(e))return;const t=this._properties;Object.getOwnPropertyNames(e).forEach(r=>{const i=e[r];if(!vn(i))return;const o={};for(const s of $ne)o[s]=i[s];(hr(i.properties)&&i.properties||[r]).forEach(s=>{(s===r||!t.has(s))&&t.set(s,o)})})}_animateOptions(e,t){const r=t.options,i=function(n,e){if(!e)return;let t=n.options;if(t)return t.$shared&&(n.options=t=Object.assign({},t,{$shared:!1,$animations:{}})),t;n.options=e}(e,r);if(!i)return[];const o=this._createAnimations(i,r);return r.$shared&&function(n,e){const t=[],r=Object.keys(e);for(let i=0;i<r.length;i++){const o=n[r[i]];o&&o.active()&&t.push(o.wait())}return Promise.all(t)}(e.options.$animations,r).then(()=>{e.options=r},()=>{}),o}_createAnimations(e,t){const r=this._properties,i=[],o=e.$animations||(e.$animations={}),s=Object.keys(t),a=Date.now();let u;for(u=s.length-1;u>=0;--u){const c=s[u];if("$"===c.charAt(0))continue;if("options"===c){i.push(...this._animateOptions(e,t));continue}const d=t[c];let p=o[c];const m=r.get(c);if(p){if(m&&p.active()){p.update(m,d,a);continue}p.cancel()}m&&m.duration?(o[c]=p=new Yne(m,e,c,d),i.push(p)):e[c]=d}return i}update(e,t){if(0===this._properties.size)return void Object.assign(e,t);const r=this._createAnimations(e,t);return r.length?(Lu.add(this._chart,r),!0):void 0}}function C4(n,e){const t=n&&n.options||{},r=t.reverse,i=void 0===t.min?e:0,o=void 0===t.max?e:0;return{start:r?o:i,end:r?i:o}}function E4(n,e){const t=[],r=n._getSortedDatasetMetas(e);let i,o;for(i=0,o=r.length;i<o;++i)t.push(r[i].index);return t}function I4(n,e,t,r={}){const i=n.keys,o="single"===r.mode;let s,a,u,c;if(null!==e){for(s=0,a=i.length;s<a;++s){if(u=+i[s],u===t){if(r.all)continue;break}c=n.values[u],ei(c)&&(o||0===e||Za(e)===Za(c))&&(e+=c)}return e}}function A4(n,e){const t=n&&n.options.stacked;return t||void 0===t&&void 0!==e.stack}function rre(n,e,t){const r=n[e]||(n[e]={});return r[t]||(r[t]={})}function D4(n,e,t,r){for(const i of e.getMatchingVisibleMetas(r).reverse()){const o=n[i.index];if(t&&o>0||!t&&o<0)return i.index}return null}function S4(n,e){const{chart:t,_cachedMeta:r}=n,i=t._stacks||(t._stacks={}),{iScale:o,vScale:s,index:a}=r,u=o.axis,c=s.axis,d=function(n,e,t){return`${n.id}.${e.id}.${t.stack||t.type}`}(o,s,r),p=e.length;let m;for(let y=0;y<p;++y){const w=e[y],{[u]:C,[c]:_}=w;m=(w._stacks||(w._stacks={}))[c]=rre(i,d,C),m[a]=_,m._top=D4(m,s,!0,r.type),m._bottom=D4(m,s,!1,r.type)}}function y_(n,e){const t=n.scales;return Object.keys(t).filter(r=>t[r].axis===e).shift()}function ng(n,e){const t=n.controller.index,r=n.vScale&&n.vScale.axis;if(r){e=e||n._parsed;for(const i of e){const o=i._stacks;if(!o||void 0===o[r]||void 0===o[r][t])return;delete o[r][t]}}}const x_=n=>"reset"===n||"none"===n,T4=(n,e)=>e?n:Object.assign({},n);let Bu=(()=>{class n{constructor(t,r){this.chart=t,this._ctx=t.ctx,this.index=r,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.$context=void 0,this._syncList=[],this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=A4(t.vScale,t),this.addElements()}updateIndex(t){this.index!==t&&ng(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,r=this._cachedMeta,i=this.getDataset(),o=(m,y,w,C)=>"x"===m?y:"r"===m?C:w,s=r.xAxisID=en(i.xAxisID,y_(t,"x")),a=r.yAxisID=en(i.yAxisID,y_(t,"y")),u=r.rAxisID=en(i.rAxisID,y_(t,"r")),c=r.indexAxis,d=r.iAxisID=o(c,s,a,u),p=r.vAxisID=o(c,a,s,u);r.xScale=this.getScaleForId(s),r.yScale=this.getScaleForId(a),r.rScale=this.getScaleForId(u),r.iScale=this.getScaleForId(d),r.vScale=this.getScaleForId(p)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const r=this._cachedMeta;return t===r.iScale?r.vScale:r.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&Zk(this._data,this),t._stacked&&ng(t)}_dataCheck(){const t=this.getDataset(),r=t.data||(t.data=[]),i=this._data;if(vn(r))this._data=function(n){const e=Object.keys(n),t=new Array(e.length);let r,i,o;for(r=0,i=e.length;r<i;++r)o=e[r],t[r]={x:o,y:n[o]};return t}(r);else if(i!==r){if(i){Zk(i,this);const o=this._cachedMeta;ng(o),o._parsed=[]}r&&Object.isExtensible(r)&&function(n,e){n._chartjs?n._chartjs.listeners.push(e):(Object.defineProperty(n,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),Qk.forEach(t=>{const r="_onData"+t_(t),i=n[t];Object.defineProperty(n,t,{configurable:!0,enumerable:!1,value(...o){const s=i.apply(this,o);return n._chartjs.listeners.forEach(a=>{"function"==typeof a[r]&&a[r](...o)}),s}})}))}(r,this),this._syncList=[],this._data=r}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const r=this._cachedMeta,i=this.getDataset();let o=!1;this._dataCheck();const s=r._stacked;r._stacked=A4(r.vScale,r),r.stack!==i.stack&&(o=!0,ng(r),r.stack=i.stack),this._resyncElements(t),(o||s!==r._stacked)&&S4(this,r._parsed)}configure(){const t=this.chart.config,r=t.datasetScopeKeys(this._type),i=t.getOptionScopes(this.getDataset(),r,!0);this.options=t.createResolver(i,this.getContext()),this._parsing=this.options.parsing}parse(t,r){const{_cachedMeta:i,_data:o}=this,{iScale:s,_stacked:a}=i,u=s.axis;let p,m,y,c=0===t&&r===o.length||i._sorted,d=t>0&&i._parsed[t-1];if(!1===this._parsing)i._parsed=o,i._sorted=!0,y=o;else{y=hr(o[t])?this.parseArrayData(i,o,t,r):vn(o[t])?this.parseObjectData(i,o,t,r):this.parsePrimitiveData(i,o,t,r);const w=()=>null===m[u]||d&&m[u]<d[u];for(p=0;p<r;++p)i._parsed[p+t]=m=y[p],c&&(w()&&(c=!1),d=m);i._sorted=c}a&&S4(this,y)}parsePrimitiveData(t,r,i,o){const{iScale:s,vScale:a}=t,u=s.axis,c=a.axis,d=s.getLabels(),p=s===a,m=new Array(o);let y,w,C;for(y=0,w=o;y<w;++y)C=y+i,m[y]={[u]:p||s.parse(d[C],C),[c]:a.parse(r[C],C)};return m}parseArrayData(t,r,i,o){const{xScale:s,yScale:a}=t,u=new Array(o);let c,d,p,m;for(c=0,d=o;c<d;++c)p=c+i,m=r[p],u[c]={x:s.parse(m[0],p),y:a.parse(m[1],p)};return u}parseObjectData(t,r,i,o){const{xScale:s,yScale:a}=t,{xAxisKey:u="x",yAxisKey:c="y"}=this._parsing,d=new Array(o);let p,m,y,w;for(p=0,m=o;p<m;++p)y=p+i,w=r[y],d[p]={x:s.parse(Rl(w,u),y),y:a.parse(Rl(w,c),y)};return d}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,r,i){const s=this._cachedMeta,a=r[t.axis];return I4({keys:E4(this.chart,!0),values:r._stacks[t.axis]},a,s.index,{mode:i})}updateRangeFromParsed(t,r,i,o){const s=i[r.axis];let a=null===s?NaN:s;const u=o&&i._stacks[r.axis];o&&u&&(o.values=u,a=I4(o,s,this._cachedMeta.index)),t.min=Math.min(t.min,a),t.max=Math.max(t.max,a)}getMinMax(t,r){const i=this._cachedMeta,o=i._parsed,s=i._sorted&&t===i.iScale,a=o.length,u=this._getOtherScale(t),c=((n,e,t)=>n&&!e.hidden&&e._stacked&&{keys:E4(this.chart,!0),values:null})(r,i),d={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:p,max:m}=function(n){const{min:e,max:t,minDefined:r,maxDefined:i}=n.getUserBounds();return{min:r?e:Number.NEGATIVE_INFINITY,max:i?t:Number.POSITIVE_INFINITY}}(u);let y,w;function C(){w=o[y];const _=w[u.axis];return!ei(w[t.axis])||p>_||m<_}for(y=0;y<a&&(C()||(this.updateRangeFromParsed(d,t,w,c),!s));++y);if(s)for(y=a-1;y>=0;--y)if(!C()){this.updateRangeFromParsed(d,t,w,c);break}return d}getAllParsedValues(t){const r=this._cachedMeta._parsed,i=[];let o,s,a;for(o=0,s=r.length;o<s;++o)a=r[o][t.axis],ei(a)&&i.push(a);return i}getMaxOverflow(){return!1}getLabelAndValue(t){const r=this._cachedMeta,i=r.iScale,o=r.vScale,s=this.getParsed(t);return{label:i?""+i.getLabelForValue(s[i.axis]):"",value:o?""+o.getLabelForValue(s[o.axis]):""}}_update(t){const r=this._cachedMeta;this.configure(),this._cachedDataOpts={},this.update(t||"default"),r._clip=function(n){let e,t,r,i;return vn(n)?(e=n.top,t=n.right,r=n.bottom,i=n.left):e=t=r=i=n,{top:e,right:t,bottom:r,left:i,disabled:!1===n}}(en(this.options.clip,function(n,e,t){if(!1===t)return!1;const r=C4(n,t),i=C4(e,t);return{top:i.end,right:r.end,bottom:i.start,left:r.start}}(r.xScale,r.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,i=this._cachedMeta,o=i.data||[],s=this.chart.chartArea,a=[],u=this._drawStart||0,c=this._drawCount||o.length-u;let d;for(i.dataset&&i.dataset.draw(t,s,u,c),d=u;d<u+c;++d){const p=o[d];p.hidden||(p.active?a.push(p):p.draw(t,s))}for(d=0;d<a.length;++d)a[d].draw(t,s)}getStyle(t,r){const i=r?"active":"default";return void 0===t&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(t||0,i)}getContext(t,r,i){const o=this.getDataset();let s;if(t>=0&&t<this._cachedMeta.data.length){const a=this._cachedMeta.data[t];s=a.$context||(a.$context=function(n,e,t){return kc(n,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:t,index:e,mode:"default",type:"data"})}(this.getContext(),t,a)),s.parsed=this.getParsed(t),s.raw=o.data[t],s.index=s.dataIndex=t}else s=this.$context||(this.$context=function(n,e){return kc(n,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),s.dataset=o,s.index=s.datasetIndex=this.index;return s.active=!!r,s.mode=i,s}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,r){return this._resolveElementOptions(this.dataElementType.id,r,t)}_resolveElementOptions(t,r="default",i){const o="active"===r,s=this._cachedDataOpts,a=t+"-"+r,u=s[a],c=this.enableOptionSharing&&Es(i);if(u)return T4(u,c);const d=this.chart.config,p=d.datasetElementScopeKeys(this._type,t),m=o?[`${t}Hover`,"hover",t,""]:[t,""],y=d.getOptionScopes(this.getDataset(),p),w=Object.keys(bn.elements[t]),_=d.resolveNamedOptions(y,w,()=>this.getContext(i,o),m);return _.$shared&&(_.$shared=c,s[a]=Object.freeze(T4(_,c))),_}_resolveAnimations(t,r,i){const o=this.chart,s=this._cachedDataOpts,a=`animation-${r}`,u=s[a];if(u)return u;let c;if(!1!==o.options.animation){const p=this.chart.config,m=p.datasetAnimationScopeKeys(this._type,r),y=p.getOptionScopes(this.getDataset(),m);c=p.createResolver(y,this.getContext(t,i,r))}const d=new _4(o,c&&c.animations);return c&&c._cacheable&&(s[a]=Object.freeze(d)),d}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,r){return!r||x_(t)||this.chart._animationsDisabled}updateElement(t,r,i,o){x_(o)?Object.assign(t,i):this._resolveAnimations(r,o).update(t,i)}updateSharedOptions(t,r,i){t&&!x_(r)&&this._resolveAnimations(void 0,r).update(t,i)}_setStyle(t,r,i,o){t.active=o;const s=this.getStyle(r,o);this._resolveAnimations(r,i,o).update(t,{options:!o&&this.getSharedOptions(s)||s})}removeHoverStyle(t,r,i){this._setStyle(t,i,"active",!1)}setHoverStyle(t,r,i){this._setStyle(t,i,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const r=this._data,i=this._cachedMeta.data;for(const[u,c,d]of this._syncList)this[u](c,d);this._syncList=[];const o=i.length,s=r.length,a=Math.min(s,o);a&&this.parse(0,a),s>o?this._insertElements(o,s-o,t):s<o&&this._removeElements(s,o-s)}_insertElements(t,r,i=!0){const o=this._cachedMeta,s=o.data,a=t+r;let u;const c=d=>{for(d.length+=r,u=d.length-1;u>=a;u--)d[u]=d[u-r]};for(c(s),u=t;u<a;++u)s[u]=new this.dataElementType;this._parsing&&c(o._parsed),this.parse(t,r),i&&this.updateElements(s,t,r,"reset")}updateElements(t,r,i,o){}_removeElements(t,r){const i=this._cachedMeta;if(this._parsing){const o=i._parsed.splice(t,r);i._stacked&&ng(i,o)}i.data.splice(t,r)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[r,i,o]=t;this[r](i,o)}}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,r){this._sync(["_removeElements",t,r]),this._sync(["_insertElements",t,arguments.length-2])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}return n.defaults={},n})();function ure(n){const e=n.iScale,t=function(n,e){if(!n._cache.$bar){const t=n.getMatchingVisibleMetas(e);let r=[];for(let i=0,o=t.length;i<o;i++)r=r.concat(t[i].controller.getAllParsedValues(n));n._cache.$bar=Jk(r.sort((i,o)=>i-o))}return n._cache.$bar}(e,n.type);let i,o,s,a,r=e._length;const u=()=>{32767===s||-32768===s||(Es(a)&&(r=Math.min(r,Math.abs(s-a)||r)),a=s)};for(i=0,o=t.length;i<o;++i)s=e.getPixelForValue(t[i]),u();for(a=void 0,i=0,o=e.ticks.length;i<o;++i)s=e.getPixelForTick(i),u();return r}function M4(n,e,t,r){return hr(n)?function(n,e,t,r){const i=t.parse(n[0],r),o=t.parse(n[1],r),s=Math.min(i,o),a=Math.max(i,o);let u=s,c=a;Math.abs(s)>Math.abs(a)&&(u=a,c=s),e[t.axis]=c,e._custom={barStart:u,barEnd:c,start:i,end:o,min:s,max:a}}(n,e,t,r):e[t.axis]=t.parse(n,r),e}function R4(n,e,t,r){const i=n.iScale,o=n.vScale,s=i.getLabels(),a=i===o,u=[];let c,d,p,m;for(c=t,d=t+r;c<d;++c)m=e[c],p={},p[i.axis]=a||i.parse(s[c],c),u.push(M4(m,p,o,c));return u}function b_(n){return n&&void 0!==n.barStart&&void 0!==n.barEnd}function pre(n,e,t,r){let i=e.borderSkipped;const o={};if(!i)return void(n.borderSkipped=o);const{start:s,end:a,reverse:u,top:c,bottom:d}=function(n){let e,t,r,i,o;return n.horizontal?(e=n.base>n.x,t="left",r="right"):(e=n.base<n.y,t="bottom",r="top"),e?(i="end",o="start"):(i="start",o="end"),{start:t,end:r,reverse:e,top:i,bottom:o}}(n);"middle"===i&&t&&(n.enableBorderRadius=!0,(t._top||0)===r?i=c:(t._bottom||0)===r?i=d:(o[N4(d,s,a,u)]=!0,i=c)),o[N4(i,s,a,u)]=!0,n.borderSkipped=o}function N4(n,e,t,r){return n=r?O4(n=function(n,e,t){return n===e?t:n===t?e:n}(n,e,t),t,e):O4(n,e,t)}function O4(n,e,t){return"start"===n?e:"end"===n?t:n}function mre(n,{inflateAmount:e},t){n.inflateAmount="auto"===e?1===t?.33:0:e}Bu.prototype.datasetElementType=null,Bu.prototype.dataElementType=null;let vre=(()=>{class n extends Bu{parsePrimitiveData(t,r,i,o){return R4(t,r,i,o)}parseArrayData(t,r,i,o){return R4(t,r,i,o)}parseObjectData(t,r,i,o){const{iScale:s,vScale:a}=t,{xAxisKey:u="x",yAxisKey:c="y"}=this._parsing,d="x"===s.axis?u:c,p="x"===a.axis?u:c,m=[];let y,w,C,_;for(y=i,w=i+o;y<w;++y)_=r[y],C={},C[s.axis]=s.parse(Rl(_,d),y),m.push(M4(Rl(_,p),C,a,y));return m}updateRangeFromParsed(t,r,i,o){super.updateRangeFromParsed(t,r,i,o);const s=i._custom;s&&r===this._cachedMeta.vScale&&(t.min=Math.min(t.min,s.min),t.max=Math.max(t.max,s.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const r=this._cachedMeta,{iScale:i,vScale:o}=r,s=this.getParsed(t),a=s._custom,u=b_(a)?"["+a.start+", "+a.end+"]":""+o.getLabelForValue(s[o.axis]);return{label:""+i.getLabelForValue(s[i.axis]),value:u}}initialize(){this.enableOptionSharing=!0,super.initialize(),this._cachedMeta.stack=this.getDataset().stack}update(t){const r=this._cachedMeta;this.updateElements(r.data,0,r.data.length,t)}updateElements(t,r,i,o){const s="reset"===o,{index:a,_cachedMeta:{vScale:u}}=this,c=u.getBasePixel(),d=u.isHorizontal(),p=this._getRuler(),m=this.resolveDataElementOptions(r,o),y=this.getSharedOptions(m),w=this.includeOptions(o,y);this.updateSharedOptions(y,o,m);for(let C=r;C<r+i;C++){const _=this.getParsed(C),A=s||Un(_[u.axis])?{base:c,head:c}:this._calculateBarValuePixels(C),T=this._calculateBarIndexPixels(C,p),N=(_._stacks||{})[u.axis],M={horizontal:d,base:A.base,enableBorderRadius:!N||b_(_._custom)||a===N._top||a===N._bottom,x:d?A.head:T.center,y:d?T.center:A.head,height:d?T.size:Math.abs(A.size),width:d?Math.abs(A.size):T.size};w&&(M.options=y||this.resolveDataElementOptions(C,t[C].active?"active":o));const O=M.options||t[C].options;pre(M,O,N,a),mre(M,O,p.ratio),this.updateElement(t[C],C,M,o)}}_getStacks(t,r){const o=this._cachedMeta.iScale,s=o.getMatchingVisibleMetas(this._type),a=o.options.stacked,u=s.length,c=[];let d,p;for(d=0;d<u;++d)if(p=s[d],p.controller.options.grouped){if(void 0!==r){const m=p.controller.getParsed(r)[p.controller._cachedMeta.vScale.axis];if(Un(m)||isNaN(m))continue}if((!1===a||-1===c.indexOf(p.stack)||void 0===a&&void 0===p.stack)&&c.push(p.stack),p.index===t)break}return c.length||c.push(void 0),c}_getStackCount(t){return this._getStacks(void 0,t).length}_getStackIndex(t,r,i){const o=this._getStacks(t,i),s=void 0!==r?o.indexOf(r):-1;return-1===s?o.length-1:s}_getRuler(){const t=this.options,r=this._cachedMeta,i=r.iScale,o=[];let s,a;for(s=0,a=r.data.length;s<a;++s)o.push(i.getPixelForValue(this.getParsed(s)[i.axis],s));const u=t.barThickness;return{min:u||ure(r),pixels:o,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:t.grouped,ratio:u?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:r,_stacked:i},options:{base:o,minBarLength:s}}=this,a=o||0,u=this.getParsed(t),c=u._custom,d=b_(c);let w,C,p=u[r.axis],m=0,y=i?this.applyStack(r,u,i):p;y!==p&&(m=y-p,y=p),d&&(p=c.barStart,y=c.barEnd-c.barStart,0!==p&&Za(p)!==Za(c.barEnd)&&(m=0),m+=p);const _=Un(o)||d?m:o;let A=r.getPixelForValue(_);if(w=this.chart.getDataVisibility(t)?r.getPixelForValue(m+y):A,C=w-A,Math.abs(C)<s&&(C=function(n,e,t){return 0!==n?Za(n):(e.isHorizontal()?1:-1)*(e.min>=t?1:-1)}(C,r,a)*s,p===a&&(A-=C/2),w=A+C),A===r.getPixelForValue(a)){const T=Za(C)*r.getLineWidthForValue(a)/2;A+=T,C-=T}return{size:C,base:A,head:w,center:w+C/2}}_calculateBarIndexPixels(t,r){const i=r.scale,o=this.options,s=o.skipNull,a=en(o.maxBarThickness,1/0);let u,c;if(r.grouped){const d=s?this._getStackCount(t):r.stackCount,p="flex"===o.barThickness?function(n,e,t,r){const i=e.pixels,o=i[n];let s=n>0?i[n-1]:null,a=n<i.length-1?i[n+1]:null;const u=t.categoryPercentage;null===s&&(s=o-(null===a?e.end-e.start:a-o)),null===a&&(a=o+o-s);const c=o-(o-Math.min(s,a))/2*u;return{chunk:Math.abs(a-s)/2*u/r,ratio:t.barPercentage,start:c}}(t,r,o,d):function(n,e,t,r){const i=t.barThickness;let o,s;return Un(i)?(o=e.min*t.categoryPercentage,s=t.barPercentage):(o=i*r,s=1),{chunk:o/r,ratio:s,start:e.pixels[n]-o/2}}(t,r,o,d),m=this._getStackIndex(this.index,this._cachedMeta.stack,s?t:void 0);u=p.start+p.chunk*m+p.chunk/2,c=Math.min(a,p.chunk*p.ratio)}else u=i.getPixelForValue(this.getParsed(t)[i.axis],t),c=Math.min(a,r.min*r.ratio);return{base:u-c/2,head:u+c/2,center:u,size:c}}draw(){const t=this._cachedMeta,r=t.vScale,i=t.data,o=i.length;let s=0;for(;s<o;++s)null!==this.getParsed(s)[r.axis]&&i[s].draw(this._ctx)}}return n.id="bar",n.defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}},n.overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}},n})(),yre=(()=>{class n extends Bu{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,r,i,o){const s=super.parsePrimitiveData(t,r,i,o);for(let a=0;a<s.length;a++)s[a]._custom=this.resolveDataElementOptions(a+i).radius;return s}parseArrayData(t,r,i,o){const s=super.parseArrayData(t,r,i,o);for(let a=0;a<s.length;a++)s[a]._custom=en(r[i+a][2],this.resolveDataElementOptions(a+i).radius);return s}parseObjectData(t,r,i,o){const s=super.parseObjectData(t,r,i,o);for(let a=0;a<s.length;a++){const u=r[i+a];s[a]._custom=en(u&&u.r&&+u.r,this.resolveDataElementOptions(a+i).radius)}return s}getMaxOverflow(){const t=this._cachedMeta.data;let r=0;for(let i=t.length-1;i>=0;--i)r=Math.max(r,t[i].size(this.resolveDataElementOptions(i))/2);return r>0&&r}getLabelAndValue(t){const r=this._cachedMeta,{xScale:i,yScale:o}=r,s=this.getParsed(t),a=i.getLabelForValue(s.x),u=o.getLabelForValue(s.y),c=s._custom;return{label:r.label,value:"("+a+", "+u+(c?", "+c:"")+")"}}update(t){const r=this._cachedMeta.data;this.updateElements(r,0,r.length,t)}updateElements(t,r,i,o){const s="reset"===o,{iScale:a,vScale:u}=this._cachedMeta,c=this.resolveDataElementOptions(r,o),d=this.getSharedOptions(c),p=this.includeOptions(o,d),m=a.axis,y=u.axis;for(let w=r;w<r+i;w++){const C=t[w],_=!s&&this.getParsed(w),A={},T=A[m]=s?a.getPixelForDecimal(.5):a.getPixelForValue(_[m]),N=A[y]=s?u.getBasePixel():u.getPixelForValue(_[y]);A.skip=isNaN(T)||isNaN(N),p&&(A.options=this.resolveDataElementOptions(w,C.active?"active":o),s&&(A.options.radius=0)),this.updateElement(C,w,A,o)}this.updateSharedOptions(d,o,c)}resolveDataElementOptions(t,r){const i=this.getParsed(t);let o=super.resolveDataElementOptions(t,r);o.$shared&&(o=Object.assign({},o,{$shared:!1}));const s=o.radius;return"active"!==r&&(o.radius=0),o.radius+=en(i&&i._custom,s),o}}return n.id="bubble",n.defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}},n.overrides={scales:{x:{type:"linear"},y:{type:"linear"}},plugins:{tooltip:{callbacks:{title:()=>""}}}},n})(),k4=(()=>{class n extends Bu{constructor(t,r){super(t,r),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,r){const i=this.getDataset().data,o=this._cachedMeta;if(!1===this._parsing)o._parsed=i;else{let a,u,s=c=>+i[c];if(vn(i[t])){const{key:c="value"}=this._parsing;s=d=>+Rl(i[d],c)}for(a=t,u=t+r;a<u;++a)o._parsed[a]=s(a)}}_getRotation(){return pa(this.options.rotation-90)}_getCircumference(){return pa(this.options.circumference)}_getRotationExtents(){let t=sr,r=-sr;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)){const o=this.chart.getDatasetMeta(i).controller,s=o._getRotation(),a=o._getCircumference();t=Math.min(t,s),r=Math.max(r,s+a)}return{rotation:t,circumference:r-t}}update(t){const r=this.chart,{chartArea:i}=r,o=this._cachedMeta,s=o.data,a=this.getMaxBorderWidth()+this.getMaxOffset(s)+this.options.spacing,u=Math.max((Math.min(i.width,i.height)-a)/2,0),c=Math.min(((n,e)=>"string"==typeof n&&n.endsWith("%")?parseFloat(n)/100:n/e)(this.options.cutout,u),1),d=this._getRingWeight(this.index),{circumference:p,rotation:m}=this._getRotationExtents(),{ratioX:y,ratioY:w,offsetX:C,offsetY:_}=function(n,e,t){let r=1,i=1,o=0,s=0;if(e<sr){const a=n,u=a+e,c=Math.cos(a),d=Math.sin(a),p=Math.cos(u),m=Math.sin(u),y=(N,M,O)=>_m(N,a,u,!0)?1:Math.max(M,M*t,O,O*t),w=(N,M,O)=>_m(N,a,u,!0)?-1:Math.min(M,M*t,O,O*t),C=y(0,c,p),_=y(ti,d,m),A=w(Xr,c,p),T=w(Xr+ti,d,m);r=(C-A)/2,i=(_-T)/2,o=-(C+A)/2,s=-(_+T)/2}return{ratioX:r,ratioY:i,offsetX:o,offsetY:s}}(m,p,c),N=Math.max(Math.min((i.width-a)/y,(i.height-a)/w)/2,0),M=Mk(this.options.radius,N),L=(M-Math.max(M*c,0))/this._getVisibleDatasetWeightTotal();this.offsetX=C*M,this.offsetY=_*M,o.total=this.calculateTotal(),this.outerRadius=M-L*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-L*d,0),this.updateElements(s,0,s.length,t)}_circumference(t,r){const i=this.options,o=this._cachedMeta,s=this._getCircumference();return r&&i.animation.animateRotate||!this.chart.getDataVisibility(t)||null===o._parsed[t]||o.data[t].hidden?0:this.calculateCircumference(o._parsed[t]*s/sr)}updateElements(t,r,i,o){const s="reset"===o,a=this.chart,u=a.chartArea,p=(u.left+u.right)/2,m=(u.top+u.bottom)/2,y=s&&a.options.animation.animateScale,w=y?0:this.innerRadius,C=y?0:this.outerRadius,_=this.resolveDataElementOptions(r,o),A=this.getSharedOptions(_),T=this.includeOptions(o,A);let M,N=this._getRotation();for(M=0;M<r;++M)N+=this._circumference(M,s);for(M=r;M<r+i;++M){const O=this._circumference(M,s),L=t[M],V={x:p+this.offsetX,y:m+this.offsetY,startAngle:N,endAngle:N+O,circumference:O,outerRadius:C,innerRadius:w};T&&(V.options=A||this.resolveDataElementOptions(M,L.active?"active":o)),N+=O,this.updateElement(L,M,V,o)}this.updateSharedOptions(A,o,_)}calculateTotal(){const t=this._cachedMeta,r=t.data;let o,i=0;for(o=0;o<r.length;o++){const s=t._parsed[o];null!==s&&!isNaN(s)&&this.chart.getDataVisibility(o)&&!r[o].hidden&&(i+=Math.abs(s))}return i}calculateCircumference(t){const r=this._cachedMeta.total;return r>0&&!isNaN(t)?sr*(Math.abs(t)/r):0}getLabelAndValue(t){const i=this.chart,o=i.data.labels||[],s=tg(this._cachedMeta._parsed[t],i.options.locale);return{label:o[t]||"",value:s}}getMaxBorderWidth(t){let r=0;const i=this.chart;let o,s,a,u,c;if(!t)for(o=0,s=i.data.datasets.length;o<s;++o)if(i.isDatasetVisible(o)){a=i.getDatasetMeta(o),t=a.data,u=a.controller,u!==this&&u.configure();break}if(!t)return 0;for(o=0,s=t.length;o<s;++o)c=u.resolveDataElementOptions(o),"inner"!==c.borderAlign&&(r=Math.max(r,c.borderWidth||0,c.hoverBorderWidth||0));return r}getMaxOffset(t){let r=0;for(let i=0,o=t.length;i<o;++i){const s=this.resolveDataElementOptions(i);r=Math.max(r,s.offset||0,s.hoverOffset||0)}return r}_getRingWeightOffset(t){let r=0;for(let i=0;i<t;++i)this.chart.isDatasetVisible(i)&&(r+=this._getRingWeight(i));return r}_getRingWeight(t){return Math.max(en(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}return n.id="doughnut",n.defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"},n.descriptors={_scriptable:e=>"spacing"!==e,_indexable:e=>"spacing"!==e},n.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:r}}=e.legend.options;return t.labels.map((i,o)=>{const a=e.getDatasetMeta(0).controller.getStyle(o);return{text:i,fillStyle:a.backgroundColor,strokeStyle:a.borderColor,lineWidth:a.borderWidth,pointStyle:r,hidden:!e.getDataVisibility(o),index:o}})}return[]}},onClick(e,t,r){r.chart.toggleDataVisibility(t.index),r.chart.update()}},tooltip:{callbacks:{title:()=>"",label(e){let t=e.label;const r=": "+e.formattedValue;return hr(t)?(t=t.slice(),t[0]+=r):t+=r,t}}}}},n})(),P4=(()=>{class n extends Bu{initialize(){this.enableOptionSharing=!0,super.initialize()}update(t){const r=this._cachedMeta,{dataset:i,data:o=[],_dataset:s}=r,a=this.chart._animationsDisabled;let{start:u,count:c}=function(n,e,t){const r=e.length;let i=0,o=r;if(n._sorted){const{iScale:s,_parsed:a}=n,u=s.axis,{min:c,max:d,minDefined:p,maxDefined:m}=s.getUserBounds();p&&(i=Li(Math.min(Fu(a,s.axis,c).lo,t?r:Fu(e,u,s.getPixelForValue(c)).lo),0,r-1)),o=m?Li(Math.max(Fu(a,s.axis,d).hi+1,t?0:Fu(e,u,s.getPixelForValue(d)).hi+1),i,r)-i:r-i}return{start:i,count:o}}(r,o,a);this._drawStart=u,this._drawCount=c,function(n){const{xScale:e,yScale:t,_scaleRanges:r}=n,i={xmin:e.min,xmax:e.max,ymin:t.min,ymax:t.max};if(!r)return n._scaleRanges=i,!0;const o=r.xmin!==e.min||r.xmax!==e.max||r.ymin!==t.min||r.ymax!==t.max;return Object.assign(r,i),o}(r)&&(u=0,c=o.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!s._decimated,i.points=o;const d=this.resolveDatasetElementOptions(t);this.options.showLine||(d.borderWidth=0),d.segment=this.options.segment,this.updateElement(i,void 0,{animated:!a,options:d},t),this.updateElements(o,u,c,t)}updateElements(t,r,i,o){const s="reset"===o,{iScale:a,vScale:u,_stacked:c,_dataset:d}=this._cachedMeta,p=this.resolveDataElementOptions(r,o),m=this.getSharedOptions(p),y=this.includeOptions(o,m),w=a.axis,C=u.axis,{spanGaps:_,segment:A}=this.options,T=Id(_)?_:Number.POSITIVE_INFINITY,N=this.chart._animationsDisabled||s||"none"===o;let M=r>0&&this.getParsed(r-1);for(let O=r;O<r+i;++O){const L=t[O],V=this.getParsed(O),j=N?L:{},U=Un(V[C]),G=j[w]=a.getPixelForValue(V[w],O),K=j[C]=s||U?u.getBasePixel():u.getPixelForValue(c?this.applyStack(u,V,c):V[C],O);j.skip=isNaN(G)||isNaN(K)||U,j.stop=O>0&&V[w]-M[w]>T,A&&(j.parsed=V,j.raw=d.data[O]),y&&(j.options=m||this.resolveDataElementOptions(O,L.active?"active":o)),N||this.updateElement(L,O,j,o),M=V}this.updateSharedOptions(m,o,p)}getMaxOverflow(){const t=this._cachedMeta,r=t.dataset,i=r.options&&r.options.borderWidth||0,o=t.data||[];if(!o.length)return i;const s=o[0].size(this.resolveDataElementOptions(0)),a=o[o.length-1].size(this.resolveDataElementOptions(o.length-1));return Math.max(i,s,a)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}return n.id="line",n.defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1},n.overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}},n})();var _re=Object.freeze({__proto__:null,BarController:vre,BubbleController:yre,DoughnutController:k4,LineController:P4,PolarAreaController:(()=>{class n extends Bu{constructor(t,r){super(t,r),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const i=this.chart,o=i.data.labels||[],s=tg(this._cachedMeta._parsed[t].r,i.options.locale);return{label:o[t]||"",value:s}}update(t){const r=this._cachedMeta.data;this._updateRadius(),this.updateElements(r,0,r.length,t)}_updateRadius(){const t=this.chart,r=t.chartArea,i=t.options,o=Math.min(r.right-r.left,r.bottom-r.top),s=Math.max(o/2,0),u=(s-Math.max(i.cutoutPercentage?s/100*i.cutoutPercentage:1,0))/t.getVisibleDatasetCount();this.outerRadius=s-u*this.index,this.innerRadius=this.outerRadius-u}updateElements(t,r,i,o){const s="reset"===o,a=this.chart,u=this.getDataset(),d=a.options.animation,p=this._cachedMeta.rScale,m=p.xCenter,y=p.yCenter,w=p.getIndexAngle(0)-.5*Xr;let _,C=w;const A=360/this.countVisibleElements();for(_=0;_<r;++_)C+=this._computeAngle(_,o,A);for(_=r;_<r+i;_++){const T=t[_];let N=C,M=C+this._computeAngle(_,o,A),O=a.getDataVisibility(_)?p.getDistanceFromCenterForValue(u.data[_]):0;C=M,s&&(d.animateScale&&(O=0),d.animateRotate&&(N=M=w));const L={x:m,y,innerRadius:0,outerRadius:O,startAngle:N,endAngle:M,options:this.resolveDataElementOptions(_,T.active?"active":o)};this.updateElement(T,_,L,o)}}countVisibleElements(){const t=this.getDataset();let i=0;return this._cachedMeta.data.forEach((o,s)=>{!isNaN(t.data[s])&&this.chart.getDataVisibility(s)&&i++}),i}_computeAngle(t,r,i){return this.chart.getDataVisibility(t)?pa(this.resolveDataElementOptions(t,r).angle||i):0}}return n.id="polarArea",n.defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0},n.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:r}}=e.legend.options;return t.labels.map((i,o)=>{const a=e.getDatasetMeta(0).controller.getStyle(o);return{text:i,fillStyle:a.backgroundColor,strokeStyle:a.borderColor,lineWidth:a.borderWidth,pointStyle:r,hidden:!e.getDataVisibility(o),index:o}})}return[]}},onClick(e,t,r){r.chart.toggleDataVisibility(t.index),r.chart.update()}},tooltip:{callbacks:{title:()=>"",label:e=>e.chart.data.labels[e.dataIndex]+": "+e.formattedValue}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}},n})(),PieController:(()=>{class n extends k4{}return n.id="pie",n.defaults={cutout:0,rotation:0,circumference:360,radius:"100%"},n})(),RadarController:(()=>{class n extends Bu{getLabelAndValue(t){const r=this._cachedMeta.vScale,i=this.getParsed(t);return{label:r.getLabels()[t],value:""+r.getLabelForValue(i[r.axis])}}update(t){const r=this._cachedMeta,i=r.dataset,o=r.data||[],s=r.iScale.getLabels();if(i.points=o,"resize"!==t){const a=this.resolveDatasetElementOptions(t);this.options.showLine||(a.borderWidth=0),this.updateElement(i,void 0,{_loop:!0,_fullLoop:s.length===o.length,options:a},t)}this.updateElements(o,0,o.length,t)}updateElements(t,r,i,o){const s=this.getDataset(),a=this._cachedMeta.rScale,u="reset"===o;for(let c=r;c<r+i;c++){const d=t[c],p=this.resolveDataElementOptions(c,d.active?"active":o),m=a.getPointPositionForValue(c,s.data[c]),y=u?a.xCenter:m.x,w=u?a.yCenter:m.y,C={x:y,y:w,angle:m.angle,skip:isNaN(y)||isNaN(w),options:p};this.updateElement(d,c,C,o)}}}return n.id="radar",n.defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}},n.overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}},n})(),ScatterController:(()=>{class n extends P4{}return n.id="scatter",n.defaults={showLine:!1,fill:!1},n.overrides={interaction:{mode:"point"},plugins:{tooltip:{callbacks:{title:()=>"",label:e=>"("+e.label+", "+e.formattedValue+")"}}},scales:{x:{type:"linear"},y:{type:"linear"}}},n})()});function Bl(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}var Cre={_date:(()=>{class n{constructor(t){this.options=t||{}}formats(){return Bl()}parse(t,r){return Bl()}format(t,r){return Bl()}add(t,r,i){return Bl()}diff(t,r,i){return Bl()}startOf(t,r,i){return Bl()}endOf(t,r){return Bl()}}return n.override=function(e){Object.assign(n.prototype,e)},n})()};function rg(n,e){return"native"in n?{x:n.x,y:n.y}:c4(n,e)}function Ire(n,e,t,r){const{controller:i,data:o,_sorted:s}=n,a=i._cachedMeta.iScale;if(a&&e===a.axis&&s&&o.length){const u=a._reversePixels?ane:Fu;if(!r)return u(o,e,t);if(i._sharedOptions){const c=o[0],d="function"==typeof c.getRange&&c.getRange(e);if(d){const p=u(o,e,t-d),m=u(o,e,t+d);return{lo:p.lo,hi:m.hi}}}}return{lo:0,hi:o.length-1}}function F4(n,e,t,r,i){const o=n.getSortedVisibleDatasetMetas(),s=t[e];for(let a=0,u=o.length;a<u;++a){const{index:c,data:d}=o[a],{lo:p,hi:m}=Ire(o[a],e,s,i);for(let y=p;y<=m;++y){const w=d[y];w.skip||r(w,c,y)}}}function w_(n,e,t,r){const i=[];return kl(e,n.chartArea,n._minPadding)&&F4(n,t,e,function(s,a,u){s.inRange(e.x,e.y,r)&&i.push({element:s,datasetIndex:a,index:u})},!0),i}function __(n,e,t,r,i){const o=function(n){const e=-1!==n.indexOf("x"),t=-1!==n.indexOf("y");return function(r,i){const o=e?Math.abs(r.x-i.x):0,s=t?Math.abs(r.y-i.y):0;return Math.sqrt(Math.pow(o,2)+Math.pow(s,2))}}(t);let s=Number.POSITIVE_INFINITY,a=[];return kl(e,n.chartArea,n._minPadding)&&F4(n,t,e,function(c,d,p){if(r&&!c.inRange(e.x,e.y,i))return;const m=c.getCenterPoint(i);if(!kl(m,n.chartArea,n._minPadding)&&!c.inRange(e.x,e.y,i))return;const y=o(e,m);y<s?(a=[{element:c,datasetIndex:d,index:p}],s=y):y===s&&a.push({element:c,datasetIndex:d,index:p})}),a}function L4(n,e,t,r){const i=rg(e,n),o=[],s=t.axis,a="x"===s?"inXRange":"inYRange";let u=!1;return function(n,e){const t=n.getSortedVisibleDatasetMetas();let r,i,o;for(let s=0,a=t.length;s<a;++s){({index:r,data:i}=t[s]);for(let u=0,c=i.length;u<c;++u)o=i[u],o.skip||e(o,r,u)}}(n,(c,d,p)=>{c[a](i[s],r)&&o.push({element:c,datasetIndex:d,index:p}),c.inRange(i.x,i.y,r)&&(u=!0)}),t.intersect&&!u?[]:o}var Dre={modes:{index(n,e,t,r){const i=rg(e,n),o=t.axis||"x",s=t.intersect?w_(n,i,o,r):__(n,i,o,!1,r),a=[];return s.length?(n.getSortedVisibleDatasetMetas().forEach(u=>{const c=s[0].index,d=u.data[c];d&&!d.skip&&a.push({element:d,datasetIndex:u.index,index:c})}),a):[]},dataset(n,e,t,r){const i=rg(e,n),o=t.axis||"xy";let s=t.intersect?w_(n,i,o,r):__(n,i,o,!1,r);if(s.length>0){const a=s[0].datasetIndex,u=n.getDatasetMeta(a).data;s=[];for(let c=0;c<u.length;++c)s.push({element:u[c],datasetIndex:a,index:c})}return s},point:(n,e,t,r)=>w_(n,rg(e,n),t.axis||"xy",r),nearest:(n,e,t,r)=>__(n,rg(e,n),t.axis||"xy",t.intersect,r),x:(n,e,t,r)=>(t.axis="x",L4(n,e,t,r)),y:(n,e,t,r)=>(t.axis="y",L4(n,e,t,r))}};const B4=["left","top","right","bottom"];function ig(n,e){return n.filter(t=>t.pos===e)}function V4(n,e){return n.filter(t=>-1===B4.indexOf(t.pos)&&t.box.axis===e)}function og(n,e){return n.sort((t,r)=>{const i=e?r:t,o=e?t:r;return i.weight===o.weight?i.index-o.index:i.weight-o.weight})}function U4(n,e,t,r){return Math.max(n[t],e[t])+Math.max(n[r],e[r])}function j4(n,e){n.top=Math.max(n.top,e.top),n.left=Math.max(n.left,e.left),n.bottom=Math.max(n.bottom,e.bottom),n.right=Math.max(n.right,e.right)}function Nre(n,e,t,r){const{pos:i,box:o}=t,s=n.maxPadding;if(!vn(i)){t.size&&(n[i]-=t.size);const p=r[t.stack]||{size:0,count:1};p.size=Math.max(p.size,t.horizontal?o.height:o.width),t.size=p.size/p.count,n[i]+=t.size}o.getPadding&&j4(s,o.getPadding());const a=Math.max(0,e.outerWidth-U4(s,n,"left","right")),u=Math.max(0,e.outerHeight-U4(s,n,"top","bottom")),c=a!==n.w,d=u!==n.h;return n.w=a,n.h=u,t.horizontal?{same:c,other:d}:{same:d,other:c}}function kre(n,e){const t=e.maxPadding;return function(i){const o={left:0,top:0,right:0,bottom:0};return i.forEach(s=>{o[s]=Math.max(e[s],t[s])}),o}(n?["left","right"]:["top","bottom"])}function sg(n,e,t,r){const i=[];let o,s,a,u,c,d;for(o=0,s=n.length,c=0;o<s;++o){a=n[o],u=a.box,u.update(a.width||e.w,a.height||e.h,kre(a.horizontal,e));const{same:p,other:m}=Nre(e,t,a,r);c|=p&&i.length,d=d||m,u.fullSize||i.push(a)}return c&&sg(i,e,t,r)||d}function Lm(n,e,t,r,i){n.top=t,n.left=e,n.right=e+r,n.bottom=t+i,n.width=r,n.height=i}function W4(n,e,t,r){const i=t.padding;let{x:o,y:s}=e;for(const a of n){const u=a.box,c=r[a.stack]||{count:1,placed:0,weight:1},d=a.stackWeight/c.weight||1;if(a.horizontal){const p=e.w*d,m=c.size||u.height;Es(c.start)&&(s=c.start),u.fullSize?Lm(u,i.left,s,t.outerWidth-i.right-i.left,m):Lm(u,e.left+c.placed,s,p,m),c.start=s,c.placed+=p,s=u.bottom}else{const p=e.h*d,m=c.size||u.width;Es(c.start)&&(o=c.start),u.fullSize?Lm(u,o,i.top,m,t.outerHeight-i.bottom-i.top):Lm(u,o,e.top+c.placed,m,p),c.start=o,c.placed+=p,o=u.right}}e.x=o,e.y=s}bn.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}});var co={addBox(n,e){n.boxes||(n.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},n.boxes.push(e)},removeBox(n,e){const t=n.boxes?n.boxes.indexOf(e):-1;-1!==t&&n.boxes.splice(t,1)},configure(n,e,t){e.fullSize=t.fullSize,e.position=t.position,e.weight=t.weight},update(n,e,t,r){if(!n)return;const i=Io(n.options.layout.padding),o=Math.max(e-i.width,0),s=Math.max(t-i.height,0),a=function(n){const e=function(n){const e=[];let t,r,i,o,s,a;for(t=0,r=(n||[]).length;t<r;++t)i=n[t],({position:o,options:{stack:s,stackWeight:a=1}}=i),e.push({index:t,box:i,pos:o,horizontal:i.isHorizontal(),weight:i.weight,stack:s&&o+s,stackWeight:a});return e}(n),t=og(e.filter(c=>c.box.fullSize),!0),r=og(ig(e,"left"),!0),i=og(ig(e,"right")),o=og(ig(e,"top"),!0),s=og(ig(e,"bottom")),a=V4(e,"x"),u=V4(e,"y");return{fullSize:t,leftAndTop:r.concat(o),rightAndBottom:i.concat(u).concat(s).concat(a),chartArea:ig(e,"chartArea"),vertical:r.concat(i).concat(u),horizontal:o.concat(s).concat(a)}}(n.boxes),u=a.vertical,c=a.horizontal;Zn(n.boxes,C=>{"function"==typeof C.beforeLayout&&C.beforeLayout()});const d=u.reduce((C,_)=>_.box.options&&!1===_.box.options.display?C:C+1,0)||1,p=Object.freeze({outerWidth:e,outerHeight:t,padding:i,availableWidth:o,availableHeight:s,vBoxMaxWidth:o/2/d,hBoxMaxHeight:s/2}),m=Object.assign({},i);j4(m,Io(r));const y=Object.assign({maxPadding:m,w:o,h:s,x:i.left,y:i.top},i),w=function(n,e){const t=function(n){const e={};for(const t of n){const{stack:r,pos:i,stackWeight:o}=t;if(!r||!B4.includes(i))continue;const s=e[r]||(e[r]={count:0,placed:0,weight:0,size:0});s.count++,s.weight+=o}return e}(n),{vBoxMaxWidth:r,hBoxMaxHeight:i}=e;let o,s,a;for(o=0,s=n.length;o<s;++o){a=n[o];const{fullSize:u}=a.box,c=t[a.stack],d=c&&a.stackWeight/c.weight;a.horizontal?(a.width=d?d*r:u&&e.availableWidth,a.height=i):(a.width=r,a.height=d?d*i:u&&e.availableHeight)}return t}(u.concat(c),p);sg(a.fullSize,y,p,w),sg(u,y,p,w),sg(c,y,p,w)&&sg(u,y,p,w),function(n){const e=n.maxPadding;function t(r){const i=Math.max(e[r]-n[r],0);return n[r]+=i,i}n.y+=t("top"),n.x+=t("left"),t("right"),t("bottom")}(y),W4(a.leftAndTop,y,p,w),y.x+=y.w,y.y+=y.h,W4(a.rightAndBottom,y,p,w),n.chartArea={left:y.left,top:y.top,right:y.left+y.w,bottom:y.top+y.h,height:y.h,width:y.w},Zn(a.chartArea,C=>{const _=C.box;Object.assign(_,n.chartArea),_.update(y.w,y.h)})}};class H4{acquireContext(e,t){}releaseContext(e){return!1}addEventListener(e,t,r){}removeEventListener(e,t,r){}getDevicePixelRatio(){return 1}getMaximumSize(e,t,r,i){return t=Math.max(0,t||e.width),r=r||e.height,{width:t,height:Math.max(0,i?Math.floor(t/i):r)}}isAttached(e){return!0}updateConfig(e){}}class Pre extends H4{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const Bm="$chartjs",Fre={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},z4=n=>null===n||""===n,G4=!!Nne&&{passive:!0};function Vre(n,e,t){n.canvas.removeEventListener(e,t,G4)}function jre(n,e,t){const r=n.canvas,i=new MutationObserver(o=>{for(const s of o)for(const a of s.addedNodes)if(a===r||a.contains(r))return t()});return i.observe(document,{childList:!0,subtree:!0}),i}function Wre(n,e,t){const r=n.canvas,i=new MutationObserver(o=>{for(const s of o)for(const a of s.removedNodes)if(a===r||a.contains(r))return t()});return i.observe(document,{childList:!0,subtree:!0}),i}const ag=new Map;let Y4=0;function X4(){const n=window.devicePixelRatio;n!==Y4&&(Y4=n,ag.forEach((e,t)=>{t.currentDevicePixelRatio!==n&&e()}))}function Gre(n,e,t){const r=n.canvas,i=r&&m_(r);if(!i)return;const o=Tk((a,u)=>{const c=i.clientWidth;t(a,u),c<i.clientWidth&&t()},window),s=new ResizeObserver(a=>{const u=a[0],c=u.contentRect.width,d=u.contentRect.height;0===c&&0===d||o(c,d)});return s.observe(i),function(n,e){ag.size||window.addEventListener("resize",X4),ag.set(n,e)}(n,o),s}function C_(n,e,t){t&&t.disconnect(),"resize"===e&&function(n){ag.delete(n),ag.size||window.removeEventListener("resize",X4)}(n)}function Yre(n,e,t){const r=n.canvas,i=Tk(o=>{null!==n.ctx&&t(function(n,e){const t=Fre[n.type]||n.type,{x:r,y:i}=c4(n,e);return{type:t,chart:e,native:n,x:void 0!==r?r:null,y:void 0!==i?i:null}}(o,n))},n,o=>{const s=o[0];return[s,s.offsetX,s.offsetY]});return function(n,e,t){n.addEventListener(e,t,G4)}(r,e,i),i}class Xre extends H4{acquireContext(e,t){const r=e&&e.getContext&&e.getContext("2d");return r&&r.canvas===e?(function(n,e){const t=n.style,r=n.getAttribute("height"),i=n.getAttribute("width");if(n[Bm]={initial:{height:r,width:i,style:{display:t.display,height:t.height,width:t.width}}},t.display=t.display||"block",t.boxSizing=t.boxSizing||"border-box",z4(i)){const o=h4(n,"width");void 0!==o&&(n.width=o)}if(z4(r))if(""===n.style.height)n.height=n.width/(e||2);else{const o=h4(n,"height");void 0!==o&&(n.height=o)}}(e,t),r):null}releaseContext(e){const t=e.canvas;if(!t[Bm])return!1;const r=t[Bm].initial;["height","width"].forEach(o=>{const s=r[o];Un(s)?t.removeAttribute(o):t.setAttribute(o,s)});const i=r.style||{};return Object.keys(i).forEach(o=>{t.style[o]=i[o]}),t.width=t.width,delete t[Bm],!0}addEventListener(e,t,r){this.removeEventListener(e,t),(e.$proxies||(e.$proxies={}))[t]=({attach:jre,detach:Wre,resize:Gre}[t]||Yre)(e,t,r)}removeEventListener(e,t){const r=e.$proxies||(e.$proxies={}),i=r[t];i&&(({attach:C_,detach:C_,resize:C_}[t]||Vre)(e,t,i),r[t]=void 0)}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,t,r,i){return function(n,e,t,r){const i=Fm(n),o=Fl(i,"margin"),s=Pm(i.maxWidth,n,"clientWidth")||wm,a=Pm(i.maxHeight,n,"clientHeight")||wm,u=function(n,e,t){let r,i;if(void 0===e||void 0===t){const o=m_(n);if(o){const s=o.getBoundingClientRect(),a=Fm(o),u=Fl(a,"border","width"),c=Fl(a,"padding");e=s.width-c.width-u.width,t=s.height-c.height-u.height,r=Pm(a.maxWidth,o,"clientWidth"),i=Pm(a.maxHeight,o,"clientHeight")}else e=n.clientWidth,t=n.clientHeight}return{width:e,height:t,maxWidth:r||wm,maxHeight:i||wm}}(n,e,t);let{width:c,height:d}=u;if("content-box"===i.boxSizing){const p=Fl(i,"border","width"),m=Fl(i,"padding");c-=m.width+p.width,d-=m.height+p.height}return c=Math.max(0,c-o.width),d=Math.max(0,r?Math.floor(c/r):d-o.height),c=v_(Math.min(c,s,u.maxWidth)),d=v_(Math.min(d,a,u.maxHeight)),c&&!d&&(d=v_(c/2)),{width:c,height:d}}(e,t,r,i)}isAttached(e){const t=m_(e);return!(!t||!t.isConnected)}}class ma{constructor(){this.x=void 0,this.y=void 0,this.active=!1,this.options=void 0,this.$animations=void 0}tooltipPosition(e){const{x:t,y:r}=this.getProps(["x","y"],e);return{x:t,y:r}}hasValue(){return Id(this.x)&&Id(this.y)}getProps(e,t){const r=this.$animations;if(!t||!r)return this;const i={};return e.forEach(o=>{i[o]=r[o]&&r[o].active()?r[o]._to:this[o]}),i}}ma.defaults={},ma.defaultRoutes=void 0;const q4={values:n=>hr(n)?n:""+n,numeric(n,e,t){if(0===n)return"0";const r=this.chart.options.locale;let i,o=n;if(t.length>1){const c=Math.max(Math.abs(t[0].value),Math.abs(t[t.length-1].value));(c<1e-4||c>1e15)&&(i="scientific"),o=function(n,e){let t=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(t)>=1&&n!==Math.floor(n)&&(t=n-Math.floor(n)),t}(n,t)}const s=Is(Math.abs(o)),a=Math.max(Math.min(-1*Math.floor(s),20),0),u={notation:i,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(u,this.options.ticks.format),tg(n,r,u)},logarithmic(n,e,t){if(0===n)return"0";const r=n/Math.pow(10,Math.floor(Is(n)));return 1===r||2===r||5===r?q4.numeric.call(this,n,e,t):""}};var Vm={formatters:q4};function Um(n,e,t,r,i){const o=en(r,0),s=Math.min(en(i,n.length),n.length);let u,c,d,a=0;for(t=Math.ceil(t),i&&(u=i-r,t=u/Math.floor(u/t)),d=o;d<0;)a++,d=Math.round(o+a*t);for(c=Math.max(o,0);c<s;c++)c===d&&(e.push(n[c]),a++,d=Math.round(o+a*t))}bn.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(n,e)=>e.lineWidth,tickColor:(n,e)=>e.color,offset:!1,borderDash:[],borderDashOffset:0,borderWidth:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Vm.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),bn.route("scale.ticks","color","","color"),bn.route("scale.grid","color","","borderColor"),bn.route("scale.grid","borderColor","","borderColor"),bn.route("scale.title","color","","color"),bn.describe("scale",{_fallback:!1,_scriptable:n=>!n.startsWith("before")&&!n.startsWith("after")&&"callback"!==n&&"parser"!==n,_indexable:n=>"borderDash"!==n&&"tickBorderDash"!==n}),bn.describe("scales",{_fallback:"scale"}),bn.describe("scale.ticks",{_scriptable:n=>"backdropPadding"!==n&&"callback"!==n,_indexable:n=>"backdropPadding"!==n});const $4=(n,e,t)=>"top"===e||"left"===e?n[e]+t:n[e]-t;function K4(n,e){const t=[],r=n.length/e,i=n.length;let o=0;for(;o<i;o+=r)t.push(n[Math.floor(o)]);return t}function rie(n,e,t){const r=n.ticks.length,i=Math.min(e,r-1),o=n._startPixel,s=n._endPixel,a=1e-6;let c,u=n.getPixelForTick(i);if(!(t&&(c=1===r?Math.max(u-o,s-u):0===e?(n.getPixelForTick(1)-u)/2:(u-n.getPixelForTick(i-1))/2,u+=i<e?c:-c,u<o-a||u>s+a)))return u}function ug(n){return n.drawTicks?n.tickLength:0}function Q4(n,e){if(!n.display)return 0;const t=Ai(n.font,e),r=Io(n.padding);return(hr(n.text)?n.text.length:1)*t.lineHeight+r.height}function aie(n,e,t){let r=e_(n);return(t&&"right"!==e||!t&&"right"===e)&&(r=(n=>"left"===n?"right":"right"===n?"left":n)(r)),r}class Vl extends ma{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,t){return e}getUserBounds(){let{_userMin:e,_userMax:t,_suggestedMin:r,_suggestedMax:i}=this;return e=Cs(e,Number.POSITIVE_INFINITY),t=Cs(t,Number.NEGATIVE_INFINITY),r=Cs(r,Number.POSITIVE_INFINITY),i=Cs(i,Number.NEGATIVE_INFINITY),{min:Cs(e,r),max:Cs(t,i),minDefined:ei(e),maxDefined:ei(t)}}getMinMax(e){let s,{min:t,max:r,minDefined:i,maxDefined:o}=this.getUserBounds();if(i&&o)return{min:t,max:r};const a=this.getMatchingVisibleMetas();for(let u=0,c=a.length;u<c;++u)s=a[u].controller.getMinMax(this,e),i||(t=Math.min(t,s.min)),o||(r=Math.max(r,s.max));return t=o&&t>r?r:t,r=i&&t>r?t:r,{min:Cs(t,Cs(r,t)),max:Cs(r,Cs(t,r))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){dr(this.options.beforeUpdate,[this])}update(e,t,r){const{beginAtZero:i,grace:o,ticks:s}=this.options,a=s.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=t,this._margins=r=Object.assign({left:0,right:0,top:0,bottom:0},r),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+r.left+r.right:this.height+r.top+r.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function(n,e,t){const{min:r,max:i}=n,o=Mk(e,(i-r)/2),s=(a,u)=>t&&0===a?0:a+u;return{min:s(r,-Math.abs(o)),max:s(i,o)}}(this,o,i),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const u=a<this.ticks.length;this._convertTicksToLabels(u?K4(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),s.display&&(s.autoSkip||"auto"===s.source)&&(this.ticks=function(n,e){const t=n.options.ticks,r=t.maxTicksLimit||function(n){const e=n.options.offset,t=n._tickSize();return Math.floor(Math.min(n._length/t+(e?0:1),n._maxLength/t))}(n),i=t.major.enabled?function(n){const e=[];let t,r;for(t=0,r=n.length;t<r;t++)n[t].major&&e.push(t);return e}(e):[],o=i.length,s=i[0],a=i[o-1],u=[];if(o>r)return function(n,e,t,r){let s,i=0,o=t[0];for(r=Math.ceil(r),s=0;s<n.length;s++)s===o&&(e.push(n[s]),i++,o=t[i*r])}(e,u,i,o/r),u;const c=function(n,e,t){const r=function(n){const e=n.length;let t,r;if(e<2)return!1;for(r=n[0],t=1;t<e;++t)if(n[t]-n[t-1]!==r)return!1;return r}(n),i=e.length/t;if(!r)return Math.max(i,1);const o=function(n){const e=[],t=Math.sqrt(n);let r;for(r=1;r<t;r++)n%r==0&&(e.push(r),e.push(n/r));return t===(0|t)&&e.push(t),e.sort((i,o)=>i-o).pop(),e}(r);for(let s=0,a=o.length-1;s<a;s++){const u=o[s];if(u>i)return u}return Math.max(i,1)}(i,e,r);if(o>0){let d,p;const m=o>1?Math.round((a-s)/(o-1)):null;for(Um(e,u,c,Un(m)?0:s-m,s),d=0,p=o-1;d<p;d++)Um(e,u,c,i[d],i[d+1]);return Um(e,u,c,a,Un(m)?e.length:a+m),u}return Um(e,u,c),u}(this,this.ticks),this._labelSizes=null),u&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t,r,e=this.options.reverse;this.isHorizontal()?(t=this.left,r=this.right):(t=this.top,r=this.bottom,e=!e),this._startPixel=t,this._endPixel=r,this._reversePixels=e,this._length=r-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){dr(this.options.afterUpdate,[this])}beforeSetDimensions(){dr(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){dr(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),dr(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){dr(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const t=this.options.ticks;let r,i,o;for(r=0,i=e.length;r<i;r++)o=e[r],o.label=dr(t.callback,[o.value,r,e],this)}afterTickToLabelConversion(){dr(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){dr(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,t=e.ticks,r=this.ticks.length,i=t.minRotation||0,o=t.maxRotation;let a,u,c,s=i;if(!this._isVisible()||!t.display||i>=o||r<=1||!this.isHorizontal())return void(this.labelRotation=i);const d=this._getLabelSizes(),p=d.widest.width,m=d.highest.height,y=Li(this.chart.width-p,0,this.maxWidth);a=e.offset?this.maxWidth/r:y/(r-1),p+6>a&&(a=y/(r-(e.offset?.5:1)),u=this.maxHeight-ug(e.grid)-t.padding-Q4(e.title,this.chart.options.font),c=Math.sqrt(p*p+m*m),s=n_(Math.min(Math.asin(Li((d.highest.height+6)/a,-1,1)),Math.asin(Li(u/c,-1,1))-Math.asin(Li(m/c,-1,1)))),s=Math.max(i,Math.min(o,s))),this.labelRotation=s}afterCalculateLabelRotation(){dr(this.options.afterCalculateLabelRotation,[this])}beforeFit(){dr(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:t,options:{ticks:r,title:i,grid:o}}=this,s=this._isVisible(),a=this.isHorizontal();if(s){const u=Q4(i,t.options.font);if(a?(e.width=this.maxWidth,e.height=ug(o)+u):(e.height=this.maxHeight,e.width=ug(o)+u),r.display&&this.ticks.length){const{first:c,last:d,widest:p,highest:m}=this._getLabelSizes(),y=2*r.padding,w=pa(this.labelRotation),C=Math.cos(w),_=Math.sin(w);a?e.height=Math.min(this.maxHeight,e.height+(r.mirror?0:_*p.width+C*m.height)+y):e.width=Math.min(this.maxWidth,e.width+(r.mirror?0:C*p.width+_*m.height)+y),this._calculatePadding(c,d,_,C)}}this._handleMargins(),a?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,t,r,i){const{ticks:{align:o,padding:s},position:a}=this.options,u=0!==this.labelRotation,c="top"!==a&&"x"===this.axis;if(this.isHorizontal()){const d=this.getPixelForTick(0)-this.left,p=this.right-this.getPixelForTick(this.ticks.length-1);let m=0,y=0;u?c?(m=i*e.width,y=r*t.height):(m=r*e.height,y=i*t.width):"start"===o?y=t.width:"end"===o?m=e.width:(m=e.width/2,y=t.width/2),this.paddingLeft=Math.max((m-d+s)*this.width/(this.width-d),0),this.paddingRight=Math.max((y-p+s)*this.width/(this.width-p),0)}else{let d=t.height/2,p=e.height/2;"start"===o?(d=0,p=e.height):"end"===o&&(d=t.height,p=0),this.paddingTop=d+s,this.paddingBottom=p+s}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){dr(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:t}=this.options;return"top"===t||"bottom"===t||"x"===e}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){let t,r;for(this.beforeTickToLabelConversion(),this.generateTickLabels(e),t=0,r=e.length;t<r;t++)Un(e[t].label)&&(e.splice(t,1),r--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const t=this.options.ticks.sampleSize;let r=this.ticks;t<r.length&&(r=K4(r,t)),this._labelSizes=e=this._computeLabelSizes(r,r.length)}return e}_computeLabelSizes(e,t){const{ctx:r,_longestTextCache:i}=this,o=[],s=[];let c,d,p,m,y,w,C,_,A,T,N,a=0,u=0;for(c=0;c<t;++c){if(m=e[c].label,y=this._resolveTickFontOptions(c),r.font=w=y.string,C=i[w]=i[w]||{data:{},gc:[]},_=y.lineHeight,A=T=0,Un(m)||hr(m)){if(hr(m))for(d=0,p=m.length;d<p;++d)N=m[d],!Un(N)&&!hr(N)&&(A=Tm(r,C.data,C.gc,A,N),T+=_)}else A=Tm(r,C.data,C.gc,A,m),T=_;o.push(A),s.push(T),a=Math.max(A,a),u=Math.max(T,u)}!function(n,e){Zn(n,t=>{const r=t.gc,i=r.length/2;let o;if(i>e){for(o=0;o<i;++o)delete t.data[r[o]];r.splice(0,i)}})}(i,t);const M=o.indexOf(a),O=s.indexOf(u),L=V=>({width:o[V]||0,height:s[V]||0});return{first:L(0),last:L(t-1),widest:L(M),highest:L(O),widths:o,heights:s}}getLabelForValue(e){return e}getPixelForValue(e,t){return NaN}getValueForPixel(e){}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const t=this._startPixel+e*this._length;return function(n){return Li(n,-32768,32767)}(this._alignToPixels?Ol(this.chart,t,0):t)}getDecimalForPixel(e){const t=(e-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:t}=this;return e<0&&t<0?t:e>0&&t>0?e:0}getContext(e){const t=this.ticks||[];if(e>=0&&e<t.length){const r=t[e];return r.$context||(r.$context=function(n,e,t){return kc(n,{tick:t,index:e,type:"tick"})}(this.getContext(),e,r))}return this.$context||(this.$context=function(n,e){return kc(n,{scale:e,type:"scale"})}(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,t=pa(this.labelRotation),r=Math.abs(Math.cos(t)),i=Math.abs(Math.sin(t)),o=this._getLabelSizes(),s=e.autoSkipPadding||0,a=o?o.widest.width+s:0,u=o?o.highest.height+s:0;return this.isHorizontal()?u*r>a*i?a/r:u/i:u*i<a*r?u/r:a/i}_isVisible(){const e=this.options.display;return"auto"!==e?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const t=this.axis,r=this.chart,i=this.options,{grid:o,position:s}=i,a=o.offset,u=this.isHorizontal(),d=this.ticks.length+(a?1:0),p=ug(o),m=[],y=o.setContext(this.getContext()),w=y.drawBorder?y.borderWidth:0,C=w/2,_=function(se){return Ol(r,se,w)};let A,T,N,M,O,L,V,j,U,G,K,$;if("top"===s)A=_(this.bottom),L=this.bottom-p,j=A-C,G=_(e.top)+C,$=e.bottom;else if("bottom"===s)A=_(this.top),G=e.top,$=_(e.bottom)-C,L=A+C,j=this.top+p;else if("left"===s)A=_(this.right),O=this.right-p,V=A-C,U=_(e.left)+C,K=e.right;else if("right"===s)A=_(this.left),U=e.left,K=_(e.right)-C,O=A+C,V=this.left+p;else if("x"===t){if("center"===s)A=_((e.top+e.bottom)/2+.5);else if(vn(s)){const se=Object.keys(s)[0];A=_(this.chart.scales[se].getPixelForValue(s[se]))}G=e.top,$=e.bottom,L=A+C,j=L+p}else if("y"===t){if("center"===s)A=_((e.left+e.right)/2);else if(vn(s)){const se=Object.keys(s)[0];A=_(this.chart.scales[se].getPixelForValue(s[se]))}O=A-C,V=O-p,U=e.left,K=e.right}const he=en(i.ticks.maxTicksLimit,d),de=Math.max(1,Math.ceil(d/he));for(T=0;T<d;T+=de){const se=o.setContext(this.getContext(T)),fe=se.lineWidth,we=se.color,ye=o.borderDash||[],Ee=se.borderDashOffset,Se=se.tickWidth,je=se.tickColor,et=se.tickBorderDash||[],dt=se.tickBorderDashOffset;N=rie(this,T,a),void 0!==N&&(M=Ol(r,N,fe),u?O=V=U=K=M:L=j=G=$=M,m.push({tx1:O,ty1:L,tx2:V,ty2:j,x1:U,y1:G,x2:K,y2:$,width:fe,color:we,borderDash:ye,borderDashOffset:Ee,tickWidth:Se,tickColor:je,tickBorderDash:et,tickBorderDashOffset:dt}))}return this._ticksLength=d,this._borderValue=A,m}_computeLabelItems(e){const t=this.axis,r=this.options,{position:i,ticks:o}=r,s=this.isHorizontal(),a=this.ticks,{align:u,crossAlign:c,padding:d,mirror:p}=o,m=ug(r.grid),y=m+d,w=p?-d:y,C=-pa(this.labelRotation),_=[];let A,T,N,M,O,L,V,j,U,G,K,$,he="middle";if("top"===i)L=this.bottom-w,V=this._getXAxisLabelAlignment();else if("bottom"===i)L=this.top+w,V=this._getXAxisLabelAlignment();else if("left"===i){const se=this._getYAxisLabelAlignment(m);V=se.textAlign,O=se.x}else if("right"===i){const se=this._getYAxisLabelAlignment(m);V=se.textAlign,O=se.x}else if("x"===t){if("center"===i)L=(e.top+e.bottom)/2+y;else if(vn(i)){const se=Object.keys(i)[0];L=this.chart.scales[se].getPixelForValue(i[se])+y}V=this._getXAxisLabelAlignment()}else if("y"===t){if("center"===i)O=(e.left+e.right)/2-y;else if(vn(i)){const se=Object.keys(i)[0];O=this.chart.scales[se].getPixelForValue(i[se])}V=this._getYAxisLabelAlignment(m).textAlign}"y"===t&&("start"===u?he="top":"end"===u&&(he="bottom"));const de=this._getLabelSizes();for(A=0,T=a.length;A<T;++A){N=a[A],M=N.label;const se=o.setContext(this.getContext(A));j=this.getPixelForTick(A)+o.labelOffset,U=this._resolveTickFontOptions(A),G=U.lineHeight,K=hr(M)?M.length:1;const fe=K/2,we=se.color,ye=se.textStrokeColor,Ee=se.textStrokeWidth;let Se;if(s?(O=j,$="top"===i?"near"===c||0!==C?-K*G+G/2:"center"===c?-de.highest.height/2-fe*G+G:G/2-de.highest.height:"near"===c||0!==C?G/2:"center"===c?de.highest.height/2-fe*G:de.highest.height-K*G,p&&($*=-1)):(L=j,$=(1-K)*G/2),se.showLabelBackdrop){const je=Io(se.backdropPadding),et=de.heights[A],dt=de.widths[A];let zt=L+$-je.top,Gt=O-je.left;switch(he){case"middle":zt-=et/2;break;case"bottom":zt-=et}switch(V){case"center":Gt-=dt/2;break;case"right":Gt-=dt}Se={left:Gt,top:zt,width:dt+je.width,height:et+je.height,color:se.backdropColor}}_.push({rotation:C,label:M,font:U,color:we,strokeColor:ye,strokeWidth:Ee,textOffset:$,textAlign:V,textBaseline:he,translation:[O,L],backdrop:Se})}return _}_getXAxisLabelAlignment(){const{position:e,ticks:t}=this.options;if(-pa(this.labelRotation))return"top"===e?"left":"right";let i="center";return"start"===t.align?i="left":"end"===t.align&&(i="right"),i}_getYAxisLabelAlignment(e){const{position:t,ticks:{crossAlign:r,mirror:i,padding:o}}=this.options,a=e+o,u=this._getLabelSizes().widest.width;let c,d;return"left"===t?i?(d=this.right+o,"near"===r?c="left":"center"===r?(c="center",d+=u/2):(c="right",d+=u)):(d=this.right-a,"near"===r?c="right":"center"===r?(c="center",d-=u/2):(c="left",d=this.left)):"right"===t?i?(d=this.left+o,"near"===r?c="right":"center"===r?(c="center",d-=u/2):(c="left",d-=u)):(d=this.left+a,"near"===r?c="left":"center"===r?(c="center",d+=u/2):(c="right",d=this.right)):c="right",{textAlign:c,x:d}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,t=this.options.position;return"left"===t||"right"===t?{top:0,left:this.left,bottom:e.height,right:this.right}:"top"===t||"bottom"===t?{top:this.top,left:0,bottom:this.bottom,right:e.width}:void 0}drawBackground(){const{ctx:e,options:{backgroundColor:t},left:r,top:i,width:o,height:s}=this;t&&(e.save(),e.fillStyle=t,e.fillRect(r,i,o,s),e.restore())}getLineWidthForValue(e){const t=this.options.grid;if(!this._isVisible()||!t.display)return 0;const i=this.ticks.findIndex(o=>o.value===e);return i>=0?t.setContext(this.getContext(i)).lineWidth:0}drawGrid(e){const t=this.options.grid,r=this.ctx,i=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let o,s;const a=(u,c,d)=>{!d.width||!d.color||(r.save(),r.lineWidth=d.width,r.strokeStyle=d.color,r.setLineDash(d.borderDash||[]),r.lineDashOffset=d.borderDashOffset,r.beginPath(),r.moveTo(u.x,u.y),r.lineTo(c.x,c.y),r.stroke(),r.restore())};if(t.display)for(o=0,s=i.length;o<s;++o){const u=i[o];t.drawOnChartArea&&a({x:u.x1,y:u.y1},{x:u.x2,y:u.y2},u),t.drawTicks&&a({x:u.tx1,y:u.ty1},{x:u.tx2,y:u.ty2},{color:u.tickColor,width:u.tickWidth,borderDash:u.tickBorderDash,borderDashOffset:u.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:t,options:{grid:r}}=this,i=r.setContext(this.getContext()),o=r.drawBorder?i.borderWidth:0;if(!o)return;const s=r.setContext(this.getContext(0)).lineWidth,a=this._borderValue;let u,c,d,p;this.isHorizontal()?(u=Ol(e,this.left,o)-o/2,c=Ol(e,this.right,s)+s/2,d=p=a):(d=Ol(e,this.top,o)-o/2,p=Ol(e,this.bottom,s)+s/2,u=c=a),t.save(),t.lineWidth=i.borderWidth,t.strokeStyle=i.borderColor,t.beginPath(),t.moveTo(u,d),t.lineTo(c,p),t.stroke(),t.restore()}drawLabels(e){if(!this.options.ticks.display)return;const r=this.ctx,i=this._computeLabelArea();i&&Rm(r,i);const o=this._labelItems||(this._labelItems=this._computeLabelItems(e));let s,a;for(s=0,a=o.length;s<a;++s){const u=o[s],c=u.font,d=u.label;u.backdrop&&(r.fillStyle=u.backdrop.color,r.fillRect(u.backdrop.left,u.backdrop.top,u.backdrop.width,u.backdrop.height)),Pl(r,d,0,u.textOffset,c,u)}i&&Nm(r)}drawTitle(){const{ctx:e,options:{position:t,title:r,reverse:i}}=this;if(!r.display)return;const o=Ai(r.font),s=Io(r.padding),a=r.align;let u=o.lineHeight/2;"bottom"===t||"center"===t||vn(t)?(u+=s.bottom,hr(r.text)&&(u+=o.lineHeight*(r.text.length-1))):u+=s.top;const{titleX:c,titleY:d,maxWidth:p,rotation:m}=function(n,e,t,r){const{top:i,left:o,bottom:s,right:a,chart:u}=n,{chartArea:c,scales:d}=u;let m,y,w,p=0;const C=s-i,_=a-o;if(n.isHorizontal()){if(y=uo(r,o,a),vn(t)){const A=Object.keys(t)[0];w=d[A].getPixelForValue(t[A])+C-e}else w="center"===t?(c.bottom+c.top)/2+C-e:$4(n,t,e);m=a-o}else{if(vn(t)){const A=Object.keys(t)[0];y=d[A].getPixelForValue(t[A])-_+e}else y="center"===t?(c.left+c.right)/2-_+e:$4(n,t,e);w=uo(r,s,i),p="left"===t?-ti:ti}return{titleX:y,titleY:w,maxWidth:m,rotation:p}}(this,u,t,a);Pl(e,r.text,0,0,o,{color:r.color,maxWidth:p,rotation:m,textAlign:aie(a,t,i),textBaseline:"middle",translation:[c,d]})}draw(e){!this._isVisible()||(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,t=e.ticks&&e.ticks.z||0,r=en(e.grid&&e.grid.z,-1);return this._isVisible()&&this.draw===Vl.prototype.draw?[{z:r,draw:i=>{this.drawBackground(),this.drawGrid(i),this.drawTitle()}},{z:r+1,draw:()=>{this.drawBorder()}},{z:t,draw:i=>{this.drawLabels(i)}}]:[{z:t,draw:i=>{this.draw(i)}}]}getMatchingVisibleMetas(e){const t=this.chart.getSortedVisibleDatasetMetas(),r=this.axis+"AxisID",i=[];let o,s;for(o=0,s=t.length;o<s;++o){const a=t[o];a[r]===this.id&&(!e||a.type===e)&&i.push(a)}return i}_resolveTickFontOptions(e){return Ai(this.options.ticks.setContext(this.getContext(e)).font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class jm{constructor(e,t,r){this.type=e,this.scope=t,this.override=r,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const t=Object.getPrototypeOf(e);let r;(function(n){return"id"in n&&"defaults"in n})(t)&&(r=this.register(t));const i=this.items,o=e.id,s=this.scope+"."+o;if(!o)throw new Error("class does not have id: "+e);return o in i||(i[o]=e,function(n,e,t){const r=Gp(Object.create(null),[t?bn.get(t):{},bn.get(e),n.defaults]);bn.set(e,r),n.defaultRoutes&&function(n,e){Object.keys(e).forEach(t=>{const r=t.split("."),i=r.pop(),o=[n].concat(r).join("."),s=e[t].split("."),a=s.pop(),u=s.join(".");bn.route(o,i,u,a)})}(e,n.defaultRoutes),n.descriptors&&bn.describe(e,n.descriptors)}(e,s,r),this.override&&bn.override(e.id,e.overrides)),s}get(e){return this.items[e]}unregister(e){const t=this.items,r=e.id,i=this.scope;r in t&&delete t[r],i&&r in bn[i]&&(delete bn[i][r],this.override&&delete Nl[r])}}var Vu=new class{constructor(){this.controllers=new jm(Bu,"datasets",!0),this.elements=new jm(ma,"elements"),this.plugins=new jm(Object,"plugins"),this.scales=new jm(Vl,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,t,r){[...t].forEach(i=>{const o=r||this._getRegistryForType(i);r||o.isForType(i)||o===this.plugins&&i.id?this._exec(e,o,i):Zn(i,s=>{const a=r||this._getRegistryForType(s);this._exec(e,a,s)})})}_exec(e,t,r){const i=t_(e);dr(r["before"+i],[],r),t[e](r),dr(r["after"+i],[],r)}_getRegistryForType(e){for(let t=0;t<this._typedRegistries.length;t++){const r=this._typedRegistries[t];if(r.isForType(e))return r}return this.plugins}_get(e,t,r){const i=t.get(e);if(void 0===i)throw new Error('"'+e+'" is not a registered '+r+".");return i}};class fie{constructor(){this._init=[]}notify(e,t,r,i){"beforeInit"===t&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const o=i?this._descriptors(e).filter(i):this._descriptors(e),s=this._notify(o,e,t,r);return"destroy"===t&&(this._notify(o,e,"stop"),this._notify(this._init,e,"uninstall")),s}_notify(e,t,r,i){i=i||{};for(const o of e){const s=o.plugin;if(!1===dr(s[r],[t,i,o.options],s)&&i.cancelable)return!1}return!0}invalidate(){Un(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const t=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),t}_createDescriptors(e,t){const r=e&&e.config,i=en(r.options&&r.options.plugins,{}),o=function(n){const e=[],t=Object.keys(Vu.plugins.items);for(let i=0;i<t.length;i++)e.push(Vu.getPlugin(t[i]));const r=n.plugins||[];for(let i=0;i<r.length;i++){const o=r[i];-1===e.indexOf(o)&&e.push(o)}return e}(r);return!1!==i||t?function(n,e,t,r){const i=[],o=n.getContext();for(let s=0;s<e.length;s++){const a=e[s],c=gie(t[a.id],r);null!==c&&i.push({plugin:a,options:vie(n.config,a,c,o)})}return i}(e,o,i,t):[]}_notifyStateChanges(e){const t=this._oldCache||[],r=this._cache,i=(o,s)=>o.filter(a=>!s.some(u=>a.plugin.id===u.plugin.id));this._notify(i(t,r),e,"stop"),this._notify(i(r,t),e,"start")}}function gie(n,e){return e||!1!==n?!0===n?{}:n:null}function vie(n,e,t,r){const i=n.pluginScopeKeys(e),o=n.getOptionScopes(t,i);return n.createResolver(o,r,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function E_(n,e){return((e.datasets||{})[n]||{}).indexAxis||e.indexAxis||(bn.datasets[n]||{}).indexAxis||"x"}function I_(n,e){return"x"===n||"y"===n?n:e.axis||function(n){return"top"===n||"bottom"===n?"x":"left"===n||"right"===n?"y":void 0}(e.position)||n.charAt(0).toLowerCase()}function Z4(n){const e=n.options||(n.options={});e.plugins=en(e.plugins,{}),e.scales=function(n,e){const t=Nl[n.type]||{scales:{}},r=e.scales||{},i=E_(n.type,e),o=Object.create(null),s=Object.create(null);return Object.keys(r).forEach(a=>{const u=r[a];if(!vn(u))return console.error(`Invalid scale configuration for scale: ${a}`);if(u._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${a}`);const c=I_(a,u),d=function(n,e){return n===e?"_index_":"_value_"}(c,i),p=t.scales||{};o[c]=o[c]||a,s[a]=Yp(Object.create(null),[{axis:c},u,p[c],p[d]])}),n.data.datasets.forEach(a=>{const u=a.type||n.type,c=a.indexAxis||E_(u,e),p=(Nl[u]||{}).scales||{};Object.keys(p).forEach(m=>{const y=function(n,e){let t=n;return"_index_"===n?t=e:"_value_"===n&&(t="x"===e?"y":"x"),t}(m,c),w=a[y+"AxisID"]||o[y]||y;s[w]=s[w]||Object.create(null),Yp(s[w],[{axis:y},r[w],p[m]])})}),Object.keys(s).forEach(a=>{const u=s[a];Yp(u,[bn.scales[u.type],bn.scale])}),s}(n,e)}function J4(n){return(n=n||{}).datasets=n.datasets||[],n.labels=n.labels||[],n}const eP=new Map,tP=new Set;function Wm(n,e){let t=eP.get(n);return t||(t=e(),eP.set(n,t),tP.add(t)),t}const cg=(n,e,t)=>{const r=Rl(e,t);void 0!==r&&n.add(r)};class Cie{constructor(e){this._config=function(n){return(n=n||{}).data=J4(n.data),Z4(n),n}(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=J4(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),Z4(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return Wm(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,t){return Wm(`${e}.transition.${t}`,()=>[[`datasets.${e}.transitions.${t}`,`transitions.${t}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,t){return Wm(`${e}-${t}`,()=>[[`datasets.${e}.elements.${t}`,`datasets.${e}`,`elements.${t}`,""]])}pluginScopeKeys(e){const t=e.id;return Wm(`${this.type}-plugin-${t}`,()=>[[`plugins.${t}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,t){const r=this._scopeCache;let i=r.get(e);return(!i||t)&&(i=new Map,r.set(e,i)),i}getOptionScopes(e,t,r){const{options:i,type:o}=this,s=this._cachedScopes(e,r),a=s.get(t);if(a)return a;const u=new Set;t.forEach(d=>{e&&(u.add(e),d.forEach(p=>cg(u,e,p))),d.forEach(p=>cg(u,i,p)),d.forEach(p=>cg(u,Nl[o]||{},p)),d.forEach(p=>cg(u,bn,p)),d.forEach(p=>cg(u,l_,p))});const c=Array.from(u);return 0===c.length&&c.push(Object.create(null)),tP.has(t)&&s.set(t,c),c}chartOptionScopes(){const{options:e,type:t}=this;return[e,Nl[t]||{},bn.datasets[t]||{},{type:t},bn,l_]}resolveNamedOptions(e,t,r,i=[""]){const o={$shared:!0},{resolver:s,subPrefixes:a}=nP(this._resolverCache,e,i);let u=s;(function(n,e){const{isScriptable:t,isIndexable:r}=e4(n);for(const i of e){const o=t(i),s=r(i),a=(s||o)&&n[i];if(o&&(Oc(a)||Eie(a))||s&&hr(a))return!0}return!1})(s,t)&&(o.$shared=!1,u=Dd(s,r=Oc(r)?r():r,this.createResolver(e,r,a)));for(const c of t)o[c]=u[c];return o}createResolver(e,t,r=[""],i){const{resolver:o}=nP(this._resolverCache,e,r);return vn(t)?Dd(o,t,void 0,i):o}}function nP(n,e,t){let r=n.get(e);r||(r=new Map,n.set(e,r));const i=t.join();let o=r.get(i);return o||(o={resolver:p_(e,t),subPrefixes:t.filter(a=>!a.toLowerCase().includes("hover"))},r.set(i,o)),o}const Eie=n=>vn(n)&&Object.getOwnPropertyNames(n).reduce((e,t)=>e||Oc(n[t]),!1),Die=["top","bottom","left","right","chartArea"];function rP(n,e){return"top"===n||"bottom"===n||-1===Die.indexOf(n)&&"x"===e}function iP(n,e){return function(t,r){return t[n]===r[n]?t[e]-r[e]:t[n]-r[n]}}function oP(n){const e=n.chart,t=e.options.animation;e.notifyPlugins("afterRender"),dr(t&&t.onComplete,[n],e)}function Sie(n){const e=n.chart,t=e.options.animation;dr(t&&t.onProgress,[n],e)}function sP(n){return u4()&&"string"==typeof n?n=document.getElementById(n):n&&n.length&&(n=n[0]),n&&n.canvas&&(n=n.canvas),n}const Hm={},aP=n=>{const e=sP(n);return Object.values(Hm).filter(t=>t.canvas===e).pop()};class zm{constructor(e,t){const r=this.config=new Cie(t),i=sP(e),o=aP(i);if(o)throw new Error("Canvas is already in use. Chart with ID '"+o.id+"' must be destroyed before the canvas can be reused.");const s=r.createResolver(r.chartOptionScopes(),this.getContext());this.platform=new(r.platform||function(n){return!u4()||"undefined"!=typeof OffscreenCanvas&&n instanceof OffscreenCanvas?Pre:Xre}(i)),this.platform.updateConfig(r);const a=this.platform.acquireContext(i,s.aspectRatio),u=a&&a.canvas,c=u&&u.height,d=u&&u.width;this.id=mte(),this.ctx=a,this.canvas=u,this.width=d,this.height=c,this._options=s,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new fie,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function(n,e){let t;return function(...r){return e?(clearTimeout(t),t=setTimeout(n,e,r)):n.apply(this,r),e}}(p=>this.update(p),s.resizeDelay||0),Hm[this.id]=this,a&&u?(Lu.listen(this,"complete",oP),Lu.listen(this,"progress",Sie),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:t},width:r,height:i,_aspectRatio:o}=this;return Un(e)?t&&o?o:i?r/i:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():l4(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return $k(this.canvas,this.ctx),this}stop(){return Lu.stop(this),this}resize(e,t){Lu.running(this)?this._resizeBeforeDraw={width:e,height:t}:this._resize(e,t)}_resize(e,t){const r=this.options,s=this.platform.getMaximumSize(this.canvas,e,t,r.maintainAspectRatio&&this.aspectRatio),a=r.devicePixelRatio||this.platform.getDevicePixelRatio(),u=this.width?"resize":"attach";this.width=s.width,this.height=s.height,this._aspectRatio=this.aspectRatio,l4(this,a,!0)&&(this.notifyPlugins("resize",{size:s}),dr(r.onResize,[this,s],this),this.attached&&this._doResize(u)&&this.render())}ensureScalesHaveIDs(){Zn(this.options.scales||{},(r,i)=>{r.id=i})}buildOrUpdateScales(){const e=this.options,t=e.scales,r=this.scales,i=Object.keys(r).reduce((s,a)=>(s[a]=!1,s),{});let o=[];t&&(o=o.concat(Object.keys(t).map(s=>{const a=t[s],u=I_(s,a),c="r"===u,d="x"===u;return{options:a,dposition:c?"chartArea":d?"bottom":"left",dtype:c?"radialLinear":d?"category":"linear"}}))),Zn(o,s=>{const a=s.options,u=a.id,c=I_(u,a),d=en(a.type,s.dtype);(void 0===a.position||rP(a.position,c)!==rP(s.dposition))&&(a.position=s.dposition),i[u]=!0;let p=null;u in r&&r[u].type===d?p=r[u]:(p=new(Vu.getScale(d))({id:u,type:d,ctx:this.ctx,chart:this}),r[p.id]=p),p.init(a,e)}),Zn(i,(s,a)=>{s||delete r[a]}),Zn(r,s=>{co.configure(this,s,s.options),co.addBox(this,s)})}_updateMetasets(){const e=this._metasets,t=this.data.datasets.length,r=e.length;if(e.sort((i,o)=>i.index-o.index),r>t){for(let i=t;i<r;++i)this._destroyDatasetMeta(i);e.splice(t,r-t)}this._sortedMetasets=e.slice(0).sort(iP("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:t}}=this;e.length>t.length&&delete this._stacks,e.forEach((r,i)=>{0===t.filter(o=>o===r._dataset).length&&this._destroyDatasetMeta(i)})}buildOrUpdateControllers(){const e=[],t=this.data.datasets;let r,i;for(this._removeUnreferencedMetasets(),r=0,i=t.length;r<i;r++){const o=t[r];let s=this.getDatasetMeta(r);const a=o.type||this.config.type;if(s.type&&s.type!==a&&(this._destroyDatasetMeta(r),s=this.getDatasetMeta(r)),s.type=a,s.indexAxis=o.indexAxis||E_(a,this.options),s.order=o.order||0,s.index=r,s.label=""+o.label,s.visible=this.isDatasetVisible(r),s.controller)s.controller.updateIndex(r),s.controller.linkScales();else{const u=Vu.getController(a),{datasetElementType:c,dataElementType:d}=bn.datasets[a];Object.assign(u.prototype,{dataElementType:Vu.getElement(d),datasetElementType:c&&Vu.getElement(c)}),s.controller=new u(this,r),e.push(s.controller)}}return this._updateMetasets(),e}_resetElements(){Zn(this.data.datasets,(e,t)=>{this.getDatasetMeta(t).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const t=this.config;t.update();const r=this._options=t.createResolver(t.chartOptionScopes(),this.getContext());Zn(this.scales,c=>{co.removeBox(this,c)});const i=this._animationsDisabled=!r.animation;if(this.ensureScalesHaveIDs(),this.buildOrUpdateScales(),(!((n,e)=>{if(n.size!==e.size)return!1;for(const t of n)if(!e.has(t))return!1;return!0})(new Set(Object.keys(this._listeners)),new Set(r.events))||!!this._responsiveListeners!==r.responsive)&&(this.unbindEvents(),this.bindEvents()),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0}))return;const a=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let u=0;for(let c=0,d=this.data.datasets.length;c<d;c++){const{controller:p}=this.getDatasetMeta(c),m=!i&&-1===a.indexOf(p);p.buildOrUpdateElements(m),u=Math.max(+p.getMaxOverflow(),u)}u=this._minPadding=r.layout.autoPadding?u:0,this._updateLayout(u),i||Zn(a,c=>{c.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(iP("z","_idx")),this._lastEvent&&this._eventHandler(this._lastEvent,!0),this.render()}_updateLayout(e){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;co.update(this,this.width,this.height,e);const t=this.chartArea,r=t.width<=0||t.height<=0;this._layers=[],Zn(this.boxes,i=>{r&&"chartArea"===i.position||(i.configure&&i.configure(),this._layers.push(...i._layers()))},this),this._layers.forEach((i,o)=>{i._idx=o}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})){for(let t=0,r=this.data.datasets.length;t<r;++t)this._updateDataset(t,Oc(e)?e({datasetIndex:t}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,t){const r=this.getDatasetMeta(e),i={meta:r,index:e,mode:t,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",i)&&(r.controller._update(t),i.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",i))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(Lu.has(this)?this.attached&&!Lu.running(this)&&Lu.start(this):(this.draw(),oP({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:r,height:i}=this._resizeBeforeDraw;this._resize(r,i),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const t=this._layers;for(e=0;e<t.length&&t[e].z<=0;++e)t[e].draw(this.chartArea);for(this._drawDatasets();e<t.length;++e)t[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const t=this._sortedMetasets,r=[];let i,o;for(i=0,o=t.length;i<o;++i){const s=t[i];(!e||s.visible)&&r.push(s)}return r}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const e=this.getSortedVisibleDatasetMetas();for(let t=e.length-1;t>=0;--t)this._drawDataset(e[t]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const t=this.ctx,r=e._clip,i=!r.disabled,o=this.chartArea,s={meta:e,index:e.index,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetDraw",s)&&(i&&Rm(t,{left:!1===r.left?0:o.left-r.left,right:!1===r.right?this.width:o.right+r.right,top:!1===r.top?0:o.top-r.top,bottom:!1===r.bottom?this.height:o.bottom+r.bottom}),e.controller.draw(),i&&Nm(t),s.cancelable=!1,this.notifyPlugins("afterDatasetDraw",s))}getElementsAtEventForMode(e,t,r,i){const o=Dre.modes[t];return"function"==typeof o?o(this,e,r,i):[]}getDatasetMeta(e){const t=this.data.datasets[e],r=this._metasets;let i=r.filter(o=>o&&o._dataset===t).pop();return i||(i={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:t&&t.order||0,index:e,_dataset:t,_parsed:[],_sorted:!1},r.push(i)),i}getContext(){return this.$context||(this.$context=kc(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const t=this.data.datasets[e];if(!t)return!1;const r=this.getDatasetMeta(e);return"boolean"==typeof r.hidden?!r.hidden:!t.hidden}setDatasetVisibility(e,t){this.getDatasetMeta(e).hidden=!t}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,t,r){const i=r?"show":"hide",o=this.getDatasetMeta(e),s=o.controller._resolveAnimations(void 0,i);Es(t)?(o.data[t].hidden=!r,this.update()):(this.setDatasetVisibility(e,r),s.update(o,{visible:r}),this.update(a=>a.datasetIndex===e?i:void 0))}hide(e,t){this._updateVisibility(e,t,!1)}show(e,t){this._updateVisibility(e,t,!0)}_destroyDatasetMeta(e){const t=this._metasets[e];t&&t.controller&&t.controller._destroy(),delete this._metasets[e]}_stop(){let e,t;for(this.stop(),Lu.remove(this),e=0,t=this.data.datasets.length;e<t;++e)this._destroyDatasetMeta(e)}destroy(){const{canvas:e,ctx:t}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),$k(e,t),this.platform.releaseContext(t),this.canvas=null,this.ctx=null),this.notifyPlugins("destroy"),delete Hm[this.id]}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,t=this.platform,r=(o,s)=>{t.addEventListener(this,o,s),e[o]=s},i=(o,s,a)=>{o.offsetX=s,o.offsetY=a,this._eventHandler(o)};Zn(this.options.events,o=>r(o,i))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,t=this.platform,r=(u,c)=>{t.addEventListener(this,u,c),e[u]=c},i=(u,c)=>{e[u]&&(t.removeEventListener(this,u,c),delete e[u])},o=(u,c)=>{this.canvas&&this.resize(u,c)};let s;const a=()=>{i("attach",a),this.attached=!0,this.resize(),r("resize",o),r("detach",s)};s=()=>{this.attached=!1,i("resize",o),this._stop(),this._resize(0,0),r("attach",a)},t.isAttached(this.canvas)?a():s()}unbindEvents(){Zn(this._listeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._listeners={},Zn(this._responsiveListeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,t,r){const i=r?"set":"remove";let o,s,a,u;for("dataset"===t&&(o=this.getDatasetMeta(e[0].datasetIndex),o.controller["_"+i+"DatasetHoverStyle"]()),a=0,u=e.length;a<u;++a){s=e[a];const c=s&&this.getDatasetMeta(s.datasetIndex).controller;c&&c[i+"HoverStyle"](s.element,s.datasetIndex,s.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const t=this._active||[],r=e.map(({datasetIndex:o,index:s})=>{const a=this.getDatasetMeta(o);if(!a)throw new Error("No dataset found at index "+o);return{datasetIndex:o,element:a.data[s],index:s}});!xm(r,t)&&(this._active=r,this._updateHoverStyles(r,t))}notifyPlugins(e,t,r){return this._plugins.notify(this,e,t,r)}_updateHoverStyles(e,t,r){const i=this.options.hover,o=(u,c)=>u.filter(d=>!c.some(p=>d.datasetIndex===p.datasetIndex&&d.index===p.index)),s=o(t,e),a=r?e:o(e,t);s.length&&this.updateHoverStyle(s,i.mode,!1),a.length&&i.mode&&this.updateHoverStyle(a,i.mode,!0)}_eventHandler(e,t){const r={event:e,replay:t,cancelable:!0},i=s=>(s.options.events||this.options.events).includes(e.native.type);if(!1===this.notifyPlugins("beforeEvent",r,i))return;const o=this._handleEvent(e,t);return r.cancelable=!1,this.notifyPlugins("afterEvent",r,i),(o||r.changed)&&this.render(),this}_handleEvent(e,t){const{_active:r=[],options:i}=this,o=i.hover;let a=[],u=!1,c=null;return"mouseout"!==e.type&&(a=this.getElementsAtEventForMode(e,o.mode,o,t),c="click"===e.type?this._lastEvent:e),this._lastEvent=null,kl(e,this.chartArea,this._minPadding)&&(dr(i.onHover,[e,a,this],this),("mouseup"===e.type||"click"===e.type||"contextmenu"===e.type)&&dr(i.onClick,[e,a,this],this)),u=!xm(a,r),(u||t)&&(this._active=a,this._updateHoverStyles(a,r,t)),this._lastEvent=c,u}}const uP=()=>Zn(zm.instances,n=>n._plugins.invalidate()),Pc=!0;function cP(n,e,t){const{startAngle:r,pixelMargin:i,x:o,y:s,outerRadius:a,innerRadius:u}=e;let c=i/a;n.beginPath(),n.arc(o,s,a,r-c,t+c),u>i?(c=i/u,n.arc(o,s,u,t+c,r-c,!0)):n.arc(o,s,i,t+ti,r-ti),n.closePath(),n.clip()}function Md(n,e,t,r){return{x:t+n*Math.cos(e),y:r+n*Math.sin(e)}}function A_(n,e,t,r,i){const{x:o,y:s,startAngle:a,pixelMargin:u,innerRadius:c}=e,d=Math.max(e.outerRadius+r+t-u,0),p=c>0?c+r+t+u:0;let m=0;const y=i-a;if(r){const ye=((c>0?c-r:0)+(d>0?d-r:0))/2;m=(y-(0!==ye?y*ye/(ye+r):y))/2}const C=(y-Math.max(.001,y*d-t/Xr)/d)/2,_=a+C+m,A=i-C-m,{outerStart:T,outerEnd:N,innerStart:M,innerEnd:O}=function(n,e,t,r){const i=function(n){return d_(n,["outerStart","outerEnd","innerStart","innerEnd"])}(n.options.borderRadius),o=(t-e)/2,s=Math.min(o,r*e/2),a=u=>{const c=(t-Math.min(o,u))*r/2;return Li(u,0,Math.min(o,c))};return{outerStart:a(i.outerStart),outerEnd:a(i.outerEnd),innerStart:Li(i.innerStart,0,s),innerEnd:Li(i.innerEnd,0,s)}}(e,p,d,A-_),L=d-T,V=d-N,j=_+T/L,U=A-N/V,G=p+M,K=p+O,$=_+M/G,he=A-O/K;if(n.beginPath(),n.arc(o,s,d,j,U),N>0){const fe=Md(V,U,o,s);n.arc(fe.x,fe.y,N,U,A+ti)}const de=Md(K,A,o,s);if(n.lineTo(de.x,de.y),O>0){const fe=Md(K,he,o,s);n.arc(fe.x,fe.y,O,A+ti,he+Math.PI)}if(n.arc(o,s,p,A-O/p,_+M/p,!0),M>0){const fe=Md(G,$,o,s);n.arc(fe.x,fe.y,M,$+Math.PI,_-ti)}const se=Md(L,_,o,s);if(n.lineTo(se.x,se.y),T>0){const fe=Md(L,j,o,s);n.arc(fe.x,fe.y,T,_-ti,j)}n.closePath()}Object.defineProperties(zm,{defaults:{enumerable:Pc,value:bn},instances:{enumerable:Pc,value:Hm},overrides:{enumerable:Pc,value:Nl},registry:{enumerable:Pc,value:Vu},version:{enumerable:Pc,value:"3.6.0"},getChart:{enumerable:Pc,value:aP},register:{enumerable:Pc,value:(...n)=>{Vu.add(...n),uP()}},unregister:{enumerable:Pc,value:(...n)=>{Vu.remove(...n),uP()}}});class Gm extends ma{constructor(e){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,t,r){const i=this.getProps(["x","y"],r),{angle:o,distance:s}=function(n,e){const t=e.x-n.x,r=e.y-n.y,i=Math.sqrt(t*t+r*r);let o=Math.atan2(r,t);return o<-.5*Xr&&(o+=sr),{angle:o,distance:i}}(i,{x:e,y:t}),{startAngle:a,endAngle:u,innerRadius:c,outerRadius:d,circumference:p}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],r),m=this.options.spacing/2;return(p>=sr||_m(o,a,u))&&s>=c+m&&s<=d+m}getCenterPoint(e){const{x:t,y:r,startAngle:i,endAngle:o,innerRadius:s,outerRadius:a}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius","circumference"],e),{offset:u,spacing:c}=this.options,d=(i+o)/2,p=(s+a+c+u)/2;return{x:t+Math.cos(d)*p,y:r+Math.sin(d)*p}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:t,circumference:r}=this,i=(t.offset||0)/2,o=(t.spacing||0)/2;if(this.pixelMargin="inner"===t.borderAlign?.33:0,this.fullCircles=r>sr?Math.floor(r/sr):0,0===r||this.innerRadius<0||this.outerRadius<0)return;e.save();let s=0;if(i){s=i/2;const u=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(u)*s,Math.sin(u)*s),this.circumference>=Xr&&(s=i)}e.fillStyle=t.backgroundColor,e.strokeStyle=t.borderColor,function(n,e,t,r,i){const{options:o}=e,s="inner"===o.borderAlign;!o.borderWidth||(s?(n.lineWidth=2*o.borderWidth,n.lineJoin="round"):(n.lineWidth=o.borderWidth,n.lineJoin="bevel"),e.fullCircles&&function(n,e,t){const{x:r,y:i,startAngle:o,pixelMargin:s,fullCircles:a}=e,u=Math.max(e.outerRadius-s,0),c=e.innerRadius+s;let d;for(t&&cP(n,e,o+sr),n.beginPath(),n.arc(r,i,c,o+sr,o,!0),d=0;d<a;++d)n.stroke();for(n.beginPath(),n.arc(r,i,u,o,o+sr),d=0;d<a;++d)n.stroke()}(n,e,s),s&&cP(n,e,i),A_(n,e,t,r,i),n.stroke())}(e,this,s,o,function(n,e,t,r){const{fullCircles:i,startAngle:o,circumference:s}=e;let a=e.endAngle;if(i){A_(n,e,t,r,o+sr);for(let u=0;u<i;++u)n.fill();isNaN(s)||(a=o+s%sr,s%sr==0&&(a+=sr))}return A_(n,e,t,r,a),n.fill(),a}(e,this,s,o)),e.restore()}}function lP(n,e,t=e){n.lineCap=en(t.borderCapStyle,e.borderCapStyle),n.setLineDash(en(t.borderDash,e.borderDash)),n.lineDashOffset=en(t.borderDashOffset,e.borderDashOffset),n.lineJoin=en(t.borderJoinStyle,e.borderJoinStyle),n.lineWidth=en(t.borderWidth,e.borderWidth),n.strokeStyle=en(t.borderColor,e.borderColor)}function kie(n,e,t){n.lineTo(t.x,t.y)}function hP(n,e,t={}){const r=n.length,{start:i=0,end:o=r-1}=t,{start:s,end:a}=e,u=Math.max(i,s),c=Math.min(o,a);return{count:r,start:u,loop:e.loop,ilen:c<u&&!(i<s&&o<s||i>a&&o>a)?r+c-u:c-u}}function Fie(n,e,t,r){const{points:i,options:o}=e,{count:s,start:a,loop:u,ilen:c}=hP(i,t,r),d=function(n){return n.stepped?Zte:n.tension||"monotone"===n.cubicInterpolationMode?Jte:kie}(o);let y,w,C,{move:p=!0,reverse:m}=r||{};for(y=0;y<=c;++y)w=i[(a+(m?c-y:y))%s],!w.skip&&(p?(n.moveTo(w.x,w.y),p=!1):d(n,C,w,m,o.stepped),C=w);return u&&(w=i[(a+(m?c:0))%s],d(n,C,w,m,o.stepped)),!!u}function Lie(n,e,t,r){const i=e.points,{count:o,start:s,ilen:a}=hP(i,t,r),{move:u=!0,reverse:c}=r||{};let m,y,w,C,_,A,d=0,p=0;const T=M=>(s+(c?a-M:M))%o,N=()=>{C!==_&&(n.lineTo(d,_),n.lineTo(d,C),n.lineTo(d,A))};for(u&&(y=i[T(0)],n.moveTo(y.x,y.y)),m=0;m<=a;++m){if(y=i[T(m)],y.skip)continue;const M=y.x,O=y.y,L=0|M;L===w?(O<C?C=O:O>_&&(_=O),d=(p*d+M)/++p):(N(),n.lineTo(M,O),w=L,p=0,C=_=O),A=O}N()}function D_(n){const e=n.options;return n._decimated||n._loop||e.tension||"monotone"===e.cubicInterpolationMode||e.stepped||e.borderDash&&e.borderDash.length?Fie:Lie}Gm.id="arc",Gm.defaults={borderAlign:"center",borderColor:"#fff",borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0},Gm.defaultRoutes={backgroundColor:"backgroundColor"};const jie="function"==typeof Path2D;let Ym=(()=>{class n extends ma{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,r){const i=this.options;!i.tension&&"monotone"!==i.cubicInterpolationMode||i.stepped||this._pointsUpdated||(Ine(this._points,i,t,i.spanGaps?this._loop:this._fullLoop,r),this._pointsUpdated=!0)}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function(n,e){const t=n.points,r=n.options.spanGaps,i=t.length;if(!i)return[];const o=!!n._loop,{start:s,end:a}=function(n,e,t,r){let i=0,o=e-1;if(t&&!r)for(;i<e&&!n[i].skip;)i++;for(;i<e&&n[i].skip;)i++;for(i%=e,t&&(o+=i);o>i&&n[o%e].skip;)o--;return o%=e,{start:i,end:o}}(t,i,o,r);return function(n,e,t,r){return r&&r.setContext&&t?function(n,e,t,r){const i=n._chart.getContext(),o=b4(n.options),{_datasetIndex:s,options:{spanGaps:a}}=n,u=t.length,c=[];let d=o,p=e[0].start,m=p;function y(w,C,_,A){const T=a?-1:1;if(w!==C){for(w+=u;t[w%u].skip;)w-=T;for(;t[C%u].skip;)C+=T;w%u!=C%u&&(c.push({start:w%u,end:C%u,loop:_,style:A}),d=A,p=C%u)}}for(const w of e){p=a?p:w.start;let _,C=t[p%u];for(m=p+1;m<=w.end;m++){const A=t[m%u];_=b4(r.setContext(kc(i,{type:"segment",p0:C,p1:A,p0DataIndex:(m-1)%u,p1DataIndex:m%u,datasetIndex:s}))),Hne(_,d)&&y(p,m-1,w.loop,d),C=A,d=_}p<m-1&&y(p,m-1,w.loop,d)}return c}(n,e,t,r):e}(n,!0===r?[{start:s,end:a,loop:o}]:function(n,e,t,r){const i=n.length,o=[];let u,s=e,a=n[e];for(u=e+1;u<=t;++u){const c=n[u%i];c.skip||c.stop?a.skip||(o.push({start:e%i,end:(u-1)%i,loop:r=!1}),e=s=c.stop?u:null):(s=u,a.skip&&(e=u)),a=c}return null!==s&&o.push({start:e%i,end:s%i,loop:r}),o}(t,s,a<s?a+i:a,!!n._fullLoop&&0===s&&a===i-1),t,e)}(this,this.options.segment))}first(){const t=this.segments;return t.length&&this.points[t[0].start]}last(){const t=this.segments,i=t.length;return i&&this.points[t[i-1].end]}interpolate(t,r){const i=this.options,o=t[r],s=this.points,a=y4(this,{property:r,start:o,end:o});if(!a.length)return;const u=[],c=function(n){return n.stepped?One:n.tension||"monotone"===n.cubicInterpolationMode?kne:Ll}(i);let d,p;for(d=0,p=a.length;d<p;++d){const{start:m,end:y}=a[d],w=s[m],C=s[y];if(w===C){u.push(w);continue}const A=c(w,C,Math.abs((o-w[r])/(C[r]-w[r])),i.stepped);A[r]=t[r],u.push(A)}return 1===u.length?u[0]:u}pathSegment(t,r,i){return D_(this)(t,this,r,i)}path(t,r,i){const o=this.segments,s=D_(this);let a=this._loop;r=r||0,i=i||this.points.length-r;for(const u of o)a&=s(t,this,u,{start:r,end:r+i-1});return!!a}draw(t,r,i,o){(this.points||[]).length&&(this.options||{}).borderWidth&&(t.save(),function(n,e,t,r){jie&&!e.options.segment?function(n,e,t,r){let i=e._path;i||(i=e._path=new Path2D,e.path(i,t,r)&&i.closePath()),lP(n,e.options),n.stroke(i)}(n,e,t,r):function(n,e,t,r){const{segments:i,options:o}=e,s=D_(e);for(const a of i)lP(n,o,a.style),n.beginPath(),s(n,e,a,{start:t,end:t+r-1})&&n.closePath(),n.stroke()}(n,e,t,r)}(t,this,i,o),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}return n.id="line",n.defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0},n.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"},n.descriptors={_scriptable:!0,_indexable:e=>"borderDash"!==e&&"fill"!==e},n})();function dP(n,e,t,r){const i=n.options,{[t]:o}=n.getProps([t],r);return Math.abs(e-o)<i.radius+i.hitRadius}let Hie=(()=>{class n extends ma{constructor(t){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,r,i){const o=this.options,{x:s,y:a}=this.getProps(["x","y"],i);return Math.pow(t-s,2)+Math.pow(r-a,2)<Math.pow(o.hitRadius+o.radius,2)}inXRange(t,r){return dP(this,t,"x",r)}inYRange(t,r){return dP(this,t,"y",r)}getCenterPoint(t){const{x:r,y:i}=this.getProps(["x","y"],t);return{x:r,y:i}}size(t){let r=(t=t||this.options||{}).radius||0;return r=Math.max(r,r&&t.hoverRadius||0),2*(r+(r&&t.borderWidth||0))}draw(t,r){const i=this.options;this.skip||i.radius<.1||!kl(this,r,this.size(i)/2)||(t.strokeStyle=i.borderColor,t.lineWidth=i.borderWidth,t.fillStyle=i.backgroundColor,Mm(t,i,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}return n.id="point",n.defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0},n.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"},n})();function fP(n,e){const{x:t,y:r,base:i,width:o,height:s}=n.getProps(["x","y","base","width","height"],e);let a,u,c,d,p;return n.horizontal?(p=s/2,a=Math.min(t,i),u=Math.max(t,i),c=r-p,d=r+p):(p=o/2,a=t-p,u=t+p,c=Math.min(r,i),d=Math.max(r,i)),{left:a,top:c,right:u,bottom:d}}function Fc(n,e,t,r){return n?0:Li(e,t,r)}function S_(n,e,t,r){const i=null===e,o=null===t,a=n&&!(i&&o)&&fP(n,r);return a&&(i||e>=a.left&&e<=a.right)&&(o||t>=a.top&&t<=a.bottom)}function qie(n,e){n.rect(e.x,e.y,e.w,e.h)}function T_(n,e,t={}){const r=n.x!==t.x?-e:0,i=n.y!==t.y?-e:0;return{x:n.x+r,y:n.y+i,w:n.w+((n.x+n.w!==t.x+t.w?e:0)-r),h:n.h+((n.y+n.h!==t.y+t.h?e:0)-i),radius:n.radius}}class Xm extends ma{constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:t,options:{borderColor:r,backgroundColor:i}}=this,{inner:o,outer:s}=function(n){const e=fP(n),t=e.right-e.left,r=e.bottom-e.top,i=function(n,e,t){const i=n.borderSkipped,o=Kk(n.options.borderWidth);return{t:Fc(i.top,o.top,0,t),r:Fc(i.right,o.right,0,e),b:Fc(i.bottom,o.bottom,0,t),l:Fc(i.left,o.left,0,e)}}(n,t/2,r/2),o=function(n,e,t){const{enableBorderRadius:r}=n.getProps(["enableBorderRadius"]),i=n.options.borderRadius,o=Ad(i),s=Math.min(e,t),a=n.borderSkipped,u=r||vn(i);return{topLeft:Fc(!u||a.top||a.left,o.topLeft,0,s),topRight:Fc(!u||a.top||a.right,o.topRight,0,s),bottomLeft:Fc(!u||a.bottom||a.left,o.bottomLeft,0,s),bottomRight:Fc(!u||a.bottom||a.right,o.bottomRight,0,s)}}(n,t/2,r/2);return{outer:{x:e.left,y:e.top,w:t,h:r,radius:o},inner:{x:e.left+i.l,y:e.top+i.t,w:t-i.l-i.r,h:r-i.t-i.b,radius:{topLeft:Math.max(0,o.topLeft-Math.max(i.t,i.l)),topRight:Math.max(0,o.topRight-Math.max(i.t,i.r)),bottomLeft:Math.max(0,o.bottomLeft-Math.max(i.b,i.l)),bottomRight:Math.max(0,o.bottomRight-Math.max(i.b,i.r))}}}}(this),a=function(n){return n.topLeft||n.topRight||n.bottomLeft||n.bottomRight}(s.radius)?Om:qie;e.save(),(s.w!==o.w||s.h!==o.h)&&(e.beginPath(),a(e,T_(s,t,o)),e.clip(),a(e,T_(o,-t,s)),e.fillStyle=r,e.fill("evenodd")),e.beginPath(),a(e,T_(o,t)),e.fillStyle=i,e.fill(),e.restore()}inRange(e,t,r){return S_(this,e,t,r)}inXRange(e,t){return S_(this,e,null,t)}inYRange(e,t){return S_(this,null,e,t)}getCenterPoint(e){const{x:t,y:r,base:i,horizontal:o}=this.getProps(["x","y","base","horizontal"],e);return{x:o?(t+i)/2:t,y:o?r:(r+i)/2}}getRange(e){return"x"===e?this.width/2:this.height/2}}Xm.id="bar",Xm.defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0},Xm.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};var $ie=Object.freeze({__proto__:null,ArcElement:Gm,LineElement:Ym,PointElement:Hie,BarElement:Xm});function pP(n){if(n._decimated){const e=n._data;delete n._decimated,delete n._data,Object.defineProperty(n,"data",{value:e})}}function gP(n){n.data.datasets.forEach(e=>{pP(e)})}var Jie={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(n,e,t)=>{if(!t.enabled)return void gP(n);const r=n.width;n.data.datasets.forEach((i,o)=>{const{_data:s,indexAxis:a}=i,u=n.getDatasetMeta(o),c=s||i.data;if("y"===eg([a,n.options.indexAxis])||"line"!==u.type)return;const d=n.scales[u.xAxisID];if("linear"!==d.type&&"time"!==d.type||n.options.parsing)return;let w,{start:p,count:m}=function(n,e){const t=e.length;let i,r=0;const{iScale:o}=n,{min:s,max:a,minDefined:u,maxDefined:c}=o.getUserBounds();return u&&(r=Li(Fu(e,o.axis,s).lo,0,t-1)),i=c?Li(Fu(e,o.axis,a).hi+1,r,t)-r:t-r,{start:r,count:i}}(u,c);if(m<=(t.threshold||4*r))pP(i);else{switch(Un(s)&&(i._data=c,delete i.data,Object.defineProperty(i,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(C){this._data=C}})),t.algorithm){case"lttb":w=function(n,e,t,r,i){const o=i.samples||r;if(o>=t)return n.slice(e,e+t);const s=[],a=(t-2)/(o-2);let u=0;const c=e+t-1;let p,m,y,w,C,d=e;for(s[u++]=n[d],p=0;p<o-2;p++){let T,_=0,A=0;const N=Math.floor((p+1)*a)+1+e,M=Math.min(Math.floor((p+2)*a)+1,t)+e,O=M-N;for(T=N;T<M;T++)_+=n[T].x,A+=n[T].y;_/=O,A/=O;const L=Math.floor(p*a)+1+e,V=Math.min(Math.floor((p+1)*a)+1,t)+e,{x:j,y:U}=n[d];for(y=w=-1,T=L;T<V;T++)w=.5*Math.abs((j-_)*(n[T].y-U)-(j-n[T].x)*(A-U)),w>y&&(y=w,m=n[T],C=T);s[u++]=m,d=C}return s[u++]=n[c],s}(c,p,m,r,t);break;case"min-max":w=function(n,e,t,r){let s,a,u,c,d,p,m,y,w,C,i=0,o=0;const _=[],T=n[e].x,M=n[e+t-1].x-T;for(s=e;s<e+t;++s){a=n[s],u=(a.x-T)/M*r,c=a.y;const O=0|u;if(O===d)c<w?(w=c,p=s):c>C&&(C=c,m=s),i=(o*i+a.x)/++o;else{const L=s-1;if(!Un(p)&&!Un(m)){const V=Math.min(p,m),j=Math.max(p,m);V!==y&&V!==L&&_.push(G_(z_({},n[V]),{x:i})),j!==y&&j!==L&&_.push(G_(z_({},n[j]),{x:i}))}s>0&&L!==y&&_.push(n[L]),_.push(a),d=O,o=0,w=C=c,p=m=y=s}}return _}(c,p,m,r);break;default:throw new Error(`Unsupported decimation algorithm '${t.algorithm}'`)}i._decimated=w}})},destroy(n){gP(n)}};function noe(n,e,t){const r=function(n){const e=n.options,t=e.fill;let r=en(t&&t.target,t);return void 0===r&&(r=!!e.backgroundColor),!1!==r&&null!==r&&(!0===r?"origin":r)}(n);if(vn(r))return!isNaN(r.value)&&r;let i=parseFloat(r);return ei(i)&&Math.floor(i)===i?(("-"===r[0]||"+"===r[0])&&(i=e+i),!(i===e||i<0||i>=t)&&i):["origin","start","end","stack","shape"].indexOf(r)>=0&&r}class mP{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,t,r){const{x:i,y:o,radius:s}=this;return e.arc(i,o,s,(t=t||{start:0,end:sr}).end,t.start,!0),!r.bounds}interpolate(e){const{x:t,y:r,radius:i}=this,o=e.angle;return{x:t+Math.cos(o)*i,y:r+Math.sin(o)*i,angle:o}}}function vP(n,e,t){for(;e>n;e--){const r=t[e];if(!isNaN(r.x)&&!isNaN(r.y))break}return e}function coe(n,e,t){const r=[];for(let i=0;i<t.length;i++){const o=t[i],{first:s,last:a,point:u}=loe(o,e,"x");if(!(!u||s&&a))if(s)r.unshift(u);else if(n.push(u),!a)break}n.push(...r)}function loe(n,e,t){const r=n.interpolate(e,t);if(!r)return{};const i=r[t],o=n.segments,s=n.points;let a=!1,u=!1;for(let c=0;c<o.length;c++){const d=o[c],p=s[d.start][t],m=s[d.end][t];if(i>=p&&i<=m){a=i===p,u=i===m;break}}return{first:a,last:u,point:r}}function hoe(n){const{chart:e,fill:t,line:r}=n;if(ei(t))return function(n,e){const t=n.getDatasetMeta(e);return t&&n.isDatasetVisible(e)?t.dataset:null}(e,t);if("stack"===t)return function(n){const{scale:e,index:t,line:r}=n,i=[],o=r.segments,s=r.points,a=function(n,e){const t=[],r=n.getMatchingVisibleMetas("line");for(let i=0;i<r.length;i++){const o=r[i];if(o.index===e)break;o.hidden||t.unshift(o.dataset)}return t}(e,t);a.push(yP({x:null,y:e.bottom},r));for(let u=0;u<o.length;u++){const c=o[u];for(let d=c.start;d<=c.end;d++)coe(i,s[d],a)}return new Ym({points:i,options:{}})}(n);if("shape"===t)return!0;const i=function(n){return(n.scale||{}).getPointPositionForValue?function(n){const{scale:e,fill:t}=n,r=e.options,i=e.getLabels().length,o=[],s=r.reverse?e.max:e.min;let u,c,d;if(d="start"===t?s:"end"===t?r.reverse?e.min:e.max:vn(t)?t.value:e.getBaseValue(),r.grid.circular)return c=e.getPointPositionForValue(0,s),new mP({x:c.x,y:c.y,radius:e.getDistanceFromCenterForValue(d)});for(u=0;u<i;++u)o.push(e.getPointPositionForValue(u,d));return o}(n):function(n){const{scale:e={},fill:t}=n;let i,r=null;return"start"===t?r=e.bottom:"end"===t?r=e.top:vn(t)?r=e.getPixelForValue(t.value):e.getBasePixel&&(r=e.getBasePixel()),ei(r)?(i=e.isHorizontal(),{x:i?r:null,y:i?null:r}):null}(n)}(n);return i instanceof mP?i:yP(i,r)}function yP(n,e){let t=[],r=!1;return hr(n)?(r=!0,t=n):t=function(n,e){const{x:t=null,y:r=null}=n||{},i=e.points,o=[];return e.segments.forEach(({start:s,end:a})=>{a=vP(s,a,i);const u=i[s],c=i[a];null!==r?(o.push({x:u.x,y:r}),o.push({x:c.x,y:r})):null!==t&&(o.push({x:t,y:u.y}),o.push({x:t,y:c.y}))}),o}(n,e),t.length?new Ym({points:t,options:{tension:0},_loop:r,_fullLoop:r}):null}function doe(n,e,t){let i=n[e].fill;const o=[e];let s;if(!t)return i;for(;!1!==i&&-1===o.indexOf(i);){if(!ei(i))return i;if(s=n[i],!s)return!1;if(s.visible)return i;o.push(i),i=s.fill}return!1}function xP(n,e,t){n.beginPath(),e.path(n),n.lineTo(e.last().x,t),n.lineTo(e.first().x,t),n.closePath(),n.clip()}function M_(n,e,t,r){if(r)return;let i=e[n],o=t[n];return"angle"===n&&(i=ga(i),o=ga(o)),{property:n,start:i,end:o}}function bP(n,e,t,r){return n&&e?r(n[t],e[t]):n?n[t]:e?e[t]:0}function poe(n,e,t){const{top:r,bottom:i}=e.chart.chartArea,{property:o,start:s,end:a}=t||{};"x"===o&&(n.beginPath(),n.rect(s,r,a-s,i-r),n.clip())}function wP(n,e,t,r){const i=e.interpolate(t,r);i&&n.lineTo(i.x,i.y)}function _P(n,e){const{line:t,target:r,property:i,color:o,scale:s}=e,a=function(n,e,t){const r=n.segments,i=n.points,o=e.points,s=[];for(const a of r){let{start:u,end:c}=a;c=vP(u,c,i);const d=M_(t,i[u],i[c],a.loop);if(!e.segments){s.push({source:a,target:d,start:i[u],end:i[c]});continue}const p=y4(e,d);for(const m of p){const y=M_(t,o[m.start],o[m.end],m.loop),w=v4(a,i,y);for(const C of w)s.push({source:C,target:m,start:{[t]:bP(d,y,"start",Math.max)},end:{[t]:bP(d,y,"end",Math.min)}})}}return s}(t,r,i);for(const{source:u,target:c,start:d,end:p}of a){const{style:{backgroundColor:m=o}={}}=u,y=!0!==r;n.save(),n.fillStyle=m,poe(n,s,y&&M_(i,d,p)),n.beginPath();const w=!!t.pathSegment(n,u);let C;if(y){w?n.closePath():wP(n,r,p,i);const _=!!r.pathSegment(n,c,{move:w,reverse:!0});C=w&&_,C||wP(n,r,d,i)}n.closePath(),n.fill(C?"evenodd":"nonzero"),n.restore()}}function R_(n,e,t){const r=hoe(e),{line:i,scale:o,axis:s}=e,a=i.options,u=a.fill,c=a.backgroundColor,{above:d=c,below:p=c}=u||{};r&&i.points.length&&(Rm(n,t),function(n,e){const{line:t,target:r,above:i,below:o,area:s,scale:a}=e,u=t._loop?"angle":e.axis;n.save(),"x"===u&&o!==i&&(xP(n,r,s.top),_P(n,{line:t,target:r,color:i,scale:a,property:u}),n.restore(),n.save(),xP(n,r,s.bottom)),_P(n,{line:t,target:r,color:o,scale:a,property:u}),n.restore()}(n,{line:i,target:r,above:d,below:p,area:t,scale:o,axis:s}),Nm(n))}var moe={id:"filler",afterDatasetsUpdate(n,e,t){const r=(n.data.datasets||[]).length,i=[];let o,s,a,u;for(s=0;s<r;++s)o=n.getDatasetMeta(s),a=o.dataset,u=null,a&&a.options&&a instanceof Ym&&(u={visible:n.isDatasetVisible(s),index:s,fill:noe(a,s,r),chart:n,axis:o.controller.options.indexAxis,scale:o.vScale,line:a}),o.$filler=u,i.push(u);for(s=0;s<r;++s)u=i[s],u&&!1!==u.fill&&(u.fill=doe(i,s,t.propagate))},beforeDraw(n,e,t){const r="beforeDraw"===t.drawTime,i=n.getSortedVisibleDatasetMetas(),o=n.chartArea;for(let s=i.length-1;s>=0;--s){const a=i[s].$filler;!a||(a.line.updateControlPoints(o,a.axis),r&&R_(n.ctx,a,o))}},beforeDatasetsDraw(n,e,t){if("beforeDatasetsDraw"!==t.drawTime)return;const r=n.getSortedVisibleDatasetMetas();for(let i=r.length-1;i>=0;--i){const o=r[i].$filler;o&&R_(n.ctx,o,n.chartArea)}},beforeDatasetDraw(n,e,t){const r=e.meta.$filler;!r||!1===r.fill||"beforeDatasetDraw"!==t.drawTime||R_(n.ctx,r,n.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const CP=(n,e)=>{let{boxHeight:t=e,boxWidth:r=e}=n;return n.usePointStyle&&(t=Math.min(t,e),r=Math.min(r,e)),{boxWidth:r,boxHeight:t,itemHeight:Math.max(e,t)}};class EP extends ma{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t,r){this.maxWidth=e,this.maxHeight=t,this._margins=r,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let t=dr(e.generateLabels,[this.chart],this)||[];e.filter&&(t=t.filter(r=>e.filter(r,this.chart.data))),e.sort&&(t=t.sort((r,i)=>e.sort(r,i,this.chart.data))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){const{options:e,ctx:t}=this;if(!e.display)return void(this.width=this.height=0);const r=e.labels,i=Ai(r.font),o=i.size,s=this._computeTitleHeight(),{boxWidth:a,itemHeight:u}=CP(r,o);let c,d;t.font=i.string,this.isHorizontal()?(c=this.maxWidth,d=this._fitRows(s,o,a,u)+10):(d=this.maxHeight,c=this._fitCols(s,o,a,u)+10),this.width=Math.min(c,e.maxWidth||this.maxWidth),this.height=Math.min(d,e.maxHeight||this.maxHeight)}_fitRows(e,t,r,i){const{ctx:o,maxWidth:s,options:{labels:{padding:a}}}=this,u=this.legendHitBoxes=[],c=this.lineWidths=[0],d=i+a;let p=e;o.textAlign="left",o.textBaseline="middle";let m=-1,y=-d;return this.legendItems.forEach((w,C)=>{const _=r+t/2+o.measureText(w.text).width;(0===C||c[c.length-1]+_+2*a>s)&&(p+=d,c[c.length-(C>0?0:1)]=0,y+=d,m++),u[C]={left:0,top:y,row:m,width:_,height:i},c[c.length-1]+=_+a}),p}_fitCols(e,t,r,i){const{ctx:o,maxHeight:s,options:{labels:{padding:a}}}=this,u=this.legendHitBoxes=[],c=this.columnSizes=[],d=s-e;let p=a,m=0,y=0,w=0,C=0;return this.legendItems.forEach((_,A)=>{const T=r+t/2+o.measureText(_.text).width;A>0&&y+i+2*a>d&&(p+=m+a,c.push({width:m,height:y}),w+=m+a,C++,m=y=0),u[A]={left:w,top:y,col:C,width:T,height:i},m=Math.max(m,T),y+=i+a}),p+=m,c.push({width:m,height:y}),p}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:r,labels:{padding:i},rtl:o}}=this,s=Td(o,this.left,this.width);if(this.isHorizontal()){let a=0,u=uo(r,this.left+i,this.right-this.lineWidths[a]);for(const c of t)a!==c.row&&(a=c.row,u=uo(r,this.left+i,this.right-this.lineWidths[a])),c.top+=this.top+e+i,c.left=s.leftForLtr(s.x(u),c.width),u+=c.width+i}else{let a=0,u=uo(r,this.top+e+i,this.bottom-this.columnSizes[a].height);for(const c of t)c.col!==a&&(a=c.col,u=uo(r,this.top+e+i,this.bottom-this.columnSizes[a].height)),c.top=u,c.left+=this.left+i,c.left=s.leftForLtr(s.x(c.left),c.width),u+=c.height+i}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const e=this.ctx;Rm(e,this),this._draw(),Nm(e)}}_draw(){const{options:e,columnSizes:t,lineWidths:r,ctx:i}=this,{align:o,labels:s}=e,a=bn.color,u=Td(e.rtl,this.left,this.width),c=Ai(s.font),{color:d,padding:p}=s,m=c.size,y=m/2;let w;this.drawTitle(),i.textAlign=u.textAlign("left"),i.textBaseline="middle",i.lineWidth=.5,i.font=c.string;const{boxWidth:C,boxHeight:_,itemHeight:A}=CP(s,m),M=this.isHorizontal(),O=this._computeTitleHeight();w=M?{x:uo(o,this.left+p,this.right-r[0]),y:this.top+p+O,line:0}:{x:this.left+p,y:uo(o,this.top+O+p,this.bottom-t[0].height),line:0},f4(this.ctx,e.textDirection);const L=A+p;this.legendItems.forEach((V,j)=>{i.strokeStyle=V.fontColor||d,i.fillStyle=V.fontColor||d;const U=i.measureText(V.text).width,G=u.textAlign(V.textAlign||(V.textAlign=s.textAlign)),K=C+y+U;let $=w.x,he=w.y;u.setWidth(this.width),M?j>0&&$+K+p>this.right&&(he=w.y+=L,w.line++,$=w.x=uo(o,this.left+p,this.right-r[w.line])):j>0&&he+L>this.bottom&&($=w.x=$+t[w.line].width+p,w.line++,he=w.y=uo(o,this.top+O+p,this.bottom-t[w.line].height)),function(V,j,U){if(isNaN(C)||C<=0||isNaN(_)||_<0)return;i.save();const G=en(U.lineWidth,1);if(i.fillStyle=en(U.fillStyle,a),i.lineCap=en(U.lineCap,"butt"),i.lineDashOffset=en(U.lineDashOffset,0),i.lineJoin=en(U.lineJoin,"miter"),i.lineWidth=G,i.strokeStyle=en(U.strokeStyle,a),i.setLineDash(en(U.lineDash,[])),s.usePointStyle){const K={radius:C*Math.SQRT2/2,pointStyle:U.pointStyle,rotation:U.rotation,borderWidth:G},$=u.xPlus(V,C/2);Mm(i,K,$,j+y)}else{const K=j+Math.max((m-_)/2,0),$=u.leftForLtr(V,C),he=Ad(U.borderRadius);i.beginPath(),Object.values(he).some(de=>0!==de)?Om(i,{x:$,y:K,w:C,h:_,radius:he}):i.rect($,K,C,_),i.fill(),0!==G&&i.stroke()}i.restore()}(u.x($),he,V),$=((n,e,t,r)=>n===(r?"left":"right")?t:"center"===n?(e+t)/2:e)(G,$+C+y,M?$+K:this.right,e.rtl),function(V,j,U){Pl(i,U.text,V,j+A/2,c,{strikethrough:U.hidden,textAlign:u.textAlign(U.textAlign)})}(u.x($),he,V),M?w.x+=K+p:w.y+=L}),p4(this.ctx,e.textDirection)}drawTitle(){const e=this.options,t=e.title,r=Ai(t.font),i=Io(t.padding);if(!t.display)return;const o=Td(e.rtl,this.left,this.width),s=this.ctx,a=t.position,c=i.top+r.size/2;let d,p=this.left,m=this.width;if(this.isHorizontal())m=Math.max(...this.lineWidths),d=this.top+c,p=uo(e.align,p,this.right-m);else{const w=this.columnSizes.reduce((C,_)=>Math.max(C,_.height),0);d=c+uo(e.align,this.top,this.bottom-w-e.labels.padding-this._computeTitleHeight())}const y=uo(a,p,p+m);s.textAlign=o.textAlign(e_(a)),s.textBaseline="middle",s.strokeStyle=t.color,s.fillStyle=t.color,s.font=r.string,Pl(s,t.text,y,d,r)}_computeTitleHeight(){const e=this.options.title,t=Ai(e.font),r=Io(e.padding);return e.display?t.lineHeight+r.height:0}_getLegendItemAt(e,t){let r,i,o;if(e>=this.left&&e<=this.right&&t>=this.top&&t<=this.bottom)for(o=this.legendHitBoxes,r=0;r<o.length;++r)if(i=o[r],e>=i.left&&e<=i.left+i.width&&t>=i.top&&t<=i.top+i.height)return this.legendItems[r];return null}handleEvent(e){const t=this.options;if(!function(n,e){return!!("mousemove"===n&&(e.onHover||e.onLeave)||e.onClick&&("click"===n||"mouseup"===n))}(e.type,t))return;const r=this._getLegendItemAt(e.x,e.y);if("mousemove"===e.type){const i=this._hoveredItem,o=((n,e)=>null!==n&&null!==e&&n.datasetIndex===e.datasetIndex&&n.index===e.index)(i,r);i&&!o&&dr(t.onLeave,[e,i,this],this),this._hoveredItem=r,r&&!o&&dr(t.onHover,[e,r,this],this)}else r&&dr(t.onClick,[e,r,this],this)}}var xoe={id:"legend",_element:EP,start(n,e,t){const r=n.legend=new EP({ctx:n.ctx,options:t,chart:n});co.configure(n,r,t),co.addBox(n,r)},stop(n){co.removeBox(n,n.legend),delete n.legend},beforeUpdate(n,e,t){const r=n.legend;co.configure(n,r,t),r.options=t},afterUpdate(n){const e=n.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(n,e){e.replay||n.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(n,e,t){const r=e.datasetIndex,i=t.chart;i.isDatasetVisible(r)?(i.hide(r),e.hidden=!0):(i.show(r),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:n=>n.chart.options.color,boxWidth:40,padding:10,generateLabels(n){const e=n.data.datasets,{labels:{usePointStyle:t,pointStyle:r,textAlign:i,color:o}}=n.legend.options;return n._getSortedDatasetMetas().map(s=>{const a=s.controller.getStyle(t?0:void 0),u=Io(a.borderWidth);return{text:e[s.index].label,fillStyle:a.backgroundColor,fontColor:o,hidden:!s.visible,lineCap:a.borderCapStyle,lineDash:a.borderDash,lineDashOffset:a.borderDashOffset,lineJoin:a.borderJoinStyle,lineWidth:(u.width+u.height)/4,strokeStyle:a.borderColor,pointStyle:r||a.pointStyle,rotation:a.rotation,textAlign:i||a.textAlign,borderRadius:0,datasetIndex:s.index}},this)}},title:{color:n=>n.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:n=>!n.startsWith("on"),labels:{_scriptable:n=>!["generateLabels","filter","sort"].includes(n)}}};class N_ extends ma{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t){const r=this.options;if(this.left=0,this.top=0,!r.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=e,this.height=this.bottom=t;const i=hr(r.text)?r.text.length:1;this._padding=Io(r.padding);const o=i*Ai(r.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=o:this.width=o}isHorizontal(){const e=this.options.position;return"top"===e||"bottom"===e}_drawArgs(e){const{top:t,left:r,bottom:i,right:o,options:s}=this,a=s.align;let c,d,p,u=0;return this.isHorizontal()?(d=uo(a,r,o),p=t+e,c=o-r):("left"===s.position?(d=r+e,p=uo(a,i,t),u=-.5*Xr):(d=o-e,p=uo(a,t,i),u=.5*Xr),c=i-t),{titleX:d,titleY:p,maxWidth:c,rotation:u}}draw(){const e=this.ctx,t=this.options;if(!t.display)return;const r=Ai(t.font),o=r.lineHeight/2+this._padding.top,{titleX:s,titleY:a,maxWidth:u,rotation:c}=this._drawArgs(o);Pl(e,t.text,0,0,r,{color:t.color,maxWidth:u,rotation:c,textAlign:e_(t.align),textBaseline:"middle",translation:[s,a]})}}var woe={id:"title",_element:N_,start(n,e,t){!function(n,e){const t=new N_({ctx:n.ctx,options:e,chart:n});co.configure(n,t,e),co.addBox(n,t),n.titleBlock=t}(n,t)},stop(n){co.removeBox(n,n.titleBlock),delete n.titleBlock},beforeUpdate(n,e,t){const r=n.titleBlock;co.configure(n,r,t),r.options=t},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const qm=new WeakMap;var _oe={id:"subtitle",start(n,e,t){const r=new N_({ctx:n.ctx,options:t,chart:n});co.configure(n,r,t),co.addBox(n,r),qm.set(n,r)},stop(n){co.removeBox(n,qm.get(n)),qm.delete(n)},beforeUpdate(n,e,t){const r=qm.get(n);co.configure(n,r,t),r.options=t},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const lg={average(n){if(!n.length)return!1;let e,t,r=0,i=0,o=0;for(e=0,t=n.length;e<t;++e){const s=n[e].element;if(s&&s.hasValue()){const a=s.tooltipPosition();r+=a.x,i+=a.y,++o}}return{x:r/o,y:i/o}},nearest(n,e){if(!n.length)return!1;let o,s,a,t=e.x,r=e.y,i=Number.POSITIVE_INFINITY;for(o=0,s=n.length;o<s;++o){const u=n[o].element;if(u&&u.hasValue()){const d=r_(e,u.getCenterPoint());d<i&&(i=d,a=u)}}if(a){const u=a.tooltipPosition();t=u.x,r=u.y}return{x:t,y:r}}};function Ja(n,e){return e&&(hr(e)?Array.prototype.push.apply(n,e):n.push(e)),n}function Uu(n){return("string"==typeof n||n instanceof String)&&n.indexOf("\n")>-1?n.split("\n"):n}function Coe(n,e){const{element:t,datasetIndex:r,index:i}=e,o=n.getDatasetMeta(r).controller,{label:s,value:a}=o.getLabelAndValue(i);return{chart:n,label:s,parsed:o.getParsed(i),raw:n.data.datasets[r].data[i],formattedValue:a,dataset:o.getDataset(),dataIndex:i,datasetIndex:r,element:t}}function IP(n,e){const t=n._chart.ctx,{body:r,footer:i,title:o}=n,{boxWidth:s,boxHeight:a}=e,u=Ai(e.bodyFont),c=Ai(e.titleFont),d=Ai(e.footerFont),p=o.length,m=i.length,y=r.length,w=Io(e.padding);let C=w.height,_=0,A=r.reduce((M,O)=>M+O.before.length+O.lines.length+O.after.length,0);A+=n.beforeBody.length+n.afterBody.length,p&&(C+=p*c.lineHeight+(p-1)*e.titleSpacing+e.titleMarginBottom),A&&(C+=y*(e.displayColors?Math.max(a,u.lineHeight):u.lineHeight)+(A-y)*u.lineHeight+(A-1)*e.bodySpacing),m&&(C+=e.footerMarginTop+m*d.lineHeight+(m-1)*e.footerSpacing);let T=0;const N=function(M){_=Math.max(_,t.measureText(M).width+T)};return t.save(),t.font=c.string,Zn(n.title,N),t.font=u.string,Zn(n.beforeBody.concat(n.afterBody),N),T=e.displayColors?s+2+e.boxPadding:0,Zn(r,M=>{Zn(M.before,N),Zn(M.lines,N),Zn(M.after,N)}),T=0,t.font=d.string,Zn(n.footer,N),t.restore(),_+=w.width,{width:_,height:C}}function Aoe(n,e,t,r){const{x:i,width:o}=t,{width:s,chartArea:{left:a,right:u}}=n;let c="center";return"center"===r?c=i<=(a+u)/2?"left":"right":i<=o/2?c="left":i>=s-o/2&&(c="right"),function(n,e,t,r){const{x:i,width:o}=r,s=t.caretSize+t.caretPadding;if("left"===n&&i+o+s>e.width||"right"===n&&i-o-s<0)return!0}(c,n,e,t)&&(c="center"),c}function AP(n,e,t){const r=e.yAlign||function(n,e){const{y:t,height:r}=e;return t<r/2?"top":t>n.height-r/2?"bottom":"center"}(n,t);return{xAlign:e.xAlign||Aoe(n,e,t,r),yAlign:r}}function DP(n,e,t,r){const{caretSize:i,caretPadding:o,cornerRadius:s}=n,{xAlign:a,yAlign:u}=t,c=i+o,{topLeft:d,topRight:p,bottomLeft:m,bottomRight:y}=Ad(s);let w=function(n,e){let{x:t,width:r}=n;return"right"===e?t-=r:"center"===e&&(t-=r/2),t}(e,a);const C=function(n,e,t){let{y:r,height:i}=n;return"top"===e?r+=t:r-="bottom"===e?i+t:i/2,r}(e,u,c);return"center"===u?"left"===a?w+=c:"right"===a&&(w-=c):"left"===a?w-=Math.max(d,m)+o:"right"===a&&(w+=Math.max(p,y)+o),{x:Li(w,0,r.width-e.width),y:Li(C,0,r.height-e.height)}}function $m(n,e,t){const r=Io(t.padding);return"center"===e?n.x+n.width/2:"right"===e?n.x+n.width-r.right:n.x+r.left}function SP(n){return Ja([],Uu(n))}function TP(n,e){const t=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return t?n.override(t):n}let MP=(()=>{class n extends ma{constructor(t){super(),this.opacity=0,this._active=[],this._chart=t._chart,this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const r=this._chart,i=this.options.setContext(this.getContext()),o=i.enabled&&r.options.animation&&i.animations,s=new _4(this._chart,o);return o._cacheable&&(this._cachedAnimations=Object.freeze(s)),s}getContext(){return this.$context||(this.$context=function(n,e,t){return kc(n,{tooltip:e,tooltipItems:t,type:"tooltip"})}(this._chart.getContext(),this,this._tooltipItems))}getTitle(t,r){const{callbacks:i}=r,o=i.beforeTitle.apply(this,[t]),s=i.title.apply(this,[t]),a=i.afterTitle.apply(this,[t]);let u=[];return u=Ja(u,Uu(o)),u=Ja(u,Uu(s)),u=Ja(u,Uu(a)),u}getBeforeBody(t,r){return SP(r.callbacks.beforeBody.apply(this,[t]))}getBody(t,r){const{callbacks:i}=r,o=[];return Zn(t,s=>{const a={before:[],lines:[],after:[]},u=TP(i,s);Ja(a.before,Uu(u.beforeLabel.call(this,s))),Ja(a.lines,u.label.call(this,s)),Ja(a.after,Uu(u.afterLabel.call(this,s))),o.push(a)}),o}getAfterBody(t,r){return SP(r.callbacks.afterBody.apply(this,[t]))}getFooter(t,r){const{callbacks:i}=r,o=i.beforeFooter.apply(this,[t]),s=i.footer.apply(this,[t]),a=i.afterFooter.apply(this,[t]);let u=[];return u=Ja(u,Uu(o)),u=Ja(u,Uu(s)),u=Ja(u,Uu(a)),u}_createItems(t){const r=this._active,i=this._chart.data,o=[],s=[],a=[];let c,d,u=[];for(c=0,d=r.length;c<d;++c)u.push(Coe(this._chart,r[c]));return t.filter&&(u=u.filter((p,m,y)=>t.filter(p,m,y,i))),t.itemSort&&(u=u.sort((p,m)=>t.itemSort(p,m,i))),Zn(u,p=>{const m=TP(t.callbacks,p);o.push(m.labelColor.call(this,p)),s.push(m.labelPointStyle.call(this,p)),a.push(m.labelTextColor.call(this,p))}),this.labelColors=o,this.labelPointStyles=s,this.labelTextColors=a,this.dataPoints=u,u}update(t,r){const i=this.options.setContext(this.getContext()),o=this._active;let s,a=[];if(o.length){const u=lg[i.position].call(this,o,this._eventPosition);a=this._createItems(i),this.title=this.getTitle(a,i),this.beforeBody=this.getBeforeBody(a,i),this.body=this.getBody(a,i),this.afterBody=this.getAfterBody(a,i),this.footer=this.getFooter(a,i);const c=this._size=IP(this,i),d=Object.assign({},u,c),p=AP(this._chart,i,d),m=DP(i,d,p,this._chart);this.xAlign=p.xAlign,this.yAlign=p.yAlign,s={opacity:1,x:m.x,y:m.y,width:c.width,height:c.height,caretX:u.x,caretY:u.y}}else 0!==this.opacity&&(s={opacity:0});this._tooltipItems=a,this.$context=void 0,s&&this._resolveAnimations().update(this,s),t&&i.external&&i.external.call(this,{chart:this._chart,tooltip:this,replay:r})}drawCaret(t,r,i,o){const s=this.getCaretPosition(t,i,o);r.lineTo(s.x1,s.y1),r.lineTo(s.x2,s.y2),r.lineTo(s.x3,s.y3)}getCaretPosition(t,r,i){const{xAlign:o,yAlign:s}=this,{caretSize:a,cornerRadius:u}=i,{topLeft:c,topRight:d,bottomLeft:p,bottomRight:m}=Ad(u),{x:y,y:w}=t,{width:C,height:_}=r;let A,T,N,M,O,L;return"center"===s?(O=w+_/2,"left"===o?(A=y,T=A-a,M=O+a,L=O-a):(A=y+C,T=A+a,M=O-a,L=O+a),N=A):(T="left"===o?y+Math.max(c,p)+a:"right"===o?y+C-Math.max(d,m)-a:this.caretX,"top"===s?(M=w,O=M-a,A=T-a,N=T+a):(M=w+_,O=M+a,A=T+a,N=T-a),L=M),{x1:A,x2:T,x3:N,y1:M,y2:O,y3:L}}drawTitle(t,r,i){const o=this.title,s=o.length;let a,u,c;if(s){const d=Td(i.rtl,this.x,this.width);for(t.x=$m(this,i.titleAlign,i),r.textAlign=d.textAlign(i.titleAlign),r.textBaseline="middle",a=Ai(i.titleFont),u=i.titleSpacing,r.fillStyle=i.titleColor,r.font=a.string,c=0;c<s;++c)r.fillText(o[c],d.x(t.x),t.y+a.lineHeight/2),t.y+=a.lineHeight+u,c+1===s&&(t.y+=i.titleMarginBottom-u)}}_drawColorBox(t,r,i,o,s){const a=this.labelColors[i],u=this.labelPointStyles[i],{boxHeight:c,boxWidth:d,boxPadding:p}=s,m=Ai(s.bodyFont),y=$m(this,"left",s),w=o.x(y),_=r.y+(c<m.lineHeight?(m.lineHeight-c)/2:0);if(s.usePointStyle){const A={radius:Math.min(d,c)/2,pointStyle:u.pointStyle,rotation:u.rotation,borderWidth:1},T=o.leftForLtr(w,d)+d/2,N=_+c/2;t.strokeStyle=s.multiKeyBackground,t.fillStyle=s.multiKeyBackground,Mm(t,A,T,N),t.strokeStyle=a.borderColor,t.fillStyle=a.backgroundColor,Mm(t,A,T,N)}else{t.lineWidth=a.borderWidth||1,t.strokeStyle=a.borderColor,t.setLineDash(a.borderDash||[]),t.lineDashOffset=a.borderDashOffset||0;const A=o.leftForLtr(w,d-p),T=o.leftForLtr(o.xPlus(w,1),d-p-2),N=Ad(a.borderRadius);Object.values(N).some(M=>0!==M)?(t.beginPath(),t.fillStyle=s.multiKeyBackground,Om(t,{x:A,y:_,w:d,h:c,radius:N}),t.fill(),t.stroke(),t.fillStyle=a.backgroundColor,t.beginPath(),Om(t,{x:T,y:_+1,w:d-2,h:c-2,radius:N}),t.fill()):(t.fillStyle=s.multiKeyBackground,t.fillRect(A,_,d,c),t.strokeRect(A,_,d,c),t.fillStyle=a.backgroundColor,t.fillRect(T,_+1,d-2,c-2))}t.fillStyle=this.labelTextColors[i]}drawBody(t,r,i){const{body:o}=this,{bodySpacing:s,bodyAlign:a,displayColors:u,boxHeight:c,boxWidth:d,boxPadding:p}=i,m=Ai(i.bodyFont);let y=m.lineHeight,w=0;const C=Td(i.rtl,this.x,this.width),_=function(U){r.fillText(U,C.x(t.x+w),t.y+y/2),t.y+=y+s},A=C.textAlign(a);let T,N,M,O,L,V,j;for(r.textAlign=a,r.textBaseline="middle",r.font=m.string,t.x=$m(this,A,i),r.fillStyle=i.bodyColor,Zn(this.beforeBody,_),w=u&&"right"!==A?"center"===a?d/2+p:d+2+p:0,O=0,V=o.length;O<V;++O){for(T=o[O],N=this.labelTextColors[O],r.fillStyle=N,Zn(T.before,_),M=T.lines,u&&M.length&&(this._drawColorBox(r,t,O,C,i),y=Math.max(m.lineHeight,c)),L=0,j=M.length;L<j;++L)_(M[L]),y=m.lineHeight;Zn(T.after,_)}w=0,y=m.lineHeight,Zn(this.afterBody,_),t.y-=s}drawFooter(t,r,i){const o=this.footer,s=o.length;let a,u;if(s){const c=Td(i.rtl,this.x,this.width);for(t.x=$m(this,i.footerAlign,i),t.y+=i.footerMarginTop,r.textAlign=c.textAlign(i.footerAlign),r.textBaseline="middle",a=Ai(i.footerFont),r.fillStyle=i.footerColor,r.font=a.string,u=0;u<s;++u)r.fillText(o[u],c.x(t.x),t.y+a.lineHeight/2),t.y+=a.lineHeight+i.footerSpacing}}drawBackground(t,r,i,o){const{xAlign:s,yAlign:a}=this,{x:u,y:c}=t,{width:d,height:p}=i,{topLeft:m,topRight:y,bottomLeft:w,bottomRight:C}=Ad(o.cornerRadius);r.fillStyle=o.backgroundColor,r.strokeStyle=o.borderColor,r.lineWidth=o.borderWidth,r.beginPath(),r.moveTo(u+m,c),"top"===a&&this.drawCaret(t,r,i,o),r.lineTo(u+d-y,c),r.quadraticCurveTo(u+d,c,u+d,c+y),"center"===a&&"right"===s&&this.drawCaret(t,r,i,o),r.lineTo(u+d,c+p-C),r.quadraticCurveTo(u+d,c+p,u+d-C,c+p),"bottom"===a&&this.drawCaret(t,r,i,o),r.lineTo(u+w,c+p),r.quadraticCurveTo(u,c+p,u,c+p-w),"center"===a&&"left"===s&&this.drawCaret(t,r,i,o),r.lineTo(u,c+m),r.quadraticCurveTo(u,c,u+m,c),r.closePath(),r.fill(),o.borderWidth>0&&r.stroke()}_updateAnimationTarget(t){const r=this._chart,i=this.$animations,o=i&&i.x,s=i&&i.y;if(o||s){const a=lg[t.position].call(this,this._active,this._eventPosition);if(!a)return;const u=this._size=IP(this,t),c=Object.assign({},a,this._size),d=AP(r,t,c),p=DP(t,c,d,r);(o._to!==p.x||s._to!==p.y)&&(this.xAlign=d.xAlign,this.yAlign=d.yAlign,this.width=u.width,this.height=u.height,this.caretX=a.x,this.caretY=a.y,this._resolveAnimations().update(this,p))}}draw(t){const r=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(r);const o={width:this.width,height:this.height},s={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const a=Io(r.padding);r.enabled&&(this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length)&&(t.save(),t.globalAlpha=i,this.drawBackground(s,t,o,r),f4(t,r.textDirection),s.y+=a.top,this.drawTitle(s,t,r),this.drawBody(s,t,r),this.drawFooter(s,t,r),p4(t,r.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,r){const i=this._active,o=t.map(({datasetIndex:u,index:c})=>{const d=this._chart.getDatasetMeta(u);if(!d)throw new Error("Cannot find a dataset at index "+u);return{datasetIndex:u,element:d.data[c],index:c}}),s=!xm(i,o),a=this._positionChanged(o,r);(s||a)&&(this._active=o,this._eventPosition=r,this.update(!0))}handleEvent(t,r){const i=this.options,o=this._active||[];let s=!1,a=[];"mouseout"!==t.type&&(a=this._chart.getElementsAtEventForMode(t,i.mode,i,r),i.reverse&&a.reverse());const u=this._positionChanged(a,t);return s=r||!xm(a,o)||u,s&&(this._active=a,(i.enabled||i.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,r))),s}_positionChanged(t,r){const{caretX:i,caretY:o,options:s}=this,a=lg[s.position].call(this,t,r);return!1!==a&&(i!==a.x||o!==a.y)}}return n.positioners=lg,n})();var Roe=Object.freeze({__proto__:null,Decimation:Jie,Filler:moe,Legend:xoe,SubTitle:_oe,Title:woe,Tooltip:{id:"tooltip",_element:MP,positioners:lg,afterInit(n,e,t){t&&(n.tooltip=new MP({_chart:n,options:t}))},beforeUpdate(n,e,t){n.tooltip&&n.tooltip.initialize(t)},reset(n,e,t){n.tooltip&&n.tooltip.initialize(t)},afterDraw(n){const e=n.tooltip,t={tooltip:e};!1!==n.notifyPlugins("beforeTooltipDraw",t)&&(e&&e.draw(n.ctx),n.notifyPlugins("afterTooltipDraw",t))},afterEvent(n,e){n.tooltip&&n.tooltip.handleEvent(e.event,e.replay)&&(e.changed=!0)},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(n,e)=>e.bodyFont.size,boxWidth:(n,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:{beforeTitle:Pu,title(n){if(n.length>0){const e=n[0],t=e.chart.data.labels,r=t?t.length:0;if(this&&this.options&&"dataset"===this.options.mode)return e.dataset.label||"";if(e.label)return e.label;if(r>0&&e.dataIndex<r)return t[e.dataIndex]}return""},afterTitle:Pu,beforeBody:Pu,beforeLabel:Pu,label(n){if(this&&this.options&&"dataset"===this.options.mode)return n.label+": "+n.formattedValue||n.formattedValue;let e=n.dataset.label||"";e&&(e+=": ");const t=n.formattedValue;return Un(t)||(e+=t),e},labelColor(n){const t=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(n){const t=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:Pu,afterBody:Pu,beforeFooter:Pu,footer:Pu,afterFooter:Pu}},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:n=>"filter"!==n&&"itemSort"!==n&&"external"!==n,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]}});class Km extends Vl{constructor(e){super(e),this._startValue=void 0,this._valueRange=0}parse(e,t){if(Un(e))return null;const r=this.getLabels();return((n,e)=>null===n?null:Li(Math.round(n),0,e))(t=isFinite(t)&&r[t]===e?t:function(n,e,t){const r=n.indexOf(e);return-1===r?((n,e,t)=>"string"==typeof e?n.push(e)-1:isNaN(e)?null:t)(n,e,t):r!==n.lastIndexOf(e)?t:r}(r,e,en(t,e)),r.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let{min:r,max:i}=this.getMinMax(!0);"ticks"===this.options.bounds&&(e||(r=0),t||(i=this.getLabels().length-1)),this.min=r,this.max=i}buildTicks(){const e=this.min,t=this.max,r=this.options.offset,i=[];let o=this.getLabels();o=0===e&&t===o.length-1?o:o.slice(e,t+1),this._valueRange=Math.max(o.length-(r?0:1),1),this._startValue=this.min-(r?.5:0);for(let s=e;s<=t;s++)i.push({value:s});return i}getLabelForValue(e){const t=this.getLabels();return e>=0&&e<t.length?t[e]:e}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return"number"!=typeof e&&(e=this.parse(e)),null===e?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}function RP(n,e,{horizontal:t,minRotation:r}){const i=pa(r),o=(t?Math.sin(i):Math.cos(i))||.001;return Math.min(e/o,.75*e*(""+n).length)}Km.id="category",Km.defaults={ticks:{callback:Km.prototype.getLabelForValue}};class Qm extends Vl{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,t){return Un(e)||("number"==typeof e||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:t,maxDefined:r}=this.getUserBounds();let{min:i,max:o}=this;const s=u=>i=t?i:u,a=u=>o=r?o:u;if(e){const u=Za(i),c=Za(o);u<0&&c<0?a(0):u>0&&c>0&&s(0)}if(i===o){let u=1;(o>=Number.MAX_SAFE_INTEGER||i<=Number.MIN_SAFE_INTEGER)&&(u=Math.abs(.05*o)),a(o+u),e||s(i-u)}this.min=i,this.max=o}getTickLimit(){const e=this.options.ticks;let i,{maxTicksLimit:t,stepSize:r}=e;return r?(i=Math.ceil(this.max/r)-Math.floor(this.min/r)+1,i>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${r} would result generating up to ${i} ticks. Limiting to 1000.`),i=1e3)):(i=this.computeTickLimit(),t=t||11),t&&(i=Math.min(t,i)),i}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,t=e.ticks;let r=this.getTickLimit();r=Math.max(2,r);const s=function(n,e){const t=[],{bounds:i,step:o,min:s,max:a,precision:u,count:c,maxTicks:d,maxDigits:p,includeBounds:m}=n,y=o||1,w=d-1,{min:C,max:_}=e,A=!Un(s),T=!Un(a),N=!Un(c),M=(_-C)/(p+1);let L,V,j,U,O=kk((_-C)/w/y)*y;if(O<1e-14&&!A&&!T)return[{value:C},{value:_}];U=Math.ceil(_/O)-Math.floor(C/O),U>w&&(O=kk(U*O/w/y)*y),Un(u)||(L=Math.pow(10,u),O=Math.ceil(O*L)/L),"ticks"===i?(V=Math.floor(C/O)*O,j=Math.ceil(_/O)*O):(V=C,j=_),A&&T&&o&&function(n,e){const t=Math.round(n);return t-e<=n&&t+e>=n}((a-s)/o,O/1e3)?(U=Math.round(Math.min((a-s)/O,d)),O=(a-s)/U,V=s,j=a):N?(V=A?s:V,j=T?a:j,U=c-1,O=(j-V)/U):(U=(j-V)/O,U=qp(U,Math.round(U),O/1e3)?Math.round(U):Math.ceil(U));const G=Math.max(Fk(O),Fk(V));L=Math.pow(10,Un(u)?G:u),V=Math.round(V*L)/L,j=Math.round(j*L)/L;let K=0;for(A&&(m&&V!==s?(t.push({value:s}),V<s&&K++,qp(Math.round((V+K*O)*L)/L,s,RP(s,M,n))&&K++):V<s&&K++);K<U;++K)t.push({value:Math.round((V+K*O)*L)/L});return T&&m&&j!==a?t.length&&qp(t[t.length-1].value,a,RP(a,M,n))?t[t.length-1].value=a:t.push({value:a}):(!T||j===a)&&t.push({value:j}),t}({maxTicks:r,bounds:e.bounds,min:e.min,max:e.max,precision:t.precision,step:t.stepSize,count:t.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:t.minRotation||0,includeBounds:!1!==t.includeBounds},this._range||this);return"ticks"===e.bounds&&Pk(s,this,"value"),e.reverse?(s.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),s}configure(){const e=this.ticks;let t=this.min,r=this.max;if(super.configure(),this.options.offset&&e.length){const i=(r-t)/Math.max(e.length-1,1)/2;t-=i,r+=i}this._startValue=t,this._endValue=r,this._valueRange=r-t}getLabelForValue(e){return tg(e,this.chart.options.locale)}}class O_ extends Qm{determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=ei(e)?e:0,this.max=ei(t)?t:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),t=e?this.width:this.height,r=pa(this.options.ticks.minRotation),i=(e?Math.sin(r):Math.cos(r))||.001,o=this._resolveTickFontOptions(0);return Math.ceil(t/Math.min(40,o.lineHeight/i))}getPixelForValue(e){return null===e?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}function NP(n){return n/Math.pow(10,Math.floor(Is(n)))==1}O_.id="linear",O_.defaults={ticks:{callback:Vm.formatters.numeric}};class k_ extends Vl{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,t){const r=Qm.prototype.parse.apply(this,[e,t]);if(0!==r)return ei(r)&&r>0?r:null;this._zero=!0}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=ei(e)?Math.max(0,e):null,this.max=ei(t)?Math.max(0,t):null,this.options.beginAtZero&&(this._zero=!0),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let r=this.min,i=this.max;const o=u=>r=e?r:u,s=u=>i=t?i:u,a=(u,c)=>Math.pow(10,Math.floor(Is(u))+c);r===i&&(r<=0?(o(1),s(10)):(o(a(r,-1)),s(a(i,1)))),r<=0&&o(a(i,-1)),i<=0&&s(a(r,1)),this._zero&&this.min!==this._suggestedMin&&r===a(this.min,0)&&o(a(r,-1)),this.min=r,this.max=i}buildTicks(){const e=this.options,r=function(n,e){const t=Math.floor(Is(e.max)),r=Math.ceil(e.max/Math.pow(10,t)),i=[];let o=Cs(n.min,Math.pow(10,Math.floor(Is(e.min)))),s=Math.floor(Is(o)),a=Math.floor(o/Math.pow(10,s)),u=s<0?Math.pow(10,Math.abs(s)):1;do{i.push({value:o,major:NP(o)}),++a,10===a&&(a=1,++s,u=s>=0?1:u),o=Math.round(a*Math.pow(10,s)*u)/u}while(s<t||s===t&&a<r);const c=Cs(n.max,o);return i.push({value:c,major:NP(o)}),i}({min:this._userMin,max:this._userMax},this);return"ticks"===e.bounds&&Pk(r,this,"value"),e.reverse?(r.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),r}getLabelForValue(e){return void 0===e?"0":tg(e,this.chart.options.locale)}configure(){const e=this.min;super.configure(),this._startValue=Is(e),this._valueRange=Is(this.max)-Is(e)}getPixelForValue(e){return(void 0===e||0===e)&&(e=this.min),null===e||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:(Is(e)-this._startValue)/this._valueRange)}getValueForPixel(e){const t=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+t*this._valueRange)}}function P_(n){const e=n.ticks;if(e.display&&n.display){const t=Io(e.backdropPadding);return en(e.font&&e.font.size,bn.font.size)+t.height}return 0}function Loe(n,e,t){return t=hr(t)?t:[t],{w:Qte(n,e.string,t),h:t.length*e.lineHeight}}function OP(n,e,t,r,i){return n===r||n===i?{start:e-t/2,end:e+t/2}:n<r||n>i?{start:e-t,end:e}:{start:e,end:e+t}}function Uoe(n){return 0===n||180===n?"center":n<180?"left":"right"}function joe(n,e,t){return"right"===t?n-=e:"center"===t&&(n-=e/2),n}function Woe(n,e,t){return 90===t||270===t?n-=e/2:(t>270||t<90)&&(n-=e),n}function kP(n,e,t,r){const{ctx:i}=n;if(t)i.arc(n.xCenter,n.yCenter,e,0,sr);else{let o=n.getPointPosition(0,e);i.moveTo(o.x,o.y);for(let s=1;s<r;s++)o=n.getPointPosition(s,e),i.lineTo(o.x,o.y)}}function Zm(n){return Id(n)?n:0}k_.id="logarithmic",k_.defaults={ticks:{callback:Vm.formatters.logarithmic,major:{enabled:!0}}};class hg extends Qm{constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){this.width=this.maxWidth,this.height=this.maxHeight,this.paddingTop=P_(this.options)/2,this.xCenter=Math.floor(this.width/2),this.yCenter=Math.floor((this.height-this.paddingTop)/2),this.drawingArea=Math.min(this.height-this.paddingTop,this.width)/2}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!1);this.min=ei(e)&&!isNaN(e)?e:0,this.max=ei(t)&&!isNaN(t)?t:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/P_(this.options))}generateTickLabels(e){Qm.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map((t,r)=>{const i=dr(this.options.pointLabels.callback,[t,r],this);return i||0===i?i:""})}fit(){const e=this.options;e.display&&e.pointLabels.display?function(n){const e={l:0,r:n.width,t:0,b:n.height-n.paddingTop},t={},r=[],i=[],o=n.getLabels().length;for(let s=0;s<o;s++){const a=n.options.pointLabels.setContext(n.getPointLabelContext(s));i[s]=a.padding;const u=n.getPointPosition(s,n.drawingArea+i[s]),c=Ai(a.font),d=Loe(n.ctx,c,n._pointLabels[s]);r[s]=d;const p=n.getIndexAngle(s),m=n_(p),y=OP(m,u.x,d.w,0,180),w=OP(m,u.y,d.h,90,270);y.start<e.l&&(e.l=y.start,t.l=p),y.end>e.r&&(e.r=y.end,t.r=p),w.start<e.t&&(e.t=w.start,t.t=p),w.end>e.b&&(e.b=w.end,t.b=p)}n._setReductions(n.drawingArea,e,t),n._pointLabelItems=function(n,e,t){const r=[],i=n.getLabels().length,o=n.options,s=P_(o),a=n.getDistanceFromCenterForValue(o.ticks.reverse?n.min:n.max);for(let u=0;u<i;u++){const d=n.getPointPosition(u,a+(0===u?s/2:0)+t[u]),p=n_(n.getIndexAngle(u)),m=e[u],y=Woe(d.y,m.h,p),w=Uoe(p),C=joe(d.x,m.w,w);r.push({x:d.x,y,textAlign:w,left:C,top:y,right:C+m.w,bottom:y+m.h})}return r}(n,r,i)}(this):this.setCenterPoint(0,0,0,0)}_setReductions(e,t,r){let i=t.l/Math.sin(r.l),o=Math.max(t.r-this.width,0)/Math.sin(r.r),s=-t.t/Math.cos(r.t),a=-Math.max(t.b-(this.height-this.paddingTop),0)/Math.cos(r.b);i=Zm(i),o=Zm(o),s=Zm(s),a=Zm(a),this.drawingArea=Math.max(e/2,Math.min(Math.floor(e-(i+o)/2),Math.floor(e-(s+a)/2))),this.setCenterPoint(i,o,s,a)}setCenterPoint(e,t,r,i){const a=r+this.drawingArea,u=this.height-this.paddingTop-i-this.drawingArea;this.xCenter=Math.floor((e+this.drawingArea+(this.width-t-this.drawingArea))/2+this.left),this.yCenter=Math.floor((a+u)/2+this.top+this.paddingTop)}getIndexAngle(e){return ga(e*(sr/this.getLabels().length)+pa(this.options.startAngle||0))}getDistanceFromCenterForValue(e){if(Un(e))return NaN;const t=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*t:(e-this.min)*t}getValueForDistanceFromCenter(e){if(Un(e))return NaN;const t=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-t:this.min+t}getPointLabelContext(e){const t=this._pointLabels||[];if(e>=0&&e<t.length){const r=t[e];return function(n,e,t){return kc(n,{label:t,index:e,type:"pointLabel"})}(this.getContext(),e,r)}}getPointPosition(e,t){const r=this.getIndexAngle(e)-ti;return{x:Math.cos(r)*t+this.xCenter,y:Math.sin(r)*t+this.yCenter,angle:r}}getPointPositionForValue(e,t){return this.getPointPosition(e,this.getDistanceFromCenterForValue(t))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){const{left:t,top:r,right:i,bottom:o}=this._pointLabelItems[e];return{left:t,top:r,right:i,bottom:o}}drawBackground(){const{backgroundColor:e,grid:{circular:t}}=this.options;if(e){const r=this.ctx;r.save(),r.beginPath(),kP(this,this.getDistanceFromCenterForValue(this._endValue),t,this.getLabels().length),r.closePath(),r.fillStyle=e,r.fill(),r.restore()}}drawGrid(){const e=this.ctx,t=this.options,{angleLines:r,grid:i}=t,o=this.getLabels().length;let s,a,u;if(t.pointLabels.display&&function(n,e){const{ctx:t,options:{pointLabels:r}}=n;for(let i=e-1;i>=0;i--){const o=r.setContext(n.getPointLabelContext(i)),s=Ai(o.font),{x:a,y:u,textAlign:c,left:d,top:p,right:m,bottom:y}=n._pointLabelItems[i],{backdropColor:w}=o;if(!Un(w)){const C=Io(o.backdropPadding);t.fillStyle=w,t.fillRect(d-C.left,p-C.top,m-d+C.width,y-p+C.height)}Pl(t,n._pointLabels[i],a,u+s.lineHeight/2,s,{color:o.color,textAlign:c,textBaseline:"middle"})}}(this,o),i.display&&this.ticks.forEach((c,d)=>{0!==d&&(a=this.getDistanceFromCenterForValue(c.value),function(n,e,t,r){const i=n.ctx,o=e.circular,{color:s,lineWidth:a}=e;!o&&!r||!s||!a||t<0||(i.save(),i.strokeStyle=s,i.lineWidth=a,i.setLineDash(e.borderDash),i.lineDashOffset=e.borderDashOffset,i.beginPath(),kP(n,t,o,r),i.closePath(),i.stroke(),i.restore())}(this,i.setContext(this.getContext(d-1)),a,o))}),r.display){for(e.save(),s=this.getLabels().length-1;s>=0;s--){const c=r.setContext(this.getPointLabelContext(s)),{color:d,lineWidth:p}=c;!p||!d||(e.lineWidth=p,e.strokeStyle=d,e.setLineDash(c.borderDash),e.lineDashOffset=c.borderDashOffset,a=this.getDistanceFromCenterForValue(t.ticks.reverse?this.min:this.max),u=this.getPointPosition(s,a),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(u.x,u.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){const e=this.ctx,t=this.options,r=t.ticks;if(!r.display)return;const i=this.getIndexAngle(0);let o,s;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(i),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach((a,u)=>{if(0===u&&!t.reverse)return;const c=r.setContext(this.getContext(u)),d=Ai(c.font);if(o=this.getDistanceFromCenterForValue(this.ticks[u].value),c.showLabelBackdrop){e.font=d.string,s=e.measureText(a.label).width,e.fillStyle=c.backdropColor;const p=Io(c.backdropPadding);e.fillRect(-s/2-p.left,-o-d.size/2-p.top,s+p.width,d.size+p.height)}Pl(e,a.label,0,-o,d,{color:c.color})}),e.restore()}drawTitle(){}}hg.id="radialLinear",hg.defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Vm.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:n=>n,padding:5}},hg.defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"},hg.descriptors={angleLines:{_fallback:"grid"}};const Jm={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Lo=Object.keys(Jm);function Yoe(n,e){return n-e}function PP(n,e){if(Un(e))return null;const t=n._adapter,{parser:r,round:i,isoWeekday:o}=n._parseOpts;let s=e;return"function"==typeof r&&(s=r(s)),ei(s)||(s="string"==typeof r?t.parse(s,r):t.parse(s)),null===s?null:(i&&(s="week"!==i||!Id(o)&&!0!==o?t.startOf(s,i):t.startOf(s,"isoWeek",o)),+s)}function FP(n,e,t,r){const i=Lo.length;for(let o=Lo.indexOf(n);o<i-1;++o){const s=Jm[Lo[o]],a=s.steps?s.steps:Number.MAX_SAFE_INTEGER;if(s.common&&Math.ceil((t-e)/(a*s.size))<=r)return Lo[o]}return Lo[i-1]}function LP(n,e,t){if(t){if(t.length){const{lo:r,hi:i}=f_(t,e);n[t[r]>=e?t[r]:t[i]]=!0}}else n[e]=!0}function BP(n,e,t){const r=[],i={},o=e.length;let s,a;for(s=0;s<o;++s)a=e[s],i[a]=s,r.push({value:a,major:!1});return 0!==o&&t?function(n,e,t,r){const i=n._adapter,o=+i.startOf(e[0].value,r),s=e[e.length-1].value;let a,u;for(a=o;a<=s;a=+i.add(a,1,r))u=t[a],u>=0&&(e[u].major=!0);return e}(n,r,i,t):r}let F_=(()=>{class n extends Vl{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,r){const i=t.time||(t.time={}),o=this._adapter=new Cre._date(t.adapters.date);Yp(i.displayFormats,o.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(t),this._normalized=r.normalized}parse(t,r){return void 0===t?null:PP(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,r=this._adapter,i=t.time.unit||"day";let{min:o,max:s,minDefined:a,maxDefined:u}=this.getUserBounds();function c(d){!a&&!isNaN(d.min)&&(o=Math.min(o,d.min)),!u&&!isNaN(d.max)&&(s=Math.max(s,d.max))}(!a||!u)&&(c(this._getLabelBounds()),("ticks"!==t.bounds||"labels"!==t.ticks.source)&&c(this.getMinMax(!1))),o=ei(o)&&!isNaN(o)?o:+r.startOf(Date.now(),i),s=ei(s)&&!isNaN(s)?s:+r.endOf(Date.now(),i)+1,this.min=Math.min(o,s-1),this.max=Math.max(o+1,s)}_getLabelBounds(){const t=this.getLabelTimestamps();let r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.length&&(r=t[0],i=t[t.length-1]),{min:r,max:i}}buildTicks(){const t=this.options,r=t.time,i=t.ticks,o="labels"===i.source?this.getLabelTimestamps():this._generate();"ticks"===t.bounds&&o.length&&(this.min=this._userMin||o[0],this.max=this._userMax||o[o.length-1]);const s=this.min,u=function(n,e,t){let r=0,i=n.length;for(;r<i&&n[r]<e;)r++;for(;i>r&&n[i-1]>t;)i--;return r>0||i<n.length?n.slice(r,i):n}(o,s,this.max);return this._unit=r.unit||(i.autoSkip?FP(r.minUnit,this.min,this.max,this._getLabelCapacity(s)):function(n,e,t,r,i){for(let o=Lo.length-1;o>=Lo.indexOf(t);o--){const s=Lo[o];if(Jm[s].common&&n._adapter.diff(i,r,s)>=e-1)return s}return Lo[t?Lo.indexOf(t):0]}(this,u.length,r.minUnit,this.min,this.max)),this._majorUnit=i.major.enabled&&"year"!==this._unit?function(n){for(let e=Lo.indexOf(n)+1,t=Lo.length;e<t;++e)if(Jm[Lo[e]].common)return Lo[e]}(this._unit):void 0,this.initOffsets(o),t.reverse&&u.reverse(),BP(this,u,this._majorUnit)}initOffsets(t){let o,s,r=0,i=0;this.options.offset&&t.length&&(o=this.getDecimalForValue(t[0]),r=1===t.length?1-o:(this.getDecimalForValue(t[1])-o)/2,s=this.getDecimalForValue(t[t.length-1]),i=1===t.length?s:(s-this.getDecimalForValue(t[t.length-2]))/2);const a=t.length<3?.5:.25;r=Li(r,0,a),i=Li(i,0,a),this._offsets={start:r,end:i,factor:1/(r+1+i)}}_generate(){const t=this._adapter,r=this.min,i=this.max,o=this.options,s=o.time,a=s.unit||FP(s.minUnit,r,i,this._getLabelCapacity(r)),u=en(s.stepSize,1),c="week"===a&&s.isoWeekday,d=Id(c)||!0===c,p={};let y,w,m=r;if(d&&(m=+t.startOf(m,"isoWeek",c)),m=+t.startOf(m,d?"day":a),t.diff(i,r,a)>1e5*u)throw new Error(r+" and "+i+" are too far apart with stepSize of "+u+" "+a);const C="data"===o.ticks.source&&this.getDataTimestamps();for(y=m,w=0;y<i;y=+t.add(y,u,a),w++)LP(p,y,C);return(y===i||"ticks"===o.bounds||1===w)&&LP(p,y,C),Object.keys(p).sort((_,A)=>_-A).map(_=>+_)}getLabelForValue(t){const i=this.options.time;return this._adapter.format(t,i.tooltipFormat?i.tooltipFormat:i.displayFormats.datetime)}_tickFormatFunction(t,r,i,o){const s=this.options,a=s.time.displayFormats,u=this._unit,c=this._majorUnit,p=c&&a[c],m=i[r],w=this._adapter.format(t,o||(c&&p&&m&&m.major?p:u&&a[u])),C=s.ticks.callback;return C?dr(C,[w,r,i],this):w}generateTickLabels(t){let r,i,o;for(r=0,i=t.length;r<i;++r)o=t[r],o.label=this._tickFormatFunction(o.value,r,t)}getDecimalForValue(t){return null===t?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const r=this._offsets,i=this.getDecimalForValue(t);return this.getPixelForDecimal((r.start+i)*r.factor)}getValueForPixel(t){const r=this._offsets,i=this.getDecimalForPixel(t)/r.factor-r.end;return this.min+i*(this.max-this.min)}_getLabelSize(t){const r=this.options.ticks,i=this.ctx.measureText(t).width,o=pa(this.isHorizontal()?r.maxRotation:r.minRotation),s=Math.cos(o),a=Math.sin(o),u=this._resolveTickFontOptions(0).size;return{w:i*s+u*a,h:i*a+u*s}}_getLabelCapacity(t){const r=this.options.time,i=r.displayFormats,o=i[r.unit]||i.millisecond,s=this._tickFormatFunction(t,0,BP(this,[t],this._majorUnit),o),a=this._getLabelSize(s),u=Math.floor(this.isHorizontal()?this.width/a.w:this.height/a.h)-1;return u>0?u:1}getDataTimestamps(){let r,i,t=this._cache.data||[];if(t.length)return t;const o=this.getMatchingVisibleMetas();if(this._normalized&&o.length)return this._cache.data=o[0].controller.getAllParsedValues(this);for(r=0,i=o.length;r<i;++r)t=t.concat(o[r].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let r,i;if(t.length)return t;const o=this.getLabels();for(r=0,i=o.length;r<i;++r)t.push(PP(this,o[r]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return Jk(t.sort(Yoe))}}return n.id="time",n.defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",major:{enabled:!1}}},n})();function ev(n,e,t){let o,s,a,u,r=0,i=n.length-1;t?(e>=n[r].pos&&e<=n[i].pos&&({lo:r,hi:i}=Fu(n,"pos",e)),({pos:o,time:a}=n[r]),({pos:s,time:u}=n[i])):(e>=n[r].time&&e<=n[i].time&&({lo:r,hi:i}=Fu(n,"time",e)),({time:o,pos:a}=n[r]),({time:s,pos:u}=n[i]));const c=s-o;return c?a+(u-a)*(e-o)/c:a}class L_ extends F_{constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),t=this._table=this.buildLookupTable(e);this._minPos=ev(t,this.min),this._tableRange=ev(t,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:t,max:r}=this,i=[],o=[];let s,a,u,c,d;for(s=0,a=e.length;s<a;++s)c=e[s],c>=t&&c<=r&&i.push(c);if(i.length<2)return[{time:t,pos:0},{time:r,pos:1}];for(s=0,a=i.length;s<a;++s)d=i[s+1],u=i[s-1],c=i[s],Math.round((d+u)/2)!==c&&o.push({time:c,pos:s/(a-1)});return o}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const t=this.getDataTimestamps(),r=this.getLabelTimestamps();return e=t.length&&r.length?this.normalize(t.concat(r)):t.length?t:r,e=this._cache.all=e,e}getDecimalForValue(e){return(ev(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const t=this._offsets,r=this.getDecimalForPixel(e)/t.factor-t.end;return ev(this._table,r*this._tableRange+this._minPos,!0)}}L_.id="timeseries",L_.defaults=F_.defaults;const Qoe=[_re,$ie,Roe,Object.freeze({__proto__:null,CategoryScale:Km,LinearScale:O_,LogarithmicScale:k_,RadialLinearScale:hg,TimeScale:F_,TimeSeriesScale:L_})],Zoe=["chartRef"];let B_=(()=>{class n{constructor(){this.datasets=[],this.labels=new Array(128).fill(""),this.title="Chart",this.max=.5,this.min=-.5,this.step=.1}ngAfterViewInit(){this.chart=new zm(this.chartRef.nativeElement,{type:"line",data:this.getChartData(),options:{scales:{yAxes:{display:!0,ticks:{stepSize:this.step},max:this.max,min:this.min}}}})}ngOnInit(){}ngOnChanges(){this.chart&&(this.chart.data=this.getChartData(),this.chart.update())}getChartData(){return{datasets:this.datasets?this.datasets.map(t=>Object.assign(Object.assign({},t),{backgroundColor:null==t?void 0:t.borderColor})):[],labels:this.labels}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=xe({type:n,selectors:[["app-chart-line"]],viewQuery:function(t,r){if(1&t&&Ff(Zoe,5,bi),2&t){let i;rl(i=il())&&(r.chartRef=i.first)}},inputs:{datasets:"datasets",labels:"labels",title:"title",max:"max",min:"min",step:"step"},features:[E],decls:4,vars:1,consts:[["chartRef",""]],template:function(t,r){1&t&&(rt(0,"h1"),xn(1),it(),yr(2,"canvas",null,0)),2&t&&(wt(1),mf(r.title))},styles:["[_nghost-%COMP%]{display:block;position:relative;min-height:100px}h1[_ngcontent-%COMP%]{line-height:1em;padding:0;margin:0;pointer-events:none}canvas[_ngcontent-%COMP%]{max-width:100%;max-height:calc(100% - 2em)}"],changeDetection:0}),n})();function Joe(n,e){1&n&&(rt(0,"p"),xn(1,"Please enter images as source images."),it())}function ese(n,e){1&n&&(rt(0,"p"),xn(1,"Here are your source images."),it())}function tse(n,e){if(1&n){const t=Ri();lc(0),rt(1,"div",10),rt(2,"a"),xn(3),it(),rt(4,"a",11),Qn("click",function(){Qr(t);const i=gn().index;return gn().removeImage(i)}),xn(5,"x"),it(),rt(6,"a",12),Qn("click",function(){Qr(t);const i=gn().index,o=gn();return o.log(o.descriptors[i])}),xn(7,"L"),it(),it(),hc()}if(2&n){const t=gn(),r=t.$implicit,i=t.index;wt(1),t0("background-image: url(",null==r?null:r.src,");"),wt(2),Nh("#",i,"")}}function nse(n,e){if(1&n&&(lc(0),Mn(1,tse,8,4,"ng-container",5),hc()),2&n){const t=e.$implicit;wt(1),_t("ngIf",t)}}const rse=me(338);let VP=(()=>{class n{constructor(t){this.faceService=t,this.faces=this.faceService.faces,this.descriptors=this.faceService.descriptors,this.filteredDescriptors=this.faceService.filteredDescriptors,this.stringify=JSON.stringify}ngOnInit(){this.loadChartData()}addImages(t){var r=this;return qn(function*(){yield Promise.all(t.map(i=>r.faceService.addFaceImage(i))),r.loadChartData()})()}removeImage(t){this.faceService.removeFace(t),this.loadChartData()}loadChartData(){this.chartData={datasets:this.descriptors.map((t,r)=>({data:t||[],label:`#${r}`,borderColor:rse(),borderWidth:2}))}}log(t){const r=Object.values(t);console.log(r),console.log(this.stringify(r))}}return n.\u0275fac=function(t){return new(t||n)(ut(Dk))},n.\u0275cmp=xe({type:n,selectors:[["ng-component"]],decls:16,vars:6,consts:[[3,"addImage"],[3,"capture"],[3,"captureFaceImage"],["faceInput",""],[3,"axesRotation"],[4,"ngIf"],[1,"chart"],[3,"title","datasets"],[1,"grid"],[4,"ngFor","ngForOf"],["aria-label","click to remove",1,"img-item"],[1,"remove",3,"click"],[1,"log",3,"click"]],template:function(t,r){if(1&t&&(rt(0,"app-image-picker",0),Qn("addImage",function(o){return r.addImages(o)}),it(),yr(1,"br"),rt(2,"app-webcam-input",1),Qn("capture",function(o){return r.addImages([o])}),it(),yr(3,"br"),rt(4,"app-webcam-face-input",2,3),Qn("captureFaceImage",function(o){return r.addImages([o])}),it(),yr(6,"app-axes-rotation-info",4),yr(7,"hr"),yr(8,"app-webcam-qr-input"),rt(9,"div"),Mn(10,Joe,2,0,"p",5),Mn(11,ese,2,0,"p",5),it(),rt(12,"div",6),yr(13,"app-chart-line",7),it(),rt(14,"div",8),Mn(15,nse,2,1,"ng-container",9),it()),2&t){const i=hu(5);wt(6),_t("axesRotation",null==i?null:i.axesRotation),wt(4),_t("ngIf",0===r.filteredDescriptors.length),wt(1),_t("ngIf",r.filteredDescriptors.length>0),wt(2),_t("title","Descriptors Value Chart")("datasets",null==r.chartData?null:r.chartData.datasets),wt(2),_t("ngForOf",r.faces)}},directives:[Z2,jp,Hp,J2,Q2,vu,B_,Yf],styles:[".grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,350px));grid-gap:1em;gap:1em}app-chart-line[_ngcontent-%COMP%]{height:calc(70vh - 2rem)}.img-item[_ngcontent-%COMP%]{position:relative;background-position:center;background-size:cover;height:350px;border:1px solid #ecececef}.img-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{position:absolute;background:#ecececef;border-radius:50%;line-height:1.5em;width:1.5em;height:1.5em;text-align:center}.img-item[_ngcontent-%COMP%]   .remove[_ngcontent-%COMP%]{right:5px;top:5px;cursor:pointer}.img-item[_ngcontent-%COMP%]   .log[_ngcontent-%COMP%]{right:2em;top:5px;cursor:pointer}"]}),n})();function ise(n,e){if(1&n&&(rt(0,"div",13),yr(1,"img",14),it()),2&n){const t=gn(2);wt(1),_t("src",null==t.image?null:t.image.src,Bg)}}function ose(n,e){1&n&&(rt(0,"p"),xn(1,"Matching score compared against below source images:"),it())}function sse(n,e){if(1&n&&(lc(0),yr(1,"div",18),rt(2,"div",19),xn(3),Wh(4,"number"),it(),hc()),2&n){const t=gn(2).index,r=gn(2);let i,o;wt(1),t0("width:",100*(1-(null!==(i=r.scores[t])&&void 0!==i?i:0)),"%;"),wt(2),Nh("Match Score: ",Of(4,4,100*(1-(null!==(o=r.scores[t])&&void 0!==o?o:0)),"1.1-2")," %")}}function ase(n,e){if(1&n&&(rt(0,"div",16),rt(1,"div",17),rt(2,"a"),xn(3),it(),it(),Mn(4,sse,5,7,"ng-container",8),it()),2&n){const t=gn(),r=t.$implicit,i=t.index,o=gn(2);wt(1),t0("background-image: url(",r.src,");"),wt(2),Nh("#",i,""),wt(1),_t("ngIf",null!=o.scores[i])}}function use(n,e){if(1&n&&(lc(0),Mn(1,ase,5,5,"div",15),hc()),2&n){const t=e.$implicit,r=e.index,i=gn(2);wt(1),_t("ngIf",!!t&&null!=i.scores[r])}}function cse(n,e){if(1&n){const t=Ri();lc(0),rt(1,"app-image-picker",3),Qn("addImage",function(i){return Qr(t),gn().matchImage(i[0])}),it(),yr(2,"br"),rt(3,"app-webcam-face-input",4),Qn("capture",function(i){return Qr(t),gn().matchImage(i)}),it(),yr(4,"br"),xn(5," Minkowsky Weight: "),rt(6,"input",5,6),Qn("change",function(){Qr(t);const i=hu(7);return gn().changeParam(i.value)}),it(),Mn(8,ise,2,1,"div",7),Mn(9,ose,2,0,"p",8),rt(10,"div",9),yr(11,"app-chart-line",10),it(),rt(12,"div",11),Mn(13,use,2,1,"ng-container",12),it(),hc()}if(2&n){const t=gn(),r=hu(2);wt(6),_t("value",t.minkowskyParam),wt(2),_t("ngIf",null==t.image?null:t.image.src)("ngIfElse",r),wt(1),_t("ngIf",t.scores.length>0),wt(2),_t("title","Distance Value against current image")("datasets",null==t.chartData?null:t.chartData.datasets)("max",.15)("min",0)("step",.01),wt(2),_t("ngForOf",t.faces)}}function lse(n,e){1&n&&(rt(0,"p"),xn(1,"Please enter image to compare against below source images."),it())}function hse(n,e){1&n&&(rt(0,"p"),xn(1,'Please go to "List" menu to enter source images.'),it())}const dse=me(338);const fse=[{path:"",pathMatch:"full",redirectTo:"face"},{path:"face",component:VP},{path:"match",component:(()=>{class n{constructor(t,r){this.faceService=t,this.faceDataService=r,this.descriptors=this.faceDataService.descriptors,this.filteredDescriptors=this.faceDataService.filteredDescriptors,this.faces=this.faceDataService.faces,this.scores=[],this.minkowskyParam=d1.minkowskyWeight}ngOnInit(){}matchImage(t){var r=this;return qn(function*(){r.scores=[],r.image=t,r.scores=t?yield r.faceDataService.getArrayMatchDistance(t):[],yield r.loadChartData()})()}loadChartData(){var t=this;return qn(function*(){const r=yield t.faceService.getSingleFaceDescriptor(t.image),i=Array.from(r);t.chartData={datasets:t.scores.map((o,s)=>({data:null!=o?i.map((a,u)=>Math.abs(a-t.descriptors[s][u])):[],label:`#${s}`,borderColor:dse(),borderWidth:2}))}})()}changeParam(t){d1.minkowskyWeight=parseInt(t)}}return n.\u0275fac=function(t){return new(t||n)(ut(Y2),ut(Dk))},n.\u0275cmp=xe({type:n,selectors:[["ng-component"]],decls:5,vars:2,consts:[[4,"ngIf","ngIfElse"],["matchInstruction",""],["noSourceImage",""],[3,"addImage"],[3,"capture"],[3,"value","change"],["inputWeight",""],["class","container",4,"ngIf","ngIfElse"],[4,"ngIf"],[1,"chart"],[3,"title","datasets","max","min","step"],[1,"compare"],[4,"ngFor","ngForOf"],[1,"container"],[1,"image",3,"src"],["class","compare__item",4,"ngIf"],[1,"compare__item"],[1,"compare__item__img"],[1,"compare__item__bar"],[1,"compare__item__text"]],template:function(t,r){if(1&t&&(Mn(0,cse,14,10,"ng-container",0),Mn(1,lse,2,0,"ng-template",null,1,lx),Mn(3,hse,2,0,"ng-template",null,2,lx)),2&t){const i=hu(4);_t("ngIf",r.filteredDescriptors.length>0)("ngIfElse",i)}},directives:[vu,Z2,Hp,B_,Yf],pipes:[Zx],styles:[".image[_ngcontent-%COMP%]{max-height:300px}app-chart-line[_ngcontent-%COMP%]{height:calc(70vh - 2rem)}.compare[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,250px));grid-gap:1em;gap:1em}.compare__item[_ngcontent-%COMP%]{position:relative;height:200px;border:1px solid #aaa}.compare__item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{position:absolute;background:#ecececef;border-radius:50%;line-height:1.5em;width:1.5em;height:1.5em;text-align:center}.compare__item__img[_ngcontent-%COMP%]{display:block;width:100%;height:calc(100% - 1em - 2px);background-position:center;background-size:cover}.compare__item__bar[_ngcontent-%COMP%]{position:absolute;bottom:0px;height:1em;background:darkgray;border:1px solid transparent}.compare__item__text[_ngcontent-%COMP%]{position:absolute;bottom:0px;border-top:1px solid #aaa;width:100%}"]}),n})()},{path:"yaw",component:(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=xe({type:n,selectors:[["app-face-yaw"]],decls:5,vars:1,consts:[["peekDetector",""],[3,"axesRotation"]],template:function(t,r){if(1&t&&(rt(0,"h1"),xn(1,"Kalau nengok ke samping(abs(yaw) > 30) dalam 5 detik, akan muncul pesan di kanan bawah"),it(),yr(2,"app-peek-to-side-detector",null,0),yr(4,"app-axes-rotation-info",1)),2&t){const i=hu(3);wt(4),_t("axesRotation",null==i?null:i.axesRotation)}},directives:[q2,J2],styles:["[_nghost-%COMP%]{display:flex;align-items:center;justify-content:center;height:100vh}"]}),n})()}];let pse=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=gt({type:n}),n.\u0275inj=ji({imports:[[YM.forRoot(fse,{useHash:!0})],YM]}),n})();function gse(n,e){if(1&n&&(rt(0,"a",2),xn(1),it()),2&n){const t=e.$implicit;_t("routerLink",t.path),wt(1),mf(t.label)}}let WP=(()=>{class n{constructor(){this.title="face-match-demo",this.menu=[{label:"List",path:"face"},{label:"Match",path:"match"},{label:"Peeking detector",path:"yaw"}]}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=xe({type:n,selectors:[["app-root"]],decls:3,vars:1,consts:[[1,"menu"],[3,"routerLink",4,"ngFor","ngForOf"],[3,"routerLink"]],template:function(t,r){1&t&&(rt(0,"div",0),Mn(1,gse,2,2,"a",1),it(),yr(2,"router-outlet")),2&t&&(wt(1),_t("ngForOf",r.menu))},directives:[Yf,Ob,h1],styles:[".menu[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,350px));grid-gap:5px;gap:5px;border-bottom:2px solid #ececee}"]}),n})();zm.register(...Qoe);let mse=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=gt({type:n,bootstrap:[WP]}),n.\u0275inj=ji({providers:[],imports:[[jT,pse,lte]]}),n})();(function(){if(TS)throw new Error("Cannot enable prod mode after platform setup.");SS=!1})(),DH().bootstrapModule(mse).catch(n=>console.error(n))},730:()=>{},369:()=>{},655:()=>{},118:()=>{}},tn=>{tn(tn.s=421)}]);